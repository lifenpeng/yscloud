"use strict";function initCommon_Params(a){var b={org_channel_code:"",org_srv_name:"",org_dept_id:"",org_rs_code:"",org_term_no:"",org_user_id:"",org_work_code:"",submit_type:1};b.org_channel_code="01",b.org_srv_name="us_UserLoginInAction",b.org_rs_code="00",b.org_user_id=a,b.orguser_cn_name="",b.org_srv_name="",b.org_term_no="",b.org_dept_id="",b.orgdept_cn_name="",b.tl_tltelr="",b.br_sbsbno="",b.br_sbsbch=""}function succInitUserInfo(a,b){var c={user_id:"",user_name:"",role_ids:"",login_bk_num:0,dept_id:"",login:!1,tl_tltelr:"",br_sbsbno:"",br_sbsbtp:""},d={org_channel_code:"",org_srv_name:"",org_dept_id:"",org_rs_code:"",org_term_no:"",org_user_id:"",org_work_code:"",submit_type:1};return d.org_channel_code="01",d.org_srv_name="us_UserLoginInAction",d.org_rs_code="00",d.org_user_id=b,d.orguser_cn_name=a.user_cn_name,d.org_srv_name="",d.org_term_no=a.term_no,d.org_dept_id=a.bl_dept_id,d.orgdept_cn_name=a.dept_cn_name,d.tl_tltelr=a.tl_tltelr,d.br_sbsbno=a.br_sbsbno,d.br_sbsbch=a.br_sbsbch,c.user_id=b,c.user_name=a.user_cn_name,c.dept_cn_name=a.dept_cn_name,c.role_ids=a.dprl_code,c.dept_id=a.bl_dept_id,c.login_bk_num=a.login_bk_num,c.login=!0,c.login_time=a.dtbs_bk_date,{cp:d,ui:c}}var CommHttp=angular.module("CommHttpSrv",[]);CommHttp.service("User",["CallProvider",function(a){this.login=function(b){return a.call({actionName:"us_UserLoginInAction.do",reqData:{org_user_id:b.username,user_passwd:b.password,org_channel_code:"01"}})},this.getPermission=function(b){return a.call({actionName:"us_QueryRsPrivAction.do",reqData:{bl_rs_code:b}})},this.getLicense=function(b){return a.call({actionName:"cm_ViewLicenseActionloadLicense.do",reqData:{submit_type:1}})},this.registLicense=function(b){return a.call({actionName:"cm_RegistLicenseAction.do",reqData:b})},this.getAllUserCanExec=function(){return a.call({actionName:"us_ViewUsforAppActiongetDeptUserListForWeb.do",reqData:{}})},this.getUserByUserId=function(b){return a.call({actionName:"us_QueryUserByUserIdAction.do",reqData:{user_id:b}})},this.UpdatePwd=function(b){return a.call({actionName:"us_UpdatePwdAction.do",reqData:b})},this.us_UpdateUserAction=function(b){return a.call({actionName:"us_UpdateUserAction.do",reqData:{user_id:b.user_name,user_cn_name:b.user_cn_name,teller_no:b.teller_no,email_add:b.user_email,phone_no:b.phone_number,pwdexp_bk_date:b.pwd_expiry_date,user_type:b.user_type,bl_dept_id:b.user_department,first_dept_id:b.parttime_department,dprl_cn_name:b.department_role}})},this.getContactsListByUserName=function(b,c,d){return a.call({actionName:"us_PageExtUserListAction.do",reqData:{start_recd:b,limit_recd:c,user_cn_name:d}})},this.getCommonlyUsedConcats=function(){return a.call({actionName:"us_QueryUserContactAction.do",reqData:{}})},this.addAttentionContacts=function(b){return a.call({actionName:"us_AddUserContactAction.do",reqData:{contact_user_id:b}})},this.removeAttentionContacts=function(b){return a.call({actionName:"us_DeleteUserContactAction.do",reqData:{contact_user_id:b}})},this.us_QueryFirstNavigagePrivAction=function(){return a.call({actionName:"us_QueryFirstNavigagePrivAction.do",reqData:{}})}}]),CommHttp.service("Message",["CallProvider",function(a){this.mg_PageMessageAction=function(b,c,d){return a.call({actionName:"mg_PageMessageAction.do",reqData:{rc_flag:b,start_recd:c,limit_recd:d}})},this.mg_PageMessageActionPg=function(b){return a.call({actionName:"mg_PageMessageAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.getmessageDetail=function(b){return a.call({actionName:"mg_QueryMsgInfoAction.do",reqData:{workseq:b}})},this.deleteOneMessage=function(b,c){return a.call({actionName:"mg_DeleteRcMess.do",reqData:{workseq:b}})}}]),CommHttp.service("Task",["CallProvider","CV",function(a,b){this.getUnhandleTaskList=function(b,c){return a.call({actionName:"wk_PageUnhandleWorkAction.do",reqData:{start_recd:b,limit_recd:c}})},this.wk_PageMineHistoryWorkAction=function(b){return a.call({actionName:"wk_PageMineHistoryWorkAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.wk_PageMineHistoryUncheckAction=function(b){return a.call({actionName:"wk_PageMineHistoryUncheckAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.wk_PageMineHistoryUnauthAction=function(b){return a.call({actionName:"wk_PageMineHistoryUnauthAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.getUnhandleTaskCount=function(){return a.call({actionName:"wk_ViewWorkActionqueryExecutoryWorkByUserId.do",reqData:{}})},this.getTaskDetail=function(b){return a.call({actionName:"wk_QueryWorkDetailAction.do",reqData:{wrk_seq:b}})},this.wk_QueryMineWorkListAction=function(){return a.call({actionName:"wk_QueryMineWorkListAction.do",reqData:{}})},this.wk_QueryMineUncheckWorkAction=function(){return a.call({actionName:"wk_QueryMineUncheckWorkAction.do",reqData:{}})},this.wk_QueryMineUnauthWorkAction=function(){return a.call({actionName:"wk_QueryMineUnauthWorkAction.do",reqData:{}})},this.wk_QueryTroubleTicketWorkAction=function(c){return a.call({actionName:"pg_PagePgAuthWorkAction.do",reqData:{org_rs_code:b.rscode(""),start_recd:c.data.offset,limit_recd:c.data.limit,status_list:c.status_list}})},this.LocalAuthTask=function(b){return a.call({actionName:"wk_CheckLocalAuthAction.do",reqData:b})},this.CheckPendTask=function(b){return a.call({actionName:"wk_CheckPendWorkAction.do",reqData:b})},this.AuthPendTask=function(b){return a.call({actionName:"wk_AuthPendWorkAction.do",reqData:b})},this.ExecuteTask=function(b,c){return a.call({actionName:c+".do",reqData:b,timeout:1800})},this.CloseTask=function(b){return a.call({actionName:"wk_UpdateWkDealStateByKeyAction.do",reqData:b})},this.getProgramAuthDetail=function(b){return a.call({actionName:"pg_QueryPgWorkDetailAction.do",reqData:{pg_work_seq:b}})},this.authProgram=function(b){return a.call({actionName:"pg_AuthPgWorkAction.do",reqData:b})},this.viewTaskProgramDetail=function(b){return a.call({actionName:"pg_ViewPgActionqueryPgWorkDetail.do",reqData:{pg_work_seq:b}})},this.getAccessoryInfo=function(b){return a.call({actionName:"wk_ViewWorkActionqueryExtraInfo.do",reqData:{wrk_seq:b}})},this.getIndexTaskCount=function(){return a.call({actionName:"pj_CountProjectOrderTaskAction.do",reqData:{}})}}]),CommHttp.service("LogSrv",["$http","CallProvider","baseUrl","Modal","CV",function(a,b,c,d,e){this.lg_UpdateLogLabelAction=function(a,c){return b.call({actionName:"lg_UpdateLogLabelAction.do",reqData:{query_work_seq:a,log_label:c}})},this.getLogPageList=function(a){return b.call({actionName:"lg_PageLogByDateAndLabelAction.do",reqData:a})},this.downloadLog=function(a,c){return b.call({actionName:"lg_DownloadLogAction.do",reqData:{start_bk_date:a,end_bk_date:c}})}}]),CommHttp.service("BusiSys",["CallProvider","CV",function(a,b){this.getAllBusinessSys=function(c){return a.call({actionName:"bs_ViewBsActiongetListAllBs.do",reqData:{permission_flag:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getAllLogBysiness=function(){return a.call({actionName:"rz_ViewLogActionqueryLogSys.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})},this.pageBusiSysTbl=function(c){return a.call({actionName:"bs_PageBsSystemAction.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.getOneBusiSys=function(c){return a.call({actionName:"bs_ViewBsActiongetBsSystem.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c}})},this.saveOneBusiSys=function(c){return c.org_rs_code=b.rscode("new_busi_sys"),a.call({actionName:"bs_AddBsSystemAction.do",reqData:c})},this.updateOneBusiSys=function(c){return c.org_rs_code=b.rscode("busi_sys_list"),a.call({actionName:"bs_UpdateBsSystemAction.do",reqData:c})},this.deleteOneBusiSys=function(c){return a.call({actionName:"bs_DeleteBsSystemAction.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.projBusiSysTbl=function(c){return a.call({actionName:"pj_PageRelatedProjAction.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),start_recd:c.data.offset,limit_recd:c.data.limit,business_sys_name:c.business_sys_name,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.publishScheme=function(c,d){return a.call({actionName:"bs_PublishBsProgramAction.do",reqData:{prog_id:c,publish_state:d,org_rs_code:b.rscode("busi_sys_list")}})},this.deleteScheme=function(c){return a.call({actionName:"bs_DeleteBsProgramAction.do",reqData:{prog_id:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getSingleProgData=function(b){return a.call({actionName:"bs_ViewBsProgramActionqueryBsProgInfo.do",reqData:{prog_id:b}})},this.validateProgComplete=function(b){return a.call({actionName:"bs_CheckBsProgramAction.do",reqData:{prog_id:b}})},this.getSocListByIpAndBsys=function(c,d,e){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{business_sys_name:c,soc_ip:d,impl_type:e,org_rs_code:b.rscode("busi_sys_list")}})},this.ViewBsNodeConfigInfo=function(b,c){return a.call({actionName:"bs_ViewNodeActiongetNodeBySysNameAndNodeName.do",reqData:{node_name:c,business_sys_name:b}})},this.startCollectCmptDeploy=function(c,d,e,f){var g=f?"co_DeleteDeployModuleAction.do":"co_DeployModuleAction.do";return a.call({actionName:g,reqData:{business_sys_name:c,node_name:d,module_id:e,org_rs_code:b.rscode("busi_sys_list")},timeout:120})},this.cjGetAllDeployInfoBySysNameAndIp=function(c,d){return a.call({actionName:"co_ViewNodeModuleActiongetDeployMsgWithSysAndIp.do",reqData:{business_sys_name:c,soc_ip:d,org_rs_code:b.rscode("busi_sys_list")}})},this.getProgrammeList=function(c){return a.call({actionName:"bs_ViewPublishProgramAction.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getNodelist=function(c){return a.call({actionName:"bs_ViewNodeActiongetNodeMsg.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.viewSingleProgramInfo=function(b){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramInfo.do",reqData:{prog_id:b}})},this.getProgExportPath=function(b){return a.call({actionName:"bs_ExportProgramAction.do",reqData:{prog_id:b}})},this.addProgram=function(b,c){return a.call({actionName:"bs_AddProgramAction.do",reqData:{program:b,business_sys_name:c}})},this.updateProgram=function(b){return a.call({actionName:"bs_UpdateProgramAction.do",reqData:{program:b}})},this.getCombineParam=function(c,d){return a.call({actionName:"bs_ViewBsProgramActiongetCombineParam.do",reqData:{org_rs_code:b.rscode(""),program:c,business_sys_name:d}})},this.getAllProgramList=function(c,d,e){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramListInBsi.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c,publish_state:d,prog_type:e}})},this.getAllLogList=function(c,d){return a.call({actionName:"rz_GetLogListBySysName.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,inspect_flag:d}})},this.checkLogName=function(c,d){return a.call({actionName:"CheckLogNameValidAction.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d}})},this.judgeLogNameIsExist=function(c,d){return a.call({actionName:"rz_CheckLogNameValid.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name}})},this.judgePathIsExist=function(c,d,e){return a.call({actionName:"rz_CheckRemotePathExists.do",reqData:{org_rs_code:b.rscode(""),node_name:d,soc_name:c,log_file_path:e}})},this.saveLogBaseMessage=function(c,d){return a.call({actionName:"rz_SaveLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name,log_cn_name:c.log_cn_name,log_desc:c.log_desc,log_type:c.log_type,log_format_type:c.log_format_type,file_encoding:c.file_encoding,newline_type:c.newline_type,compress_mode:c.compress_mode,timestamp_exp:c.timestamp_exp,timestamp_format:c.timestamp_format,log_configs:c.log_configs,keywords:c.keywords,date_exp:c.date_exp,log_id:c.log_id}})},this.deleteLog=function(c,d,e){return a.call({actionName:"rz_DeleteLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.viewLogList=function(c,d,e,f){return a.call({actionName:"rz_GetLogFileList.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit,sys_name:d,log_name:e,log_id:f}})},this.viewLogReportViewList=function(c){return a.call({actionName:"rz_PageLogReport.do",reqData:{org_rs_code:b.rscode(""),offset:c.data.offset,size:c.data.limit}})},this.startTimePull=function(c,d,e){return a.call({actionName:"rz_StartTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.stopTimePlee=function(c,d,e){return a.call({actionName:"rz_StopTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.getLogUploadPath=function(c,d,e,f){return a.call({actionName:"rz_GetUploadPath.do",reqData:{org_rs_code:b.rscode(""),node_name:c,sys_name:d,file_date:e,log_id:f}})},this.saveLogUploadBase=function(c){return a.call({actionName:"rz_UploadLogFile.do",reqData:{org_rs_code:b.rscode(""),sys_name:c.sys_name,log_name:c.log_name,node_name:c.node_name,file_date:c.file_date,file_name:c.file_name,log_id:c.log_id,node_ip:c.node_ip}})},this.logUploadBaseDelete=function(c,d,e){return a.call({actionName:"rz_DeleteLogFileAction.do",reqData:{org_rs_code:b.rscode(""),id:c,local_file_name:d,local_dir:e}})},this.modifyAgent=function(c,d){return a.call({actionName:"bs_StartAndStopAgentAction.do",reqData:{org_rs_code:b.rscode(""),operate:c,ip:d.ip,node_name:d.node_name},timeout:600})},this.getAllAgentMsg=function(c){return a.call({actionName:"bs_GetAgentMonitorInfoAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getMessageBysocName=function(c){return a.call({actionName:"dt_QuerySocBySocNameAction.do",reqData:{org_rs_code:b.rscode(""),soc_name:c}})},this.getSocListBySocIpAndSys=function(c,d,e){return a.call({actionName:"bs_ViewDtSourceActiongetNodeSoc.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,impl_type:e,soc_ip:d}})},this.saveMonitorItemData=function(c,d,e){return a.call({actionName:"bs_ModifyBsNodeMonitorAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,monitor_item_list:e,soc_ip:d}})},this.viewMonitorItemData=function(c,d){return a.call({actionName:"bs_ViewNodeActionqueryNodeMonitor.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,soc_ip:d}})}}]),CommHttp.service("Sys",["CallProvider","CV",function(a,b){this.getSysInfo=function(c){return a.call({actionName:"bs_ViewBsActiongetBsSystem.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c}})},this.saveSysInfo=function(c){return c.org_rs_code=b.rscode("new_busi_sys"),a.call({actionName:"bs_AddBsSystemAction.do",reqData:c})},this.updateSysInfo=function(c){return c.org_rs_code=b.rscode("busi_sys_list"),a.call({actionName:"bs_UpdateBsSystemAction.do",reqData:c})},this.deleteSys=function(c){return a.call({actionName:"bs_DeleteBsSystemAction.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.pageSysTbl=function(c){return a.call({actionName:"bs_PageBsSystemAction.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.getNodelist=function(c){return a.call({actionName:"bs_ViewNodeActiongetNodeMsg.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.ViewSysNodeConfigInfo=function(b,c){return a.call({actionName:"bs_ViewNodeActiongetNodeBySysNameAndNodeName.do",reqData:{node_name:c,business_sys_name:b}})},this.viewMonitorItemData=function(c,d){return a.call({actionName:"bs_ViewNodeActionqueryNodeMonitor.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,soc_ip:d}})},this.saveMonitorItemData=function(c,d,e){return a.call({actionName:"bs_ModifyBsNodeMonitorAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,monitor_item_list:e,soc_ip:d}})},this.ViewBsNodeConfigInfo=function(b,c){return a.call({actionName:"bs_ViewNodeActiongetNodeBySysNameAndNodeName.do",reqData:{node_name:c,business_sys_name:b}})},this.getProgExportPath=function(b){return a.call({actionName:"bs_ExportProgramAction.do",reqData:{prog_id:b}})},this.viewSingleProgramInfo=function(b){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramInfo.do",reqData:{prog_id:b}})},this.getAllProgramList=function(c,d,e){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramListInBsi.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c,publish_state:d,prog_type:e}})},this.getCombineParam=function(c,d){return a.call({actionName:"bs_ViewBsProgramActiongetCombineParam.do",reqData:{org_rs_code:b.rscode(""),program:c,business_sys_name:d}})},this.updateProgram=function(b){return a.call({actionName:"bs_UpdateProgramAction.do",reqData:{program:b}})},this.addProgram=function(b,c){return a.call({actionName:"bs_AddProgramAction.do",reqData:{program:b,business_sys_name:c}})},this.deleteProgram=function(c){return a.call({actionName:"bs_DeleteBsProgramAction.do",reqData:{prog_id:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getAllLogList=function(c,d){return a.call({actionName:"rz_GetLogListBySysName.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,inspect_flag:d}})},this.startTimePull=function(c,d,e){return a.call({actionName:"rz_StartTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.stopTimePull=function(c,d,e){return a.call({actionName:"rz_StopTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.deleteLog=function(c,d,e){return a.call({actionName:"rz_DeleteLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.judgePathIsExist=function(c,d,e){return a.call({actionName:"rz_CheckRemotePathExists.do",reqData:{org_rs_code:b.rscode(""),node_name:d,soc_name:c,log_file_path:e}})},this.judgeLogNameIsExist=function(c,d){return a.call({actionName:"rz_CheckLogNameValid.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name}})},this.saveLogBaseMessage=function(c,d){return a.call({actionName:"rz_SaveLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name,log_cn_name:c.log_cn_name,log_desc:c.log_desc,log_type:c.log_type,log_format_type:c.log_format_type,file_encoding:c.file_encoding,newline_type:c.newline_type,compress_mode:c.compress_mode,timestamp_exp:c.timestamp_exp,timestamp_format:c.timestamp_format,log_configs:c.log_configs,keywords:c.keywords,date_exp:c.date_exp,log_id:c.log_id}})},this.getSocListByIpAndBsys=function(c,d,e){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{business_sys_name:c,soc_ip:d,impl_type:e,org_rs_code:b.rscode("busi_sys_list")}})},this.getAllAgentMsg=function(c){return a.call({actionName:"bs_GetAgentMonitorInfoAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.modifyAgent=function(c,d){return a.call({actionName:"bs_StartAndStopAgentAction.do",reqData:{org_rs_code:b.rscode(""),operate:c,ip:d.ip,node_name:d.node_name},timeout:600})},this.getLogicNodeAndPacParam=function(c){return a.call({actionName:"bs_ViewBsProgramActionqueryLogicNodeInfo.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getRemoteDirectory=function(c,d,e){return a.call({actionName:"bs_ShowRemoteDirectoryAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,logic_node_id:d,root_bk_dir:e}})}}]),CommHttp.service("NodeReform",["CallProvider","CV",function(a,b){this.queryProtocolAndSocNameByIp=function(c,d){return a.call({actionName:"dt_ViewDtActionqueryProtocolAndSocNameByIP.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),soc_ip:c,node_name:d}})},this.addBsNode=function(b){return a.call({actionName:"bs_AddBsNodeAction.do",reqData:b})},this.getNodeByBusi=function(c){return a.call({actionName:"bs_ViewBsActiongetNodeMsg.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c}})},this.getIpByNone=function(){return a.call({actionName:"dt_ViewDtActionqueryAllIp.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})},this.getIpWithProtocolAndSoc=function(b,c){return a.call({actionName:"bs_ViewDtSourceActionqueryNodeList.do",reqData:{business_sys_name:b,impl_type:c}})},this.updateBsNode=function(b){return a.call({actionName:"bs_UpdateBsNodeAction.do",reqData:b})},this.getNodeForUpdat=function(c){return a.call({actionName:"bs_ViewBsActiongetNodeForUpdate.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),node_name:c}})},this.addNode=function(c,d){return a.call({actionName:"bs_AddBsNodeIpAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,node_soc_ip:d}})},this.deleteNode=function(c,d){return a.call({actionName:"bs_DeleteBsNodeIpAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,node_soc_ip:d}})},this.configNodeType=function(c,d){return a.call({actionName:"bs_UpdateNodeTypeAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c,node_type:d}})},this.setDataSourceConfigInfo=function(c){return a.call({actionName:"bs_ModifyBsNodeSocAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c.node_name,soc_list:c.soc_list,ftp_config_soc:c.ftp_config_soc,shell_config_soc:c.shell_config_soc,exist_agent_yn_falg:c.exist_agent_yn_falg,agent_config_yn_falg:c.agent_config_yn_falg}})},this.getNodeBasicInfo=function(c){return a.call({actionName:"bs_ViewBsActiongetNodeBaseConfigMsg.do",reqData:{org_rs_code:b.rscode(""),node_name:c},timeout:300})},this.saveNodeBasicInfo=function(c,d){return a.call({actionName:"bs_AddBsNodeConfigAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c.node_name,business_sys_name:d,node_basic_msg:c.node_basic_msg}})},this.getAllRunEnvname=function(c){return a.call({actionName:"bs_ViewBsNodeActiongetAllRunEnvName.do",reqData:{org_rs_code:b.rscode("")}})},this.getLibraryListByRunEnv=function(c,d){return a.call({actionName:"bs_ViewRunEnvActionquerryLibByEnvAndType.do",reqData:{org_rs_code:b.rscode(""),library_type:c,env_type:d}})},this.getRouteUrlByNodeAndLib=function(c,d){return a.call({actionName:"bs_ViewRunEnvActiongetDefaultInstallDirectory.do",reqData:{org_rs_code:b.rscode(""),library_bk_name:c,node_name:d}})},this.deleteRunEnv=function(c,d){return a.call({actionName:"bs_DeleteRunEnvAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c,library_bk_name:d}})},this.deployOrDeletePlugin=function(b,c){var d=1==c?"bs_PluginUninstallAction.do":"bs_PluginInstallAction.do";return a.call({actionName:d,reqData:b,timeout:1800})},this.deployAgent=function(c,d){return a.call({actionName:"bs_DeployAgentAction.do",reqData:{org_rs_code:b.rscode(""),soc_name:c,node_name:d},timeout:300})}}]),CommHttp.service("DataSource",["CallProvider","CV",function(a,b){this.getVerDataSources=function(){return a.call({actionName:"dt_ViewDtActionqueryVersionSoc.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})},this.getAllDataSources=function(){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})}}]),CommHttp.service("Plugin",["CallProvider","CV",function(a,b){this.addPlugin=function(b){return a.call({actionName:"bs_ModifyEnvPluginAction.do",reqData:b})},this.getLiblistByEnvname=function(b){return a.call({actionName:"bs_ViewRunEnvActiongetEnvLibDetail.do",reqData:{library_bk_name:b}})},this.getLibUploadPath=function(){return a.call({actionName:"bs_ViewRunEnvActiongetLibUploadTempDir.do",reqData:{}})},this.deleteRunEnv=function(b){return a.call({actionName:"bs_DeleteEnvLibraryAction.do",reqData:{library_bk_name:b}})},this.getPluginList=function(b){return a.call({actionName:"bs_ViewRunEnvActiongetAllEnvLib.do",reqData:{}})},this.getAllPluginList=function(b){return a.call({actionName:"pl_ViewPluginActionqueryPlugin.do",reqData:{impl_type:b}})},this.addNewPlugin=function(b){return a.call({actionName:"pl_AddPluginAction.do",reqData:b})},this.updateNewPlugin=function(b){return a.call({actionName:"pl_UpdatePluginAction.do",reqData:b})},this.viewPluginInfo=function(b){return a.call({actionName:"pl_ViewPluginActiongetPlugin.do",reqData:{plugin_name:b}})},this.deleteSinglePlugin=function(b){return a.call({actionName:"pl_DeletePluginAction.do",reqData:{plugin_name:b},timeout:300})}}]),CommHttp.service("CommonResources",["CallProvider","CV",function(a,b){this.getAllResourcesList=function(){return a.call({actionName:"cm_ViewResourcesActionQueryResources.do",reqData:{}})},this.addResources=function(b){return a.call({actionName:"cm_AddResourcesAction.do",reqData:b})},this.updateResources=function(b){return a.call({actionName:"cm_UpdateResourcesAction.do",reqData:b})},this.viewResources=function(b){return a.call({actionName:"cm_ViewResourcesActionGetResources.do",reqData:{resources_name:b}})},this.deleteResources=function(b){return a.call({actionName:"cm_DeleteResourcesAction.do",reqData:{resources_name:b}})}}]),CommHttp.service("envManage",["CallProvider","CV",function(a,b){this.addEnv=function(b){return a.call({actionName:"en_AddLanguageEnvAction.do",reqData:b})},this.updateEnv=function(b){return a.call({actionName:"en_UpdateLanguageEnvAction.do",reqData:b})},this.deleteEnv=function(b){return a.call({actionName:"en_DeleteLanguageEnvAction.do",reqData:b})},this.getUploadPath=function(){return a.call({actionName:"cm_ViewCommonActiongetTempUploadDir.do",reqData:{}})},this.queryEnvList=function(b,c){return a.call({actionName:"en_ViewLanguageEnvActionqueryLanguageEnv.do",reqData:{language_name:b,language_version:c}})},this.selectLanguageVersionByName=function(b){return a.call({actionName:"en_ViewLanguageEnvActionqueryVersionByLanguage.do",reqData:{language_name:b}})},this.getPluginListInNode=function(b,c){return a.call({actionName:"bs_ViewNodeActionqueryNodePlugin.do",reqData:{server_id:b,soc_ip:c}})},this.exeDeployPlugin=function(b){return a.call({actionName:"bs_DeployPluginAction.do",reqData:b,timeout:1800})}}]),CommHttp.service("Cmpt",["CallProvider","CV",function(a,b){this.addModule=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"mo_AddComponentAction.do",reqData:{component:c}})},this.updateModule=function(c){return a.call({actionName:"mo_UpdateComponentAction.do",reqData:{org_rs_code:b.rscode(""),component:c}})},this.importModule=function(c){return a.call({actionName:"mo_ViewComponentActiongetImportComponentDetail.do",reqData:{org_rs_code:b.rscode(""),file_path:c}})},this.deleteModule=function(c){return a.call({actionName:"mo_DeleteComponentAction.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getCmptList=function(c){return a.call({actionName:"mo_ViewComponentActionqueryComponentList.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2"}})},this.getCmptPageList=function(c){return a.call({actionName:"mo_PageComponentAction.do",reqData:{org_rs_code:b.rscode(""),order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2",cn_name:c.cn_name,tag_list:c.tag_list,impl_types:c.impl_types,start_modify_date:c.start_modify_date,end_modify_date:c.end_modify_date,crt_user_id:c.crt_user_id,publish_state:c.publish_state,component_purpose:c.component_purpose,start_recd:c.data.offset,limit_recd:c.data.limit}})},this.viewModulegetModuleDetail=function(c){return a.call({actionName:"mo_ViewComponentActiongetComponentDetail.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getCmptFilePath=function(c){return a.call({actionName:"mo_ViewComponentActiongetUploadDirectory.do",reqData:{org_rs_code:b.rscode(""),type:c}})},this.publishCmpt=function(c,d){return a.call({actionName:"mo_PublishCompAction.do",reqData:{org_rs_code:b.rscode(""),id:c,type:d}})},this.uploadScriptFile=function(c){return a.call({actionName:"mo_ViewComponentActiongetFileContent.do",reqData:{org_rs_code:b.rscode(""),file_path:c}})},this.addCmptGroup=function(c){return a.call({actionName:"mo_AddComponentGroupAction.do",reqData:{org_rs_code:b.rscode(""),group:c}})},this.updateSingleCmptGroup=function(c){return a.call({actionName:"mo_UpdateComponentGroupAction.do",reqData:{org_rs_code:b.rscode(""),group:c}})},this.viewSingleCmptGroup=function(c){return a.call({actionName:"mo_ViewComponentActiongetGroupDetail.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getPublishedCmpt=function(c,d){return a.call({actionName:"mo_ViewComponentActionqueryPublishedCompByType.do",reqData:{org_rs_code:b.rscode(""),type:c,component_purpose:d}})},this.getAllUser=function(){return a.call({actionName:"mo_ViewComponentActionqueryAllCrtUser.do",reqData:{org_rs_code:b.rscode("")}})},this.deleteSingleCmptGroup=function(c){return a.call({actionName:"mo_DeleteComponentGroupAction.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getImportCmptGroupInfo=function(c){return a.call({actionName:"mo_ViewComponentActiongetImportGroupDetail.do",reqData:{org_rs_code:b.rscode(""),file_path:c}})},this.getCmptGroupList=function(c){return a.call({actionName:"mo_ViewComponentActionqueryGroupList.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2"}})},this.getCmptGroupDetail=function(c,d){return a.call({actionName:"mo_ViewComponentActiongetComponentListDetail.do",reqData:{org_rs_code:b.rscode(""),id_list:c,phase_flag:d}})},this.getCmptGroupsDetail=function(c){return a.call({actionName:"mo_ViewComponentActiongetGroupListDetail.do",reqData:{org_rs_code:b.rscode(""),id_list:c}})},this.getCombineParam=function(c,d){return a.call({actionName:"mo_ViewModuleActiongetCombineParam.do",reqData:{org_rs_code:b.rscode(""),groups:c,params:d}})},this.checkCmptGroupReference=function(c,d){return a.call({actionName:"mo_ViewModuleActioncheckModuleReference.do",reqData:{org_rs_code:b.rscode(""),id:c,type:d}})},this.savePublishProgram=function(c){return a.call({actionName:"bs_SavePublishProgramAction.do",reqData:{org_rs_code:b.rscode(""),prog_source:c.prog_source,business_sys_name:c.business_sys_name,prog_cn_name:c.prog_cn_name,prog_bk_desc:c.prog_bk_desc,pub_info:c.pub_info,rol_info:c.rol_info,package_types:c.package_types,prog_id:c.prog_id}})},this.getAllSocList=function(c,d){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{org_rs_code:b.rscode(""),soc_ip:c,impl_type:d}})},this.getPacakageDir=function(c){return a.call({actionName:"mo_ViewModuleActiongetTestPacakageDirectory.do",reqData:{org_rs_code:b.rscode(""),comp_type:c}})},this.getCmptTestInfo=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"mo_ComponentTestAction.do",reqData:{org_rs_code:b.rscode(""),phase:c.phase,params:c.param_list,id:c.id,deploy_soc:c.deploy_soc},timeout:3600})},this.monitorSubgroupTest=function(c){return a.call({actionName:"mo_ViewMonitorModuleActionmoitorModuleTestMsg.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.importProgram=function(c){return a.call({actionName:"bs_ImportProgramAction.do",reqData:{org_rs_code:b.rscode(""),file_name:c}})},this.selectAllTas=function(){return a.call({actionName:"mo_ViewComponentActionqueryAllCompnentTags.do",reqData:{org_rs_code:b.rscode("")}})},this.grammarBytype=function(c){return a.call({actionName:"mo_ViewComponentActionqueryGrammarHint.do",reqData:{org_rs_code:b.rscode(""),impl_type:c}})}}]),CommHttp.service("Server",["CallProvider","CV",function(a,b){this.addServer=function(b){return a.call({actionName:"se_AddServerAction.do",reqData:{server_bean:{server_ip:b}}})},this.getDataSource=function(b){return a.call({actionName:"se_ViewServerActionquerySocListByIP.do",reqData:{server_ip:b}})},this.getServerBasicInfo=function(b){return a.call({actionName:"se_ViewServerActiongetServerConfigMsg.do",reqData:{server_ip:b},timeout:600})},this.saveServerInfo=function(b,c){return a.call({actionName:"se_UpdateServerAction.do",reqData:{server_bean:{server_id:b.server_id,server_ip:b.server_ip,server_desc:b.server_desc,
agent_status:c},machine_basic_bean:b.machine_basic_bean}})},this.viewServerInfo=function(b){return a.call({actionName:"se_ViewServerActiongetServerDetail.do",reqData:{server_ip:b},timeout:600})},this.pageServerList=function(b){return a.call({actionName:"se_PageServerAction.do",reqData:{server_ip:b.server_ip,server_desc:b.server_desc,order_col_name:b.data.sort,order_type:"asc"===b.data.order?"1":"2",start_recd:b.data.offset,limit_recd:b.data.limit}})},this.deleteServer=function(b){return a.call({actionName:"se_DeleteServerAction.do",reqData:{server_ip:b}})},this.getUserList=function(b){return a.call({actionName:"se_ViewServerActionquerySocUserList.do",reqData:{server_ip:b}})},this.deployAgentBySoc=function(b,c){return a.call({actionName:"se_DeployAgentAction.do",reqData:{server_ip:b,server_user:c},timeout:3600})},this.uninstallAgentByIp=function(b){return a.call({actionName:"se_UnInstallAgentAction.do",reqData:{server_ip:b}})},this.getAllIpList=function(){return a.call({actionName:"mo_ViewModuleActiongetExeSocIpList.do",reqData:{}})},this.getDataSopcByImplType=function(b,c){return a.call({actionName:"mo_ViewModuleActiongetExeSocWithModule.do",reqData:{impl_types:c,server_ip:b}})},this.getPluginListInNode=function(b,c){return a.call({actionName:"pl_ViewPluginActionqueryDeployedPlugin.do",reqData:{server_id:b,server_ip:c}})},this.exeDeployPlugin=function(b){return a.call({actionName:"pl_DeployPluginAction.do",reqData:b,timeout:1800})},this.testFileTransform=function(b,c){return a.call({actionName:"se_ViewAgentActioncheckFileTransfer.do",reqData:{server_ip:b,server_user:c},timeout:3600})},this.testRunEnv=function(b){return a.call({actionName:"se_ViewAgentActioncheckAgentRunEnv.do",reqData:{soc_list:b},timeout:3600})},this.deployRunEnv=function(b,c,d,e){return a.call({actionName:"se_ViewAgentActiondeployAgentRunEnv.do",reqData:{soc_list:b,sys_type:c,sys_bit:d,agent_run_env_flag:e},timeout:3600})},this.deployAgent=function(b){return a.call({actionName:"se_ViewAgentActiondeployAgent.do",reqData:{soc_list:b},timeout:3600})},this.startAgent=function(b,c,d){return a.call({actionName:"se_ViewAgentActionstartAgent.do",reqData:{soc_list:b,deploy_path:c,agent_run_env_flag:d},timeout:3600})},this.testAgentPort=function(b){return a.call({actionName:"se_ViewAgentActioncheckAgentExist.do",reqData:{soc_list:b},timeout:3600})},this.getAllNodeList=function(b){return a.call({actionName:"bj_QueryAllServerMachineBasicMsgAction.do",reqData:{key_word:b}})},this.monitorNodeStatus=function(b){return a.call({actionName:"bj_MonitorServerMachineAction.do",reqData:{server_ip:b}})}}]),CommHttp.service("Struct",["CallProvider","CV",function(a,b){this.saveStructMsg=function(b){return a.call({actionName:"bs_AddStructureAction.do",reqData:{struct_bean:b}})},this.getStructMsg=function(b){return a.call({actionName:"bs_ViewBsActionngetStructureBySys.do",reqData:{sys_id:b}})},this.checkStructModify=function(b,c){return a.call({actionName:"bs_ViewStructActioncheckStructModify.do",reqData:{sys_id:b,struct_bean:c}})},this.getStructParamsByType=function(b,c){return a.call({actionName:"bs_ViewStructActionqueryNodeFixedParamList.do",reqData:{logical_node_type:b,sys_id:c}})}}]),CommHttp.service("EnvConfig",["CallProvider","CV",function(a,b){this.getEnvList=function(c){return a.call({actionName:"bs_ViewBsActionqueryEnvironmentListBySys.do",reqData:{org_rs_code:b.rscode(""),sys_id:c}})},this.publishEnv=function(c,d,e){return a.call({actionName:"bs_PublishEnvironmentAction.do",reqData:{org_rs_code:b.rscode(""),sys_id:c,env_id:d,pub_flag:e}})},this.deleteEnv=function(c,d){return a.call({actionName:"bs_DeleteEnvironmentAction.do",reqData:{org_rs_code:b.rscode(""),sys_id:c,env_id:d}})},this.addEnvMsg=function(c,d){return a.call({actionName:"bs_AddEnvironmentAction.do",reqData:{org_rs_code:b.rscode(""),env_bean:c,struct_node_list:d.nodeDataArray}})},this.getEnvMsg=function(c,d){return a.call({actionName:"bs_ViewBsActiongetEnvironmentCfg.do",reqData:{org_rs_code:b.rscode(""),env_id:c,sys_id:d}})},this.getLogicalParamListByEnvId=function(c,d){return a.call({actionName:"bs_ViewBsActionqueryOtherParamList.do",reqData:{org_rs_code:b.rscode(""),sys_id:d,logical_node_id:c}})},this.getAgentUserName=function(c){return a.call({actionName:"bs_ViewBsActionqueryAgentUsersByIP.do",reqData:{org_rs_code:b.rscode(""),server_ip:c}})},this.getFileAndExecSocList=function(c,d){return a.call({actionName:"bs_ViewBsActionqueryFileAndExecDtSocList.do",reqData:{org_rs_code:b.rscode(""),server_ip:c,logical_node_type:d}})},this.getAllServerIp=function(){return a.call({actionName:"se_ViewServerActionqueryServerList.do",reqData:{org_rs_code:b.rscode("")}})}}]);var CvService=angular.module("CvService",[]);CvService.service("CV",["$modal","$rootScope","$timeout","$window","$websocket","baseUrl",function(a,b,c,d,e,f){this.rscode=function(a){var c="00";if(b.rslist&&a)for(var d=0;d<b.rslist.length;d++){var e=b.rslist[d];if(e.rs_url==a){c=e.rs_code;break}}return c},this.dtFormat=function(a,b){if(!a||"string"==typeof a)return a;var c=b?b:"-",d=function(a,b){for(var c=a.toString(10),d=b-c.length;d-->0;)c="0"+c;return c};return a.getFullYear()+c+d(a.getMonth()+1,2)+c+d(a.getDate(),2)},this.dtFormatCn=function(a,b){if(!a||"string"==typeof a)return a;var c=function(a,b){for(var c=a.toString(10),d=b-c.length;d-->0;)c="0"+c;return c};return a.getFullYear()+"年"+c(a.getMonth()+1,2)+"月"+c(a.getDate(),2)+"日"},this.dttFormat=function(a){var b=function(a,b){for(var c=a.toString(10),d=b-c.length;d-->0;)c="0"+c;return c};return b(a.getHours(),2)+":"+b(a.getMinutes(),2)+":"+b(a.getSeconds(),2)},this.toDate=function(a){if(19!=a.length)return null;var b=new Date(Date.parse(a.replace(/-/g,"/")));return"Invalid Date"==b.toString()?null:b},this.dateCalculate=function(a,b,c){var d={dd:864e5,hh:36e5,mm:6e4,ss:1e3};if(!d[b])throw new Error("parameter [dimension] is illegal");if(!angular.isNumber(c))throw new Error("parameter [size] is illegal");var e=a.valueOf();return new Date(e+c*d[b])},this.dateCD=function(a,b){var c=a.getTime(),d=b.getTime(),e=d-c,f=864e5,g=36e5,h=6e4,i=1e3;if(0>=e)return null;var j=Math.floor(e/f);if(0==j){var k=Math.floor(e/g);if(0==k){var l=Math.floor(e/h);return 0==l?Math.floor(e/i)+"秒之后":l+"分钟后"}return k+"小时后"}return j+"天后"},this.usedCnTime=function(a){if(!a)return"";var b="",c=Math.floor(a/86400),d=Math.floor(a%86400/3600),e=Math.floor(a%3600/60),f=a%3600%60;return c>=1&&(b+=c+"天"),d>=1&&(b+=d+"小时"),0!=e&&(b+=e+"分钟"),0!=f&&(b+=f+"秒"),b},this.valiForm=function(a){var b,c=!0;for(b in a.$error){for(var d=a.$error[b],e=0;e<d.length;e++){var f=d[e];f.$invalid&&(f.$dirty=!0)}c=!1}return c},this.findValue=function(a,b){for(var c="",d=0;d<b.length;d++){var e=b[d];e.key==a&&(c=e.value)}return c},this.findKey=function(a,b){for(var c,d=0;d<b.length;d++){var e=b[d];e.value==a&&(c=e.key)}return c},this.downloadFile=function(a){var b=f+"filedownload?isdel=false&filename="+a;d.open(b,"_new")},this.jsonArrToStrArr=function(a,b){for(var c=new Array,d=0;d<a.length;d++)c[d]=new Array,c[d][0]=a[d][b[0]],c[d][1]=a[d][b[1]];return c},this.nullWord=function(){return new RegExp("[(\x00-)]+g","g")},this.nullReg=function(){return new RegExp("	","g")},this.isCanvasSupported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},this.dealBreadCrumbData=function(a,b,c){if(a.ncyBreadcrumb&&0==a.ncyBreadcrumb.floor)b=[];else if(a.ncyBreadcrumb){var d=!1,e=0,f={label:a.ncyBreadcrumb.label,stateName:a.name,params:c,replace_flag:a.ncyBreadcrumb.replace_flag,floor:a.ncyBreadcrumb.floor,menu_name:a.menu_name};1==a.ncyBreadcrumb.floor&&(b=[]);for(var g=0;g<b.length;g++)b[g].replace_flag&&(d=!0,e=1),b[g].label==a.ncyBreadcrumb.label&&(d=!0,e=g);d?b.splice(e,b.length-e,f):b.push(f)}return b},this.creatWebSocket=function(a){var b,c={readyState:0,lastestdata:"",collection:d,sendData:function(a){b.send(JSON.stringify(a))},closeForce:function(){b.reconnectIfNotNormalClose=!1,b.close(!0)}},d=[];return b=e(a),b.reconnectIfNotNormalClose=!0,b.onMessage(function(a){console.log(a),c.readyState=b.readyState,c.lastestdata=a.data,d.push(a.data)}),b.onError(function(a){console.log("连接出错"),c.readyState=b.readyState}),b.onOpen(function(a){console.log("连接成功"),c.readyState=b.readyState}),b.onClose(function(a){console.log("关闭成功"),c.readyState=b.readyState}),c}}]),CvService.provider("CallProvider",function(){this.$get=["$http","$q","baseUrl","CommData","Modal","CV",function(a,b,c,d,e,f){return{call:function(g){var h=b.defer(),i=angular.extend({},d,g.reqData,{org_srv_name:g.actionName.split(".")[0]});return a({method:"POST",url:c+g.actionName,data:i,timeout:1e3*(g.timeout?g.timeout:30),transformResponse:[function(a,b){if(a){if("rp_ViewInTaskActiongetReportJson.do"==g.actionName||"sl_ExportBatchSqlAction.do"==g.actionName||"sl_BatchExecuteSqlAction.do"==g.actionName||"sl_ViewSqlActionqueryBatchSql.do"==g.actionName||"mo_ViewModuleActiongetModuleDetail.do"==g.actionName||"in2_QueryReportDataAction.do"==g.actionName||"sc_ViewScriptActiongetListByOrderSeq.do"==g.actionName||"sc_UploadScriptFileAction.do"==g.actionName||"pj_MonitorLogMsgAction.do"==g.actionName||"tk_ViewSingleJobDetailAction.do"==g.actionName||"fw_SdFlowDetailViewAction.do"==g.actionName||"tk_ViewSdTaskDetailAction.do"==g.actionName){var c=a.replace(/\s+/g," ");return angular.fromJson(c)}if("sp_ReadConfigFileAction.do"==g.actionName||"pj_MonitorPjLogAction.do"==g.actionName){var d=a.replace(f.nullWord(),"");return angular.fromJson(d)}if("mo_ViewComponentActiongetComponentDetail.do"==g.actionName||"bs_ImportProgramAction.do"==g.actionName||"mo_ViewComponentActiongetImportGroupDetail.do"==g.actionName||"mo_ViewComponentActiongetGroupDetail.do"==g.actionName||"mo_ViewComponentActiongetImportComponentDetail.do"==g.actionName||"pj_ViewPjActionqueryPreparePacList.do"==g.actionName||"pj_ViewPjActionqueryPjPublishInfo.do"==g.actionName||"bs_ViewBsProgramActionqueryProgramInfo.do"==g.actionName||"mo_ViewComponentActiongetComponentListDetail.do"==g.actionName||"mo_ViewComponentActiongetGroupListDetail.do"==g.actionName||"sc_ViewScriptActiongetDetail.do"==g.actionName||"pj_ViewPrepareActiongetPrepareMsg.do"==g.actionName||"sp_ViewSystemPrepareActiongetRollBackMsg.do"==g.actionName||"sp_ViewMonitorActiongetConsole.do"==g.actionName||"sp_MonitorPhaseAction.do"==g.actionName||"rz_OnlineAnalyzePageLog.do"==g.actionName||"mo_ComponentTestAction.do"==g.actionName||"pj_ViewPjProgramActiongetProgramForPrepare.do"==g.actionName||"pj_ViewPjProgramActiongetOldPrepareInfo.do"==g.actionName||"sp_ViewSysPublishActiongetSysPubExeDetail.do"==g.actionName||"sp_ViewPjProgramActiongetProgramForPrepare.do"==g.actionName){var d=a.replace(f.nullReg(),"\\t");return angular.fromJson(d)}return a}}].concat(a.defaults.transformResponse)}).success(function(a,b,c,f){if(a){var g=a.sys_header;if("fail"==g.status)h.reject(g);else if("except"==g.status)h.reject({status:"system",message:"请求服务异常\r\n"+g.scode});else{var j=a.appdata,k=j.req_data?j.req_data:i;2==j.svdeal_type?e.localauth(j,k).then(function(a){h.resolve(a),d.org_srv_name=""},function(a){h.reject(a)}):3==j.svdeal_type?e.remoteauth(j,k).then(function(a){h.reject(a)},function(a){h.reject(a)}):4==j.svdeal_type?h.resolve(a):h.resolve(j)}}}).error(function(a,b,c,d){0==b?h.reject({status:"system",message:"服务请求超时!"}):h.reject({status:"system",message:"发生未知错误!"})}),h.promise}}}]}),CvService.factory("TabEventMouserEnter",["$timeout",function(a){var b;return function(){var c=$(this).children().eq(0).children(),d=$(this).parent().parent().siblings().find(".pp"),e=$(this);d.animate({right:"-222px"},200,function(){d.parent().siblings().children().each(function(){e.css("background",e.attr("name")%2==0?"#FFF":"#F6F7FC")})}),b&&a.cancel(b),b=a(function(){e.css("background","#5A72A3"),c.animate({right:"30px"},500)},200)}}]),CvService.factory("TabEventMouserLeave",["$timeout",function(a){var b;return function(){var c=$(this).children().eq(0).children(),d=$(this).children().eq(1).children();b&&a.cancel(b),b=a(function(){c.animate({right:"-222px"},200,function(){d.parent().siblings().children().each(function(){d.css("background",d.attr("name")%2==0?"#FFF":"#F6F7FC")})})},2)}}]),CvService.factory("Modal",["$modal","$timeout","baseUrl",function(a,b,c){var d={},e=function(a,b,d,e,f,g){return{templateUrl:c+"app/templates/modal/"+a,controller:b,size:d,backdrop:f?f:"static",keyboard:angular.isUndefined(g)?!0:g,resolve:e?e:{}}};return d.loading=function(b){return a.open(e("loading_modal.html","LoadingCtrl","md",{Message:function(){return b}}))},d.error=function(b){return a.open(e("alert_modal.html","AlertCtrl","sm",{Message:function(){return b},status:function(){return 0}})).result},d.alert=function(b,c){return a.open(e("alert_info_modal.html","AlertCtrl","sm",{Message:function(){return b},status:function(){return c||1}},!0)).result},d.success=function(b){return a.open(e("alert_modal.html","AlertCtrl","sm",{Message:function(){return b},status:function(){return 2}})).result},d.confirm=function(b){return a.open(e("confirm_modal.html","ConfirmCtrl","sm",{Message:function(){return b}})).result},d.localauth=function(b,c){return a.open(e("auth_local_modal.html","localAuthCtrl","md",{modalParam:function(){return{auth_data:b,srv_req_data:c}}})).result},d.remoteauth=function(b,c){return a.open(e("auth_remote_modal.html","remoteAuthCtrl","md",{modalParam:function(){return{auth_data:b,srv_req_data:c}}})).result},d.compare=function(b,d,e,f,g,h,i,j,k,l,m){return a.open({templateUrl:c+"app/templates/modal/compare_modal.html",controller:"CompareFileCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{modalParam:function(){return{busi_sys_id:b,sys_publish_id:d,node_name:e,file_path:f,check_soc_name:g,download_soc_name:h,download_soc_ip:i,is_edit:j,phase_type:k,phase_no:l,quick_publish:m}}}}).result},d.preLoading=function(b){return a.open(e("loading_modal.html","submitModalCtrl","md",{modalParam:function(){return{req_data:b}}})).result},d.rollbackSummary=function(b,c,d){return a.open(e("rollback_summary_modal.html","RollbackSummaryCtrl","md",{modalParam:function(){return{publish_id:b,busi_sys:c,rollback_flag:d}}})).result},d.summary=function(b,c){return a.open(e("proj_summary_modal.html","SummaryCtrl","md",{modalParam:function(){return{publish_id:b,busi_sys:c}}})).result},d.newGroup=function(){return a.open(e("plan_new_group_modal.html","planNewGroupCtrl","lg",{})).result},d.editGroup=function(b,c,d){return a.open(e("plan_edit_group_modal.html","planEditGroupCtrl","lg",{modalParam:function(){return{group_id:b,group_cn_name:c,group_date:d}}})).result},d.prodPreAddProdPac=function(b,c,d,f,g,h,i){return a.open(e("pre_add_package_modal.html","addPordPacModalCtrl","md",{modalParam:function(){return{propackage_bk_path:b,prolist_bk_path:d,fileupload_path:c,pac_index:f,pac_flag:g,is_prod_list:h,pre_info:i}}})).result},d.prodPreAddProdPacFromPlatform=function(b,c,d,f){return a.open(e("pre_add_platform_package.html","addPlatformPackageModalCtrl","md",{modalParam:function(){return{dir_names:b,pac_index:c,sys_publish_id:d,pre_info:f}}})).result},d.interactOperation=function(b,c,d){return a.open(e("interact_operation_modal.html","showHumanInteractCtrl","md",{modalParam:function(){return{execute_id:b,phaseId:c,steps:d}}})).result},d.chooseRollbackProg=function(b,c){return a.open(e("choose_rollback_prog_modal.html","chooseRollbackProgCtrl","lg",{modalParam:function(){return{business_sys_name:b,publish_id:c}}})).result},d.addMonitorModal=function(b,c,d,f){return a.open(e("add_monitor_log_modal.html","addMonitorLogCtrl","lg",{modalParam:function(){return{business_sys_name:b,project_name:c,environment_id:f,node:d}}})).result},d.configExeNode=function(b,c){return a.open(e("config_exe_node_modal.html","configExecNodeCtrl","md",{modalParam:function(){return{phase_info:b,quick_publish:c}}})).result},d.execResultChange=function(b){return a.open(e("exec_result_change_modal.html","changeExecResultCtrl","md",{modalParam:function(){return{node_info:b}}})).result},d.fileContentFullScreen=function(b,c,d){return a.open(e("file_fullscreen_detail_modal.html","viewfileFullScreenCtrl","lg",{modalParam:function(){return{file_info:b,file_post_header:c,business_sys_name:d}}})).result},d.setNormalWindow=function(){return a.open(e("set_normal_window.html","setNormalWindowTimeCtrl","lg",{})).result},d.setSpecialWindow=function(){return a.open(e("set_special_window.html","setSpecialWindowTimeCtrl","lg",{})).result},d.setBlackWindow=function(){return a.open(e("set_black_window.html","setBlackWindowTimeCtrl","lg",{})).result},d.viewWindowDetail=function(b){return a.open(e("view_window_detail.html","viewWindowDetailCtrl","md",{modalParam:function(){return{event:b}}})).result},d.closePubWindow=function(b){return a.open(e("pub_window_close_reason.html","closeWindowCtrl","md",{modalParam:function(){return{window:b}}})).result},d.prepareChoose=function(b,c){return a.open(e("prepare_choose_modal.html","prepareChooseCtrl","md",{modalParam:function(){return{syspublish_id:b,business_sys_name:c}}})).result},d.interactiveExecute=function(b,c){return a.open(e("interactive_execute_modal.html","interactiveExecuteCtrl","lg",{modalParam:function(){return{execute_id:b,phase_desc:c}}},!1,!1)).result},d.importProgram=function(){return a.open(e("import_new_program.html","importProgramCtrl","sm",{modalParam:function(){return{}}})).result},d.previewProgram=function(b){return a.open(e("scheme_preview.html","schemePreviewCtrl","lg",{modalParam:function(){return{programSeq:b}}})).result},d.importSqlInCreateProgram=function(b){return a.open(e("import_sql.html","importProgramSqlCtrl","lg",{modalParam:function(){return{handleData:b}}})).result},d.addSQL=function(b,c,d,f){return a.open(e("workorder_sqlhandle_addsql.html","workorderAddSQLModalCtrl","lg",{modalParam:function(){return{program_seq:b,db_list:c,sub_tab:d,flag:f}}})).result},d.showAddBatchSqlFile=function(b){return a.open(e("import_batch_sql_modal.html","importBatchSQLCtrl","lg",{modalParam:function(){return{sub_tab:b}}})).result},d.viewSqlDetailStep=function(b){return a.open(e("program_sqlDetailStep_modal.html","ProgramDetailSqlStepCtrl","lg",{modalParam:function(){return{sql_work_seq:b}}})).result},d.viewBatchSqlExecDetail=function(b){return a.open(e("wo_sqlhandle_view_exe_info.html","viewExeInfoCtrl","lg",{modalParam:function(){return{message:b}}})).result},d.viewScriptDetail=function(b,c,d){return a.open(e("view_exec_detail.html","viewScriptInfoCtrl","lg",{modalParam:function(){return{order_seq:b,deal_bk_seq:c,script_bk_seq:d}}})).result},d.viewBatchImportAuthorDetail=function(b){return a.open(e("wo_batch_import_author_detail_modal.html","viewTaskDetailCtrl","md",{modalParam:function(){return{task_id:b}}})).result},d.confirmSqlStatement=function(b,c){return a.open(e("program_confirm_sqlStatement_modal.html","ProgramConfirmSqlStatementCtrl","md",{modalParam:function(){return{sql_step:b,un_submit_sql_steps:c}}})).result},d.viewSqlDetail=function(b,c,d,f){return a.open(e("fault_program_detail_sql.html","faultProgramSqlDetailCtrl","lg",{modalParam:function(){return{program_seq:b,step_seq:c,sql_seq:d,sql_index:f}}})).result},d.viewWorkOrderFlow=function(b){return a.open(e("view_workorder_modal.html","viewWorkOrderFlowCtrl","md",{modalParam:function(){return{data:b}}})).result},d.pglocalauth=function(b,c){return a.open(e("pglocal_auth_modal.html","pgLocalauthCtrl","md",{modalParam:function(){return{data:b,srv_req:c}}})).result},d.pgremoteauth=function(b,c){return a.open(e("pgremote_auth_modal.html","pgRemoteauthCtrl","md",{modalParam:function(){return{data:b,srv_req:c}}})).result},d.faultPeakData=function(b){return a.open(e("peak_date_modal.html","faultPeakDateModalCtrl","lg",{modalParam:function(){return{time_work_seq:b}}})).result},d.faultTroubleType=function(b){return a.open(e("trouble_type_modal.html","faultTroubleTypeCtrl","md",{modalParam:function(){return{trouble_key:b}}})).result},d.workorderRollBack=function(b){return a.open(e("workorder_rollback.html","workOrderRollbackCtrl","md",{modalParam:function(){return{order_seq:b}}})).result},d.workOrderAppoint=function(b){return a.open(e("workorder_appoint_modal.html","workOrderAppointCtrl","md",{modalParam:function(){return{order_seq:b}}})).result},d.workOrderChange=function(b){return a.open(e("workorder_change_modal.html","workOrderChangeCtrl","md",{modalParam:function(){return{order_seq:b}}})).result},d.addCjCollectItem=function(b,c,d){return a.open(e("add_cj_items_modal.html","newCjProgramItemsModalCtrl","lg",{modalParam:function(){return{item:b,is_update:c,business_sys_name:d}}})).result},d.modifyCJProg=function(b,c,d,f){return a.open(e("cj_task_modal.html","cjTaskCtrl","lg",{modalParam:function(){return{module_index:b,modal_info:d,node_list:f,business_sys_name:c}}})).result},d.addTargetModel=function(b){return a.open(e("add_target_model.html","addTargetModelCtrl","md",{modalParam:function(){return{model_list:b}}})).result},d.modifyXJConfig=function(b,c){return a.open(e("xjtask_config_chart_modal.html","xjtaskConfigModalCtrl","lg",{modalParam:function(){return{model_info:b,model_list:c}}})).result},d.importAllStep=function(b){return a.open(e("import_program_step_modal.html","importProgramStepCtrl","sm",{modalParam:function(){return{modal_info:b}}})).result},d.viewTroubleTicketProgram=function(b){return a.open(e("trouble_ticket_task_detail_modal.html","viewTroubleTicketProgramCtrl","md",{modalParam:function(){return{task_id:b}}})).result},d.chooseHandleType=function(b){return a.open(e("pgchange_handletype_modal.html","pgChangeHandleTypeCtrl","md",{modalParam:function(){return{workId:b}}})).result},d.cmptDetail=function(b,c){return a.open(e("cmpt_detail_modal.html","viewCmptDetailModalCtrl","lg",{modalParam:function(){return{type:b,id:c}}})).result},d.addCmptLabel=function(b){return a.open(e("cmpt_classify_label_modal.html","CmptClassifyLabelCtrl","md",{modalParam:function(){return{data:b}}})).result},d.cmptEdit=function(b,c){return a.open(e("cmpt_edit_modal.html","addCmptModalCtrl","lg",{modalParam:function(){return{cmpt_type:b,cmpt_flag:c}}})).result},d.addCmptSysType=function(b){return a.open(e("cmpt_sys_type_modal.html","CmptSysCtrl","md",{modalParam:function(){return{data:b}}})).result},d.cmptGroupDetail=function(b){return a.open(e("cmpt_group_detail_modal.html","cmptGroupDetailModalCtrl","lg",{modalParam:function(){return{id:b}}})).result},d.cmptPhaseEdit=function(b,c,d,f,g,h,i,j,k){return a.open(e("phase_edit_modal.html","modifyPhaseCtrl","lg",{modalParam:function(){return{cn_name:b,impl_type:c,language_version:d,exec_script:f,plugin_list:g,ref_param_list:h,annex_file:i,is_update:j,command:k}}})).result},d.cmptGroupPhaseSoc=function(b,c,d,f,g){return a.open(e("cmpt_group_phase_soc_modal.html","cmptGroupPublishPhaseSocModalCtrl","lg",{modalParam:function(){return{step:b,flag:c,preStepSoc:d,package_list:f,testPreObj:g}}})).result},d.addPlanInSysConfig=function(b,c,d,f){return a.open(e("new_plan_modal.html","newPlanInSysConfigCtrl","lg",{modalParam:function(){return{business_sys_name:b,sys_ip_list:c,prog_id:d,node_ip_name_list:f}}})).result},d.viweSchemeDetail=function(b){return a.open(e("scheme_detail_modal.html","schemeDetailCtrl","lg",{modalParam:function(){return{prog_id:b}}})).result},d.addBusiSysNode=function(b,c,d){return a.open(e("add_node_modal.html","busiSysAddNodeModalCtrl","lg",{modalParam:function(){return{flag:b,business_sys_name:c,node_name:d}}})).result},d.addCollectModule=function(b,c){return a.open(e("add_collect_module_modal.html","addCollectCmptCtrl","md",{modalParam:function(){return{business_sys_name:b,cj_cmpt_list:c}}})).result},d.addPlugin=function(b,c){return a.open(e("add_plugin_modal.html","addPluginCtrl","md",{modalParam:function(){return{plugin_name:b,is_update:c}}})).result},d.addResource=function(b,c){return a.open(e("add_resource_modal.html","addResourceCtrl","md",{modalParam:function(){return{resources_name:b,is_update:c}}})).result},d.plusePlugin=function(b){return a.open(e("config_node_add_plugin.html","plusePluginCtrl","md",{modalParam:function(){return{plugin_list:b}}})).result},d.SrvPlusePlugin=function(b,c){return a.open(e("config_node_add_plugin.html","plusePluginCtrl","md",{modalParam:function(){return{plugin_list:b,user_info:c}}})).result},d.envPlugin=function(){return a.open(e("env_deploy_modal.html","envDeployCtrl","md",{modalParam:function(){return{}}})).result},d.uploadLogFile=function(b,c,d){return a.open(e("upload_logFile_modal.html","uploadLogFileCtrl","md",{modalParam:function(){return{sys_name:b,log_name:c,log_id:d}}})).result},d.deployAgent=function(b,c){return a.open(e("deploy_agent_modal.html","deployAgentCtrl","xl",{modalParam:function(){return{protocol_soc_list:b,node_name:c}}})).result},d.srvDeployAgent=function(b,c,d){return a.open(e("server_agent_deploy_modal.html","ServerAgentDeployCtrl","md",{modalParam:function(){return{server_ip:b,agent_status:c,user_info:d}}})).result},d.configVersionDir=function(b,c){return a.open(e("config_dir_modal.html","configDirCtrl","lg",{modalParam:function(){return{_flag:b,soc_version:c}}})).result},d.addCheckItem=function(b,c,d){return a.open(e("config_check_item_modal.html","configCheckItemCtrl","lg",{modalParam:function(){return{phase:d,user_info:b,soc_ip:c}}})).result},d.addCurPhase=function(b,c,d){return a.open(e("program_add_cur_modal.html","programCurConfigCtrl","md",{modalParam:function(){return{business_sys_name:b,logic_node_list:c,node_soc_list:d}}})).result},d.addManualPhase=function(b){return a.open(e("program_add_manual.html","programManualPhaseCtrl","md",{modalParam:function(){return{script:b}}})).result},d.programBacthConfig=function(b,c,d){return a.open(e("program_batch_config_modal.html","programBatchConfigCtrl","md",{modalParam:function(){return{group_list:b,business_sys_name:c,control:d}}})).result},d.configLogBase=function(b,c){return a.open(e("config_log_modal.html","configLogCtrl","lg",{modalParam:function(){return{sys_name:b,choose_ip_list:c}}})).result},d.configScreenBase=function(b){return a.open(e("config_log_screen_modal.html","configLogScreenCtrl","md",{modalParam:function(){return{log_screen:b}}})).result},d.reportLogChoose=function(b,c){return a.open(e("report_log_modal.html","reportLogChooseCtrl","lg",{modalParam:function(){return{report_choose:b,sys_name:c}}})).result},d.showPluginOrProtocolList=function(b,c,d){return a.open(e("view_plugin_protocol_modal.html","viewPluginProtocolCtrl","sm",{modalParam:function(){return{list:b,ip:c,flag:d}}})).result},d.initModifyPwd=function(b){return a.open(e("password_modify.html","InitModifyPwd","md",{modalParam:function(){return{userid:b}}})).result},d.jsonList=function(b,c,d,f){return a.open(e("json_list.html","JsonListCtrl","md",{modalParam:function(){return{data:b,url:c,aprov_type:d,task_seq:f}}})).result},d.xjInfoTips=function(b){return a.open(e("xj_message_tips.html","xjMessageTipsCtrl","sm",{modalParam:function(){return{data:b}}})).result},d.confDataCollection=function(b,c,d){return a.open(e("xj_data_gather.html","configDataCollectionCtrl","md",{modalParam:function(){return{data:b,task_id:c,indi_model_name:d}}})).result},d.dataGatherDetail=function(b,c){return a.open(e("xj_data_gather_detail.html","dataGatherDetailCtrl","md",{modalParam:function(){return{data:b,task_id:c}}})).result},d.viewFileDirList=function(b,c){return a.open(e("view_file_dir_list.html","ViewFileDirListCtrl","md",{modalParam:function(){return{content:b,init_path:c}}})).result},d.repeatFlowModal=function(b){return a.open(e("Repeat_flow_modal.html","RepeatFlowCtrl","md",{modalParam:function(){return{flow_id:b}}})).result},d.publishReasonModal=function(){return a.open(e("publish_reason_modal.html","FlowPubReasonCtrl","md",{modalParam:function(){return{}}})).result},d.configFlowTime=function(b){return a.open(e("flow_time_config.html","configFlowTimeCtrl","lg",{modalParam:function(){return{data:b}}})).result},d.configFlowTimeCondition=function(b){return a.open(e("flow_set_timecondition_modal.html","configFlowTimeConditionCtrl","sm",{modalParam:function(){return{data:b}}})).result},d.setFlowJobMethod=function(b,c,d,f){return a.open(e("flow_set_jobmethod_modal.html","configFlowJobMethodCtrl","lg",{modalParam:function(){return{job_type:b,job_data:c,is_detail:d,is_special_element:f}}})).result},d.selectFlowRefNode=function(b,c){return a.open(e("flow_select_ref_node_modal.html","configRefNodeCtrl","md",{modalParam:function(){return{source_list:b,ref_node_list:c}}})).result},d.addScene=function(b){return a.open(e("flow_add_scene_modal.html","addSceneCtrl","md",{modalParam:function(){return{scene_list:b}}})).result},d.convertPrivateEle=function(b){return a.open(e("flow_add_private_ele_modal.html","addPrivateElementCtrl","md",{modalParam:function(){return{element:b}}})).result},d.viewSingleWorkInfo=function(b,c,d,f,g){return a.open(e("dtask_view_single_job_modal.html","viewSingleWorkCtrl","md",{modalParam:function(){return{task_id:b,flow_job_list:c,job:d,task_status:f,is_detail:g}}})).result},d.viewTaskProgressInfo=function(){return a.open(e("dtask_progress_modal.html","viewTaskProgressInfoCtrl","md",{modalParam:function(){return{}}})).result},d.addSkipWorkParams=function(b){return a.open(e("add_skipwork_param_modal.html","addSkipWorkParamsCtrl","md",{modalParam:function(){return{output_param:b}}})).result},d.inputStartJobParams=function(b){return a.open(e("input_startjob_param_modal.html","inputStartJobParamsCtrl","md",{modalParam:function(){return{input_param:b}}})).result},d.completeJob=function(b,c){return a.open(e("complete_job_modal.html","completeJobCtrl","md",{modalParam:function(){return{task_id:b,job_id_list:c}}})).result},d.configDataSource=function(b,c,d,f){return a.open(e("config_data_source.html","configDataSourceCtrl","md",{modalParam:function(){return{dataSource_type:b,business_sys_name:c,srv_soc:d,flag:f}}})).result},d.chooseNodes=function(b){return a.open(e("ywtask_choose_nodes.html","ywtaskChooseNodeCtrl","lg",{modalParam:function(){return{node_list:b}}})).result},d.addSceneElement=function(b,c){return a.open(e("add_scene_element_modal.html","addSceneElementCtrl","md",{modalParam:function(){return{scene_info:b,is_update:c}}})).result},d.newStrategyGroup=function(){return a.open(e("add_strategy_group_modal.html","newStrategyGroupCtrl","md",{modalParam:function(){return{}}})).result},d.viewPhaseSoc=function(b){return a.open(e("node_soc_detail_modal.html","nodeSocDetailCtrl","md",{modalParam:function(){return{data:b}}})).result},d.releaseAddProject=function(b){return a.open(e("release_add_project_modal.html","releaseAppAddProjectCtrl","md",{modalParam:function(){return{data:b}}})).result},d}]),CvService.factory("Params",function(){var a={};return a.setParams=function(b){a=angular.extend(a,b)},a.getParams=function(){return a},a.init=function(){a={}},a});var GlobalData=angular.module("GlobalData",[]);GlobalData.factory("CommData",function(){return{org_user_id:"",org_dept_id:"",org_term_no:"",org_channel_code:"01",org_work_code:"",org_srv_name:"",org_rs_code:"00",submit_type:1,orguser_cn_name:"",orgdept_cn_name:""}}),GlobalData.factory("ProjType",function(){return["例行发布","紧急发布","一般项目发布","大型项目发布","特大型项目发布"]}),GlobalData.factory("ProjectStatus",function(){return[{key:1,value:"已登记"},{key:2,value:"待发布"},{key:3,value:"未审核"},{key:4,value:"发布中"},{key:5,value:"发布异常"},{key:6,value:"正常结束"},{key:7,value:"异常结束"},{key:8,value:"已挂起"},{key:9,value:"已关闭"}]}),GlobalData.factory("ProjectReleaseType",function(){return[{key:1,value:"例行发布"},{key:2,value:"紧急发布"},{key:3,value:"补充发布 "}]}),GlobalData.factory("jdkVersion",function(){return["1.5","1.6","1.7","1.8"]}),GlobalData.factory("ProjectNature",function(){return[{key:1,value:"例行发布"},{key:2,value:"紧急发布"},{key:3,value:"一般项目发布"},{key:4,value:"大型项目发布"},{key:5,value:"特大型项目发布"}]}),GlobalData.factory("ProjState",function(){return[{key:1,value:"待准备"},{key:2,value:"待执行"},{key:3,value:"执行中"},{key:4,value:"自动结束"},{key:5,value:"手动结束"},{key:6,value:"回退中"},{key:7,value:"回退成功"},{key:8,value:"回退失败"},{key:9,value:"待回退"}]}),GlobalData.factory("ProdFlag",function(){
return[{key:1,value:"成功"},{key:2,value:"失败"}]}),GlobalData.factory("ProdNodeState",function(){return[{key:1,value:"未执行"},{key:2,value:"正在执行"},{key:3,value:"执行失败"},{key:4,value:"执行成功"},{key:5,value:"执行跳过"}]}),GlobalData.factory("ProdCmdState",function(){return[{key:1,value:"未执行"},{key:2,value:"正在执行"},{key:3,value:"执行报错"},{key:4,value:"验证失败"},{key:5,value:"执行成功"},{key:6,value:"执行跳过"},{key:7,value:"执行终止"},{key:8,value:"手动成功"}]}),GlobalData.factory("ProjGroupColor",function(){return["#920783","#8fc31f","#956134","#e4007f","#006934","#0b318f"]}),GlobalData.factory("IssueType",function(){return[{key:1,value:"业务需求问题"},{key:2,value:"发布包错误"},{key:3,value:"代码问题"},{key:4,value:"夹带发布"},{key:5,value:"环境配置错误"},{key:6,value:"发布问题"},{key:7,value:"其他问题"}]}),GlobalData.factory("pathType",function(){return[{key:1,value:"本地"},{key:2,value:"版本机"}]}),GlobalData.factory("EncodingType",function(){return["UTF-8","GBK"]}),GlobalData.factory("ScriptDayNight",function(){return["日间","夜间"]}),GlobalData.factory("ReleaseFileType",function(){return[{key:1,value:"txt"},{key:2,value:"xlsx"},{key:3,value:"xls"},{key:4,value:"bat"},{key:5,value:"sh"},{key:6,value:"xml"},{key:7,value:"html"},{key:8,value:"properties"},{key:9,value:"tar"},{key:10,value:"zip"},{key:11,value:"rar"},{key:12,value:"gz"},{key:13,value:"jar"},{key:14,value:"sql"},{key:15,value:"py"},{key:16,value:"java"},{key:17,value:"js"}]}),GlobalData.factory("TaskState",function(){return[{key:1,value:"待授权"},{key:2,value:"授权拒绝"},{key:3,value:"待执行"},{key:4,value:"执行完毕"},{key:5,value:"关闭任务"}]}),GlobalData.factory("WorkorderType",function(){return[{key:1,value:"故障单"},{key:2,value:"常规维护"}]}),GlobalData.factory("WoFlowType",function(){return[{key:1,value:"创建工单"},{key:2,value:"指派工单"},{key:3,value:"退回工单"},{key:4,value:"处理工单"},{key:5,value:"关闭工单"},{key:6,value:"重启工单"}]}),GlobalData.factory("WoStatusType",function(){return[{key:1,value:"待处理"},{key:2,value:"被退回"},{key:3,value:"处理中"},{key:4,value:"已处理"},{key:5,value:"正常关闭"},{key:6,value:"异常关闭"}]}),GlobalData.factory("WoCloseType",function(){return[{key:1,value:"处理完毕"},{key:2,value:"问题重复"},{key:3,value:"已解决"},{key:4,value:"超时自动关闭"},{key:5,value:"无法处理"}]}),GlobalData.factory("WoRestartType",function(){return[{key:1,value:"问题未解决"}]}),GlobalData.factory("SqlType",function(){return[{key:1,value:"select(查询)"},{key:2,value:"update(更新)"},{key:3,value:"insert(插入)"},{key:4,value:"delete(删除)"}]}),GlobalData.factory("transactionType",function(){return[{key:1,value:"整体事务"},{key:2,value:"独立事务"}]}),GlobalData.factory("SparamType",function(){return[{key:1,value:"输入文本"},{key:2,value:"单选框"},{key:3,value:"复选框"},{key:4,value:"下拉框"},{key:5,value:"固定值"}]}),GlobalData.factory("SparamAuthType",function(){return[{key:1,value:"本地授权"},{key:2,value:"远程授权"}]}),GlobalData.factory("BucketType",function(){return[{key:1,value:"非高峰期"},{key:2,value:"高峰期"}]}),GlobalData.factory("WorkDayType",function(){return[{key:1,value:"普通工作日"},{key:2,value:"普通周末"},{key:3,value:"调休工作日"},{key:4,value:"节假日"}]}),GlobalData.factory("InstanceType",function(){return[{key:1,value:"源数据集"},{key:2,value:"分析数据集"},{key:3,value:"表格"},{key:4,value:"折线图"},{key:5,value:"条形图"},{key:6,value:"柱形图"},{key:7,value:"饼图"},{key:8,value:"全局变量"},{key:9,value:"SQL"},{key:10,value:"Java"}]}),GlobalData.factory("FieldType",function(){return[{key:1,value:"CHAR"},{key:2,value:"VARCHAR"},{key:3,value:"INT"},{key:4,value:"DOUBLE"}]}),GlobalData.factory("intaskState",function(){return[{key:1,value:"待导入"},{key:2,value:"导入中"},{key:3,value:"执行中"},{key:4,value:"生成中"},{key:5,value:"已完成"}]}),GlobalData.factory("coTaskState",function(){return[{key:1,value:"待执行"},{key:2,value:"执行中"},{key:3,value:"执行成功"},{key:4,value:"执行失败"},{key:5,value:"已暂停"},{key:6,value:"已关闭"}]}),GlobalData.factory("FileType",function(){return[{key:1,value:"SQL"},{key:2,value:"JSON"},{key:3,value:"CSV"},{key:4,value:"OTHER"}]}),GlobalData.factory("ApplicateType",function(){return[{key:1,value:"执行"},{key:2,value:"文件"},{key:3,value:"校验"}]}),GlobalData.factory("PublishState",function(){return[{key:1,value:"已发布"},{key:2,value:"未发布"}]}),GlobalData.factory("AdaptState",function(){return[{key:1,value:"Linux"},{key:2,value:"AIX"},{key:3,value:"AS400"},{key:4,value:"MySql"},{key:5,value:"DB2"},{key:6,value:"ORACLE"}]}),GlobalData.factory("CodeMirrorOption",function(){var a={},b={lineWrapping:!0,lineNumbers:!0,scrollbarStyle:"overlay",theme:"midnight"};a.Sh=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-sh"})},a.Sql=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-sql"})},a.Properties=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-properties"})},a.Python=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-python"})},a.Java=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-java"})},a.Vbs=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/vbscript"})},a.dayOrNight=function(a){a?a.theme="midnight"==a.theme?"default":"midnight":c.setOption("theme","default"===c.getOption("theme")?"midnight":"default")},a.getRangeByKey=function(a,b,c,d){var e=[];return a.setOption("readOnly",b),a.setOption("lineWrapping",!1),a.setOption("lineNumbers",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("theme","midnight"),a.setOption("mode","text/x-properties"),e},a.setEditor=function(a,b,c){return a.setOption("firstLineNumber",1),a.setOption("lineWrapping",!0),a.setOption("lineNumbers",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("theme","midnight"),a.setOption("mode",4==b?"text/x-sql":2==b?"text/x-python":3==b?"text/x-java":"text/x-sh"),a.on("keypress",function(){c&&c.length>0?a.showHint({pluginKeys:c}):a.showHint()}),a},a.setParamsEditor=function(a){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","26px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){a.showHint({systemKeys:[{key:"${project_name}",text:"${project_name} [项目名]"},{key:"${update_local_dir}",text:"${update_local_dir} [本地上传路径]"},{key:"${script_file}",text:"${script_file} [脚本文件]"},{key:"${script_str}",text:"${script_str} [脚本字符]"}]})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.setUniqueParamsEditor=function(a){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","26px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){a.showHint({systemKeys:[{key:"${script_file}",text:"${script_file} [脚本文件]"},{key:"${script_str}",text:"${script_str} [脚本字符]"}]})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.setNoneParamsEditor=function(a){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","26px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.showParamsEditor=function(a,b){return a.setOption("lineWrapping",!0),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","80px"),a.setOption("mode","text/x-ini"),a.setOption("theme","midnight"),0!=b.data.key_word_list.length&&a.on("keypress",function(){a.showHint({systemKeys:b.data.key_word_list})}),a.setOption("extraKeys",{Enter:function(){b.sendCmdMsg(),b.$apply()}}),a},a.getDynamicParams=function(a,b){return a.setOption("firstLineNumber",1),a.setOption("lineWrapping",!0),a.setOption("lineNumbers",!0),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){b&&b.length>0&&a.showHint({systemKeys:b})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.getDynamicRefParams=function(a,b){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",null),a.setSize("height","34px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){b&&b.length>0&&a.showHint({systemKeys:b})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a};var c,d=[],e=function(a,b){var c=function(a,b){for(var c=!1,e=0;e<d.length;e++)d[e].line_id===b&&(c=!0);c||d.push({line_id:b,line_ch:a.getLine(b)})};if(b.from.line===b.to.line)c(a,b.from.line);else for(var e=b.from.line;e<=b.to.line;e++)c(a,e)},f=function(a){for(var b=-1,c=0;c<d.length;c++)d[c].line_id===a&&(b=c);return-1===b?"":d[b].line_ch},g=function(a){for(var b=0;b<a.length;b++)a[b].clear()};return a.setFileEditor=function(a,b){d=[],a.setOption("lineNumbers",!0),a.setOption("styleSelectedText",!0),a.setOption("mode","text/x-properties"),a.setOption("styleActiveLine",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("keyMap","vim"),a.setOption("theme","midnight"),a.setOption("extraKeys",{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},"Ctrl-F":"findPersistent","Cmd-F":"findPersistent","Ctrl-H":"replace","Cmd-H":"replace","Ctrl-G":"jumpToLine","Cmd-G":"jumpToLine"}),a.on("beforeChange",function(a,b){a.getLine(b.from.line)&&e(a,b)}),a.on("change",function(b,c){if(0===c.from.line&&0===c.from.ch)return!1;if(c.from.line===c.to.line){var d=f(c.from.line),e=b.getLine(c.from.line);e!==d&&""!==e?a.markText({line:c.from.line,ch:0},{line:c.from.line,ch:e.length},{className:"selected-background"}):e===d&&g(a.findMarks({line:c.from.line,ch:0},{line:c.from.line,ch:e.length}))}}),c=a},a.setFileCompareBg=function(a,b){return a.setOption("readOnly",!0),a.setOption("firstLineNumber",1),a.setOption("lineWrapping",!0),a.setOption("lineNumbers",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("mode","text/x-filecompare"),a.setOption("theme","midnight"),a.setSize("height","500px"),a.setOption("viewportMargin",10),a},a.setSqlFileEditor=function(a){d=[],a.setOption("lineNumbers",!0),a.setOption("lineWrapping",!0),a.setOption("styleSelectedText",!0),a.setOption("mode","text/x-sql"),a.setOption("styleActiveLine",!1),a.setOption("scrollbarStyle","overlay"),a.setOption("theme","midnight"),a.on("beforeChange",function(a,b){a.getLine(b.from.line)&&e(a,b)}),a.on("change",function(b,c){if(0===c.from.line&&0===c.from.ch)return!1;if(c.from.line===c.to.line){var d=f(c.from.line),e=b.getLine(c.from.line);e!==d&&""!==e?a.markText({line:c.from.line,ch:0},{line:c.from.line,ch:e.length},{className:"update-background"}):e===d&&g(a.findMarks({line:c.from.line,ch:0},{line:c.from.line,ch:e.length}))}}),c=a},a}),GlobalData.factory("IML_TYPE",function(){return[{key:1,value:"FTP"},{key:2,value:"SHELL"},{key:3,value:"WAS"},{key:4,value:"SVN"},{key:5,value:"WEBLOGIC"},{key:6,value:"SQL"},{key:7,value:"PYTHON2"},{key:8,value:"PYTHON3"},{key:14,value:"JAVA"},{key:15,value:"C/C++"},{key:16,value:"AUTOIT"},{key:18,value:"AS400_CL"},{key:19,value:"AS400_BGM"},{key:17,value:"自定义"}]}),GlobalData.factory("CmptType",function(){return[{key:1,value:"应用发布"},{key:2,value:"日志巡检"},{key:3,value:"作业调度"},{key:4,value:"故障维护"},{key:5,value:"发布验证"}]}),GlobalData.factory("CmptSysType",function(){return[{key:1,value:"linux"},{key:2,value:"aix"}]}),GlobalData.factory("OperateSys",function(){return[{key:1,value:"linux"},{key:2,value:"windows"},{key:3,value:"ios"},{key:4,value:"未知"},{key:5,value:"aix"},{key:6,value:"hp-ux"},{key:7,value:"freebsd"},{key:8,value:"sco"},{key:9,value:"`"}]}),GlobalData.factory("ParamType",function(){return[{key:1,value:"项目参数"},{key:2,value:"发布包参数"}]}),GlobalData.factory("ProtocolType",function(){return[{key:1,value:"JDBC"},{key:2,value:"PLT_FTP"},{key:3,value:"AS400_FTP"},{key:4,value:"SCP_FTP"},{key:5,value:"SSH"},{key:6,value:"AS400_PGM"},{key:7,value:"AS400_CL"},{key:8,value:"ESB"},{key:9,value:"SFTP"},{key:10,value:"TELNET"},{key:11,value:"WAS"},{key:12,value:"WEBLOGIC"},{key:13,value:"SVN"},{key:14,value:"HTTP"},{key:15,value:"AGENT"},{key:16,value:"FIREFLY"},{key:17,value:"CLEARCASE"}]}),GlobalData.factory("NodeType",function(){return[{key:1,value:"数据库"},{key:2,value:"Web"},{key:3,value:"App"},{key:4,value:"版本"}]}),GlobalData.factory("ProgType",function(){return[{key:1,value:"发布方案"},{key:2,value:"回退方案"}]}),GlobalData.factory("LogType",function(){return[{key:1,value:"系统日志"},{key:2,value:"应用服务器日志"},{key:3,value:"中间件日志"},{key:4,value:"业务日志"},{key:0,value:"其他"}]}),GlobalData.factory("LogFormat",function(){return[{key:1,value:"TXT"},{key:2,value:"XML"},{key:3,value:"CSV"},{key:4,value:"JSON"},{key:5,value:"其他"}]}),GlobalData.factory("logCharacterEncod",function(){return[{key:"UTF-8",value:"UTF-8"},{key:"GBK",value:"GBK"},{key:"EBCDIC",value:"EBCDIC"}]}),GlobalData.factory("logWrapStyle",function(){return[{key:1,value:"\\n"},{key:2,value:"\\r\\n"},{key:3,value:"\\r"}]}),GlobalData.factory("logTimeStampType",function(){return[{key:1,value:"HH:mm:ss"},{key:2,value:"HHmmss"}]}),GlobalData.factory("newLogDateStampType",function(){return[{key:"\\d{4}[-]\\d{2}[-]\\d{2}",value:"yyyy-mm-dd(适合2017-11-09)"},{key:"\\d{4}[.]\\d{2}[.]\\d{2}",value:"yyyy.mm.dd(适合2017.11.09)"},{key:"\\d{2}[.]\\d{2}[.]\\d{2}",value:"yy.mm.dd(适合17.11.09)"},{key:"\\d{2}\\d{2}\\d{2}",value:"yymmdd(适合170911，171109等)"},{key:"\\d{4}\\d{2}\\d{2}",value:"yyyymmdd(适合20170911，20171109等)"}]}),GlobalData.factory("newLogTimeStampType",function(){return[{key:"[0-2][0-9][-][0-5][0-9][-][0-5][0-9]",value:"hh-mm-ss(适合12-20-30)，支持-分割"},{key:"[0-2][0-9][:][0-5][0-9][:][0-5][0-9]",value:"hh:mm:ss(适合12:20:30, 支持:分割)"},{key:"[0-2][0-9][:][0-5][0-9][:][0-5][0-9][.][1-9]{3}",value:"hh:mm:ss.SSS(适合12:20:30.222)"},{key:"[0-2][0-9][-][0-5][0-9][-][0-5][0-9][.][1-9]{3}",value:"hh-mm-ss.SSS(适合12-20-30.222)"},{key:"[0-2][0-9][0-5][0-9][0-5][0-9]",value:"hhmmss(适合122030)"},{key:"[0-2][0-9][0-5][0-9][0-5][0-9][.][1-9]{3}",value:"hhmmss.SSS(适合122030.123)"}]}),GlobalData.factory("ReportTemplateDateType",function(){return[{key:0,value:"日"},{key:1,value:"周"},{key:2,value:"月"}]}),GlobalData.factory("uploadType",function(){return[{key:1,value:"拉取"},{key:2,value:"本地上传"}]}),GlobalData.factory("logDateFormat",function(){return[{key:"YYYY-MM-DD",value:"YYYY-MM-DD"},{key:"YYYY/MM/DD",value:"YYYY/MM/DD"},{key:"yyyy-MM-dd",value:"yyyy-MM-dd"}]}),GlobalData.factory("logTimeFormat",function(){return[{key:"hh:mm:ss",value:"hh:mm:ss"},{key:"hh-mm-ss",value:"hh-mm-ss"}]}),GlobalData.factory("EnvType",function(){return[{key:1,value:"开发"},{key:2,value:"测试"},{key:3,value:"准生产"},{key:4,value:"生产"},{key:5,value:"SIT"},{key:6,value:"SAT"}]}),GlobalData.factory("LanguageName",function(){return[{key:14,value:"Java"},{key:7,value:"Python2"},{key:8,value:"Python3"}]}),GlobalData.factory("pluginExeEnv",function(){return[{key:1,value:"Linux"},{key:2,value:"Aix"},{key:3,value:"AS400"},{key:4,value:"HP-UX"},{key:5,value:"Windows"}]}),GlobalData.factory("operateSysBit",function(){return[{key:1,value:"不限"},{key:2,value:"32位"},{key:3,value:"64位"}]}),GlobalData.factory("pluginLibType",function(){return[{key:1,value:"PYTHON2"},{key:2,value:"PYTHON3"},{key:3,value:"EXE"},{key:4,value:"DLL"},{key:5,value:"SO"}]}),GlobalData.factory("pluginType",function(){return[{key:1,value:"dll"},{key:2,value:"so"},{key:3,value:"jar"},{key:4,value:"py"},{key:5,value:"bat"},{key:6,value:"vbs"},{key:7,value:"sh"},{key:8,value:"exe"}]}),GlobalData.factory("FlowType",function(){return[{key:1,value:"操作系统",flag:!1},{key:2,value:"文件存储",flag:!1},{key:3,value:"服务中间件",flag:!1},{key:4,value:"消息中间件",flag:!1},{key:5,value:"数据库",flag:!1},{key:6,value:"容器",flag:!1},{key:7,value:"应用系统",flag:!1},{key:8,value:"通用",flag:!1}]}),GlobalData.factory("AutoFlowOpType",function(){return[{key:1,value:"上传文件"},{key:2,value:"下传文件"},{key:3,value:"数据操作"},{key:4,value:"基础操作"},{key:5,value:"应用操作"},{key:6,value:"其他操作"}]}),GlobalData.factory("OpTaskStatus",function(){return[{key:1,value:"待执行"},{key:2,value:"执行中"},{key:3,value:"正常结束"},{key:4,value:"终止"},{key:5,value:"异常"}]}),GlobalData.factory("ExecuteType",function(){return[{key:1,value:"手动"},{key:2,value:"自动"}]}),GlobalData.factory("TaskType",function(){return[{key:1,value:"操作系统"},{key:2,value:"中间件"},{key:3,value:"数据库"}]}),GlobalData.factory("JobErrorType",function(){return[{key:1,value:"等待"},{key:2,value:"跳过"},{key:3,value:"重试"}]}),GlobalData.factory("PreJobErrorType",function(){return[{key:1,value:"跳过执行"},{key:2,value:"跳过等待"}]}),GlobalData.factory("dataBaseType",function(){return[{key:1,value:"Mysql"},{key:2,value:"DB2"},{key:3,value:"Oracle"},{key:4,value:"Sybase"},{key:5,value:"Informix"}]}),GlobalData.factory("FlowJobType",function(){return[{key:1,value:"开始"},{key:2,value:"结束"},{key:3,value:"作业分组"},{key:4,value:"条件"},{key:5,value:"中断"},{key:6,value:"轮询"},{key:7,value:"ftp文件上传"},{key:8,value:"ftp文件下传"},{key:9,value:"sftp文件上传"},{key:10,value:"sftp文件下传"},{key:11,value:"agent文件上传"},{key:12,value:"agent文件下传"},{key:13,value:"拷贝文件"},{key:14,value:"数据库"},{key:15,value:"数据库脚本"},{key:16,value:"网络配置"},{key:17,value:"应用启动"},{key:18,value:"应用停止"},{key:19,value:"Python脚本"},{key:20,value:"Shell脚本"},{key:21,value:"Bat脚本"},{key:24,value:"WebService"},{key:25,value:"Tcp"},{key:26,value:"HTTP"},{key:28,value:"CL"},{key:29,value:"RPG"},{key:30,value:"Java"},{key:31,value:"C"},{key:32,value:"C++"}]}),GlobalData.factory("FlowCategoryData",function(){return[{category:1,element_list:[{category:1,text:"ftp文件",type:7,sd_job_bean:{}},{category:1,text:"ftp文件",type:8,sd_job_bean:{}},{category:1,text:"sftp文件",type:9,sd_job_bean:{}},{category:1,text:"sftp文件",type:10,sd_job_bean:{}},{category:1,text:"agent文件",type:11,sd_job_bean:{}},{category:1,text:"agent文件",type:12,sd_job_bean:{}},{category:1,text:"拷贝文件",type:13,sd_job_bean:{}}]},{category:2,element_list:[{category:2,text:"数据库",type:14,sd_job_bean:{}},{category:2,text:"数据库脚本",type:15,sd_job_bean:{}}]},{category:3,element_list:[{category:3,text:"网络配置",type:16,sd_job_bean:{}}]},{category:4,element_list:[{category:4,text:"应用启动",type:17,sd_job_bean:{}},{category:4,text:"应用停止",type:18,sd_job_bean:{}}]},{category:5,element_list:[{category:5,text:"Python",type:19,sd_job_bean:{}},{category:5,text:"Shell",type:20,sd_job_bean:{}},{category:5,text:"Bat",type:21,sd_job_bean:{}},{category:5,text:"Java",type:30,sd_job_bean:{}},{category:5,text:"C",type:31,sd_job_bean:{}},{category:5,text:"C++",type:32,sd_job_bean:{}}]},{category:6,element_list:[{category:6,text:"WebService",type:24,sd_job_bean:{}},{category:6,text:"Tcp",type:25,sd_job_bean:{}},{category:6,text:"HTTP",type:26,sd_job_bean:{}}]},{category:7,element_list:[{category:7,text:"轮询",type:6,sd_job_bean:{}}]},{category:8,element_list:[{category:8,text:"CL",type:28,sd_job_bean:{}},{category:8,text:"RPG",type:29,sd_job_bean:{}}]}]}),GlobalData.factory("RequestMethod",function(){return[{key:1,value:"POST"},{key:2,value:"GET"}]}),GlobalData.factory("JobOpType",function(){return[{key:1,value:"执行"},{key:2,value:"完成"},{key:3,value:"跳过"},{key:4,value:"重试"},{key:5,value:"中止"}]}),GlobalData.factory("OpTaskState",function(){return[{key:1,value:"等待运行"},{key:2,value:"正在运行"},{key:3,value:"运行结束"}]}),GlobalData.factory("OpTaskExeStatus",function(){return[{key:1,value:"执行中"},{key:2,value:""},{key:3,value:"执行异常"},{key:4,value:"正常完成"},{key:5,value:"异常完成"},{key:6,value:"重试中"},{key:7,value:"任务暂停"},{key:8,value:"手动等待"},{key:9,value:"暂停等待"},{key:10,value:"执行失败"},{key:11,value:"排队中"}]}),GlobalData.factory("OpJobExeStatus",function(){return[{key:1,value:"未执行"},{key:2,value:"执行中"},{key:3,value:"成功"},{key:4,value:"异常"},{key:5,value:"跳过"},{key:6,value:"待重试"},{key:7,value:"失败"}]}),GlobalData.factory("OpMeddleType",function(){return[{key:1,value:"关闭任务"},{key:2,value:"暂停任务"},{key:3,value:"中止作业"},{key:4,value:"延时执行"},{key:5,value:"中止任务"},{key:6,value:"单步执行"},{key:7,value:"一键执行"},{key:8,value:"继续执行"},{key:9,value:"单个跳过"},{key:10,value:"重做作业"},{key:11,value:"重试作业"},{key:12,value:"重试作业链"},{key:13,value:"回收任务线程"},{key:14,value:"回收作业线程"},{key:15,value:"重做状态同步"},{key:16,value:"完成作业"}]}),GlobalData.factory("ParamValueSource",function(){return[{key:1,value:"固有"},{key:2,value:"引用"}]}),GlobalData.factory("ElementCategory",function(){return[{key:1,value:"文件"},{key:2,value:"数据库"},{key:3,value:"网络"},{key:4,value:"应用"},{key:5,value:"脚本"},{key:6,value:"服务调用"},{key:7,value:"轮询"},{key:8,value:"其他"}]}),GlobalData.factory("StrategyGroupType",function(){return[{key:1,value:"并行"},{key:2,value:"并发"},{key:3,value:"优先级"}]}),GlobalData.factory("StrategyPriority",function(){return[{key:1,value:"一"},{key:2,value:"二"},{key:3,value:"三"},{key:4,value:"四"},{key:5,value:"五"},{key:6,value:"六"},{key:7,value:"七"},{key:8,value:"八"},{key:9,value:"九"},{key:10,value:"十"}]}),GlobalData.factory("VersionEncodingData",function(){return["UTF-8","GBK"]}),GlobalData.factory("TempCompareData",function(){function a(a){d.push(a)}function b(){return d=[]}function c(){return d}var d=[];return{addItem:a,clearList:b,getList:c}}),GlobalData.factory("VersionStatus",function(){return[{key:1,value:"未入库"},{key:2,value:"正常"},{key:3,value:"已回退"}]}),GlobalData.factory("ScrollConfig",function(){return{axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}}}),GlobalData.factory("ScrollBarConfig",function(){var a={},b={theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}};return a.X=function(a){return angular.extend(b,{axis:"x",scrollbarPosition:a?a:"inside"})},a.Y=function(a){return angular.extend(b,{axis:"y",scrollbarPosition:a?a:"inside"})},a.XY=function(a){return angular.extend(b,{axis:"yx",scrollbarPosition:a?a:"inside"})},a}),GlobalData.factory("weekType",function(){return[{key:0,value:"星期日"},{key:1,value:"星期一"},{key:2,value:"星期二"},{key:3,value:"星期三"},{key:4,value:"星期四"},{key:5,value:"星期五"},{key:6,value:"星期六"}]}),GlobalData.factory("LetterNavList",function(){return[{letter:"A",list:[]},{letter:"B",list:[]},{letter:"C",list:[]},{letter:"D",list:[]},{letter:"E",list:[]},{letter:"F",list:[]},{letter:"G",list:[]},{letter:"H",list:[]},{letter:"I",list:[]},{letter:"J",list:[]},{letter:"K",list:[]},{letter:"L",list:[]},{letter:"M",list:[]},{letter:"N",list:[]},{letter:"O",list:[]},{letter:"P",list:[]},{letter:"Q",list:[]},{letter:"R",list:[]},{letter:"S",list:[]},{letter:"T",list:[]},{letter:"U",list:[]},{letter:"V",list:[]},{letter:"W",list:[]},{letter:"X",list:[]},{letter:"Y",list:[]},{letter:"Z",list:[]},{letter:"#",list:[]}]});var QRCodeLoginService=angular.module("QRCodeLoginService",[]);QRCodeLoginService.service("QRCodeLogin",["CallProvider","baseUrl",function(a,b){this.getQRCodeLoginImage=function c(d,e,f){a.call({actionName:"qr_GetQRCodeLoginImageNameAction.do",reqData:{submit_type:1}}).then(function(g){var h=g.imgName,i=b+"app/img/qrcode/"+g.imgName,j=h.substring(0,h.length-4);d&&d(i),function k(){a.call({actionName:"qr_GetLoginStatusForLongPollingAction.do",reqData:{submit_type:1,uuid:j}}).then(function(a){a&&0==a.loginStatus?k():a&&-1==a.loginStatus?c(d,e,f):a&&1==a.loginStatus&&e&&e(a.userLoginInOutputBean)},function(a){f&&f(a)})}()},function(a){f(a)})}}]),QRCodeLoginService.service("QRCodeLocalAuth",["CallProvider","baseUrl",function(a,b){this.getQRCodeLocalAuthImage=function c(d,e,f,g){var h={cancel:!1};return a.call({actionName:"qr_GetQRCodeLocalAuthImageNameAction.do",reqData:d}).then(function(i){var j=i.imgName,k=b+"app/img/qrcode/"+i.imgName,l=j.substring(0,j.length-4);e&&e(k),function m(){a.call({actionName:"qr_GetLocalAuthStatusForLongPollingAction.do",reqData:{submit_type:1,uuid:l}}).then(function(a){a&&0==a.status&&!h.cancel?m():a&&-1==a.status?c(d,e,f,g):a&&1==a.status&&f&&f(a.checkLocalAuthOutputBean)},function(a){g&&g(a)})}()},function(a){g&&g(a)}),h}}]);var licenseCtrl=angular.module("LicenseController",[]);licenseCtrl.controller("registerLicenseCtrl",["$scope","$modalInstance","$timeout","User","Modal","CV",function(a,b,c,d,e,f){a.form={},a.register_info={min_date:new Date,register_flag:!0,license_info:{}},a.control={register_btn_loading:!1},d.getLicense().then(function(b){c(function(){if(b){var c=b.regist_flag;1==c?a.register_info.license_info={}:a.register_info.license_info={name:b.name,zh_name:b.zh_name,expire_end_date:b.expire_end_date,license:b.license,ip:b.ip,version_msg:b.version_msg?b.version_msg:""}}},0)},function(a){e.alert(a.message,3)}),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.form.opened=!0},a.formSubmit=function(){return a.control.register_btn_loading=!0,f.valiForm(a.form.regLicenseForm)?(a.register_info.license_info.expire_end_date=f.dtFormat(a.register_info.license_info.expire_end_date),void d.registLicense(a.register_info.license_info).then(function(d){c(function(){a.control.register_btn_loading=!1,e.alert("注册成功",2),b.close(!0)},0)},function(b){a.control.register_btn_loading=!1,e.alert(b.message,3)})):(a.control.register_btn_loading=!1,!1)},a.cancel=function(){b.dismiss(!1)}}]),licenseCtrl.controller("showLicenseCtrl",["$scope","$modalInstance","$timeout","User","Modal",function(a,b,c,d,e){a.register_info={register_flag:!0,license_info:{}},d.getLicense().then(function(b){c(function(){a.register_info.license_info={name:b.name,zh_name:b.zh_name,expire_end_date:b.expire_end_date,license:b.license,ip:b.ip,version_msg:b.version_msg?b.version_msg:""}},0)},function(a){e.alert(a.message,3)}),a.cancel=function(){b.close(!0)}}]);var modal_m=angular.module("ModalCtrl",[]);modal_m.controller("LoadingCtrl",["$scope","Message",function(a,b){a.message=b}]),modal_m.controller("AlertCtrl",["$scope","$modalInstance","$timeout","status","Message",function(a,b,c,d,e){a.message=e,a.status=d?d:1,a.ok=function(){try{b.close(!0)}catch(a){}},$("body").keypress(function(c){var d=c.keyCode||c.which;13==d&&a.$apply(function(){b.close(!0)})}),3!=a.status&&c(function(){try{b.close(!0)}catch(a){}},2e3)}]),modal_m.controller("ConfirmCtrl",["$scope","$modalInstance","Message",function(a,b,c){a.message=c,a.ok=function(){b.close(!0)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("localAuthCtrl",["$scope","$modalInstance","modalParam","Task","QRCodeLocalAuth","Modal",function(a,b,c,d,e,f){var g=angular.copy(c.srv_req_data);a.info={authdprl_bk_expl:c.auth_data.authdprl_bk_expl,user_id:"",user_password:"",qrcodeLocalAuthImageURL:""},a.control={btnBus_loading:!1};var h={auth_dprl_code:c.auth_data.auth_dprl_code,auth_seq:c.auth_data.auth_seq,auth_user_id:a.info.user_id,pend_srv_name:c.auth_data.pend_srv_name,user_passwd:a.info.user_password,auth_key:c.auth_data.auth_key,req_data:g},i=e.getQRCodeLocalAuthImage(h,function(b){a.info.qrcodeLocalAuthImageURL=b},function(e){e&&e.pend_srv_name==g.org_srv_name?(g.submit_type=4,d.ExecuteTask(g,c.auth_data.pend_srv_name).then(function(a){b.close(a)},function(c){a.control.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})})):b.close(e)},function(c){a.control.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})});a.submit=function(){i.cancel=!0,a.control.btnBus_loading=!0;var e=angular.copy(c.srv_req_data);return a.info.user_id?a.info.user_password?(h.auth_user_id=a.info.user_id,h.user_passwd=a.info.user_password,d.LocalAuthTask(h).then(function(f){f.pend_work_seq&&(f.pend_srv_name=f.pend_work_seq),f&&f.pend_srv_name==e.org_srv_name?(e.submit_type=4,d.ExecuteTask(e,c.auth_data.pend_srv_name).then(function(a){b.close(a)},function(c){a.control.btnBus_loading=!1,b.dismiss(c)})):b.close(f)},function(c){a.control.btnBus_loading=!1,b.dismiss(c)}),void 0):(f.alert("授权用户密码为空！",3),a.control.btnBus_loading=!1,!1):(f.alert("授权用户名为空！",3),a.control.btnBus_loading=!1,!1)},a.cancel=function(){i.cancel=!0,b.dismiss({status:"system",message:"已取消本地授权"})}}]),modal_m.controller("remoteAuthCtrl",["$scope","$modalInstance","modalParam","Task","CV",function(a,b,c,d,e){a.info={pendwk_bk_expl:c.auth_data.pendwk_bk_expl,apply_bk_expl:"",form:{}},a.control={btnBus_loading:!1},a.submitRaForm=function(){if(a.control.btnBus_loading=!0,!e.valiForm(a.info.form.raForm))return a.control.btnBus_loading=!1,!1;var f=angular.copy(c.srv_req_data);f.submit_type=5,f.apply_bk_expl=a.info.apply_bk_expl,d.ExecuteTask(f,c.srv_req_data.org_srv_name).then(function(a){b.close({status:"system",message:"任务已提交，待审批",task_id:a.appdata.pend_work_seq})},function(c){a.control.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})})},a.cancel=function(){b.dismiss({status:"system",message:"手动取消任务申请"})}}]),modal_m.controller("CompareFileCtrl",["$scope","$modalInstance","$timeout","Exec","modalParam","EncodingType","ScriptDayNight","CodeMirrorOption","Modal",function(a,b,c,d,e,f,g,h,i){var j="",k="";a.can_not_save=!0,a.show_setting=!1,a.socWords="",a.tagWords="",a.upload_exist_flag=!1,a.btnBus_loading=!1,a.loading_config_file=!1,a.filePath=e.file_path,a.isEdit=e.is_edit?e.is_edit:!1,a.fileData={socWords:"",system:""},a.select_data={encoding:f,encoding_type:"GBK",day_night:g,script_day:"日间"},j=a.select_data.encoding_type,a.editorOptions={lineWrapping:!0,lineNumbers:!0,readOnly:!a.isEdit,mode:"text/x-properties"};var l=function(){d.getConfigFile(e.busi_sys_id,e.sys_publish_id,e.download_soc_ip,e.file_path,e.download_soc_name,a.select_data.encoding_type).then(function(b){a.fileData.socWords=b.config_string?b.config_string:"",a.upload_exist_flag=b.upload_exist_flag,a.fileData.socWords=Base64.decode(a.fileData.socWords),a.fileData.system=b.system,a.loading_config_file=!0;var c=a.$watch("fileData.socWords",function(b,d){b!=d&&(a.can_not_save=!1,c())})},function(c){i.alert(c.message,3),a.loading_config_file=!0,b.close(!1)})},m=function(){l()};a.fileEditorLoaded=function(b){h.setFileEditor(b,!a.isEdit)},a.scriptDayOrNight=function(b){return a.select_data.script_day==b?!1:(a.select_data.script_day=b,void h.dayOrNight())},a.changeCoding=function(b){return a.select_data.encoding_type=b,j==b?!1:(a.loading_config_file=!1,l(),void(j=b))},a.setFunc=function(){a.show_setting=!a.show_setting},a.hidenGroupList=function(){a.show_setting=!1},a.showAnimate=function(a){k=c(function(){$("."+a).animate({right:"2px"},200,"linear")},200)},a.hiddenAnimate=function(a){k&&c.cancel(k),k=c(function(){$("."+a).animate({right:"-130px"},200,"linear")},200)},a.ok=function(c){a.tagWords=c?Base64.encode(c):"",a.btnBus_loading=!0;var f={business_sys_name:e.busi_sys_id,syspublish_id:e.sys_publish_id,node_name:e.node_name,relative_path:e.file_path,config_string:a.tagWords,system:a.fileData.system,check_soc_name:e.check_soc_name,download_soc_name:e.download_soc_name,download_soc_ip:e.download_soc_ip,encoding:a.select_data.encoding_type,phase_type:e.phase_type,phase_no:e.phase_no?e.phase_no:0,quick_publish:e.quick_publish?e.quick_publish:2};d.saveConfigFile(f).then(function(a){i.alert("配置文件修改成功！",2),b.close(!0)},function(b){a.btnBus_loading=!1,i.alert(b.message,3)})},a.cancel=function(){i.confirm("确认退出当前操作吗？").then(function(){b.close(!1)})},c(function(){!function(a){a(".modal-content").draggable({cancel:".modal-body",cursor:"move"})}(jQuery)},1e3),m()}]),modal_m.controller("planNewGroupCtrl",["$scope","$modalInstance","$timeout","Plan","ProjectNature","Modal","CV",function(a,b,c,d,e,f,g){a.col="start_bk_time",a.desc=0,a.checked=!1,a.selectAll_flag=!1,a.newGroupList=[],a.form={},a.new_group_info={group_id:"",group_cn_name:"",proj_list:[]};var h=function(){d.getCanGroupProjList().then(function(b){c(function(){b.rows=b.pj_plan_list?b.pj_plan_list:"",a.newGroupList=b.rows;for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0,a.newGroupList[c].project_nature_cn=g.findValue(a.newGroupList[c].project_nature,e),a.newGroupList[c].pre_project_short_name=a.newGroupList[c].pre_project_short_name?a.newGroupList[c].pre_project_short_name:"无";for(var d=0;d<a.newGroupList.length;d++){if("无"===a.newGroupList[d].pre_project_short_name){a.selectAll_flag=!1;break}a.selectAll_flag=!0}},0)},function(a){f.alert(a.message,3)})};a.selectAll=function(b){if(b)for(var c=0;c<a.newGroupList.length;c++)"无"==a.newGroupList[c].pre_project_short_name&&(a.newGroupList[c].checked=1);else for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0},a.formSubmit=function(){if(!g.valiForm(a.form.new_group_form))return!1;a.new_btn_loading=!0;for(var e=0;e<a.newGroupList.length;e++)1==a.newGroupList[e].checked&&a.new_group_info.proj_list.push({
project_name:a.newGroupList[e].project_name,business_sys_name:a.newGroupList[e].business_sys_name});return 0==a.new_group_info.proj_list.length?(f.alert("请至少选择一个项目",3),a.new_btn_loading=!1,!1):void d.saveOrUpdateGroup(a.new_group_info).then(function(d){c(function(){d&&(a.new_btn_loading=!1,f.alert("添加成功",2),b.close(!0))},0)},function(b){a.new_btn_loading=!1,f.alert(b.message,3)})},a.formCancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("planEditGroupCtrl",["$scope","$modalInstance","$timeout","Plan","ProjectNature","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h){var i=f.group_id,j={group_id:i,pro_bk_date:f.group_date};a.col="start_bk_time",a.desc=0,a.newGroupList=[],a.groupList=[],a.all_checked=!1,a.form={},a.edit_group_info={group_id:"",group_cn_name:f.group_cn_name,proj_list:[]};var k=function(){d.getProjListByGroup(j).then(function(b){b.rows=b.pj_plan_list?b.pj_plan_list:[],a.groupList=b.rows;for(var c=0;c<a.groupList.length;c++)a.groupList[c].checked=1,a.groupList[c].project_nature_cn=h.findValue(a.groupList[c].project_nature,e),a.groupList[c].pre_project_short_name=a.groupList[c].pre_project_short_name?a.groupList[c].pre_project_short_name:"无"},function(a){g.alert(a.message,3)}),d.getCanGroupProjList().then(function(b){b.rows=b.pj_plan_list?b.pj_plan_list:"",a.newGroupList=b.rows;for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0,a.newGroupList[c].project_nature_cn=h.findValue(a.newGroupList[c].project_nature,e),a.newGroupList[c].pre_project_short_name=a.newGroupList[c].pre_project_short_name?a.newGroupList[c].pre_project_short_name:"无"},function(a){g.alert(a.message,3)})};a.selectAll=function(b){if(b){for(var c=0;c<a.newGroupList.length;c++)"无"==a.newGroupList[c].pre_project_short_name&&(a.newGroupList[c].checked=1);for(var c=0;c<a.groupList.length;c++)"无"==a.groupList[c].pre_project_short_name&&(a.groupList[c].checked=1)}else{for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0;for(var c=0;c<a.groupList.length;c++)a.groupList[c].checked=0}},a.cancel=function(){a.all_checked=!1,k()},a.formSubmit=function(){if(!h.valiForm(a.form.edit_group_form))return!1;a.edit_btn_loading=!0;for(var e=0;e<a.newGroupList.length;e++)1==a.newGroupList[e].checked&&a.edit_group_info.proj_list.push({project_name:a.newGroupList[e].project_name,business_sys_name:a.newGroupList[e].business_sys_name});for(var e=0;e<a.groupList.length;e++)1==a.groupList[e].checked&&a.edit_group_info.proj_list.push({project_name:a.groupList[e].project_name,business_sys_name:a.groupList[e].business_sys_name});0==a.edit_group_info.proj_list.length?(a.edit_btn_loading=!1,g.confirm("您当前未选择任何项目，请确认是否要删除该分组").then(function(){a.edit_btn_loading=!0,a.edit_group_info.group_id=i,d.saveOrUpdateGroup(a.edit_group_info).then(function(d){c(function(){d&&(a.edit_btn_loading=!1,g.alert("删除成功",2),b.close(!0))},1e3)},function(b){a.edit_btn_loading=!1,g.alert(b.message,3)})})):(a.edit_group_info.group_id=i,d.saveOrUpdateGroup(a.edit_group_info).then(function(d){c(function(){d&&(a.edit_btn_loading=!1,g.alert("修改成功",2),b.close(!0))},0)},function(b){a.edit_btn_loading=!1,g.alert(b.message,3)}))},a.formCancel=function(){b.dismiss(!1)},k()}]),modal_m.controller("RollbackSummaryCtrl",["$scope","$modalInstance","$timeout","$location","Exec","User","Proj","ProjectNature","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){a.control={btnBus_loading:!1,show_user_flag:!1},a.form={},a.rollback_summary={business_sys_name:i.busi_sys,syspublish_id:i.publish_id,project_bk_evaluate:"",rollback_flag:i.rollback_flag,evaluate_user_cn_name:"",notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""},a.data={select_person:[],feedback_type_list:[{key:1,value:"邮件",state:!1},{key:2,value:"短信",state:!1}]},a.email_msg={project_name:"",project_short_name:"",business_sys_name:"",project_bk_desc:"",project_nature_cn:"",user_cn_name:"",pj_end_time:"",pj_start_time:"",prod_flag_cn:"",assess_time:"",assess_msg:""};var l=function(){var b=new Date;a.email_msg.prod_flag_cn=1==a.rollback_summary.rollback_flag?"成功":"失败",a.email_msg.assess_time=k.dtFormat(b)+" "+k.dttFormat(b),a.email_msg.assess_msg=a.rollback_summary.project_bk_evaluate,a.rollback_summary.feedback_msg=["<html><head></head><body>","<div>项目编号 ："+a.email_msg.project_name+"</div>",a.email_msg.project_short_name?"<div>项目简称 ："+a.email_msg.project_short_name+"</div>":"","<div>应用系统 ："+a.email_msg.business_sys_name+"</div>",a.email_msg.project_bk_desc?"<div>项目描述 ："+a.email_msg.project_bk_desc+"</div>":"",a.email_msg.project_nature_cn?"<div>发布类型 ："+a.email_msg.project_nature_cn+"</div>":"",a.email_msg.user_cn_name?"<div>执行用户 ："+a.email_msg.user_cn_name+"</div>":"","<div>开始时间 ："+a.email_msg.pj_start_time+"</div>","<div>结束时间 ："+a.email_msg.pj_end_time+"</div>","<div>回退结果 ："+a.email_msg.prod_flag_cn+"</div>","<div>评价时间 ："+a.email_msg.assess_time+"</div>","<div>回退信息 ："+a.email_msg.assess_msg+"</div>","</body>","</html>"].join("")},m=function(){e.getRollbackSummary(i.publish_id,i.busi_sys).then(function(b){console.log(b),b.rollback_evaluate_info&&(a.rollback_summary.assess_bk_seq=b.rollback_evaluate_info.assess_bk_seq,a.rollback_summary.project_bk_evaluate=b.rollback_evaluate_info.project_bk_evaluate,a.rollback_summary.evaluate_user_cn_name=b.rollback_evaluate_info.user_cn_name,a.rollback_summary.assess_bk_date=b.rollback_evaluate_info.assess_bk_date,a.rollback_summary.assess_bk_time=b.rollback_evaluate_info.assess_bk_time)},function(a){j.alert(a.message,3)}),f.getAllUserCanExec().then(function(b){c(function(){b.user_dept_list&&(a.data.select_person=b.user_dept_list)},0)},function(a){j.alert(a.message,3)})};a.chooseFeedBackType=function(b){b.state?a.control.show_user_flag=!0:(a.control.show_user_flag=!1,a.control.user_is_none=!1,a.rollback_summary.notice_users=[],a.rollback_summary.user_cn_name="")},a.addEmailAddress=function(b){var c=0;if(!b)return j.alert("收件人不能为空！",3),!1;if(0!=a.rollback_summary.notice_users.length)for(var d=0;d<a.rollback_summary.notice_users.length;d++){var e=a.rollback_summary.notice_users[d];if(e.user_cn_name==b)return j.alert("收件人已经添加过！请添加新收件人",3),a.rollback_summary.user_cn_name="",!1}for(var f=0;f<a.data.select_person.length;f++){var g=a.data.select_person[f];if(g.user_cn_name==b){c++,a.rollback_summary.notice_users.push(g);break}}0==c&&j.alert("用户不存在！请重新添加！",3),a.rollback_summary.user_cn_name=""},a.deleteSingleUser=function(b){a.rollback_summary.notice_users.splice(b,1)},a.formSubmit=function(){return k.valiForm(a.form.rollback_form)?(l(),a.control.btnBus_loading=!0,void e.editRollbackSummary(a.rollback_summary).then(function(c){j.alert("评价完成！",2),a.control.btnBus_loading=!1,b.close(c)},function(b){a.control.btnBus_loading=!1,j.alert(b.message,3)})):!1},a.formCancel=function(){b.dismiss(!1)},m()}]),modal_m.controller("SummaryCtrl",["$scope","$modalInstance","$location","$timeout","Exec","User","Proj","IssueType","ProjectNature","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.summary={business_sys_name:j.busi_sys,syspublish_id:j.publish_id,prod_flag:1,problem_type_list:[],project_evaluate_list:[],project_bk_evaluate:"",project_evaluate:{},notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""},a.control={btnBus_loading:!1,show_user_flag:!1},a.data={select_person:[],feedback_type_list:[{key:1,value:"邮件",state:!1},{key:2,value:"短信",state:!1}]},a.email_msg={syspublish_id:"",project_short_name:"",business_sys_name:"",project_bk_desc:"",project_nature_cn:"",user_cn_name:"",pj_end_time:"",pj_start_time:"",prod_flag_cn:"",assess_time:"",assess_msg:"",problem_type:""};var m=c.url(),n=m.substring(0,m.indexOf("/",10));"/finish_proj"==n&&(a.summary.prod_flag=2);var o=function(){var b=new Date,c=[];if(a.email_msg.prod_flag_cn=1==a.summary.prod_flag?"成功":"失败",a.email_msg.assess_time=l.dtFormat(b)+" "+l.dttFormat(b),a.email_msg.assess_msg=a.summary.project_bk_evaluate,0!=a.summary.problem_type_list.length){for(var d=0;d<a.summary.problem_type_list.length;d++)c.push(l.findValue(a.summary.problem_type_list[d],h));a.email_msg.problem_type=c.join("|")}a.summary.feedback_msg=["<html><head></head><body>","<div>项目编号 ："+a.email_msg.project_name+"</div>","<div>项目简称 ："+a.email_msg.project_short_name+"</div>","<div>应用系统 ："+a.email_msg.business_sys_name+"</div>","<div>项目描述 ："+a.email_msg.project_bk_desc+"</div>","<div>发布类型 ："+a.email_msg.project_nature_cn+"</div>","<div>执行用户 ："+a.email_msg.user_cn_name+"</div>","<div>开始时间 ："+a.email_msg.pj_start_time+"</div>","<div>结束时间 ："+a.email_msg.pj_end_time+"</div>","<div>发布结果 ："+a.email_msg.prod_flag_cn+"</div>","<div>评价时间 ："+a.email_msg.assess_time+"</div>","<div>评价信息 ："+a.email_msg.assess_msg+"</div>",a.email_msg.problem_type?"<div>问题类型 ："+a.email_msg.problem_type+"</div>":"","</body>","</html>"].join("")},p=function(){a.all_problem_type=angular.copy(h),e.showSummaryProd(j.busi_sys,j.publish_id).then(function(b){if(b.pj_evaluate_bean){a.summary.prod_flag=b.pj_evaluate_bean.prod_flag?b.pj_evaluate_bean.prod_flag:1,a.summary.problem_type_list=b.pj_evaluate_bean.problem_type_list?b.pj_evaluate_bean.problem_type_list:[];for(var c=0;c<a.all_problem_type.length;c++){var d=a.all_problem_type[c];-1==a.summary.problem_type_list.indexOf(d.key)?d.checked=!1:d.checked=!0}b.pj_evaluate_bean.projectAssessInfo&&(a.summary.project_evaluate=b.pj_evaluate_bean.projectAssessInfo,a.summary.project_bk_evaluate=a.summary.project_evaluate.project_bk_evaluate)}},function(a){k.alert(a.message,3)}),f.getAllUserCanExec().then(function(b){d(function(){b.user_dept_list&&(a.data.select_person=b.user_dept_list)},0)},function(a){k.alert(a.message,3)})};a.chooseFeedBackType=function(b){b.state?a.control.show_user_flag=!0:(a.control.show_user_flag=!1,a.control.user_is_none=!1,a.summary.notice_users=[],a.summary.user_cn_name="")},a.addEmailAddress=function(b){var c=0;if(!b)return k.alert("收件人不能为空！",3),!1;if(0!=a.summary.notice_users.length)for(var d=0;d<a.summary.notice_users.length;d++){var e=a.summary.notice_users[d];if(e.user_cn_name==b)return k.alert("收件人已经添加过！请添加新收件人",3),a.summary.user_cn_name="",!1}for(var f=0;f<a.data.select_person.length;f++){var g=a.data.select_person[f];if(g.user_cn_name==b){c++,a.summary.notice_users.push(g);break}}0==c&&k.alert("用户不存在！请重新添加！",3),a.control.user_is_none=!1,a.summary.user_cn_name=""},a.deleteSingleUser=function(b){a.summary.notice_users.splice(b,1)},a.ok=function(){a.summary.problem_type_list=[];for(var c=0;c<a.all_problem_type.length;c++)a.all_problem_type[c].checked&&a.summary.problem_type_list.push(a.all_problem_type[c].key);return a.control.show_user_flag&&0==a.summary.notice_users.length?(a.control.user_is_none=!0,!1):0==a.summary.problem_type_list.length&&2==a.summary.prod_flag?(k.alert("未选择问题类型！",3),!1):a.summary.project_bk_evaluate?(o(),a.control.btnBus_loading=!0,e.summaryProd(a.summary).then(function(c){k.alert("评价完成！",2),a.control.btnBus_loading=!1,b.close(c)},function(b){a.control.btnBus_loading=!1,k.alert(b.message,3)}),void 0):(k.alert("未填写总结评价！",3),!1)},a.cancel=function(){b.dismiss(!1)},p()}]),modal_m.controller("addPordPacModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h){var i=d.pac_index,j=d.pac_flag,k=d.pre_info.version_soc_name;a.control={package_list_flag:d.is_prod_list,show_real:!1,propackage_btn_loading:!1},a.info={packlist_info:angular.copy(d.pre_info),form:{},version_info:{soc_name:k,root_bk_dir:"",init_path:"/"!=d.propackage_bk_path?d.propackage_bk_path:"",loading:!1,full_path:""}},a.config={prodpackage_fileupload:{suffixs:"",filetype:"",filenames:[],uploadpath:d.fileupload_path},prodlist_fileupload:{suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:d.fileupload_path}};var l=function(){for(var b=!1,c=a.info.packlist_info.propackage_list[i].package_name_list,d=0;d<c.length;d++)for(var e=c[d],f=0;f<a.info.version_info.checked_files.length;f++){var g=a.info.version_info.checked_files[f];if(e.propackage_full_path.substring(e.propackage_full_path.lastIndexOf("/")+1,e.propackage_full_path.length)==g.file){b=!0;break}}return b},m=function(){for(var b=!1,c=a.info.packlist_info.propackage_list[i].package_name_list,d=0;d<c.length;d++){var e=c[d];if(e.propackage_full_path.substring(e.propackage_full_path.lastIndexOf("/")+1,e.propackage_full_path.length)==a.config.prodpackage_fileupload.filename){b=!0;break}}return b},n=function(){if(2==a.info.packlist_info.upload_flag)for(var b=0;b<a.info.version_info.checked_files.length;b++){var c=a.info.version_info.checked_files[b],d=c.path+"/"+c.file,e={propackage_full_path:d};a.info.packlist_info.propackage_list[i].package_name_list.push(e),a.info.packlist_info.propackage_list[i].propackage_full_path.push(d),a.info.packlist_info.propackage_list[i].package_list.push(c.file)}else for(var b=0;b<a.config.prodpackage_fileupload.filenames.length;b++){for(var f=a.config.prodpackage_fileupload.filenames[b],g=!1,h=a.config.prodpackage_fileupload.uploadpath+f,j=0;j<a.info.packlist_info.propackage_list[i].package_name_list.length;j++){var k=a.info.packlist_info.propackage_list[i].package_name_list[j].propackage_full_path;if(h==k){g=!0;break}}g||(a.info.packlist_info.propackage_list[i].package_name_list.push({propackage_full_path:h}),a.info.packlist_info.propackage_list[i].propackage_full_path.push(h),a.info.packlist_info.propackage_list[i].package_list.push(f))}},o=function(){a.info.version_info.checked_files=[],a.info.version_info.paths=[],a.info.version_info.active=!1,a.info.version_info.loading=!1},p=function(){2==a.info.packlist_info.upload_flag&&(a.control.package_list_flag?a.info.version_info.init_path="/"!=d.prolist_bk_path?d.prolist_bk_path:"":a.info.version_info.init_path="/"!=d.propackage_bk_path?d.propackage_bk_path:"",a.info.version_info.init_path?c(function(){a.control.show_real=!0},1e3):e.getFileListBySoc(k,a.info.version_info.init_path).then(function(b){o(),a.info.version_info.path_files=b.file_bean_list?b.file_bean_list:[],a.info.version_info.full_path=b.root_bk_dir?b.root_bk_dir:"",a.info.version_info.init_path=b.root_bk_dir?b.root_bk_dir:"",a.control.show_real=!0},function(a){g.alert(a.message,3),b.dismiss()}))};a.uploadProdListSuccessThen=function(){a.info.packlist_info.prolist_full_path=a.config.prodlist_fileupload.uploadpath+a.config.prodlist_fileupload.filename},a.removeProdListFile=function(){a.config.prodlist_fileupload.filename="",a.info.packlist_info.prolist_full_path=""},a.downloadProdListFile=function(){h.downloadFile(a.config.prodlist_fileupload.uploadpath+a.info.packlist_info.prolist_full_path.substring(a.info.packlist_info.prolist_full_path.lastIndexOf("/")+1,a.info.packlist_info.prolist_full_path.length))},a.removeProdPackage=function(){},a.downloadProdPackage=function(){},a.resetDpp=function(){a.control.package_list_flag?(a.info.packlist_info.prolist_full_path=d.pre_info.prolist_full_path,a.info.version_info.checked_files=[],a.changePath(a.info.version_info),1==a.info.packlist_info.upload_flag&&(a.config.prodlist_fileupload.filenames=[])):(a.info.version_info.checked_files=[],a.changePath(a.info.version_info),1==a.info.packlist_info.upload_flag&&(a.config.prodpackage_fileupload.filenames=[])),a.info.form.newDppForm.$setPristine()},a.prodPacSubmit=function(){if(!h.valiForm(a.info.form.newDppForm))return!1;if(a.control.package_list_flag){var c="";if(1==a.info.packlist_info.upload_flag&&!a.config.prodlist_fileupload.filename)return g.alert("请上传本地清单文件！"),!1;if(2==a.info.packlist_info.upload_flag&&0==a.info.version_info.checked_files.length)return g.alert("请选择清单文件！"),!1;a.info.version_info.checked_files&&a.info.version_info.checked_files.length>0&&(c=a.info.version_info.checked_files[0],a.info.packlist_info.prolist_full_path=a.info.version_info.full_path+"/"+c.file),a.control.propackage_btn_loading=!0;var d={prolist_full_path:a.info.packlist_info.prolist_full_path};b.close(d)}else{if(1==a.info.version_info.upload_flag&&0==a.config.prodpackage_fileupload.filenames.length)return g.alert("请上传本地发布包！"),!1;if(2==a.info.version_info.upload_flag&&0==a.info.version_info.checked_files.length)return g.alert("请选择发布包！"),!1;if(2==a.info.version_info.upload_flag){if(l())return g.alert("发布包已经存在!"),a.control.propackage_btn_loading=!1,!1}else if(1==a.info.upload_flag&&m())return g.alert("发布包已经存在!"),a.control.propackage_btn_loading=!1,!1;n(j),a.control.propackage_btn_loading=!0;var e={dpp_param_info:a.info.packlist_info,propackage_full_path:a.info.packlist_info.propackage_full_path};b.close(e)}a.control.propackage_btn_loading=!1},a.changePath=function(a){a.loading=!0,e.getFileListBySoc(k,a.full_path).then(function(b){a.loading=!1,a.path_files=b.file_bean_list?b.file_bean_list:[]},function(b){a.loading=!1,a.err_msg=b.message})},a.cancel=function(){b.dismiss()},p()}]),modal_m.controller("addPlatformPackageModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Exec","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h){var i=(d.pac_index,d.sys_publish_id);a.control={propackage_btn_loading:!1},a.data={dir_names:angular.copy(d.dir_names)||{}},a.configs={scroll_info:f},a.info={form:{},file_nodes:{nodes:angular.copy(d.dir_names.nodes)||[],choosed_file_list:[]}};var j=function(){};a.prodPacSubmit=function(){a.control.propackage_btn_loading=!0;for(var c=[],d=[],f=0;f<a.info.file_nodes.choosed_file_list.length;f++){var h=a.info.file_nodes.choosed_file_list[f];c.push(h.file_path),d.push(h.file)}e.savePlatFilePath(i,c).then(function(c){c&&(a.control.propackage_btn_loading=!1,b.close(d))},function(b){a.control.propackage_btn_loading=!1,g.alert(b.message,3)})},a.cancel=function(){b.dismiss()},j()}]),modal_m.controller("showHumanInteractCtrl",["$scope","$modalInstance","$timeout","$interval","modalParam","Modal","Exec","CmptFunc","CodeMirrorOption","CV",function(a,b,c,d,e,f,g,h,i,j){var k,l=e.execute_id,m=e.phaseId,n=e.steps;a.get_loading=!0,a.paramShellLoaded=function(b){i.showParamsEditor(b,a)},a.form={},a.interact_info={interact_msg:"",label_send_cmd_msg:"",send_cmd_msg:"",end_interact_flag:!1},a.data={interact_dialog_list:[],key_word_list:[]},a.scroll_dialog_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}};var o=function(){g.getMonitorInteractLogMsg(l,m).then(function(b){b.msg&&(a.data.interact_dialog_list.push({msg:h.stringToCmds(b.msg),type:1}),q()),b.param_list&&(a.data.key_word_list=r(b.param_list)),b.end_flag&&(a.interact_info.end_interact_flag=!0),a.get_loading=!1},function(a){d.cancel(k),f.alert(a.message,3)})},p=function(){for(var b=0;b<n.length;b++)for(var c=0;c<n[b].phase_list.length;c++){var d=n[b].phase_list[c];d.phase_no==m&&d.exe_script&&(a.interact_info.interact_msg=h.stringToCmds(d.exe_script))}},q=function(){c(function(){$(".dialog_wrap").mCustomScrollbar("scrollTo","bottom",{scrollEasing:"linear"})},200)},r=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.param_cn_name=d.param_cn_name?d.param_cn_name:"--",b.push({key:"${"+d.param_name+"}",text:"${"+d.param_name+"} ["+d.param_cn_name+"]"})}return b},s=function(){p(),k=d(function(){o()},3e3),a.$watch("interact_info.end_interact_flag",function(){a.interact_info.end_interact_flag&&d.cancel(k)})};a.toggleShowStyle=function(b){a.show_flag=b,b&&a.interact_info.send_cmd_msg&&(a.interact_info.label_send_cmd_msg="1111111111")},a.sendCmdMsg=function(){if(!a.interact_info.send_cmd_msg)return!1;var b=a.show_flag;g.sendInteractCmdMsg(l,m,a.interact_info.send_cmd_msg,b).then(function(c){a.data.interact_dialog_list.push({msg:a.interact_info.send_cmd_msg,type:2,show_flag:b}),q(),a.interact_info.send_cmd_msg=""},function(a){f.alert(a.message,3)})},a.cancel=function(c){1==c?(b.close(!0),d.cancel(k)):a.interact_info.end_interact_flag?(b.close(!0),d.cancel(k)):f.confirm("交互正在进行中,请确认是否退出交互并停止？").then(function(){b.close(!1),d.cancel(k)})},s()}]),modal_m.controller("chooseRollbackProgCtrl",["$scope","$modalInstance","$timeout","$sce","Exec","modalParam","Modal","CodeMirrorOption","BusiSys","ScrollConfig","BsysFunc","CmptFunc","ProtocolType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=f.business_sys_name,p=f.publish_id,q="",r="";a.form={},a.rollback_info={business_sys_name:o,syspublish_id:p,prepare_msg:{},prog_cn_name:"",prog_id:"",group_list:[],param_list:[],propackage_list:[]},a.data={node_list:[],rollBack_program_list:[],rollback_info_list:[]},a.control={get_prog_loading:!1,get_prog_list_loading:!1,soc_flag:!1,valid_prog_complete:!1,valid_prog_loading:!1,get_prog_complete:!1,get_node_list_loading:!1,btnBus_loading:!1,param_list_flag:!1},a.config={rollback_scroll:j},a.paramShellLoaded=function(b){h.setParamsEditor(b),c(function(){a.code_reflash=!0},0)},a.viewOptions=h.Sh(!0);var s=function(b){a.control.get_node_list_loading=!0,a.data.node_list=[];for(var d=b?b:[],e=0;e<d.length;e++)a.data.node_list.push({soc_ip:d[e],is_checked:!0});c(function(){a.control.get_node_list_loading=!1},1e3)},t=function(){a.control.get_prog_list_loading=!0,i.getAllProgramList(o,1,2).then(function(b){c(function(){b&&(a.control.get_prog_list_loading=!1,a.data.rollBack_program_list=b.program_list?b.program_list:[])},0)},function(b){g.alert(b.message,3),a.control.get_prog_list_loading=!1})},u=function(){e.getHistroyRollbackInfo(o,p).then(function(b){b&&(a.data.rollback_info_list=b.rollback_list?b.rollback_list:[])},function(a){})},v=function(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];3!=e.param_type&&c++}0==c&&(a.control.param_list_flag=!0)},w=function(b){for(var c=b?b:[],d=0;d<c.length;d++){var e=c[d];e.package_name_list=[],e.package_list=[],e.propackage_full_path=e.propackage_full_path?e.propackage_full_path:[];for(var f=0;f<e.propackage_full_path.length;f++)e.package_name_list.push({propackage_full_path:e.propackage_full_path[f]})}a.rollback_info.propackage_list=c},x=function(){for(var b=0;b<a.rollback_info.propackage_list.length;b++){var c=a.rollback_info.propackage_list[b];if(c.required_flag&&0==c.package_name_list.length){a.control.package_exsit_flag=!0;break}}return!a.control.package_exsit_flag},y=function(a,b){for(var c=0;c<a.package_name_list.length;c++){var d=a.package_name_list[c];z(d,b,a)}},z=function(b,c,d){d.add_pac_btn_disable=!0,b.is_exsit_loading=!0,b.no_exsit=!1,e.downloadProdListFile(o,_project_name,a.rollback_info.version_soc_name,b.propackage_full_path).then(function(a){b.is_exsit_loading=!1,d.add_pac_btn_disable=!1},function(a){d.add_pac_btn_disable=!1,b.is_exsit_loading=!1,b.no_exsit=!0,g.alert(a.message,3)})},A=function(){t(),u()};a.selectProgram=function(b){a.rollback_info.prog_id=b,a.rollback_info.propackage_list=[],a.control.valid_prog_complete=!1,a.control.valid_prog_loading=!0,a.control.get_prog_complete=!1,i.validateProgComplete(a.rollback_info.prog_id).then(function(b){c(function(){b&&(a.control.valid_prog_loading=!1,a.control.valid_prog_complete=!0,a.errorMessage="",a.control.get_prog_loading=!0,e.getReadyPacParamInfo(p,a.rollback_info.prog_id).then(function(b){console.log(b),b&&(a.rollback_info.prepare_msg=b.prepare_msg,a.rollback_info.version_soc_name=b.version_soc_name,a.rollback_info.upload_flag=b.version_soc_name?2:1,a.rollback_info.param_list=b.prepare_msg.param_list?b.prepare_msg.param_list:[],v(a.rollback_info.param_list),a.rollback_info.group_list=b.prepare_msg.group_list?b.prepare_msg.group_list:[],k.processProgDate(a.rollback_info.group_list,b.prepare_msg.pac_type_list),s(b.node_list),w(b.prepare_msg.pac_type_list),r=b.file_upload_path,q=b.dftpropac_bk_dir,a.control.get_prog_loading=!1,a.control.get_prog_complete=!0)},function(a){g.alert(a.message,3)}))},0)},function(b){a.valid_prog_error_msg=b.message,a.control.valid_prog_complete=!1,a.control.valid_prog_loading=!1})},a.changeFileFlag=function(b){a.rollback_info.upload_flag=b,a.control.validate_pac=!1,2==b&&(a.control.is_prolist_add=!1),angular.forEach(a.rollback_info.propackage_list,function(a){a.propackage_full_path=a.propackage_full_path?[]:[],a.package_name_list=a.package_name_list?[]:[]})},a.addProdPackage=function(b,c){a.control.validate_msg=!1,a.control.validate_pac=!1,g.prodPreAddProdPac(q,r,"",b,c,!1,a.rollback_info).then(function(c){c&&(a.rollback_info.propackage_list[b].package_name_list=c.dpp_param_info.propackage_list[b].package_name_list,a.rollback_info.propackage_list[b].propackage_full_path=c.dpp_param_info.propackage_list[b].propackage_full_path,a.rollback_info.propackage_list[b].package_list=c.dpp_param_info.propackage_list[b].package_list,2==a.rollback_info.upload_flag&&y(a.rollback_info.propackage_list[b],c))})},a.removeProdPackage=function(a,b,c){for(var d=c.propackage_full_path.substring(c.propackage_full_path.lastIndexOf("/")+1,c.propackage_full_path.length),e=0;e<a.length;e++){var f=a[e];if(f.package_type==b.package_type){for(var g=0;g<f.package_name_list.length;g++){var h=f.package_name_list[g];if(h.propackage_full_path==c.propackage_full_path){a[e].package_name_list.splice(g,1);break}}for(var g=0;g<f.package_list.length;g++){var i=f.package_list[g];if(i==d){a[e].package_list.splice(g,1);break}}for(var j=0;j<f.propackage_full_path.length;j++){var k=f.propackage_full_path[j];if(k==c.propackage_full_path){a[e].propackage_full_path.splice(j,1);break}}}}},a.downloadPackage=function(a){var b=r+a.propackage_full_path.substring(a.propackage_full_path.lastIndexOf("/")+1,a.propackage_full_path.length);n.downloadFile(b)},a.toggleModulesDetail=function(a,b){a.show_detail=!a.show_detail,b.nav_show_flag=l.judgeShowDetail(b.phase_list),b.expand_flag=2==b.nav_show_flag?!0:!1},a.expandCollapseAll=function(a){a.nav_show_flag=l.expandAllModules(a.phase_list)},a.colseCollapseAll=function(a){a.nav_show_flag=l.closeAllModules(a.phase_list)},a.getProtocolTypeCnName=function(a){return n.findValue(a,m).substring(0,5).toLowerCase()},a.saveRollbackInfo=function(){var c=[];if(0!=a.data.node_list.length){for(var d=0;d<a.data.node_list.length;d++)a.data.node_list[d].is_checked&&c.push(a.data.node_list[d].soc_ip);if(0==c.length)return g.alert("请先选择要回退的运行节点！",3),!1}var f=angular.copy(a.rollback_info);a.rollback_info.prepare_msg.group_list=f.prepare_msg.group_list,a.rollback_info.prepare_msg.param_list=f.prepare_msg.param_list,a.rollback_info.prepare_msg.pac_type_list=f.prepare_msg.pac_type_list?f.prepare_msg.pac_type_list:[];var h={syspublish_id:p,prepare_msg:a.rollback_info.prepare_msg,node_list:c};return n.valiForm(a.form.saveRollInfoForm)&&(0==a.rollback_info.propackage_list.length||x())?(a.control.btnBus_loading=!0,void e.saveReadyInfo(h).then(function(c){c&&(a.control.btnBus_loading=!1,b.close(!0))},function(b){a.control.btnBus_loading=!1,g.alert(b.message,3)})):!1},a.cancel=function(){b.dismiss()},A()}]),modal_m.controller("addMonitorLogCtrl",["$scope","$modalInstance","$timeout","modalParam","Exec","Collection","EncodingType","Modal",function(a,b,c,d,e,f,g,h){var i=d.business_sys_name,j=(d.project_name,d.environment_id),k=d.node;a.monitor_log_info={node_ip:"",checked_files:[]},a.data={node_list:[],encode_type_list:g,all_checked_list:[]},a.node={path_files:[],checked_files:[],paths:[]},a.control={node_loading:!1,is_update:!1};var l,m=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.lable=c.file_soc_username+"@"+c.ip,c.index=b}},n=function(){a.data.node_list=[],a.control.node_loading=!0,e.getDefinePhyInfo(i,j).then(function(b){b&&(a.control.node_loading=!1,a.data.node_list=b.phy_node_list?b.phy_node_list:[],m(a.data.node_list))},function(b){h.alert(b.message,3),a.control.node_loading=!1})},o=function(b){var c=b,d="";c=c.length>1&&c.lastIndexOf("/")==c.length-1?c.slice(0,c.length-1):c;var e=c.lastIndexOf("/");c?-1==e?a.node.paths=[c]:1==c.length&&0==e?a.node.paths=[c]:0==e?(d="/",a.node.paths=[c.slice(1)]):(d=c.slice(0,e+1),a.node.paths=[c.slice(e+1)]):a.node.paths=[]},p=function(){n(),k&&(a.data.all_checked_list=angular.copy(k))};a.getFileList=function(b){var c={};c=a.data.node_list[b],a.node.paths=[],a.node.path_files=[],a.node.init_path=c.init_path?c.init_path:"",a.node.check_soc_name=c.execute_soc_name,a.node.download_soc_name=c.file_soc_name,a.node.execute_ip=c.ip,a.node.err_msg="",a.node.loading=!0;var d={node_ip:b,label:c.lable,business_sys_name:i,soc_name:a.node.check_soc_name,checked_files:[]};l=b;var e=0;if(0==a.data.all_checked_list.length)d.checked_files=a.node.checked_files,a.data.all_checked_list.push(d);else{for(var g=0;g<a.data.all_checked_list.length;g++){var h=a.data.all_checked_list[g];h.node_ip==b?(a.node.checked_files=h.checked_files,e=1):h.node_ip!=b&&0==h.checked_files.length&&a.data.all_checked_list.splice(g--,1)}0==e&&(a.node.checked_files=[],d.checked_files=a.node.checked_files,a.data.all_checked_list.push(d))}f.getFileListBySoc(c.file_soc_name,a.node.init_path,c.ip).then(function(b){a.node.loading=!1,a.node.init_temp=b.root_bk_dir,a.node.init_path=a.node.init_temp,o(a.node.init_temp),a.node.path_files=b.file_bean_list?b.file_bean_list:[]},function(b){a.node.paths=[],a.node.init_path="",a.node.path_files=[],a.init_temp="",a.node.loading=!1,a.node.err_msg=b.message})},a.changePath=function(b){if(0!=a.data.all_checked_list.length)for(var d=0;d<a.data.all_checked_list.length;d++){var e=a.data.all_checked_list[d];e.node_ip==l&&(a.node.checked_files=e.checked_files)}b.loading=!0,c(function(){f.getFileListBySoc(b.download_soc_name,b.full_path,b.ip).then(function(a){b.loading=!1,b.path_files=a.file_bean_list?a.file_bean_list:[]},function(a){b.paths=[],b.loading=!1,b.err_msg=a.message})},0)},a.saveMonitorNode=function(){if(a.monitor_log_info.checked_files=a.node.checked_files,0==a.monitor_log_info.checked_files.length)return h.alert("请至少选择一个监控日志文件！",3),!1;for(var c=0;c<a.monitor_log_info.checked_files.length;c++)if(!a.monitor_log_info.checked_files[c].word_coding)return h.alert("请选择文件的编码方式！",3),!1;b.close(a.data.all_checked_list)},a.cancel=function(){b.dismiss()},p()}]),modal_m.controller("configExecNodeCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal","CV",function(a,b,c,d,e,f){var g=d.phase_info;a.phase_info={},a.control={is_parallel:!0,is_quick_publish:d.quick_publish?d.quick_publish:2},a.data={};var h=function(){a.phase_info=angular.copy(g),a.control.is_parallel=a.phase_info.parallel_flag};a.changeNodeExec=function(a,b){b.is_exec=!b.is_exec},a.saveConfigInfo=function(){a.phase_info.parallel_flag=a.control.is_parallel,b.close(a.phase_info)},a.cancel=function(){b.dismiss()},h()}]),modal_m.controller("changeExecResultCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal","CV",function(a,b,c,d,e,f){d.node_info;a.form={},a.result_info={msg:""},a.control={},a.data={};var g=function(){};a.saveResult=function(){return f.valiForm(a.form.new_result_form)?void b.close(a.result_info):!1},a.cancel=function(){b.dismiss(!1)},g()}]),modal_m.controller("viewfileFullScreenCtrl",["$scope","$modalInstance","$timeout","modalParam","CodeMirrorOption","Version","Modal","CV",function(a,b,c,d,e,f,g,h){var i;a.file_info=d.file_info?d.file_info:{},a.file_post_header=d.file_post_header?d.file_post_header:{},a.codemethod_loading=!1,a.detailFileOptions={lineWrapping:!0,lineNumbers:!0,scrollbarStyle:"simple",readOnly:!0,refresh:!1,mode:"text/x-properties"};var j=function(){c(function(){k(),a.detailFileOptions.refresh=!0},800),a.has_file_icon=a.file_info.file_type>=1&&a.file_info.file_type<4},k=function(){var a=$("#modal-codemirror .CodeMirror");if(a.is(":visible")){var b=$(window).height()-parseInt(a.offset().top)-15;a.height(b)}},l=function(){a.codemethod_loading=!0,f.viewfileContent(a.file_post_header).then(function(b){a.file_info.file_content=b.file_content?Base64.decode(b.file_content):"",a.file_info.file_size=b.file_size?b.file_size:"",a.file_info.file_update_time=b.file_update_time?b.file_update_time:"",a.detailFileOptions.refresh=!0,a.codemethod_loading=!1},function(b){a.codemethod_loading=!1})};a.formatFileIconStyle=function(){var b="";return b=1==a.file_info.file_type?"txt-icon":2==a.file_info.file_type||3==a.file_info.file_type?"excel-icon":9==a.file_info.file_type?"tar-icon":""},a.changeCodeMethod=function(){i=a.file_post_header.encoding_type,"UTF-8"===i&&(a.file_post_header.encoding_type="GBK"),
"GBK"===i&&(a.file_post_header.encoding_type="UTF-8"),l()},a.downloadFile=function(){var b={file_absolute_path:a.file_post_header.absolute_path,file_path:a.file_post_header.file_path,version_num:a.file_post_header.version_num,business_sys_name:d.business_sys_name,is_dir:!1};f.downloadFile(b).then(function(a){c(function(){a.download_url&&h.downloadFile(a.download_url)},0)},function(a){})},a.formCancel=function(){b.dismiss(!1)},$(window).resize(function(){c(function(){k()},100)}),j()}]),modal_m.controller("setNormalWindowTimeCtrl",["$scope","$modalInstance","PubWindow","ScrollConfig","Modal","CV",function(a,b,c,d,e,f){a.dateObj={start_bk_datetime:f.dtFormat(new Date),end_bk_datetime:"",cycle_type:0,cycles:[],minDate:new Date},a.control={opened:!1,startTimeFlag:!1,save_loading:!1,viewtime_error:""},a.config={scroll_info:d};var g=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.open_time=[parseInt(c.hh)<10?"0"+parseInt(c.hh):parseInt(c.hh),":",parseInt(c.mi)<10?"0"+parseInt(c.mi):parseInt(c.mi)].join("")}},h=function(){};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.control.opened=!0},a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1)},a.addCirlTime=function(){a.dateObj.errorM||a.dateObj.cycles.push({cycle_type:a.dateObj.cycle_type,cycle_number:1,hh:0,mi:0,duration:1})},a.changeTimeUnitType=function(b){a.dateObj.cycle_type=b,0==a.dateObj.cycles.length?a.dateObj.cycles.push({cycle_type:a.dateObj.cycle_type,cycle_number:1,hh:0,mi:0,duration:1}):(a.dateObj.cycles[a.dateObj.cycles.length-1].cycle_type=b,a.dateObj.cycles[a.dateObj.cycles.length-1].cycle_number=1)},a.$watch("dateObj",function(){a.dateObj.start_bk_datetime?a.control.startTimeFlag=!1:a.control.startTimeFlag=!0},!0),a.ok=function(){if(!a.control.startTimeFlag&&!a.dateObj.errorM){if(!a.dateObj.end_bk_datetime)return e.alert("结束时间不可为空",3),!1;if(0==a.dateObj.cycles.length)return e.alert("时间周期不可为空",3),!1;if(a.dateObj.start_bk_datetime&&a.dateObj.end_bk_datetime&&+a.dateObj.start_bk_datetime>+a.dateObj.end_bk_datetime)return e.alert("开始时间不可大于结束时间！",3),!1;g(a.dateObj.cycles),a.control.save_loading=!0,c.saveRoutineWindow(f.dtFormat(a.dateObj.start_bk_datetime),f.dtFormat(a.dateObj.end_bk_datetime),a.dateObj.cycles).then(function(c){console.log(c),a.control.save_loading=!1,b.close(!0)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})}},a.close=function(){b.dismiss(!1)},h()}]),modal_m.controller("setSpecialWindowTimeCtrl",["$scope","$modalInstance","ScrollConfig","PubWindow","Modal","CV",function(a,b,c,d,e,f){a.dateObj={cycles:[]},a.cus_date={date:"",minDate:new Date},a.control={save_loading:!1},a.config={scroll_info:c};var g=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.open_time=[parseInt(c.hh)<10?"0"+parseInt(c.hh):parseInt(c.hh),":",parseInt(c.mi)<10?"0"+parseInt(c.mi):parseInt(c.mi)].join("")}},h=function(){};a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1)},a.$watch("cus_date.date",function(){if(""!=a.cus_date.date&&a.cus_date.date){for(var b=a.cus_date.date.getFullYear()+"年"+(a.cus_date.date.getMonth()+1)+"月"+a.cus_date.date.getDate()+"日",c=f.dtFormat(a.cus_date.date),d=0;d<a.dateObj.cycles.length;d++){var g=a.dateObj.cycles[d];if(b==g.date_str)return e.alert("已经存在该日期！！！",3),!1}a.dateObj.cycles.push({hh:0,mi:0,open_date:c,date_str:b,duration:0})}},!0),a.ok=function(){if(!a.dateObj.errorM){if(0==a.dateObj.cycles.length)return e.alert("特殊日期不可为空",3),!1;g(a.dateObj.cycles),a.control.save_loading=!0,d.saveSpecialWindow(a.dateObj.cycles).then(function(c){a.control.save_loading=!1,b.close(!0)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})}},a.close=function(){b.dismiss(!1)},h()}]),modal_m.controller("setBlackWindowTimeCtrl",["$scope","$modalInstance","ScrollConfig","PubWindow","Modal","CV",function(a,b,c,d,e,f){a.dateObj={cycles:[],special_reason:""},a.cus_date={date:"",minDate:new Date},a.control={save_loading:!1},a.config={scroll_info:c};var g=function(){};a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1)},a.$watch("cus_date.date",function(){if(""!=a.cus_date.date&&a.cus_date.date){for(var b=f.dtFormat(a.cus_date.date),c=0;c<a.dateObj.cycles.length;c++){var d=a.dateObj.cycles[c];if(b==d)return e.alert("已经存在该日期！！！",3),!1}a.dateObj.cycles.push(b)}},!0),a.ok=function(){a.control.save_loading=!0,d.saveSpecialDayWindow(a.dateObj.special_reason,a.dateObj.cycles).then(function(c){a.control.save_loading=!1,b.close(a.dateObj)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})},a.close=function(){b.dismiss(!1)},g()}]),modal_m.controller("closeWindowCtrl",["$scope","$modalInstance","modalParam","PubWindow","Modal","CV",function(a,b,c,d,e,f){var g=c.window;a.form={},a.result_info={msg:""},a.control={save_loading:!1};var h=function(){};a.saveResult=function(){return f.valiForm(a.form.pub_window_form)?(g.close_reason=a.result_info.msg,a.control.save_loading=!0,void d.closePubWindow(g).then(function(c){a.control.save_loading=!1,b.close(!0)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})):!1},a.cancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("viewWindowDetailCtrl",["$scope","$modalInstance","modalParam","ScrollBarConfig","ProjectStatus","Project","Modal","CV",function(a,b,c,d,e,f,g,h){var i=c.event;a.info={close_reason:i.close_reason,pjpublish_id:i.pjpublish_id,error_message:"",publish_info:{}},a.config={scroll:d.Y()},a.control={get_project_loading:!1};var j=function(){a.info.error_message="",a.control.get_project_loading=!0,f.viewReleaseApply(a.info.pjpublish_id).then(function(b){b&&(a.control.get_project_loading=!1,a.info.publish_info=b.publish_bean||{})},function(b){a.control.get_project_loading=!1,a.info.error_message=b.message})};a.close=function(){b.dismiss(!1)},j()}]),modal_m.controller("releaseAppAddProjectCtrl",["$scope","$modalInstance","modalParam","PubWindow","ProjectStatus","Modal","CV",function(a,b,c,d,e,f,g){a.info={error_message:"",proj_list:[]},a.control={proj_list_loading:!0};var h=function(){};a.formSubmit=function(){a.info.proj_list.length>0&&b.close(a.info.proj_list)},a.formCancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("prepareChooseCtrl",["$scope","$state","$modalInstance","modalParam","Modal","CV",function(a,b,c,d,e,f){d.syspublish_id,d.business_sys_name;a.info={},a.data={},a.control={};var g=function(){};a.goToExecute=function(){c.close(1)},a.cancel=function(){c.close(2)},g()}]),modal_m.controller("interactiveExecuteCtrl",["$scope","$timeout","$modalInstance","modalParam","EncodingType","ScrollBarConfig","CodeMirrorOption","Exec","Modal",function(a,b,c,d,e,f,g,h,i){var j,k=d.execute_id||"",l="",m="";a.info={phase_name:d.phase_desc||"交互式SQL",phase_info:{node_list:[]},curr_node:{}},a.data={encoding:e},a.control={refresh_codemirror:!1,show_setting:!1,close_monitor:!1,show_notification:!1},a.config={scroll_bar:{axis:"y",theme:"custom-dark",scrollbarPosition:"outside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},fileReadOnlyLoaded:g.Sql("nocursor"),fileEditLoaded:function(b){g.setSqlFileEditor(b),b.on("blur",function(){l=b.somethingSelected()?b.getSelection():""}),b.on("focus",function(){a.control.show_setting=!1})}};var n=function(a){var b="";return 1e3>a?b=a+"毫秒":(b=Math.floor(a/1e3)+"秒",b>60&&(b=Math.floor(a/1e3)/60+"分")),b},o=function(c,d){a.msg_notification=c||"",a.control.show_notification=!0,d=d||3,a.control.add_enter_class=!0,b(function(){a.control.add_enter_class=!1,a.control.add_leave_class=!0,b(function(){a.msg_notification="",a.control.show_notification=!1},500)},1e3*d)},p=function(a){b(function(){a.change_encoding_loading=!1},1e3)},q=function(a,b){b.page_option.start_recd=b.page_option.limit_recd*(a-1),b.page_tbodys=b.tbodys.slice(b.page_option.start_recd,b.page_option.start_recd+b.page_option.limit_recd)},r=function(){if(!a.control.close_monitor){var c=a.info.curr_node||{};console.log(c,"当前节点对象"),h.interactiveSqlExeMonitor(k).then(function(a){var d=a.sql_exe_msg;if(d){c.exe_info_list=c.exe_info_list||[],0===c.exe_info_list.length&&c.exe_info_list.unshift(d[0]);for(var e=[],g=0;g<d.length;g++){var h=d[g];if(c.node_ip===h.node_ip){h.theads=h.theads||[],h.tbodys=h.tbodys||[],h.exe_timeused_cn=n(h.exe_timeused||0),h.disbaled_operate_btn=!h.tran_flag,h.scroll_x=f.X(),h.page_tbodys=h.tbodys.length>5?h.tbodys.slice(0,5):h.tbodys,h.page_option={curr:1,all:1,all_recd:h.tbodys.length,count:5,start_recd:0,limit_recd:5,click:function(a){q(a,h)}};for(var i=!0,j=0;j<c.exe_info_list.length;j++){var k=c.exe_info_list[j];h.exe_id===k.exe_id&&(c.exe_info_list[j]=h,i=!1)}i&&e.unshift(h)}}c.exe_info_list=e.concat(c.exe_info_list),b(function(){r()},100)}},function(a){console.log(a.message)})}},s=function(){h.interactiveSqlGetNode(k).then(function(c){b(function(){a.info.phase_info.node_list=c.node_list||[];for(var b=0;b<a.info.phase_info.node_list.length;b++){var d=a.info.phase_info.node_list[b];d.file_list=d.file_list||[],d.exe_info_list=d.exe_history_list?d.exe_history_list.reverse():[];for(var e=0;e<d.exe_info_list.length;e++){var g=d.exe_info_list[e];g.theads=g.theads||[],g.tbodys=g.tbodys||[],g.scroll_x=f.X(),g.exe_timeused_cn=n(g.exe_timeused||0),g.disbaled_operate_btn=!g.tran_flag,g.page_tbodys=g.tbodys.length>5?g.tbodys.slice(0,5):g.tbodys,g.page_option={curr:1,all:1,all_recd:g.tbodys.length,count:5,start_recd:0,limit_recd:5,click:function(a){q(a,g)}}}for(var h=0;h<d.file_list.length;h++){var i=d.file_list[h];i.is_original_area=!1,i.delimiter=i.delimiter||";",i.encoding_type=i.encoding_type||"UTF-8",i.file_edit_content=i.file_content}}a.info.phase_info.node_list.length&&(a.info.curr_node=a.info.phase_info.node_list[0],r())},0)},function(a){i.alert(a.message,3)})};a.changeTab=function(c,d){m="",l="",a.hidenGroupList(),a.info.curr_node=c,c.curr_file_index=d||0,b(function(){a.control.refresh_codemirror=!a.control.refresh_codemirror},100)},a.changeCoding=function(a,b){return b.encoding_type=a,b.change_encoding_loading=!0,m===a?!1:(p(b),void(m=a))},a.hidenGroupList=function(){a.control.show_setting=!1},a.showAnimate=function(a){j=b(function(){$("."+a).animate({right:"2px"},200,"linear")},200)},a.hiddenAnimate=function(a){j&&(b.cancel(j),j=null),j=b(function(){$("."+a).animate({right:"-97px"},200,"linear")},200)},a.syncHeight=function(){return{height:$(".node-container").height()+"px"}},a.exeSql=function(a){l?(a.generate_sql_loading=!0,a.curr_file_index=a.curr_file_index||0,h.interactiveSqlExeSql(k,a.node_ip,a.file_list[a.curr_file_index].delimiter,l).then(function(c){b(function(){a.generate_sql_loading=!1},0)},function(a){o(a.message,2)})):o("请选择SQL",2)},a.firstSqlHeight=function(a){1===a.sql_statement_list.length&&(a.hide_more_btn=$(".sql-block .row:first-child").height()<=26)},a.expandOrCollapseMoreSql=function(a,b){a.show_sql_more=!a.show_sql_more;var c=$("#sql-block-"+b),d=c.height();if(a.show_sql_more){var e=c.css("height","auto").height();c.height(d).animate({height:e},500)}else c.animate({height:"24px"})},a.exeStatusToCn=function(a){var b="";switch(a){case 1:b="执行中";break;case 2:b="执行成功";break;case 3:b="执行出错";break;case 4:b="回滚成功";break;case 5:b="提交成功";break;default:b="执行中"}return b},a.sqlOperate=function(a,b){h.interactiveSqlSubmitOrRollback(k,b,a.exe_id).then(function(a){var c=1==b?"已提交":"已回滚";i.alert(c,1)},function(a){i.alert(a.message,3)})},a.cancel=function(){i.confirm("确认关闭"+a.info.phase_name+" ?").then(function(b){b&&(a.control.close_monitor=!0,h.interactiveSqlClose(k).then(function(a){a&&c.close(!0)},function(a){i.alert(a.message)}))})},a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.control.close_monitor=!0}),s()}]),modal_m.controller("viewCmptDetailModalCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","modalParam","CodeMirrorOption","CmptFunc","pluginType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=f.id;a.config={view_sh_options:g.Sh(!0),view_sql_options:g.Sql(!0),view_py_options:g.Python(!0),view_java_options:g.Java(!0)},a.control={cmpt_detail_loading:!1,error_message:!1},a.info={cmpt_info:{}};var m=function(){d.viewModulegetModuleDetail(l).then(function(b){c(function(){a.control.cmpt_detail_loading=!0,a.info.cmpt_info={id:l,publish_state:b.publish_state,cn_name:b.component.cn_name,bk_desc:b.component.bk_desc,impl_type:b.component.impl_type,impl_type_cn:k.findValue(b.component.impl_type,e),ref_flag:b.ref_flag,file_path:b.file_path,param_list:b.component.param_list||[],out_param_list:b.component.out_param_list||[],cmds:b.component.cmds||[],script_list:b.component.script_list||[],language_version:b.component.language_version,tag_list:b.component.tag_list||[],plugin_list:b.component.plugin_list||[]},a.info.cmpt_info.script_list.length>0&&a.info.cmpt_info.script_list[0].cmds&&angular.forEach(a.info.cmpt_info.script_list,function(a){a.exec_script=h.cmdsToString(a.cmds),a.active="default"==a.script_type?!0:!1,a.code_mirror_control=!1}),a.info.cmpt_info.exec_script=h.cmdsToString(a.info.cmpt_info.cmds),b.component.command&&b.component.command.cmds&&(a.info.cmpt_info.command={exec_script:h.cmdsToString(b.component.command.cmds),cmds:b.component.command.cmds})},0)},function(b){j.alert(b.message,3),a.control.error_message=!0})};a.getPluginTypeCnName=function(a){return k.findValue(a,i)},a.selectScript=function(b){c(function(){a.info.cmpt_info.script_list[b].code_mirror_control=!0},200)},a.closeModal=function(){b.dismiss(!1)},m()}]),modal_m.controller("CmptSysCtrl",["$scope","$modalInstance","$timeout","CmptSysType","Modal",function(a,b,c,d,e){a.form={},a.control={other_flag:!1},a.data={sys_list:d},a.info={},a.formSubmit=function(){var c=a.info.script_type?a.info.script_type:a.info.other_script_type?a.info.other_script_type:"";return c?void b.close(c):void e.alert("请选择或填写脚本类型",3)},a.cancel=function(){b.dismiss()},a.selectScriptType=function(b){b?(a.info.other_script_type="",c(function(){a.control.other_flag=!1},50)):a.control.other_flag=!0}}]),modal_m.controller("CmptClassifyLabelCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal",function(a,b,c,d,e){a.form={},a.data={cmpt_label_list:angular.copy(d.data?d.data:[])},a.info={},a.control={valid_length_falg:!1},a.selectLabel=function(b,c){b.flag=!b.flag,!b.flag&&b.is_new&&a.data.cmpt_label_list.splice(c,1)},a.addNewLabel=function(b){if(""!=b&&void 0!=b){if(console.log(b.length),b.length>=50)return void(a.control.valid_length_falg=!0);a.control.valid_length_falg=!1;for(var c=0;c<a.data.cmpt_label_list.length;c++){var d=a.data.cmpt_label_list[c];if(d.value===b)return}a.data.cmpt_label_list.push({value:b,is_new:!0,flag:!0}),a.info.label=""}},a.formSubmit=function(){b.close(a.data.cmpt_label_list)},a.cancel=function(){b.dismiss()}}]),modal_m.controller("addCmptModalCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h,i){a.info={high_search_obj:{exec_type_list:angular.copy(e),classify_list:[]},error_message:"",cmpt_type:g.cmpt_type,cmpt_flag:g.cmpt_flag,cmpts_list:[],cmpt_list:[]},a.control={cmpt_list_loading:!0,search_flag:!0,tags_more_flag:!1,classify_flag:!1};var j=function(){2==a.info.cmpt_type&&d.getPublishedCmpt(a.info.cmpt_type,a.info.cmpt_flag).then(function(b){c(function(){b&&(a.info.cmpts_list=b.comp_list?b.comp_list:[],a.control.cmpt_list_loading=!1)},0)},function(b){a.info.error_message=b.message}),d.selectAllTas().then(function(b){b&&c(function(){for(var c=b.tag_list?b.tag_list:[],d=0;d<c.length;d++)a.info.high_search_obj.classify_list.push({value:c[d],flag:!1})},0)},function(a){h.alert(a.message,3)})},k=function(){for(var a=0;a<arguments.length;a++)for(var b=0;b<arguments[a].length;b++)arguments[a][b]=angular.extend(arguments[a][b],{flag:!1})};a.clear=function(){a.search_key_word=""},a.clearData=function(){k(a.info.high_search_obj.classify_list,a.info.high_search_obj.exec_type_list),a.info.high_search_obj.key_word=""},a.cancelSeniorSearch=function(){a.control.search_flag=!0},a.changeSearchFlag=function(b){a.control.search_flag=!1,b.stopPropagation()},a.formSubmit=function(){var c=[];if(a.info.cmpt_list.length>0)for(var d=0;d<a.info.cmpt_list.length;d++){var e=a.info.cmpt_list[d];e.checked&&c.push(e.id)}if(a.info.cmpts_list.length>0)for(var f=0;f<a.info.cmpts_list.length;f++){var g=a.info.cmpts_list[f];1==g.checked&&c.push(g.id)}0==c.length?h.alert("请至少选择一组",3):b.close(c)},a.formCancel=function(){b.dismiss(!1)},a.countTagDivHeight=function(){c(function(){var b=$(".classify-tag-id").height();b>48?a.control.classify_flag=!0:a.control.classify_flag=!1},500)},j()}]),modal_m.controller("modifyPhaseCtrl",["$scope","$modalInstance","$timeout","CmptFunc","IML_TYPE","CodeMirrorOption","envManage","Plugin","modalParam","pluginType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n=1;a.form={},a.phase_info={is_update:1,impl_type:"",language_version:"",cn_name:"",exec_script:"",plugin_list:[],command:{cmds:[],exec_script:""}},a.control={cmpt_save_disabled:!1},a.data={subgroup_list:e,language_version_list:[],plugin_list:[],plugin_hint_list:[],ref_param_list:d.translateAllParam(i.ref_param_list)},a.shellLoaded=function(b){m=b,f.setEditor(b),m.on("keypress",function(){a.data.ref_param_list&&0!=a.data.ref_param_list.length?m.showHint({pluginKeys:a.data.plugin_hint_list.concat(a.data.ref_param_list)}):m.showHint()})},a.commandShellLoaded=function(b){f.setUniqueParamsEditor(b,n,a.data.plugin_hint_list)},a.commandNoneShellLoaded=function(b){f.setNoneParamsEditor(b,n,a.data.plugin_hint_list)},a.cmpt_accessory_fileupload={suffixs:"",filetype:"",filename:"",uploadpath:""};var o=function(b){h.getAllPluginList(b).then(function(b){b&&(a.data.plugin_list=b.plugin_list?b.plugin_list:[])},function(a){})},p=function(){g.getUploadPath().then(function(b){b&&(a.cmpt_accessory_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(a){})},q=function(){i.is_update&&2!=i.is_update||(a.phase_info.is_update=i.is_update,a.phase_info.impl_type=i.impl_type,o(a.phase_info.impl_type),(14==a.phase_info.impl_type||7==a.phase_info.impl_type||8==a.phase_info.impl_type)&&(a.data.language_version_list=["1.5","1.6","1.7","1.8"]),a.phase_info.language_version=i.language_version,n=a.phase_info.impl_type<6?1:6==a.phase_info.impl_type?4:7==a.phase_info.impl_type||8==a.phase_info.impl_type?2:14==a.phase_info.impl_type?3:1,a.phase_info.cn_name=i.cn_name,a.phase_info.exec_script=i.exec_script,a.phase_info.plugin_list=i.plugin_list?i.plugin_list:[],a.phase_info.annex_file=i.annex_file,a.phase_info.command=i.command,a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),a.cmpt_accessory_fileupload.filename=i.annex_file?i.annex_file.substring(i.annex_file.lastIndexOf("/")+1):"",c(function(){15!=a.phase_info.impl_type&&(m.setOption("mode",4==n?"text/x-sql":2==n?"text/x-python":3==n?"text/x-java":"text/x-sh"),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0||a.data.ref_param_list&&0!=a.data.ref_param_list.length?m.showHint({pluginKeys:a.data.plugin_hint_list.concat(a.data.ref_param_list)}):m.showHint()}))},100)),p()};a.chooseImplType=function(b){a.data.language_version_list=[],a.data.plugin_list=[],a.phase_info.plugin_list=[],a.data.plugin_hint_list=[],n=6>b?1:6==b?4:7==b||8==b?2:14==b?3:1,m.setOption("mode",4==n?"text/x-sql":2==n?"text/x-python":3==n?"text/x-java":"text/x-sh"),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0?m.showHint({pluginKeys:a.data.plugin_hint_list}):m.showHint()}),14==b||7==b||8==b?a.data.language_version_list=["1.5","1.6","1.7","1.8"]:a.phase_info.language_version="",o(b)},a.addAvailablePlugin=function(){if(0!=a.phase_info.plugin_list.length){for(var b=0;b<a.phase_info.plugin_list.length;b++)if(!a.phase_info.plugin_list[b].plugin_name)return k.alert("请选择插件名",3),!1;if(a.data.plugin_list.length==a.phase_info.plugin_list.length)return k.alert("无可再添加的插件！",3),!1}a.phase_info.plugin_list.push({plugin_name:"",plugin_type:"",plugin_file_name:"",plugin_bk_desc:""})},a.bindPluginInfo=function(b,c,e){for(var f={},g=0;g<a.phase_info.plugin_list.length;g++){var h=a.phase_info.plugin_list[g].plugin_name;if(f[h])return k.alert("插件已经添加！",3),a.phase_info.plugin_list.splice(c,1),!1;f[h]=1}for(var i=0;i<a.data.plugin_list.length;i++){var j=a.data.plugin_list[i];if(b==j.plugin_name){e.plugin_type=j.plugin_type,e.plugin_file_name=j.plugin_file_name,e.plugin_bk_desc=j.plugin_bk_desc;break}}a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0||a.data.ref_param_list&&0!=a.data.ref_param_list.length?m.showHint({pluginKeys:a.data.plugin_hint_list.concat(a.data.ref_param_list)}):m.showHint()})},a.getPluginTypeCnName=function(a){return l.findValue(a,j)},a.deleteSinglePlugin=function(b){var c=a.phase_info.plugin_list[b].plugin_name;c?k.confirm("确认是否要删除[ "+c+" ]插件?").then(function(){a.phase_info.plugin_list.splice(b,1),a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0?m.showHint({pluginKeys:a.data.plugin_hint_list}):m.showHint()})}):(a.phase_info.plugin_list.splice(b,1),a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0?m.showHint({pluginKeys:a.data.plugin_hint_list}):m.showHint()}))},a.ImportAccessorySuccessThen=function(){a.phase_info.annex_file=a.cmpt_accessory_fileupload.uploadpath+"/"+a.cmpt_accessory_fileupload.filename},a.removeAccessoryFile=function(){a.cmpt_accessory_fileupload.filename="",a.phase_info.annex_file=""},a.downloadAccessoryFile=function(){l.downloadFile(a.phase_info.annex_file)},a.savePhase=function(){return l.valiForm(a.form.new_phase_form)?(a.phase_info.cmds=d.stringToCmds(a.phase_info.exec_script),a.phase_info.command&&a.phase_info.command.exec_script&&(a.phase_info.command.cmds=d.stringToCmds(a.phase_info.command.exec_script)),a.phase_info.phase_type=3,b.close(a.phase_info),void(a.show_phase=!1)):!1},a.formCancel=function(){b.dismiss(!1)},a.downLoadPlugin=function(a){l.downloadFile(a)},q()}]),modal_m.controller("programCurConfigCtrl",["$scope","$modalInstance","$timeout","modalParam","NodeReform","Collection","BusiSys","ProtocolType","Sys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=d.business_sys_name,n=d.node_soc_list?angular.copy(d.node_soc_list):[],o="";a.info={node_info:{logical_node_id:"",logical_node_name:"",node_list:[],node_soc_list:[]},node_dir:{path_files:[],checked_files:[],paths:[],init_path:""},form:{}},a.data={logic_node_list:[]},a.control={node_loading:!1,is_update:!1};var p=function(b){var c=b,d="";c=c.length>1&&c.lastIndexOf("/")==c.length-1?c.slice(0,c.length-1):c;var e=c.lastIndexOf("/");c?-1==e?a.info.node_dir.paths=[c]:1==c.length&&0==e?a.info.node_dir.paths=["/"]:0==e?(d="/",a.info.node_dir.paths=[c.slice(1)]):(d="/",a.info.node_dir.paths=c.slice(1).split("/")):a.info.node_dir.paths=[]},q=function(){if(a.data.logic_node_list=d.logic_node_list?d.logic_node_list:[],0!=n.length){var b=n[0];l=b.logical_node_id,a.info.node_info.logical_node_id=b.logical_node_id,a.info.node_info.logical_node_name=b.logical_node_name,a.getFileList(a.info.node_info.logical_node_id,a.info.node_info.logical_node_name)}};a.getFileList=function(b,c){0!=a.info.node_info.node_soc_list.length&&(a.info.node_info.node_soc_list[0].checked_files=[]),a.info.node_info.logical_node_name=c,a.info.node_dir.paths=[],a.info.node_dir.loading=!0,a.info.node_dir.init_path="",i.getRemoteDirectory(m,b,a.info.node_dir.init_path).then(function(b){b&&(a.info.node_dir.loading=!1,o=b.root_bk_dir,a.info.node_dir.init_path=o,p(o),a.info.node_dir.path_files=b.file_bean_list?b.file_bean_list:[])},function(b){a.info.node_dir.loading=!1,a.info.node_dir.err_msg=b.message})},a.changePath=function(){a.info.node_dir.loading=!0,0==n.length&&(a.info.node_info.node_soc_list=[]),i.getRemoteDirectory(m,a.info.node_info.logical_node_id,a.info.node_dir.full_path).then(function(b){if(b)if(a.info.node_dir.loading=!1,a.info.node_dir.path_files=b.file_bean_list?b.file_bean_list:[],0==n.length){var c={logical_node_name:a.info.node_info.logical_node_name,logical_node_id:a.info.node_info.logical_node_id,file_list:[],checked_files:[]};c.checked_files=a.info.node_dir.checked_files,a.info.node_info.node_soc_list.push(c)}else if(l==a.info.node_info.logical_node_id){var d=n[0];d.checked_files=[],d.file_list=d.file_list?d.file_list:[];for(var e=0;e<d.file_list.length;e++){var f=d.file_list[e];d.checked_files.push({path:f.substring(0,f.lastIndexOf("/")),file:f.substring(f.lastIndexOf("/")+1)})}a.info.node_info.node_soc_list=n,a.info.node_dir.checked_files=a.info.node_info.node_soc_list[0].checked_files}else{a.info.node_info.node_soc_list=[];var c={logical_node_name:a.info.node_info.logical_node_name,logical_node_id:a.info.node_info.logical_node_id,file_list:[],checked_files:[]};c.checked_files=a.info.node_dir.checked_files,a.info.node_info.node_soc_list.push(c)}},function(b){a.info.node_dir.loading=!1,a.info.node_dir.err_msg=b.message})},a.saveData=function(){if(!k.valiForm(a.info.form))return!1;var c=a.info.node_info.node_soc_list[0];if(!c||0==c.checked_files.length)return void j.alert("请选择文件",3);c.file_list=[],c.files_list=[];for(var d=0;d<c.checked_files.length;d++)"/"==c.checked_files[d].path.charAt(0)&&"/"==c.checked_files[d].path.charAt(1)?(c.file_list.push(c.checked_files[d].path.substring(2)+"/"+c.checked_files[d].file),c.files_list.push({file:c.checked_files[d].path.substring(2)+"/"+c.checked_files[d].file,ready_flag:!0})):(c.file_list.push(c.checked_files[d].path+"/"+c.checked_files[d].file),c.files_list.push({file:c.checked_files[d].path+"/"+c.checked_files[d].file,ready_flag:!0}));b.close(a.info.node_info.node_soc_list)},a.cancel=function(){b.dismiss()},q()}]),modal_m.controller("programManualPhaseCtrl",["$scope","$modalInstance","ScrollConfig","$sce","$timeout","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h){var i=f.script;a.info={manual:{},form:{},manual_phase_form:{}},a.config={scroll_info:c},a.info.manual.script="",a.control={link_show_flag:!1};var j=function(){i&&(a.info.manual.script=f.script.cmds[0],e(function(){$("#manual_id").html(a.info.manual.script)},300))},k=function(a,b){var c,d;if(window.getSelection){if(c=window.getSelection(),c.getRangeAt&&c.rangeCount){d=c.getRangeAt(0),d.deleteContents();var e=document.createElement("div");e.innerHTML=a;for(var f,g,h=document.createDocumentFragment();f=e.firstChild;)g=h.appendChild(f);var i=h.firstChild;d.insertNode(h),g&&(d=d.cloneRange(),d.setStartAfter(g),b?d.setStartBefore(i):d.collapse(!0),c.removeAllRanges(),c.addRange(d))}}else if((c=document.selection)&&"Control"!=c.type){var j=c.createRange();j.collapse(!0),c.createRange().pasteHTML(a),b&&(d=c.createRange(),d.setEndPoint("StartToStart",j),d.select())}};a.saveUrl=function(){if(!h.valiForm(a.info.form))return!1;var b=$("#manual_id").html();$("#manual_id").text()||(b=$("#manual_id").html().replace(/<br>/g,"")),$("#manual_id").html(b+'[<a href="'+a.info.manual.link_url+'" title="'+a.info.manual.link_url+'" target="_blank">'+a.info.manual.link_intro+"</a>]"),a.info.manual.link_intro="",a.info.manual.link_url="",a.info.form.$setPristine(),a.control.link_show_flag=!1},a.deleteUrl=function(){a.control.link_show_flag=!1,a.info.manual.link_intro="",a.info.manual.link_url=""},a.saveData=function(){var a=$("#manual_id").html();return""==$("#manual_id").text()?void g.alert("请输入内容",3):void b.close(a)},a.changeLine=function(a){13==a.keyCode&&k("<br>",!1)},a.cancel=function(){b.dismiss(!1)},e(function(){$("[contenteditable]").each(function(){try{document.execCommand("AutoUrlDetect",!1,!1)}catch(a){}$(this).on("paste",function(a){a.preventDefault();var b=null;if(b=window.clipboardData&&clipboardData.setData?window.clipboardData.getData("text"):(a.originalEvent||a).clipboardData.getData("text/plain")||prompt("在这里输入文本"),document.body.createTextRange){if(document.selection)var c=document.selection.createRange();else if(window.getSelection){var d=window.getSelection(),e=d.getRangeAt(0),f=document.createElement("span");f.innerHTML="&#FEFF;",e.deleteContents(),e.insertNode(f),c=document.body.createTextRange(),c.moveToElementText(f),f.parentNode.removeChild(f)}c.text=b,c.collapse(!1),c.select()}else document.execCommand("insertText",!1,b)}),$(this).on("keydown",function(a){if(a.ctrlKey||a.metaKey)switch(a.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:a.preventDefault()}})})},0),j()}]),modal_m.controller("programBatchConfigCtrl",["$scope","$modalInstance","$timeout","modalParam","ScrollConfig","NodeReform","BusiSys","ProtocolType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k,l=[],m=[],n=d.control,o=d.business_sys_name,p=d.srv_soc?d.srv_soc:[];a.form={},a.config={scroll_info:e},a.data_deal_info={},a.controls={next_step_flag:!1,operate_btn:1,copy_flag:!0,ip_loading:!1,soc_flag:!0,soc_config_type:1,check_phase_flag:!1,deal_loading:!1},a.data={copy_soc_list:[],phase_item:[]},a.program_info={group_list:[]},a.scroll_config_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:500,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},a.normal_ip_list=[],a.extra_ip_list=[],a.source_list=[],a.reqData={imply_type:"",two_soc_loading:!1,business_sys_name:o,two_soc:!1,check_ip:"",search_ver_key:"",protocol_type:"",normal_ip_list:[],extra_ip_list:[],ip_data_list:[],mid_ip_list:[],search_key_work:"",srv_soc:[],copy_soc_list:[]},a.sourceType_color=[{s_type:1,color:"#88B8FE",bg:"#F5F9FE"},{s_type:5,color:"#7BADA4",bg:"#D2F6EE"},{s_type:9,color:"#FC973E",bg:"#FFF4ED"},{s_type:10,color:"#88B8FE",bg:"#EAF8FC"},{s_type:14,color:"#FC973E",bg:"#FFF4ED"}];var q=function(){for(var b=0;b<d.group_list.length;b++){d.group_list[b].group_index=b;for(var c=0;c<d.group_list[b].phase_list.length;c++)d.group_list[b].phase_list[c].phase_index=c,d.group_list[b].phase_list[c].select_flag=!1}m=d.group_list,a.program_info.group_list=angular.copy(d.group_list)},r=function(b){for(var c=0;c<a.reqData.normal_ip_list.length;c++)b.exe_ip==a.reqData.normal_ip_list[c].exe_ip&&(a.reqData.normal_ip_list[c].is_show=!1)},s=function(b){if(1==a.controls.soc_config_type)if(a.reqData.two_soc){for(var c=0;c<a.reqData.extra_ip_list.length;c++)if(!a.reqData.extra_ip_list[c].delete_flag){var d={};d.exe_ip=a.reqData.extra_ip_list[c].exe_ip,d.exe_soc_list=[],d.ver_soc_list=[];for(var e=0;e<a.reqData.extra_ip_list[c].exe_soc_list.length;e++)d.exe_soc_list.push({soc_name:a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.extra_ip_list[c].exe_soc_list[e].state&&(d.exe_soc_name=a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,d.exe_protocol_type=a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type);for(var f=0;f<a.reqData.extra_ip_list[c].ver_ip_list.length;f++)if(a.reqData.extra_ip_list[c].ver_ip_list[f].is_check){d.ver_ip=a.reqData.extra_ip_list[c].ver_ip_list[f].ver_ip;for(var g=0;g<a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list.length;g++)d.ver_soc_list.push({soc_name:a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].ver_soc_name,protocol_type:a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].protocol_type}),a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].state&&(d.ver_soc_name=a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].ver_soc_name,d.ver_protocol_type=a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].protocol_type);break}d.exe_soc_name&&d.ver_soc_name&&(d.execute_ip=d.exe_ip,d.execute_soc_name=d.exe_soc_name,d.execute_protocol_type=d.exe_protocol_type,d.support_soc_name=d.ver_soc_name,d.support_ip=d.ver_ip,d.support_protocol_type=d.ver_protocol_type,a.reqData.srv_soc.push(d))}}else for(var c=0;c<a.reqData.normal_ip_list.length;c++)if(a.reqData.normal_ip_list[c].is_show){var h={};h.exe_soc_list=[],h.exe_ip=a.reqData.normal_ip_list[c].exe_ip;for(var e=0;e<a.reqData.normal_ip_list[c].exe_soc_list.length;e++)h.exe_soc_list.push({
soc_name:a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.normal_ip_list[c].exe_soc_list[e].state&&(h.exe_soc_name=a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,h.exe_protocol_type=a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type);h.exe_soc_name&&(h.execute_ip=h.exe_ip,h.execute_soc_name=h.exe_soc_name,h.execute_protocol_type=h.exe_protocol_type,a.reqData.srv_soc.push(h))}for(var i=1==a.controls.soc_config_type?a.reqData.srv_soc:a.reqData.copy_soc_list,c=0;c<b.length;c++)for(var j=b[c],e=0;e<j.phase_list.length;e++)j.phase_list[e].select_flag&&(j.phase_list[e].node_soc_list=i)},t=function(b,c){a.data.copy_soc_list=[];for(var d=0,e=0;e<b.length;e++)for(var f=0;f<b[e].phase_list.length;f++){var g=b[e].phase_list[f];g.node_soc_list&&0!=g.node_soc_list.length&&c==g.impl_type&&(a.data.copy_soc_list.push({phase_name:g.phase_name,node_soc_list:g.node_soc_list,status:!1,phase_type:g.phase_type,copy_index:d}),d++)}},u=function(b){for(var c=[],d=a.data_deal_info.group_index,e=a.data_deal_info.phase_index,f=0;f<a.program_info.group_list.length;f++){var g=a.program_info.group_list[f];if(g.state)c=c.concat(angular.copy(g.phase_list));else for(var h=0;h<g.phase_list.length;h++)g.phase_list[h].select_flag&&c.push(angular.copy(g.phase_list[h]))}var i=b[d].phase_list.slice(0,e+1),j=b[d].phase_list.slice(e+1);b[d].phase_list=i.concat(c).concat(j)},v=function(){u(l)},w=function(){a.controls.ip_loading=!0,(a.reqData.imply_type>2&&a.reqData.imply_type<6||14==a.reqData.imply_type||15==a.reqData.imply_type)&&(a.reqData.two_soc=!0),a.reqData.ip_data_list=[],a.reqData.normal_ip_list=[],a.reqData.extra_ip_list=[],f.getIpWithProtocolAndSoc(o,a.reqData.imply_type).then(function(b){a.controls.ip_loading=!1;for(var c=b.node_list?b.node_list:[],d=0;d<c.length;d++){var e=c[d];a.reqData.ip_data_list.push(e.node_ip),a.reqData.two_soc||a.reqData.normal_ip_list.push({exe_ip:e.node_ip,exe_soc_list:[],is_show:!1,exe_soc_name:""})}for(var f=0;f<p.length;f++){if(!p[f].exe_soc_list){p[f].exe_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].exe_ip&&(p[f].exe_soc_list=c[g].exe_soc_list)}if(!p[f].ver_soc_list){p[f].ver_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].ver_ip&&(p[f].ver_soc_list=c[g].ver_soc_list)}}if(a.reqData.two_soc){for(var d=0;d<p.length;d++){for(var h=0;h<p[d].ver_soc_list.length;h++)p[d].ver_soc_list[h].ver_soc_name=p[d].ver_soc_list[h].soc_name,p[d].ver_soc_name==p[d].ver_soc_list[h].soc_name?p[d].ver_soc_list[h].state=!0:p[d].ver_soc_list[h].state=!1;for(var h=0;h<p[d].exe_soc_list.length;h++)p[d].exe_soc_list[h].exe_soc_name=p[d].exe_soc_list[h].soc_name,p[d].exe_soc_name==p[d].exe_soc_list[h].soc_name?p[d].exe_soc_list[h].state=!0:p[d].exe_soc_list[h].state=!1}for(var d=0;d<p.length;d++){for(var i=[],h=0;h<a.reqData.ip_data_list.length;h++)a.reqData.ip_data_list[h]==p[d].ver_ip?i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!0,ver_soc_list:p[d].ver_soc_list}):i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!1,ver_soc_list:[]});a.reqData.extra_ip_list.push({exe_ip:p[d].exe_ip,exe_soc_list:p[d].exe_soc_list,is_show:!1,delete_flag:!1,exe_soc_name:p[d].exe_soc_name,ver_ip_list:i,ver_ip:p[d].ver_ip})}}else for(var d=0;d<p.length;d++)for(var h=0;h<a.reqData.normal_ip_list.length;h++)if(p[d].exe_ip==a.reqData.normal_ip_list[h].exe_ip){a.reqData.normal_ip_list[h].is_show=!0,a.reqData.normal_ip_list[h].exe_soc_list=[],a.reqData.normal_ip_list[h].exe_soc_name=p[d].exe_soc_name;for(var j=0;j<p[d].exe_soc_list.length;j++)p[d].exe_soc_list[j].soc_name==p[d].exe_soc_name?a.reqData.normal_ip_list[h].exe_soc_list.push({state:!0,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type}):a.reqData.normal_ip_list[h].exe_soc_list.push({state:!1,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type})}},function(b){a.controls.ip_loading=!1,i.alert(b.message,3)})},x=function(b){for(var c=0;c<b.length;c++){var d=b[c];if(d.state)d.phase_list=[],d.owner_flag&&(n.owner_btn_flag=!0);else for(var e=0;e<d.phase_list.length;e++)d.phase_list[e].select_flag&&(5==d.phase_list[e].phase_type&&4==a.controls.operate_btn&&(n.owner_btn_flag=!0),d.phase_list.splice(e--,1))}};a.getPhaseItem=function(b){if(a.data.phase_item=[],1==a.controls.operate_btn)a.data.phase_item=a.program_info.group_list[b].phase_list;else{l=angular.copy(a.program_info.group_list),x(l);for(var c=0;c<l[b].phase_list.length;c++){var d=l[b].phase_list[c];d.phase_index=c}a.data.phase_item=l[b].phase_list}},a.clearVerIp=function(){a.reqData.search_ver_key=""},a.locationVerword=function(){for(var b=0,c=0;c<a.reqData.extra_ip_list.length;c++)if(a.reqData.extra_ip_list[c].exe_ip==a.reqData.check_ip){b=c;break}if(a.reqData.mid_ip_list=[],""==a.reqData.search_ver_key)for(var c=0;c<a.reqData.ip_data_list.length;c++)a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c]);else for(var c=0;c<a.reqData.ip_data_list.length;c++){var d=a.reqData.ip_data_list[c].indexOf(a.reqData.search_ver_key);-1!=d&&a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c])}for(var c=0;c<a.reqData.mid_ip_list.length;c++){for(var e=a.reqData.mid_ip_list[c],d=!1,f=0;f<a.reqData.extra_ip_list[b].ver_ip_list.length;f++)e==a.reqData.extra_ip_list[b].ver_ip_list[f].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.push({ver_ip:e,ver_soc_list:[],is_check:!1})}for(var c=a.reqData.extra_ip_list[b].ver_ip_list.length-1;c>=0;c--)if(!a.reqData.extra_ip_list[b].ver_ip_list[c].is_check){for(var d=!1,f=0;f<a.reqData.mid_ip_list.length;f++)a.reqData.mid_ip_list[f]==a.reqData.extra_ip_list[b].ver_ip_list[c].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.splice(c,1)}},a.checkNodeIP=function(b){if(b.is_show=!b.is_show,0==b.exe_soc_list.length){b.is_loading=!0;var c=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;""==o?Cmpt.getAllSocList(b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,i.alert(a.message,3)}):g.getSocListByIpAndBsys(o,b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,i.alert(a.message,3)})}b.is_show||r(b)},a.click_dataSource=function(b,c,d){b.state=!b.state;for(var e=0;e<a.reqData.normal_ip_list.length;e++)if(a.reqData.normal_ip_list[e].exe_ip==c)for(var f=0;f<a.reqData.normal_ip_list[e].exe_soc_list.length;f++)f!=d&&(a.reqData.normal_ip_list[e].exe_soc_list[f].state=!1)},a.selectTwo=function(){c(function(){a.addNodeIp(a.reqData.search_key_work)},10)},a.addNodeIp=function(b){if(""!=b){for(var c=!1,d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip==b&&(c=!0);if(!c){a.reqData.check_ip=b;for(var e=[],f="",h=[],d=0;d<a.reqData.ip_data_list.length;d++)h.push({ver_ip:a.reqData.ip_data_list[d],is_check:!1,ver_soc_list:[]});""==o?Cmpt.getAllSocList(b,2).then(function(c){for(var d=c.source_list?c.source_list:[],g=0;g<d.length;g++)new RegExp("agent").test(d[g])?(f.exe_soc_name=d[g],e.push({exe_soc_name:d[g].soc_name,state:!0,protocol_type:d[g].protocol_type})):e.push({exe_soc_name:d[g].soc_name,state:!1,protocol_type:d[g].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:[],ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:[],ver_ip:""}),i.alert(error.message,3)}):g.getSocListByIpAndBsys(o,b,2).then(function(c){for(var d=c.source_list?c.source_list:[],g=0;g<d.length;g++)new RegExp("agent").test(d[g])?(f.exe_soc_name=d[g],e.push({exe_soc_name:d[g].soc_name,state:!0,protocol_type:d[g].protocol_type})):e.push({exe_soc_name:d[g].soc_name,state:!1,protocol_type:d[g].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:h,ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:h,ver_ip:""}),i.alert(error.message,3)});for(var d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip!=b&&(a.reqData.extra_ip_list[d].is_show=!1)}}},a.clickNodeIP=function(b,c){if(a.reqData.check_ip==b.exe_ip)b.is_show=!1,a.reqData.check_ip="";else{a.reqData.check_ip=b.exe_ip;for(var d=0;d<a.reqData.extra_ip_list.length;d++)b.exe_ip!=a.reqData.extra_ip_list[d].exe_ip?a.reqData.extra_ip_list[d].is_show=!1:a.reqData.extra_ip_list[d].is_show=!0}},a.checkDeleteFlag=function(a,b){b.stopPropagation(),a.delete_flag=!a.delete_flag},a.clickExeDataSource=function(b,c,d){for(var e=0;e<a.reqData.extra_ip_list[d].exe_soc_list.length;e++)e!=c&&(a.reqData.extra_ip_list[d].exe_soc_list[e].state=!1);a.reqData.extra_ip_list[d].exe_soc_list[c].state=!a.reqData.extra_ip_list[d].exe_soc_list[c].state},a.clickVerNode=function(b,c,d){0==a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list.length&&(a.reqData.tow_soc_loading=!0,""==o?Cmpt.getAllSocList(b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,i.alert(b.message,3)}):g.getSocListByIpAndBsys(o,b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,i.alert(b.message,3)}));for(var e=0;e<a.reqData.extra_ip_list[d].ver_ip_list.length;e++)a.reqData.extra_ip_list[d].ver_ip_list[e].is_check=!1;a.reqData.extra_ip_list[d].ver_ip_list[c].is_check=!0},a.clickVerSource=function(b,c,d,e){for(var f=0;f<a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list.length;f++)f!=c&&(a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[f].state=!1);a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state=!a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state},a.getProtocolTypeCnName=function(a){return j.findValue(a,h)},a.find_dataSource_color=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].color},a.find_dataSource_bgcolor=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].bg},a.selectCopySoc=function(b){var c=a.data.copy_soc_list[b].node_soc_list;a.reqData.copy_soc_list=c},a.checkUsage=function(b){a.data_deal_info.group_index="",1==b?a.controls.copy_flag&&(a.controls.operate_btn=b):3==b?a.controls.soc_flag&&(a.controls.operate_btn=b,w()):a.controls.operate_btn=b},a.selectAllCheck=function(a,b){for(var c=0;c<a.phase_list.length;c++)b?(a.phase_list[c].select_flag=!0,5==a.phase_list[c].phase_type&&(a.owner_flag=!0)):(a.phase_list[c].select_flag=!1,5==a.phase_list[c].phase_type&&(a.owner_flag=!1))},a.nextStep=function(){for(var b=[],c=0;c<a.program_info.group_list.length;c++)for(var d=a.program_info.group_list[c],e=0;e<d.phase_list.length;e++)if(d.phase_list[e].select_flag)if(a.controls.check_phase_flag=!0,d.phase_list[e].phase_type>3){if(a.controls.soc_flag=!1,a.controls.operate_btn=2,5==d.phase_list[e].phase_type){a.controls.operate_btn=2,a.controls.copy_flag=!1;break}}else 0==b.length?b.push(d.phase_list[e].impl_type):-1==b.indexOf(d.phase_list[e].impl_type)&&(a.controls.soc_flag=!1,a.controls.operate_btn=2);return a.controls.check_phase_flag?(a.controls.step_flag=!0,void(0!=b.length&&(a.reqData.imply_type=b[0],3==a.controls.operate_btn&&a.reqData.imply_type!=k&&w(),a.controls.soc_flag&&t(a.program_info.group_list,a.reqData.imply_type)))):(i.alert("请选择阶段！"),void(a.controls.deal_loading=!1))},a.preStep=function(){k=a.reqData.imply_type,a.controls.step_flag=!1,a.controls.copy_flag=!0,a.controls.soc_flag=!0,a.data_deal_info.group_index="",a.controls.check_phase_flag=!1},a.cancel=function(){b.dismiss(!1)},a.saveData=function(){return j.valiForm(a.form.batch_from)?(a.controls.deal_loading=!0,void c(function(){if(1==a.controls.operate_btn)u(m);else if(2==a.controls.operate_btn)v(),m=l;else{if(4==a.controls.operate_btn)return l=angular.copy(a.program_info.group_list),x(l),void b.close(l);l=angular.copy(a.program_info.group_list),s(l),m=l}a.controls.deal_loading=!1,b.close(m)},200)):!1},q()}]),modal_m.controller("configCheckItemCtrl",["$scope","$modalInstance","$timeout","modalParam","CmptFunc","BusiSys","Cmpt","CmptType","ProtocolType","IML_TYPE","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=d.phase,o={},p={},q={script:{},phase_type:1},r={},s={cn_name:"",tag_list:[],data:{sort:"crt_bk_date,crt_bk_time",order:"desc",offset:0,limit:12},impl_types:"",start_modify_date:"",end_modify_date:"",crt_user_id:"",publish_state:1,component_purpose:1};a.cmpt_info={param_list:[],script_list:[],exe_soc_list:[],ver_soc_list:[],cmpt_list:[]},a.info={high_search_obj:{search_key_word:"",exec_type_list:angular.copy(j),classify_list:[]},user:""},a.config={form:{},view_options:k.Sh(!0)},a.control={search_flag:!0,tags_more_flag:!1,soc_config_flag:!1,script_loading:!1,cmpt_list_loading:!1,classify_flag:!1},a.data=d.user_info;var t=function(b){a.control.cmpt_list_loading=!0,g.getCmptPageList(b).then(function(b){c(function(){b&&(a.control.cmpt_list_loading=!1,a.cmpt_info.cmpt_list=b.comp_list?b.comp_list:[])},0)},function(b){a.control.cmpt_list_loading=!1,a.cmpt_info.error_message=b.message})},u=function(){for(var a=0;a<arguments.length;a++)for(var b=0;b<arguments[a].length;b++)arguments[a][b]=angular.extend(arguments[a][b],{flag:!1})},v=function(){c(function(){a.control.script_loading=!0},200),n.phase_name?(q.phase_name=n.phase_name,q.impl_type=n.impl_type,a.cmpt_info.impl_type=n.impl_type,a.cmpt_info.param_list=n.param_list,a.cmpt_info.exec_script=e.cmdsToString(n.script.cmds),a.control.soc_config_flag=!0,a.cmpt_info.cmpt_list=[{cn_name:n.phase_name,is_checked:!0}],o={execute_ip:n.node_soc_list[0].execute_ip,execute_protocol_type:n.node_soc_list[0].execute_protocol_type,execute_soc_name:n.node_soc_list[0].execute_soc_name},p={support_ip:n.node_soc_list[0].support_ip,support_protocol_type:n.node_soc_list[0].support_protocol_type,support_soc_name:n.node_soc_list[0].support_soc_name}):t(s),g.selectAllTas().then(function(b){b&&c(function(){for(var c=b.tag_list?b.tag_list:[],d=0;d<c.length;d++)a.info.high_search_obj.classify_list.push({value:c[d],flag:!1})},0)},function(a){l.alert(a.message,3)})};a.paramShellLoaded=function(a){k.setParamsEditor(a)},a.changeSearchFlag=function(b){a.control.search_flag=!1,b.stopPropagation()},a.clear=function(){a.info.high_search_obj.search_key_word=""},a.seniorSearch=function(){r.tag_list=[],r.impl_types=[];for(var b=0;b<a.info.high_search_obj.exec_type_list.length;b++)a.info.high_search_obj.exec_type_list[b].flag&&r.impl_types.push(a.info.high_search_obj.exec_type_list[b].key);for(var b=0;b<a.info.high_search_obj.classify_list.length;b++)a.info.high_search_obj.classify_list[b].flag&&r.tag_list.push(a.info.high_search_obj.classify_list[b].value);s.cn_name=a.info.high_search_obj.key_word,s.tag_list=r.tag_list,s.impl_types=r.impl_types,t(s),a.info.high_search_obj.search_key_word="",a.control.search_flag=!0},a.searchSubgroupByKeyword=function(){s.cn_name=a.info.high_search_obj.search_key_word,s.tag_list=[],s.impl_types=[],t(s)},a.clearData=function(){u(a.info.high_search_obj.classify_list,a.info.high_search_obj.exec_type_list),a.info.high_search_obj.key_word=""},a.checkCheckCmpt=function(b){b.id&&(angular.forEach(a.cmpt_info.cmpt_list,function(a){a.is_checked=!1}),b.is_checked=!0,q.phase_name=b.cn_name,a.control.script_loading=!1,g.viewModulegetModuleDetail(b.id).then(function(b){c(function(){if(b){a.cmpt_info.param_list=b.component.param_list?b.component.param_list:[],a.cmpt_info.script_list=b.component.script_list?b.component.script_list:[];for(var c=0;c<a.cmpt_info.script_list.length;c++)a.cmpt_info.script_list[c].exec_script=e.cmdsToString(a.cmpt_info.script_list[c].cmds),a.cmpt_info.script_list[c].script_type_cn="default"==a.cmpt_info.script_list[c].script_type?"缺省":a.cmpt_info.script_list[c].script_type;a.cmpt_info.script_type=b.component.script_list[0].script_type,a.cmpt_info.exec_script=b.component.script_list[0].exec_script,a.cmpt_info.impl_type=b.component.impl_type?b.component.impl_type:"",q.impl_type=a.cmpt_info.impl_type,q.script.cmds=e.stringToCmds(a.cmpt_info.exec_script),a.control.script_loading=!0}},0)},function(b){a.control.script_loading=!0,l.alert(b.message,3)}))},a.selectScriptByScriptType=function(a,b){for(var c=0;c<b.script_list.length;c++)if(b.script_list[c].script_type==a){b.exec_script=b.script_list[c].exec_script;break}},a.getProtocolTypeCnName=function(a){return m.findValue(a,i).toLowerCase()},a.cancelSeniorSearch=function(){a.control.search_flag=!0},a.countTagDivHeight=function(){c(function(){var b=$(".classify-tag-id").height();b>48?a.control.classify_flag=!0:a.control.classify_flag=!1},500)},a.save=function(){return q.phase_name?m.valiForm(a.config.form.user_form)&&(0==a.cmpt_info.param_list.length||m.valiForm(a.config.form.param_form))?(q.script.cmds=e.stringToCmds(a.cmpt_info.exec_script),q.node_soc_list=[angular.extend(o,p)],q.param_list=a.cmpt_info.param_list,void b.close(q)):!1:void l.alert("请选择组件")},a.cancel=function(){b.dismiss(!1)},v()}]),modal_m.controller("ServerAgentDeployCtrl",["$scope","$modalInstance","$timeout","modalParam","ProtocolType","Server","Modal","CV",function(a,b,c,d,e,f,g,h){a.form={},a.info={srv_info:{server_ip:d.server_ip,soc_name:""},agent_status:parseInt(d.agent_status),error_message:"",deploy_steps:[{status:1,step:"步骤一",value:"校验文件传输协议"},{status:1,step:"步骤二",value:"检测运行环境"},{status:1,step:"步骤三",value:"安装运行环境"},{status:1,step:"步骤四",value:"安装AGENT"},{status:1,step:"步骤五",value:"启动AGENT"},{status:1,step:"步骤六",value:"检测AGENT端口连接"},{status:1,step:"步骤七",value:"安装成功"}]},a.data=d.user_info,a.control={deploy_status:1===parseInt(d.agent_status)?1:3};var i=function(b){for(var c=0;c<a.info.deploy_steps.length;c++){var d=a.info.deploy_steps[c];d.status=b}},j=function(){i(1===parseInt(d.agent_status)?1:4)};a.deployAgent=function(){(h.valiForm(a.form.deploy_form)||6!=a.control.deploy_status&&1!=a.control.deploy_status)&&(i(1),a.info.deploy_steps[0].status=2,a.control.deploy_status=2,f.testFileTransform(a.info.srv_info.server_ip,a.info.srv_info.user).then(function(b){return a.info.deploy_steps[0].status=b.success?4:3,a.info.error_message=b.result||"",a.info.soc_list=b.soc_list||[],b.success?void c(function(){a.info.deploy_steps[1].status=2,f.testRunEnv(a.info.soc_list).then(function(b){return a.info.deploy_steps[1].status=b.success?4:3,a.info.error_message=b.result||"",a.info.deploy_path=b.deploy_path||"",b.success?void c(function(){a.info.deploy_steps[2].status=2,f.deployRunEnv(a.info.soc_list,b.sys_type,b.sys_bit,b.agent_run_env_flag).then(function(d){c(function(){return a.info.deploy_steps[2].status=d.success?4:3,a.info.error_message=d.result||"",d.success?(a.info.deploy_steps[3].status=2,void f.deployAgent(a.info.soc_list).then(function(d){return a.info.deploy_steps[3].status=d.success?4:3,a.info.error_message=d.result||"",d.success?void c(function(){a.info.deploy_steps[4].status=2,f.startAgent(a.info.soc_list,a.info.deploy_path,b.agent_run_env_flag).then(function(b){return a.info.deploy_steps[4].status=b.success?4:3,a.info.error_message=b.result||"",b.success?void c(function(){a.info.deploy_steps[5].status=2,f.testAgentPort(a.info.soc_list).then(function(b){return a.info.deploy_steps[5].status=b.success?4:3,a.info.error_message=b.result||"",b.success?void c(function(){a.info.deploy_steps[6].status=2,c(function(){a.info.deploy_steps[6].status=4,a.control.deploy_status=3},1500)},400):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[5].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},400):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[4].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},400):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[3].status=3,a.control.deploy_status=4,a.info.error_message=b.message})):void(a.control.deploy_status=4)},400)},function(b){a.info.deploy_steps[2].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},800):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[1].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},800):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[0].status=3,a.control.deploy_status=4,a.info.error_message=b.message}))},a.uninstallAgent=function(){a.control.deploy_status=5,f.uninstallAgentByIp(a.info.srv_info.server_ip).then(function(b){a.control.deploy_status=6,i(1),a.info.agent_status=1},function(b){a.control.deploy_status=7,a.info.error_message=b.message})},a.cancel=function(){return 2==a.control.deploy_status?void g.alert("Agent部署中，不能关闭。"):(a.info.agent_status=3==a.control.deploy_status?3:1,void b.close(a.info.agent_status))},j()}]),modal_m.controller("cmptGroupDetailModalCtrl",["$scope","$modalInstance","$timeout","$routeParams","Cmpt","CodeMirrorOption","modalParam","CmptFunc","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=d.id;a.cmpt_group_control={nav_show_flag:0,expand_flag:!1};var m=function(){a.cmpt_group_info={id:"",cn_name:"",bk_desc:"",modules:[],params:[],publish_state:"",file_path:"",ref_flag:""}},n=function(){m(),e.checkCmptGroupReference(l,2).then(function(b){c(function(){b&&(a.cmpt_group_info.ref_flag=b.ref_flag)},0)},function(a){j.alert(a.message,3)}),e.viewSingleCmptGroup(l).then(function(b){c(function(){b.module_group&&(a.cmpt_group_info.cn_name=b.module_group.cn_name,a.cmpt_group_info.id=b.module_group.id,a.cmpt_group_info.bk_desc=b.module_group.bk_desc,a.cmpt_group_info.params=b.module_group.params?b.module_group.params:[],a.cmpt_group_info.publish_state=b.publish_state,a.cmpt_group_info.modules=b.module_group.modules?b.module_group.modules:[],a.cmpt_group_info.file_path=b.file_path,angular.forEach(a.cmpt_group_info.modules,function(a,b,c){a.params=a.params?a.params:[],a.ref_params=a.ref_params?a.ref_params:[],a.alias_name=a.alias_name?a.alias_name:a.cn_name,a.show_detail=!1,a.cmds&&0!=a.cmds.length&&(a.exec_script=h.cmdsToString(a.cmds)),a.impl_type&&(a.impl_type_formcat=k.findValue(a.impl_type,i))}))},0)},function(a){j.alert(a.message,3),$location.url("/cmpt/cmpts_list")})};a.editorOptions=f.Sh(!0),a.toggleModulesDetail=function(b){b.show_detail=!b.show_detail,a.cmpt_group_control.nav_show_flag=h.judgeShowDetail(a.cmpt_group_info.modules),2==a.cmpt_group_control.nav_show_flag?a.cmpt_group_control.expand_flag=!0:a.cmpt_group_control.expand_flag=!1},a.collapseAll=function(){a.cmpt_group_control.nav_show_flag=h.closeAllModules(a.cmpt_group_info.modules)},a.expandAll=function(){a.cmpt_group_control.nav_show_flag=h.expandAllModules(a.cmpt_group_info.modules)},a.stopPrevent=function(a){a.stopPropagation()},a.horizontalLineStyle=function(){return{width:"50px",height:"1px",position:"absolute",background:"#CCC",left:"20px",top:"15px"}},a.verticalLineStyle=function(){return{width:"1px",height:"100%",position:"absolute",background:"#77BBEE",left:"15px",top:"23px"}},a["return"]=function(){b.dismiss(!1)},n()}]),modal_m.controller("cmptGroupPublishPhaseSocModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Cmpt","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h){if(a.stepData={},a.stepInfo={type:d.step.type,cn_name:d.step.alias_name,srv_soc:d.step.srv_soc?angular.copy(d.step.srv_soc):[],flag:d.flag,impl_type:d.step.impl_type,impl_type_cn:h.findValue(d.step.impl_type,f),old_srv_soc:d.step.srv_soc?angular.copy(d.step.srv_soc):[],copy_soc:!0,package_list:d.step.package_list,package_names:d.step.package_names,testPreObj:d.testPreObj},!d.flag)for(var i=0;i<a.stepInfo.package_list.length;i++)a.stepInfo.package_list[i].flag&&a.stepInfo.package_names.push(a.stepInfo.package_list[i].package_name);a.preStepSoc=d.preStepSoc?d.preStepSoc:[],a.form={stepForm:{}},a.copySoc=function(){a.stepInfo.srv_soc=angular.copy(a.preStepSoc),a.stepInfo.copy_original_flag=!0,a.stepInfo.copy_shell_flag=!0},a.getSocByServer=function(b,d){a.stepInfo.copy_original_flag&&1==a.stepInfo.testPreObj.soc_ip_list.length?a.stepInfo.copy_original_flag=!1:c(function(){if(4==d||3==d||5==d){var c=a.stepInfo.srv_soc[b].soc_list;a.stepInfo.srv_soc[b].soc_list=[],""!=a.stepInfo.srv_soc[b].exe_ip&&a.stepInfo.srv_soc[b].exe_ip&&e.getAllSocList(a.stepInfo.srv_soc[b].exe_ip,2).then(function(d){d.soc_list.join("-")!=c.join("-")?(a.stepInfo.srv_soc[b].soc_list_loading=!1,a.stepInfo.srv_soc[b].soc_list=d.source_list?d.source_list:[],a.stepInfo.srv_soc[b].exe_soc_name=""):a.stepInfo.srv_soc[b].soc_list=d.soc_list?d.soc_list:[]},function(c){a.stepInfo.srv_soc[b].soc_list_loading=!1,g.alert(c.message,3)})}else{var c=a.stepInfo.srv_soc[b].soc_list;a.stepInfo.srv_soc[b].soc_list=[],""!=a.stepInfo.srv_soc[b].exe_ip&&a.stepInfo.srv_soc[b].exe_ip&&e.getAllSocList(a.stepInfo.srv_soc[b].exe_ip,d).then(function(d){d.soc_list.join("-")!=c.join("-")?(a.stepInfo.srv_soc[b].soc_list_loading=!1,a.stepInfo.srv_soc[b].soc_list=d.source_list?d.source_list:[],a.stepInfo.srv_soc[b].exe_soc_name=""):a.stepInfo.srv_soc[b].soc_list=d.soc_list?d.soc_list:[]},function(c){a.stepInfo.srv_soc[b].soc_list_loading=!1,g.alert(c.message,3)})}},500)},a.getShellSocByServer=function(b,d){a.stepInfo.copy_shell_flag&&1==a.stepInfo.testPreObj.soc_ip_list.length?a.stepInfo.copy_shell_flag=!1:c(function(){var c=a.stepInfo.srv_soc[b].shell_soc_list;a.stepInfo.srv_soc[b].shell_soc_list=[],""!=a.stepInfo.srv_soc[b].ver_ip&&a.stepInfo.srv_soc[b].ver_ip&&e.getAllSocList(a.stepInfo.srv_soc[b].ver_ip,d).then(function(d){d.soc_list.join("-")!=c.join("-")?(a.stepInfo.srv_soc[b].shell_soc_list_loading=!1,a.stepInfo.srv_soc[b].shell_soc_list=d.source_list?d.source_list:[],a.stepInfo.srv_soc[b].ver_soc_name=""):a.stepInfo.srv_soc[b].shell_soc_list=d.soc_list?d.soc_list:[]},function(c){a.stepInfo.srv_soc[b].shell_soc_list_loading=!1,g.alert(c.message,3)})},500)},a.removeOneSoc=function(b){a.stepInfo.srv_soc.splice(b,1)},a.addSoc=function(){a.stepData.soc_list=[];var b=a.stepInfo.srv_soc.length;0==b?a.stepInfo.srv_soc.push({exe_ip:"",exe_soc_name:"",ver_ip:"",ver_soc_name:"",soc_list:[],shell_soc_list:[]}):""==a.stepInfo.srv_soc[b-1].server_name?g.alert("请完善服务器名！"):a.stepInfo.srv_soc.push({exe_ip:"",exe_soc_name:"",ver_ip:"",ver_soc_name:"",soc_list:[],shell_soc_list:[]})},a.formSubmit=function(){if(a.stepInfo.flag)b.close("cancel");else{if(!h.valiForm(a.form.stepForm))return!1;b.close(a.stepInfo)}},a.cancel=function(){b.close("cancel")},a.selectItem=function(b){b.flag?a.stepInfo.package_names.push(b.package_name):a.stepInfo.package_names.splice(a.stepInfo.package_names.indexOf(b.package_name),1)}}]),modal_m.controller("addPluginCtrl",["$scope","$modalInstance","$timeout","modalParam","Plugin","Modal","CodeMirrorOption","CmptFunc","pluginType","envManage","CV",function(a,b,c,d,e,f,g,h,i,j,k){a.data={plugin_type_list:i},a.plugin_info={plugin_name:d.plugin_name,plugin_bk_desc:"",plugin_type:"",plugin_file_name:"",install_command:"",uninstall_command:""},a.control={change_type:!1,btn_loading:!1,get_path_loading:!0,is_update:d.is_update?d.is_update:!1,error_message:""},a.config={lib_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},add_plugin_form:{}};var l=function(){4==a.plugin_info.plugin_type?a.editOptions=g.Python():6==a.plugin_info.plugin_type?a.editOptions=g.Vbs():a.editOptions=g.Sh(),a.control.change_type=!1,c(function(){a.control.change_type=!0},10)},m=function(){j.getUploadPath().then(function(b){b&&(a.control.get_path_loading=!1,a.config.lib_fileupload.uploadpath=b.upload_path?b.upload_path:"",l())},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message}),d.is_update&&e.viewPluginInfo(d.plugin_name).then(function(b){c(function(){b.plugin&&(a.plugin_info.plugin_bk_desc=b.plugin.plugin_bk_desc?b.plugin.plugin_bk_desc:"",a.plugin_info.plugin_type=b.plugin.plugin_type?b.plugin.plugin_type:"",a.plugin_info.plugin_file_name=b.plugin.plugin_file_name?b.plugin.plugin_file_name:"",a.plugin_info.install_command=b.plugin.install_command?b.plugin.install_command:"",a.plugin_info.uninstall_command=b.plugin.uninstall_command?b.plugin.uninstall_command:"",a.config.lib_fileupload.filename=b.plugin.plugin_file_name?b.plugin.plugin_file_name.substring(b.plugin.plugin_file_name.lastIndexOf("/")+1):"",a.control.get_path_loading=!1,l())},0)},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message})};a.fileUploadSuccessThen=function(){a.plugin_info.plugin_file_name=a.config.lib_fileupload.uploadpath+"/"+a.config.lib_fileupload.filename;for(var b=a.config.lib_fileupload.filename.substring(a.config.lib_fileupload.filename.lastIndexOf(".")+1),c=0;c<a.data.plugin_type_list.length;c++)if(b===a.data.plugin_type_list[c].value){a.plugin_info.plugin_type=a.data.plugin_type_list[c].key,l();break}},a.removePluginFile=function(){a.config.lib_fileupload.filename="",a.plugin_info.plugin_file_name="",a.plugin_info.plugin_type="",l()},a.downloadPluginFile=function(){a.plugin_info.plugin_file_name&&k.downloadFile(a.plugin_info.plugin_file_name)},a.changePluginType=function(){l()},a.save=function(){return k.valiForm(a.config.add_plugin_form)?a.plugin_info.plugin_file_name?(a.control.btn_loading=!0,void(a.control.is_update?e.updateNewPlugin(a.plugin_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3)}):e.addNewPlugin(a.plugin_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3)}))):(f.alert("请上传插件文件",3),!1):!1},a.back=function(){b.dismiss(!1)},m()}]),modal_m.controller("addResourceCtrl",["$scope","$modalInstance","$timeout","modalParam","CommonResources","Modal","pluginType","envManage","CV",function(a,b,c,d,e,f,g,h,i){a.resource_info={resources_name:d.resources_name,resources_desc:""},a.control={btn_loading:!1,get_path_loading:!0,is_update:d.is_update?d.is_update:!1,error_message:""},a.config={lib_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},add_resource_form:{}};var j=function(){h.getUploadPath().then(function(b){b&&(a.control.get_path_loading=!1,a.config.lib_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message}),d.is_update&&e.viewResources(d.resources_name).then(function(b){c(function(){b.resourcesInfo&&(a.resource_info.resources_desc=b.resourcesInfo.resource_desc?b.resourcesInfo.resource_desc:"",a.resource_info.resources_file_path=b.resourcesInfo.resource_file_path?b.resourcesInfo.resource_file_path:"",a.config.lib_fileupload.filename=b.resourcesInfo.resource_file_path?b.resourcesInfo.resource_file_path.substring(b.resourcesInfo.resource_file_path.lastIndexOf("/")+1):"",a.control.get_path_loading=!1)},0)},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message;
})};a.fileUploadSuccessThen=function(){a.resource_info.resources_file_path=a.config.lib_fileupload.uploadpath+"/"+a.config.lib_fileupload.filename},a.removeResourcesFile=function(){a.config.lib_fileupload.filename="",a.resource_info.resources_file_path=""},a.downloadResourcesFile=function(){a.resource_info.resources_file_path&&i.downloadFile(a.resource_info.resources_file_path)},a.save=function(){return i.valiForm(a.config.add_resource_form)?a.resource_info.resources_file_path?(a.control.btn_loading=!0,void(a.control.is_update?e.updateResources(a.resource_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3)}):e.addResources(a.resource_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3)}))):(f.alert("请上传文件",3),!1):!1},a.back=function(){b.dismiss(!1)},j()}]),modal_m.controller("busiSysAddNodeModalCtrl",["$scope","$modalInstance","$timeout","NodeReform","ProtocolType","modalParam","Cmpt","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=f.business_sys_name,l=f.node_name,m="",n=["PLT_FTP","SFTP"],o=["SSH","TELNET"],p=!1;a.form={},a.errMessage="",a.is_edit=f.flag,a.nodeControl={protocol_soc_loading:!1,protocol_soc_warn:!1,config_data_source:!1,config_common_data_source:!1},a.data={protocol_soc_list:[]};var q=function(){a.node_info={new_node:{node_soc_ip:"",ftp_config_soc:"",shell_config_soc:"",soc_name_list:[],need_conect_ftp:["---请选择---"],protocol_soc_list:[],business_sys_name:k}}},r=function(){q()},s=function(){q(),d.getNodeForUpdat(l).then(function(b){c(function(){if(a.node_info.new_node=angular.copy(b),a.node_info.new_node.protocol_soc_list=b.protocol_soc_list?b.protocol_soc_list:[],a.node_info.new_node.business_sys_name=k,a.node_info.new_node.soc_ip=b.node_soc_ip,a.node_info.new_node.need_conect_ftp=["---请选择---"],a.getProtocolAndDataSocList(),a.node_info.new_node.protocol_soc_list)for(var c=0;c<a.node_info.new_node.protocol_soc_list.length;c++){var d=a.node_info.new_node.protocol_soc_list[c];(5==d.protocol_type||10==d.protocol_type)&&(a.node_info.new_node.need_conect_ftp=a.node_info.new_node.need_conect_ftp.concat(d.soc_name_list))}},0)},function(a){i.alert(a.message,3)})},t=function(){return a.node_info.new_node.shell_config_soc&&!a.node_info.new_node.ftp_config_soc?(a.nodeControl.config_data_source=!0,!1):!0},u=function(){for(var b=0;b<a.data.protocol_soc_list.length;b++)for(var c=0;c<a.data.protocol_soc_list[b].soc_name_list.length;c++){var d=a.data.protocol_soc_list[b].soc_name_list[c];if(d.soc_name==a.node_info.new_node.shell_config_soc&&!d.has_connect_flag)return void(a.node_info.new_node.shell_config_soc="")}"---请选择---"==a.node_info.new_node.shell_config_soc&&(a.node_info.new_node.shell_config_soc="")},v=function(){u();for(var b=0;b<a.data.protocol_soc_list.length;b++)for(var c=0;c<a.data.protocol_soc_list[b].soc_name_list.length;c++){var d=a.data.protocol_soc_list[b].soc_name_list[c];d.state&&a.node_info.new_node.soc_name_list.push(d.soc_name)}},w=function(){for(var b=0;b<a.node_info.new_node.protocol_soc_list.length;b++)for(var c=0;c<a.node_info.new_node.protocol_soc_list[b].soc_name_list.length;c++)for(var d=a.node_info.new_node.protocol_soc_list[b].soc_name_list[c],e=0;e<a.data.protocol_soc_list.length;e++)for(var f=0;f<a.data.protocol_soc_list[e].soc_name_list.length;f++){var g=a.data.protocol_soc_list[e].soc_name_list[f];d==g.soc_name&&(g.state=!0),g.soc_name==a.node_info.new_node.shell_config_soc&&a.node_info.new_node.ftp_config_soc&&(g.has_connect_flag=!0)}};a.getProtocolAndDataSocList=function(){var b=/^((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d))))$/;c(function(){a.node_info.new_node.node_soc_ip||(m="",a.data.protocol_soc_list=[],a.node_info.new_node.soc_list=[],a.nodeControl.protocol_soc_warn=!1),""!=a.node_info.new_node.node_soc_ip&&m!=a.node_info.new_node.node_soc_ip&&b.test(a.node_info.new_node.node_soc_ip)&&(p=!1,a.nodeControl.protocol_soc_loading=!0,a.data.protocol_soc_list=[],1==a.is_edit&&(a.node_info.new_node.ftp_config_soc="",a.node_info.new_node.shell_config_soc="",a.node_info.new_node.need_conect_ftp=["---请选择---"]),a.node_info.new_node.soc_name_list=[],d.queryProtocolAndSocNameByIp(a.node_info.new_node.node_soc_ip).then(function(b){a.nodeControl.config_data_source=!1,m=a.node_info.new_node.node_soc_ip,c(function(){a.data.protocol_soc_list=b.protocol_soc_list?b.protocol_soc_list:[];for(var c=0;c<a.data.protocol_soc_list.length;c++){var d=a.data.protocol_soc_list[c];d.show_flag_by_protocol_type=!1,d.protocol_type=j.findValue(a.data.protocol_soc_list[c].protocol_type,e),-1!=n.indexOf(d.protocol_type)&&(d.show_flag_by_protocol_type=!0);for(var f=[],g=0;g<a.data.protocol_soc_list[c].soc_name_list.length;g++)f.push({soc_name:a.data.protocol_soc_list[c].soc_name_list[g],state:!1,show_select:!1,has_connect_flag:!1});a.data.protocol_soc_list[c].soc_name_list=f}a.nodeControl.protocol_soc_loading=!1,2==a.is_edit&&w()},200)},function(b){a.error_message=b.message,m=a.node_info.new_node.node_soc_ip,a.nodeControl.protocol_soc_loading=!1,a.nodeControl.protocol_soc_warn=!0}))},0)},a.selectRadioItem=function(b){a.nodeControl.config_common_data_source=!1,p=!0;for(var c=0;c<a.data.protocol_soc_list.length;c++)for(var d=0;d<a.data.protocol_soc_list[c].soc_name_list.length;d++){var e=a.data.protocol_soc_list[c].soc_name_list[d];e.has_connect_flag=!1,e.show_select=!1}b.state=!0,b.show_select=!0},a.clearSelect=function(b){a.node_info.new_node.ftp_config_soc="",b.state=!1,b.show_select=!1;for(var c=0;c<a.data.protocol_soc_list.length;c++)for(var d=0;d<a.data.protocol_soc_list[c].soc_name_list.length;d++){var e=a.data.protocol_soc_list[c].soc_name_list[d];e.has_connect_flag&&(e.has_connect_flag=!1,e.show_select=!1,a.node_info.new_node.shell_config_soc="")}a.nodeControl.config_data_source=!1},a.setNormalData=function(b,c){if(a.nodeControl.config_common_data_source=!1,b.state){if(b.soc_name==a.node_info.new_node.ftp_config_soc)return p=!0,void(b.show_select=!b.show_select);if(b.soc_name==a.node_info.new_node.shell_config_soc&&b.has_connect_flag)return;b.state=!1,-1!=o.indexOf(c)&&a.node_info.new_node.need_conect_ftp.splice(a.node_info.new_node.need_conect_ftp.indexOf(b.soc_name),1);for(var d=0;d<a.data.protocol_soc_list.length;d++)for(var e=0;e<a.data.protocol_soc_list[d].soc_name_list.length;e++){var f=a.data.protocol_soc_list[d].soc_name_list[e];f.show_select=!1}}else{b.state=!0,-1!=o.indexOf(c)&&a.node_info.new_node.need_conect_ftp.push(b.soc_name);for(var d=0;d<a.data.protocol_soc_list.length;d++)for(var e=0;e<a.data.protocol_soc_list[d].soc_name_list.length;e++){var f=a.data.protocol_soc_list[d].soc_name_list[e];f.show_select=!1}}},a.setConnectDataSource=function(b,c){if(p){for(var d=0;d<a.data.protocol_soc_list.length;d++)for(var e=0;e<a.data.protocol_soc_list[d].soc_name_list.length;e++){var f=a.data.protocol_soc_list[d].soc_name_list[e];f.has_connect_flag=!1,f.soc_name==b&&(f.state=!0,f.has_connect_flag=!0)}c.show_select=!1,p=!1,"---请选择---"==b?(c.has_connect_flag=!1,a.node_info.new_node.shell_config_soc=""):(a.node_info.new_node.shell_config_soc=b,a.nodeControl.config_data_source=!1)}},a.getTitleInfo=function(b){var c="";return b.state&&(b.soc_name==a.node_info.new_node.ftp_config_soc&&(c="配置数据源"),b.soc_name==a.node_info.new_node.shell_config_soc&&(c="校验数据源")),c},a.formSubmit=function(){return j.valiForm(a.form.addModifyNodeForm)?(v(),t(),0==a.node_info.new_node.soc_name_list.length?(a.nodeControl.config_common_data_source=!0,a.node_info.new_node.soc_name_list=[],!1):a.node_info.new_node.ftp_config_soc&&!a.node_info.new_node.shell_config_soc?(a.nodeControl.config_data_source=!0,a.node_info.new_node.soc_name_list=[],!1):(1==a.is_edit&&d.addBsNode(a.node_info.new_node).then(function(d){c(function(){i.alert("新增节点成功",2),b.close(a.node_info.new_node.node_soc_ip)},0)},function(b){a.data.protocol_soc_list=[],a.node_info.new_node.soc_list=[],a.node_info.new_node.node_soc_ip="",i.alert(b.message,3)}),void(2==a.is_edit&&d.updateBsNode(a.node_info.new_node).then(function(d){c(function(){i.alert("修改节点成功",2),b.close(a.node_info.new_node.node_soc_ip)},0)},function(a){i.alert(a.message,3)})))):!1},a.cancel=function(){b.close("cancel")},a.myKeyup=function(b){var c=b.keyCode;13==c&&a.getProtocolAndDataSocList()},a.changeScorll=function(){return a.data.protocol_soc_list.length>3?{overflow:"auto"}:void 0},2==a.is_edit?s():1==a.is_edit&&r()}]),modal_m.controller("envDeployCtrl",["$scope","$modalInstance","$timeout","envManage","LanguageName","modalParam","pluginExeEnv","operateSysBit","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){a.data={},a.data.language_list=angular.copy(e),a.controls={loading:!1};var k={};a.data.env_list=[];var l=function(b){a.controls.loading=!0,d.queryEnvList(b).then(function(b){a.data.env_list=b.language_env_list?b.language_env_list:[],a.controls.loading=!1},function(b){a.controls.loading=!1,i.alert(b.message,3)})};a.getValue=function(a,b){var c=1==b?g:h;return j.findValue(a,c)},a.chooseLanguage=function(b){b.choose_flag||(angular.forEach(a.data.language_list,function(a){b.key==a.key?a.choose_flag=!0:a.choose_flag=!1}),l(b.key),k.language_name=b.key)},a.chooseEnv=function(b,c){b.choose_flag||(angular.forEach(a.data.env_list,function(a,b){c==b?a.choose_flag=!0:a.choose_flag=!1}),k=angular.extend(k,b))},a.saveData=function(){return k.choose_flag?void b.close(k):void i.alert("请选择环境",3)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("plusePluginCtrl",["$scope","$modalInstance","$timeout","Plugin","ScrollConfig","LanguageName","modalParam","pluginExeEnv","operateSysBit","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=g.plugin_list?g.plugin_list:[];a.form={},a.data={plugin_list:[],user_info:g.user_info},a.info={search:"",server_user:""},a.controls={loading:!0},a.config={plugin_list_scroll:e,choosed_plugin_scroll:e};var m=function(){d.getAllPluginList().then(function(b){if(a.controls.loading=!1,a.data.plugin_list=b.plugin_list?b.plugin_list:[],l.length)for(var c=0;c<a.data.plugin_list.length;c++)for(var d=a.data.plugin_list[c],e=0;e<l.length;e++){var f=l[e];d.plugin_name===f.plugin_name&&(d.deploy_status=f.deploy_status?f.deploy_status:0,3!==d.deploy_status?d.is_deploy=!0:d.deploy_status=0)}},function(b){a.controls.loading=!1})};a.filterPluginNmae=function(b){return a.info.search?b.plugin_name.indexOf(a.info.search)>-1:!0},a.deleteChoosedPlugin=function(a){a.is_deploy=!1},a.deploy=function(){if(!k.valiForm(a.form.deployForm))return!1;for(var c=[],d=0;d<a.data.plugin_list.length;d++){var e=a.data.plugin_list[d];e.is_deploy&&c.push({deploy_status:e.deploy_status,plugin_name:e.plugin_name,error_message:""})}b.close({selected_plugin:c,server_user:a.info.server_user})},a.cancel=function(){b.dismiss(!1)},m()}]),modal_m.controller("addCollectCmptCtrl",["$scope","$modalInstance","$timeout","modalParam",function(a,b,c,d){var e=d.cj_cmpt_list?d.cj_cmpt_list:[];a.cj_cmpt={all_cj_cmpt_list:e};var f=function(b){for(var c=0;c<b.length;c++)b[c].is_checked&&(b[c].status=1,b[c].is_show=!0,a.cj_cmpt.checked_cj_cmpt_list.push(b[c]));return a.cj_cmpt.checked_cj_cmpt_list};a.checkCmpt=function(b){a.cj_cmpt.all_cj_cmpt_list[b].is_checked=!a.cj_cmpt.all_cj_cmpt_list[b].is_checked,a.cj_cmpt.all_cj_cmpt_list[b].is_show=!1,a.cj_cmpt.all_cj_cmpt_list[b].is_checked||(a.cj_cmpt.all_cj_cmpt_list[b].status=0)},a.saveCollectCmpt=function(){a.cj_cmpt.checked_cj_cmpt_list=[],b.close(f(a.cj_cmpt.all_cj_cmpt_list))},a.cancel=function(){b.dismiss()}}]),modal_m.controller("viewPluginProtocolCtrl",["$scope","$modalInstance","modalParam",function(a,b,c){a.lists=c.list,a.flag=c.flag,a.ip=c.ip,a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("schemeDetailCtrl",["$scope","$modalInstance","$timeout","modalParam","BusiSys","CodeMirrorOption","CmptFunc","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=d.prog_id;a.viewOptions=f.Sh(!0),a.progData={prog_source:1,prog_cn_name:"",prog_bk_desc:"",package_types:[],ref_package_list:[],pub_info:{phase_list:[],param_list:[]},rol_info:{phase_list:[],param_list:[]}},a.pubControls={nav_show_flag:!1,modules_loading:!1,submit_loading:!1,expand_flag:!1,import_loading:!1,data_source:1,upload_show:!0},a.rolControls={nav_show_flag:!1,modules_loading:!1,expand_flag:!1,import_loading:!1,data_source:1};var l=function(){e.viewPubProgramInfo(k).then(function(b){c(function(){if(b){a.progData.prog_cn_name=b.prog_cn_name,a.progData.prog_bk_desc=b.prog_bk_desc,a.progData.package_types=b.package_types?b.package_types:[],a.progData.pub_info=b.pub_info?b.pub_info:{phase_list:[],param_list:[]},a.progData.rol_info=b.rol_info?b.rol_info:{phase_list:[],param_list:[]},a.progData.pub_info.phase_list=a.progData.pub_info.phase_list?a.progData.pub_info.phase_list:[],a.progData.pub_info.param_list=a.progData.pub_info.param_list?a.progData.pub_info.param_list:[],console.log(a.progData.pub_info.param_list),a.progData.rol_info.phase_list=a.progData.rol_info.phase_list?a.progData.rol_info.phase_list:[],a.progData.rol_info.param_list=a.progData.rol_info.param_list?a.progData.rol_info.param_list:[];for(var c=0;c<a.progData.pub_info.phase_list.length;c++)if((1==a.progData.pub_info.phase_list[c].type||4==a.progData.pub_info.phase_list[c].type)&&(a.progData.pub_info.phase_list[c].alias_name||(a.progData.pub_info.phase_list[c].alias_name=a.progData.pub_info.phase_list[c].cn_name),a.progData.pub_info.phase_list[c].show_detail=!1,a.progData.pub_info.phase_list[c].type_cn=j.findValue(a.progData.pub_info.phase_list[c].impl_type,h),a.progData.pub_info.phase_list[c].exec_script=g.cmdsToString(a.progData.pub_info.phase_list[c].cmds),a.progData.pub_info.phase_list[c].ref_params=a.progData.pub_info.phase_list[c].ref_params?a.progData.pub_info.phase_list[c].ref_params:[],0!=a.progData.pub_info.phase_list[c].ref_params.length&&(a.progData.pub_info.phase_list[c].show_ref_param=!0)),2==a.progData.pub_info.phase_list[c].type){var d=a.progData.pub_info.phase_list[c];d.alias_name||(d.alias_name=d.cn_name),d.show_detail=!1;for(var e=0;e<d.modules.length;e++)if(d.modules[e].alias_name||(d.modules[e].alias_name=d.modules[e].cn_name),d.modules[e].exec_script=g.cmdsToString(d.modules[e].cmds),d.modules[e].type_cn=j.findValue(d.modules[e].impl_type,h),d.modules[e].ref_params=d.modules[e].ref_params?d.modules[e].ref_params:[],0!=d.modules[e].ref_params.length){for(var f=0;f<d.modules[e].ref_params.length;f++);d.modules[e].show_ref_param=!0}}for(var c=0;c<a.progData.rol_info.phase_list.length;c++){if((1==a.progData.rol_info.phase_list[c].type||4==a.progData.rol_info.phase_list[c].type)&&(a.progData.rol_info.phase_list[c].alias_name||(a.progData.rol_info.phase_list[c].alias_name=a.progData.rol_info.phase_list[c].cn_name),a.progData.rol_info.phase_list[c].show_detail=!1,a.progData.rol_info.phase_list[c].type_cn=j.findValue(a.progData.rol_info.phase_list[c].impl_type,h),a.progData.rol_info.phase_list[c].exec_script=g.cmdsToString(a.progData.rol_info.phase_list[c].cmds),a.progData.rol_info.phase_list[c].ref_params=a.progData.rol_info.phase_list[c].ref_params?a.progData.rol_info.phase_list[c].ref_params:[],0!=a.progData.rol_info.phase_list[c].ref_params.length)){for(var f=0;f<a.progData.rol_info.phase_list[c].ref_params.length;f++)a.progData.rol_info.phase_list[c].ref_params[f].ref_param_flag=judgeRefParam(a.progData.rol_info.phase_list[c].ref_params[f].ref,a.rolData.handle_param_list);a.progData.rol_info.phase_list[c].show_ref_param=!0}if(2==a.progData.rol_info.phase_list[c].type){var d=a.progData.rol_info.phase_list[c];d.alias_name||(d.alias_name=d.cn_name),d.show_detail=!1;for(var e=0;e<d.modules.length;e++)if(d.modules[e].alias_name||(d.modules[e].alias_name=d.modules[e].cn_name),d.modules[e].exec_script=g.cmdsToString(d.modules[e].cmds),d.modules[e].type_cn=j.findValue(d.modules[e].impl_type,h),d.modules[e].ref_params=d.modules[e].ref_params?d.modules[e].ref_params:[],0!=d.modules[e].ref_params.length){for(var f=0;f<d.modules[e].ref_params.length;f++)d.modules[e].ref_params[f].ref_param_flag=judgeRefParam(d.modules[e].ref_params[f].ref,a.rolData.handle_param_list);d.modules[e].show_ref_param=!0}}}}},0)},function(a){i.alert(a.message,3)})};a.changTab=function(b){2==b?c(function(){a.flagTab=!0},0):c(function(){a.flagTab=!1},0)},a.toggleModulesDetail=function(b,c){b.show_detail=!b.show_detail,1==c?(a.pubControls.nav_show_flag=g.judgeShowDetail(a.progData.pub_info.phase_list),2==a.pubControls.nav_show_flag?a.pubControls.expand_flag=!0:a.pubControls.expand_flag=!1):(a.rolControls.nav_show_flag=g.judgeShowDetail(a.progData.rol_info.phase_list),2==a.rolControls.nav_show_flag?a.rolControls.expand_flag=!0:a.rolControls.expand_flag=!1)},a.expandCollapseAll=function(b){1==b?a.pubControls.nav_show_flag=g.expandAllModules(a.progData.pub_info.phase_list):a.rolControls.nav_show_flag=g.expandAllModules(a.progData.rol_info.phase_list)},a.colseCollapseAll=function(b){1==b?a.pubControls.nav_show_flag=g.closeAllModules(a.progData.pub_info.phase_list):a.rolControls.nav_show_flag=g.closeAllModules(a.progData.rol_info.phase_list)},a.cancel=function(){b.dismiss(!1)},l()}]),modal_m.controller("uploadLogFileCtrl",["$scope","$modalInstance","$timeout","modalParam","BusiSys","CodeMirrorOption","CmptFunc","IML_TYPE","Modal","NodeReform","Col_Fmt","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.form={},a.maxDate=new Date,a.log_fileupload={suffixs:"",filetype:"",filename:"",uploadpath:""},a.datepicker={},a.upload_file_info={sys_name:d.sys_name,log_name:d.log_name,log_id:d.log_id,node_name:"",file_date:l.dtFormat(new Date),file_name:"",ip:"",temp_date:"",node_ip:""},a.data={node_ip_list:[],logSyncInfoList:[]},a.control={show_upload:!1};var m=function(){j.getNodeByBusi(d.sys_name).then(function(b){c(function(){a.data.node_ip_list=b.node_msg_list?b.node_msg_list:[]},0)},function(a){i.alert(a.message,3)})};a.getipAndPath=function(b){if(!a.upload_file_info.file_date)return i.alert("请先选择日期"),!1;for(var f="",g=0;g<a.data.node_ip_list.length;g++){var h=a.data.node_ip_list[g];if(h.soc_ip==b){f=h.node_name;break}}var j=l.dtFormat(a.upload_file_info.file_date);e.getLogUploadPath(f,d.sys_name,j,a.upload_file_info.log_id).then(function(b){c(function(){if(a.log_fileupload.uploadpath=b.path?b.path:"",a.control.show_upload=!0,a.data.file_list=b.file_list?b.file_list:[],a.data.file_list.length>0)for(var c=0;c<a.data.file_list.length;c++){var d=a.data.file_list[c];d.real_length=k.formByteToM(d.file_length)}},0)},function(a){i.alert(a.message,3)})},a.fileUploadSuccessThen=function(){a.upload_file_info.file_name=a.log_fileupload.filename},a.cancel=function(){b.dismiss(!1)},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.datepicker.opened=!0},a.formSubmit=function(){if(!l.valiForm(a.form.uploadFile))return!1;if(!a.upload_file_info.file_name)return i.alert("请上传文件"),!1;for(var d=0;d<a.data.node_ip_list.length;d++){var f=a.data.node_ip_list[d];if(f.soc_ip==a.upload_file_info.node_ip){a.upload_file_info.node_name=f.node_name;break}}a.upload_file_info.file_date=l.dtFormat(a.upload_file_info.file_date),e.saveLogUploadBase(a.upload_file_info).then(function(a){c(function(){i.alert("提交成功"),b.close(!1)},0)},function(a){i.alert(a.message,3),b.close(!1)})},m()}]),modal_m.controller("deployAgentCtrl",["$scope","$modalInstance","$timeout","modalParam","NodeReform","Modal",function(a,b,c,d,e,f){var g=d.protocol_soc_list?d.protocol_soc_list:[],h=d.node_name;a.data={protocol_soc_list:[]},a.control={deploy_loading:!1,deploy_success:!1,deploy_fail:!1};var i=function(a){for(var b=0;b<a.length;b++)a[b].is_check=!1},j=function(a){for(var b="",c=0;c<a.length;c++)a[c].is_check&&(b=a[c].soc_name);return b},k=function(){a.data.protocol_soc_list=g,i(a.data.protocol_soc_list)};a.chooseExecSoc=function(b){i(a.data.protocol_soc_list),a.data.protocol_soc_list[b].is_check=!0},a.startDeploy=function(){var b=j(a.data.protocol_soc_list);return b?(a.control.deploy_loading=!0,void e.deployAgent(b,h).then(function(b){b&&(a.control.deploy_loading=!1,b.success?a.control.deploy_success=!0:(a.deploy_error_message=b.result,a.control.deploy_fail=!0))},function(b){a.control.deploy_loading=!1,f.alert(b.message,3)})):(f.alert("请选择要执行的数据源！"),!1)},a.finishDeploy=function(){b.close(!0)},a.cancel=function(){b.dismiss()},k()}]),modal_m.controller("configDirCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","BusiSys","Modal",function(a,b,c,d,e,f,g){var h=d._flag?d._flag:1,i=d.soc_version?d.soc_version:"";a.info={version_info:{soc_name:i,root_bk_dir:"",init_path:"",loading:!1,full_path:""}},a.control={version_config_flag:h,show_real:!1};var j=function(){a.info.version_info.checked_files=[],a.info.version_info.paths=[],a.info.version_info.active=!1,a.info.version_info.loading=!1},k=function(){e.getFileListBySoc(i,a.info.version_info.init_path).then(function(b){j(),a.info.version_info.path_files=b.file_bean_list?b.file_bean_list:[],a.info.version_info.init_path=b.root_bk_dir?b.root_bk_dir:"",a.info.version_info.full_path=b.root_bk_dir?b.root_bk_dir:"",a.control.show_real=!0},function(a){g.alert(a.message,3),b.dismiss()})};a.changePath=function(a){a.loading=!0,e.getFileListBySoc(i,a.full_path).then(function(b){a.loading=!1,a.path_files=b.file_bean_list?b.file_bean_list:[]},function(b){a.loading=!1,a.err_msg=b.message})},a.save=function(){return 0==a.info.version_info.paths.length?(g.alert("请选择目录"),!1):void b.close(a.info.version_info.full_path)},a.back=function(){b.dismiss()},k()}]),modal_m.controller("ViewFileDirListCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Modal",function(a,b,c,d,e,f){var g=[];a.file_list=[],a.content=d.content,a.changePath=function(){a.node.is_dir&&(a.node.loading=!0,c(function(){e.getFileList(a.content.node_name,a.node.full_path).then(function(b){a.node.path_files=b.file_bean_list,a.node.loading=!1},function(a){f.alert(a.message,3)})}))};var h=function(){a.node={node_name:"",init_path:d.init_path?d.init_path:"",path_files:[],loading:!1,full_path:"",is_dir:!0,checked_files:[],deleted_files:[],modified_files:[],spical_files:[]}};a.formSubmit=function(){var c=!1;angular.forEach(a.node.path_files,function(b){b.checked&&(c=!0,b.file=a.node.full_path+"/"+b.file,console.log(b.file),g.push(b))}),c?b.close(g):f.alert("请至少选择一个目录或文件")},a.formCancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("newCjProgramItemsModalCtrl",["$scope","$modalInstance","$timeout","modalParam","IML_TYPE","CmptFunc","Collection","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=d.business_sys_name,k=0,l=0;a.form={},a.is_edit=d.is_update,a.collect_item_info={collect_item_name:"",is_parallel:!0,coProgramModuleBeans:[],run_yn_flag:!0,start_bk_time:"",max_run_time:"",immediate_exec:0},a.start_time={plan_hour:"",plan_minute:""},a.run_time={flag:1,time:""},a.control={show_cmpts:!1,get_cmpts_loading:!1,get_cmpts_error:!1,time_format:!0},a.data={cj_cmpt_list:[],times:[{key:1,value:"分钟"},{key:2,value:"小时"}]};var m=function(a,b){if(0!=b.length)for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)a[c].module_id==b[d].module_id&&(a[c].is_check=!0);return a},n=function(){if(a.is_edit){if(a.collect_item_info=angular.copy(d.item),a.collect_item_info.coProgramModuleBeans)for(var b=0;b<a.collect_item_info.coProgramModuleBeans.length;b++){var c=a.collect_item_info.coProgramModuleBeans[b];c.script_content=f.cmdsToString(c.script)}a.collect_item_info.run_yn_flag?a.collect_item_info.immediate_exec=0:(a.collect_item_info.immediate_exec=1,a.start_time={plan_hour:a.collect_item_info.start_bk_time.substring(0,2),plan_minute:a.collect_item_info.start_bk_time.substring(3,a.collect_item_info.start_bk_time.length)}),a.collect_item_info.translate_run_time_m>0?(a.run_time.flag=1,a.run_time.time=a.collect_item_info.max_run_time/60):(a.run_time.flag=2,a.run_time.time=a.collect_item_info.max_run_time/60/60)}};a.showCollectCmpt=function(){a.control.show_cmpts=!0,a.control.get_cmpts_error=!1,a.control.get_cmpts_none=!1,a.control.get_cmpts_loading=!0,g.getCollectItemList(j).then(function(b){c(function(){if(b.module_list){a.data.cj_cmpt_list=b.module_list?b.module_list:[];for(var c=0;c<a.data.cj_cmpt_list.length;c++)a.data.cj_cmpt_list[c].impl_type_cn=i.findValue(a.data.cj_cmpt_list[c].impl_type,e),a.data.cj_cmpt_list[c].script_content=f.cmdsToString(a.data.cj_cmpt_list[c].script),a.data.cj_cmpt_list[c].show_script=!1,a.data.cj_cmpt_list[c].is_check=!1;m(a.data.cj_cmpt_list,a.collect_item_info.coProgramModuleBeans),a.control.get_cmpts_loading=!1}else a.control.get_cmpts_loading=!1,a.control.get_cmpts_none=!0},0)},function(b){a.control.get_cmpts_loading=!1,a.control.get_cmpts_error=!0,a.error_message=b.message})},a.addCollectCmpt=function(b){var c=a.data.cj_cmpt_list[b];c.is_check=!c.is_check,c.is_check?a.collect_item_info.coProgramModuleBeans.push(c):angular.forEach(a.collect_item_info.coProgramModuleBeans,function(b,d){b.module_id==c.module_id&&a.collect_item_info.coProgramModuleBeans.splice(d,1)})},a.deleteSingCmpt=function(b){a.collect_item_info.coProgramModuleBeans.splice(b,1),0==a.collect_item_info.coProgramModuleBeans.length&&(a.collect_item_info.immediate_exec=0,a.collect_item_info.max_run_time="",a.collect_item_info.run_yn_flag=!0,a.start_time={plan_hour:"",plan_minute:""},a.run_time={flag:1,time:""},a.control.time_format=!0)},a.upSingCmpt=function(b){var c=a.collect_item_info.coProgramModuleBeans,d=c[b];c[b]=c[b-1],c[b-1]=d,a.collect_item_info.coProgramModuleBeans=c},a.downSingCmpt=function(b){var c=a.collect_item_info.coProgramModuleBeans,d=c[b];c[b]=c[b+1],c[b+1]=d,a.collect_item_info.coProgramModuleBeans=c},a.close=function(){a.control.show_cmpts=!1},a.testTimeFormat=function(b,c,d){var e=/^[0-9]{1,2}$/;return 0!=a.collect_item_info.immediate_exec||b||c?(1==d?k++:l++,void(e.test(b)&&b>=0&&24>b?(a.control.time_format=!0,e.test(c)&&c>=0&&60>c?a.control.time_format=!0:l>0&&(a.control.time_format=!1)):k>0&&(a.control.time_format=!1))):!1},a.changeStartTime=function(b){0==b?(a.collect_item_info.run_yn_flag=!0,a.collect_item_info.immediate_exec=b,a.start_time={plan_hour:"",plan_minute:""},a.control.time_format=!0):(a.collect_item_info.run_yn_flag=!1,a.collect_item_info.immediate_exec=b)},a.saveCollectItem=function(){return a.collect_item_info.run_yn_flag?a.collect_item_info.start_bk_time="":(1==a.start_time.plan_hour.length&&(a.start_time.plan_hour="0"+a.start_time.plan_hour),1==a.start_time.plan_minute.length&&(a.start_time.plan_minute="0"+a.start_time.plan_minute),a.collect_item_info.start_bk_time=a.start_time.plan_hour+":"+a.start_time.plan_minute),1==a.run_time.flag?a.collect_item_info.max_run_time=60*parseFloat(a.run_time.time):a.collect_item_info.max_run_time=60*parseFloat(a.run_time.time)*60,0==a.collect_item_info.coProgramModuleBeans.length?(h.alert("请至少添加一个采集组件"),!1):i.valiForm(a.form.collect_item_form)?1!=a.collect_item_info.immediate_exec||a.start_time.plan_hour&&a.start_time.plan_minute?void b.close(a.collect_item_info):(a.control.time_format=!1,!1):!1},a.cancel=function(){b.dismiss()},n()}]),modal_m.controller("cjTaskCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection",function(a,b,c,d,e){a.modal_info=d.modal_info,a.all_node_list=d.node_list,a.checkedCount=0;var f=d.business_sys_name,g=d.module_index,h=function(){for(var b=0;b<a.all_node_list.length;b++)a.all_node_list[b].state=0,a.all_node_list[b].checked=!1,a.all_node_list[b].loading=!0;angular.forEach(a.modal_info.coTaskModuleBeans,function(b){b.cmpt_nodes=[],b.checkedCount=0,b.all_node_list=angular.copy(d.node_list),b.check_all=!1,c(function(){e.getNodesByCmptId(f,b.module_id).then(function(c){if(c.node_list)for(var d=0;d<c.node_list.length;d++)b.cmpt_nodes.push({node_name:c.node_list[d].node_name,node_ip:c.node_list[d].soc_ip,state:0,checked:!1});for(var d=0;d<b.cmpt_nodes.length;d++)for(var e=b.cmpt_nodes[d],f=0;f<b.all_node_list.length;f++){var g=b.all_node_list[f];e.node_ip==g.node_ip&&(g.state=1),g.loading=!1}if(b.coNodeBeans){a.checkedCount=0;for(var d=0;d<b.coNodeBeans.length;d++)for(var h=b.coNodeBeans[d],f=0;f<b.all_node_list.length;f++){var g=b.all_node_list[f];h.node_ip==g.node_ip&&(g.checked=!0,b.checkedCount++)}b.all_node_list.length==b.checkedCount&&(b.check_all=!0)}},function(a){})},1e3)})},i=function(a,b){var c=!0;return angular.forEach(a,function(a){a[b]||(c=!1)}),c},j=function(){a.modal_info.coTaskModuleBeans[g].show_detail=!1,a.toggleModulesDetail(a.modal_info.coTaskModuleBeans[g],g),h()};a.toggleModulesDetail=function(b,c){b.show_detail=!b.show_detail;for(var d=0;d<a.modal_info.coTaskModuleBeans.length;d++)d!=c&&(a.modal_info.coTaskModuleBeans[d].show_detail=!1);if(b.checkedCount=0,b.coNodeBeans)for(var d=0;d<b.coNodeBeans.length;d++)for(var e=b.coNodeBeans[d],f=0;f<b.all_node_list.length;f++){var g=b.all_node_list[f];e.node_ip==g.node_ip&&(g.checked=!0,b.checkedCount++)}},a.stateChangeData=function(a,b){if(0==b.state)return!1;b.checked=!b.checked,a.coNodeBeans=[];for(var c=0;c<a.all_node_list.length;c++){var d=a.all_node_list[c];1==d.state&&d.checked&&a.coNodeBeans.push({node_name:d.node_name,node_ip:d.node_ip})}a.checkedCount=a.coNodeBeans.length?a.coNodeBeans.length:0,a.check_all=i(a.all_node_list,"checked")},a.checkAll=function(a){if(a.coNodeBeans=[],console.log(a.check_all),a.check_all){for(var b=0;b<a.all_node_list.length;b++){var c=a.all_node_list[b];c.checked=!0,1==c.state&&c.checked&&a.coNodeBeans.push({node_name:c.node_name,node_ip:c.node_ip})}a.checkedCount=a.coNodeBeans.length?a.coNodeBeans.length:0}else console.log(0),angular.forEach(a.all_node_list,function(a){a.checked=!1}),a.coNodeBeans=[],a.checkedCount=0},a.formSubmit=function(){b.close(a.modal_info)},a.cancel=function(){b.close()},j()}]),modal_m.controller("addTargetModelCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Inspection",function(a,b,c,d,e,f){a.data={model_all_list:[],model_checked_list:[]};var g=d.model_list?d.model_list:[];a.data.model_checked_list=angular.copy(g);var h=function(){f.getAllIndexModel().then(function(b){a.data.model_all_list=b.indi_model_list?b.indi_model_list:[];for(var c=0;c<a.data.model_all_list.length;c++)angular.forEach(a.data.model_checked_list,function(b){b.indi_model_name==a.data.model_all_list[c].indi_model_name&&(a.data.model_all_list[c].checked=!0)})},function(a){Modal.alert(a.message,3)})};a.addSingleModel=function(b){b.checked=!b.checked;var c={show_detail:!1,indi_model_name:b.indi_model_name,indi_model_cn_name:b.indi_model_cn_name};b.checked?a.data.model_checked_list.push(c):angular.forEach(a.data.model_checked_list,function(c,d){c.indi_model_name==b.indi_model_name&&a.data.model_checked_list.splice(d,1)})},a.formSubmit=function(){b.close(a.data.model_checked_list)},a.cancel=function(){b.close()},h()}]),modal_m.controller("xjtaskConfigModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Inspection",function(a,b,c,d,e){a.form_control={data_loading:!1,error_message:""},a.config_info={modify_chart_list:d.model_info.chart_list?d.model_info.chart_list:[],config_list:[],checkd_list:[]};var f=function(){a.form_control.data_loading=!0,e.getChartListByModelList(d.model_list).then(function(b){c(function(){b&&(a.form_control.data_loading=!1,a.config_info.config_list=b.model_node_list?b.model_node_list:[],angular.forEach(a.config_info.config_list,function(a){a.node_list=a.node_list?a.node_list:[]}),angular.forEach(a.config_info.modify_chart_list,function(b){var c=b;angular.forEach(a.config_info.config_list,function(a){var b=a;angular.forEach(b.node_list,function(a){c.indi_node_name==a.indi_node_name&&c.indi_model_name==a.indi_model_name&&(a.checked=!0)})})}))},0)},function(b){a.form_control.data_loading=!1,a.form_control.error_message=b.message})};a.formSubmit=function(){angular.forEach(a.config_info.config_list,function(b){angular.forEach(b.node_list,function(c){c.checked&&(c.indi_model_name=b.indi_model_name,a.config_info.checkd_list.push(c))})}),b.close(a.config_info.checkd_list)},a.formCancel=function(){b.dismiss(!1)},f()}]),modal_m.controller("configDataCollectionCtrl",["$scope","$modalInstance","$timeout","modalParam","Inspection","Cmpt","Modal","CV",function(a,b,c,d,e,f,g,h){
var i=d.data,j=d.task_id,k=d.indi_model_name;a.form={},a.data={filter_info:"",finished_task_list:[],file_type_list:[{key:1,value:"csv"},{key:2,value:"json"},{key:3,value:"other"}],files_list:[]},a.data_config_controls={flag:!1,curr_config_type:1},a.cmpt_script_fileupload={suffixs:"sh",filetype:"SHELL",filename:"",uploadpath:""},a.tabs=[!0,!1],a.data_config_info={file_type:""};var l=function(){n(),e.getCotTaskList().then(function(b){c(function(){b&&(a.data.finished_task_list=b.task_list?b.task_list:[])},0)}),i.taskImportBean&&(1==i.taskImportBean.curr_config_type?(a.data_config_controls.curr_config_type=1,c(function(){a.config_info_collection=i.taskImportBean,a.data.files_list=i.taskImportBean.all_files?i.taskImportBean.all_files:[]},0)):(a.data_config_controls.curr_config_type=2,a.tabs=[!1,!0],a.data_config_controls.flag=!0,c(function(){a.config_info_hand=angular.copy(i.taskImportBean),a.data_config_info.file_type=i.taskImportBean.import_file_type,a.changeFileType(a.data_config_info.file_type)},0)))},m=function(){e.getUploadFilePath().then(function(b){b&&(a.data_fileupload.uploadpath=b.file_path?b.file_path:"")},function(a){g.alert(a.message,3)})},n=function(){a.data_config_controls.flag=!1,a.data.files_list=[],a.data.filter_info="",a.data_config_info.file_type="",a.config_info_collection={indi_task_id:j,table_name:i.table_name,indi_model_name:k,indi_node_name:i.indi_node_name,co_task_name:"",import_type:0,import_file_type:"",files:[],is_need_clean:1},a.config_info_hand={indi_task_id:j,table_name:i.table_name,indi_model_name:k,indi_node_name:i.indi_node_name,import_type:1,uploadFiles:[],parse_cmd:"",is_need_clean:1},a.data_fileupload={suffixs:"",filename:"",filetype:"",uploadpath:""}};a.getFileList=function(b,d){if(b&&d){for(var f,i=0;i<a.data.finished_task_list.length;i++){var j=a.data.finished_task_list[i];if(j.task_name==d){f=j.task_no;break}}a.config_info_collection.files=[],e.getFileListByFileType(h.findValue(b,a.data.file_type_list),f).then(function(b){c(function(){if(b){var c=b.file_list?b.file_list:[];a.data.files_list=[],angular.forEach(c,function(b,c,d){a.data.files_list.push({state:!1,file_bk_path:b,file_name:b.slice(b.lastIndexOf("/")+1)})})}},0)},function(b){a.data.files_list=[],g.alert(b.message,3)})}},a.ImportSuccessThen=function(){var b={file_name:a.data_fileupload.filename};a.data_fileupload.filename="",a.config_info_hand.uploadFiles.push(b.file_name);a.data_fileupload.uploadpath+a.data_fileupload.filename},a.changeFileType=function(b){if(a.data_config_controls.flag=!1,a.config_info_collection.files=[],c(function(){a.data_config_controls.flag=!0},0),b&&3!=b){var d=h.findValue(b,a.data.file_type_list);a.data_fileupload.suffixs=d,a.data_fileupload.file_type=d}else a.data_fileupload.suffixs="",a.data_fileupload.file_type="";a.data_config_info.file_type=b},a.selectItem=function(b){a.config_info_collection.files=[];for(var c=0;c<a.data.files_list.length;c++){var d=a.data.files_list[c];d.state&&a.config_info_collection.files.push(d.file_bk_path)}},a.close=function(){b.dismiss(!1)},a.saveOrInportData=function(){var d={};if(1==a.data_config_controls.curr_config_type){if(!h.valiForm(a.form.collect_data_form))return!1;d=a.config_info_collection}else{if(!h.valiForm(a.form.collect_hand_form))return!1;if(0==a.config_info_hand.uploadFiles.length)return g.alert("请至少上传一个文件"),!1;d=a.config_info_hand}d.flag=!0,d.is_need_clean=1==d.is_need_clean?!0:!1,e.importXJConfigInfo(j,d).then(function(a){c(function(){a&&(i.import_state=2,i.monitor.import_seq=a.import_seq,b.close(d))},0)},function(a){g.alert(a.message,3)})},a.saveConfigInfo=function(){var c={};if(1==a.data_config_controls.curr_config_type){if(!h.valiForm(a.form.collect_data_form))return!1;a.config_info_collection.all_files=a.data.files_list,a.config_info_collection.curr_config_type=1,c=a.config_info_collection}else{if(!h.valiForm(a.form.collect_hand_form))return!1;if(0==a.config_info_hand.uploadFiles.length)return g.alert("请至少上传一个文件"),!1;a.config_info_hand.curr_config_type=2,c=a.config_info_hand}i.import_state=1,c.flag=!1,b.close(c)},a.changeConfigMethod=function(b){a.data_config_controls.curr_config_type=b,n(),m()},a.deleteFile=function(a,b){b.splice(a,1)},l()}]),modal_m.controller("dataGatherDetailCtrl",["$scope","$modalInstance","$timeout","$rootScope","$interval","Inspection","modalParam",function(a,b,c,d,e,f,g){var h=g.task_id,i=g.data;a.export_detail={source_data_name:i.table_cn_name,data_count:i.total_file_num,time:"",his_detail_list:[]},a.show_flag=3==d.listen_info.import_state?!0:!1,a.control={info_loading:!0};var j=function(){k(),f.viewXJImportHis(h,i.indi_model_name,i.indi_node_name).then(function(b){var c=b.import_bean_list?b.import_bean_list:[];a.control.info_loading=!1;for(var d=0;d<c.length;d++)c[d].day=c[d].import_bk_time.split(" ")[0],c[d].time=c[d].import_bk_time.split(" ")[1];a.export_detail.his_detail_list=c},function(b){a.control.info_loading=!1,Modal.alert(b.message,3)})},k=function(){if(d.listen_info.exec_detail){var b=d.listen_info.exec_detail.import_bk_time.split(" ")[1];a.export_detail.time=b.substring(0,b.lastIndexOf("."))}};a.close=function(){b.dismiss(!1)},j()}]),modal_m.controller("xjMessageTipsCtrl",["$scope","$modalInstance","$timeout","modalParam",function(a,b,c,d){a.remind_info=d.data,a.close=function(){b.close(!0)}}]),modal_m.controller("configLogCtrl",["$scope","$modalInstance","$timeout","BusiSys","NodeReform","Exec","Modal","EncodingType","Collection","LogXJ","logTimeStampType","newLogTimeStampType","ScrollBarConfig","modalParam",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=!1,p=0,q=[];a.log_info={sys_name:"",choose_ip_list:[]},a.data={busys_list:[],node_ip_list:[],encode_type_list:h,date_format_list:l},a.control={next_step:!1,loading_busys:!1,loading_node_ip:!1},a.config={scroll_config:m.Y()},a.log_info.sys_name=n.sys_name?n.sys_name:"",a.log_info.choose_ip_list=n.choose_ip_list?angular.copy(n.choose_ip_list):[],q=n.choose_ip_list?angular.copy(n.choose_ip_list):[],console.log(q),a.log_info.choose_ip_list.length>0&&(o=!0);var r=function(a,b,c){var d="."+a,e="."+b,f=$(d);if(f.is(c.target)||0!=f.has(c.target).length)return $(e).removeClass("display-none").addClass("display-block"),!1;var g=$(e);g.is(c.target)||0!==g.has(c.target).length||$(e).removeClass("display-block").addClass("display-none")},s=function(a,b){for(var c=!0,d=0;d<a.length;d++){var e=a[d];if(!e[b]){c=!1;break}}return c},t=function(){for(var b=0;b<a.log_info.choose_ip_list.length;b++){var c=a.log_info.choose_ip_list[b];c.init_path=c.web_root_path?c.web_root_path:"",c.checked_files=[],c.paths=[],c.active=!1}},u=function(b){a.control.loading_node_ip=!0,j.getAllNodeListBySys(b).then(function(b){c(function(){a.data.node_ip_list=b.prepare_node_list?b.prepare_node_list:[],angular.forEach(a.data.node_ip_list,function(a){a.checked=!1}),a.control.loading_node_ip=!1},0)},function(b){a.control.loading_node_ip=!1,g.alert(b.message,3)})},v=function(a,b){var c=!0;if(a.length==b.length)for(var d=0;d<a.length;d++)a[d].node_name!=b[d].node_name&&(c=!1);else c=!1;return c},w=function(){a.control.loading_busys=!0,d.getAllBusinessSys().then(function(b){c(function(){a.data.busys_list=b.list_bs?b.list_bs:[],b.list_bs&&angular.forEach(a.data.busys_list,function(b){o&&b.business_sys_name==a.log_info.sys_name?b.checked=!0:b.checked=!1}),a.control.loading_busys=!1},0)},function(b){a.control.loading_busys=!1,g.alert(b.message,3)}),o&&(a.control.loading_node_ip=!0,j.getAllNodeListBySys(a.log_info.sys_name).then(function(b){c(function(){a.data.node_ip_list=b.prepare_node_list?b.prepare_node_list:[],angular.forEach(a.data.node_ip_list,function(a){a.checked=!1});for(var c=0;c<a.data.node_ip_list.length;c++)for(var d=a.data.node_ip_list[c],e=0;e<a.log_info.choose_ip_list.length;e++){var f=a.log_info.choose_ip_list[e];d.soc_ip==f.soc_ip&&(d.checked=!0)}a.control.loading_node_ip=!1},0)},function(b){a.control.loading_node_ip=!1,g.alert(b.message,3)}))};a.checkBysys=function(b,c){for(var d=0;d<a.data.busys_list.length;d++){var e=a.data.busys_list[d];e.checked=!1}a.data.node_ip_list=[],b.checked=!0,a.log_info.sys_name=b.business_sys_name,u(b.business_sys_name)},a.chooseCurIp=function(a){a.checked=!a.checked},a.nextStep=function(){if(!a.log_info.sys_name)return g.alert("请选择系统"),!1;var b=[];if(angular.forEach(a.data.node_ip_list,function(a){a.checked&&b.push(a)}),0==b.length)return g.alert("请至少选择一个节点"),!1;v(a.log_info.choose_ip_list,b);o&&v(a.log_info.choose_ip_list,b)?a.log_info.choose_ip_list=q:(a.log_info.choose_ip_list=b,t()),a.control.next_step=!0},a.lastStep=function(){a.control.next_step=!1},a.selectTab=function(a){},a.selectFile=function(a){console.log(a)},a.changePath=function(a){a.loading=!0,i.getFileList(a.node_name,a.full_path).then(function(b){a.loading=!1,a.path_files=b.file_bean_list?b.file_bean_list:[],angular.forEach(a.path_files,function(a){if(!a.dir){var b=a.file.substring(a.file.lastIndexOf("."));".log"==b?a.log_flag=!0:a.log_flag=!1}})},function(b){a.loading=!1,a.err_msg=b.message})},a.chooseCurDateFormat=function(a,b){a[p].date_format=b.key,a[p].date_format_show=b.value;var c=b.value.indexOf("("),d=b.value.indexOf(")");a[p].date_format_show=b.value.substring(0,c),a[p].timestamp_show_title=b.value.substring(c+1,d),$(".target_log_choose").removeClass("display-block").addClass("display-none")},a.showChooseTime=function(a){p=a},a.changeHeight=function(){var a=69+54*p;return{top:a}},a.saveLogList=function(){for(var c=!0,d=!0,e=0;e<a.log_info.choose_ip_list.length;e++){var f=a.log_info.choose_ip_list[e];if(c=s(f.checked_files,"word_coding"),d=s(f.checked_files,"date_format_show"),!c||!d)break}return c&&d?(a.log_info.node_ip_list=a.data.node_ip_list,console.log(a.log_info),void b.close(a.log_info)):(g.alert("请完善日志文件编码或时间格式信息"),!1)},a.formCancel=function(){b.dismiss(!1)},$(document).mouseup(function(a){r("first_span_choose","target_log_choose",a)}),w()}]),modal_m.controller("configLogScreenCtrl",["$scope","$modalInstance","$timeout","BusiSys","NodeReform","Exec","Modal","EncodingType","modalParam","CV",function(a,b,c,d,e,f,g,h,i,j){if(a.form={},a.log_screen={start_hour:"00",start_minutes:"00",end_hour:"23",end_minutes:"59",keywords:"",key_line:""},a.control={time_input_err_msg:""},i.log_screen){console.log(i.log_screen);var k=angular.copy(i.log_screen);a.log_screen=k?k:""}a.timeInputBlur=function(b,c){var d=1==c?"开始时间小时":2==c?"开始时间分钟":3==c?"结束时间小时":4==c?"结束时间分钟":"";return b?a.log_screen.start_hour&&a.log_screen.end_hour&&parseInt(a.log_screen.end_hour)<parseInt(a.log_screen.start_hour)?(a.control.time_input_err_msg="时间间隔有误",!1):a.log_screen.start_hour&&a.log_screen.end_minutes&&a.log_screen.end_hour&&a.log_screen.end_minutes&&a.log_screen.end_hour==a.log_screen.start_hour&&parseInt(a.log_screen.end_minutes)<parseInt(a.log_screen.start_minutes)?(a.control.time_input_err_msg="时间间隔有误",!1):void(a.control.time_input_err_msg=""):(a.control.time_input_err_msg=d+"不能为空",!1)},a.formCancel=function(){b.dismiss(!1)},a.saveScreenInfo=function(){if(!j.valiForm(a.form.log_screen))return!1;if(a.log_screen.startDate>a.log_screen.endDate)return g.alert("开始时间大于结束时间，请重新输入"),!1;if(!a.log_screen.start_hour||!a.log_screen.start_minutes||!a.log_screen.end_hour||!a.log_screen.end_minutes||a.control.time_input_err_msg)return a.control.time_input_err_msg=a.control.time_input_err_msg?a.control.time_input_err_msg:"时间间隔有误",!1;if(a.log_screen.keywords&&!a.log_screen.key_line)return g.alert("请输入截取行数"),!1;if(a.log_screen.key_line&&!a.log_screen.keywords)return g.alert("请输入关键字"),!1;var c=angular.copy(a.log_screen);c.key_line=parseInt(a.log_screen.key_line?a.log_screen.key_line:0),b.close(c)}}]),modal_m.controller("reportLogChooseCtrl",["$scope","$modalInstance","$timeout","BusiSys","NodeReform","Exec","Modal","EncodingType","modalParam","ScrollConfig","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=1,m=!1,n=i.sys_name,o=new Date;a.info={datepicker:{},max_date:o},a.control={show_input:!0},a.config={scroll_config:j},a.data={log_type_list:[],log_ip_file:[],logSyncInfoList:[],curr_node:""},a.report_choose={start_date:"",end_date:"",choose_log_list:[],choose_log_name:""},a.form={};var p=function(b,c){for(var d=0;d<a.data.log_type_list.length;d++){var e=a.data.log_type_list[d],f=e.logSyncInfos?e.logSyncInfos:[],g=r(b,c,f);g.length>0?e.uncheck=!1:(e.uncheck=!0,e.choose_log=!1)}},q=function(){d.getAllLogList(n,l).then(function(b){c(function(){a.data.log_type_list=b.logBeanList?b.logBeanList:[],b.logBeanList&&angular.forEach(a.data.log_type_list,function(a){a.logSyncInfos&&a.logSyncInfos.length>0?a.uncheck=!1:a.uncheck=!0,a.checked=!1})},0)},function(a){g.alert(a.message,3)})},r=function(a,b,c){var d=[],e=k.dtFormat(a),f=k.dtFormat(b);return angular.forEach(c,function(a){e<=a.file_date&&a.file_date<=f&&d.push(a)}),d},s=function(){(i.report_choose.choose_log_list||i.report_choose.choose_log_name)&&(m=!0,a.report_choose=i.report_choose),m?d.getAllLogList(n,l).then(function(b){c(function(){if(a.data.log_type_list=b.logBeanList?b.logBeanList:[],b.logBeanList&&angular.forEach(a.data.log_type_list,function(a){a.checked=!1}),angular.forEach(a.data.log_type_list,function(b){b.log_name==a.report_choose.choose_log_name&&(b.checked=!0,a.data.logSyncInfoList=r(a.report_choose.start_date,a.report_choose.end_date,b.logSyncInfos),a.data.curr_node=b.logSyncInfos)}),a.report_choose.choose_log_list&&a.report_choose.choose_log_list.length>0)for(var c=0;c<a.report_choose.choose_log_list.length;c++)for(var d=a.report_choose.choose_log_list[c],e=0;e<a.data.log_type_list.length;e++){var f=a.data.log_type_list[e];f.log_name==d.log_name&&(f.choose_log=!0)}p(a.report_choose.start_date,a.report_choose.end_date)},0)},function(a){g.alert(a.message,3)}):q()};a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a.info.datepicker.opened=!0},a.checkCurLogType=function(b){for(var c=0;c<a.data.log_type_list.length;c++){var d=a.data.log_type_list[c];d.checked=!1}if(b.checked=!0,a.report_choose.choose_log_name=b.log_name,a.data.curr_node=b.logSyncInfos,a.report_choose.start_date&&a.report_choose.end_date){var e=[];if(b.logSyncInfos)for(var f=0;f<b.logSyncInfos.length;f++){var g=b.logSyncInfos[f];g.file_date&&k.dtFormat(a.report_choose.start_date)<=g.file_date&&g.file_date<=k.dtFormat(a.report_choose.end_date)&&e.push(g)}a.data.logSyncInfoList=e}else a.data.logSyncInfoList=b.logSyncInfos?b.logSyncInfos:[]},a.saveReport=function(){if(!k.valiForm(a.form.log_screen))return!1;var c=[];return angular.forEach(a.data.log_type_list,function(a){a.choose_log&&c.push(a)}),a.report_choose.choose_log_list=c,a.report_choose.start_date=k.dtFormat(a.report_choose.start_date),a.report_choose.end_date=k.dtFormat(a.report_choose.end_date),a.report_choose.start_date>a.report_choose.end_date?(g.alert("时间输入不合法，请重新输入"),!1):0==a.report_choose.choose_log_list.length?(g.alert("未选择日志文件"),!1):void b.close(a.report_choose)},a.formCancel=function(){b.dismiss(!1)},a.$watch("report_choose.end_date",function(b,c){b!=c&&(a.data.logSyncInfoList=r(a.report_choose.start_date,a.report_choose.end_date,a.data.curr_node),p(a.report_choose.start_date,a.report_choose.end_date))}),s()}]),modal_m.controller("importProgramCtrl",["$scope","$modalInstance","$timeout","$location","Program","Modal","CV",function(a,b,c,d,e,f,g){a.import_program_btn_loading=!0,a.program_loading=!1,a.program_error_upload=!1;var h=!1;a.program_fileupload={suffixs:"sql",filetype:"SQL",filename:"",uploadpath:""};var i=function(){e.getimportProgramUploadPath().then(function(b){c(function(){b&&(a.program_fileupload.uploadpath=b.program_upload_path)},0)},function(a){f.alert(a.message,3)})};a.uploadSuccessThen=function(){a.import_program_btn_loading=!1,a.program_loading=!1,e.importUsableProgram(a.program_fileupload.filename).then(function(){h=!0,a.program_loading=!0},function(b){a.program_loading=!0,a.program_error_upload=!0,a.program_error_message=b.message})},a.cancel=function(){h?b.close(!0):b.dismiss(!1)},i()}]),modal_m.controller("pgChangeHandleTypeCtrl",["$scope","$modalInstance","modalParam","Workorder","Modal","CV",function(a,b,c,d,e,f){var g=c.workId;a.info={sub_tab:{temp_handle_type:"",order_bk_title:""},form:{}};var h=function(){d.getWorkorder(g).then(function(b){b.woorderbean&&(a.info.sub_tab.order_bk_title=b.woorderbean.order_bk_title)},function(a){e.alert(a.message)})};a.formSubmit=function(){return f.valiForm(a.info.form.changeTypeform)?void b.close(a.info.sub_tab):!1},a.cancel=function(){b.dismiss()},h()}]),modal_m.controller("workorderAddSQLModalCtrl",["$scope","$modalInstance","$timeout","$location","modalParam","CodeMirrorOption","SqlExec","Program","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=e.flag,m=[],n="1";a.control={save_btn_loading:!1,get_soc_loading:!1,get_sys_loading:!1,get_srv_loading:!1},a.info={form:{},error_message:"",sql_info:{},sensite_info:{}},a.data={sql_sys_list:[],sql_soc_list:[],sql_srv_list:[],srv_name:""},a.config={editorOptions:f.Sql()};var o=function(){1==l?(a.info.sql_info.sys_name=e.sub_tab.basicData.sys_name?e.sub_tab.basicData.sys_name:"",1==e.sub_tab.basicData.workorder_type&&a.info.sql_info.sys_name&&a.selectSys(a.info.sql_info.sys_name),a.info.sql_info={sql_steps:[],sys_name:e.sub_tab.basicData.sys_name?e.sub_tab.basicData.sys_name:""},4==e.sub_tab.handle_type&&(a.info.sensite_info={show_table_flag:!0,sensitive_list:[]})):a.info.sql_info={sys_name:"",sql_txt:"",soc_name:""},a.control.get_sys_loading=!0,i.getAllBusinessSys().then(function(b){c(function(){b&&(a.control.get_sys_loading=!1,a.data.sql_sys_list=b.list_bs?b.list_bs:[])},0)},function(b){a.control.get_sys_loading=!1,j.alert(b.message,3)}),p()},p=function(){a.control.get_srv_loading=!0,h.selectSrv(n).then(function(b){if(b){a.control.get_srv_loading=!1,m=b.server_bean_list;for(var c=0;c<m.length;c++)a.data.sql_srv_list[c]=m[c].server_ip}},function(b){j.alert(b.message,3),a.control.get_srv_loading=!1})};a.selectSrv=function(b){for(var c=0;c<m.length;c++)m[c].server_ip==b&&(a.data.sql_soc_list=m[c].all_soc_name)};var q=function(d){var e=d.basicData.order_seq,h=d.basicData.deal_bk_seq,i=a.info.sql_info.sys_name,k=a.info.sql_info.soc_name,l=a.info.sql_info.sql_txt;4==d.handle_type?g.addSelectSql(e,h,i,l,k).then(function(e){c(function(){if(e.parser_flag&&e.sl_msg_list){for(var c=0;c<e.sl_msg_list.length;c++){var g=e.sl_msg_list[c];g.sensite_list=a.info.sensite_info.sensitive_list,a.info.sql_info.sql_steps.push(g)}var h={sql_steps:a.info.sql_info.sql_steps,is_sql:d.is_sql};b.close(h)}else e.parser_failed_msg&&j.alert(e.parser_failed_msg);a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1)},0)},function(b){a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1),j.alert(b.message,3)}):g.addSql(e,h,i,l,k).then(function(e){c(function(){if(e.parser_flag&&e.sl_msg_list){for(var c=0;c<e.sl_msg_list.length;c++){var g=e.sl_msg_list[c];a.info.sql_info.sql_steps.push(g)}var h={sql_steps:a.info.sql_info.sql_steps,is_sql:d.is_sql};b.close(h)}else e.parser_failed_msg&&j.alert(e.parser_failed_msg);a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1)},0)},function(b){a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1),j.alert(b.message,3)})};a.selectSys=function(b){a.info.error_message="",a.control.get_soc_loading=!0,h.getSocByBusy(b,1).then(function(b){c(function(){if(b){a.info.sql_info.soc_name="",a.control.get_soc_loading=!1,a.data.sql_soc_list=[];for(var c=b.source_list?b.source_list:[],d=0;d<c.length;d++)a.data.sql_soc_list.push(c[d].soc_name)}},0)},function(b){a.control.get_soc_loading=!1,a.info.error_message=b.message})},a.addSensitiveParam=function(a){var b=a.length;return 0==b||""!=a[b-1].param_name&&""!=a[b-1].param_value?void a.push({param_name:"",param_value:""}):(j.alert("请完善当前数据操作"),!1)},a.removeSensitiveParam=function(a,b){b.splice(a,1)},a.formSubmit=function(){return k.valiForm(a.info.form.sql_handle_form)?(a.control.save_btn_loading=!0,a.config.editorOptions=f.Sql(!1),void(1==l?q(e.sub_tab):(a.info.sql_info.sql_txt=a.info.sql_info.sql_txt.trim(),h.addProgramStepSql(e.program_seq,a.info.sql_info.step_seq,a.info.sql_info.sql_txt,a.info.sql_info.sys_name).then(function(c){c&&(a.control.save_btn_loading=!1,a.info.sql_info.sql_param_list=c.sql_param_list?c.sql_param_list:[],b.close(a.info.sql_info))},function(b){a.control.save_btn_loading=!1,j.alert("请填写正确的SQL语句")})))):!1},a.formCancel=function(){b.dismiss(!1)},o()}]),modal_m.controller("importProgramSqlCtrl",["$scope","$modalInstance","$timeout","modalParam","Program","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h){a.info={sql_info:{sys_name:"",sql_txt:"",soc_name:"",sql_seq:0},form:{sql_handle_form:{}},handleData:d.handleData,error_message:""},a.data={busy_sys_list:[],sql_soc_list:[],srv_list:[]},a.control={soc_btn_loading:!1};var i=function(){a.info.handleData.checkFlag=0,a.changeSysNameAndSoc(a.info.handleData.sql_msg_list[0]),f.getAllBusinessSys().then(function(b){a.data.busy_sys_list=b.list_bs?b.list_bs:[]},function(a){g.alert(a.message,3)})};a.selectSys=function(b){a.info.error_message="",a.control.soc_btn_loading=!0,e.getSocByBusy(b,1).then(function(b){c(function(){if(b){a.data.sql_soc_list=[];for(var c=b.source_list?b.source_list:[],d=0;d<c.length;d++)a.data.sql_soc_list.push(c[d].soc_name);console.log(a.data.sql_soc_list),a.control.soc_btn_loading=!1}},0)},function(b){a.control.soc_btn_loading=!1,a.info.error_message=b.message})},a.changeSysNameAndSoc=function(b){b&&(a.info.sql_info.sys_name=b.sys_name,a.info.sql_info.soc_name=b.soc_name,a.info.sql_info.curr_index=b.curr_index,a.info.sql_info.sql_txt=b.sql_text,a.selectSys(a.info.sql_info.sys_name))},a.saveAddSql=function(){return h.valiForm(a.info.form.sql_handle_form)?void b.close(a.info.sql_info):!1},a.cancel=function(){b.dismiss()},i()}]),modal_m.controller("importBatchSQLCtrl",["$scope","$modalInstance","$timeout","modalParam","SqlExec","Modal","CV",function(a,b,c,d,e,f,g){a.info={sub_tab:d.sub_tab},a.config={sql_fileupload:{suffixs:"sql",filetype:"SQL",filename:"",uploadpath:a.info.sub_tab.batch_fileupload.uploadpath}},a.uploadSqlSuccessThen=function(){a.info.sub_tab.batch_fileupload.filename=a.config.sql_fileupload.filename},a.removeSqlFile=function(){a.config.sql_fileupload.filename="",a.info.sub_tab.batch_fileupload.filename=""},a.downloadSqlFile=function(){var b=a.config.sql_fileupload.uploadpath+"/"+a.config.sql_fileupload.filename;g.downloadFile(b)},a.submit=function(){return a.config.sql_fileupload.filename?(console.log(a.info.sub_tab),void b.close(a.info.sub_tab)):(f.alert("请先上传SQL文件！"),!1)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("viewExeInfoCtrl",["$scope","$modalInstance","modalParam",function(a,b,c){a.message=c.message?c.message:[],a.scroll_exec_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("viewTaskDetailCtrl",["$scope","$modalInstance","$timeout","modalParam","SqlExec","Task",function(a,b,c,d,e,f){var g=d.task_id?d.task_id:"";a.work_detail_list=[],a.currentPoint=0,a.data_loading=!0,a.error_message="",a.scroll_flow_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},f.getTaskDetail(g).then(function(b){a.data_loading=!1,a.work_detail_list=b.work_detail_list?b.work_detail_list:[],a.apply_bk_expl=b.apply_bk_expl?b.apply_bk_expl:"",a.pendwk_bk_expl=b.pendwk_bk_expl?b.pendwk_bk_expl:"",a.user_cn_name=b.user_cn_name?b.user_cn_name:"",a.workflow_state=b.workflow_state?b.workflow_state:"";for(var c=0;c<a.work_detail_list.length;c++)1==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="申请":2==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="复核":3==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="授权":4==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="执行":a.work_detail_list[c].deal_type_name="关闭";for(var c=0;c<a.work_detail_list.length;c++)a.work_detail_list[c].user_cn_name&&(a.currentPoint=c),a.work_detail_list[c].show=!1},function(b){a.data_loading=!1,a.error_message=b.message}),a.styleCh=function(a){return{position:"relative",top:(0==a?2:79*a)+"px"}},a.styleAng=function(b,c){return 2==a.workflow_state||4==a.workflow_state?{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state?"#0095A5":2==c.work_state?"#D85668":b==a.work_detail_list.length-1?"#fff":"#CCCCCC","border-radius":"20px",border:1==c.work_state?"2px solid #0095A5":2==c.work_state?"2px solid #D85668":b==a.work_detail_list.length-1?"2px solid #0095A5":"2px solid #CCCCCC",left:"100px",top:"10px","text-align":"center"}:1==a.workflow_state||3==a.workflow_state||5==a.workflow_state?{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state||3==c.work_state?"#0095A5":"#1c2837",border:"2px solid #0095A5","border-radius":"20px",left:"100px",top:"10px","text-align":"center"}:7==a.workflow_state?{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state&&b!=a.work_detail_list.length-1?"#0095A5":2==c.work_state?"#F37889":b==a.work_detail_list.length-1?"black":"#CCCCCC","border-radius":"20px",left:"100px",top:"10px","text-align":"center"}:{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state?"#0095A5":2==c.work_state?"#F37889":4==c.work_state?"#0095A5":"#CCCCCC","border-radius":"20px",left:"100px",top:"10px","text-align":"center"}},a.formCancel=function(){b.close(a.workflow_state)}}]),modal_m.controller("ProgramDetailSqlStepCtrl",["$scope","$modalInstance","$timeout","SqlExec","modalParam","SqlType","BucketType","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=e.sql_work_seq;a.info={sql_seq:"",sql_text:"",sys_cn_name:"",soc_priv:"",stp_info_list:[],sql_type:"",priv_yn_flag:"",sql_where:"",scp_info_list:[],exp_bk_num:"",exp_exec_time:"",bucket_type:""},a.control={sqldetail_loading:!1,sqldetail_error:!1,sqldetail_error_message:""};var k=function(){d.getSqlSchemeResult(j).then(function(b){c(function(){b.sql_detail_msg&&(a.info.sql_seq=b.sql_detail_msg.sql_seq,a.info.sql_text=b.sql_detail_msg.sql_text,a.info.sys_cn_name=b.sql_detail_msg.sys_cn_name,a.info.soc_priv=b.sql_detail_msg.soc_priv,a.info.stp_info_list=b.sql_detail_msg.stp_info_list?b.sql_detail_msg.stp_info_list:[],a.info.sql_type=b.sql_detail_msg.sql_type,a.info.priv_yn_flag=b.sql_detail_msg.priv_yn_flag,a.info.sql_where=b.sql_detail_msg.sql_where,a.info.scp_info_list=b.sql_detail_msg.scp_info_list?b.sql_detail_msg.scp_info_list:[],a.info.exp_bk_num=b.sql_detail_msg.exp_bk_num,a.info.exp_exec_time=b.sql_detail_msg.exp_exec_time,a.info.bucket_type=b.sql_detail_msg.bucket_type,a.info.sql_type_cn=i.findValue(a.info.sql_type,f),a.info.bucket_cn_type=i.findValue(a.info.bucket_type,g),a.control.sqldetail_loading=!0)},0)},function(b){a.control.sqldetail_loading=!0,a.control.sqldetail_error=!0,a.control.sqldetail_error_message=b.message})};a.closeModal=function(){b.dismiss(!1)},k()}]),modal_m.controller("ProgramConfirmSqlStatementCtrl",["$scope","$modalInstance","modalParam","Modal",function(a,b,c,d){a.info={sql_step:c.sql_step,unsubmit_sql_steps:c.un_submit_sql_steps},a.control={confirm_btn_loading:!1},a.viewSqlStepModal=function(a){d.viewSqlDetailStep(a).then(function(){})},a.confirm=function(){a.confirm_btn_loading=!0,b.close(a.sql_step)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("pgLocalauthCtrl",["$scope","$modalInstance","Workorder","modalParam","Modal",function(a,b,c,d,e){a.condition_text=d.data.condition_text,a.u={},a.authdprl_bk_expl=d.data.authdprl_bk_expl,a.btnBus_loading=!1,a.order_bk_title=d.srv_req.order_bk_title,a.program_name=d.srv_req.program_name,a.step_bk_title=d.srv_req.step_bk_title,a.ok=function(){if(a.btnBus_loading=!0,!a.u.userId)return e.alert("授权用户名为空！"),a.btnBus_loading=!1,!1;if(!a.u.userPwd)return e.alert("授权用户密码为空！"),a.btnBus_loading=!1,!1;var f={auth_dprl_code:d.data.auth_dprl_code,auth_user_id:a.u.userId,user_passed:a.u.userPwd,auth_key:d.data.auth_key};c.checkPgLocalAuth(f).then(function(a){1==a.pgsvdeal_type?b.close(a):2==a.pgsvdeal_type&&b.close(a)},function(c){a.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})})},a.cancel=function(){b.close("system")}}]),modal_m.controller("pgRemoteauthCtrl",["$scope","$modalInstance","Task","modalParam","Modal","CV",function(a,b,c,d,e,f){a.info={order_bk_title:d.srv_req.order_bk_title,pendwk_bk_expl:d.data.condition_text,program_name:d.srv_req.program_name,step_bk_title:d.srv_req.step_bk_title,apply_bk_expl:"",form:{}},a.control={btnBus_loading:!1},a.submitRaForm=function(){if(a.control.btnBus_loading=!0,!f.valiForm(a.info.form.raForm))return a.control.btnBus_loading=!1,!1;var e=angular.copy(d.srv_req);d.data.pgsubmit_type=4,d.data.apply_bk_expl=a.info.apply_bk_expl,d.data.sql_list=e.sql_list,d.data.order_seq=e.order_seq,d.data.deal_bk_seq=e.deal_bk_seq,d.data.order_bk_title=e.order_bk_title,d.data.program_name=e.program_name,d.data.step_bk_title=e.step_bk_title,d.data.step_seq=e.step_seq,c.ExecuteTask(d.data,e.org_srv_name).then(function(a){a.success=!0,b.close(a)},function(c){a.control.btnBus_loading=!1,b.close("system")})},a.cancel=function(){b.close("system")}}]),modal_m.controller("viewScriptInfoCtrl",["$scope","$modalInstance","$timeout","modalParam","CodeMirrorOption","CmptFunc","ScriptExec",function(a,b,c,d,e,f,g){var h=d.order_seq,i=d.deal_bk_seq,j=d.script_bk_seq;a.info={impl_type:"",script_text:"",exe_msg_list:[],error_msg:""},a.control={error_flag:!1,loading_flag:!1},a.config={detailOptionShell:e.Sh(!0),detailOptionPython:e.Python(!0)};var k=function(){a.control.loading_flag=!0,g.viewStepDetail(h,i,j).then(function(b){c(function(){if(b.exetend_bean){a.control.loading_flag=!1,a.info.impl_type=b.exetend_bean.impl_type,a.info.script_text=b.exetend_bean.script_content?f.cmdsToString(b.exetend_bean.script_content):"",a.info.exe_msg_list=b.exetend_bean.source_list?b.exetend_bean.source_list:[];for(var c=0;c<a.info.exe_msg_list.length;c++)if(a.info.exe_msg_list[c].collapse_flag=!0,2==a.info.exe_msg_list[c].exe_result){a.control.error_flag=!0;break}}},0)},function(b){a.control.loading_flag=!1,a.info.error_msg=b.message})};a.close=function(){b.close(!0)},k()}]),modal_m.controller("viewWorkOrderFlowCtrl",["$scope","$modalInstance","$timeout","ScrollBarConfig","modalParam",function(a,b,c,d,e){a.info={pgDetailList:[]},a.config={scroll_y_info:d.Y()};var f=function(){a.info.pgDetailList=e.data.pg_detail_list?e.data.pg_detail_list:[]};a.formCancel=function(){b.close("error")},f()}]),modal_m.controller("faultProgramSqlDetailCtrl",["$scope","$modalInstance","$timeout","modalParam","Program","SqlType","Modal","CV",function(a,b,c,d,e,f,g,h){var i=d.program_seq,j=d.step_seq,k=d.sql_seq;a.info={step_seq:j,sql_index:k,sql_detail_info:{}},a.control={sql_detail_loading:!1,sql_detail_error:!1};var l=function(b,c,d){a.control.sql_detail_loading=!0,e.viewProgramStepSqlDetail(b,c,d).then(function(b){b.sql_parse_bean&&(a.info.sql_detail_info.sql_type=b.sql_parse_bean.sql_type,a.info.sql_detail_info.sql_type_cn=h.findValue(a.info.sql_detail_info.sql_type,f),a.info.sql_detail_info.sys_cn_name=b.sql_parse_bean.sys_cn_name,a.info.sql_detail_info.sql_text=b.sql_parse_bean.sql_text,a.info.sql_detail_info.sql_where=b.sql_parse_bean.sql_where,a.info.sql_detail_info.tbl_name_list=b.sql_parse_bean.tbl_name_list?b.sql_parse_bean.tbl_name_list:[],a.info.sql_detail_info.select_parse_list=b.sql_parse_bean.select_parse_list?b.sql_parse_bean.select_parse_list:[],a.info.sql_detail_info.modify_parse_list=b.sql_parse_bean.modify_parse_list?b.sql_parse_bean.modify_parse_list:[],a.control.sql_detail_loading=!1)},function(b){a.control.sql_detail_loading=!1,a.control.sql_detail_error=!0,a.info.sql_detail_info.errorMessage=b.message})},m=function(){l(i,j,k)};a.cancel=function(){b.dismiss(!1)},m()}]),modal_m.controller("importProgramStepCtrl",["$scope","$modalInstance","$timeout","modalParam","Program","Modal","CV",function(a,b,c,d,e,f,g){
a.info={excel_download_path:""},a.config={program_step_fileupload:{suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:""}};var h=function(){e.getimportProgramUploadPath().then(function(b){c(function(){b&&(a.config.program_step_fileupload.uploadpath=b.program_upload_path?b.program_upload_path:"")},0)},function(a){f.alert(a.message,3)})};a.uploadSuccessThen=function(){a.info.excel_download_path=a.config.program_step_fileupload.uploadpath+a.config.program_step_fileupload.filename},a.downLoadExcel=function(){g.downloadFile(a.info.excel_download_path)},a.deleteExcel=function(){a.config.program_step_fileupload.filename=""},a.saveProgramStep=function(){return a.config.program_step_fileupload.filename?void b.close(a.config.program_step_fileupload.filename):(f.alert("请先上传文件！"),!1)},a.cancel=function(){b.dismiss()},h()}]),modal_m.controller("viewTroubleTicketProgramCtrl",["$scope","$modalInstance","$timeout","modalParam","Task","WoStatusType","ScrollBarConfig","Modal",function(a,b,c,d,e,f,g,h){var i=d.task_id;a.info={},a.config={scroll_info:g.XY()};var j=function(b){e.viewTaskProgramDetail(b).then(function(b){c(function(){a.info=b},0)},function(a){h.alert(a.message,3)})},k=function(){j(i)};a.close=function(){b.dismiss(!1)},k()}]),modal_m.controller("faultPeakDateModalCtrl",["$scope","$modalInstance","WorkDayType","modalParam","TroubleConfig","Modal","CV",function(a,b,c,d,e,f,g){var h=d.time_work_seq,i=new Date;i.setHours(0),i.setMinutes(0);var j=new Date;j.setHours(23),j.setMinutes(59),a.info={peak_data:{time_cn_name:"",time_bk_desc:"",wday_type:"",start_bk_date:"",end_bk_date:"",times:[],start_time:i,end_time:j},form:{}},a.data={work_day_type_list:c},a.control={edit_flag:!1,show_date_flag:!1,show_time_group_flag:!1,save_btn_loading:!1};var k=function(){h&&e.viewPeakTimeIntervalInfo(h).then(function(b){if(b.time_interval_bean){var d=b.time_interval_bean;a.info.peak_data.time_work_seq=d.time_work_seq,a.info.peak_data.time_cn_name=d.time_cn_name,a.info.peak_data.time_bk_desc=d.time_bk_desc,a.info.peak_data.wday_type=d.wday_type,(3==a.info.peak_data.wday_type||4==a.info.peak_data.wday_type)&&(a.control.show_date_flag=!0),a.info.peak_data.wday_type_cn=g.findValue(d.wday_type,c),d.start_bk_date&&d.end_bk_date&&(a.info.peak_data.start_bk_date=d.start_bk_date,a.info.peak_data.end_bk_date=d.end_bk_date),a.info.peak_data.times=d.times}})};a.changeDateState=function(b){a.control.show_date_flag=3==b||4==b?!0:!1,(1==b||2==b)&&(a.info.peak_data.start_bk_date="",a.info.peak_data.end_bk_date="")},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.info.form.opened=!0},a.addTimeGroup=function(b,c){var d=g.dttFormat(b).substr(0,5),e=g.dttFormat(c).substr(0,5);if(b>c)return f.alert("开始时间大于结束时间，请重新选择"),!1;for(var h=0;h<a.info.peak_data.times.length;h++){var i=a.info.peak_data.times[h];if(d==i.start_time&&e==i.end_time)return f.alert("不可重复添加，重新选择！"),!1}a.info.peak_data.times.push({start_time:d,end_time:e})},a.deleteTimeGroup=function(b){a.info.peak_data.times.splice(b,1)},a.formSubmit=function(){if(!g.valiForm(a.info.form.peakForm))return!1;if(3==a.info.peak_data.wday_type||4==a.info.peak_data.wday_type){if(!a.info.peak_data.start_bk_date||!a.info.peak_data.end_bk_date)return f.alert("日期不可以为空"),!1;if(a.info.peak_data.start_bk_date>a.info.peak_data.end_bk_date)return f.alert("开始日期大于结束日期，请重新选择"),!1;a.info.peak_data.start_bk_date=g.dtFormat(a.info.peak_data.start_bk_date),a.info.peak_data.end_bk_date=g.dtFormat(a.info.peak_data.end_bk_date)}a.control.save_btn_loading=!0,h?e.modifyPeakTimeInterval(a.info.peak_data).then(function(c){c&&(f.alert("修改成功"),a.control.save_btn_loading=!1,b.close(!0))},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)}):e.addPeakTimeInterval(a.info.peak_data).then(function(c){c&&(a.control.save_btn_loading=!1,f.alert("新增成功"),b.close(!0))},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)})},a.formCancel=function(){b.dismiss(!1)},k()}]),modal_m.controller("faultTroubleTypeCtrl",["$scope","$modalInstance","$timeout","modalParam","TroubleConfig","Modal","CV",function(a,b,c,d,e,f,g){var h=d.trouble_key;a.info={form:{},trouble_type_info:{trouble_code:"",trouble_bk_desc:""}},a.control={edit_flag:!1,save_btn_loading:!1};var i=function(){h&&(a.control.edit_flag=!0,e.viewTroubleTypeInfo(h).then(function(b){c(function(){a.info.trouble_type_info.trouble_key=b.trouble_key,a.info.trouble_type_info.trouble_code=b.trouble_code?b.trouble_code:"",a.info.trouble_type_info.trouble_bk_desc=b.trouble_bk_desc?b.trouble_bk_desc:""},0)},function(a){f.alert(a.message,3)}))};a.formSubmit=function(){return a.control.save_btn_loading=!0,g.valiForm(a.info.form.trouble_type_form)?void(h?e.updateTroubleType(a.info.trouble_type_info).then(function(d){d&&c(function(){a.control.save_btn_loading=!1,f.alert("修改成功"),b.close(!0)},0)},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)}):e.addTroubleType(a.info.trouble_type_info).then(function(d){d&&c(function(){a.control.save_btn_loading=!1,f.alert("新增成功"),b.close(!0)},0)},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)})):(a.control.save_btn_loading=!1,!1)},a.formCancel=function(){b.dismiss(!1)},i()}]),modal_m.controller("schemePreviewCtrl",["$scope","$timeout","$routeParams","$modalInstance","modalParam","Program","Modal",function(a,b,c,d,e,f,g){a.info={program_seq:e.programSeq,steps:[]};var h=function(c){b(function(){f.previewProgram(c).then(function(b){a.info.steps=b.preview_pg_list?b.preview_pg_list:[]},function(a){g.alert(a.message,3)})},0)},i=function(){h(a.info.program_seq)};a.lineStyle=function(a){return{width:"2px",height:"100%",position:"absolute","background-color":2==a.type?"#3D9ED8":"#555f76",left:"-32px",top:"18px"}},a.cancel=function(){d.close(!0)},i()}]),modal_m.controller("workOrderRollbackCtrl",["$scope","$timeout","$modalInstance","modalParam","Workorder","Modal","CV",function(a,b,c,d,e,f,g){var h=d.order_seq;a.info={workorder_rollback_info:{order_seq:h,workorder_title:"",deal_bk_expl:""},form:{}},a.control={save_rollback_btn_loading:!1};var i=function(){e.getWorkorder(h).then(function(c){b(function(){c.woorderbean&&(a.info.workorder_rollback_info.workorder_title=c.woorderbean.order_bk_title)},0)},function(a){f.alert(a.message,3)})};a.formSubmit=function(){return g.valiForm(a.info.form.rollback_form)?(a.control.save_rollback_btn_loading=!0,void e.rollbackWorkorder(a.info.workorder_rollback_info).then(function(d){b(function(){d&&(a.control.save_rollback_btn_loading=!1,c.close(!0))},0)},function(b){a.control.save_rollback_btn_loading=!1,f.alert(b.message,3)})):!1},a.formCancel=function(){c.dismiss(!1)},i()}]),modal_m.controller("workOrderAppointCtrl",["$scope","$timeout","$modalInstance","$rootScope","modalParam","Workorder","Modal","CV",function(a,b,c,d,e,f,g,h){var i=e.order_seq,j=d.loginUser,k=j.org_user_id,l=j.org_dept_id;a.form={},a.info={workorder_appoint_info:{order_seq:i,deal_dept_id:"",deal_user_id:"",order_bk_title:""},form:{}},a.data={department_list:[],employee_list:[]},a.control={judge_cur_appoint:!1,save_appoint_btn_loading:!1,get_appoint_info_loading:!1};var m=function(c){f.getAppointStaffList(c).then(function(c){b(function(){a.data.employee_list=c.user_list?c.user_list:[]},0)},function(a){g.alert(a.message,3)})},n=function(b,c){l==b&&k==c?a.control.judge_cur_appoint=!0:a.control.judge_cur_appoint=!1},o=function(){a.control.get_appoint_info_loading=!0,f.getWorkorder(i).then(function(c){b(function(){c.woorderbean&&(a.control.get_appoint_info_loading=!1,a.info.workorder_appoint_info.order_bk_title=c.woorderbean.order_bk_title,a.info.workorder_appoint_info.deal_dept_id=c.woorderbean.deal_dept_id,a.info.workorder_appoint_info.deal_user_id=c.woorderbean.deal_user_id,m(a.info.workorder_appoint_info.deal_dept_id),n(a.info.workorder_appoint_info.deal_dept_id,a.info.workorder_appoint_info.deal_user_id))},0)},function(b){a.control.get_appoint_info_loading=!1,a.info.error_message=b.message}),f.getAppointDepartmentList().then(function(c){b(function(){a.data.department_list=c.dept_list?c.dept_list:[]},0)},function(a){g.alert(a.message,3)})};a.selectDepartment=function(b){a.info.workorder_appoint_info.deal_user_id="",m(b)},a.formSubmit=function(){return h.valiForm(a.info.form.pointForm)?(a.control.save_appoint_btn_loading=!0,void f.appiontWorkorder(a.info.workorder_appoint_info).then(function(d){b(function(){d&&(a.control.save_appoint_btn_loading=!1,c.close(!0))},0)},function(b){a.control.save_appoint_btn_loading=!1,g.alert(b.message,3)})):!1},a.formCancel=function(){c.dismiss(!1)},o()}]),modal_m.controller("workOrderChangeCtrl",["$scope","$timeout","$modalInstance","Workorder","modalParam","WoCloseType","WoRestartType","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=e.order_seq;a.info={workorder_change_info:{order_seq:j,workorder_title:"",flow_type:"",close_type:"",restart_type:"",deal_bk_expl:""},form:{}},a.control={save_change_btn_loading:!1},a.data={change_reason:[]};var k=function(){d.getWorkorder(j).then(function(c){b(function(){c.woorderbean&&(a.info.workorder_change_info.workorder_title=c.woorderbean.order_bk_title)},0)},function(a){h.alert(a.message,3)})};a.selectChangeType=function(b){a.info.workorder_change_info.flow_type=b,5==a.info.workorder_change_info.flow_type?a.data.change_reason=f:a.data.change_reason=g},a.formSubmit=function(){return a.info.workorder_change_info.flow_type?i.valiForm(a.info.form.change_form)?(a.control.save_change_btn_loading=!0,void d.changeWorkorder(a.info.workorder_change_info).then(function(d){b(function(){d&&(a.control.save_change_btn_loading=!1,c.close(!0))},0)},function(b){a.control.save_change_btn_loading=!1,h.alert(b.message,3)})):!1:(h.alert("请选择变更类型"),!1)},a.formCancel=function(){c.dismiss(!1)},k()}]),modal_m.controller("viewSingleWorkCtrl",["$scope","$rootScope","$modalInstance","$interval","$timeout","modalParam","AutoFlowOpType","IML_TYPE","dataBaseType","CmptType","CmptFunc","Cmpt","Flow","CodeMirrorOption","JobOpType","pluginType","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u,v,w=f.flow_job_list?f.flow_job_list:[],x=f.task_id?f.task_id:"",y=f.job?f.job:{},z=y.sd_job_bean.annex_file?y.sd_job_bean.annex_file.substring(y.sd_job_bean.annex_file.lastIndexOf("/")+1):"",A=z?k.judgeFileType(z.substring(z.lastIndexOf(".")+1)):"",B=1;b.dispatch_task_status=b.dispatch_task_status?b.dispatch_task_status:0,a.task_status=f.task_status?f.task_status:0,a.viewScriptEditor=n.Sh(!0),a.viewJavaCodeEditor=n.Java(!0),a.single_work={pre_job_list:y.sd_job_bean.pre_job_list?y.sd_job_bean.pre_job_list:[],job_status:y.sd_job_bean.job_status?y.sd_job_bean.job_status:0,job_type:y.type?y.type:0,job_cn_name:y.sd_job_bean.sdwork_cn_name?y.sd_job_bean.sdwork_cn_name:"",job_id:y.sd_job_bean.job_id?y.sd_job_bean.job_id:0,input_params:y.sd_job_bean.input?y.sd_job_bean.input:[],output_params:y.sd_job_bean.output?y.sd_job_bean.output:[],error_handle:y.sd_job_bean.error_handle?y.sd_job_bean.error_handle:1,over_type:y.sd_job_bean.over_type?y.sd_job_bean.over_type:1,env_name:y.sd_job_bean.env_name?y.sd_job_bean.env_name:"",plugin_list:y.sd_job_bean.plugin_list?y.sd_job_bean.plugin_list:[],annex_file:y.sd_job_bean.annex_file?y.sd_job_bean.annex_file:"",job_err_msg:""},a.controls={basic_loading:!1,basic_err_msg:"",operate_err_msg:"",codemirror_refresh:!1,is_detail:f.is_detail,task_finish:!1,complete_job:!1,job_error:!1,polling_end:!1,op_type:1,tem_op_list:[]},a.accessory_fileupload={suffixs:"",filetype:A,filename:z,uploadpath:""},a.config={scroll_config:q.Y()};var C=function(b){B=6>b?1:6==b?4:7==b||8==b?2:14==b?3:1,(14==a.single_work.job_type||15==a.single_work.job_type)&&(B=4),a.viewScriptEditor=4==B?n.Sql(!0):3==B?n.Java(!0):2==B?n.Python(!0):n.Sh(!0)},D=function(){for(var a,b=0;b<w.length;b++){var c=w[b];if(3!=c.type&&y.sd_job_bean.job_id===c.sd_job_bean.job_id){a=b;break}}return a},E=function(){for(var b=0;b<w.length;b++){var c=w[b];if(3!=c.type)for(var e=0;e<a.single_work.pre_job_list.length;e++){var f=a.single_work.pre_job_list[e];f.job_id==c.sd_job_bean.job_id&&(f.job_status=c.sd_job_bean.job_status?c.sd_job_bean.job_status:1,f.job_type=c.sd_job_bean.job_type?c.sd_job_bean.job_type:0,f.job_cn_name=c.sd_job_bean.sdwork_cn_name?c.sd_job_bean.sdwork_cn_name:"",c.sd_job_bean.sdwork_cn_name||1!=c.type||(f.job_cn_name="开始")),f.job_status>=3&&d.cancel(u)}}},F=function(a){u&&d.cancel(u),t&&d.cancel(t),c.close(a)},G=function(){e(function(){var b=$(".col-left"),c=$(".col-right").height(),d=$(".job_errmsg");b.height(c),a.single_work.job_err_msg&&d.css({"max-height":c-120+"px"})},200)},H=function(){a.controls.basic_err_msg="",m.viewSingleJobInfo(x,a.single_work.job_id).then(function(b){e(function(){b.job_info&&(G(),0!==a.single_work.pre_job_list.length&&(E(),u=d(function(){E()},1e3)),a.single_work.input_params=b.job_info.input_list?b.job_info.input_list:[],a.single_work.output_params=b.job_info.output_list?b.job_info.output_list:[],a.single_work.job_type<=2?(a.single_work.datetime_condition=b.job_info.datetime_condition?b.job_info.datetime_condition.substring(b.job_info.datetime_condition.lastIndexOf("."),-1):"",a.single_work.datetime_condition||(a.single_work.datetime_condition=y.sd_job_bean.datetime_condition?y.sd_job_bean.datetime_condition.substring(y.sd_job_bean.datetime_condition.lastIndexOf("."),-1):"")):(a.single_work.job_method=b.job_info.job_method?b.job_info.job_method:0,a.single_work.job_bk_desc=b.job_info.job_desp,a.single_work.timeout=b.job_info.timeout,a.single_work.polling_max_times=b.job_info.polling_max_times?b.job_info.polling_max_times:y.sd_job_bean.polling_max_times,a.single_work.polling_interval=b.job_info.polling_interval?b.job_info.polling_interval:y.sd_job_bean.polling_interval,(3==a.single_work.job_status||5==a.single_work.job_status)&&(a.single_work.input_params=b.job_info.input_list?b.job_info.input_list:[],a.single_work.output_params=b.job_info.output_list?b.job_info.output_list:[]),a.single_work.expr=y.sd_job_bean.expr?y.sd_job_bean.expr:"",b.job_info.component_info&&(a.single_work.exe_cn_type=b.job_info.component_info.impl_type?s.findValue(b.job_info.component_info.impl_type,h):"",a.single_work.script_list=b.job_info.component_info.script_list?b.job_info.component_info.script_list:[],a.single_work.script_source=b.job_info.component_info.component_source?b.job_info.component_info.component_source:1,a.single_work.comp_cn_name=b.job_info.component_info.cn_name,a.single_work.cmpt_cn_type="",C(b.job_info.component_info.impl_type),b.job_info.component_info.component_purposes&&0!=b.job_info.component_info.component_purposes.length&&angular.forEach(b.job_info.component_info.component_purposes,function(b){a.single_work.cmpt_cn_type+="  "+s.findValue(b,j)}),angular.forEach(a.single_work.script_list,function(a){a.exe_script=a.cmds?k.cmdsToString(a.cmds):""})),b.job_info.sdDefineCompBean&&(a.single_work.dataBase_type_cn=b.job_info.sdDefineCompBean.dataBase_type?s.findValue(b.job_info.sdDefineCompBean.dataBase_type,i):"",a.single_work.service_name=b.job_info.sdDefineCompBean.service_name,a.single_work.script_source=b.job_info.sdDefineCompBean.script_source,a.single_work.exe_script=b.job_info.sdDefineCompBean.exec_script,a.single_work.file_name=b.job_info.sdDefineCompBean.script_file_name,a.single_work.script_cn_type=b.job_info.sdDefineCompBean.comp_impl_type?s.findValue(b.job_info.sdDefineCompBean.comp_impl_type,h):"",C(b.job_info.sdDefineCompBean.comp_impl_type)),a.single_work.job_param_list=b.job_info.source_list?b.job_info.source_list:[],0===a.single_work.input_params.length&&(a.single_work.input_params=y.sd_job_bean.input?y.sd_job_bean.input:[]),0===a.single_work.output_params.length&&(a.single_work.output_params=y.sd_job_bean.output?y.sd_job_bean.output:[]))),a.controls.basic_loading=!1},0)},function(b){a.controls.basic_loading=!1,a.controls.basic_err_msg=b.message})},I=function(){m.viewSingleJobOpInfo(x,a.single_work.job_id).then(function(b){e(function(){if(a.controls.operate_err_msg="",b.job_operate_info){if(a.single_work.job_status=b.job_operate_info.job_status?b.job_operate_info.job_status:y.sd_job_bean.job_status,a.single_work.job_err_msg=b.job_operate_info.job_err_msg?b.job_operate_info.job_err_msg:"",1==a.controls.op_type){for(var c=b.job_operate_info.job_operate_list?b.job_operate_info.job_operate_list.sort(function(a,b){return Date.parse(b.operate_time)-Date.parse(a.operate_time)}):[],e=0,f=c.length;f>e;e++){var g=c[e];g.source_list=g.source_list?g.source_list:[];for(var h=0,i=g.source_list.length;i>h;h++)for(var j=g.source_list[h],k=0,l=a.controls.tem_op_list.length;l>k;k++){var m=a.controls.tem_op_list[k];if(m.operate_time===g.operate_time&&j.exe_ip===m.exe_ip){j.show_popover=m.show_popover;break}}}a.single_work.operate_list=c,angular.forEach(a.single_work.operate_list,function(a,b,c){a.sdmeddle_type>5&&a.sdmeddle_type<9?a.operate_type=1:16==a.sdmeddle_type?a.operate_type=2:9==a.sdmeddle_type?a.operate_type=3:11==a.sdmeddle_type||12==a.sdmeddle_type?a.operate_type=4:5==a.sdmeddle_type?a.operate_type=5:a.operate_type=0,a.operate_type&&(a.operate_cn_type=s.findValue(a.operate_type,o))})}else 3==a.single_work.job_status&&(H(),t&&d.cancel(t));a.controls.polling_end=6==a.single_work.job_type&&4==a.single_work.job_status,(4==a.single_work.job_status||7==a.single_work.job_status)&&(a.controls.job_error=!0),4==a.single_work.job_type||4!=a.single_work.job_status&&5!=a.single_work.job_status&&7!=a.single_work.job_status||(a.controls.complete_job=!0),G()}else a.single_work.operate_list=[]},0)},function(b){a.controls.operate_err_msg=b.message,a.single_work.operate_list=[]})},J=function(){I(),t=d(function(){I()},2e3)},K=function(b,c){for(var d,e=0,f=0,g=a.controls.tem_op_list.length;g>f;f++){var h=a.controls.tem_op_list[f];if(h.exe_ip===b.exe_ip&&h.operate_time===c.operate_time){d=!0,e=f;break}}if(d?a.controls.tem_op_list[e].show_popover=b.show_popover:a.controls.tem_op_list.push({operate_time:c.operate_time,exe_ip:b.exe_ip,show_popover:b.show_popover}),b.show_popover)for(var i=0,j=a.controls.tem_op_list.length;j>i;i++){var k=a.controls.tem_op_list[i];k.exe_ip===b.exe_ip&&k.operate_time===c.operate_time?console.log("当前选中"):k.show_popover=!1}},L=function(){angular.forEach(a.controls.tem_op_list,function(a,b,c){a.show_popover=!1})},M=function(){J(),G(),v=D(),H(),2!=a.single_work.error_handle||4!=a.single_work.job_status&&7!=a.single_work.job_status||(a.controls.task_finish=!0),(4==a.task_status||5==a.task_status)&&(a.controls.task_finish=!0,u&&d.cancel(u),t&&d.cancel(t)),a.controls.job_error=4==a.single_work.job_status||7==a.single_work.job_status,a.controls.complete_job=(4==a.single_work.job_status||5==a.single_work.job_status||7==a.single_work.job_status)&&4!=a.single_work.job_type};a.changeTab=function(b){a.controls.op_type!==b&&(a.controls.op_type=b,1===b?(u&&d.cancel(u),(4==a.task_status||5==a.task_status)&&t&&d.cancel(t)):H(),a.controls.tem_op_list=[],G())},a.singleWorkIcon=function(a,b){var c="",d="/60px";switch(a){case 1:c="url(img/dispatch/fl/palette/start.png)";break;case 2:c="url(img/dispatch/fl/palette/end.png)";break;case 4:c="url(img/dispatch/fl/context/condition.png)";break;case 5:c="url(img/dispatch/fl/context/stop.png)";break;case 6:c="url(img/dispatch/fl/context/rep.png)";break;case 7:c="url(img/dispatch/fl/context/ftpU.png)";break;case 8:c="url(img/dispatch/fl/context/ftpD.png)";break;case 9:c="url(img/dispatch/fl/context/sftpU.png)";break;case 10:c="url(img/dispatch/fl/context/sftpD.png)";break;case 11:c="url(img/dispatch/fl/context/zngtU.png)";break;case 12:c="url(img/dispatch/fl/context/zngtD.png)";break;case 13:c="url(img/dispatch/fl/context/copy.png)";break;case 14:c="url(img/dispatch/fl/context/sql.png)";break;case 15:c="url(img/dispatch/fl/context/sqlS.png)";break;case 16:c="url(img/dispatch/fl/context/web.png)";break;case 17:c="url(img/dispatch/fl/context/sysSt.png)";break;case 18:c="url(img/dispatch/fl/context/sysE.png)";break;case 19:c="url(img/dispatch/fl/context/python.png)";break;case 20:c="url(img/dispatch/fl/context/shell.png)";break;case 21:c="url(img/dispatch/fl/context/bat.png)";break;case 22:c="url(img/dispatch/fl/context/rb.png)";break;case 23:c="url(img/dispatch/fl/context/perl.png)";break;case 24:c="url(img/dispatch/fl/context/webs.png)";break;case 25:c="url(img/dispatch/fl/context/tcp.png)";break;case 26:c="url(img/dispatch/fl/context/http.png)";break;case 27:c="url(img/dispatch/fl/context/tux.png)";break;case 28:c="url(img/dispatch/fl/context/cl.png)";break;case 29:c="url(img/dispatch/fl/context/rpg.png)";break;case 30:c="url(img/dispatch/fl/context/java.png)";break;case 31:c="url(img/dispatch/fl/context/c.png)";break;case 32:c="url(img/dispatch/fl/context/c++.png)";break;default:c="url(img/dispatch/fl/context/ftpU.png)"}return b&&(d="/90%"),{background:c+"no-repeat center"+d}},a.operateBgColor=function(a,b){var c="";switch(b){case 1:c="#1295da";break;case 2:c="#9cb85f";break;case 3:c="#999";break;case 4:c="#ed6f67";break;default:c="#fff"}return 1===a?{"background-color":c}:{color:c}},a.singleNodeBorder=function(a){var b={cursor:"default",border:"1px solid transparent"};return(4==a.run_state||7==a.run_state)&&(b.cursor="pointer"),a.show_popover&&(b.border="1px solid #4A90E2"),b},a.viewNodeErrMsg=function(b,c){var d=a.single_work.operate_list[b];if(d.source_list){var e=d.source_list[c];e.show_popover=!e.show_popover;var f=$(".popover-modal-"+b+"-"+c);if(e.show_popover){for(var g=0;g<a.single_work.operate_list.length;g++){var h=a.single_work.operate_list[g];h.source_list=h.source_list?h.source_list:[];var i=h.source_list.length;if(0!==i)for(var j=0;i>j;j++){var k=h.source_list[j];b===g&&c===j?console.log(111):(k.show_popover=!1,$(".popover-modal-"+g+"-"+j).css({display:"none"}))}}f.fadeIn(),K(e,d)}else f.fadeOut(),L()}},a.popoverPosition=function(a,b,c){if(a.show_popover){var d=$(".popover-modal-"+b+"-"+c);(c+1-3)%4===0&&d.css({left:"auto",right:0}),(c+1-2)%4===0&&d.css({width:"340px"})}},a.stopPropagation=function(a){a.stopPropagation()},a.hidePopover=function(a,b,c){e(function(){a.show_popover=!1,L(),$(".popover-modal-"+b+"-"+c).fadeOut()},800)},a.changeScript=function(){a.controls.codemirror_refresh=!1,e(function(){a.controls.codemirror_refresh=!0},100)},a.getPluginTypeCnName=function(a){return s.findValue(a,p)},a.downloadAccessoryFile=function(){s.downloadFile(a.single_work.annex_file)},a.formSubmit=function(c){if(4==b.dispatch_task_status||5==b.dispatch_task_status)return r.alert("任务已处理完成"),!1;if(b.dispatch_task_status>=0&&b.dispatch_task_status<=2||6==b.dispatch_task_status)return r.alert("任务处理中，请稍侯..."),!1;var d={meddle_type:c,job_index:v,job_id:a.single_work.job_id};1==c?r.confirm("确认重试 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){F(d)}):2==c?r.confirm("确认重做 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){F(d)}):3==c?r.confirm("确认跳过 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){F(d)}):4==c?r.confirm("确认重试作业链 ?").then(function(){F(d)}):r.confirm("确认完成 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){r.completeJob(x,[a.single_work.job_id]).then(function(a){a&&(d.meddle_reason=a,F(d))})})},a.formCancel=function(){u&&d.cancel(u),t&&d.cancel(t),c.close()},M()}]),modal_m.controller("addSkipWorkParamsCtrl",["$scope","$modalInstance","$timeout","modalParam","AutoFlowOpType","IML_TYPE","CmptType","CmptFunc","Cmpt","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.form={},a.job_output_list=d.output_param?d.output_param:[],a.paramShellLoaded=function(a){j.setParamsEditor(a)},a.formSubmit=function(){return l.valiForm(a.form.job_param_form)?void b.close(a.job_output_list):!1},a.formCancel=function(){b.close()}}]),modal_m.controller("viewTaskProgressInfoCtrl",["$scope","$modalInstance","$timeout","$interval","DispatchTaskMonitor","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h){var i;a.query_type=0,a.data={task_thread_list:[],job_thread_list:[],task_queue_list:[],job_queue_list:[]};var j=function(b){e.runingInfo(b).then(function(d){c(function(){1===b?a.data.task_thread_list=d.task_thread_list?d.task_thread_list:[]:2===b?a.data.job_thread_list=d.job_thread_list?d.job_thread_list:[]:3===b?a.data.task_queue_list=d.task_queue_list?d.task_queue_list:[]:a.data.job_queue_list=d.job_queue_list?d.job_queue_list:[]},0)},function(a){})},k=function(){e.runingInfo(1).then(function(b){c(function(){a.data.task_thread_list=b.task_thread_list?b.task_thread_list:[]},0)},function(a){}),i=d(function(){j(a.query_type)},2e3)};a.selectType=function(b){a.query_type!==b&&(a.query_type=b,j(a.query_type))},a.meddleTask=function(a,b,c){g.confirm("确认回收任务线程 "+c+" ?").then(function(){e.meddleTask(a,b).then(function(a){},function(a){})})},a.meddleJob=function(a,b,c,d){g.confirm("确认回收作业线程 "+d+" ?").then(function(){e.meddleJob(a,b,[c]).then(function(a){},function(a){})})},a.formCancel=function(){i&&d.cancel(i),b.dismiss(!1)},k()}]),modal_m.controller("inputStartJobParamsCtrl",["$scope","$modalInstance","$timeout","modalParam","AutoFlowOpType","IML_TYPE","CmptType","CmptFunc","Cmpt","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.form={},a.input_param_list=d.input_param?d.input_param:[],a.paramShellLoaded=function(a){j.setParamsEditor(a)},a.formSubmit=function(){return l.valiForm(a.form.input_param_form)?void b.close(a.input_param_list):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("completeJobCtrl",["$scope","$modalInstance","$timeout","modalParam","Flow","Modal","CV",function(a,b,c,d,e,f,g){a.form={},a.reason={complete_reason:""},a.formSubmit=function(){return g.valiForm(a.form.reason_form)?void b.close(a.reason.complete_reason):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("configFlowTimeConditionCtrl",["$scope","$modalInstance","$timeout","modalParam","Flow","Modal","CV",function(a,b,c,d,e,f,g){var h=d.data?d.data:{},i=new Date,j=i.getHours()<10?"0"+i.getHours():i.getHours(),k=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes(),l=h.date_str?new Date(h.date_str)<i?i:new Date(h.date_str):i;a.form={},a.datepicker={opened:!0},a.cus_date={minDate:new Date,date:l,hh:h.h_condition?h.h_condition:j,mm:h.m_condition?h.m_condition:k},a.formSubmit=function(){return g.valiForm(a.form.setTime)?a.cus_date.hh>23?(f.alert("小时输入有误，请重新输入"),!1):a.cus_date.mm>59?(f.alert("分钟输入有误，请重新输入"),!1):(a.cus_date.hh=a.cus_date.hh.length<2?"0"+a.cus_date.hh:a.cus_date.hh,a.cus_date.mm=a.cus_date.hh.length<2?"0"+a.cus_date.mm:a.cus_date.mm,void b.close(a.cus_date)):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("configFlowJobMethodCtrl",["$scope","$modalInstance","$timeout","Cmpt","Plugin","IML_TYPE","CmptType","modalParam","CodeMirrorOption","BusiSys","dataBaseType","CmptFunc","envManage","LanguageName","pluginExeEnv","pluginType","operateSysBit","RequestMethod","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u,v=[],w=h.job_data.job_method?h.job_data.job_method:1;w=h.job_type>23&&h.job_type<28?2:w,console.log(w,"job_method"),console.log(h.job_type,"job_type");var x=h.job_data.comp_id?h.job_data.comp_id:"",y=h.job_data.annex_file?h.job_data.annex_file.substring(h.job_data.annex_file.lastIndexOf("/")+1):"",z=y?l.judgeFileType(y.substring(y.lastIndexOf(".")+1)):"",A=1;a.is_detail=!!h.is_detail,a.is_special_element=!!h.is_special_element,console.log("查看：",a.is_detail,"特殊：",a.is_special_element),a.form={},a.form_control={job_method:w,is_service:!1,is_database:!1,refresh_script:!0},a.cmpt_control={},a.accessory_fileupload={suffixs:"",filetype:z,filename:y,uploadpath:""},a.cmpt_info={cmpt_list:[],cmpt_list_loading:!1,script_loading:!1,script_list:[],get_script_err:"",checked:-1},a.job_type=h.job_type,a.basic_data={plugin_list:[],plugin_hint_list:[],env_list:[],sys_list:[],iml_type_list:f,sql_type_list:[],dataBase_type_list:k,request_method_list:r},a.sava_data={},a.cmpt_data={},a.viewOptions=i.Sh(!0),a.paramShellLoaded=function(a){i.setParamsEditor(a)};var B=function(a){a=a||{};var b={comp_id:a.comp_id?a.comp_id:"",comp_cn_name:a.comp_cn_name?a.comp_cn_name:"",impl_type:a.comp_impl_type?a.comp_impl_type:"",script_source:a.script_source?a.script_source:1,script_file_name:a.script_file_name?a.script_file_name:"",exec_script:a.exec_script?a.exec_script:"",param_list:a.input?a.input:[],output:a.output?a.output:[],dataBase_type:a.dataBase_type?a.dataBase_type:"",sql_source:a.sql_source?a.sql_source:1,service_name:a.service_name?a.service_name:"",service_ip:a.service_ip?a.service_ip:"",service_url:a.service_url?a.service_url:"",service_port:a.service_port?a.service_port:"",service_comm_info:a.service_comm_info?a.service_comm_info:{},env_name:a.env_name?a.env_name:"",language_name:a.language_name?a.language_name:"",language_version:a.language_version?a.language_version:"",operating_system:a.operating_system?a.operating_system:"",bit_number:a.bit_number?a.bit_number:"",annex_file:a.annex_file?a.annex_file:"",plugin_list:a.plugin_list?a.plugin_list:[],command:a.command?a.command:[],request_method:a.request_method?a.request_method:1};return a.command&&a.command.cmds&&(b.command.exec_script=l.cmdsToString(a.command.cmds)),b},C=function(b){a.job_type>=24&&a.job_type<=27&&(a.form_control.is_service=!0,2==a.form_control.job_method&&(b&&0!=h.job_data.input.length?(a.sava_data.param_list=h.job_data.input,a.sava_data.output=h.job_data.output):(a.sava_data.param_list=[{param_name:"request",param_cn_name:"",param_source:1,param_value:""}],a.sava_data.output=[{param_name:"response",param_cn_name:""}]))),(14==a.job_type||15==a.job_type)&&(a.form_control.is_database=!0,1==a.form_control.job_method?a.cmpt_data.output=[{param_name:"sqlresult",param_cn_name:"sql输出结果"}]:a.sava_data.output=[{param_name:"sqlresult",param_cn_name:"sql输出结果"}])},D=function(a){for(var b=a.length||0,c=0;b>c;c++){var d=a[c];"/*"==d.cn_name.substring(0,2)&&(d.cn_name=d.cn_name.substring(2,b-2)),d.execute_type_cn=t.findValue(d.impl_type,f),d.cmpt_type_cn=t.findValue(d.module_purpose,g)}},E=function(b){for(var c=-1,d=0;d<a.cmpt_info.cmpt_list.length;d++){var e=a.cmpt_info.cmpt_list[d];if(e.id===b){c=d;break}}return c},F=function(){m.getUploadPath().then(function(b){b&&(a.accessory_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(a){})},G=function(a){for(var b=[],c=0;c<a.length;c++)a[c].plugin_name&&b.push(a[c].plugin_name);return b},H=function(b){b&&e.getAllPluginList(b).then(function(b){b&&(a.basic_data.plugin_list=b.plugin_list?b.plugin_list:[])},function(a){})},I=function(){a.cmpt_info.cmpt_list_loading=!0,a.cmpt_info.error_message="",d.getPublishedCmpt(1,3).then(function(b){c(function(){b&&(a.cmpt_info.cmpt_list_loading=!1,a.cmpt_info.cmpt_list=b.comp_list?b.comp_list:[],D(a.cmpt_info.cmpt_list),a.cmpt_info.checked=E(a.cmpt_data.comp_id),a.cmpt_info.cmpt_list.length&&a.cmpt_info.checked>-1&&(a.selectCmptGetScript(a.cmpt_info.checked),c(function(){if(a.cmpt_info.checked>5){var b=document.querySelectorAll(".scrollTbody > tr");b[a.cmpt_info.checked].scrollIntoView()}},0)))},0)},function(b){a.cmpt_info.error_message=b.message})},J=function(b){A=6>b?1:6==b?4:7==b||8==b?2:14==b?3:1,(14==a.job_type||15==a.job_type)&&(A=4),a.viewOptions=4==A?i.Sql(!0):3==A?i.Java(!0):2==A?i.Python(!0):i.Sh(!0)},K=function(b){a.basic_data.env_list=[],(14==b.impl_type||7==b.impl_type||8==b.impl_type)&&(a.basic_data.env_list=["1.5","1.6","1.7","1.8"]),H(b.impl_type)},L=function(a,b){var c=b.split("-");a.language_name=t.findKey(c[0],n),a.language_version=c[1],a.operating_system=t.findKey(c[2],o),a.bit_number=t.findKey(c[3],q)},M=function(){1==w?(a.cmpt_data=B(h.job_data),a.is_special_element||a.is_detail||I(),a.is_detail||K(a.cmpt_data)):(a.sava_data=B(h.job_data),J(a.sava_data.impl_type),K(a.sava_data)),C(!0),!a.is_detail&&F()};a.shellLoaded=function(b){var d;i.setEditor(b,A),u=b,b.on("blur",function(){d=c(function(){var b=G(a.sava_data.plugin_list),c=l.getParamsByScript(a.sava_data.exec_script?a.sava_data.exec_script:"",b);if(v.length==c.list.length){if(a.sava_data.script_msg=c.msg,0==v.length)return a.sava_data.param_list=[],!1;for(var d=0;d<c.list.length;d++){for(var e=!1,f=0;f<v.length;f++)if(c.list[d].param_name==v[f].param_name&&c.list[d].param_group==v[f].param_group){
e=!0;break}e||(l.blurGetParams(c,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list))}}else l.blurGetParams(c,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list)},500)})},a.commandNoneShellLoaded=function(b){var d;i.setNoneParamsEditor(b,A,a.sava_data.plugin_list),b.on("blur",function(){d=c(function(){var b=G(a.sava_data.plugin_list);a.sava_data.command.cmds=a.sava_data.command.exec_script?a.sava_data.command.exec_script.split("\n"):[];var c=a.sava_data.command.exec_script+""+a.sava_data.exec_script,d=l.getParamsByScript(c?c:"",b);if(v.length==d.list.length){if(a.sava_data.script_msg=d.msg,0==v.length)return a.sava_data.param_list=[],!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<v.length;g++)if(d.list[e].param_name==v[g].param_name&&d.list[e].param_group==v[g].param_group){f=!0;break}f||(l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list))}}else l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list)},500)})},a.commandShellLoaded=function(b){var d;i.setUniqueParamsEditor(b,A,a.sava_data.plugin_list),b.on("blur",function(){d=c(function(){var b=G(a.sava_data.plugin_list);a.sava_data.command.cmds=a.sava_data.command.exec_script?a.sava_data.command.exec_script.split("\n"):[];var c=a.sava_data.command.exec_script+""+a.sava_data.exec_script,d=l.getParamsByScript(c?c:"",b);if(v.length==d.list.length){if(a.sava_data.script_msg=d.msg,0==v.length)return a.sava_data.param_list=[],!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<v.length;g++)if(d.list[e].param_name==v[g].param_name&&d.list[e].param_group==v[g].param_group){f=!0;break}f||(l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list))}}else l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list)},500)})},a.addInputParam=function(){a.sava_data.param_list.push({param_name:"",param_cn_name:"",param_source:1,param_value:""})},a.addOutputParam=function(b){return a.sava_data.output.some(function(a){return!a.param_name})?void s.alert("当前参数表输入不完整"):void a.sava_data.output.push({param_name:"",param_cn_name:""})},a.removeOutputParam=function(b,c){1===c?a.sava_data.param_list.splice(b,1):a.sava_data.output.splice(b,1)},a.changeJobType=function(b){a.form_control.job_method!=b&&(a.form_control.job_method=b,1===b?(a.cmpt_data=1==w?B(h.job_data):B(),I()):(a.sava_data=2==w?B(h.job_data):B(),J(a.sava_data.impl_type),K(a.sava_data)),C())},a.selectCmptGetScript=function(b){a.cmpt_info.checked=b,x=a.cmpt_info.cmpt_list[b].id||"",a.cmpt_info.script_loading=!0,a.cmpt_info.get_script_err="",d.viewModulegetModuleDetail(x).then(function(b){c(function(){if(b){a.cmpt_info.script_loading=!1,a.cmpt_info.script_list=b.component.script_list?b.component.script_list:[];for(var c=0;c<a.cmpt_info.script_list.length;c++)a.cmpt_info.script_list[c].exec_script=l.cmdsToString(a.cmpt_info.script_list[c].cmds),a.cmpt_info.script_list[c].script_type_cn="default"==a.cmpt_info.script_list[c].script_type?"缺省":a.cmpt_info.script_list[c].script_type;a.cmpt_data.comp_id=b.component.id,a.cmpt_data.comp_cn_name=b.component.cn_name,a.cmpt_data.exec_script=a.cmpt_info.script_list[0].exec_script,a.cmpt_data.script_source=b.component.component_source?b.component.component_source:1,a.cmpt_data.impl_type=b.component.impl_type?b.component.impl_type:"",a.cmpt_data.language_version=b.component.language_version?b.component.language_version:"",a.cmpt_data.output=b.component.out_param_list?b.component.out_param_list:[],a.cmpt_data.param_list=b.component.param_list?b.component.param_list:[],a.cmpt_data.plugin_list=b.component.plugin_list?b.component.plugin_list:[],a.cmpt_data.annex_file=b.component.annex_file?b.component.annex_file:"";for(var d=0;d<a.cmpt_data.param_list.length;d++)a.cmpt_data.param_list[d].param_source=1;C(),J(a.cmpt_data.impl_type),K(a.cmpt_data)}},0)},function(b){a.cmpt_info.script_loading=!1,a.cmpt_info.get_script_err=b.message})},a.selectEnvName=function(b){1==a.form_control.job_method?L(a.cmpt_data,b):L(a.sava_data,b)},a.selectScriptType=function(b){K(1==a.form_control.job_method?a.cmpt_data:a.sava_data),2==a.form_control.job_method&&(a.sava_data.plugin_list=[]),a.form_control.refresh_script=!1,c(function(){J(b),a.shellLoaded(u),a.form_control.refresh_script=!0},100)},a.getPluginTypeCnName=function(a){return t.findValue(a,p)},a.addAvailablePlugin=function(b){if(0!==b.plugin_list.length){if(b.plugin_list.some(function(a){return!a.plugin_name}))return s.alert("请选择插件名"),!1;if(b.plugin_list.length===a.basic_data.plugin_list.length)return s.alert("无可再添加的插件！"),!1}b.plugin_list.push({plugin_name:"",plugin_type:"",plugin_file_name:"",plugin_bk_desc:""})},a.deleteSinglePlugin=function(b,c){var d=c.plugin_list[b].plugin_name;d?s.confirm("确认是否要删除[ "+d+" ]插件?").then(function(){c.plugin_list.splice(b,1),a.basic_data.plugin_hint_list=l.translatePluginHint(c.plugin_list),u&&i.setEditor(u,A,a.basic_data.plugin_hint_list)}):(c.plugin_list.splice(b,1),a.basic_data.plugin_hint_list=l.translatePluginHint(c.plugin_list),u&&i.setEditor(u,A,a.basic_data.plugin_hint_list))},a.bindPluginInfo=function(b,c,d,e){for(var f=0,g=0;g<e.plugin_list.length;g++)b===e.plugin_list[g].plugin_name&&f++;if(f>1)return s.alert("插件已经添加！"),e.plugin_list.splice(c,1),!1;for(var h=0;h<a.basic_data.plugin_list.length;h++){var j=a.basic_data.plugin_list[h];if(b===j.plugin_name){d.plugin_type=j.plugin_type,d.plugin_file_name=j.plugin_file_name,d.plugin_bk_desc=j.plugin_bk_desc;break}}a.basic_data.plugin_hint_list=l.translatePluginHint(e.plugin_list),u&&i.setEditor(u,A,a.basic_data.plugin_hint_list)},a.ImportAccessorySuccessThen=function(b){b.annex_file=a.accessory_fileupload.uploadpath+"/"+a.accessory_fileupload.filename;var c=a.accessory_fileupload.filename.substring(a.accessory_fileupload.filename.lastIndexOf(".")+1);a.accessory_fileupload.filetype=l.judgeFileType(c)},a.removeAccessoryFile=function(b){a.accessory_fileupload.filename="",a.accessory_fileupload.filetype="",b.annex_file=""},a.downloadAccessoryFile=function(a){t.downloadFile(a.annex_file)},a.formSubmit=function(){if(1===a.form_control.job_method){if(-1===a.cmpt_info.checked&&!a.is_special_element)return s.alert("请选择组件"),!1;if(a.cmpt_info.get_script_err)return s.alert("组件信息获取异常,请重新选择组件"),!1;a.cmpt_data.input=a.cmpt_data.param_list||[],a.cmpt_data.job_method=a.form_control.job_method,b.close(a.cmpt_data)}else{if(!t.valiForm(a.form.job_form))return!1;a.sava_data.command&&a.sava_data.command.exec_script&&(a.sava_data.command.cmds=a.sava_data.command.exec_script?a.sava_data.command.exec_script.split("\n"):[]),a.sava_data.job_method=a.form_control.job_method,b.close(a.sava_data)}},a.formCancel=function(){b.dismiss(!1)},M()}]),modal_m.controller("configRefNodeCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","CodeMirrorOption","BusiSys","dataBaseType","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=g.source_list?g.source_list:[];a.ref_node_list=g.ref_node_list?g.ref_node_list:[];var o=function(){for(var b=0;b<a.ref_node_list.length;b++){var c=a.ref_node_list[b];c.checked=!1;for(var d=0;d<n.length;d++){var e=n[d];e.exe_ip===c.exe_ip&&e.exe_soc_name===c.exe_soc_name&&(c.checked=!0)}}};a.formSubmit=function(){for(var c=[],d=0;d<a.ref_node_list.length;d++){var e=a.ref_node_list[d];e.checked&&c.push({exe_ip:e.exe_ip,exe_soc_name:e.exe_soc_name})}b.close(c)},a.formCancel=function(){b.dismiss(!1)},o()}]),modal_m.controller("addSceneCtrl",["$scope","$modalInstance","$timeout","Scene","modalParam","ElementCategory","Modal","CV",function(a,b,c,d,e,f,g,h){a.form={},a.btn_loading=!1,a.scene_info={scene_list:[],checked_scene_list:e.scene_list?e.scene_list:[],scene_id_list:[]},a.control={scene_loading:!0,error_message:""};var i=function(a){return a?h.findValue(a,f):"--"},j=function(){var b=[];return angular.forEach(a.scene_info.scene_list,function(a,c,d){a.checked&&!a.is_ref&&b.push(a.scene_id)}),b};d.getSceneListByType({key_word:"",data:{offset:0}}).then(function(b){c(function(){a.control.scene_loading=!1,a.scene_info.scene_list=b.scene_list?b.scene_list.filter(function(a){return 3!==a.scene_type}):[];for(var c=0;c<a.scene_info.checked_scene_list.length;c++)for(var d=a.scene_info.checked_scene_list[c],e=0;e<a.scene_info.scene_list.length;e++){var f=a.scene_info.scene_list[e];d.scene_id===f.scene_id&&(f.checked=!0,f.is_ref=!0)}},0)},function(b){a.control.scene_loading=!1,a.control.error_message=b.message}),a.formSubmit=function(){return a.scene_info.scene_id_list=j(),0===a.scene_info.scene_id_list.length?(b.close(),!1):(a.btn_loading=!0,void d.getMultipleSceneElementDetail(a.scene_info.scene_id_list).then(function(d){c(function(){a.btn_loading=!1;var c=d.scene_list?d.scene_list:[];if(0===c.length)return g.alert("获取场景元素数据为空"),!1;for(var e=[],f=0;f<c.length;f++){var h=c[f];h.category_list=h.category_list?h.category_list:[];for(var j=0;j<h.category_list.length;j++){var k=h.category_list[j];k.element_list=k.element_list?k.element_list:[],k.category_cn=k.text?k.text:i(k.category);for(var l=0;l<k.element_list.length;l++){var m=k.element_list[l];m.category="7",m.sd_job_bean=m.element_info?m.element_info:{},m.sd_job_bean.is_special_element=!0,m.text=m.sd_job_bean.sdwork_cn_name?m.sd_job_bean.sdwork_cn_name:m.text}}e.push({scene_id:h.scene_id?h.scene_id:"",scene_name:h.scene_name?h.scene_name:"",category_list:h.category_list})}b.close(e)},0)},function(b){a.btn_loading=!1,g.alert(b.message,3)}))},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("addPrivateElementCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","ElementCategory","Scene","FlowCategoryData","CmptFunc","dataBaseType","JobErrorType","ParamValueSource","FlowJobType","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=j,t=g.element?angular.copy(g.element):{};a.btn_loading=!1,a.form={},a.single_element={category:"7",type:t.type,text:"",element_info:t.element_info},a.data={execute_type_list:e,database_type_list:l,error_handle_list:m,param_source_list:n},a.config={scroll_bar:p};var u=function(a){if(!a)return 0;for(var b,c=0;c<s.length;c++){for(var d=s[c],e=0;e<d.element_list.length;e++){var f=d.element_list[e];if(f.type===a){b={category:d.category,type_cn:f.text};break}}if(b)break}return b};a.elementIcon=function(){var a="",b="/50px";switch(t.type){case 1:a="url(img/dispatch/fl/palette/start.png)";break;case 2:a="url(img/dispatch/fl/palette/end.png)";break;case 4:a="url(img/dispatch/fl/context/condition.png)";break;case 5:a="url(img/dispatch/fl/context/stop.png)";break;case 6:a="url(img/dispatch/fl/context/rep.png)";break;case 7:a="url(img/dispatch/fl/context/ftpU.png)";break;case 8:a="url(img/dispatch/fl/context/ftpD.png)";break;case 9:a="url(img/dispatch/fl/context/sftpU.png)";break;case 10:a="url(img/dispatch/fl/context/sftpD.png)";break;case 11:a="url(img/dispatch/fl/context/zngtU.png)";break;case 12:a="url(img/dispatch/fl/context/zngtD.png)";break;case 13:a="url(img/dispatch/fl/context/copy.png)";break;case 14:a="url(img/dispatch/fl/context/sql.png)";break;case 15:a="url(img/dispatch/fl/context/sqlS.png)";break;case 16:a="url(img/dispatch/fl/context/web.png)";break;case 17:a="url(img/dispatch/fl/context/sysSt.png)";break;case 18:a="url(img/dispatch/fl/context/sysE.png)";break;case 19:a="url(img/dispatch/fl/context/python.png)";break;case 20:a="url(img/dispatch/fl/context/shell.png)";break;case 21:a="url(img/dispatch/fl/context/bat.png)";break;case 22:a="url(img/dispatch/fl/context/rb.png)";break;case 23:a="url(img/dispatch/fl/context/perl.png)";break;case 24:a="url(img/dispatch/fl/context/webs.png)";break;case 25:a="url(img/dispatch/fl/context/tcp.png)";break;case 26:a="url(img/dispatch/fl/context/http.png)";break;case 27:a="url(img/dispatch/fl/context/tux.png)";break;case 28:a="url(img/dispatch/fl/context/cl.png)";break;case 29:a="url(img/dispatch/fl/context/rpg.png)";break;case 30:a="url(img/dispatch/fl/context/java.png)";break;case 31:a="url(img/dispatch/fl/context/c.png)";break;case 32:a="url(img/dispatch/fl/context/c++.png)";break;default:a="url(img/dispatch/fl/context/ftpU.png)"}return{background:a+"no-repeat center"+b}},a.eleTypeTOCn=function(){return t.type?r.findValue(t.type,o):"--"},a.selectErrorHandle=function(b){3===b&&(a.single_element.element_info.retry_times=3,a.single_element.element_info.retry_interval=4)},a.setJobMethod=function(){q.setFlowJobMethod(a.single_element.type,a.single_element.element_info).then(function(b){if(a.single_element.element_info.job_method=b.job_method,1==b.job_method)a.single_element.element_info.comp_id=b.comp_id,a.single_element.element_info.comp_impl_type=b.impl_type,a.single_element.element_info.comp_cn_name=b.comp_cn_name,a.single_element.element_info.input=b.input||[],a.single_element.element_info.output=b.output||[],a.single_element.element_info.exec_script=b.exec_script,a.single_element.element_info.script_source=b.script_source;else{a.single_element.element_info.comp_id="",a.single_element.element_info.comp_impl_type=b.impl_type,a.single_element.element_info.output=b.output?b.output:[],a.single_element.element_info.input=b.param_list,a.single_element.element_info.exec_script=b.exec_script,a.single_element.element_info.business_sys_name=b.business_sys_name,a.single_element.element_info.script_source=b.script_source,a.single_element.element_info.sql_source=b.sql_source,a.single_element.element_info.script_file_name=b.script_file_name,a.single_element.element_info.dataBase_type=b.dataBase_type,a.single_element.element_info.service_name=b.service_name;for(var c=0;c<a.single_element.element_info.input.length;c++)a.single_element.element_info.input[c].param_source=1}})},a.formSubmit=function(){return r.valiForm(a.form.private_ele_form)?a.single_element.element_info.job_method?1!==a.single_element.element_info.job_method||a.single_element.element_info.comp_cn_name?(a.btn_loading=!0,a.single_element.text=a.single_element.element_info.sdwork_cn_name||u(t.type).type_cn,void i.addPrivateScene(a.single_element).then(function(c){a.single_element.sd_job_bean=a.single_element.element_info,a.single_element.sd_job_bean.is_special_element=!0,a.btn_loading=!1,b.close(a.single_element)},function(b){a.btn_loading=!1,q.alert(b.message,3)})):(q.alert("请重配内容类型"),!1):(q.alert("请设置内容类型"),!1):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("addSceneElementCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","ElementCategory","Scene","FlowCategoryData","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j;a.is_update=g.is_update?g.is_update:!1,a.btn_loading=!1,a.form={},a.element_info={category:"",element_list:[]},a.data={element_category_list:h,element_data:n,category_ele:[]},a.elementIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette/rep.png)";break;case 7:b="url(img/dispatch/fl/palette/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette/copy.png)";break;case 14:b="url(img/dispatch/fl/palette/sql.png)";break;case 15:b="url(img/dispatch/fl/palette/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette/net.png)";break;case 17:b="url(img/dispatch/fl/palette/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette/python.png)";break;case 20:b="url(img/dispatch/fl/palette/shell.png)";break;case 21:b="url(img/dispatch/fl/palette/bat.png)";break;case 22:b="url(img/dispatch/fl/palette/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette/perl.png)";break;case 24:b="url(img/dispatch/fl/palette/web.png)";break;case 25:b="url(img/dispatch/fl/palette/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette/http.png)";break;case 27:b="url(img/dispatch/fl/palette/tux.png)";break;case 28:b="url(img/dispatch/fl/palette/cl.png)";break;case 29:b="url(img/dispatch/fl/palette/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette/java.png)";break;case 31:b="url(img/dispatch/fl/palette/c.png)";break;case 32:b="url(img/dispatch/fl/palette/c++.png)";break;default:b="url(img/dispatch/fl/palette/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.selectCategory=function(b){a.data.category_ele=[],a.element_info.category=b,a.data.element_data=angular.copy(n),a.data.category_ele=a.data.element_data.filter(function(a){return a.category===b})},a.selectElement=function(b,c){b.checked=!b.checked;for(var d=0;d<a.data.category_ele.length;d++){var e=a.data.category_ele[d];if(e.category===c)for(var f=0;f<e.element_list.length;f++){var g=e.element_list[f];g.type===b.type&&(g.checked=b.checked)}}},a.formSubmit=function(){if(!m.valiForm(a.form.element_form))return!1;if(!a.data.category_ele.length)return l.alert("元素不可为空"),!1;a.element_info.element_list=[];for(var c=0;c<a.data.category_ele[0].element_list.length;c++){var d=a.data.category_ele[0].element_list[c];d.checked&&a.element_info.element_list.push(d)}return 0===a.element_info.element_list.length?(l.alert("请选择元素"),!1):void b.close(a.element_info)},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("newStrategyGroupCtrl",["$scope","$modalInstance","$timeout","Cmpt","StrategyPriority","StrategyGroupType","modalParam","CodeMirrorOption","Strategy","dataBaseType","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.btn_loading=!1,a.form={},a.strategy_info={sdstrategy_id:"",sdstrategy_name:"",sdstrategy_desc:"",sdstrategy_concurrent:2,sdstrategy_type:1},a.data={strategy_type_list:f},a.formSubmit=function(){return m.valiForm(a.form.strategy_form)?(a.btn_loading=!0,void i.addStrategyGroup(a.strategy_info,a.is_update).then(function(d){c(function(){d&&(a.btn_loading=!1,b.close(!0))},0)},function(b){a.btn_loading=!1,l.alert(b.message,3)})):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("RepeatFlowCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Modal","CV",function(a,b,c,d,e,f,g){a.flow_id=d.flow_id,a.form={},a.flow_info={flow_cn_name:""},a.formSubmit=function(){return g.valiForm(a.form.flow)?void b.close():!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("FlowPubReasonCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Modal","CV",function(a,b,c,d,e,f,g){a.data={pub_reason:""},a.formSubmit=function(){b.close(a.data.pub_reason)},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("ywtaskChooseNodeCtrl",["$scope","$modalInstance","$timeout","modalParam","Flow","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h){a.node_info={node_ip:"",selected_node:d.node_list?d.node_list:[]},a.node_control={loading:!1},a.data={node_list:[]},a.config={scroll_bar:f};var i=function(){a.node_control.loading=!0,e.getAllNodesInfo().then(function(b){c(function(){if(b){for(var c=b.nodes_list?b.nodes_list:[],d=0,e=c.length;e>d;d++){var f=c[d];f.state=!1;for(var g=0;g<a.node_info.selected_node.length;g++){var h=a.node_info.selected_node[g];f.node_ip==h.node_ip&&(f.state=!0)}}a.data.node_list=c,a.node_control.loading=!1}},1e3)},function(b){a.node_control.loading=!1,g.alert(b.message,3)})};a.clearSearchInfo=function(){a.node_info.node_ip=""},a.selectNode=function(a){a.state=!a.state},a.saveNodeList=function(){for(var c=[],d=0;d<a.data.node_list.length;d++){var e=a.data.node_list[d];e.state&&c.push({node_ip:e.node_ip,node_detail:e.node_detail?e.node_detail:"暂无",state:!1})}b.close(c)},a.cancel=function(){b.dismiss(!1)},i()}]),modal_m.controller("configFlowTimeCtrl",["$scope","$modalInstance","modalParam","Flow","Modal","CV",function(a,b,c,d,e,f){a.dateObj={cycles:c.data.cycle_info.cycles?c.data.cycle_info.cycles:[],time_unit:c.data.cycle_info.time_unit?c.data.cycle_info.time_unit:0,period_list_str:c.data.period_list_str?c.data.period_list_str:[],start_bk_datetime:c.data.start_bk_datetime_val?c.data.start_bk_datetime_val:f.dtFormat(new Date),end_bk_datetime:c.data.end_bk_datetime_val?c.data.end_bk_datetime_val:"",cycle_type:c.data.cycle_info.cycle_type?c.data.cycle_info.cycle_type:1,flag:""==c.data.start_bk_datetime_val?1:0,view_flag:c.data.view_flag?c.data.view_flag:1,minDate:new Date,errorM:""},a.datepicker={},a.cus_date={date:"",minDate:new Date},a.control={startTimeFlag:!1,viewtime_error:""};var g=function(){3==a.dateObj.cycle_type&&0==a.dateObj.cycles.length&&(a.dateObj.cycles[0]=c.data.cycle_info.loop_time);for(var b=0;b<a.dateObj.cycles.length;b++)a.dateObj.cycles[b].dd=parseInt(a.dateObj.cycles[b].dd),a.dateObj.cycles[b].hh=parseInt(a.dateObj.cycles[b].hh),a.dateObj.cycles[b].mm=parseInt(a.dateObj.cycles[b].mm),a.dateObj.cycles[b].mi=parseInt(a.dateObj.cycles[b].mi),a.dateObj.cycles[b].ww=parseInt(a.dateObj.cycles[b].ww);2==a.dateObj.view_flag&&a.getCirclePeriod()};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.datepicker.opened=!0},a.toggleMin=function(){a.cus_date.minDate=""!=a.dateObj.start_bk_datetime?new Date(a.dateObj.start_bk_datetime):new Date},a.$watch("cus_date.date",function(){if(1==a.dateObj.view_flag){if(""==a.dateObj.start_bk_datetime)return a.control.startTimeFlag=!0,!1;if(""!=a.cus_date.date&&a.cus_date.date){var b=a.cus_date.date.getFullYear()+"年"+(a.cus_date.date.getMonth()+1)+"月"+a.cus_date.date.getDate()+"日",c=f.dtFormat(a.cus_date.date);a.dateObj.cycles.push({ww:0,dd:0,mm:0,hh:0,mi:0,customize_times:"",date:c,date_str:b})}}},!0),a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1),a.dateObj.errorM&&$(".ss").remove(),3==a.dateObj.cycle_type&&(a.dateObj.period_list_str=[])},a.changeOpexeType=function(b){a.dateObj.cycle_type=b,a.dateObj.cycles=[],a.dateObj.period_list_str=[],a.dateObj.time_unit=0,a.dateObj.errorM&&$(".ss").remove()},a.addCirlTime=function(){if(!a.dateObj.errorM){var b=0,c=0;3==a.dateObj.cycle_type&&(b=1,c=1),a.dateObj.cycles.push({unit:a.dateObj.time_unit,ww:1,dd:1,mm:1,hh:b,mi:c})}},a.changeTimeUnitType=function(b){var c=0,d=0;a.dateObj.cycles=[],a.dateObj.time_unit=b,a.dateObj.period_list_str&&(a.dateObj.period_list_str=[]),$(".ss").text()&&$(".ss").remove(),3==a.dateObj.cycle_type&&(c=1,d=1),a.dateObj.cycles.push({unit:a.dateObj.time_unit,ww:1,dd:1,mm:1,hh:c,mi:d})},a.getCirclePeriod=function(){if(a.dateObj.period_list_str=[],1!=a.dateObj.cycle_type&&!a.dateObj.errorM){if(0==a.dateObj.cycles.length&&2!=a.dateObj.view_flag)return 2==a.dateObj.cycle_type?(e.alert("周期列表不可为空"),!1):(e.alert("循环列表不可为空"),!1);var b={start_bk_datetime:f.dtFormat(a.dateObj.start_bk_datetime),end_bk_datetime:f.dtFormat(a.dateObj.end_bk_datetime),cycle_info:{cycleTimeBeen:3==a.dateObj.cycle_type?[]:a.dateObj.cycles,cycle_type:a.dateObj.cycle_type,loop_time:3==a.dateObj.cycle_type?a.dateObj.cycles[0]:{}}};d.caculatorExeTime(b).then(function(b){a.dateObj.period_list_str=b.next_time_list?b.next_time_list:[],1==a.dateObj.view_flag&&0==a.dateObj.period_list_str.length&&e.alert("暂无下次执行时间")},function(b){2==a.dateObj.view_flag?a.control.viewtime_error=b.message:e.alert(b.message,3)})}},a.$watch("dateObj",function(){a.dateObj.start_bk_datetime?(a.toggleMin(),a.control.startTimeFlag=!1):a.control.startTimeFlag=!0},!0),a.ok=function(){if(!a.control.startTimeFlag&&!a.dateObj.errorM){if(0==a.dateObj.cycles.length){var c=1==a.dateObj.cycle_type?"自定义时间":2==a.dateObj.cycle_type?"周期":"循环";return e.alert(c+"列表不可为空"),!1}return a.dateObj.start_bk_datetime&&a.dateObj.end_bk_datetime&&a.dateObj.start_bk_datetime>a.dateObj.end_bk_datetime?(e.alert("开始时间不可大于结束时间！"),!1):void b.close(a.dateObj)}},a.close=function(){b.dismiss(!1)},g()}]),modal_m.controller("JsonListCtrl",["$scope","$modalInstance","$state","Workorder","modalParam","Modal","CV",function(a,b,c,d,e,f,g){var h=e.task_seq;a.interface_info=e.data,a.control={aprov_type:e.aprov_type},console.log(a.interface_info);var i=function(){3==a.control.aprov_type&&(a.control.url=e.url,"execute_program_step"==a.control.url&&d.getApprovalExecuteProgramStep(h).then(function(a){console.log(a)},function(a){f.alert(a.message,3)}))};a.downloadAccessoryFile=function(a){g.downloadFile(a)},a.close=function(){b.close(!0)},i()}]),modal_m.controller("configDataSourceCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal","NodeReform","BusiSys","Collection","OperateSys","BsysFunc","Cmpt","ScriptExec","ProtocolType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=d.business_sys_name;a.normal_ip_list=[],a.extra_ip_list=[],a.source_list=[];var p=d.srv_soc;a.reqData={imply_type:d.dataSource_type,tow_soc_loading:!1,business_sys_name:o,two_soc:!1,check_ip:"",search_ver_key:"",protocol_type:"",script_ip_list:[],normal_ip_list:[],extra_ip_list:[],ip_data_list:[],mid_ip_list:[],search_key_work:"",search_key:"",old_srv_soc:[],srv_soc:[],sc_search_key:"",flag:d.flag,script_kind:"",script_type:d.business_sys_name,ip_data_loading:!1},a.control={no_select_node:!1},a.selectOne=function(){c(function(){a.scLocationIp()},10)},a.scroll_config_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:500,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},a.scroll_config_out_info={axis:"y",theme:"custom-dark",scrollbarPosition:"outside",scrollInertia:500,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}};var q=function(){if(1==a.reqData.flag){f.getIpByNone().then(function(b){a.reqData.ip_data_list=b.ip_list?b.ip_list:[];for(var c=0;c<a.reqData.ip_data_list.length;c++)a.reqData.ip_data_list[c]=a.reqData.ip_data_list[c].trim()},function(a){});for(var b=0;b<p.length;b++){a.reqData.normal_ip_list.push({soc_ip:p[b].soc_ip,is_show:!0,soc_name:p[b].soc_name,soc_name_list:[],ftp_soc_name_list:[],is_loading:!1,is_ftp_loading:!1,is_exsit_ftp:!1});for(var c=0;c<p[b].soc_name_list.length;c++)p[b].soc_name_list[c].soc_name==p[b].soc_name?a.reqData.normal_ip_list[b].soc_name_list.push({state:!0,soc_name:p[b].soc_name_list[c].soc_name,protocol_type:p[b].soc_name_list[c].protocol_type}):a.reqData.normal_ip_list[b].soc_name_list.push({state:!1,soc_name:p[b].soc_name_list[c].soc_name,protocol_type:p[b].soc_name_list[c].protocol_type});if(p[b].ftp_soc_name_list&&0!=p[b].ftp_soc_name_list.length){a.reqData.normal_ip_list[b].is_exsit_ftp=!0;for(var d=0;d<p[b].ftp_soc_name_list.length;d++)p[b].ftp_soc_name_list[d].soc_name==p[b].ftp_soc_name?a.reqData.normal_ip_list[b].ftp_soc_name_list.push({state:!0,soc_name:p[b].ftp_soc_name_list[d].soc_name,protocol_type:p[b].ftp_soc_name_list[d].protocol_type}):a.reqData.normal_ip_list[b].ftp_soc_name_list.push({state:!1,soc_name:p[b].ftp_soc_name_list[d].soc_name,protocol_type:p[b].ftp_soc_name_list[d].protocol_type})}}}else(a.reqData.imply_type>2&&a.reqData.imply_type<6||14==a.reqData.imply_type||15==a.reqData.imply_type||17==a.reqData.imply_type)&&(a.reqData.two_soc=!0),""==o?f.getIpByNone().then(function(b){for(var c=b.ip_list?b.ip_list:[],d=0;d<c.length;d++)c[d]=c[d].trim();for(var d=0;d<c.length;d++){var e=c[d];a.reqData.ip_data_list.push(e)}if(a.reqData.two_soc){for(var d=0;d<p.length;d++){for(var f=0;f<p[d].ver_soc_list.length;f++)p[d].ver_soc_list[f].ver_soc_name=p[d].ver_soc_list[f].soc_name,p[d].ver_soc_name==p[d].ver_soc_list[f].soc_name?p[d].ver_soc_list[f].state=!0:p[d].ver_soc_list[f].state=!1;for(var f=0;f<p[d].exe_soc_list.length;f++)p[d].exe_soc_list[f].exe_soc_name=p[d].exe_soc_list[f].soc_name,p[d].exe_soc_name==p[d].exe_soc_list[f].soc_name?p[d].exe_soc_list[f].state=!0:p[d].exe_soc_list[f].state=!1}for(var d=0;d<p.length;d++){for(var g=[],f=0;f<a.reqData.ip_data_list.length;f++)a.reqData.ip_data_list[f]==p[d].ver_ip&&g.push({ver_ip:a.reqData.ip_data_list[f],is_check:!0,ver_soc_list:p[d].ver_soc_list});a.reqData.extra_ip_list.push({exe_ip:p[d].exe_ip,exe_soc_list:p[d].exe_soc_list,is_show:!1,delete_flag:!1,exe_soc_name:p[d].exe_soc_name,ver_ip_list:g,ver_ip:p[d].ver_ip})}}else for(var d=0;d<p.length;d++){a.reqData.normal_ip_list.push({exe_ip:p[d].exe_ip,is_show:!0,exe_soc_name:p[d].soc_name,exe_soc_list:[],ftp_soc_name_list:[],is_loading:!1,is_ftp_loading:!1,is_exsit_ftp:!1});for(var h=0;h<p[d].exe_soc_list.length;h++)p[d].exe_soc_list[h].soc_name==p[d].exe_soc_name?a.reqData.normal_ip_list[d].exe_soc_list.push({state:!0,exe_soc_name:p[d].exe_soc_list[h].soc_name,protocol_type:p[d].exe_soc_list[h].protocol_type}):a.reqData.normal_ip_list[d].exe_soc_list.push({state:!1,exe_soc_name:p[d].exe_soc_list[h].soc_name,protocol_type:p[d].exe_soc_list[h].protocol_type})}},function(a){e.alert(a.message,3)}):f.getIpWithProtocolAndSoc(o,a.reqData.imply_type).then(function(b){for(var c=b.node_list?b.node_list:[],d=0;d<c.length;d++){var e=c[d];a.reqData.ip_data_list.push(e.node_ip),a.reqData.two_soc||a.reqData.normal_ip_list.push({exe_ip:e.node_ip,exe_soc_list:[],is_show:!1,exe_soc_name:""})}for(var f=0;f<p.length;f++){if(!p[f].exe_soc_list){p[f].exe_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].exe_ip&&(p[f].exe_soc_list=c[g].exe_soc_list)}if(!p[f].ver_soc_list){p[f].ver_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].ver_ip&&(p[f].ver_soc_list=c[g].ver_soc_list)}}if(a.reqData.two_soc){for(var d=0;d<p.length;d++){for(var h=0;h<p[d].ver_soc_list.length;h++)p[d].ver_soc_list[h].ver_soc_name=p[d].ver_soc_list[h].soc_name,p[d].ver_soc_name==p[d].ver_soc_list[h].soc_name?p[d].ver_soc_list[h].state=!0:p[d].ver_soc_list[h].state=!1;for(var h=0;h<p[d].exe_soc_list.length;h++)p[d].exe_soc_list[h].exe_soc_name=p[d].exe_soc_list[h].soc_name,p[d].exe_soc_name==p[d].exe_soc_list[h].soc_name?p[d].exe_soc_list[h].state=!0:p[d].exe_soc_list[h].state=!1}for(var d=0;d<p.length;d++){for(var i=[],h=0;h<a.reqData.ip_data_list.length;h++)a.reqData.ip_data_list[h]==p[d].ver_ip?i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!0,ver_soc_list:p[d].ver_soc_list}):i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!1,ver_soc_list:[]});a.reqData.extra_ip_list.push({exe_ip:p[d].exe_ip,exe_soc_list:p[d].exe_soc_list,is_show:!1,delete_flag:!1,exe_soc_name:p[d].exe_soc_name,ver_ip_list:i,ver_ip:p[d].ver_ip})}}else for(var d=0;d<p.length;d++)for(var h=0;h<a.reqData.normal_ip_list.length;h++)if(p[d].exe_ip==a.reqData.normal_ip_list[h].exe_ip){a.reqData.normal_ip_list[h].is_show=!0,a.reqData.normal_ip_list[h].exe_soc_list=[],a.reqData.normal_ip_list[h].exe_soc_name=p[d].exe_soc_name;for(var j=0;j<p[d].exe_soc_list.length;j++)p[d].exe_soc_list[j].soc_name==p[d].exe_soc_name?a.reqData.normal_ip_list[h].exe_soc_list.push({state:!0,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type}):a.reqData.normal_ip_list[h].exe_soc_list.push({state:!1,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type})}a.reqData.ip_data_loading=!0},function(b){a.reqData.ip_data_loading=!0,e.alert(b.message,3)})};a.scLocationIp=function(){for(var b=!1,c=0;c<a.reqData.normal_ip_list.length;c++)a.reqData.normal_ip_list[c].soc_ip==a.reqData.sc_search_key&&(b=!0);if(b)a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].is_loading=!1,a.reqData.sc_search_key="";else{var d=angular.copy(a.reqData.sc_search_key);a.reqData.normal_ip_list.push({soc_ip:a.reqData.sc_search_key,is_show:!0,soc_name:"",soc_name_list:[],ftp_soc_name_list:[],is_loading:!0,is_ftp_loading:!1,is_exsit_ftp:!1}),l.getSocByNodeIp(a.reqData.sc_search_key,a.reqData.imply_type).then(function(b){for(var c=b.source_list?b.source_list:[],e=0;e<c.length;e++)c[e].state=!1;
for(var e=0;e<a.reqData.normal_ip_list.length;e++)d==a.reqData.normal_ip_list[e].soc_ip&&(a.reqData.normal_ip_list[e].is_loading=!1,a.reqData.normal_ip_list[e].soc_name_list=c)},function(a){e.alert(a.message,3)})}},a.clickScSource=function(b,c,d,e){for(var f=!1,g=0;g<a.reqData.normal_ip_list[e].soc_name_list.length;g++)a.reqData.normal_ip_list[e].soc_name_list[g].soc_name==b.soc_name?(a.reqData.normal_ip_list[e].soc_name_list[g].state=!a.reqData.normal_ip_list[e].soc_name_list[g].state,f=a.reqData.normal_ip_list[e].soc_name_list[g].state):a.reqData.normal_ip_list[e].soc_name_list[g].state=!1;c.is_exsit_ftp=!1,c.ftp_soc_name_list=[],f&&2==a.reqData.script_type&&(c.is_exsit_ftp=!0,c.is_ftp_loading=!0,l.getSocByNodeIp(c.soc_ip,1).then(function(a){for(var b=a.source_list?a.source_list:[],d=0;d<b.length;d++)b[d].state=!1;c.ftp_soc_name_list=b,c.is_ftp_loading=!1},function(a){c.is_ftp_loading=!1}))},a.clickScFtpSource=function(b,c,d,e){for(var f=0;f<a.reqData.normal_ip_list[e].ftp_soc_name_list.length;f++)a.reqData.normal_ip_list[e].ftp_soc_name_list[f].soc_name==b.soc_name?a.reqData.normal_ip_list[e].ftp_soc_name_list[f].state=!a.reqData.normal_ip_list[e].ftp_soc_name_list[f].state:a.reqData.normal_ip_list[e].ftp_soc_name_list[f].state=!1},a.locationIp=function(){if(a.reqData.mid_ip_list=[],""==a.reqData.search_key)for(var b=0;b<a.reqData.ip_data_list.length;b++)a.reqData.mid_ip_list.push(a.reqData.ip_data_list[b]);else for(var b=0;b<a.reqData.ip_data_list.length;b++){var c=a.reqData.ip_data_list[b].indexOf(a.reqData.search_key);-1!=c&&a.reqData.mid_ip_list.push(a.reqData.ip_data_list[b])}for(var b=0;b<a.reqData.mid_ip_list.length;b++){for(var d=a.reqData.mid_ip_list[b],c=!1,e=0;e<a.reqData.normal_ip_list.length;e++)d==a.reqData.normal_ip_list[e].exe_ip&&(c=!0);c||a.reqData.normal_ip_list.push({exe_ip:d,exe_soc_list:[],is_show:!1,exe_soc_name:""})}for(var b=a.reqData.normal_ip_list.length-1;b>=0;b--)if(!a.reqData.normal_ip_list[b].is_show){for(var c=!1,e=0;e<a.reqData.mid_ip_list.length;e++)a.reqData.mid_ip_list[e]==a.reqData.normal_ip_list[b].exe_ip&&(c=!0);c||a.reqData.normal_ip_list.splice(b,1)}},a.clearIp=function(){a.reqData.search_key=""},a.clearVerIp=function(){a.reqData.search_ver_key=""},a.locationVerword=function(){for(var b=0,c=0;c<a.reqData.extra_ip_list.length;c++)if(a.reqData.extra_ip_list[c].exe_ip==a.reqData.check_ip){b=c;break}if(a.reqData.mid_ip_list=[],""==a.reqData.search_ver_key)for(var c=0;c<a.reqData.ip_data_list.length;c++)a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c]);else for(var c=0;c<a.reqData.ip_data_list.length;c++){var d=a.reqData.ip_data_list[c].indexOf(a.reqData.search_ver_key);-1!=d&&a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c])}for(var c=0;c<a.reqData.mid_ip_list.length;c++){for(var e=a.reqData.mid_ip_list[c],d=!1,f=0;f<a.reqData.extra_ip_list[b].ver_ip_list.length;f++)e==a.reqData.extra_ip_list[b].ver_ip_list[f].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.push({ver_ip:e,ver_soc_list:[],is_check:!1})}for(var c=a.reqData.extra_ip_list[b].ver_ip_list.length-1;c>=0;c--)if(!a.reqData.extra_ip_list[b].ver_ip_list[c].is_check){for(var d=!1,f=0;f<a.reqData.mid_ip_list.length;f++)a.reqData.mid_ip_list[f]==a.reqData.extra_ip_list[b].ver_ip_list[c].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.splice(c,1)}},a.checkNodeIPNobusiness=function(){for(var b=!1,c=0;c<a.reqData.normal_ip_list.length;c++)a.reqData.normal_ip_list[c].exe_ip==a.reqData.search_key&&(b=!0);if(b)a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].is_loading=!1,a.reqData.search_key="";else{var d=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;a.reqData.normal_ip_list.push({exe_ip:a.reqData.search_key,is_show:!0,soc_name:"",exe_soc_list:[],ftp_soc_name_list:[],is_loading:!0,is_ftp_loading:!1,is_exsit_ftp:!1}),k.getAllSocList(a.reqData.search_key,d).then(function(b){for(var c=b.source_list?b.source_list:[],d=[],e=0;e<c.length;e++)c[e].state=!1,d.push({state:!1,exe_soc_name:c[e].soc_name,protocol_type:c[e].protocol_type});a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].is_loading=!1,a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].exe_soc_list=d},function(a){e.alert(a.message,3)})}},a.testCh=function(b){c(function(){if(0==a.reqData.normal_ip_list[b].exe_soc_list.length){a.reqData.normal_ip_list[b].is_loading=!0;var c=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;g.getSocListByIpAndBsys(o,a.reqData.normal_ip_list[b].exe_ip,c).then(function(c){for(var d=c.source_list?c.source_list:[],e=0;e<d.length;e++)new RegExp("agent").test(d[e])?(a.reqData.normal_ip_list[b].exe_soc_name=d[e],a.reqData.normal_ip_list[b].exe_soc_list.push({exe_soc_name:d[e].soc_name,state:!0,protocol_type:d[e].protocol_type})):a.reqData.normal_ip_list[b].exe_soc_list.push({exe_soc_name:d[e].soc_name,state:!1,protocol_type:d[e].protocol_type});a.reqData.normal_ip_list[b].is_loading=!1},function(c){a.reqData.normal_ip_list[b].is_loading=!1,e.alert(c.message,3)})}a.reqData.normal_ip_list[b].is_show||r(a.reqData.normal_ip_list[b])},10)},a.checkNodeIP=function(b){if(b.is_show=!b.is_show,0==b.exe_soc_list.length){b.is_loading=!0;var c=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;""==o?k.getAllSocList(b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,e.alert(a.message,3)}):g.getSocListByIpAndBsys(o,b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,e.alert(a.message,3)})}b.is_show||r(b)};var r=function(b){for(var c=0;c<a.reqData.normal_ip_list.length;c++)b.exe_ip==a.reqData.normal_ip_list[c].exe_ip&&(a.reqData.normal_ip_list[c].is_show=!1)};a.click_dataSource=function(b,c,d){b.state=!b.state;for(var e=0;e<a.reqData.normal_ip_list.length;e++)if(a.reqData.normal_ip_list[e].exe_ip==c)for(var f=0;f<a.reqData.normal_ip_list[e].exe_soc_list.length;f++)f!=d&&(a.reqData.normal_ip_list[e].exe_soc_list[f].state=!1)},a.selectTwo=function(){c(function(){a.addNodeIp(a.reqData.search_key_work)},10)},a.addNodeIp=function(b){if(""!=b){for(var c=!1,d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip==b&&(c=!0);if(!c){a.reqData.check_ip=b;for(var f=[],h="",i=[],d=0;d<a.reqData.ip_data_list.length;d++)i.push({ver_ip:a.reqData.ip_data_list[d],is_check:!1,ver_soc_list:[]});""==o?k.getAllSocList(b,2).then(function(c){for(var d=c.source_list?c.source_list:[],e=0;e<d.length;e++)new RegExp("agent").test(d[e])?(h.exe_soc_name=d[e],f.push({exe_soc_name:d[e].soc_name,state:!0,protocol_type:d[e].protocol_type})):f.push({exe_soc_name:d[e].soc_name,state:!1,protocol_type:d[e].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:[],ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:[],ver_ip:""}),e.alert(error.message,3)}):g.getSocListByIpAndBsys(o,b,2).then(function(c){for(var d=c.source_list?c.source_list:[],e=0;e<d.length;e++)new RegExp("agent").test(d[e])?(h.exe_soc_name=d[e],f.push({exe_soc_name:d[e].soc_name,state:!0,protocol_type:d[e].protocol_type})):f.push({exe_soc_name:d[e].soc_name,state:!1,protocol_type:d[e].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:i,ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:i,ver_ip:""}),e.alert(error.message,3)});for(var d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip!=b&&(a.reqData.extra_ip_list[d].is_show=!1)}}},a.clickNodeIP=function(b,c){if(a.reqData.check_ip==b.exe_ip)b.is_show=!1,a.reqData.check_ip="";else{a.reqData.check_ip=b.exe_ip;for(var d=0;d<a.reqData.extra_ip_list.length;d++)b.exe_ip!=a.reqData.extra_ip_list[d].exe_ip?a.reqData.extra_ip_list[d].is_show=!1:a.reqData.extra_ip_list[d].is_show=!0}},a.checkDeleteFlag=function(a,b){b.stopPropagation(),a.delete_flag=!a.delete_flag},a.clickExeDataSource=function(b,c,d){for(var e=0;e<a.reqData.extra_ip_list[d].exe_soc_list.length;e++)e!=c&&(a.reqData.extra_ip_list[d].exe_soc_list[e].state=!1);a.reqData.extra_ip_list[d].exe_soc_list[c].state=!a.reqData.extra_ip_list[d].exe_soc_list[c].state},a.clickVerNode=function(b,c,d){0==a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list.length&&(a.reqData.tow_soc_loading=!0,""==o?k.getAllSocList(b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,e.alert(b.message,3)}):g.getSocListByIpAndBsys(o,b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,e.alert(b.message,3)}));for(var f=0;f<a.reqData.extra_ip_list[d].ver_ip_list.length;f++)a.reqData.extra_ip_list[d].ver_ip_list[f].is_check=!1;a.reqData.extra_ip_list[d].ver_ip_list[c].is_check=!0},a.clickVerSource=function(b,c,d,e){for(var f=0;f<a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list.length;f++)f!=c&&(a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[f].state=!1);a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state=!a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state},a.formCancel=function(){b.dismiss(!1)},a.sourceType_color=[{s_type:1,color:"#88B8FE",bg:"#F5F9FE"},{s_type:5,color:"#7BADA4",bg:"#D2F6EE"},{s_type:9,color:"#FC973E",bg:"#FFF4ED"},{s_type:10,color:"#88B8FE",bg:"#EAF8FC"},{s_type:14,color:"#FC973E",bg:"#FFF4ED"}],a.getProtocolTypeCnName=function(a){return n.findValue(a,m)},a.find_dataSource_color=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].color},a.find_dataSource_bgcolor=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].bg},a.savebtn=function(){if(1==a.reqData.flag){for(var c=0;c<a.reqData.normal_ip_list.length;c++)if(a.reqData.normal_ip_list[c].is_show){var d={};d.soc_name_list=[],d.ftp_soc_name_list=[],d.soc_ip=a.reqData.normal_ip_list[c].soc_ip;for(var e=0;e<a.reqData.normal_ip_list[c].soc_name_list.length;e++)d.soc_name_list.push({soc_name:a.reqData.normal_ip_list[c].soc_name_list[e].soc_name,protocol_type:a.reqData.normal_ip_list[c].soc_name_list[e].protocol_type}),a.reqData.normal_ip_list[c].soc_name_list[e].state&&(d.soc_name=a.reqData.normal_ip_list[c].soc_name_list[e].soc_name,d.protocol_type=a.reqData.normal_ip_list[c].soc_name_list[e].protocol_type);if(0!=a.reqData.normal_ip_list[c].ftp_soc_name_list.length)for(var e=0;e<a.reqData.normal_ip_list[c].ftp_soc_name_list.length;e++)d.ftp_soc_name_list.push({soc_name:a.reqData.normal_ip_list[c].ftp_soc_name_list[e].soc_name,protocol_type:a.reqData.normal_ip_list[c].ftp_soc_name_list[e].protocol_type}),a.reqData.normal_ip_list[c].ftp_soc_name_list[e].state&&(d.ftp_soc_name=a.reqData.normal_ip_list[c].ftp_soc_name_list[e].soc_name,d.ftp_protocol_type=a.reqData.normal_ip_list[c].ftp_soc_name_list[e].protocol_type);(0!=a.reqData.normal_ip_list[c].ftp_soc_name_list.length&&d.ftp_soc_name&&d.soc_name||0==a.reqData.normal_ip_list[c].ftp_soc_name_list.length&&d.soc_name)&&a.reqData.srv_soc.push(d)}}else if(a.reqData.two_soc){for(var c=0;c<a.reqData.extra_ip_list.length;c++)if(!a.reqData.extra_ip_list[c].delete_flag){var f={};f.exe_ip=a.reqData.extra_ip_list[c].exe_ip,f.exe_soc_list=[],f.ver_soc_list=[];for(var e=0;e<a.reqData.extra_ip_list[c].exe_soc_list.length;e++)f.exe_soc_list.push({soc_name:a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.extra_ip_list[c].exe_soc_list[e].state&&(f.exe_soc_name=a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,f.exe_protocol_type=a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type);for(var g=0;g<a.reqData.extra_ip_list[c].ver_ip_list.length;g++)if(a.reqData.extra_ip_list[c].ver_ip_list[g].is_check){f.ver_ip=a.reqData.extra_ip_list[c].ver_ip_list[g].ver_ip;for(var h=0;h<a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list.length;h++)f.ver_soc_list.push({soc_name:a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].ver_soc_name,protocol_type:a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].protocol_type}),a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].state&&(f.ver_soc_name=a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].ver_soc_name,f.ver_protocol_type=a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].protocol_type);break}f.exe_soc_name&&f.ver_soc_name&&a.reqData.srv_soc.push(f)}}else for(var c=0;c<a.reqData.normal_ip_list.length;c++)if(a.reqData.normal_ip_list[c].is_show){var d={};d.exe_soc_list=[],d.exe_ip=a.reqData.normal_ip_list[c].exe_ip;for(var e=0;e<a.reqData.normal_ip_list[c].exe_soc_list.length;e++)d.exe_soc_list.push({soc_name:a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.normal_ip_list[c].exe_soc_list[e].state&&(d.exe_soc_name=a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,d.exe_protocol_type=a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type);d.exe_soc_name&&a.reqData.srv_soc.push(d)}b.close(a.reqData.srv_soc)},a.monitorSelect=function(){return a.control.no_select_node=!a.reqData.normal_ip_list.some(function(a){return a.is_show}),null},q()}]),modal_m.controller("nodeSocDetailCtrl",["$scope","$modalInstance","modalParam","ProtocolType","IML_TYPE","CV",function(a,b,c,d,e,f){a.phase=c.data,a.getProtocolTypeCnName=function(a){return f.findValue(a,d).substring(0,5).toLowerCase()},a.getImplTypeCnName=function(a){return a?9==a?"配置":10==a?"人工":f.findValue(a,e):void 0},a.cancel=function(){b.close(!0)},a.ok=function(){b.close(!0)}}]);var cvDirectives=angular.module("CvDirectives",[]);cvDirectives.directive("fileUpload",["baseUrl","$timeout","Modal","CV",function(a,b,c,d){return{restrict:"AE",templateUrl:"templates/directives/upload_file.html",replace:!0,require:"fileUpload",scope:{fileupload:"=fileupload",deletefile:"&deletefile",downfile:"&downfile",onSuccess:"&successthen"},controller:["$scope","FileUploader","baseUrl",function(a,b,c){a.uploader=new b({url:c+"fileupload?uploadPath="+a.fileupload.uploadpath,autoUpload:!0})}],link:function(e,f,g,h){var i,j=e.uploader,k=e.fileupload.suffixs?e.fileupload.suffixs.split(","):[];e.fileupload.candown=g.downfile?!0:!1,e.fileupload.candelete=g.deletefile?!0:!1,e.exsit_package=g["package"]?!0:!1,j.filters.push({name:"suffixFilter",fn:function(a){return 0==k.length?!0:-1==k.indexOf(a.name.split(".")[a.name.split(".").length-1].toLowerCase())?(c.alert("文件名后缀限定为["+k.toString().replace(","," 或 ")+"]格式！"),!1):!0}}),j.filters.push({name:"pathFilter",fn:function(a){return e.fileupload.uploadpath?!0:(c.alert(a.name+"("+Math.round(a.size/1e3)+"KB)上传地址未就绪！"),!1)}}),j.filters.push({name:"repeatFilter",fn:function(a){return g["package"]&&-1!=e.fileupload.filenames.indexOf(a.name)?(c.alert(a.name+"文件已存在！"),!1):!0}}),e.$watch("fileupload.uploadpath",function(b){j.url=a+"fileupload?uploadPath="+b}),j.onWhenAddingFileFailed=function(a,b,c){},j.onAfterAddingAll=function(){i=c.loading("文件上传中...")},j.onCompleteAll=function(){b(function(){i.close(),e.onSuccess()},1e3)},j.onSuccessItem=function(a,b,c,d){-1!=b.indexOf("true")&&(g["package"]?e.fileupload.filenames.push(a.file.name):e.fileupload.filename=a.file.name)},j.onErrorItem=function(a,b,d,f){i.close(),j.queue.length=0,e.fileupload.filename="",c.alert("文件上传失败: "+d)},e.deletefiles=function(a){if(g["package"]){var b=e.fileupload.filenames.indexOf(a);e.fileupload.filenames.splice(b,1)}else e.deletefile()},e.downfiles=function(a){if(g["package"]){var b=e.fileupload.uploadpath+"/"+a;d.downloadFile(b)}else e.downfile()}}}}]),cvDirectives.directive("excelImport",["baseUrl","Modal",function(a,b){return{restrict:"AE",templateUrl:"templates/directives/import_excel.html",replace:!0,scope:{fileupload:"=fileupload",onSuccess:"&successthen"},controller:["$scope","FileUploader","baseUrl",function(a,b,c){a.uploader=new b({url:c+"fileupload?uploadPath="+a.fileupload.uploadpath,autoUpload:!0})}],link:function(c,d,e,f){var g=c.uploader,h=c.fileupload.suffixs?c.fileupload.suffixs.split(","):[];g.filters.push({name:"suffixFilter",fn:function(a){return 0==h.length?!0:-1==h.indexOf(a.name.split(".")[1])?(b.alert("文件名后缀限定为["+h.toString().replace(","," 或 ")+"]格式！"),!1):!0}}),c.$watch("fileupload.uploadpath",function(b){g.url=a+"fileupload?uploadPath="+b}),g.onWhenAddingFileFailed=function(a,b,c){},g.onSuccessItem=function(a,d,e,f){-1!=d.indexOf("true")?(c.fileupload.filename=a.file.name,c.onSuccess()):b.alert(c.fileupload.filetype+"上传失败")},g.onErrorItem=function(a,d,e,f){g.queue.length=0,c.fileupload.filename="",b.alert("文件上传失败: "+e)}}}}]),cvDirectives.directive("importInstance",["baseUrl","Modal",function(a,b){return{restrict:"AE",templateUrl:"templates/directives/import_instance.html",replace:!0,scope:{fileupload:"=fileupload",onSuccess:"&successthen"},controller:["$scope","FileUploader","baseUrl",function(a,b,c){a.uploader=new b({url:c+"fileupload?uploadPath="+a.fileupload.uploadpath,autoUpload:!0})}],link:function(c,d,e,f){var g=c.uploader,h=c.fileupload.suffixs?c.fileupload.suffixs.split(","):[];g.filters.push({name:"suffixFilter",fn:function(a){return 0==h.length?!0:-1==h.indexOf(a.name.split(".")[1])?(b.alert("文件名后缀限定为["+h.toString().replace(","," 或 ")+"]格式！"),!1):!0}}),c.$watch("fileupload.uploadpath",function(b){g.url=a+"fileupload?uploadPath="+b}),g.onWhenAddingFileFailed=function(a,b,c){},g.onSuccessItem=function(a,d,e,f){-1!=d.indexOf("true")?(c.fileupload.filename=a.file.name,c.onSuccess()):b.alert(c.fileupload.filetype+"上传失败")},g.onErrorItem=function(a,d,e,f){g.queue.length=0,c.fileupload.filename="",b.alert("文件上传失败: "+e)}}}}]),cvDirectives.directive("ensureExist",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e,f=c.ensureExist;if(-1!=c.ensureExist.indexOf("|")){var g=c.ensureExist.split("|");e=g[1].trim(),f=g[0].trim()}var h=f.split("."),i=function(a,b,c){var d=!1;if(b){for(var e=0;e<c.length;e++)if(c[e][b]==a){d=!0;break}}else-1!=jQuery.inArray(a,c)&&(d=!0);return""==a?!0:d};"dynamic"==e?(b.on("blur",function(){a[f]().then(function(a){d.$setValidity("unexist",!0)},function(a){d.$setValidity("unexist",!1)})}),b.on("focus",function(){d.$setValidity("unexist",!0)})):a.$watch(function(){return-1!=f.indexOf(".")?a[h[0]][h[1]]:a[f]},function(b){0!=b.length&&a.$watch(c.ngModel,function(a){return angular.isUndefined(a)?!1:void d.$setValidity("unexist",i(a,e,b))})})}}}),cvDirectives.directive("ensureProjUnique",["$timeout","Proj","Modal",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(c,d,e,f){var g,h=3e3,i=function(b,c){g=a(function(){k(b,c)},h)},j=function(){g&&a.cancel(g)},k=function(a,c){a&&c&&b.uniqueProj(a,c).then(function(a){a.result?f.$setValidity("unique",!1):f.$setValidity("unique",!0)},function(a){})};c.$watch(function(){return c.info||c.quick_prod_info},function(a,b){(a.project_name&&a.business_sys_name&&a.project_name.length>0&&a.business_sys_name.length>0&&a.project_name!=b.project_name||a.business_sys_name!=b.business_sys_name)&&(j(),i(a.project_name,a.business_sys_name))},!0)}}}]),cvDirectives.directive("ensureUnique",["$timeout","Task","Modal",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(d,e,f,g){e.on("blur",function(){a(function(){var a=g.$modelValue,d="";if(angular.isUndefined(a)||""==a)return!1;if(-1!=f.ensureUnique.indexOf("|")){var e=f.ensureUnique.split("|")[0].trim();d=f.ensureUnique.split("|")[1].trim()}else var e=f.ensureUnique;d!=a&&b.ExecuteTask({data:a},e).then(function(a){a.result?g.$setValidity("unique",!1):g.$setValidity("unique",!0)},function(a){c.alert(a.message)})},0)}),e.on("focus",function(){g.$setValidity("unique",!0)})}}}]),cvDirectives.directive("ensureOnly",["Task","CV","$timeout","Modal",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(a,b,d,e){b.on("blur",function(){c(function(){var b=e.$modelValue;if(angular.isUndefined(b)||""==b)return!1;var c=d.ensureOnly.split("|")||[],f=c[0].trim(),g=c[1]?c[1].trim():"",h=a.$eval(f),i=0,j=0,k=e.$name.charAt(e.$name.length-1).replace(/[^0-9]+/g,"");k&&(i=1);for(var l=0;l<h.length;l++){var m=g?h[l][g]:h[l];m===b&&j++}j>i?e.$setValidity("only",!1):e.$setValidity("only",!0)},0)}),b.on("focus",function(){e.$setValidity("only",!0)})}}}]),cvDirectives.directive("validateMsg",["$compile",function(a){return{restrict:"E",link:function(b,c,d){var e=[{key:"required",error:"$error.required",text:"不能为空"},{key:"ng-minlength",error:"$error.minlength",text:"最小长度限制[?]个字符"},{key:"ng-maxlength",error:"$error.maxlength",text:"最大长度限制[?]个字符"},{key:"ng-pattern",error:"$error.pattern",text:"不符合命名规范"},{key:"ensure-unique",error:"$error.unique",text:"已经存在"},{key:"ensure-only",error:"$error.only",text:"已经存在"},{key:"ensure-exist",error:"$error.unexist",text:"不存在"},{key:"ensure-proj-unique",error:"$error.unique",text:"项目已经存在"}],f="",g=d.tagCnName,h=d.name,i=d.type?d.type:"text",j=d.model,k=c.parents("form").attr("name")+"."+h,l=function(a){var b='<div ng-if="'+k+".$dirty && "+k+'.$invalid" style="color: #e9416e; list-style: none; padding: 0px 0 0 0;">',c=k+"."+e[0].error;b+='<li ng-show="'+c+'">'+g+e[0].text+"</li>";for(var d=1;d<e.length;d++){var f=e[d];("undefined"!=typeof a.attr(f.key)||a.attr("type")==f.key)&&(b+='<li ng-show="'+k+"."+f.error+"&&!"+c+'">'+g+f.text.replace("?",a.attr(f.key))+"</li>")}return b+="</div>"};"checkbox"==i?(c.before(a('<input ng-repeat="i in [1]" type="text" name="'+h+'" ng-model="'+j+'.str" style="display: none;" required/>')(b)),f=l(c.before()),b.$watch(function(){return b.$eval(j)},function(a){a&&(a.str=a.join(","))},!0)):"radio"==i?(c.before(a('<input ng-repeat="i in [1]" type="text" name="'+h+'" ng-model="'+j+'" style="display: none;" required/>')(b)),f=l(c.before())):"select"==i?(c.before(a('<input ng-repeat="i in [1]" type="text" name="'+h+'" ng-model="'+j+'" style="display: none;" required/>')(b)),f=l(c.before())):f=l(c.parent().children().first()),f&&c.append(a(f)(b))}}}]),cvDirectives.directive("bsSelect",["$compile","$timeout",function(a,b){return{restrict:"E",scope:{items:"=",selectedItem:"=mySelect",doSelect:"&selectVal",isDisable:"=disable",loading:"="},templateUrl:"templates/directives/bs_select_template.html",link:function(a,c,d){var e=d.optionKey,f=!0;a.has_opacity=""===d.opacity||"true"===d.opacity?!0:!1,a.has_noborder=""===d.noBorder||"true"===d.noBorder?!0:!1,a.init_label=d.initLabel?d.initLabel:"请选择",a.realItems=[],a.has_opacity&&(c.on("mouseenter",".btn-group",function(){$(this).css("opacity",1)}),c.on("mouseleave",".btn-group",function(){$(this).css("opacity",.3)})),a.scroll_config_info={axis:"xy",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}},a.changeUlStyle=function(){return a.realItems.length>5?{height:"160px","min-width":"100%"}:{height:30*a.realItems.length+15+"px","min-width":"100%"}},a.widthStyle=function(){if(a.has_noborder)return{width:d.width?d.width+"px":""};var b=d.width?d.width:c.children().width();return b=!d.maxWidth||b<d.maxWidth?b:d.maxWidth,{width:b-26+"px"}},$(window).resize(function(){if(!d.width){var a=c.children().width()-52;c.find("Button").first().width(a)}}),a.opacityStyle=function(){return{opacity:a.has_opacity?"0.3":"1"}};var g=function(b){a.init_label=e&&-1!=b.indexOf("  [")?b.substring(0,b.indexOf("  [")):b},h=function(){if(a.realItems=[],e)for(var b=d.optionLabal.replace(" ","").split(","),c=0;c<a.items.length;c++){var f=a.items[c];a.realItems.push({key:f[e],value:f[b[0]]+(f[b[1]]?"  ["+f[b[1]]+"]":"")})}else if(a.items.length>=1&&angular.isString(a.items[0]))for(var c=0;c<a.items.length;c++)a.realItems.push({key:a.items[c],value:a.items[c]});else for(var c=0;c<a.items.length;c++)a.realItems.push(a.items[c]);d.emptyOption&&a.realItems.push({key:"",value:d.emptyOption})},i=function(){if(h(),d.emptyOption&&g(d.emptyOption),!d.emptyOption&&1==a.realItems.length&&f){var c=a.realItems[0];a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key,selectValue:c.value})},0),f=!1}if(a.realItems.length>1)for(var e=0;e<a.realItems.length;e++){var c=a.realItems[e];if(c.key===a.selectedItem){g(c.value);break}e==a.realItems.length-1&&c.key!=a.selectedItem&&(a.init_label="请选择")}};a.selectVal=function(c){f=!1,a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key,selectValue:c.value})},0)},a.$watch(function(){return a.selectedItem},function(a){return(void 0===a||""===a)&&g(d.emptyOption?d.emptyOption:"请选择"),f?void(a&&i()):!1}),a.$watch(function(){return a.items},function(a){a&&(f=!0,i())},!0)}}}]),cvDirectives.directive("fileBrowse",["$compile",function(a){return{restrict:"E",scope:{node:"=",changePath:"&",deleteFile:"&"},link:function(b,c,d){var e=""===d.check||"true"===d.check||"1"===d.check?1:"2"===d.check?2:!1,f="1"===d.radiocheck?1:2,g="1"===d.allowmodify?1:2,h=b.node.path_files;1==g?b.node.checked_files=b.node.checked_files?b.node.checked_files:[]:b.node.checked_files=[],b.node.deleted_files=[];var i=!1;b.path_flag=!1;var j="",k=b.node.init_path;k=k.length>1&&k.lastIndexOf("/")==k.length-1?k.slice(0,k.length-1):k;var l=k.lastIndexOf("/");k?-1==l?(b.node.paths=[k],b.path_flag=!0):1==k.length&&0==l?(b.node.paths=["/"],b.path_flag=!0):0==l?(j="/",b.node.paths=[k.slice(1)]):(j="/",b.node.paths=k.slice(1).split("/")):b.node.paths=[],b.node.full_path=k,b.node.is_dir=!0;var m=1,n=[],o=function(a){a.length>=100*m?(b.node.path_files_short=a.slice(0,100*m),b.node.show_more=!0,m+=1):(m=1,b.node.show_more=!1,b.node.path_files_short=a)};b.goMore=function(){o(0==n.length?b.node.path_files:n)},b.customConfig={axis:"y",theme:"custom-dark",scrollbarPosition:"outside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}};var p=["<div>",'<ol class="breadcrumb" style="margin-bottom: 0;background:#091118">','<input type="text" class="form-control" ng-model="node.search_key_word"  placeholder="文件名" ng-enter="searchByKeyword()"  style="background:#091016;width: 52px;padding:2px;position: absolute; right: 16px;top: 5px;height: 24px;">','<li class="active">文件路径：&nbsp;</li>','<li ><a ng-click="goback($index)" style="cursor: pointer;">/&nbsp;</a></li>','<li ng-if="!path_flag" ng-repeat="path in node.paths track by $index"><a ng-click="goback($index)" ng-bind="path" style="cursor: pointer;"></a><span ng-if="!$last" style="color: #ccc;padding: 0 0px;">/</span></li>','<li ng-if="path_flag && !$first" ng-repeat="path in node.paths track by $index"><a ng-click="goback($index)" ng-bind="path" style="cursor: pointer;"></a><span ng-if="!$last" style="color: #ccc;padding: 0 0px;">/</span></li>',"</ol>",'<ol ng-show="node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 20px;">','<i class="fa fa-spinner fa-spin" style="font-size: 30px; color: #44dcfd;"></i>',"</li>","</ol>",'<ol ng-show="node.paths.length == 0 && !node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 18px; color: #999;">','<span style="color: #FF9933;" ng-bind="node.err_msg"></span> ',"</li>","</ol>",'<ol class="file_list" style="max-height: 400px; padding-left: 0px;" ng-if="node.paths.length != 0 && !node.loading" custom-scroll custom-config="customConfig">','<li style="height: 24px; line-height: 24px; list-style: none;" ng-if="node.paths.length > 1">','<i class="" style="margin-right: 10px; color: #FFF;"></i><a style="cursor: pointer;" title="上一层" ng-click="goprev();">..</a>',"</li>",'<li ng-repeat="file in node.path_files_short" class="li-file" '+(i?'ng-style="liStyle(file);" ng-mouseover="file.hover = true;" ng-mouseout="file.hover = false;"':"")+">",1==e?'<input type="checkbox" i-check ng-model="file.checked" ng-change="checkFile(file);">':2==e?'<input type="checkbox" ng-if="!file.dir" i-check ng-model="file.checked" ng-change="checkFile(file);"><div ng-if="file.dir" style="display: inline-block;margin-left:18px;"></div>':1==f?'<input type="radio" i-check ng-if="!file.dir" ng-model="file.checked" name="radio_check" value="$index" ng-change="checkRadioFile(file);">':"",,'<div style="display: inline-block;">','<i ng-if="file.dir" class="fa fa-folder-open" style="margin-left: 10px; color: #EAC344; display: block; padding-bottom: 4px;"></i>','<i ng-if="!file.dir" class="fa fa-file-text-o" style="margin-left: 10px; color: #44dcfd; display: block; padding-bottom: 4px;"></i>','<a ng-if="file.edit_flag && file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofront(file);" ng-style="fileStyle(file.modified_flag, file.checked);" ng-bind="file.file"></a>','<a ng-if="file.edit_flag && !file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofile(file);" ng-style="fileStyle(file.modified_flag, file.checked);" ng-bind="file.file"></a>','<span ng-if="!file.edit_flag" style="color: #44dcfd;display: block; word-wrap: break-word;padding-left: 30px;margin-top: -25px;" ng-bind="file.file"></span>',"</div>",i?"<i class='fa li-file-trash' ng-class='trashClass(file);' ng-style='trashStyle(file);' ng-click='delete(file);'></i>":"","</li>",'<li ng-if="node.path_files_short.length != 0 && node.show_more" class="li-file ng-scope" ng-click="goMore()"><a style="cursor: pointer;">加载更多...</a></li>','<li ng-if="node.path_files_short.length == 0" style="list-style: none;text-align: center; color: #ccc;height: 140px;line-height: 140px;font-size: 16px;">暂无文件信息</li>',"</ol>","</div>"].join("");c.append(a(p)(b));var q=function(){b.path_flag?b.node.full_path=j+b.node.paths.join("/").slice(1):b.node.full_path=j+b.node.paths.join("/"),b.changePath()};b.liStyle=function(a){return a.hover?{background:"#EFEFEF"}:{background:"#FFF"}},b.fileStyle=function(a,b){var c={};return c.color=a?"#E3AC36":"#428bca",c.fontWeight=b?"bolder":"",c},b.trashStyle=function(a){return a.hover?{color:"#666"}:{color:"#FFF"}},b["delete"]=function(a){a.hover=!0,b.node.parent_path=j+b.node.paths.join("/"),b.node.full_path=j+b.node.paths.join("/")+"/"+a.file,b.node.is_dir=a.dir,b.deleteFile()},b.searchByKeyword=function(){if(n=[],b.node.search_key_word){for(var a=0;a<h.length;a++){var c=h[a].file;-1!=c.indexOf(b.node.search_key_word)&&n.push(h[a])}o(n)}else b.changePath()},b.checkFile=function(a){if(a.checked)b.node.checked_files.push({file:a.file,path:j+b.node.paths.join("/")});else{for(var c=-1,d=0;d<b.node.checked_files.length;d++){
var e=b.node.checked_files[d];e.file===a.file&&(c=d)}b.node.checked_files.splice(c,1)}},b.checkRadioFile=function(a){for(var c=0;c<b.node.path_files.length;c++){var d=b.node.path_files[c];a.file!=d.file&&(d.checked=!1)}b.node.checked_files=[],a.checked&&b.node.checked_files.push({file:a.file,path:j+b.node.paths.join("/")})},b.trashClass=function(a){return a.deleted?"fa-reply":"fa-trash-o"},b.goprev=function(){b.node.paths.length>1&&b.goback(b.node.paths.length-2)},b.goback=function(a){b.node.is_dir=!0,b.node.paths.splice(a+1),0==b.node.paths.length&&(b.node.paths=["/"],b.path_flag=!0),q()},b.gofront=function(a){b.node.is_dir=!0,b.node.paths.push(a.file),q()},b.gofile=function(a){b.node.full_path=j+b.node.paths.join("/")+"/"+a.file,b.node.full_path=b.node.full_path.replace(/\/*/,"/"),b.node.is_dir=!1,b.changePath()},b.$watch("node.path_files",function(){if(!b.node.path_files)return!1;for(var a=0;a<b.node.path_files.length;a++){for(var c=b.node.path_files[a],d=0;d<b.node.checked_files.length;d++)b.node.checked_files[d].file===c.file&&(c.checked=!0);for(var d=0;d<b.node.deleted_files.length;d++)b.node.deleted_files[d].file===c.file&&(c.deleted=!0)}}),b.$watch("node.path_files",function(){n=[],h=b.node.path_files,b.node.path_files&&o(b.node.path_files)}),b.changePath(),""==b.node.full_path&&b.goback(0)}}}]),cvDirectives.directive("iCheck",["$timeout","$parse",function(a,b){return{require:"ngModel",link:function(c,d,e,f){return a(function(){var a,g,h,i=$(d);return"radio"===i.attr("type")?a=b(e.ngValue)(c)?b(e.ngValue)(c):e.value:(g=e.ngTrueValue,h=e.ngFalseValue),c.$watch(e.ngModel,function(a){i.iCheck("update")}),i.iCheck({radioClass:"iradio_minimal-blue",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(d){return"checkbox"===i.attr("type")?c.$apply(function(){return g&&h?d.target.checked?(b(e.ngModel).assign(c,g),f.$setViewValue(g)):(b(e.ngModel).assign(c,h),f.$setViewValue(h)):f.$setViewValue(!b(e.ngModel)(c))}):"radio"===i.attr("type")&&d.target.checked?c.$apply(function(){return f.$setViewValue(a)}):void 0})})}}}]),cvDirectives.directive("programStepForm",["$timeout","$parse","$compile","CV",function(a,b,c,d){return{restrict:"E",templateUrl:"templates/modal/program_step_form.html",scope:{data:"=data",authFlag:"=flag",submitMethod:"&submitMethod",viewAuthDetail:"&viewAuth"},link:function(a,b,c){a.read_only=c.detail?!0:a.data.stepFormLock,a.show_btn=c.showbtn,a.param_obj_list=[],a.getCheckTestInfo=function(a,b){return{top:(1==a?25:31)+33*(Math.ceil(b/3)-1)+"px"}};for(var e=0,f=a.data.sql_list?a.data.sql_list.length:0;f>e;e++){var g=a.data.sql_list[e],h=g.sql_param_list?g.sql_param_list:[];a.param_obj_list.push({sql_index:e,param_list:h,sql_text:g.sql_text})}a.closePgTask=function(){a.submitMethod()},a.changeCheckbox=function(a,b){if(a.checked)b.col_type="string"==typeof a.key?1:2,b.sparam_scope_list_key.push(a.key),b.sparam_scope_list_val.push(a.value);else for(var c=0;c<b.sparam_scope_list_key.length;c++)b.sparam_scope_list_key[c]==a.key&&(b.sparam_scope_list_key.splice(c,1),b.sparam_scope_list_val.splice(c,1))};for(var i=0;i<a.param_obj_list.length;i++)for(var j=a.param_obj_list[i].param_list,e=0;e<j.length;e++){var k=j[e];if(k.tag_ng_model="",k.sparam_value=k.sparam_value?k.sparam_value:"",k.tag_cn_name=k.sparam_cn_name?k.sparam_cn_name:"",k.sparam_scope_list=[],1!=k.sparam_type&&5!=k.sparam_type&&(k.sparam_scope_list=angular.fromJson(k.sparam_scope)),3==k.sparam_type){var l=k.sparam_value.split(",");k.sparam_scope_list_key=[],k.sparam_scope_list_val=[];for(var m=0;m<k.sparam_scope_list.length;m++)for(var n=0;n<l.length;n++)l[n]==k.sparam_scope_list[m].key&&(k.sparam_scope_list[m].checked=!0,k.sparam_scope_list_key.push(k.sparam_scope_list[m].key),k.sparam_scope_list_val.push(k.sparam_scope_list[m].value))}else 4==k.sparam_type?(a.data.select_items=k.sparam_scope_list,k.tag_ng_model=d.findValue(k.sparam_value,k.sparam_scope_list)):2==k.sparam_type?k.tag_ng_model=k.sparam_value:1==k.sparam_type&&(k.tag_ng_model=k.sparam_value)}a.viewAuthPro=function(){a.viewAuthDetail()},a.noParamSubmit=function(){a.btnBusLoading=!0,a.submitMethod()},a.FormSubmit=function(){if(a.authFlag.btn_loading=!0,!d.valiForm(a.pgForm))return a.authFlag.btn_loading=!1,!1;for(var b=0;b<a.param_obj_list.length;b++)for(var c=a.param_obj_list[b].param_list,e=0;e<c.length;e++){var f=c[e];3==f.sparam_type?(f.sparam_value=f.sparam_scope_list_key.join(","),f.sparam_value_text=f.sparam_scope_list_val.join(",")):2==f.sparam_type||4==f.sparam_type?(f.sparam_value=f.tag_ng_model,f.sparam_value_text=d.findValue(f.sparam_value,f.sparam_scope_list)):5==f.sparam_type?(f.sparam_value=f.sparam_scope,f.sparam_value_text=f.sparam_scope):(f.sparam_value=f.tag_ng_model,f.sparam_value_text=f.tag_ng_model)}for(var e=0;e<a.param_obj_list.length;e++)a.data.sql_list[a.param_obj_list[e].sql_index].sql_param_list=a.param_obj_list[e].param_list;a.submitMethod(),a.$watch("data.stepFormLock",function(){a.read_only=a.data.stepFormLock}),a.$watch("authFlag.btn_loading",function(){},!0)},c.detail||a.$watch("data.stepFormLock",function(){a.read_only=a.data.stepFormLock})}}}]),cvDirectives.directive("schemeParamTab",["$timeout","$parse","$compile","CV","Modal",function($timeout,$parse,$compile,CV,Modal){return{restrict:"E",templateUrl:"templates/directives/param_auth_tb.html",replace:"true",link:function(scope,elem,attrs){scope.form={},scope.param_key_value_type=[{key:1,value:"整型"},{key:2,value:"字符串"}];for(var i=0;i<scope.sql.param_list.length;i++)if(scope.sql.param_list[i].auth_show=!1,scope.sql.param_list[i].param_show=!1,scope.sql.param_list[i].param_key_value_list=[],scope.sql.editable=0==scope.sql.editable?scope.sql.editable:!0,scope.sql.param_list[i].old_auth_bk_expl=scope.sql.param_list[i].auth_bk_expl,scope.sql.param_list[i].old_param_auth_list=scope.sql.param_list[i].param_auth_list,scope.sql.param_list[i].param_auth_list)if(0!=scope.sql.param_list[i].param_auth_list.length){scope.sql.param_list[i].success_flag=!0;for(var j=0;j<scope.sql.param_list[i].param_auth_list.length;j++)scope.sql.param_list[i].param_auth_list[j].auth_dprl_code&&scope.getSqlParamAuthRoleByDept(scope.sql.param_list[i].param_auth_list[j].auth_dept_id,j,i,scope.sql.param_list[i].param_auth_list[j])}else scope.sql.param_list[i].success_flag=!1;else scope.sql.param_list[i].success_flag=!1;scope.showParamType=function(index){scope.sql.param_list[index].param_show=!0,scope.sql.param_list[index].auth_show=!1;for(var i=0;i<scope.sql.param_list.length;i++)i!=index&&(scope.sql.param_list[i].param_show=!1);if(scope.sql.param_list[index].sparam_scope){scope.sql.param_list[index].param_key_value_list=eval(scope.sql.param_list[index].sparam_scope);var _key=scope.sql.param_list[index].param_key_value_list[0].key,_value=scope.sql.param_list[index].param_key_value_list[0].value;"number"==typeof _key&&_key%1===0?(scope.sql.param_list[index].param_key_type=1,scope.sql.param_list[index].old_param_key_type=1):(scope.sql.param_list[index].param_key_type=2,scope.sql.param_list[index].old_param_key_type=2),"number"==typeof _value&&_value%1===0?(scope.sql.param_list[index].param_value_type=1,scope.sql.param_list[index].old_param_value_type=1):(scope.sql.param_list[index].param_value_type=2,scope.sql.param_list[index].old_param_value_type=2)}},scope.changeKeyValue=function(a,b){if(b.old_param_key_type&&b.old_param_key_type!=b.param_key_type)for(var c=0;c<b.param_key_value_list.length;c++)b.param_key_value_list[c].key="";b.old_param_key_type=a},scope.changepParamValue=function(a,b){if(b.old_param_value_type&&b.old_param_value_type!=b.param_value_type)for(var c=0;c<b.param_key_value_list.length;c++)b.param_key_value_list[c].value="";b.old_param_value_type=a},scope.showAuth=function(a){scope.sql.param_list[a].auth_bk_expl=angular.copy(scope.sql.param_list[a].old_auth_bk_expl),scope.sql.param_list[a].param_auth_list=angular.copy(scope.sql.param_list[a].old_param_auth_list),scope.sql.param_list[a].auth_show=!scope.sql.param_list[a].auth_show,scope.sql.param_list[a].param_show=!1;for(var b=0;b<scope.sql.param_list.length;b++)b!=a&&(scope.sql.param_list[b].auth_show=!1)},scope.removeAuthList=function(a,b){scope.sql.param_list[b].param_auth_list.splice(a,1),0==scope.sql.param_list[b].param_auth_list.length&&(scope.sql.param_list[b].success_flag=!1)},scope.addAuthList=function(a){scope.noParamList=!1,scope.sql.param_list[a].param_auth_list||(scope.sql.param_list[a].param_auth_list=[]);var b=scope.sql.param_list[a].param_auth_list.length;if(0==b)scope.sql.param_list[a].param_auth_list.push({condition_seq:1,condition_text:"",auth_dprl_code:"",sparam_auth:"",sparam_auth_list:scope.data.auth_type,auth_dept_id:"",authRole:[]});else{var c=scope.sql.param_list[a].param_auth_list[b-1];""==c.condition_text||""==c.sparam_auth||""==c.auth_dept_id||""==c.auth_dprl_code?Modal.alert("请完善上一授权条件"):2==c.sparam_auth?scope.sql.param_list[a].param_auth_list.push({condition_seq:1,condition_text:"",auth_dprl_code:"",sparam_auth:"",sparam_auth_list:[{key:2,value:"远程授权"}],auth_dept_id:"",authRole:[]}):scope.sql.param_list[a].param_auth_list.push({condition_seq:1,condition_text:"",auth_dprl_code:"",sparam_auth:"",sparam_auth_list:scope.data.auth_type,auth_dept_id:"",authRole:[]})}},scope.removeKeyValueList=function(a,b){scope.sql.param_list[b].param_key_value_list.splice(a,1)},scope.addParamKeyValueList=function(a){return scope.sql.param_list[a].param_value_type&&scope.sql.param_list[a].param_key_type?void scope.sql.param_list[a].param_key_value_list.push({key:"",value:""}):(Modal.alert("请先选择键值对类型"),!1)},scope.loadauthRoleData=function(a,b,c){scope.sql.param_list[c].param_auth_list[b].auth_dprl_code="",scope.getSqlParamAuthRoleByDept(a,b,c,scope.sql.param_list[c].param_auth_list[b])},scope.formcancel=function(a,b){if(scope.sql.param_list[a].auth_bk_expl){if(scope.noParamList=!1,!CV.valiForm(scope.sql.param_list[a].param_auth_form))return scope.btnBus_loading=!1,!1;if(!scope.sql.param_list[a].param_auth_list)return scope.noParamList=!0,!1;if(0==scope.sql.param_list[a].param_auth_list.length)return scope.noParamList=!0,!1;scope.sql.param_list[a].auth_show=!1,scope.sql.param_list[a].success_flag=!0,scope.sql.param_list[a].old_auth_bk_expl=scope.sql.param_list[a].auth_bk_expl,scope.sql.param_list[a].old_param_auth_list=scope.sql.param_list[a].param_auth_list}else scope.sql.param_list[a].old_auth_bk_expl=scope.sql.param_list[a].auth_bk_expl="",scope.sql.param_list[a].old_param_auth_list=scope.sql.param_list[a].param_auth_list=[],scope.sql.param_list[a].auth_show=!1,scope.noParamList=!1},scope.formParamKeyValueCancel=function(a){if(scope.sql.editable){if(!CV.valiForm(scope.sql.param_list[a].param_key_value_form))return scope.btnBus_loading=!1,!1;if(0==scope.sql.param_list[a].param_key_value_list.length)return Modal.alert("请添加参数值！"),!1;if(2==scope.sql.param_list[a].sparam_type&&scope.sql.param_list[a].param_key_value_list.length<2)return Modal.alert("参数类型为单选框，参数值需配置两条！"),!1;for(var b=0;b<scope.sql.param_list[a].param_key_value_list.length;b++)1==scope.sql.param_list[a].param_key_type&&(scope.sql.param_list[a].param_key_value_list[b].key=parseInt(scope.sql.param_list[a].param_key_value_list[b].key)),1==scope.sql.param_list[a].param_value_type&&(scope.sql.param_list[a].param_key_value_list[b].value=parseInt(scope.sql.param_list[a].param_key_value_list[b].value));scope.sql.param_list[a].sparam_scope=angular.toJson(scope.sql.param_list[a].param_key_value_list)}scope.sql.param_list[a].param_show=!1,scope.sql.param_list[a].param_key_value_list=[],scope.sql.param_list[a].param_value_type="",scope.sql.param_list[a].param_key_type=""},scope.changeParamType=function(a,b){scope.sql.param_list[b].sparam_scope="",scope.sql.param_list[b].param_key_value_list=[]},scope.borderParamStyle=function(a){return scope.sql.param_list[a].param_show?{border:"1px solid #555f76"}:{}},scope.borderAuthStyle=function(a){return scope.sql.param_list[a].auth_show?{border:"1px solid #555f76","border-bottom":"none"}:{}}}}}]),cvDirectives.directive("editableTable",["$timeout","$parse","$compile","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f){return{restrict:"E",scope:{data:"=tableData",read_only:"=readOnly",can_insert:"=canInsert",resetBack:"&resetAll"},templateUrl:"templates/directives/editable_table.html",link:function(a,b,c){a.$watch(function(){return a.data},function(b){if(b&&b.tbodys&&b.theads){for(var c=0;c<b.theads.length;c++){var d=b.theads[c];d.key=d.key.toLowerCase(),d.primary_key=d.primary_key?d.primary_key:!1,a.read_only?d.read_only=!0:d.read_only=b.read_only?!0:d.read_only?d.read_only:!1,d.display=d.display?d.display:!0}for(var c=0;c<b.tbodys.length;c++){for(var e=b.tbodys[c],f=0;f<b.theads.length;f++){var d=b.theads[f];e["original_"+d.key]=e[d.key],e[d.key+"modify_flag"]=!1,e["updating_"+d.key]=!1}e.row_status=1,e.checked=!1}}}),a.$watch(function(){return a.read_only},function(b){if(b)for(var c=0;c<a.data.theads.length;c++){var d=a.data.theads[c];d.read_only=!0}}),a.updateTd=function(b,c,d){for(var e=a.data.tbodys[b],f=!1,g=0;g<a.data.theads.length;g++){var h=a.data.theads[g];if(e[h.key]!==e["original_"+h.key]){f=!0,e[h.key+"modify_flag"]=!0;break}}f&&3!=e.row_status&&(e.row_status=2),e["updating_"+c]=!1},a.undoAllLines=function(){if(a.resetBack())for(var b=0;b<a.data.tbodys.length;b++){var c=a.data.tbodys[b];3==c.row_status&&a.data.tbodys.splice(b,1);for(var d=0;d<a.data.theads.length;d++){var e=a.data.theads[d];c["original_"+e.key]&&(c[e.key]=c["original_"+e.key],c["updating_"+e.key]=!1)}c.row_status=1,c.checked=!1}},a.newLine=function(){for(var b={checked:!1,row_status:3},c=0;c<a.data.theads.length;c++){var d=a.data.theads[c];b[d.key]="",b["original_"+d.key]="",b["updating_"+d.key]=!0}a.data.tbodys.push(b)},a.deleteLines=function(){for(var b=0;b<a.data.tbodys.length;b++){var c=a.data.tbodys[b];c.checked&&(3==c.row_status?a.data.tbodys.splice(b,1):(c.row_status=4,c.checked=!1))}},a.tdStyle=function(a,b){var c={};return a[b.key]!==a["original_"+b.key]&&(c.color="#339900",c.background="#0f161f"),4==a.row_status&&(c.background="#6d7183",c["text-decoration"]="line-through"),c}}}}]),cvDirectives.directive("workOrderFlow",["$timeout","$parse","$compile","CV",function(a,b,c,d){return{restrict:"E",templateUrl:"templates/directives/work_order_flow.html",replace:"true",scope:{flowList:"=data"},link:function(a,b,c){a.flowCircleStyle=function(a,b){return{position:"absolute",height:"10px",width:"10px","background-color":a.deal_time?"#43fc8c":"#999999","border-radius":"5px",top:60*b+"px"}},a.flowTypeStyle=function(a){return{position:"relative",left:"-100px",top:"-4px",width:"140px",color:a.deal_time?"#43fc8c":"#999999"}},a.flowLineStyle=function(b,c){return{position:"relative",height:"60px",width:"2px","background-color":b.deal_time&&a.flowList[c+1].deal_time?"#43fc8c":"#999999",top:b.deal_time?"-43px":"-68px",left:"4px"}}}}}]),cvDirectives.directive("proBsSelect",["$compile","$timeout",function(a,b){return{restrict:"E",scope:{items:"=",selectedItem:"=mySelect",doSelect:"&selectVal",isDisable:"=disable",loading:"="},templateUrl:"templates/modal/bs_select_template.html",link:function(a,c,d){var e=d.optionKey,f=!0;a.has_opacity=""===d.opacity||"true"===d.opacity?!0:!1,a.has_noborder=""===d.noBorder||"true"===d.noBorder?!0:!1,a.init_label=d.initLabel?d.initLabel:"--- 请选择 ---",a.realItems=[],a.has_opacity&&(c.on("mouseenter",".btn-group",function(){$(this).css("opacity",1)}),c.on("mouseleave",".btn-group",function(){$(this).css("opacity",.3)})),a.scroll_config_info={axis:"xy",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}},a.changeUlStyle=function(){return a.realItems.length>5?{height:"160px","min-width":"100%"}:{height:30*a.realItems.length+15+"px","min-width":"100%"}},a.widthStyle=function(){var b=d.width?d.width:$(".default-width").width();return{width:(a.has_noborder?b:b-26)+"px"}},a.opacityStyle=function(){return{opacity:a.has_opacity?"0.3":"1"}};var g=function(b){a.init_label=e&&-1!=b.indexOf("  [")?b.substring(0,b.indexOf("  [")):b,$(".button-label",c).attr("title",e&&-1!=b.indexOf("  [")?b.substring(0,b.indexOf("  [")):b)},h=function(){if(a.realItems=[],e)for(var b=d.optionLabal.replace(" ","").split(","),c=0;c<a.items.length;c++){var f=a.items[c];a.realItems.push({key:f[e],value:f[b[0]]+(f[b[1]]?"  ["+f[b[1]]+"]":"")})}else if(a.items.length>=1&&angular.isString(a.items[0]))for(var c=0;c<a.items.length;c++)a.realItems.push({key:a.items[c],value:a.items[c]});else for(var c=0;c<a.items.length;c++)a.realItems.push(a.items[c]);d.emptyOption&&a.realItems.push({key:"",value:d.emptyOption})},i=function(){if(h(),d.emptyOption&&g(d.emptyOption),!d.emptyOption&&1==a.realItems.length&&f){var c=a.realItems[0];a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key})},0),f=!1}if(a.realItems.length>1)for(var e=0;e<a.realItems.length;e++){var c=a.realItems[e];if(c.key===a.selectedItem){g(c.value);break}e==a.realItems.length-1&&c.key!=a.selectedItem&&(a.init_label="--- 请选择 ---")}};a.selectVal=function(c){f=!1,a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key})},0)},a.$watch(function(){return a.selectedItem},function(a){a&&i()}),a.$watch(function(){return a.items},function(a){a&&(f=!0,i())},!0)}}}]),cvDirectives.directive("phaseDiagram",function(){return{restrict:"E",template:"<div></div>",replace:!0,scope:{model:"=goModel",projs:"=projData",read_only:"=readOnly"},link:function(a,b,c){function d(b,c){for(var d=0;d<a.model.linkDataArray.length;d++){var e=a.model.linkDataArray[d];if(e.from==c.data.key&&e.to==b.data.key)return!1}return a.$apply(),!0}function e(b){b.isTransactionFinished&&a.$applyAsync()}function f(b){h.model.selectedNodeData=null;for(var c=h.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){h.model.selectedNodeData=d.data;break}}a.$applyAsync()}var g=go.GraphObject.make,h=g(go.Diagram,b[0],{initialContentAlignment:go.Spot.Top,allowCopy:!1,autoScrollRegion:10,"animationManager.isEnabled":!1,ModelChanged:e,isReadOnly:a.read_only?!0:!1,"undoManager.isEnabled":!0});h.groupTemplate=g(go.Group,"Vertical",{locationSpot:go.Spot.Top,locationObjectName:"HEADER",minLocation:new go.Point(0,0),maxLocation:new go.Point(9999,0),selectionObjectName:"HEADER",deletable:!1},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),g(go.Panel,"Auto",{name:"HEADER"},g(go.Shape,"RoundedRectangle",{parameter1:10,desiredSize:new go.Size(200,50),fill:"#66D2E5",stroke:null}),g(go.TextBlock,{margin:5,font:"14px Microsoft YaHei"},new go.Binding("text","text")))),h.nodeTemplate=g(go.Node,"Horizontal",{locationSpot:go.Spot.Right,locationObjectName:"SHAPE",isShadowed:!0,shadowOffset:new go.Point(3,2),copyable:!1,deletable:!1,movable:!0,linkValidation:function(a,b,c,e,f){return d(a,c)}},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),g(go.Panel,"Auto",g(go.Shape,"Ellipse",new go.Binding("fill","color"),{portId:"",name:"SHAPE",desiredSize:new go.Size(36,36),strokeWidth:0,cursor:"pointer",fromLinkable:!0,toLinkable:!0,fromLinkableSelfNode:!1,toLinkableSelfNode:!1,fromLinkableDuplicates:!1,toLinkableDuplicates:!1}),g(go.TextBlock,new go.Binding("text","name"),{editable:!1,font:"18px Arial",stroke:"white",margin:new go.Margin(6,0,0,2)})),g(go.TextBlock,new go.Binding("text","text"),{editable:!1,font:"14px Microsoft YaHei",stroke:"#6695B5",shadowVisible:!1,width:180,margin:new go.Margin(6,0,0,10)})),h.linkTemplate=g(go.Link,{relinkableFrom:!0,relinkableTo:!0,fromLinkableDuplicates:!1,toLinkableDuplicates:!1,isShadowed:!0,shadowOffset:new go.Point(2,2)},g(go.Shape,{isPanelMain:!0,stroke:"#336281",strokeWidth:2}),g(go.Shape,{toArrow:"standard",stroke:"#336281",strokeWidth:2})),a.$watch("model",function(a){var b=h.model;b!==a&&(h.removeDiagramListener("ChangedSelection",f),h.model=a,h.addDiagramListener("ChangedSelection",f))})}}}),cvDirectives.directive("dynaHeight",function(){return{link:function(a,b,c){var d=c.initBottom?c.initBottom:200,e=parseInt($(b).css("top")),f=function(a){$(b).css("height",$(window).height()-a-(isNaN(e)?0:e))};$(window).resize(function(){setTimeout(function(){f(d)},50)}),a.resetHandle=function(a){d=a,f(d)},f(d)}}}),cvDirectives.directive("dynamicPosition",function(){return{link:function(a,b,c){var d=parseInt($(".ui-view-content").height()),e=d,f=function(a){$(b).css("marginTop",isNaN(a)?0:a-310)};$(window).resize(function(){setTimeout(function(){e=parseInt($(".ui-view-content").height()),f(e)},50)}),f(d)}}}),cvDirectives.directive("dynaTop",function(){return{link:function(a,b,c){a.heights.push($(b).offset().top)}}}),cvDirectives.directive("rowPlus",["$timeout","$compile",function(a,b){return{restrict:"A",replace:!1,scope:{rowPlus:"&",tblData:"="},link:function(a,c,d){var e='<tfoot>   <tr>\n       <td style="text-align: center;" colspan='+(c.find("thead > tr > td").length-1)+'><span ng-if="tblData && tblData.length == 0" style="color: #999;">暂无数据</span></td>\n       <td style="text-align: center;"><a class="add_line" style="cursor: pointer;"><i class="fa fa-plus" style="color: #99CCFF;"></i>&nbsp;新增</a></td>\n   </tr>\n</tfoot>\n';c.find("thead").after(b(e)(a)),c.find(".add_line:first").on("click",function(){a.$apply(function(){a.rowPlus()})})}}}]),cvDirectives.directive("subFormControl",function(){return{restrict:"C",replace:!1,require:"ngModel",link:function(a,b,c,d){var e=function(a){var b=$(a);b.prop("disabled")||b.addClass("is-focused")},f=function(a){$(a).removeClass("is-focused")};b.on("focus",function(){e(this)}),b.on("blur",function(){f(this)})}}}),cvDirectives.directive("naviPlus",["$timeout","$window","$compile",function(a,b,c){return{scope:{naviList:"="},link:function(b,d,e){var f,g=""===e.top||"true"===e.top?!0:!1,h=""===e.bottom||"true"===e.bottom?!0:!1,i=angular.isString(e.text)?e.text:"",j=angular.isString(e.taget)?e.taget:"",k=[];b.resList=[];var l=['<div class="navi-plus">',g?'<div class="oth" title="到页面顶部" ng-click="scollLimit(0);"><i class="fa fa-angle-double-up"></i></div>':"",'   <div class="lis" id="{{navi.id}}" ng-repeat="navi in resList" ng-click="scollTo(navi, $event, $index);">{{navi.id}}</div>',h?'<div class="oth" title="到页面底部" ng-click="scollLimit(9999);"><i class="fa fa-angle-double-down"></i></div>':"","</div>"].join("");d.append(c(l)(b)),b.$watch(function(){return b.naviList.length},function(a){if(a&&a>0)if(b.resList=[],b.naviList.length<=7)for(var c=0;c<b.naviList.length;c++)b.resList.push({id:c+1,title:b.naviList[c][i]});else if(b.naviList.length>7)for(var d=Math.ceil(b.naviList.length/7),c=0;c<b.naviList.length;c+=d){for(var e=[],f=0;d>f;f++)b.naviList[c+f]&&e.push("【"+(c+f+1)+"】"+b.naviList[c+f][i]);b.resList.push({id:c+1,title:e.join(",   ")})}});var m=function(){k=$(document).find(".navi-plus .lis");for(var a=0;a<k.length;a++){var b=$(k[a]),c=$("#"+j+(b.attr("id")-1));$(window).scrollTop()>=c.offset().top?b.css({"background-color":"#3399CC",color:"#FFF"}):b.css({"background-color":"#EEE",color:"#999"})}};$(window).scroll(function(){a.cancel(f),f=null,f=a(function(){m()},100)}),$(document).on("mouseenter",".navi-plus .lis",function(){var a=$(this).index();$(this).html(b.resList[a-1].title).css({"min-width":"200px",width:12*b.resList[a-1].title.length,padding:"0 10px","background-color":"#3399CC",color:"#FFF"})}),$(document).on("mouseleave",".navi-plus .lis",function(){var a=$(this).index();$(this).html(b.resList[a-1].id).css({width:30,"min-width":"0",padding:0}),m()}),b.scollTo=function(a,c,d){$("html,body").animate({scrollTop:$("#"+j+(a.id-1)).offset().top+1}),$(c.target).html(b.resList[d-1].id).css({width:30,"min-width":"0",padding:0})},b.scollLimit=function(a){$("html,body").animate({scrollTop:a})},b.$on("$destroy",function(){$(document).off("mouseenter",".navi-plus .lis"),$(document).off("mouseleave",".navi-plus .lis")})}}}]),cvDirectives.directive("toggleButton",["$compile",function(a){return{replace:!0,scope:{checked:"=",doChange:"&",disabled:"@"},link:function(b,c,d){c.css("line-height","24px");var e='<div class="togglebutton"><label style="font-size: 12px; color: #d2f1fe;">'+("left"===d.side&&d.text?'<span style="-webkit-padding-end:10px;margin-right: 15px">'+d.text+"</span>":"")+'<input type="checkbox" ng-model="checked" ng-disabled="disabled"><span class="toggle"></span>'+("right"===d.side&&d.text?'<span style="-webkit-padding-start: 10px;margin-right: 15px">'+d.text+"</span>":"")+"</label><div>";c.append(a(e)(b)),c.find("input").on("click",function(){b.$apply(function(){b.doChange()})})}}}]),cvDirectives.directive("goTop",["$compile","$timeout","$interval",function(a,b,c){return{link:function(b,c,d){var e='<div id="gotop" title="返回页面顶部" style="width: 40px; height: 40px; cursor: pointer; background: #EEE; color: #111; border-radius: 50%; font-size: 25px; opacity:0.3; position: fixed; left: 130px; bottom: 20px; box-shadow: 0 1px 1.5px 0 rgba(0, 0, 0, 0.12), 0 1px 1px 0 rgba(0, 0, 0, 0.24); text-align: center; display: none;" ng-click="goTop();"><i class="fa fa-angle-double-up"></i></div>';c.append(a(e)(b)),b.goTop=function(){return $("body,html").animate({scrollTop:0},500),!1},$("#gotop").hover(function(){$(this).css("opacity",1)},function(){$(this).css("opacity",.5)}),$(window).scroll(function(){$(document).scrollTop()>400&&$("#gotop").is(":hidden")?$("#gotop").fadeIn():$(document).scrollTop()<=400&&!$("#gotop").is(":hidden")&&$("#gotop").fadeOut()})}}}]),cvDirectives.directive("fileBrowseCheck",["$compile",function(a){return{restrict:"E",scope:{node:"=",changePath:"&",deleteFile:"&"},link:function(b,c,d){var e=""===d.check||"true"===d.check?!0:!1,f=d.deleteFile?!0:!1,g="",h=b.node.init_path;h=h.length>1&&h.lastIndexOf("/")==h.length-1?h.slice(0,h.length-1):h;var i=h.lastIndexOf("/");h?-1==i?b.node.paths=[h]:1==h.length&&0==i?b.node.paths=[h]:0==i?(g="/",b.node.paths=[h.slice(1)]):(g=h.slice(0,i+1),b.node.paths=[h.slice(i+1)]):b.node.paths=[],b.node.full_path=h,b.node.is_dir=!0;var j=["<div>",'<ol class="breadcrumb" style="margin-bottom: 0;background:#091118">','<li class="active">文件路径：&nbsp;..</li>','<li ng-repeat="path in node.paths track by $index"><a ng-click="goback($index)" ng-bind="path" style="cursor: pointer;"></a></li>',"</ol>",'<ol ng-show="node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 20px;">','<i class="fa fa-spinner fa-spin" style="font-size: 30px; color: #44dcfd;"></i>',"</li>","</ol>",'<ol ng-show="node.err_msg && !node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 18px; color: #999;">','<span style="color: #FF9933;" ng-bind="node.err_msg"></span> ',"</li>","</ol>",'<ol class="file_list" style="overflow-y:scroll; padding-left: 0;" ng-show="!node.err_msg && !node.loading">','<li style="height: 24px; line-height: 24px; list-style: none;" ng-if="node.paths.length > 1">','<i class="" style="margin-right: 10px;"></i><a style="cursor: pointer;" title="上一层" ng-click="goprev();">..</a>',"</li>",'<li ng-repeat="file in node.path_files" class="li-file" '+(f?'ng-style="liStyle(file);" ng-mouseover="file.hover = true;" ng-mouseout="file.hover = false;"':"")+">",e?'<input type="checkbox" i-check ng-model="file.checked" ng-change="checkFile(file);">':"",'<div style="display: inline-block;">','<i class="fa" ng-class="file.dir ? \'fa-folder-open\' : \'fa-file-text-o\' " style="margin-left: 10px; color: #EAC344; display: block; padding-bottom: 4px;"></i>','<a ng-if="file.edit_flag && file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofront(file);" ng-style="fileStyle(file.file, file.check_flag, file.modified_flag);" ng-bind="file.file"></a>','<a ng-if="file.edit_flag && !file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofile(file);" ng-style="fileStyle(file.file, file.check_flag, file.modified_flag);" ng-bind="file.file"></a>','<span ng-if="!file.edit_flag" style="color: #44dcfd;display: block; word-wrap: break-word;padding-left: 30px;margin-top: -25px;" ng-bind="file.file"></span>',"</div>",f?"<i class='fa li-file-trash' ng-class='trashClass(file);' ng-style='trashStyle(file);' ng-click='delete(file);'></i>":"","</li>","</ol>","</div>"].join("");c.append(a(j)(b));var k=function(){b.node.full_path=g+b.node.paths.join("/"),b.changePath()};b.liStyle=function(a){return a.hover?{background:"#EFEFEF"}:{background:"#FFF"}},b.fileStyle=function(a,c,d){var e={};return e.fontWeight=c?"bolder":"",e.color=d?"#E3AC36":"#428bca",-1!=b.node.spical_files.indexOf(a)&&(e.color="#E3AC36",e.fontWeight="bold"),e},b.trashStyle=function(a){return a.hover?{color:"#666"}:{color:"#FFF"}},b["delete"]=function(a){a.hover=!0,b.node.parent_path=g+b.node.paths.join("/"),b.node.full_path=g+b.node.paths.join("/")+"/"+a.file,b.node.is_dir=a.dir,b.deleteFile()},b.checkFile=function(a){if(a.checked)b.node.checked_files.push({file:a.file,path:g+b.node.paths.join("/"),dir:a.dir});else{for(var c=-1,d=0;d<b.node.checked_files.length;d++){var e=b.node.checked_files[d];e.file===a.file&&e.path===b.node.full_path&&(c=d)}b.node.checked_files.splice(c,1)}},b.trashClass=function(a){return a.deleted?"fa-reply":"fa-trash-o"},b.goprev=function(){b.node.paths.length>1&&b.goback(b.node.paths.length-2)},b.goback=function(a){b.node.is_dir=!0,b.node.paths.splice(a+1),k()},b.gofront=function(a){b.node.is_dir=!0,b.node.paths.push(a.file),k()},b.gofile=function(a){b.node.full_path=g+b.node.paths.join("/")+"/"+a.file,b.node.is_dir=!1,b.changePath()},b.$watch("node.path_files",function(){var a=b.node.full_path;if(!b.node.path_files)return!1;b.node.checked_files||(b.node.checked_files=[]),b.node.deleted_files||(b.node.deleted_files=[]);for(var c=0;c<b.node.path_files.length;c++){for(var d=b.node.path_files[c],e=0;e<b.node.checked_files.length;e++){var f=b.node.checked_files[e];f.file===d.file&&f.path===a&&(d.checked=!0)}for(var e=0;e<b.node.deleted_files.length;e++)b.node.deleted_files[e].file===d.file&&(d.deleted=!0)}}),b.$watch(function(){return b.node.modified_files},function(a){for(var c=0;c<b.node.path_files.length;c++)for(var d=b.node.path_files[c],e=0;e<a.length;e++){var f=a[e];f===g+b.node.paths.join("/")+"/"+d.file&&(d.modified_flag=!0)}},!0),b.changePath()}}}]),cvDirectives.directive("cusHeight",["$window",function(a){return{restrict:"AE",link:function(a,b,c){b.css("height",$(window).scrollTop()+$(window).height()-64+"px"),$(window).resize(function(){b.css("height",$(window).scrollTop()+$(window).height()-64+"px")}),$(window).scroll(function(){b.css("height",$(window).scrollTop()+$(window).height()-64+"px")})}}}]),cvDirectives.directive("dynamicWeight",["$window",function(a){return{restrict:"AE",link:function(b,c,d){a.innerWidth>1400?c.css("left",(a.innerWidth-1400)/2+"px"):c.css("left","0px"),$(window).resize(function(){a.innerWidth>1400?c.css("left",(a.innerWidth-1400)/2+"px"):c.css("left","0px")})}}}]),cvDirectives.directive("cusHeightSyn",["$timeout",function(a){return{restrict:"AE",link:function(b,c,d){b.$watch("tabs",function(){a(function(){var a=$(".left").css("height");$(".right").css("height",a)},200)},!0)}}}]),cvDirectives.directive("cusLineFlow",["$compile","$timeout",function(a,b){return{restrict:"AE",link:function(c,d,e){var f="<div class='line' style='position:absolute;width: 1px;background: #59a8f9;left: 51%;top:57px;'></div>";$(".tab-content").prepend(a(f)(c)),b(function(){var a=$(".tab-content").css("height");$(".line").css("height",a)},2e3)}}}]),cvDirectives.directive("cusTimeVal",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{error_mes:"=errorMes"},link:function(b,c,d,e){b.error_mes="";var f='<div class="ss" ng-bind="error_mes" ng-if="errorPrompt" style="color: #e9416e;padding-left:14px;"></div>';c.on("blur",function(){b.errorPrompt=!0,
b.error_mes="",c.parent().siblings(".ss").remove();var e=c.val();"week"==d.name?/^[1-7]$/.test(e)||(b.error_mes="周格式不正确(1-7)"):"mouth"==d.name||"mouthtep"==d.name?/^([1-9]|1[0-2]){0,1}$/.test(e)||(b.error_mes="hour"==d.name?"月格式不正确(1-12)":"月间隔格式不正确(1-12)"):"day"==d.name||"daytep"==d.name?/^([1-9]|[1-2][0-9]|3[0-1]){0,1}$/.test(e)||(b.error_mes="day"==d.name?"日格式不正确(1-31)":"日间隔格式不正确(1-31)"):"hour"==d.name?/^(\d|[0-1]\d|2[0-3]){0,1}$/.test(e)||(b.error_mes="时格式不正确(0-23)"):"hourtep"==d.name?/^([1-9]|[1]\d|2[0-3]){0,1}$/.test(e)||(b.error_mes="时间隔格式不正确(1-23)"):"minute"==d.name?/^(\d|[0-5]\d){0,1}$/.test(e)||(b.error_mes="分格式不正确(0-59)"):"minutep"==d.name?/^([1-9]|[1-5]\d){0,1}$/.test(e)||(b.error_mes="分间隔格式不正确(1-59)"):"duration"!=d.name||e||(b.error_mes="时长不能为空"),b.error_mes&&b.$apply(function(){c.parent().siblings(".ss").remove(),$(".autoStyle").before(a(f)(b))})}),c.on("keydown",function(a){a=a?a:event,8==a.keyCode&&(a.stopPropagation(),b.$apply(function(){b.error_mes=""}))})}}}]),cvDirectives.directive("cusFlowMade",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",pal_data:"=palData",selectKey:"=selectKey",jobConfig:"=jobConfig",reflashNode:"=reflashNode",config:"&config",dealNode:"&getInstance",refresh:"&refresh",read_only:"=readOnly",undo:"=undo",redo:"=redo",array:"=array",configNoData:"&configNoData"},link:function(a,c,d,e){function f(){go.TreeLayout.call(this)}function g(){function c(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,cursor:"pointer",mouseEnter:function(a,b){h(b.part,!0)},mouseLeave:function(a,b){h(b.part,!1)},click:function(a,b){b.part.stroke="#CCCCCC"}}]}function d(){return[{mouseEnter:function(a,b){b.part.background="#526276";var c=b.findObject("TEXT");c.stroke="#d2f1fe"},mouseLeave:function(a,b){b.part.background="transparent";var c=b.findObject("TEXT");c.stroke="#61A1B8"}}]}function e(b,c,d){for(var e=!0,f=0;f<a.model.linkDataArray.length;f++){var g=a.model.linkDataArray[f];d&&"3"==d.part.data.category?(b.data.key==g.from&&c.data.key==g.to||c.data.key==g.from&&b.data.key==g.to)&&(e=!1):"3"!=d.part.data.category&&(b.data.key==g.from||c.data.key==g.to||c.data.key==g.from&&b.data.key==g.to)&&(e=!1)}return e}function f(a,b,c,d,e){return v(go.Shape,"Circle",{fill:"transparent",stroke:"#7c8e8b",desiredSize:new go.Size(8,8),alignment:b,alignmentFocus:b,portId:a,fromSpot:b,toSpot:b,fromLinkable:c,toLinkable:d,cursor:"pointer"},new go.Binding("visible","group",function(a){return 0!=a&&a?!1:!0}))}function g(a,b,c){if(b){if(a.handled=!0,c){var d=b.diagram.toolManager.draggingTool,e=d.draggedParts||d.copiedParts;if(b.canAddMembers(e.toKeySet()))return void(b.isHighlighted=!0)}b.isHighlighted=!1}}function k(c,d){var e=null!==d?d.addMembers(d.diagram.selection,!0):c.diagram.commandHandler.addTopLevelParts(c.diagram.selection,!0);if(e&&6!=m.model.selectedNodeData.type&&4!=m.model.selectedNodeData.type&&5!=m.model.selectedNodeData.type){for(var f=[],g=0;g<m.model.nodeDataArray.length;g++)m.model.nodeDataArray[g].group&&f.push(m.model.nodeDataArray[g].key);var h=angular.copy(m.model.linkDataArray);b(function(){for(var a=h.length-1;a>=0;a--)for(var b=0;b<f.length;b++)0!=h.length&&(h[a].from==f[b]||h[a].to==f[b])&&m.model.removeLinkData(m.model.linkDataArray[a])},200)}else c.diagram.currentTool.doCancel(),b(function(){m.clearSelection(),a.jobConfig=!1},20)}function t(a){var b=a.subject.findObject("LABEL");null!==b&&(b.visible=4===a.subject.fromNode.data.type)}function u(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var v=go.GraphObject.make;m=v(go.Diagram,"myEditDiagramDiv",{initialContentAlignment:go.Spot.TopCenter,"grid.visible":!1,allowMove:!0,allowDrop:!0,LinkDrawn:t,LinkRelinked:t,ChangedSelection:j,"animationManager.duration":800,"undoManager.isEnabled":!0,autoScale:go.Diagram.UniformToFill}),m.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=m.model.nodeDataArray,a.model.linkDataArray=m.model.linkDataArray}),m.addDiagramListener("ExternalObjectsDropped",function(a){if(0!=s.length){var b=s.shift();m.model.setDataProperty(m.model.selectedNodeData,"key",b)}else r++,m.model.setDataProperty(m.model.selectedNodeData,"key",r)}),m.addDiagramListener("SelectionCopied",function(a){if(0!=s.length){var b=s.shift();m.model.setDataProperty(m.model.selectedNodeData,"key",b)}else{r++,m.model.setDataProperty(m.model.selectedNodeData,"key",r);var c=angular.copy(m.model.selectedNodeData.sd_job_bean);c.job_id=m.model.selectedNodeData.key,m.model.setDataProperty(m.model.selectedNodeData,"sd_job_bean",c)}}),m.addDiagramListener("SelectionDeleted",function(a){m.model.selectedNodeData&&s.push(m.model.selectedNodeData.key)}),m.toolManager.dragSelectingTool.delay=0,m.nodeTemplateMap.add("7",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Auto",v(go.Shape,"Rectangle",{fill:"#091016",cursor:"pointer",stroke:"#164957",strokeWidth:1,width:120,height:56}),v(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},v(go.Picture,{width:36,height:36},new go.Binding("source","",function(a){if(a.sd_job_bean.sdwork_cn_name&&a.sd_job_bean.config){if(6==a.type)return"img/dispatch/fl/context/rep.png";if(7==a.type)return"img/dispatch/fl/context/ftpU.png";if(8==a.type)return"img/dispatch/fl/context/ftpD.png";if(9==a.type)return"img/dispatch/fl/context/sftpU.png";if(10==a.type)return"img/dispatch/fl/context/sftpD.png";if(11==a.type)return"img/dispatch/fl/context/zngtU.png";if(12==a.type)return"img/dispatch/fl/context/zngtD.png";if(13==a.type)return"img/dispatch/fl/context/copy.png";if(14==a.type)return"img/dispatch/fl/context/sql.png";if(15==a.type)return"img/dispatch/fl/context/sqlS.png";if(16==a.type)return"img/dispatch/fl/context/web.png";if(17==a.type)return"img/dispatch/fl/context/sysSt.png";if(18==a.type)return"img/dispatch/fl/context/sysE.png";if(19==a.type)return"img/dispatch/fl/context/python.png";if(20==a.type)return"img/dispatch/fl/context/shell.png";if(21==a.type)return"img/dispatch/fl/context/bat.png";if(22==a.type)return"img/dispatch/fl/context/rb.png";if(23==a.type)return"img/dispatch/fl/context/perl.png";if(24==a.type)return"img/dispatch/fl/context/webs.png";if(25==a.type)return"img/dispatch/fl/context/tcp.png";if(26==a.type)return"img/dispatch/fl/context/http.png";if(27==a.type)return"img/dispatch/fl/context/tux.png";if(28==a.type)return"img/dispatch/fl/context/cl.png";if(29==a.type)return"img/dispatch/fl/context/rpg.png";if(30==a.type)return"img/dispatch/fl/context/java.png";if(31==a.type)return"img/dispatch/fl/context/c.png";if(32==a.type)return"img/dispatch/fl/context/c++.png"}else{if(1==a.type)return"img/dispatch/fl/context/start_un.png";if(6==a.type)return"img/dispatch/fl/context/rep_un.png";if(7==a.type)return"img/dispatch/fl/context/ftpU_un.png";if(8==a.type)return"img/dispatch/fl/context/ftpD_un.png";if(9==a.type)return"img/dispatch/fl/context/sftpU_un.png";if(10==a.type)return"img/dispatch/fl/context/sftpD_un.png";if(11==a.type)return"img/dispatch/fl/context/zngtU_un.png";if(12==a.type)return"img/dispatch/fl/context/zngtD_un.png";if(13==a.type)return"img/dispatch/fl/context/copy_un.png";if(14==a.type)return"img/dispatch/fl/context/sql_un.png";if(15==a.type)return"img/dispatch/fl/context/sqlS_un.png";if(16==a.type)return"img/dispatch/fl/context/web_un.png";if(17==a.type)return"img/dispatch/fl/context/sysSt_un.png";if(18==a.type)return"img/dispatch/fl/context/sysE_un.png";if(19==a.type)return"img/dispatch/fl/context/python_un.png";if(20==a.type)return"img/dispatch/fl/context/shell_un.png";if(21==a.type)return"img/dispatch/fl/context/bat_un.png";if(22==a.type)return"img/dispatch/fl/context/rb_un.png";if(23==a.type)return"img/dispatch/fl/context/perl_un.png";if(24==a.type)return"img/dispatch/fl/context/webs_un.png";if(25==a.type)return"img/dispatch/fl/context/tcp_un.png";if(26==a.type)return"img/dispatch/fl/context/http_un.png";if(27==a.type)return"img/dispatch/fl/context/tux_un.png";if(28==a.type)return"img/dispatch/fl/context/cl_un.png";if(29==a.type)return"img/dispatch/fl/context/rpg_un.png";if(30==a.type)return"img/dispatch/fl/context/java_un.png";if(31==a.type)return"img/dispatch/fl/context/c_un.png";if(32==a.type)return"img/dispatch/fl/context/c++_un.png"}}))),v(go.Panel,"Auto",{margin:new go.Margin(10,6,4,48),width:62},v(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),v(go.Panel,"Auto",{alignment:go.Spot.TopRight,margin:new go.Margin(1,1,0,0)},v(go.Shape,"Rectangle",{fill:"#091016",stroke:null,width:24,height:16}),v(go.Picture,{width:14,height:8},new go.Binding("source","",function(a){return a.sd_job_bean.pre_job_list?"img/dispatch/fl/fl_pre.png":void 0}),new go.Binding("visible","",function(a){return 0!=a.sd_job_bean.pre_job_list.length?!0:0==a.sd_job_bean.pre_job_list?!1:void 0})))),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("3",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},v(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/condition.png":"img/dispatch/fl/context/condition_un.png"}))),f("T",go.Spot.Top,!1,!0),f("B",go.Spot.Bottom,!0,!0),f("L",go.Spot.Left,!0,!0),f("R",go.Spot.Right,!0,!0))),m.nodeTemplateMap.add("4",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},v(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/rep.png":"img/dispatch/fl/context/rep_un.png"}))),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("5",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},v(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/stop.png":"img/dispatch/fl/context/stop_un.png"}))),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("1",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Auto",v(go.Shape,"Circle",{width:26,height:26,fill:"#091016",stroke:"#194C5A",strokeWidth:2,cursor:"pointer"})),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("2",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Auto",v(go.Shape,"Circle",{width:25,height:25,fill:null,stroke:"#194C5A",strokeWidth:2}),v(go.Panel,"Auto",v(go.Shape,"Circle",{width:14,height:14,fill:"#194C5A",stroke:null}))),f("T",go.Spot.Top,!1,!0))),m.groupTemplateMap.add("6",v(go.Group,"Auto",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,a)}},{mouseDragEnter:function(a,b,c){g(a,b,!0)},mouseDragLeave:function(a,b,c){g(a,b,!1)},computesBoundsAfterDrag:!0,mouseDrop:k,handlesDragDropForMembers:!0,layout:v(go.GridLayout,{wrappingWidth:1/0,alignment:go.GridLayout.Position,cellSize:new go.Size(1,1),spacing:new go.Size(4,4)})},v(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Panel,"Vertical",{margin:-2},v(go.Panel,"Horizontal",{stretch:go.GraphObject.Horizontal,background:"#1F3144",padding:4},v(go.Panel,"Auto",v(go.Shape,"Circle",{width:25,height:25,fill:"#091016",stroke:"#1F3144"}),v(go.TextBlock,{font:"14px Microsoft YaHei",opacity:.75,stroke:"#d2f1fe"},new go.Binding("text","grid",function(a){return 0!=a?(q=parseInt(a),a):q}).makeTwoWay())),v(go.TextBlock,{alignment:go.Spot.Left,editable:!0,margin:5,font:"14px Microsoft YaHei",opacity:.75,stroke:"#61a1b8"},new go.Binding("text","text").makeTwoWay())),v(go.Placeholder,{padding:20,alignment:go.Spot.TopLeft})),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.linkTemplate=v(go.Link,v(go.Shape,{stroke:"gray",fill:"gray"}),v(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"}),v(go.Panel,"Auto",{visible:!1,name:"LABEL"},new go.Binding("visible","visible").makeTwoWay(),v(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"null"}),v(go.TextBlock,"判断条件",{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay()))),m.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=m.model.nodeDataArray,a.model.linkDataArray=m.model.linkDataArray,m.model.selectedNodeData?3!=m.model.selectedNodeData.type&&(a.selectNode=m.model.selectedNodeData,a.jobConfig=!0,a.config({key:m.model.selectedNodeData})):a.jobConfig=!1}),m.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,m.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,i();var w=v(go.Palette,"myPaletteDiv0",{padding:2},{"animationManager.duration":600,model:new go.GraphLinksModel(o.condition_list),allowResize:!0,mouseDragOver:function(){}});w.groupTemplate=v(go.Group,"Vertical",{locationSpot:go.Spot.LeftCenter,selectionAdorned:!1,width:60,height:60},v(go.Panel,"Vertical",{margin:new go.Margin(-34,0,0,0)},v(go.Shape,"RoundedRectangle",{fill:"transparent",width:60,height:56,cursor:"pointer",stroke:null}),v(go.Picture,{width:38,height:38,margin:new go.Margin(-14,0,0,0)},new go.Binding("source","type",function(a){return"img/dispatch/fl/palette/group.png"})),v(go.TextBlock,"Yes",{textAlign:"center",font:"12px Microsoft YaHei",stroke:"#61A1B8",editable:!0,name:"TEXT"},new go.Binding("text").makeTwoWay())),d()),w.nodeTemplate=v(go.Node,"Vertical",{locationSpot:go.Spot.Left,selectionAdorned:!1,width:60,height:60},v(go.Panel,"Vertical",{margin:new go.Margin(-34,0,0,0)},v(go.Shape,"RoundedRectangle",{fill:"transparent",width:60,height:56,cursor:"pointer",stroke:null}),v(go.Picture,{width:38,height:38,margin:new go.Margin(-14,0,0,0),cursor:"pointer",background:"transparent"},new go.Binding("source","type",function(a){return 1==a?"img/dispatch/fl/palette/start.png":2==a?"img/dispatch/fl/palette/end.png":3==a?"img/dispatch/fl/palette/group.png":4==a?"img/dispatch/fl/palette/condition.png":5==a?"img/dispatch/fl/palette/stop.png":6==a?"img/dispatch/fl/palette/rep.png":7==a?"img/dispatch/fl/palette/ftp_u.png":8==a?"img/dispatch/fl/palette/ftp_d.png":9==a?"img/dispatch/fl/palette/sftp_u.png":10==a?"img/dispatch/fl/palette/sftp_d.png":11==a?"img/dispatch/fl/palette/agnt_u.png":12==a?"img/dispatch/fl/palette/agnt_d.png":13==a?"img/dispatch/fl/palette/copy.png":14==a?"img/dispatch/fl/palette/sql.png":15==a?"img/dispatch/fl/palette/sql_s.png":16==a?"img/dispatch/fl/palette/net.png":17==a?"img/dispatch/fl/palette/sys_start.png":18==a?"img/dispatch/fl/palette/sys_end.png":19==a?"img/dispatch/fl/palette/python.png":20==a?"img/dispatch/fl/palette/shell.png":21==a?"img/dispatch/fl/palette/bat.png":22==a?"img/dispatch/fl/palette/ruby.png":23==a?"img/dispatch/fl/palette/perl.png":24==a?"img/dispatch/fl/palette/web.png":25==a?"img/dispatch/fl/palette/tcp.png":26==a?"img/dispatch/fl/palette/http.png":27==a?"img/dispatch/fl/palette/tux.png":28==a?"img/dispatch/fl/palette/cl.png":29==a?"img/dispatch/fl/palette/rpg.png":30==a?"img/dispatch/fl/palette/java.png":31==a?"img/dispatch/fl/palette/c.png":32==a?"img/dispatch/fl/palette/c++.png":void 0})),v(go.TextBlock,"Yes",{textAlign:"center",font:"12px Microsoft YaHei",stroke:"#61A1B8",editable:!0,name:"TEXT"},new go.Binding("text").makeTwoWay()),{toolTip:v(go.Adornment,"Auto",v(go.Shape,{fill:"#091016",stroke:"#d2f1fe",strokeWidth:1}),v(go.TextBlock,{margin:4,stroke:"#d2f1fe"},new go.Binding("text","text")),new go.Binding("visible","text",function(a){return""!==a}))}),d());var x=(v(go.Palette,"myPaletteDiv1",{padding:new go.Margin(0,0,0,0),layout:v(go.GridLayout,{arrangement:go.GridLayout.LeftToRight,spacing:new go.Size(3,3)})},{initialDocumentSpot:go.Spot.Left,initialContentAlignment:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,"animationManager.duration":800,model:new go.GraphLinksModel(o.polling_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv2",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.file_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv3",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.db_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv4",{padding:new go.Margin(0,0,0,0),layout:v(go.GridLayout,{arrangement:go.GridLayout.LeftToRight,spacing:new go.Size(3,3)})},{initialDocumentSpot:go.Spot.Left,initialContentAlignment:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,"animationManager.duration":800,model:new go.GraphLinksModel(o.web_list),nodeTemplate:w.nodeTemplate,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv5",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.apply_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv6",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.shell_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv7",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.webS_list),allowResize:!0,nodeTemplate:w.nodeTemplate,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv8",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.other_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),function(){null!==document.getElementById("privatePaletteDiv")&&(n=v(go.Palette,"privatePaletteDiv",{padding:2},{initialDocumentSpot:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,initialContentAlignment:go.Spot.Left,"toolManager.hoverDelay":200,"animationManager.duration":800,model:new go.GraphLinksModel(p),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){},ModelChanged:function(b){b.isTransactionFinished&&l("privatePaletteDiv",a.pal_data.private_palette_list.length)}}))});x();var y=function(a,b){v(go.Palette,a,{padding:2},{initialDocumentSpot:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,initialContentAlignment:go.Spot.Left,"toolManager.hoverDelay":200,"animationManager.duration":800,model:new go.GraphLinksModel(b.element_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){},ModelChanged:function(a){a.isTransactionFinished}})},z=function(a,c){a&&b(function(){y(a,c),l(a,c.element_list.length)},10)};a.$watch("pal_data.scene_palette_list.length",function(b,c){if(b&&b>c)for(var d=c;b>d;d++){var e=a.pal_data.scene_palette_list[d];e.category_list=e.category_list?e.category_list:[];for(var f=0;f<e.category_list.length;f++){var g=e.category_list[f];g.element_list=g.element_list?g.element_list:[];var h="scenePaletteDiv"+d+"-"+f;document.getElementById(h)||z(h,g)}}}),m.doFocus=u}function h(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#999999":null})}function i(){m.model=go.Model.fromJson(a.model)}function j(b){m.model.selectedNodeData=null;for(var c=m.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){m.model.selectedNodeData=d.data;break}}a.$applyAsync()}function k(){m.startTransaction("generateTree");for(var b=[],c=0;c<a.model.nodeDataArray.length;c++)b.push({category:a.model.nodeDataArray[c].category,text:a.model.nodeDataArray[c].text,key:a.model.nodeDataArray[c].key,sd_job_bean:a.model.nodeDataArray[c].sd_job_bean,type:a.model.nodeDataArray[c].type,grid:a.model.nodeDataArray[c].grid?a.model.nodeDataArray[c].grid:void 0,isGroup:a.model.nodeDataArray[c].isGroup?a.model.nodeDataArray[c].isGroup:void 0,group:a.model.nodeDataArray[c].group?a.model.nodeDataArray[c].group:void 0});m.model.nodeDataArray=a.model.nodeDataArray;for(var d=[],c=0;c<a.model.linkDataArray.length;c++)d.push({from:a.model.linkDataArray[c].from,to:a.model.linkDataArray[c].to});m.model.linkDataArray=a.model.linkDataArray,t(),m.commitTransaction("generateTree")}function l(a,b){var c=document.getElementById(a),d=Math.ceil(b/2);null!==c&&(c.style.left=1===b?"-35px":"0",d>1&&(c.style.height=70*d+"px"))}var m,n,o=a.pal_data.palette_list?a.pal_data.palette_list:{},p=a.pal_data.private_palette_list?a.pal_data.private_palette_list:[],q=(a.pal_data.scene_palette_list?a.pal_data.scene_palette_list:[],0),r=0,s=[];a.selectNode={},go.Diagram.inherit(f,go.TreeLayout);var t=function(){m.startTransaction("change Layout"),m.layout.isOngoing=!0,m.layout=new f,m.layout.treeStyle=go.TreeLayout.StyleLayered,m.layout.layerStyle=go.TreeLayout.LayerSiblings,m.layout.angle=90,m.layout.alignment=go.TreeLayout.AlignmentCenterChildren,m.layout.arrangementSpacing=new go.Size(20,40),m.layout.layerSpacing=50,m.layout.isOngoing=!1,m.commitTransaction("change Layout")},u=function(){k()};g(),$("#myEditDiagramDiv > div").css("overflow","hidden"),a.$on("addPalette",function(a,b){n.startTransaction("add palette"),n.model.addNodeData(b),n.commitTransaction("add palette")}),a.$on("updatePalette",function(b,c){n.startTransaction("update palette"),n.model.nodeDataArray=a.pal_data.private_palette_list,n.commitTransaction("update palette")}),a.$watch("model.nodeDataArray.length",function(){for(var b=0,c=0;c<a.model.nodeDataArray.length;c++)a.model.nodeDataArray[c].isGroup&&(b+=1),a.model.nodeDataArray[c].key>r&&(r=a.model.nodeDataArray[c].key);q=b,m.startTransaction("change node"),m.model.selectedNodeData&&m.model.selectedNodeData.isGroup&&(m.model.selectedNodeData.grid=q);var d=m.findNodeForData(m.model.selectedNodeData);null!==d&&d.updateTargetBindings(""),m.commitTransaction("change node"),m.clearSelection(),a.selectKey=0},!0),a.$watch("reflashNode",function(){if(m.startTransaction("change node"),m.model.selectedNodeData)for(var b=0;b<a.model.nodeDataArray.length;b++)if(a.model.nodeDataArray[b].key==m.model.selectedNodeData.key){m.model.selectedNodeData.sd_job_bean=a.model.nodeDataArray[b].sd_job_bean;var c=m.findNodeForData(m.model.selectedNodeData);null!==c&&c.updateTargetBindings("")}m.commitTransaction("change node")},!0),a.$watch("jobConfig",function(){a.jobConfig||(m.clearSelection(),a.selectKey=0,a.configNoData())},!0),a.$watch("selectKey",function(){0!=a.selectKey&&m.select(m.findNodeForKey(a.selectKey))},!0),a.$watch("undo",function(b){a.undo=b,a.undo.invoke=function(){m.undoManager.undo()}}),a.$watch("array",function(a){b(function(){u()},100)},!0),a.$watch("redo",function(b){a.redo=b,a.redo.invoke=function(){m.undoManager.redo()}})}}}]),cvDirectives.directive("cusFlowDetail",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",read_only:"=readOnly",undo:"=undo",redo:"=redo",jobConfig:"=jobConfig",config:"&config"},link:function(a,b,c,d){function e(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,selectionAdorned:!1,click:function(a,b){b.part.stroke="#CCCCCC"}}]}function c(b,c){for(var d=!0,e=0;e<a.model.linkDataArray.length;e++){var f=a.model.linkDataArray[e];(b.data.key==f.from||c.data.key==f.to)&&(d=!1)}return d}function d(a,b,c){if(b){if(a.handled=!0,c){var d=b.diagram.toolManager.draggingTool,e=d.draggedParts||d.copiedParts;if(b.canAddMembers(e.toKeySet()))return void(b.isHighlighted=!0)}b.isHighlighted=!1}}function e(a,b){var c=null!==b?b.addMembers(b.diagram.selection,!0):a.diagram.commandHandler.addTopLevelParts(a.diagram.selection,!0);c||a.diagram.currentTool.doCancel()}function k(a){var b=a.subject.findObject("LABEL");null!==b&&(b.visible=4===a.subject.fromNode.data.type)}function l(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var m=go.GraphObject.make;h=m(go.Diagram,"myDiagramDiv",{initialContentAlignment:go.Spot.Top,allowDrop:!0,LinkDrawn:k,LinkRelinked:k,ChangedSelection:g,"animationManager.duration":800,"undoManager.isEnabled":!0,allowResize:!0,autoScale:go.Diagram.UniformToFill,isReadOnly:!0}),h.layout=m(go.TreeLayout,{angle:90,layerSpacing:70,nodeSpacing:110,arrangementSpacing:new go.Size(20,40),sorting:go.TreeLayout.SortingAscending}),h.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=h.model.nodeDataArray,a.model.linkDataArray=h.model.linkDataArray}),h.addDiagramListener("ChangedSelection",function(){h.model.selectedNodeData?3!=h.model.selectedNodeData.type&&(a.selectNode=h.model.selectedNodeData,a.jobConfig=!0,a.config({key:h.model.selectedNodeData})):a.jobConfig=!1}),h.nodeTemplateMap.add("7",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Auto",m(go.Shape,"Rectangle",{fill:"#091016",stroke:"164957",width:120,height:56}),m(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},m(go.Picture,{width:36,height:36},new go.Binding("source","",function(a){if(a.sd_job_bean.sdwork_cn_name){if(6==a.type)return"img/dispatch/fl/context/rep.png";if(7==a.type)return"img/dispatch/fl/context/ftpU.png";if(8==a.type)return"img/dispatch/fl/context/ftpD.png";if(9==a.type)return"img/dispatch/fl/context/sftpU.png";if(10==a.type)return"img/dispatch/fl/context/sftpD.png";if(11==a.type)return"img/dispatch/fl/context/zngtU.png";if(12==a.type)return"img/dispatch/fl/context/zngtD.png";if(13==a.type)return"img/dispatch/fl/context/copy.png";if(14==a.type)return"img/dispatch/fl/context/sql.png";if(15==a.type)return"img/dispatch/fl/context/sqlS.png";if(16==a.type)return"img/dispatch/fl/context/web.png";if(17==a.type)return"img/dispatch/fl/context/sysSt.png";if(18==a.type)return"img/dispatch/fl/context/sysE.png";if(19==a.type)return"img/dispatch/fl/context/python.png";if(20==a.type)return"img/dispatch/fl/context/shell.png";if(21==a.type)return"img/dispatch/fl/context/bat.png";if(22==a.type)return"img/dispatch/fl/context/rb.png";if(23==a.type)return"img/dispatch/fl/context/perl.png";if(24==a.type)return"img/dispatch/fl/context/webs.png";if(25==a.type)return"img/dispatch/fl/context/tcp.png";if(26==a.type)return"img/dispatch/fl/context/http.png";if(27==a.type)return"img/dispatch/fl/context/tux.png";if(28==a.type)return"img/dispatch/fl/context/cl.png";if(29==a.type)return"img/dispatch/fl/context/rpg.png";if(30==a.type)return"img/dispatch/fl/context/java.png";if(31==a.type)return"img/dispatch/fl/context/c.png";if(32==a.type)return"img/dispatch/fl/context/c++.png"}else{if(1==a.type)return"img/dispatch/fl/context/start_un.png";if(6==a.type)return"img/dispatch/fl/context/rep_un.png";if(7==a.type)return"img/dispatch/fl/context/ftpU_un.png";if(8==a.type)return"img/dispatch/fl/context/ftpD_un.png";if(9==a.type)return"img/dispatch/fl/context/sftpU_un.png";if(10==a.type)return"img/dispatch/fl/context/sftpD_un.png";if(11==a.type)return"img/dispatch/fl/context/zngtU_un.png";if(12==a.type)return"img/dispatch/fl/context/zngtD_un.png";if(13==a.type)return"img/dispatch/fl/context/copy_un.png";if(14==a.type)return"img/dispatch/fl/context/sql_un.png";if(15==a.type)return"img/dispatch/fl/context/sqlS_un.png";if(16==a.type)return"img/dispatch/fl/context/web_un.png";if(17==a.type)return"img/dispatch/fl/context/sysSt_un.png";if(18==a.type)return"img/dispatch/fl/context/sysE_un.png";if(19==a.type)return"img/dispatch/fl/context/python_un.png";if(20==a.type)return"img/dispatch/fl/context/shell_un.png";if(21==a.type)return"img/dispatch/fl/context/bat_un.png";if(22==a.type)return"img/dispatch/fl/context/rb_un.png";if(23==a.type)return"img/dispatch/fl/context/perl_un.png";if(24==a.type)return"img/dispatch/fl/context/webs_un.png";if(25==a.type)return"img/dispatch/fl/context/tcp_un.png";if(26==a.type)return"img/dispatch/fl/context/http_un.png";if(27==a.type)return"img/dispatch/fl/context/tux_un.png";if(28==a.type)return"img/dispatch/fl/context/cl_un.png";if(29==a.type)return"img/dispatch/fl/context/rpg_un.png";if(30==a.type)return"img/dispatch/fl/context/java_un.png";if(31==a.type)return"img/dispatch/fl/context/c_un.png";if(32==a.type)return"img/dispatch/fl/context/c++_un.png"}}))),m(go.Panel,"Auto",{margin:new go.Margin(10,6,4,48),width:62},m(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),m(go.Panel,"Auto",{alignment:go.Spot.TopRight,margin:new go.Margin(1,1,0,0)},m(go.Shape,"Rectangle",{fill:"#091016",stroke:null,width:24,height:16}),m(go.Picture,{width:14,height:8},new go.Binding("source","",function(a){return a.sd_job_bean.pre_job_list?"img/dispatch/fl/fl_pre.png":void 0}),new go.Binding("visible","",function(a){return 0!=a.sd_job_bean.pre_job_list.length?!0:0==a.sd_job_bean.pre_job_list?!1:void 0})))))),h.nodeTemplateMap.add("3",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Spot",{width:100,height:50},m(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Picture,new go.Binding("source","",function(){return"img/dispatch/fl/context/condition.png"}))))),h.nodeTemplateMap.add("4",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},m(go.Panel,"Spot",{width:100,height:50},m(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/rep.png":"img/dispatch/fl/context/rep_un.png"}))))),h.nodeTemplateMap.add("5",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},m(go.Panel,"Spot",{width:100,height:50},m(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/stop.png":"img/dispatch/fl/context/stop_un.png"}))))),h.nodeTemplateMap.add("1",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Auto",m(go.Shape,"Circle",{width:26,height:26,fill:"#091016",stroke:"#194C5A",strokeWidth:2})))),h.nodeTemplateMap.add("2",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Auto",m(go.Shape,"Circle",{width:25,height:25,fill:null,stroke:"#194C5A",strokeWidth:2}),m(go.Panel,"Auto",m(go.Shape,"Circle",{width:14,height:14,fill:"#194C5A",stroke:null}))))),h.groupTemplateMap.add("6",m(go.Group,"Auto",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},{mouseDragEnter:function(a,b,c){d(a,b,!0)},mouseDragLeave:function(a,b,c){d(a,b,!1)},computesBoundsAfterDrag:!0,mouseDrop:e,handlesDragDropForMembers:!0,layout:m(go.GridLayout,{wrappingWidth:1/0,alignment:go.GridLayout.Position,cellSize:new go.Size(1,1),spacing:new go.Size(4,4)})},m(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Panel,"Vertical",{margin:-2},m(go.Panel,"Horizontal",{stretch:go.GraphObject.Horizontal,background:"#1F3144",padding:4},m(go.Panel,"Auto",m(go.Shape,"Circle",{width:25,height:25,fill:"#091016",stroke:"#1F3144"}),m(go.TextBlock,{font:"14px Microsoft YaHei",opacity:.75,stroke:"#d2f1fe"},new go.Binding("text","grid",function(a){return 0!=a?(i=parseInt(a),a):i}).makeTwoWay())),m(go.TextBlock,{alignment:go.Spot.Left,editable:!0,margin:5,font:"14px Microsoft YaHei",opacity:.75,stroke:"#61a1b8"},new go.Binding("text","text").makeTwoWay())),m(go.Placeholder,{padding:20,alignment:go.Spot.TopLeft})))),h.linkTemplate=m(go.Link,m(go.Shape,{stroke:"gray",fill:"gray"}),m(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"}),m(go.Panel,"Auto",{visible:!1,name:"LABEL",segmentIndex:1},new go.Binding("segmentFraction","",function(a){return a.visible?j?(j=!1,.5):(j=!0,.8):void 0}),new go.Binding("visible","visible").makeTwoWay(),m(go.Shape,"RoundedRectangle",{
fill:"#091016",stroke:"null"}),m(go.TextBlock,"判断条件",{font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay()))),h.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,h.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,f(),h.doFocus=l}function f(){h.model=go.Model.fromJson(a.model)}function g(b){h.model.selectedNodeData=null;for(var c=h.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){h.model.selectedNodeData=d.data;break}}a.$applyAsync()}var h,i=0,j=!1;a.selectNode={},e(),$("#myDiagramDiv > div").css("overflow","hidden"),a.$watch("jobConfig",function(){a.jobConfig||h.clearSelection()},!0)}}}]),cvDirectives.directive("cusFlowTaskExe",["$compile","$timeout","$interval",function(a,b,c){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",read_only:"=readOnly",undo:"=undo",redo:"=redo",jobConfig:"=jobConfig",config:"&config",nodeSelected:"=nodeSelected"},link:function(a,b,d,e){function f(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,selectionAdorned:!1,cursor:"pointer",mouseEnter:function(a,b){g(b.part,!0)},mouseLeave:function(a,b){g(b.part,!1)},click:function(a,b){b.part.stroke="#CCCCCC"}}]}function c(b,c){for(var d=!0,e=0;e<a.model.linkDataArray.length;e++){var f=a.model.linkDataArray[e];(b.data.key==f.from||c.data.key==f.to)&&(d=!1)}return d}function d(a,b,c){if(b){if(a.handled=!0,c){var d=b.diagram.toolManager.draggingTool,e=d.draggedParts||d.copiedParts;if(b.canAddMembers(e.toKeySet()))return void(b.isHighlighted=!0)}b.isHighlighted=!1}}function e(b){i.model.selectedNodeData=null;for(var c=i.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){i.model.selectedNodeData=d.data;break}}a.$applyAsync()}function f(a,b){var c=null!==b?b.addMembers(b.diagram.selection,!0):a.diagram.commandHandler.addTopLevelParts(a.diagram.selection,!0);c||a.diagram.currentTool.doCancel()}function l(a){var b=a.subject.findObject("LABEL");null!==b&&(b.visible=4===a.subject.fromNode.data.type)}function m(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var n=go.GraphObject.make;i=n(go.Diagram,"myDiagramDiv",{initialContentAlignment:go.Spot.Top,allowMove:!1,allowDrop:!1,LinkDrawn:l,LinkRelinked:l,ChangedSelection:e,"animationManager.duration":800,"undoManager.isEnabled":!0,allowResize:!1,initialAutoScale:go.Diagram.UniformToFill,isReadOnly:!0}),i.layout=n(go.TreeLayout,{angle:90,layerSpacing:70,nodeSpacing:110,arrangementSpacing:new go.Size(20,40)}),i.toolManager.dragSelectingTool.delay=0,i.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=i.model.nodeDataArray,a.model.linkDataArray=i.model.linkDataArray}),i.addDiagramListener("ChangedSelection",function(){i.model.selectedNodeData&&3!=i.model.selectedNodeData.type&&(a.selectNode=i.model.selectedNodeData,a.config({key:i.model.selectedNodeData}))}),i.nodeTemplateMap.add("7",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Auto",n(go.Shape,"Rectangle",{fill:"#091016",width:120,height:56,strokeWidth:1.5},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b=null;break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b="#164957"}return b})),n(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},n(go.Picture,{width:36,height:36},new go.Binding("source","",function(a){if(a.sd_job_bean.sdwork_cn_name){if(6==a.type)return"img/dispatch/fl/context/rep.png";if(7==a.type)return"img/dispatch/fl/context/ftpU.png";if(8==a.type)return"img/dispatch/fl/context/ftpD.png";if(9==a.type)return"img/dispatch/fl/context/sftpU.png";if(10==a.type)return"img/dispatch/fl/context/sftpD.png";if(11==a.type)return"img/dispatch/fl/context/zngtU.png";if(12==a.type)return"img/dispatch/fl/context/zngtD.png";if(13==a.type)return"img/dispatch/fl/context/copy.png";if(14==a.type)return"img/dispatch/fl/context/sql.png";if(15==a.type)return"img/dispatch/fl/context/sqlS.png";if(16==a.type)return"img/dispatch/fl/context/web.png";if(17==a.type)return"img/dispatch/fl/context/sysSt.png";if(18==a.type)return"img/dispatch/fl/context/sysE.png";if(19==a.type)return"img/dispatch/fl/context/python.png";if(20==a.type)return"img/dispatch/fl/context/shell.png";if(21==a.type)return"img/dispatch/fl/context/bat.png";if(22==a.type)return"img/dispatch/fl/context/rb.png";if(23==a.type)return"img/dispatch/fl/context/perl.png";if(24==a.type)return"img/dispatch/fl/context/webs.png";if(25==a.type)return"img/dispatch/fl/context/tcp.png";if(26==a.type)return"img/dispatch/fl/context/http.png";if(27==a.type)return"img/dispatch/fl/context/tux.png";if(28==a.type)return"img/dispatch/fl/context/cl.png";if(29==a.type)return"img/dispatch/fl/context/rpg.png";if(30==a.type)return"img/dispatch/fl/context/java.png";if(31==a.type)return"img/dispatch/fl/context/c.png";if(32==a.type)return"img/dispatch/fl/context/c++.png"}else{if(1==a.type)return"img/dispatch/fl/context/start_un.png";if(7==a.type)return"img/dispatch/fl/context/ftpU_un.png";if(8==a.type)return"img/dispatch/fl/context/ftpD_un.png";if(9==a.type)return"img/dispatch/fl/context/sftpU_un.png";if(10==a.type)return"img/dispatch/fl/context/sftpD_un.png";if(11==a.type)return"img/dispatch/fl/context/zngtU_un.png";if(12==a.type)return"img/dispatch/fl/context/zngtD_un.png";if(13==a.type)return"img/dispatch/fl/context/copy_un.png";if(14==a.type)return"img/dispatch/fl/context/sql_un.png";if(15==a.type)return"img/dispatch/fl/context/sqlS_un.png";if(16==a.type)return"img/dispatch/fl/context/web_un.png";if(17==a.type)return"img/dispatch/fl/context/sysSt_un.png";if(18==a.type)return"img/dispatch/fl/context/sysE_un.png";if(19==a.type)return"img/dispatch/fl/context/python_un.png";if(20==a.type)return"img/dispatch/fl/context/shell_un.png";if(21==a.type)return"img/dispatch/fl/context/bat_un.png";if(22==a.type)return"img/dispatch/fl/context/rb_un.png";if(23==a.type)return"img/dispatch/fl/context/perl_un.png";if(24==a.type)return"img/dispatch/fl/context/webs_un.png";if(25==a.type)return"img/dispatch/fl/context/tcp_un.png";if(26==a.type)return"img/dispatch/fl/context/http_un.png";if(27==a.type)return"img/dispatch/fl/context/tux_un.png";if(28==a.type)return"img/dispatch/fl/context/cl_un.png";if(29==a.type)return"img/dispatch/fl/context/rpg_un.png";if(30==a.type)return"img/dispatch/fl/context/java_un.png";if(31==a.type)return"img/dispatch/fl/context/c_un.png";if(32==a.type)return"img/dispatch/fl/context/c++_un.png"}}))),n(go.Panel,"Auto",{margin:new go.Margin(8,6,4,48),width:62},n(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),n(go.Panel,"Auto",{alignment:go.Spot.TopRight,margin:new go.Margin(1,1,0,0)},new go.Binding("width","",function(a){return a.sd_job_bean.pre_job_list?"auto":0}),n(go.Picture,{width:14,height:8},new go.Binding("source","",function(a){return a.sd_job_bean.pre_job_list?"img/dispatch/fl/fl_pre.png":void 0}),new go.Binding("visible","",function(a){return 0!=a.sd_job_bean.pre_job_list.length}))),n(go.Panel,"Auto",{alignment:go.Spot.BottomLeft},n(go.Shape,"RoundedRectangle",{stroke:null,height:4},new go.Binding("width","",function(a){a.sd_job_bean=a.sd_job_bean||{};var b=a.sd_job_bean.width?a.sd_job_bean.width:0;return b}),new go.Binding("fill","",function(a){var b="";switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b="#9CB85F";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=""}return b})),new go.Binding("visible","",function(a){var b,c=a.sd_job_bean.job_status;return b=a.sd_job_bean&&(c>=2&&4>=c||7==c)?!0:!1}))))),i.nodeTemplateMap.add("3",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Spot",{width:100,height:50},n(go.Shape,"Rectangle",{fill:"#091016"},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=null}return b})),n(go.Picture,new go.Binding("source","",function(){return"img/dispatch/fl/context/condition.png"})),n(go.Panel,"Auto",{alignment:new go.Spot(0,0,50,48)},n(go.Shape,"RoundedRectangle",{fill:"#9CB85F",stroke:null,height:4,width:100}),new go.Binding("visible","",function(a){return 3==a.sd_job_bean.job_status}))))),i.nodeTemplateMap.add("4",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},n(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},n(go.Shape,"Rectangle",{fill:"#091016"},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=null}return b})),n(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/rep.png":"img/dispatch/fl/context/rep_un.png"})),n(go.Panel,"Auto",{alignment:new go.Spot(0,0,50,48)},n(go.Shape,"RoundedRectangle",{fill:"#9CB85F",stroke:null,height:4,width:100}),new go.Binding("visible","",function(a){return 3==a.sd_job_bean.job_status}))))),i.nodeTemplateMap.add("5",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},n(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},n(go.Shape,"Rectangle",{fill:"#091016"},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=null}return b})),n(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/stop.png":"img/dispatch/fl/context/stop_un.png"})),n(go.Panel,"Auto",{alignment:new go.Spot(0,0,50,48)},n(go.Shape,"RoundedRectangle",{fill:"#9CB85F",stroke:null,height:4,width:100}),new go.Binding("visible","",function(a){return 3==a.sd_job_bean.job_status}))))),i.nodeTemplateMap.add("1",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Auto",n(go.Shape,"Circle",{width:26,height:26,fill:"#091016",strokeWidth:2},new go.Binding("stroke","",function(a){var b="#CCCCCC";switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b="#9CB85F";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b="#CCCCCC"}return b}))))),i.nodeTemplateMap.add("2",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Auto",n(go.Shape,"Circle",{width:25,height:25,fill:null,strokeWidth:2},new go.Binding("stroke","",function(a){var b="#666666";switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b="#9CB85F";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b="#666666"}return b})),n(go.Panel,"Auto",n(go.Shape,"Circle",{width:14,height:14,fill:"#194C5A",stroke:null}))))),i.groupTemplateMap.add("6",n(go.Group,"Auto",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},{mouseDragEnter:function(a,b,c){d(a,b,!0)},mouseDragLeave:function(a,b,c){d(a,b,!1)},computesBoundsAfterDrag:!0,mouseDrop:f,handlesDragDropForMembers:!0,layout:n(go.GridLayout,{wrappingWidth:1/0,alignment:go.GridLayout.Position,cellSize:new go.Size(1,1),spacing:new go.Size(4,4)})},n(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),n(go.Panel,"Vertical",{margin:-2},n(go.Panel,"Horizontal",{stretch:go.GraphObject.Horizontal,background:"#1F3144",padding:4},n(go.Panel,"Auto",n(go.Shape,"Circle",{width:25,height:25,fill:"#091016",stroke:"#1F3144"}),n(go.TextBlock,{font:"14px Microsoft YaHei",opacity:.75,stroke:"#d2f1fe"},new go.Binding("text","grid",function(a){return 0!=a?(j=parseInt(a),a):j}).makeTwoWay())),n(go.TextBlock,{alignment:go.Spot.Left,editable:!0,margin:5,font:"14px Microsoft YaHei",opacity:.75,stroke:"#61a1b8"},new go.Binding("text","text").makeTwoWay())),n(go.Placeholder,{padding:20,alignment:go.Spot.TopLeft})))),i.linkTemplate=n(go.Link,n(go.Shape,{stroke:"gray",fill:"gray"}),n(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"}),n(go.Panel,"Auto",{visible:!1,name:"LABEL",segmentIndex:1},new go.Binding("visible","visible").makeTwoWay(),new go.Binding("segmentFraction","",function(a){return a.visible?k?(k=!1,.4):(k=!0,.85):void 0}),n(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"null"}),n(go.TextBlock,"判断条件",{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay()))),i.addDiagramListener("ChangedSelection",function(){}),i.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,i.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,h(),i.doFocus=m}function g(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#999999":null})}function h(){i.model=go.Model.fromJson(a.model)}var i,j=0;a.selectNode={};var k=!1;f(),$("#myDiagramDiv > div").css("overflow","hidden"),a.$watch("nodeSelected",function(a,b){a!==b&&i.clearSelection()}),a.$watch("model.nodeDataArray",function(){i.startTransaction("change node");for(var b=0;b<a.model.nodeDataArray.length;b++){var d=a.model.nodeDataArray[b];if(3!=d.type){var e=d.sd_job_bean?d.sd_job_bean:{};if(e.job_status&&1!=e.job_status){3==e.job_status?(e.width=d.type>3&&d.type<6?100:120,c.cancel(e.timer)):(2==e.job_status||4==e.job_status||7==e.job_status)&&e.width&&e.width>=105&&(e.width=110,c.cancel(e.timer));var f=i.findNodeForData(d);f&&f.updateTargetBindings("")}}}i.commitTransaction("change node")},!0)}}}]),cvDirectives.directive("ngEnter",["$compile",function(a){return{restrict:"AE",link:function(a,b,c,d){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}}]),cvDirectives.filter("getNameFilter",["$sce",function(a){return function(a){for(var b=0;b<a.length;b++)if(a[b].flag)return a[b].user_cn_name}}]),cvDirectives.directive("dragMonitor",["$compile","$timeout","Modal",function(a,b,c){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",group:"=groupData",read_only:"=readOnly",node_length:"=nodeLength"},link:function(a,d,e,f){function g(b){var d=a.group.proj_list[b.data.row-1].phase_list[b.data.col-1];c.viewPhaseSoc(d).then(function(){})}function h(a){var b=a.subject,c=b.fromNode.isLinkLabel||b.toNode.isLinkLabel;a.diagram.model.setCategoryForLinkData(b.data,c?"linkToLink":"")}function i(){function c(b,c){for(var d=!0,e=0;e<a.model.linkDataArray.length;e++){var f=a.model.linkDataArray[e];f.from==c.data.key&&f.to==b.data.key&&(d=!1)}return b.data.row==c.data.row&&(d=!1),d}function e(){return[{cursor:"pointer",deletable:!1,fromLinkable:!0,toLinkable:!0,mouseEnter:function(a,b){j(b.part,!0)},mouseLeave:function(a,b){j(b.part,!1)},linkValidation:function(a,b,d,e,f){return c(a,d)},click:function(a,b){b.part.stroke="#CCCCCC",g(b)}}]}function f(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var i=go.GraphObject.make;p=i(go.Diagram,d.children().attr("id"),{initialContentAlignment:go.Spot.TopLeft,allowMove:!0,allowDrop:!1,ChangedSelection:m,"undoManager.isEnabled":!0,LinkDrawn:h,LinkRelinked:h,"animationManager.isEnabled":!1,allowVerticalScroll:!1,allowHorizontalScroll:!0,allowZoom:!1,isReadOnly:a.read_only,layout:i(go.GridLayout,{wrappingColumn:1,cellSize:new go.Size(1,1),spacing:new go.Size(1,1),alignment:go.GridLayout.Position,comparer:function(a,b){var c=a.location.y,d=b.location.y;return isNaN(c)||isNaN(d)?0:d>c?-1:c>d?1:0}})}),p.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=p.model.nodeDataArray,a.model.linkDataArray=p.model.linkDataArray}),p.addDiagramListener("SelectionDeleting",function(a){var c={from:p.selection.first().data.from,to:p.selection.first().data.to,statue:p.selection.first().data.statue,extra_flag:p.selection.first().data.extra_flag};c.extra_flag===!1&&b(function(){p.startTransaction("add node and link"),p.model.addLinkData(c),p.commitTransaction("add node and link")},10)}),p.addModelChangedListener(function(b){b.isTransactionFinished&&(p.model.nodeDataArray=a.model.nodeDataArray,p.model.linkDataArray=a.model.linkDataArray)}),p.nodeTemplateMap.add("noExecute",i(go.Node,"Vertical",e(),i(go.Shape,"Circle",{width:19,height:19},new go.Binding("fill","status",function(a){return 1==a?"#6d7183":3==a?"#de6d69":6==a?"#FC9E47":5==a?"#89D098":"#de6d69"}),new go.Binding("stroke","status",function(a){return 1==a?"#6d7183":3==a?"#de6d69":6==a?"#FC9E47":5==a?"#89D098":"#de6d69"})))),p.nodeTemplateMap.add("executing",i(go.Node,"Vertical",e(),i(go.Panel,new go.Binding("itemArray","slices"),{itemTemplate:i(go.Panel,i(go.Shape,{fill:"lightgreen",isGeometryPositioned:!0,strokeWidth:0},new go.Binding("fill","color"),new go.Binding("geometry","",n)))}),i(go.TextBlock,{margin:new go.Margin(-27,0,0,0)},new go.Binding("text","dynamic")))),p.groupTemplateMap.add("OfGroups",i(go.Group,"Vertical",{selectable:!1,deletable:!1,width:60,height:140},i(go.Panel,"Auto",{width:40,height:40},i(go.Shape,"RoundedRectangle",{fill:"transparent",stroke:null}),i(go.Placeholder,{padding:1})),i(go.TextBlock,{alignment:go.Spot.Right,font:"9pt Sans-Serif",angle:45,stroke:"rgba(109, 113, 131, 0.53)"},new go.Binding("text","test")))),p.groupTemplateMap.add("OfNodes",i(go.Group,"Vertical",{layout:i(go.TreeLayout,{layerSpacing:20}),selectionAdorned:!1,selectable:!0,deletable:!1,dragComputation:k},i(go.Panel,"Auto",i(go.Shape,"Rectangle",{fill:"#141e2a",stroke:null,width:q}),i(go.Placeholder,{margin:2,background:"transparent",alignment:go.Spot.Left})))),p.linkTemplate=i(go.Link,{reshapable:!0,resegmentable:!0,relinkableFrom:!0,relinkableTo:!0,adjusting:go.Link.Stretch},i(go.Shape,{fill:"#44dcfd",stroke:"#44dcfd"},new go.Binding("stroke","statue",function(a){return 1!=a&&3!=a?"#44dcfd":"gray"}).makeTwoWay(),new go.Binding("fill","statue",function(a){return 1!=a&&3!=a?"#44dcfd":"gray"}).makeTwoWay()),i(go.Shape,{toArrow:"Standard"},new go.Binding("stroke","",function(a){return a.statue&&(1==a.statue||3==a.statue)?"gray":"#44dcfd"}).makeTwoWay(),new go.Binding("fill","",function(a){return a.statue&&(1==a.statue||3==a.statue)?"gray":"#44dcfd"}).makeTwoWay())),p.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=p.model.nodeDataArray,a.model.linkDataArray=p.model.linkDataArray}),p.toolManager.linkingTool.temporaryLink.routing=go.Link.Normal,p.toolManager.relinkingTool.temporaryLink.routing=go.Link.Normal,l(),p.doFocus=f}function j(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#999999":null})}function k(a,b,c){return new go.Point(b.x,a.location.y)}function l(){p.model=go.Model.fromJson(a.model)}function m(b){p.model.selectedNodeData=null;for(var c=p.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){p.model.selectedNodeData=d.data;break}}a.$applyAsync()}function n(a){return(new go.Geometry).add(new go.PathFigure(a.radius,a.radius).add(new go.PathSegment(go.PathSegment.Arc,a.start,a.sweep,a.center,a.center,a.radius,a.radius).close()))}var o=150*a.group.proj_list.length+"px";d.css("height",o),d.children().css("height",o);var p,q=75*a.node_length;a.$watch("model",function(){d.children().attr("id")&&l()},!0),i(),d.children().children().next().css("overflow","hidden")}}}]),cvDirectives.directive("fileTree",["$timeout","treeConfig","ReleaseFileType","CV",function(a,b,c,d){return{restrict:"E",scope:{files:"=",changePath:"&",getFileContent:"&",dbFile:"&",go:"&",commonControl:"=",compareConfig:"="},templateUrl:"templates/directives/file_tree.html",controller:["$scope",function(a){this.scope=a}],link:function(e,f,g){b.defaultCollapsed=!0,e.control={alter_flag:!1,diff_flag:!1},e.common_control=e.commonControl||{},e.control.alter_flag=g.alter?!0:!1,e.control.diff_flag=g.diff?!0:!1,e.tree_config=e.compareConfig?angular.extend({compare_mode:!1,status:""},e.compareConfig):{compare_mode:!1,status:""};var h=function(){e.changePath&&!e.files.no_init_flag&&"right"!=e.tree_config.status?(e.files.loading=!0,e.changePath().then(function(a){return a&&a.message?(e.files.loading=!1,void(e.err_msg=a.message)):(e.files.nodes=a?a:[],e.data=e.files.nodes,e.files.curr_file=angular.extend(e.files.curr_file,{file_count:e.data.length,dir:!0}),e.files.loading=!1,e.getFileContent&&e.getFileContent(),void(e.tree_config.compare_mode&&i()))})):e.data=e.files.nodes};e.getMoreFile=function(a){var b=a.$modelValue;a.toggle(),a.files.curr_fold_path=(b.file_path?b.file_path:b.tar_path)+"/"+b.file,!b.dir||b.nodes||a.collapsed?(a.files.curr_file={file_path:b.file_path?b.file_path:b.tar_path,file:b.file,file_count:b.nodes?b.nodes.length:0,size:b.file_size,dir:!0,relate_path:b.relate_path,modify_time:b.modify_time},a.getFileContent&&a.getFileContent()):(a.files.curr_file.relate_path=b.relate_path?b.relate_path:b.file+"/",b.loading=!0,a.changePath().then(function(c){b.nodes=c?c:[],0==b.nodes.length&&a.toggle(),b.loading=!1,a.files.curr_file=angular.extend(a.files.curr_file,{file_count:b.nodes.length,relate_path:b.relate_path}),a.getFileContent&&a.getFileContent()}))},e.getFileTarget=function(a){var b,e=a.$modelValue;b=a.tree_config.compare_mode?-1==e.name.lastIndexOf(".")?0:d.findKey(e.name.substring(e.name.lastIndexOf(".")+1),c):-1==e.file.lastIndexOf(".")?0:d.findKey(e.file.substring(e.file.lastIndexOf(".")+1),c),a.files.curr_file={file_path:e.file_path?e.file_path:e.tar_path,file:e.file,file_type:b,size:e.file_size,dir:!1,relate_path:e.relate_path,modify_time:e.modify_time},a.getFileContent&&a.getFileContent()},e.fileDbClick=function(a){var b=a.$modelValue,f=-1==b.name.lastIndexOf(".")?0:d.findKey(b.name.substring(b.name.lastIndexOf(".")+1),c);!f||2==f||3==f||f>8&&14>f||(e.files.compare_path1=b.path1?b.path1:"",e.files.compare_path2=b.path2?b.path2:"",e.dbFile())},e.getcompareFiles=function(a){var b=a.$modelValue;e.files.temp=null,e.files.curr_fold_path=b.path1?b.path1:b.path2,e.go(),b.isfile||b.nodes||a.collapsed?(e.files.curr_file={file_path:b.path1?b.path1:b.path2,file:b.file,file_count:b.nodes?b.nodes.length:0,size:b.file_size,dir:!0,modify_time:b.modify_time},e.getFileContent&&e.getFileContent(),i()):(e.common_control.disabled_control=!0,e.files.compare_path1=b.path1?b.path1:"",e.files.compare_path2=b.path2?b.path2:"",b.loading=!0,e.files.temp=b,e.go(),e.changePath().then(function(a){b.nodes=a?a:[],b.loading=!1,e.files.curr_file=angular.extend(e.files.curr_file,{file_count:b.nodes.length}),e.files.temp=b,e.go(),e.getFileContent&&e.getFileContent(),i(),e.common_control.disabled_control=!1}))};var i=function(){a(function(){var a=0;$(".tree-content").html("");var b=f.height();a=Math.ceil(parseInt(b)/22);for(var c="",d=0;a>d;d++)c+=d%2==0?'<div style="height:22px;background:transparent"></div>':'<div style="height:22px;background:rgba(37,53,73,0.25);"></div>';$(".tree-content").html(c)},100)};h()}}}]),cvDirectives.directive("compareTree",["$timeout","treeConfig","ReleaseFileType","CV",function(a,b,c,d){return{restrict:"A",require:"^fileTree",link:function(a,b,c,d){var e=c.compareTree;a.$on(e,function(b,c){if(c){var d=a.$modelValue;d.loading=c.loading,d.nodes=c.nodes}else a.toggle()})}}}]),cvDirectives.directive("treeLine",["$timeout",function(a){return{restrict:"A",require:"ngModel",controller:["$scope","$element","$attrs",function(a,b,c){this.scope=a}],link:function(a,b,c,d){var e=c.treeLine;a.countHeight=function(){for(var a=d.$modelValue,c="left"==e?"right":"left",f=b.children("li"),g=a.length-1;g>=0;g--){if(a[g].status!=c){f.eq(g).children("ol").children(".ui-tree-cover").css({display:"block"});break}f.eq(g).children(".ui-tree-fold-line").css({display:"none"})}}}}}]),cvDirectives.directive("repeatFinish",function(){return{restrict:"A",require:"^?treeLine",link:function(a,b,c,d){1==a.$last&&d.scope.countHeight()}}}),cvDirectives.directive("versionTree",["$compile","$timeout","Modal",function(a,b,c){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",linkLength:"=linkLength",changeVersion:"&changeVersion"},link:function(a,c,d,e){function f(a){var b=a.subject,c=b.fromNode.isLinkLabel||b.toNode.isLinkLabel;a.diagram.model.setCategoryForLinkData(b.data,c?"linkToLink":"")}function g(b){for(var c=0;c<l.model.nodeDataArray.length;c++){var d=l.model.nodeDataArray[c];if("node"==d.category&&d.select){l.startTransaction("change node"),d.select=!1;var b=l.findNodeForData(d);null!==b&&b.updateTargetBindings(""),l.commitTransaction("change node")}}l.startTransaction("change node"),l.model.selectedNodeData&&(l.model.selectedNodeData.select=!0);var b=l.findNodeForData(l.model.selectedNodeData);null!==b&&b.updateTargetBindings(""),l.commitTransaction("change node"),a.changeVersion({key:b.data.vsversion_id})}function h(){function b(){return[{cursor:"pointer",deletable:!1,selectionAdorned:!1,locationSpot:go.Spot.Center,fromLinkable:!0,toLinkable:!0,linkValidation:function(a,b,c,d,e){return validateLink(a,c)},click:function(a,b){"#FC9E22"==b.data.color?g(b):(e(b,l),c.find("#mask").css("display","block"))}}]}function d(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}function e(a,b,c){if(a&&"#44dcfd"==a.data.color){document.getElementById("proj_cn_name").innerHTML=a.data.proj_cn_name||"--",document.getElementById("vsversion_id").innerHTML=a.data.vsversion_id||"--",document.getElementById("operasion_user_name").innerHTML=a.data.operasion_user_name||"--",document.getElementById("date_time").innerHTML=a.data.date_time||"--",n.style.display="block";var d=b.lastInput.viewPoint;n.style.left=d.x-39+"px",n.style.top=d.y+33+"px"}}var h=go.GraphObject.make;l=h(go.Diagram,"versionDiagram",{initialContentAlignment:go.Spot.TopLeft,allowMove:!0,allowDrop:!1,ChangedSelection:k,"undoManager.isEnabled":!0,LinkDrawn:f,LinkRelinked:f,"animationManager.isEnabled":!1,allowVerticalScroll:!0,allowHorizontalScroll:!1,allowZoom:!1,"toolManager.mouseWheelBehavior":go.ToolManager.WheelNone,isReadOnly:!0});var n=document.getElementById("nodeDetail"),o=h(go.HTMLInfo,{show:e,mainElement:n});l.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=l.model.nodeDataArray,a.model.linkDataArray=l.model.linkDataArray}),l.nodeTemplateMap.add("node",h(go.Node,"Vertical",b(),{contextMenu:o},h(go.Panel,"Auto",h(go.Shape,"Circle",{width:24,height:24,isGeometryPositioned:!0,fill:"#091016",stroke:"#666666",strokeWidth:2},new go.Binding("stroke","color").makeTwoWay()),h(go.Panel,"Auto",h(go.Shape,"Circle",{width:18,height:18,isGeometryPositioned:!0,fill:"#091016",stroke:null},new go.Binding("fill","select",function(a){return a?"#FC9E22":"#091016"})))))),l.groupTemplateMap.add("OfNodes",h(go.Group,"Vertical",{selectionAdorned:!1,alignment:go.Spot.Center,width:300,selectable:!1,deletable:!1,dragComputation:i},h(go.Panel,"Auto",{alignment:go.Spot.Center},h(go.Shape,"RoundedRectangle",{fill:"transparent",stroke:null,alignment:go.Spot.Center}),h(go.Placeholder,{padding:30})),h(go.TextBlock,{alignment:go.Spot.Center,width:150,margin:new go.Margin(-62,-180,0,0),font:"bold 12pt helvetica, arial, sans-serif",stroke:"#d2f1fe"},new go.Binding("text","version_number").makeTwoWay()),h(go.TextBlock,{alignment:go.Spot.Center,width:150,margin:new go.Margin(4,-180,0,0),font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe"},new go.Binding("text","date_time").makeTwoWay()),h(go.TextBlock,{alignment:go.Spot.Center,width:150,margin:new go.Margin(-63,-180,0,0),font:"10pt helvetica, arial, sans-serif",stroke:"#61a1b8"},new go.Binding("text","proj_cn_name").makeTwoWay(),new go.Binding("visible","proj_cn_name",function(a){return""==a?!1:!0}).makeTwoWay()))),l.groupTemplateMap.add("OfGroups",h(go.Group,"Vertical",{selectable:!1,selectionAdorned:!0,deletable:!1,dragComputation:i,layout:h(go.TreeLayout,{angle:270}),width:130},h(go.Panel,"Auto",{width:60,height:40,margin:new go.Margin(0,-6,0,0)},h(go.TextBlock,{font:"10pt helvetica, arial, sans-serif"},new go.Binding("text","data"),new go.Binding("stroke","color").makeTwoWay())),h(go.Shape,"TriangleUp",{width:17,height:17},new go.Binding("fill","color").makeTwoWay(),new go.Binding("stroke","color").makeTwoWay()),h(go.Panel,"Auto",{width:3,height:m},h(go.Shape,"RoundedRectangle",new go.Binding("fill","color").makeTwoWay(),new go.Binding("stroke","color").makeTwoWay()),h(go.Placeholder,{padding:1})))),l.linkTemplate=h(go.Link,{reshapable:!0,resegmentable:!0,selectable:!1,relinkableFrom:!0,relinkableTo:!0,adjusting:go.Link.Stretch},h(go.Shape,{strokeWidth:2,stroke:"#61a1b8",fill:"#61a1b8"}),h(go.Shape,{toArrow:"Standard",stroke:null,scale:1.6,fill:"#61a1b8"})),l.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=l.model.nodeDataArray,a.model.linkDataArray=l.model.linkDataArray}),l.toolManager.linkingTool.temporaryLink.routing=go.Link.Normal,l.toolManager.relinkingTool.temporaryLink.routing=go.Link.Normal,j(),l.doFocus=d,l.contextMenu=o,n.addEventListener("contextmenu",function(a){return a.preventDefault(),!1},!1);var p=document.getElementById("mask");p.addEventListener("click",function(a){n.style.display="none",p.style.display="none"},!1)}function i(a,b,c){return new go.Point(a.location.x,b.y)}function j(){l.model=go.Model.fromJson(a.model)}function k(b){l.model.selectedNodeData=null;for(var c=l.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){l.model.selectedNodeData=d.data;break}}a.$applyAsync()}var l,m=a.linkLength;b(function(){h(),c.children().children().next().css("overflow","hidden")},200)}}}]),cvDirectives.filter("getProjStateGreaterThanThree",[function(){return function(a){for(var b=[],c=0;c<a.length;c++)a[c].sys_publish_status<4&&a[c].sys_publish_status>1&&b.push(a[c]);return b}}]),cvDirectives.directive("customScroll",["$timeout",function(a){return{restrice:"EA",replace:!0,link:function(b,c,d){a(function(){var a,e=d.customConfig;if(e&&(a=b.$eval(e)),d.callbacks?a&&(a.callbacks=b[d.callbacks]):a&&(a.callbacks=!1),c.mCustomScrollbar(a),d.func){var f=b.$eval(d.func);f.scroll&&(b[f.scroll]=function(a,b){c.mCustomScrollbar("scrollTo",a,b)}),f.stop&&(b[f.stop]=function(){c.mCustomScrollbar("stop")})}})}}}]),cvDirectives.directive("scrollControl",[function(){return{restrice:"EA",template:"",replace:!0,link:function(a,b,c){b.bind("mouseover",function(){$("._mCS1").mCustomScrollbar("disable")}),b.bind("mouseleave",function(){$("._mCS1").mCustomScrollbar("update")})}}}]),cvDirectives.directive("ngRightClick",["$parse",function(a){return{restrict:"AE",link:function(b,c,d,e){var f=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),f(b,{$event:a})})})}}}]),cvDirectives.directive("structDrag",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=nodeLinkData",palette:"=paletteData",config:"&config",save:"&save",node:"=node",reflash:"=reflash",clear:"=clear",cancel:"&cancel"},link:function(a,b,c,d){function e(){go.TreeLayout.call(this)}function f(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,cursor:"pointer",mouseEnter:function(a,b){g(b.part,!0)},mouseLeave:function(a,b){g(b.part,!1)},click:function(b,c){c.part.stroke="#CCCCCC",a.config({key:c.data}),l()}}]}function c(){return[{mouseEnter:function(a,b){b.part.stroke="#4A90E2",b.part.strokeWidth=1},mouseLeave:function(a,b){b.part.stroke="transparent",b.part.strokeWidth=1}}]}function d(a,b,c){var d=!0;return d}function e(a,b,c,d,e){return m(go.Shape,"Circle",{fill:"#172230",stroke:"#1D3D4F",desiredSize:new go.Size(8,8),alignment:b,
alignmentFocus:b,portId:a,fromSpot:b,toSpot:b,fromLinkable:c,toLinkable:d,cursor:"pointer"},new go.Binding("visible","",function(a){return!0}))}function f(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var m=go.GraphObject.make;j=m(go.Diagram,"structDiagramDiv",{initialContentAlignment:go.Spot.TopCenter,"grid.visible":!1,allowMove:!0,allowDrop:!0,ChangedSelection:i,"animationManager.duration":800,"undoManager.isEnabled":!0,allowVerticalScroll:!0,allowHorizontalScroll:!0,allowZoom:!1,autoScale:go.Diagram.UniformToFill}),j.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=j.model.nodeDataArray,a.model.linkDataArray=j.model.linkDataArray}),j.nodeTemplateMap.add("cNode",m(go.Node,"Spot",b(),{linkValidation:function(a,b,c,e,f){return d(a,c,b)}},m(go.Panel,"Auto",m(go.Shape,"Rectangle",{fill:"#091016",cursor:"pointer",stroke:"#1D3D4F",strokeWidth:1,width:200,height:80}),m(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},m(go.Picture,{width:38,height:34,background:"transparent"},new go.Binding("source","",function(a){if(a.config_flag){if(1==a.logical_node_type)return"img/public/struct/custom_impl_c.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_c.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_c.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_c.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_c.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_c.png"}else{if(1==a.logical_node_type)return"img/public/struct/custom_impl_u.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_u.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_u.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_u.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_u.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_u.png"}}))),m(go.Panel,"Auto",{margin:new go.Margin(0,0,0,50),width:100,alignment:go.Spot.Left},m(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),m(go.Panel,"Auto",{margin:new go.Margin(30,0,0,50),alignment:go.Spot.Left},m(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("visible","visible").makeTwoWay()))),e("T",go.Spot.Top,!0,!0),e("B",go.Spot.Bottom,!0,!1))),j.linkTemplate=m(go.Link,m(go.Shape,{stroke:"gray",fill:"gray"}),m(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"})),j.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=j.model.nodeDataArray,a.model.linkDataArray=j.model.linkDataArray}),j.addDiagramListener("SelectionDeleted",function(){a.cancel()}),j.addDiagramListener("BackgroundSingleClicked",function(){a.cancel()}),j.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,j.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,h();var n=m(go.Palette,"myPaletteDiv",{padding:new go.Margin(0,0,0,0)},{initialDocumentSpot:go.Spot.Left,initialContentAlignment:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,"animationManager.duration":800,model:new go.GraphLinksModel(k.webPalette),allowResize:!0,mouseDragOver:function(){}});n.nodeTemplate=m(go.Node,"Vertical",{locationSpot:go.Spot.Left,selectionAdorned:!1,width:84,height:84},m(go.Panel,"Vertical",m(go.Picture,{width:38,height:38,margin:new go.Margin(20,0,0,0),cursor:"pointer",background:"transparent"},new go.Binding("source","logical_node_type",function(a){return 1==a?"img/public/struct/custom_impl_c.png":2==a?"img/public/struct/was_impl_c.png":3==a?"img/public/struct/weblogic_impl_c.png":4==a?"img/public/struct/sql_impl_c.png":5==a?"img/public/struct/as400_impl_c.png":6==a?"img/public/struct/svn_impl_c.png":void 0})),m(go.TextBlock,"Yes",{textAlign:"center",font:"12px Microsoft YaHei",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay())),c()),j.doFocus=f}function g(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#d2f1fe":null})}function h(){j.model=go.Model.fromJson(a.model)}function i(b){j.model.selectedNodeData=null;for(var c=j.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){j.model.selectedNodeData=d.data;break}}a.$applyAsync()}var j,k=a.palette;a.selectNode={},go.Diagram.inherit(e,go.TreeLayout),a.$watch("reflash",function(){if(j.startTransaction("change node"),j.model.selectedNodeData)for(var b=0;b<a.model.nodeDataArray.length;b++)if(a.model.nodeDataArray[b].key==j.model.selectedNodeData.key){a.model.nodeDataArray[b].text=a.model.nodeDataArray[b].basic_msg.node_name,j.model.selectedNodeData=a.model.nodeDataArray[b];var c=j.findNodeForData(j.model.selectedNodeData);null!==c&&c.updateTargetBindings("")}j.commitTransaction("change node")},!0),f();var l=function(){var a=.7*$("#structDiagramDiv").height()+"px";$(".configDiv").css("width",$("#structDiagramDiv").width()-8),$(".configDiv").css("display","inherit"),$(".configDiv").animate({height:a},500)},m=function(){$(".configDiv").css("width",$("#structDiagramDiv").width()-8)};m(),$(window).resize(m),$("#structDiagramDiv > div").css("overflow","hidden"),$("#myPaletteDiv > div").css("overflow","hidden"),a.$watch("clear",function(){j.model.selectedNodeData&&j.clearSelection()},!0),a.save=function(){}}}}]),cvDirectives.directive("envDrag",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=nodeLinkData",palette:"=paletteData",config:"&config",save:"&save",node:"=node",reflash:"=reflash",clear:"=clear",cancel:"&cancel"},link:function(a,c,d,e){function f(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,cursor:"pointer",mouseEnter:function(a,b){},mouseLeave:function(a,b){},click:function(b,c){c.part.stroke="#CCCCCC",a.config({key:c.data}),i()}}]}function c(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var d=go.GraphObject.make;k=d(go.Diagram,"envDiagramDiv",{initialContentAlignment:go.Spot.TopCenter,"grid.visible":!1,allowMove:!0,allowDrop:!0,ChangedSelection:h,"animationManager.duration":800,"undoManager.isEnabled":!1,allowCopy:!1,allowDelete:!1,autoScale:go.Diagram.UniformToFill,layout:d(go.TreeLayout,{treeStyle:go.TreeLayout.StyleLastParents,arrangement:go.TreeLayout.ArrangementHorizontal,angle:90,layerSpacing:35,alternateNodeSpacing:20})}),k.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=k.model.nodeDataArray,a.model.linkDataArray=k.model.linkDataArray}),k.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=k.model.nodeDataArray,a.model.linkDataArray=k.model.linkDataArray}),k.addDiagramListener("SelectionDeleted",function(){a.cancel()}),k.addDiagramListener("BackgroundSingleClicked",function(){a.cancel()}),k.nodeTemplateMap.add("cNode",d(go.Node,"Spot",b(),d(go.Panel,"Auto",d(go.Shape,"Rectangle",{fill:"#091016",cursor:"pointer",stroke:"#1D3D4F",strokeWidth:1,width:200,height:80}),d(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},d(go.Picture,{width:38,height:34},new go.Binding("source","",function(a){if(a.config_flag){if(1==a.logical_node_type)return"img/public/struct/custom_impl_c.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_c.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_c.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_c.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_c.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_c.png"}else{if(1==a.logical_node_type)return"img/public/struct/custom_impl_u.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_u.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_u.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_u.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_u.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_u.png"}}))),d(go.Panel,"Auto",{margin:new go.Margin(0,0,0,50),width:100,alignment:go.Spot.Left},d(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),d(go.Panel,"Auto",{margin:new go.Margin(30,0,0,50),alignment:go.Spot.Left},d(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#72a0f1"},new go.Binding("visible","visible").makeTwoWay()))))),k.linkTemplate=d(go.Link,d(go.Shape,{stroke:"gray",fill:"gray"}),d(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"})),k.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,k.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,g(),k.doFocus=c}function g(){k.model=go.Model.fromJson(a.model)}function h(b){k.model.selectedNodeData=null;for(var c=k.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){k.model.selectedNodeData=d.data;break}}a.$applyAsync()}function i(){var a=.7*$("#envDiagramDiv").height()+"px";$(".config-properties-container").animate({height:a},400)}function j(){var a=$("#config-page-container").height();if(a&&$("#envDiagramDiv").height(a-72),$(".config-properties-container").height()>10){var b=.7*$("#envDiagramDiv").height();$(".config-properties-container").height(b)}}var k;j(),$(window).resize(function(){b(function(){j()},500)}),a.$watch("reflash",function(){if(k.startTransaction("change node"),k.model.selectedNodeData)for(var b=0;b<a.model.nodeDataArray.length;b++)if(a.model.nodeDataArray[b].key==k.model.selectedNodeData.key){a.model.nodeDataArray[b].config_flag=!0,k.model.selectedNodeData=a.model.nodeDataArray[b];var c=k.findNodeForData(k.model.selectedNodeData);null!==c&&c.updateTargetBindings("")}k.commitTransaction("change node")},!0),a.$watch("clear",function(){k.model.selectedNodeData&&k.clearSelection()}),f()}}}]),cvDirectives.directive("resizeHeight",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",link:function(a,c,d,e){var f,g=!1,h="",i=d.resizeHeight,j=$(c).prepend("<div class='resize-ball'></div>")[0].firstElementChild,k=0;$(j).on("mousedown",function(a){k=parseFloat($(c).css("height")),f=parseFloat($(".resize-parent").css("height")),h=a.clientY,g=!0,$(j).addClass("resize-mask")}),$(document).on("mousemove",function(a){if(g){var d="",e=k+(h-a.clientY);d&&b.cancel(d),d=b(function(){i>e?e=i:e>f&&(e=f),$(c).css("height",e+"px")},50)}}),$(document).on("mouseup",function(a){g=!1,$(j).removeClass("resize-mask")})}}}]),cvDirectives.directive("cycleProgress",["$compile",function(a){return{restrict:"AE",scope:{percent:"=percent",fontSize:"@fontSize"},link:function(b,c,d,e){function f(){s.save(),s.beginPath(),s.lineWidth=n;var a=w-s.lineWidth;s.lineCap="round",s.strokeStyle="#44515A",s.arc(w,x,a,0,2*Math.PI,!1),s.stroke(),s.closePath(),s.restore()}function g(a){s.save(),s.fillStyle="#fff",s.font=j+"px Helvetica";var b=s.measureText(a.toFixed(0)+"%").width;s.fillText(a.toFixed(0)+"%",w-b/2,x+j/2),s.restore()}function h(a){s.save(),s.strokeStyle=t,s.lineWidth=n,s.lineCap="round";var b=w-s.lineWidth;s.beginPath(),s.arc(w,x,b,-Math.PI/2,-Math.PI/2+a*u,!1),s.stroke(),s.closePath(),s.restore()}var i=b.percent||0,j=b.fontSize||12,k=d.showText,l=d.width||100,m=d.height||100,n=d.circleWidth||10,o="<canvas width="+l+" height="+m+"></canvas>";c.append(a(o)(b));var p=c.find("canvas"),q=p.width=l||34,r=p.height=m||34,s=p.get(0).getContext("2d"),t=s.createLinearGradient(0,0,q,0),u=2*Math.PI/100,v=0,w=q/2,x=r/2;t.addColorStop(0,"#24f7a6"),t.addColorStop(1,"#3dd4fe"),function y(){s.clearRect(0,0,q,r),f(),k||g(v),h(v),v>=i||(v+=1,window.requestAnimationFrame(y))}()}}}]),cvDirectives.directive("slideFollow",["$compile","$timeout",function(a,b){return{restrict:"AE",scope:{scrollHeight:"=scrollHeight",scrollNumber:"=scrollNumber",scrollDate:"=scrollDate",scrollIndex:"=scrollIndex"},link:function(a,c,d){b(function(){var b,d=a.scrollIndex||0,e=a.scrollDate.length,f=function(){parseInt($(c).css("top"))>-e*parseInt(a.scrollHeight)?(d++,$(c).animate({top:-parseInt(a.scrollHeight)*d+"px"},2e3)):(d=1,$(c).css("top","0px"),$(c).animate({top:-parseInt(a.scrollHeight)+"px"},2e3))};a.scrollDate.length>a.scrollNumber&&(b=setInterval(f,5e3),$(c).hover(function(){clearInterval(b)},function(){clearInterval(b),b=setInterval(f,5e3)})),a.$watch("scrollDate.length",function(a){a>5&&!b&&(b=setInterval(f,5e3)),e=a})},0)}}}]),cvDirectives.directive("showDate",["$compile","$interval","$timeout",function(a,b,c){return{restrict:"AE",scope:{dateList:"=",slideIndex:"="},link:function(a,b,d){c(function(){var d,e,f,g,h,i,j,k,l=a.slideIndex||0,m=a.slideIndex||0;k=a.dateList[a.slideIndex].execute_faile?a.dateList[a.slideIndex].execute_faile:!1,j=a.dateList.length,h=$(b).children("#header_block").children(".sys-list"),i=$(b).children("#body_block").children(".slide-container"),e=$(b).children("#body_block").width(),i.css({width:e*j*2+"px","margin-left":-(m*e)+"px",display:"flex"}),i.children(".sys-monitor-detail").css({width:e+"px"}),d=270;var n=function(a){var b=a||5e3;g&&clearInterval(g),f&&clearInterval(f),j>1&&(g=setInterval(p,b)),j>5&&(f=setInterval(o,b))},o=function(){parseInt(h.css("margin-left"))>-j*parseInt(d)?(l++,h.animate({marginLeft:-parseInt(d)*l+"px"},2e3)):(l=1,h.css("margin-left","0px"),h.animate({marginLeft:-parseInt(d)+"px"},2e3))},p=function(){parseInt(i.css("margin-left"))>-j*parseInt(e)?(m++,i.animate({marginLeft:-parseInt(e)*m+"px"},2e3)):(m=1,i.css("margin-left","0px"),i.animate({marginLeft:-parseInt(e)+"px"},2e3)),a.slideIndex==j-1?a.slideIndex=0:a.slideIndex=m,a.dateList[a.slideIndex]&&(k=a.dateList[a.slideIndex].execute_faile),k?n(1e4):n()};k?n(1e4):n(),$(b).hover(function(){g&&clearInterval(g),f&&clearInterval(f)},function(){n()}),a.$watch("dateList.length",function(a){j=a,c(function(){i.css({width:e*j*2+"px","margin-left":-(m*e)+"px",display:"flex"}),i.children(".sys-monitor-detail").css({width:e+"px"})},0),n()})},0)}}}]),cvDirectives.directive("merryGoRound",["$compile","$interval","$timeout",function(a,b,c){return{restrict:"AE",scope:{data:"=data"},link:function(a,d,e){c(function(){function c(a,b,c,d,e){a.beginPath(),a.save(),a.ellipse(b,c,d,e,0,-.29*Math.PI,1.29*Math.PI,!1);var f=a.createLinearGradient(-b*Math.cos(.8*Math.PI),-c*Math.sin(.8*Math.PI/180),Math.cos(1.28*Math.PI),Math.sin(1.28*Math.PI));f.addColorStop(0,"#2FC5E2"),f.addColorStop(1,"#54ED9A"),a.strokeStyle=f,a.stroke(),a.restore()}function e(){for(var b=0;b<s.length;b++){var c=s[b];360==c.angle&&(c.angle=0),c.angle=c.angle+t;var d=c.angle*(Math.PI/180);c.x=l+n*Math.cos(d)-c.w/2,c.y=m+o*Math.sin(d)-c.h/2;var e=i(c,.1,1);c.ball_color=z(a.data[b].project_status),v.beginPath(),v.save(),v.globalAlpha=.35,v.arc(c.x,c.y+c.w/2,15*e,0,2*Math.PI,!1);var f=v.createRadialGradient(c.x,c.y+c.w/2,0,c.x,c.y+c.w/2,15);f.addColorStop(0,"transparent"),f.addColorStop(1,c.ball_color),v.fillStyle=f,v.fill(),v.restore(),v.beginPath(),v.save(),v.globalAlpha=e,v.fillStyle=c.ball_color,v.arc(c.x,c.y+c.w/2,c.w*e,0,2*Math.PI,!1),v.fill(),v.moveTo(c.x,c.y+c.w/2);var g=(c.x-c.x)*Math.cos(p*Math.PI/180)-(c.y+c.w/2+20-c.y+c.w/2)*Math.sin(p*Math.PI/180)+c.x,h=(c.x-c.x)*Math.sin(p*Math.PI/180)+(c.y+c.w/2+20-c.y+c.w/2)*Math.cos(p*Math.PI/180)+c.y+c.w/2;v.lineTo(g,h),v.strokeStyle="rgba(163, 243, 235,0.5)",v.stroke(),v.globalAlpha=1,v.restore(),v.save(),v.globalAlpha=e,v.textAlign="center",v.textBaseline="hanging",v.font="lighter 10px arial",v.strokeStyle="#079FF5",v.strokeText(c.text.substring(0,5),g,h),v.globalAlpha=1,v.restore()}}function f(){for(var b=[],c=6,d=6,e=0,f=a.data.length;f>e;e++){var g=a.data[e],h=(e+1)*(360/f),i=h*(Math.PI/180),j={id:e,w:c,h:d,x:l+n*Math.cos(i)-c/2,y:m+o*Math.sin(i)-d/2,angle:h,ball_color:z(g.project_status),text:g.project_name||""};b.push(j)}return b}function g(){k&&b.cancel(k),b.cancel(k)}function h(){a.data.length&&(k&&b.cancel(k),k=b(j,50))}function i(a,b,c){return((a.y+a.h/2-m+2*o)/o-1)/2*(c-b)+b}function j(){v.clearRect(q,r,u.width,u.height),v.drawImage(w,q,r,u.width,u.height),v.save(),v.rotate(p*Math.PI/180),v.translate(70,-85),v.drawImage(x,l-x.width/2,m-x.height/2),v.restore(),c(v,l,m,n,o),e()}a.data=a.data?a.data.slice(0,30):[];var k,l=0,m=0,n=110,o=50,p=20,q=-60,r=0,s=[],t=.5,u=$(d)[0],v=u.getContext("2d"),w=new Image,x=new Image,y=function(){w.src="../../../img/publish/monitor_list/monitor-bg.png",x.src="../../../img/publish/monitor_list/rocket-bg.png",u.addEventListener("mouseover",g,!1),u.addEventListener("mouseout",h,!1),v.rotate(-p*Math.PI/180),l=u.width/2+q,m=u.height/2+r,n=u.width/Math.cos(p*Math.PI/180)/2-55,s=f(),j(),a.data.length&&(k&&b.cancel(k),k=b(j,50))},z=function(a){var b;switch(a){case 1:case 2:case 9:b="#D1D1D1";break;case 3:case 6:b="#40D0F0";break;case 4:case 5:case 7:b="#54EB9D";break;case 8:case 10:b="#EB5454";break;default:b="#000"}return b};a.$watch("data.length",function(a,c){a!==c&&30>=a&&(b.cancel(k),s=f(),j(),k=b(j,50))}),y()},0)}}}]),cvDirectives.directive("scrollView",["$timeout",function(a){return{restrict:"A",scope:{currentPhase:"=currentPhase",phaseDate:"=phaseDate"},link:function(b,c,d){a(function(){var a=c.parent(),d=a.width(),e=b.phaseDate.length,f=94*e;f>d&&b.$watch("currentPhase",function(a){var b=94*a;if(b>d){var e=b-d;c.animate({marginLeft:-e+"px"},"slow")}})},0)}}}]),cvDirectives.directive("spellScreen",["$timeout","$compile","ScrollBarConfig",function(a,b,c){return{restrict:"EA",scope:{data:"=data",doCheck:"&checkVal",keyword:"=searchKeyword"},templateUrl:"templates/directives/spell_screen.html",link:function(b,d,e){function f(){$(".letter-container").each(function(){var a=$(this),c=a.index();return a.offset().top+a.height()-10>$("#sys-screen-content").offset().top?($(".nav-letter-li").eq(c).addClass("active").siblings().removeClass("active"),b.control.letter_nav_top?$(".nav-letter-ul").css("top",10*-c+20):$(".nav-letter-ul").css("top","50%"),!1):void 0})}var g=!1,h=null;b.control={letter_nav_top:!1,show_no_search_data:!1},b.sys_screen_scroll=c.Y(),b.scoll_callbacks={setLeft:0,setTop:0,whileScrolling:function(){g||(h&&(a.cancel(h),h=null),h=a(f,25))},onScroll:function(){g=!1},onInit:function(){$(".nav-letter-li:first").addClass("active")}},b.scrollToId=function(c,d){g=!0;var e="#"===c?"\\#":c;$(".nav-letter-li").eq(d).addClass("active").siblings().removeClass("active"),a(function(){b.sysScrollTo($("#-"+e))},5)},b.mouseEnter=function(a){if(b.keyword){var c="#"===a.letter?"\\#":a.letter,d=$("#-"+c);a.nav_disabled=d.is(":hidden")}},b.mouseLeave=function(a){a.nav_disabled=!1},b.checkVal=function(a,c){b.doCheck({parentObj:a,childrenObj:c})},b.resetSysContainerHeight=function(){return $("#sys-screen-content").offset()?(b.control.letter_nav_top=$(".nav-letter-ul").height()>$("#sys-screen-content").height(),{height:$(window).height()-$("#sys-screen-content").offset().top-90}):void 0},b.$watch("keyword",function(c,d){c!==d&&a(function(){b.control.show_no_search_data=$(".letter-container.ng-hide").length===b.data.length,b.control.show_no_search_data?$(".nav-letter-ul").addClass("ng-hide"):($(".nav-letter-ul").removeClass("ng-hide"),$(".letter-container").each(function(){var a=$(this),b=a.index();return a.hasClass("ng-hide")?void 0:($(".nav-letter-li").eq(b).addClass("active").siblings().removeClass("active"),!1)}))},5)}),a(function(){$(".nav-letter-li:first").addClass("active")},10),$(window).resize(function(){a(function(){b.resetSysContainerHeight()},100)})}}}]),cvDirectives.directive("tablePagination",["$timeout",function(a){return{restrict:"EA",replace:!0,scope:{option:"=pageOption"},template:'<ul class="pagination"><li ng-click="pageClick(p)" ng-repeat="p in page" class="{{option.curr==p?\'active\':\'\'}}"><a href="javascript:;">{{p}}</a></li></ul>',link:function(a){function b(a,b,c){a=parseInt(a),b=parseInt(b),c=parseInt(c);var d=a-parseInt(c/2),e=a+parseInt(c/2)+c%2-1;0>=d&&(d=1,e=d+c-1,e>b&&(e=b)),e>b&&(e=b,d=e-c+1,0>=d&&(d=1));for(var f=[],g=d;e>=g;g++)f.push(g);return f.push("»"),f.unshift("«"),f}(!a.option.limit_recd||isNaN(a.option.limit_recd)||a.option.limit_recd<1)&&(a.option.limit_recd=10),(!a.option.curr||isNaN(a.option.curr)||a.option.curr<1)&&(a.option.curr=1),!a.option.all_recd||isNaN(a.option.all_recd)||a.option.all_recd<1?a.option.all=1:a.option.all=Math.ceil(a.option.all_recd/a.option.limit_recd),a.option.curr>a.option.all&&(a.option.curr=a.option.all),(!a.option.count||isNaN(a.option.count)||a.option.count<1)&&(a.option.count=10),a.page=b(a.option.curr,a.option.all,a.option.count),a.pageClick=function(c){"«"==c?c=parseInt(a.option.curr)-1:"»"==c&&(c=parseInt(a.option.curr)+1),1>c?c=1:c>a.option.all&&(c=a.option.all),c!=a.option.curr&&a.option.click&&"function"==typeof a.option.click&&(a.option.click(c),a.option.curr=c,a.page=b(a.option.curr,a.option.all,a.option.count))}}}}]),cvDirectives.directive("packageTree",["$timeout","treeConfig","CV",function(a,b,c){return{restrict:"E",scope:{files:"="},templateUrl:"templates/directives/package_tree.html",link:function(a,c,d){b.defaultCollapsed=!0;var e=function(){a.data=a.files.nodes};a.getMoreFile=function(a){a.toggle()},a.chooseSingleFile=function(b,c){if(b.checked)a.files.choosed_file_list.push({file_path:b.file_path,file:b.file,dir:b.dir});else for(var d=0;d<a.files.choosed_file_list.length;d++){var e=a.files.choosed_file_list[d];if(e.file==b.file&&e.file_path==b.file_path){a.files.choosed_file_list.splice(d,1);break}}},e()}}}]);var Login=angular.module("Login",["ui.bootstrap","ngCookies","CommHttpSrv","LicenseController","ModalCtrl","CvService","ngWebSocket","CvDirectives","GlobalData","QRCodeLoginService"]);Login.constant("baseUrl","/clWeb/"),Login.controller("LoginCtrl",["$scope","$cookies","$cookieStore","$timeout","$interval","$window","$modal","CommData","CallProvider","User","Modal","CV","baseUrl","QRCodeLogin",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.submitData={user_name:"",pass_word:""},a.error={user:"",pass:"",other:""},a.is_submit=!1,a.code_login=!1,a.operating_environment="",a.login_loading_man=!1,a.login_loading_com=!1,a.code_loading=!1,a.isManager=!1,a.regsiter_flag=!1;var o=[{code:"02",name:"运维管理平台"},{code:"03",name:"系统管理平台"}],p=o[0],q=!1,r=b.getAll();angular.forEach(r,function(a,c){b.remove(c)}),j.getLicense().then(function(b){a.operating_environment=b.zh_name?b.zh_name:"",a.version_msg=b.version_msg?b.version_msg:"",a.app_state=b.app_state?b.app_state:!1,1==b.regist_flag&&g.open({templateUrl:"app/templates/modal/regist_license_modal.html",controller:"registerLicenseCtrl",size:"md",backdrop:"static",keyboard:!1}).result.then(function(){j.getLicense().then(function(b){a.operating_environment=b.zh_name?b.zh_name:"",a.version_msg=b.version_msg?b.version_msg:"",a.app_state=b.app_state?b.app_state:!1})})},function(b){a.regsiter_flag=!0}),a.registerCL=function(){g.open({templateUrl:"app/templates/modal/regist_license_modal.html",controller:"registerLicenseCtrl",size:"md",backdrop:"static",keyboard:!1}).result.then(function(){j.getLicense().then(function(b){a.operating_environment=b.zh_name?b.zh_name:"",a.version_msg=b.version_msg?b.version_msg:"",a.app_state=b.app_state?b.app_state:!1})})},a.formSubmit=function(b){if(a.login_loading_com||a.login_loading_man)return!1;var d=a.submitData.user_name,e=a.submitData.pass_word;a.is_submit=!0;var l=!1;return""!=d&&d||(a.error.user="用户名不为空",l=!0),""!=e&&e?e.length<6&&(a.error.pass="密码必须大于6位",l=!0):(a.error.pass="密码不为空",l=!0),l?!1:(h.org_user_id=d,1==b?(a.login_loading_com=!0,a.isManager=!1,p=a.isManager?o[1]:o[0]):2==b&&(a.login_loading_man=!0,a.isManager=!0,p=a.isManager?o[1]:o[0]),void j.login({username:d,password:e,submit_type:1}).then(function(e){if(e){var g=succInitUserInfo(e,d),i=g.cp;h.org_user_id=i.org_user_id,h.org_dept_id=i.org_dept_id,h.org_term_no=i.org_term_no,h.orguser_cn_name=i.orguser_cn_name,h.orgdept_cn_name=i.orgdept_cn_name,j.us_QueryFirstNavigagePrivAction().then(function(e){var h=e.nav_list?e.nav_list:[];if(0==h.length)return a.error.other="暂无任何权限",a.login_loading_man=!1,a.login_loading_com=!1,a.submitData.pass_word="",!1;var i=s(p.code,h);return i?(1==b?(c.put(d+"_data",g),c.put(d+"_bl_rs_code",i.rs_code)):(c.put(d+"_data_cm",g),c.put(d+"_bl_rs_code_cm",i.rs_code)),console.log(i.rs_code,"*******"),a.login_loading_man=!1,a.login_loading_com=!1,f.location.href=i.rs_url+"?"+d,void 0):(a.login_loading_man=!1,a.login_loading_com=!1,a.error.other="无【"+p.name+"】登陆权限!",a.submitData.pass_word="",!1)},function(b){a.login_loading_man=!1,a.login_loading_com=!1,a.error.other="登录服务请求出错"})}},function(b){if(a.login_loading_man=!1,a.login_loading_com=!1,a.submitData.pass_word="",initCommon_Params(a.user_cn_name),"APP_SYSTEM_USER_TERM_NO_EXIST"==b.scode){var c=b.errscene?b.errscene:{};k.confirm("登录终端未绑定，是否申请绑定用户终端？").then(function(b){b&&i.call({actionName:"us_AddUserTermAction.do",reqData:{user_id:d,term_no:c.TERM_NO?c.TERM_NO:"",submit_type:1,channel_code:"01"}}).then(function(b){b.is_used?(a.error.other="终端绑定成功，请重新登陆！",a.error.othergreen=!0):(a.error.other="终端绑定申请已提交，请等待确认！",a.error.othergreen=!0),a.submitData.pass_word=""},function(b){a.error.other="终端申请服务出错"})})}else"APP_SYSTEM_PASSWORD_INITIAL"==b.scode?k.confirm("修改初始密码？").then(function(a){a&&g.open({templateUrl:m+"app/templates/modal/password_modify.html",controller:["$scope","$modalInstance","CV","userid",function(a,b,c,d){a.form={},a.userid=d,a.pwd={user_passwd:"",new_user_passwd:"",new_sec_passwd:""},a.formSubmit=function(){return c.valiForm(a.form.pwdForm)?a.pwd.new_sec_passwd!=a.pwd.new_user_passwd?(k.alert("修改密码，两次新密码输入不一致!"),!1):""==a.pwd.user_passwd||""==a.pwd.new_user_passwd||""==a.pwd.new_sec_passwd?(k.alert("修改密码，请输入正确的密码!"),!1):void j.UpdatePwd(a.pwd).then(function(c){c&&(k.alert("密码修改成功, 请用新密码登陆!"),b.close(),a.pass_word="")},function(a){k.alert("密码修改服务出错")}):!1},a.cancel=function(){b.close()}}],size:"md",resolve:{userid:function(){return h.org_user_id}}})}):"用户名或密码错误"==b.message?a.error.pass="密码不正确":"用户接入终端申请已提交，请等待管理员确认！"==b.message?(a.error.other="用户接入终端申请已提交，请等待管理员确认！",a.error.othergreen=!0):a.error.other="服务请求不成功";return!1}))},a.login_submit=function(b){var c=b.keyCode||b.which;13==c&&(a.formSubmit(1),b.preventDefault())};var s=function(a,b){for(var c,d=0;d<b.length;d++){var e=b[d];if(a==e.rs_code){c=e;break}}return c};a.qrcodeLogin=function(){a.code_login=!0,0==q&&n.getQRCodeLoginImage(function(b){a.qrcodeImageURL=b,q=!0,a.code_loading=!0},function(b){if(b){var d=b.org_user_id,e=succInitUserInfo(b,b.org_user_id),g=e.cp;h.org_user_id=g.org_user_id,h.org_dept_id=g.org_dept_id,h.org_term_no=g.org_term_no,h.orguser_cn_name=g.orguser_cn_name,h.orgdept_cn_name=g.orgdept_cn_name,j.us_QueryFirstNavigagePrivAction().then(function(b){var g=b.nav_list?b.nav_list:[];if(0==g.length)return k.alert("暂无任何权限！"),a.submitData.pass_word="",!1;var h=s(p.code,g);return h?(c.put(d+"_data",e),c.put(d+"_bl_rs_code",h.rs_code),f.location.href=h.rs_url+"?"+d,void 0):(k.alert("无【"+p.name+"】登陆权限!"),a.submitData.pass_word="",!1)},function(a){k.alert(a.message)})}},function(b){a.code_loading=!0,a.err_msg=b.message,a.code_login=!1})},a.normalLogin=function(){a.code_login=!1},a.goDownApp=function(){f.location.href=m+"app/views/phone/app.html"}}]),Login.directive("positionStyle",["$window",function(a){return{restrict:"AE",link:function(b,c,d){var e=a.innerWidth-1200,f=a.innerHeight-648;a.innerWidth<1200?(c.siblings().css("left","-40px"),c.css("left","700px"),$(".login").css("margin-left","0px")):a.innerWidth<=1364?(c.siblings().css("left","-40px"),c.css("left",700+e+"px"),$(".login").css("margin-left","0px")):a.innerWidth<=2e3?(c.siblings().css("left",(a.innerWidth-1364)/2-40+"px"),c.css("left",864+(a.innerWidth-1364)/2+"px"),$(".login").css("margin-left","0px")):($(".login").css("margin-left",(a.innerWidth-2e3)/2+"px"),c.siblings().css("left",(a.innerWidth-1364)/2-40+"px"),c.css("left",864+(a.innerWidth-1364)/2+"px")),a.innerHeight>648&&$(".login").css("top",f/2+"px"),$(window).resize(function(){var b=a.innerWidth-1200,d=a.innerHeight-648;a.innerWidth<1200?(c.siblings().css("left","-40px"),c.css("left","700px"),$(".login").css("margin-left","0px")):a.innerWidth<=1364?(c.siblings().css("left","-40px"),c.css("left",700+b+"px"),$(".login").css("margin-left","0px")):a.innerWidth<=2e3?(c.siblings().css("left",(a.innerWidth-1364)/2-40+"px"),c.css("left",864+(a.innerWidth-1364)/2+"px"),$(".login").css("margin-left","0px")):($(".login").css("margin-left",(a.innerWidth-2e3)/2+"px"),c.siblings().css("left",(a.innerWidth-1364)/2-40+"px"),c.css("left",864+(a.innerWidth-1364)/2+"px")),a.innerHeight>648&&$(".login").css("top",d/2+"px")})}}}]),Login.directive("cusAnimate",["$timeout",function(a){return{restrict:"AE",link:function(b,c,d){"login_submit_left"==d["class"]?c.on("mouseenter",function(){a(function(){c.css("color","#ffffff").css("background","transparent"),$(".login_submit_left").animate({width:"200px"},400),$(".login_submit_left i").css("color","#ffffff"),$(".login_submit_right").css("color","#808080").css("background","#f2f2f2"),$(".login_submit_right i").css("color","#808080"),$(".login_submit_right").animate({marginLeft:"240px",width:"120px"},400)},0)}):c.on("mouseenter",function(){a(function(){$(".login_submit_left").css("color","#808080").css("background","#f2f2f2"),$(".login_submit_left i").css("color","#808080"),$(".login_submit_left").animate({width:"120px"},400),$(".login_submit_right i").css("color","#fffff"),$(".login_submit_right").css("color","#ffffff").css("background","transparent"),$(".login_submit_right").animate({marginLeft:"160px",width:"200px"},400)},0)})}}}]),Login.directive("cusValidate",["$timeout","CallProvider",function(a,b){return{restrict:"AE",link:function(a,c,d){c.focus(function(){"text"==d.type?a.$apply(function(){a.error.user="",a.error.other="",a.error.othergreen=!1}):a.$apply(function(){a.error.pass="",a.error.other="",a.error.othergreen=!1})}),"text"==d.type&&c.blur(function(){a.submitData.user_name&&""!=a.submitData.user_name?b.call({actionName:"us_ViewUsforAppActioncheckUserId.do",reqData:{data:a.submitData.user_name}}).then(function(b){b.result?a.error.user="":a.error.user="用户名不存在"},function(b){a.error.other="服务请求不成功"}):a.error.user="用户名不为空"})}}}]),Login.directive("dynamicWeight",["$window",function(a){return{restrict:"AE",link:function(b,c,d){a.innerWidth>1400?c.css("left",(a.innerWidth-1400)/2+"px"):c.css("left","0px"),$(window).resize(function(){console.log("********"),a.innerWidth>1400?c.css("left",(a.innerWidth-1400)/2+"px"):c.css("left","0px")})}}}]),Login.directive("imgHeight",["$window",function(a){return{restrict:"AE",link:function(a,b,c){b.css("height",window.innerHeight-52+"px"),$(window).resize(function(){b.css("height",window.innerHeight-52+"px")})}}}]);