"use strict";function forbidBackSpace(a){var b=a||window.event,c=b.target||b.srcElement,d=c.type||c.getAttribute("type"),e=c.readOnly,f=c.disabled;e=void 0==e?!1:e,f=void 0==f?!0:f;var g=!(8!=b.keyCode||"password"!=d&&"text"!=d&&"textarea"!=d||1!=e&&1!=f),h=8==b.keyCode&&"password"!=d&&"text"!=d&&"textarea"!=d&&"editDiv"!=d;return h||g?!1:void 0}var licenseCtrl=angular.module("LicenseController",[]);licenseCtrl.controller("registerLicenseCtrl",["$scope","$modalInstance","$timeout","User","Modal","CV",function(a,b,c,d,e,f){a.form={},a.register_info={min_date:new Date,register_flag:!0,license_info:{}},a.control={register_btn_loading:!1},d.getLicense().then(function(b){c(function(){if(b){var c=b.regist_flag;1==c?a.register_info.license_info={}:a.register_info.license_info={name:b.name,zh_name:b.zh_name,expire_end_date:b.expire_end_date,license:b.license,ip:b.ip,version_msg:b.version_msg?b.version_msg:""}}},0)},function(a){e.alert(a.message,3)}),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.form.opened=!0},a.formSubmit=function(){return a.control.register_btn_loading=!0,f.valiForm(a.form.regLicenseForm)?(a.register_info.license_info.expire_end_date=f.dtFormat(a.register_info.license_info.expire_end_date),void d.registLicense(a.register_info.license_info).then(function(d){c(function(){a.control.register_btn_loading=!1,e.alert("注册成功",2),b.close(!0)},0)},function(b){a.control.register_btn_loading=!1,e.alert(b.message,3)})):(a.control.register_btn_loading=!1,!1)},a.cancel=function(){b.dismiss(!1)}}]),licenseCtrl.controller("showLicenseCtrl",["$scope","$modalInstance","$timeout","User","Modal",function(a,b,c,d,e){a.register_info={register_flag:!0,license_info:{}},d.getLicense().then(function(b){c(function(){a.register_info.license_info={name:b.name,zh_name:b.zh_name,expire_end_date:b.expire_end_date,license:b.license,ip:b.ip,version_msg:b.version_msg?b.version_msg:""}},0)},function(a){e.alert(a.message,3)}),a.cancel=function(){b.close(!0)}}]);var CommController=angular.module("CommControllers",[]);CommController.controller("fileCtrl",["$scope","FileUploader","baseUrl","Modal",function(a,b,c,d){console.log("URL:"+c+"fileupload?uploadPath="+a.fileupload.uploadpath);var e=a.fileupload.suffixs?a.fileupload.suffixs.split(","):[],f=a.uploader=new b({url:c+"fileupload?uploadPath="+a.fileupload.uploadpath});f.filters.push({name:"suffixFilter",fn:function(a){return 0==e.length?!0:-1==e.indexOf(a.name.split(".")[1])?(d.alert("文件名后缀限定为["+e.toString().replace(","," 或 ")+"]格式！",3),!1):!0}}),a.$watch("uploader.queue.length",function(){f.uploadAll(),a.uploader.queue[0]&&(a.fileupload.filename=a.uploader.queue[0].file.name),a.uploader.queue[2]&&(a.fileuploadBack.filename=a.uploader.queue[1].file.name)}),a.remove=function(){var b=document.getElementsByTagName("input")[1];b.value="",f.queue.length=0,a.fileupload.filename=""},f.onSuccessItem=function(b,c,d,e){a.onSuccessThen?a.onSuccessThen(a.uploader.queue):""},f.onErrorItem=function(a,b,c,e){d.alert("文件上传失败\r\n"+b,3)}}]);var homeCtrl=angular.module("HomePageController",[]);homeCtrl.controller("indexCtrl",["$rootScope","$scope","$state","$timeout","User","Message","Task","Charts","Version","Modal",function(a,b,c,d,e,f,g,h,i,j){var k={title:"",color:"#FFF",border_width:2,split_color:"#344257",dataList:[]},l={title:"",color:"#FFF",border_width:2,split_color:"#344257",dataList:[]},m={title:"",color:"#FFF",border_width:2,split_color:"#344257",dataList:[]},n={title:"",color:"#FFF",border_width:2,split_color:"#446479",dataList:[{name:"",y:100,color:"#446479"}]};b.config={pub_circle_config:{},fault_circle_config:{},dispatch_circle_config:{}},b.task_info={unhandle_order_num:0,handling_order_num:0,end_project_num:0,ready_project_num:0,finish_task_num:0,unfinish_task_num:0},b.data={sys_list:[]},b.control={task_loading:!0,pub_module_exit_flag:!1,dispatch_module_exit_flag:!1,fault_module_exit_flag:!1};var o=function(a){var b=a.length,c=[];if(0==b)c.push({page:0,sys_list:[],active:!1});else for(var d=0;b>d;d+=12)c.push({page:parseInt(d/12),sys_list:a.slice(d,d+12),active:!1});for(var e=12-c[c.length-1].sys_list.length,f=0;e>f;f++)c[c.length-1].sys_list.push({});return c[0].active=!0,c},p=function(){var c=[];b.data.sys_list=o(c),b.config.pub_circle_config=h.getSplitPieConfig(n,110,110,!0),b.config.fault_circle_config=h.getSplitPieConfig(n,110,110,!0),b.config.dispatch_circle_config=h.getSplitPieConfig(n,110,110,!0),i.getStreamListByKey("",1).then(function(a){c=a.vsVersion_list?a.vsVersion_list:[],b.data.sys_list=o(c)},function(a){j.alert(a.message,3)}),g.getIndexTaskCount().then(function(c){if(c){if(b.control.task_loading=!1,c.project_bean){var d=c.project_bean.end_project_num+c.project_bean.ready_project_num;b.task_info.end_project_num=c.project_bean.end_project_num,b.task_info.ready_project_num=c.project_bean.ready_project_num,0!=d&&(k.dataList.push({y:parseFloat(b.task_info.end_project_num/d*100),color:"#43e0f7"},{y:parseFloat(b.task_info.ready_project_num/d*100),color:"#f8d838"}),b.config.pub_circle_config=h.getSplitPieConfig(k,110,110,!0))}if(c.order_bean){var e=c.order_bean.handling_order_num+c.order_bean.unhandle_order_num;b.task_info.handling_order_num=c.order_bean.handling_order_num,b.task_info.unhandle_order_num=c.order_bean.unhandle_order_num,0!=e&&(l.dataList.push({y:parseFloat(b.task_info.handling_order_num/e*100),color:"#4faeff"},{y:parseFloat(b.task_info.unhandle_order_num/e*100),color:"#ed416e"}),b.config.fault_circle_config=h.getSplitPieConfig(l,110,110,!0))}if(c.task_bean){var f=c.task_bean.finish_task_num+c.task_bean.unfinish_task_num;b.task_info.finish_task_num=c.task_bean.finish_task_num,b.task_info.unfinish_task_num=c.task_bean.unfinish_task_num,0!=f&&(m.dataList.push({y:parseFloat(b.task_info.finish_task_num/f*100),color:"#f458b7"},{y:parseFloat(b.task_info.unfinish_task_num/f*100),color:"#ff9a00"}),b.config.dispatch_circle_config=h.getSplitPieConfig(m,110,110,!0))}var g=a.level_menu_list;angular.forEach(g,function(a){switch(a.menu_name){case"发布":b.control.pub_module_exit_flag=!0;break;case"故障":b.control.fault_module_exit_flag=!0;break;case"调度":b.control.dispatch_module_exit_flag=!0}})}},function(a){j.alert(a.message,3)})};b.goToSysPage=function(a){a.business_sys_name&&c.go("sys_config.struct_config",{sys_id:a.business_sys_name})},b.goToList=function(a){1==a?c.go("proj_list"):2==a?c.go("wo_mine.create_list"):c.go("dispatch_task_list.cur_task")},b.switchData=function(a,b,c){var d=$("#page_"+a),e=$("#page_"+(a-1)),f=$("#page_"+(a+1)),g=$(".sys_prev_btn"),h=$(".sys_next_btn");g.css("display","none"),h.css("display","none"),1==b?(d.animate({left:-d.width()+"px"},1e3,function(){d.css("display","none")}),f.css("display","block"),f.css("left",f.width()+"px"),f.animate({left:"0px"},1e3,function(){g.css("display","block"),h.css("display","block")})):(d.animate({left:d.width()+"px"},1e3,function(){d.css("display","none")}),e.css("display","block"),e.css("left",-e.width()+"px"),e.animate({left:"0px"},1e3,function(){g.css("display","block"),h.css("display","block")}))},p()}]);var uCtrl=angular.module("UserController",[]);uCtrl.controller("userModifyCtrl",["$scope","$rootScope","$state","User","Modal",function(a,b,c,d,e){var f=b.loginUser.org_user_id;a.user_info={},a.control={save_btn_loading:!1},d.getUserByUserId(f).then(function(b){b.user_bean&&(a.user_info={user_name:b.user_bean.user_id||"",user_cn_name:b.user_bean.user_cn_name||"",teller_number:b.user_bean.teller_no||"",user_email:b.user_bean.email_add||"",phone_number:b.user_bean.phone_no||"",pwd_expiry_date:b.user_bean.pwdexp_bk_date||"",user_type:b.user_bean.user_type||"",user_department:b.user_bean.bl_dept_id||"",parttime_department:b.user_bean.first_dept_id||"",department_role:b.user_bean.dprl_cn_name||""})}),a.formSubmit=function(){a.control.save_btn_loading=!0,d.us_UpdateUserAction(a.user_info).then(function(){e.alert("个人信息修改成功!",2),a.control.save_btn_loading=!1,c.go("index")},function(b){e.alert(b.message,3),a.control.save_btn_loading=!1})},a.back=function(){c.go("index")}}]),uCtrl.controller("pwdModifyCtrl",["$scope","$rootScope","$state","$timeout","User","Modal","CV",function(a,b,c,d,e,f,g){var h=b.loginUser.org_user_id;a.user_info={user_name:h,pwd_info:{user_passwd:"",new_user_passwd:"",new_sec_passwd:""}},a.control={edit_btn_loading:!1},a.formSubmit=function(){return g.valiForm(a.pwd_form)?a.user_info.pwd_info.new_sec_passwd!==a.user_info.pwd_info.new_user_passwd?(f.alert("两次新密码输入不一致!",3),!1):a.user_info.pwd_info.user_passwd===a.user_info.pwd_info.new_user_passwd?(f.alert("密码修改前后一致，请重新设置新密码!",3),!1):(a.control.edit_btn_loading=!0,void e.UpdatePwd(a.user_info.pwd_info).then(function(b){a.control.edit_btn_loading=!1,f.alert("密码修改成功!",2),c.go("index")},function(b){f.alert(b.message,3),a.control.edit_btn_loading=!1})):!1},a.reset=function(){a.user_info.pwd_info.user_passwd="",a.user_info.pwd_info.new_user_passwd="",a.user_info.pwd_info.new_sec_passwd="",d(function(){a.pwd_form.$setPristine()},0)}}]),uCtrl.controller("contactsListCtrl",["$scope","User","config","Modal","CV",function(a,b,c,d,e){var f=[];a.info={user_cn_name:"",contacts_list:[]},a.control={current_page:1,total_recd:0};var g=function(e){b.getContactsListByUserName(e,20,a.info.user_cn_name).then(function(b){0!=b.all_recd?(a.info.contacts_list=c.rebuildContactsList(b.user_list),a.control.total_recd=b.all_recd):d.alert("没有符合条件的联系人",3)},function(a){d.alert(a.message,3)})},h=function(){b.getCommonlyUsedConcats().then(function(a){f=a.contact_list?a.contact_list:[]},function(a){d.alert(a.message,3)})},i=function(){g(0),h()};a.getAttentionStyle=function(a,b){b.attention_flag=!1;for(var c=0;c<f.length;c++){var d=f[c];if(d.user_id==a)return b.attention_flag=!0,{color:"red","margin-top":"2px",cursor:"pointer"}}return{cursor:"pointer"}},a.addAndRemoveAttentionContact=function(a,c){c.attention_flag?b.removeAttentionContacts(a).then(function(a){h()},function(a){d.alert(a.message,3)}):b.addAttentionContacts(a).then(function(a){h()},function(a){d.alert(a.message,3)})},a.pageChanged=function(){g(20*(a.control.current_page-1))},a.searchConcats=function(){g(0)},i()}]),uCtrl.controller("msgDetailCtrl",["$scope","$state","$stateParams","$window","Message","Modal","CV",function(a,b,c,d,e,f,g){var h=c.msg_id;a.msg_info={},e.getmessageDetail(h).then(function(b){a.msg_info=b.msg_info?b.msg_info:{}},function(a){f.alert(a.message,3)}),a.downloadAttachment=function(b){var c=a.msg_info.file_path+b;g.downloadFile(c)},a.back=function(){b.go("msg_list")}}]),uCtrl.controller("logListCtrl",["$scope","LogSrv","Modal","CV",function(a,b,c,d){var e=d.dtFormat(new Date);a.log_info={datepicker:{},log_date:e,log_total_recd:0,log_list:[],submit_info:{start_bk_date:"",end_bk_date:"",start_recd:1,limit_recd:5,log_label:0,log_level:1},download_log_info:{start_bk_date:e,end_bk_date:e}},a.control={current_page:1,show_log_menu:!1},a.showLogDetail=function(a){a.show_detail=!a.show_detail},a.toggleLogAttention=function(a){a.log_label=0==a.log_label?1:0,b.lg_UpdateLogLabelAction(a.work_seq,a.log_label).then(function(a){},function(b){a.log_label=0==a.log_label?1:0,c.alert(b.message,3)})},a.toggleAllLogAttention=function(){a.log_info.submit_info.log_label=0==a.log_info.submit_info.log_label?1:0,a.refreshLogList()},a.selectLogDate=function(){a.log_info.log_date=d.dtFormat(a.log_info.log_date),a.refreshLogList()},a.changeLogLevel=function(b){a.log_info.submit_info.log_level=b,a.refreshLogList()},a.refreshLogList=function(){a.log_info.submit_info.start_recd=(a.control.current_page-1)*a.log_info.submit_info.limit_recd,a.log_info.submit_info.start_bk_date=a.log_info.log_date,a.log_info.submit_info.end_bk_date=a.log_info.log_date,a.log_info.submit_info.start_bk_date&&a.log_info.submit_info.end_bk_date?b.getLogPageList(a.log_info.submit_info).then(function(b){a.log_info.log_list=b.log_list?b.log_list:[],a.log_info.log_total_recd=b.all_recd},function(a){c.alert(a.message,3)}):c.alert("输入时间为空！",3)},a.downloadLog=function(){var e,f,g,h,i=(new Date).getTime();a.log_info.download_log_info.start_bk_date&&a.log_info.download_log_info.end_bk_date?(10==a.log_info.download_log_info.start_bk_date.length?(e=a.log_info.download_log_info.start_bk_date.replace(/-/g,"/")+" 00:00:00",e=new Date(e).getTime(),f=a.log_info.download_log_info.start_bk_date):(e=a.log_info.download_log_info.start_bk_date.getTime(),f=d.dtFormat(a.log_info.download_log_info.start_bk_date)),10==a.log_info.download_log_info.end_bk_date.length?(g=a.log_info.download_log_info.end_bk_date.replace(/-/g,"/")+" 00:00:00",g=new Date(g).getTime(),h=a.log_info.download_log_info.end_bk_date):(g=a.log_info.download_log_info.end_bk_date.getTime(),h=d.dtFormat(a.log_info.download_log_info.end_bk_date)),e>g?c.alert("输入起始日期不合法!",3):e>i||g>i?c.alert("输入日期超出当前日期!",3):b.downloadLog(f,h).then(function(a){var b=a.path_name+"/"+a.file_name,c=b.substring(b.indexOf("clWeb/")+6,b.length);d.downloadFile(c)},function(a){c.alert(a.message,3)})):c.alert("输入日期不能为空",3)},a.refreshLogList()}]);var tCtrl=angular.module("TaskController",[]);tCtrl.controller("tasksListCtrl",["$scope","$rootScope","$state","$stateParams","Task","Modal","CV",function(a,b,c,d,e,f,g){var h=d.tab_name;a.task_info={mine_task_exe_count:"",review_task_exe_count:"",auth_task_exe_count:"",trouble_task_exe_count:""},a.control={tab_flag:1};var i=function(){"mine_task"===h?a.control.tab_flag=1:"review_task"===h?a.control.tab_flag=2:"trouble_task"===h?a.control.tab_flag=4:a.control.tab_flag=3,e.getUnhandleTaskList(0,3).then(function(a){b.all_recdt=a.all_recd},function(a){f.alert(a.message,3)}),e.getUnhandleTaskCount().then(function(b){a.task_info={mine_task_exe_count:b.mine_executory_count||"",review_task_exe_count:b.uncheck_executory_count||"",auth_task_exe_count:b.unauth_executory_count||"",trouble_task_exe_count:b.mine_trouble_executory_count||""}},function(a){f.alert(a.message,3)})};a.selectTab=function(b,d){a.control.tab_flag=b,c.go("tasks_list",{tab_name:d})},i()}]),tCtrl.controller("tasksHistoryListCtrl",["$scope","$state","$stateParams",function(a,b,c){var d=c.tab_name;a.control={tab_flag:1},"submit_his"===d?a.control.tab_flag=1:"review_his"===d?a.control.tab_flag=2:a.control.tab_flag=3,a.selectHisTaskTab=function(c,d){a.control.tab_flag=c,b.go("tasks_history_list",{tab_name:d})}}]),tCtrl.controller("taskDetailCtrl",["$scope","$stateParams","$state","Task","Modal",function(a,b,c,d,e){var f=b.tab_name,g=b.task_id,h="";a.task_info={task_seq:g,task_desc:"",task_apply_desc:"",task_flow_list:[],interface_info:{interface_list:[],extra_list:[]}};var i=function(){d.getTaskDetail(g).then(function(b){var c=JSON.parse(b.new_json_list);h=b.workflow_state||"",a.task_info.task_desc=b.pendwk_bk_expl||"",a.task_info.task_apply_desc=b.apply_bk_expl||"",a.task_info.task_flow_list=b.work_detail_list||[],a.task_info.url=b.rs_url||"",a.task_info.aprov_type=b.aprov_type||1,a.task_info.interface_info.interface_list=angular.copy(c);for(var d=0;d<a.task_info.task_flow_list.length;d++){var e=a.task_info.task_flow_list[d];1==e.pend_type?e.deal_type_name="申请":2==e.pend_type?e.deal_type_name="复核":3==e.pend_type?e.deal_type_name="授权":4==e.pend_type?e.deal_type_name="执行":e.deal_type_name="关闭",e.show=!1}},function(a){e.alert(a.message,3)}),d.getAccessoryInfo(g).then(function(b){a.task_info.interface_info.extra_list=b.extra_list||[]},function(a){e.alert(a.message,3)})};a.mouseEnter=function(b,c){var d=".changeWith"+c;if(b>=28){a.task_info.task_flow_list[c].show=!0;var e=9*(b-24)+230;$(d).css("width",e)}},a.mouseLeave=function(b){a.task_info.task_flow_list[b].show=!1;var c=".changeWith"+b;$(c).width(208)},a.flowCircleSm=function(b,c){return 2==h||4==h?{"background-color":1==b?"#0095A5":2==b?"#D85668":c==a.task_info.task_flow_list.length-1?"#0095A5":"#CCCCCC",top:100*c+-10+"px"}:1==h||3==h||5==h?{"background-color":1==b||3==b?"#0095A5":"#FFFFFF",border:"2px solid #0095A5",top:100*c+-10+"px"}:7==h?{"background-color":1==b&&c!=a.task_info.task_flow_list.length-1?"#0095A5":2==b?"#F37889":c==a.task_info.task_flow_list.length-1?"black":"#CCCCCC",top:100*c+-10+"px"}:{"background-color":1==b?"#0095A5":2==b?"#F37889":4==b?"#0095A5":"#CCCCCC","border-radius":"100%",top:100*c+-10+"px"}},a.flowCircleLg=function(a,b){return 6==a||7==a?{}:{top:112*b+-16+"px"}},a.setContainerHeight=function(a){return{height:100*(a-1)+200>399?100*(a-1)+200+"px":"","min-height":"399px"}},a.verticalLineStyle=function(a){return{height:110*(a-1)+"px"}},a.taskStateCnName=function(a){return{top:92*a-18+"px"}},a.viewInterfaceInfo=function(){e.jsonList(a.task_info.interface_info,a.task_info.url,a.task_info.aprov_type,g)},a.back=function(){f.indexOf("his")>0?c.go("tasks_history_list",{tab_name:f}):c.go("tasks_list",{tab_name:f})},i()}]),tCtrl.controller("taskHandleCtrl",["$scope","$rootScope","$stateParams","$state","Task","Modal",function(a,b,c,d,e,f){var g=c.tab_name,h=c.task_id,i="",j=[];a.task_info={task_seq:h,task_desc:"",task_apply_desc:"",task_handle_desc:"",task_handle_state:"",task_flow_list:[],handle_flag:1,interface_info:{interface_list:[],extra_list:[]}},a.control={btn_loading:!1,task_handle_type:0};var k=function(){e.getUnhandleTaskList(0,3).then(function(a){b.head_tasks=a.unhandle_work_list,b.all_recdt=a.all_recd},function(a){f.alert(a.message,3)})},l=function(){e.getTaskDetail(h).then(function(b){var c=JSON.parse(b.new_json_list);i=b.pend_srv_name,a.task_info.task_desc=b.pendwk_bk_expl||"",a.task_info.task_apply_desc=b.apply_bk_expl||"",a.task_info.task_handle_state=b.workflow_state||"",a.task_info.task_flow_list=b.work_detail_list||[],a.task_info.interface_info.interface_list=angular.copy(c),a.task_info.handle_flag=5!=a.task_info.task_handle_state&&2==a.control.task_handle_type?2:1,j=angular.copy(c);for(var d=j.length-1;d>=0;d--){var e=j[d];("org_srv_name"==e.fname||"org_rs_code"==e.fname||"remote_ip"==e.fname||"org_work_code"==e.fname||"server_port"==e.fname||"pend_work_seq"==e.fname||"server_name"==e.fname||"pendwk_bk_expl"==e.fname)&&e.splice(d,1)}for(var d=0;d<a.task_info.task_flow_list.length;d++){var f=a.task_info.task_flow_list[d];1==f.pend_type?f.deal_type_name="申请":2==f.pend_type?f.deal_type_name="复核":3==f.pend_type?f.deal_type_name="授权":4==f.pend_type?f.deal_type_name="执行":f.deal_type_name="关闭",f.show=!1}},function(a){f.alert(a.message,3)}),e.getAccessoryInfo(h).then(function(b){a.task_info.interface_info.extra_list=b.extra_list||[]},function(a){f.alert(a.message,3)})},m=function(){"auth_task"===g?a.control.task_handle_type=1:"review_task"===g?a.control.task_handle_type=3:a.control.task_handle_type=2,l()};a.mouseEnter=function(b,c){var d=".changeWith"+c;if(b>=28){a.task_info.task_flow_list[c].show=!0;var e=9*(b-24)+230;$(d).css("width",e)}},a.mouseLeave=function(b){a.task_info.task_flow_list[b].show=!1;var c=".changeWith"+b;$(c).width(208)},a.flowCircleSm=function(b,c){return 2==a.task_info.task_handle_state||4==a.task_info.task_handle_state?{"background-color":1==b?"#0095A5":2==b?"#D85668":c==a.task_info.task_flow_list.length-1?"#0095A5":"#CCCCCC",top:100*c+-10+"px",left:"-5px","z-index":6}:{"background-color":1==b||3==b?"#0095A5":"#FFFFFF",border:"2px solid #0095A5",top:100*c+-10+"px"}},a.flowCircleLg=function(a){return{top:112*a+-16+"px"}},a.setContainerHeight=function(a){return{height:140*(a-1)+200>399?140*(a-1)+200+"px":"","min-height":"399px"}},a.verticalLineStyle=function(a){return{height:110*(a-1)+"px"}},a.taskStateCnName=function(a){return{top:92*a-18+"px"}},a.viewInterfaceInfo=function(){f.jsonList(a.task_info.interface_info)},a.taskHandle=function(){if(a.control.btn_loading=!0,1==a.task_info.handle_flag){for(var b={submit_type:2,pend_work_seq:h,srvName:i,deal_bk_desc:a.task_info.task_handle_desc},c=0;c<j.length;c++){var l=j[c];b[l.fname]=l.fval}e.ExecuteTask(b,i).then(function(b){f.alert("任务执行成功！",2),k(),a.control.btn_loading=!1,d.go("tasks_list",{tab_name:g})},function(b){a.control.btn_loading=!1,f.alert(b.message,3)})}else{var m={pend_wk_seq:h,workflow_state:7,deal_bk_desc:a.task_info.task_handle_desc};e.CloseTask(m).then(function(b){f.alert("任务成功关闭！",2),k(),a.control.btn_loading=!1,d.go("tasks_list",{tab_name:g})},function(b){a.control.btn_loading=!1,f.alert(b.message,3)})}},a.taskReview=function(){var b={pend_wk_seq:h,deal_res:a.task_info.handle_flag,deal_bk_desc:a.task_info.task_handle_desc};a.control.btn_loading=!0,e.CheckPendTask(b).then(function(c){1==b.deal_res?f.alert("复核通过！",2):f.alert("复核拒绝！",3),k(),a.control.btn_loading=!1,d.go("tasks_list",{tab_name:g})},function(b){f.alert(b.message,3),a.control.btn_loading=!1})},a.taskAuth=function(){var b={pend_wk_seq:h,auth_type:2,deal_res:a.task_info.handle_flag,deal_bk_desc:a.task_info.task_handle_desc};a.control.btn_loading=!0,e.AuthPendTask(b).then(function(c){1==b.deal_res?f.alert("成功授权",2):f.alert("授权拒绝！",3),k(),a.control.btn_loading=!1,d.go("tasks_list",{tab_name:g})},function(b){a.control.btn_loading=!1,f.alert(b.message,3)})},a.cancel=function(){d.go("tasks_list",{tab_name:g})},m()}]),tCtrl.controller("troubleTaskHandleCtrl",["$scope","$rootScope","$stateParams","$state","Task","ProgramExec","Workorder","Modal",function(a,b,c,d,e,f,g,h){var i=c.task_id,j=c.tab_name,k=c.detail_flag;a.task_info={submit_info:{pg_work_seq:i,deal_bk_desc:"",deal_res:1,pgsubmit_type:2},task_detail:{wrk_seq:i,pgwork_status:"",apply_bk_expl:"",work_detail_list:[]}},a.control={is_detail:"false"==k?!1:!0,btn_loading:!1};var l=function(){e.getProgramAuthDetail(i).then(function(b){a.task_info.task_detail.work_detail_list=b.pg_detail_list||[],a.task_info.task_detail.apply_bk_expl=b.apply_bk_expl||"",a.task_info.task_detail.pgwork_status=b.pgwork_status||"";for(var c=0;c<a.task_info.task_detail.work_detail_list.length;c++){var d=a.task_info.task_detail.work_detail_list[c];1==d.pgpend_type?d.deal_type_name="申请":2==d.pgpend_type?2!=a.task_info.task_detail.pgwork_status&&5!=a.task_info.task_detail.pgwork_status?d.deal_type_name="授权":c==a.task_info.task_detail.work_detail_list.length-1?d.deal_type_name="关闭":d.deal_type_name="授权":3==d.pgpend_type&&(2!=a.task_info.task_detail.pgwork_status&&5!=a.task_info.task_detail.pgwork_status?d.deal_type_name="执行":d.deal_type_name="关闭")}},function(a){h.alert(a.message,3)})};a.setContainerHeight=function(a){return{height:100*(a-1)+200>399?100*(a-1)+200+"px":"","min-height":"399px"}},a.flowCircleSm=function(b,c){return 2==a.task_info.task_detail.pgwork_status||5==a.task_info.task_detail.pgwork_status?{"background-color":1==b?"#ccc":2==b||3==b?"#0095A5":"#D85668",top:100*c+-10+"px",border:"2px solid","border-color":1==b?"#ccc":4==b?"#D85668":"#0095A5"}:{"background-color":1==b?"#fff":2==b||3==b?"#0095A5":"#D85668",top:100*c+-10+"px",border:"2px solid","border-color":4==b?"#D85668":"#0095A5"}},a.flowCircleLg=function(b){var c={position:"absolute",width:"24px",height:"24px",left:"-11px","z-index":1};return 2==a.workflow_state||4==a.workflow_state?angular.extend(c,{"background-color":"#F37889","border-radius":"100%",top:112*b+-16+"px"}):angular.extend(c,{"background-color":"#75C6D1","border-radius":"100%",top:112*b+-16+"px","animation-name":"cbreath","animation-duration":"3s","animation-timing-function":"ease-in-out","animation-iteration-count":"infinite","-webkit-animation-name":"cbreath","-webkit-animation-duration":"3s","-webkit-animation-timing-function":"ease-in-out","-webkit-animation-iteration-count":"infinite"})},a.verticalLineStyle=function(a){return{height:110*(a-1)+"px"}},a.taskStateCnName=function(a){return{top:92*a-18+"px"}},a.mouseEnter=function(a){var b=".changeWith"+a,c=$(b).find(".auth-introduce"),d=Math.max(c.eq(0).width(),c.eq(1)?c.eq(1).width():0);if(d>135){var e=d+100;$(b).animate({width:e})}},a.mouseLeave=function(a){var b=".changeWith"+a;$(b).animate({width:220})},a.programDetail=function(){h.viewTroubleTicketProgram(i)},a.taskAuth=function(){a.control.btn_loading=!0,e.authProgram(a.task_info.submit_info).then(function(a){d.go("tasks_list",{tab_name:j})},function(b){a.control.btn_loading=!1,h.alert(b.message,3)})},a.taskExec=function(){a.control.btn_loading=!0,f.execProgramStep(a.task_info.submit_info).then(function(a){d.go("tasks_list",{tab_name:j}),h.alert("执行成功",2)},function(b){a.control.btn_loading=!1,h.alert(b.message,3)})},a.taskClose=function(){a.control.btn_loading=!0,g.closePgWorkAction(i,a.task.deal_bk_desc).then(function(a){d.go("tasks_list",{tab_name:j}),h.alert("关闭成功",2)},function(b){a.control.btn_loading=!1,h.alert(b.message,3)})},a.back=function(){d.go("tasks_list",{tab_name:j})},l()}]);var modal_m=angular.module("ModalCtrl",[]);modal_m.controller("LoadingCtrl",["$scope","Message",function(a,b){a.message=b}]),modal_m.controller("AlertCtrl",["$scope","$modalInstance","$timeout","status","Message",function(a,b,c,d,e){a.message=e,a.status=d?d:1,a.ok=function(){try{b.close(!0)}catch(a){}},$("body").keypress(function(c){var d=c.keyCode||c.which;13==d&&a.$apply(function(){b.close(!0)})}),3!=a.status&&c(function(){try{b.close(!0)}catch(a){}},2e3)}]),modal_m.controller("ConfirmCtrl",["$scope","$modalInstance","Message",function(a,b,c){a.message=c,a.ok=function(){b.close(!0)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("localAuthCtrl",["$scope","$modalInstance","modalParam","Task","QRCodeLocalAuth","Modal",function(a,b,c,d,e,f){var g=angular.copy(c.srv_req_data);a.info={authdprl_bk_expl:c.auth_data.authdprl_bk_expl,user_id:"",user_password:"",qrcodeLocalAuthImageURL:""},a.control={btnBus_loading:!1};var h={auth_dprl_code:c.auth_data.auth_dprl_code,auth_seq:c.auth_data.auth_seq,auth_user_id:a.info.user_id,pend_srv_name:c.auth_data.pend_srv_name,user_passwd:a.info.user_password,auth_key:c.auth_data.auth_key,req_data:g},i=e.getQRCodeLocalAuthImage(h,function(b){a.info.qrcodeLocalAuthImageURL=b},function(e){e&&e.pend_srv_name==g.org_srv_name?(g.submit_type=4,d.ExecuteTask(g,c.auth_data.pend_srv_name).then(function(a){b.close(a)},function(c){a.control.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})})):b.close(e)},function(c){a.control.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})});a.submit=function(){i.cancel=!0,a.control.btnBus_loading=!0;var e=angular.copy(c.srv_req_data);return a.info.user_id?a.info.user_password?(h.auth_user_id=a.info.user_id,h.user_passwd=a.info.user_password,d.LocalAuthTask(h).then(function(f){f.pend_work_seq&&(f.pend_srv_name=f.pend_work_seq),f&&f.pend_srv_name==e.org_srv_name?(e.submit_type=4,d.ExecuteTask(e,c.auth_data.pend_srv_name).then(function(a){b.close(a)},function(c){a.control.btnBus_loading=!1,b.dismiss(c)})):b.close(f)},function(c){a.control.btnBus_loading=!1,b.dismiss(c)}),void 0):(f.alert("授权用户密码为空！",3),a.control.btnBus_loading=!1,!1):(f.alert("授权用户名为空！",3),a.control.btnBus_loading=!1,!1)},a.cancel=function(){i.cancel=!0,b.dismiss({status:"system",message:"已取消本地授权"})}}]),modal_m.controller("remoteAuthCtrl",["$scope","$modalInstance","modalParam","Task","CV",function(a,b,c,d,e){a.info={pendwk_bk_expl:c.auth_data.pendwk_bk_expl,apply_bk_expl:"",form:{}},a.control={btnBus_loading:!1},a.submitRaForm=function(){if(a.control.btnBus_loading=!0,!e.valiForm(a.info.form.raForm))return a.control.btnBus_loading=!1,!1;var f=angular.copy(c.srv_req_data);f.submit_type=5,f.apply_bk_expl=a.info.apply_bk_expl,d.ExecuteTask(f,c.srv_req_data.org_srv_name).then(function(a){b.close({status:"system",message:"任务已提交，待审批",task_id:a.appdata.pend_work_seq})},function(c){a.control.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})})},a.cancel=function(){b.dismiss({status:"system",message:"手动取消任务申请"})}}]),modal_m.controller("CompareFileCtrl",["$scope","$modalInstance","$timeout","Exec","modalParam","EncodingType","ScriptDayNight","CodeMirrorOption","Modal",function(a,b,c,d,e,f,g,h,i){var j="",k="";a.can_not_save=!0,a.show_setting=!1,a.socWords="",a.tagWords="",a.upload_exist_flag=!1,a.btnBus_loading=!1,a.loading_config_file=!1,a.filePath=e.file_path,a.isEdit=e.is_edit?e.is_edit:!1,a.fileData={socWords:"",system:""},a.select_data={encoding:f,encoding_type:"GBK",day_night:g,script_day:"日间"},j=a.select_data.encoding_type,a.editorOptions={lineWrapping:!0,lineNumbers:!0,readOnly:!a.isEdit,mode:"text/x-properties"};var l=function(){d.getConfigFile(e.busi_sys_id,e.sys_publish_id,e.download_soc_ip,e.file_path,e.download_soc_name,a.select_data.encoding_type).then(function(b){a.fileData.socWords=b.config_string?b.config_string:"",a.upload_exist_flag=b.upload_exist_flag,a.fileData.socWords=Base64.decode(a.fileData.socWords),a.fileData.system=b.system,a.loading_config_file=!0;var c=a.$watch("fileData.socWords",function(b,d){b!=d&&(a.can_not_save=!1,c())})},function(c){i.alert(c.message,3),a.loading_config_file=!0,b.close(!1)})},m=function(){l()};a.fileEditorLoaded=function(b){h.setFileEditor(b,!a.isEdit)},a.scriptDayOrNight=function(b){return a.select_data.script_day==b?!1:(a.select_data.script_day=b,void h.dayOrNight())},a.changeCoding=function(b){return a.select_data.encoding_type=b,j==b?!1:(a.loading_config_file=!1,l(),void(j=b))},a.setFunc=function(){a.show_setting=!a.show_setting},a.hidenGroupList=function(){a.show_setting=!1},a.showAnimate=function(a){k=c(function(){$("."+a).animate({right:"2px"},200,"linear")},200)},a.hiddenAnimate=function(a){k&&c.cancel(k),k=c(function(){$("."+a).animate({right:"-130px"},200,"linear")},200)},a.ok=function(c){a.tagWords=c?Base64.encode(c):"",a.btnBus_loading=!0;var f={business_sys_name:e.busi_sys_id,syspublish_id:e.sys_publish_id,node_name:e.node_name,relative_path:e.file_path,config_string:a.tagWords,system:a.fileData.system,check_soc_name:e.check_soc_name,download_soc_name:e.download_soc_name,download_soc_ip:e.download_soc_ip,encoding:a.select_data.encoding_type,phase_type:e.phase_type,phase_no:e.phase_no?e.phase_no:0,quick_publish:e.quick_publish?e.quick_publish:2};d.saveConfigFile(f).then(function(a){i.alert("配置文件修改成功！",2),b.close(!0)},function(b){a.btnBus_loading=!1,i.alert(b.message,3)})},a.cancel=function(){i.confirm("确认退出当前操作吗？").then(function(){b.close(!1)})},c(function(){!function(a){a(".modal-content").draggable({cancel:".modal-body",cursor:"move"})}(jQuery)},1e3),m()}]),modal_m.controller("planNewGroupCtrl",["$scope","$modalInstance","$timeout","Plan","ProjectNature","Modal","CV",function(a,b,c,d,e,f,g){a.col="start_bk_time",a.desc=0,a.checked=!1,a.selectAll_flag=!1,a.newGroupList=[],a.form={},a.new_group_info={group_id:"",group_cn_name:"",proj_list:[]};var h=function(){d.getCanGroupProjList().then(function(b){c(function(){b.rows=b.pj_plan_list?b.pj_plan_list:"",a.newGroupList=b.rows;for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0,a.newGroupList[c].project_nature_cn=g.findValue(a.newGroupList[c].project_nature,e),a.newGroupList[c].pre_project_short_name=a.newGroupList[c].pre_project_short_name?a.newGroupList[c].pre_project_short_name:"无";for(var d=0;d<a.newGroupList.length;d++){if("无"===a.newGroupList[d].pre_project_short_name){a.selectAll_flag=!1;break}a.selectAll_flag=!0}},0)},function(a){f.alert(a.message,3)})};a.selectAll=function(b){if(b)for(var c=0;c<a.newGroupList.length;c++)"无"==a.newGroupList[c].pre_project_short_name&&(a.newGroupList[c].checked=1);else for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0},a.formSubmit=function(){if(!g.valiForm(a.form.new_group_form))return!1;a.new_btn_loading=!0;for(var e=0;e<a.newGroupList.length;e++)1==a.newGroupList[e].checked&&a.new_group_info.proj_list.push({project_name:a.newGroupList[e].project_name,business_sys_name:a.newGroupList[e].business_sys_name});return 0==a.new_group_info.proj_list.length?(f.alert("请至少选择一个项目",3),a.new_btn_loading=!1,!1):void d.saveOrUpdateGroup(a.new_group_info).then(function(d){c(function(){d&&(a.new_btn_loading=!1,f.alert("添加成功",2),b.close(!0))},0)},function(b){a.new_btn_loading=!1,f.alert(b.message,3)})},a.formCancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("planEditGroupCtrl",["$scope","$modalInstance","$timeout","Plan","ProjectNature","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h){var i=f.group_id,j={group_id:i,pro_bk_date:f.group_date};a.col="start_bk_time",a.desc=0,a.newGroupList=[],a.groupList=[],
a.all_checked=!1,a.form={},a.edit_group_info={group_id:"",group_cn_name:f.group_cn_name,proj_list:[]};var k=function(){d.getProjListByGroup(j).then(function(b){b.rows=b.pj_plan_list?b.pj_plan_list:[],a.groupList=b.rows;for(var c=0;c<a.groupList.length;c++)a.groupList[c].checked=1,a.groupList[c].project_nature_cn=h.findValue(a.groupList[c].project_nature,e),a.groupList[c].pre_project_short_name=a.groupList[c].pre_project_short_name?a.groupList[c].pre_project_short_name:"无"},function(a){g.alert(a.message,3)}),d.getCanGroupProjList().then(function(b){b.rows=b.pj_plan_list?b.pj_plan_list:"",a.newGroupList=b.rows;for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0,a.newGroupList[c].project_nature_cn=h.findValue(a.newGroupList[c].project_nature,e),a.newGroupList[c].pre_project_short_name=a.newGroupList[c].pre_project_short_name?a.newGroupList[c].pre_project_short_name:"无"},function(a){g.alert(a.message,3)})};a.selectAll=function(b){if(b){for(var c=0;c<a.newGroupList.length;c++)"无"==a.newGroupList[c].pre_project_short_name&&(a.newGroupList[c].checked=1);for(var c=0;c<a.groupList.length;c++)"无"==a.groupList[c].pre_project_short_name&&(a.groupList[c].checked=1)}else{for(var c=0;c<a.newGroupList.length;c++)a.newGroupList[c].checked=0;for(var c=0;c<a.groupList.length;c++)a.groupList[c].checked=0}},a.cancel=function(){a.all_checked=!1,k()},a.formSubmit=function(){if(!h.valiForm(a.form.edit_group_form))return!1;a.edit_btn_loading=!0;for(var e=0;e<a.newGroupList.length;e++)1==a.newGroupList[e].checked&&a.edit_group_info.proj_list.push({project_name:a.newGroupList[e].project_name,business_sys_name:a.newGroupList[e].business_sys_name});for(var e=0;e<a.groupList.length;e++)1==a.groupList[e].checked&&a.edit_group_info.proj_list.push({project_name:a.groupList[e].project_name,business_sys_name:a.groupList[e].business_sys_name});0==a.edit_group_info.proj_list.length?(a.edit_btn_loading=!1,g.confirm("您当前未选择任何项目，请确认是否要删除该分组").then(function(){a.edit_btn_loading=!0,a.edit_group_info.group_id=i,d.saveOrUpdateGroup(a.edit_group_info).then(function(d){c(function(){d&&(a.edit_btn_loading=!1,g.alert("删除成功",2),b.close(!0))},1e3)},function(b){a.edit_btn_loading=!1,g.alert(b.message,3)})})):(a.edit_group_info.group_id=i,d.saveOrUpdateGroup(a.edit_group_info).then(function(d){c(function(){d&&(a.edit_btn_loading=!1,g.alert("修改成功",2),b.close(!0))},0)},function(b){a.edit_btn_loading=!1,g.alert(b.message,3)}))},a.formCancel=function(){b.dismiss(!1)},k()}]),modal_m.controller("RollbackSummaryCtrl",["$scope","$modalInstance","$timeout","$location","Exec","User","Proj","ProjectNature","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){a.control={btnBus_loading:!1,show_user_flag:!1},a.form={},a.rollback_summary={business_sys_name:i.busi_sys,syspublish_id:i.publish_id,project_bk_evaluate:"",rollback_flag:i.rollback_flag,evaluate_user_cn_name:"",notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""},a.data={select_person:[],feedback_type_list:[{key:1,value:"邮件",state:!1},{key:2,value:"短信",state:!1}]},a.email_msg={project_name:"",project_short_name:"",business_sys_name:"",project_bk_desc:"",project_nature_cn:"",user_cn_name:"",pj_end_time:"",pj_start_time:"",prod_flag_cn:"",assess_time:"",assess_msg:""};var l=function(){var b=new Date;a.email_msg.prod_flag_cn=1==a.rollback_summary.rollback_flag?"成功":"失败",a.email_msg.assess_time=k.dtFormat(b)+" "+k.dttFormat(b),a.email_msg.assess_msg=a.rollback_summary.project_bk_evaluate,a.rollback_summary.feedback_msg=["<html><head></head><body>","<div>项目编号 ："+a.email_msg.project_name+"</div>",a.email_msg.project_short_name?"<div>项目简称 ："+a.email_msg.project_short_name+"</div>":"","<div>应用系统 ："+a.email_msg.business_sys_name+"</div>",a.email_msg.project_bk_desc?"<div>项目描述 ："+a.email_msg.project_bk_desc+"</div>":"",a.email_msg.project_nature_cn?"<div>发布类型 ："+a.email_msg.project_nature_cn+"</div>":"",a.email_msg.user_cn_name?"<div>执行用户 ："+a.email_msg.user_cn_name+"</div>":"","<div>开始时间 ："+a.email_msg.pj_start_time+"</div>","<div>结束时间 ："+a.email_msg.pj_end_time+"</div>","<div>回退结果 ："+a.email_msg.prod_flag_cn+"</div>","<div>评价时间 ："+a.email_msg.assess_time+"</div>","<div>回退信息 ："+a.email_msg.assess_msg+"</div>","</body>","</html>"].join("")},m=function(){e.getRollbackSummary(i.publish_id,i.busi_sys).then(function(b){console.log(b),b.rollback_evaluate_info&&(a.rollback_summary.assess_bk_seq=b.rollback_evaluate_info.assess_bk_seq,a.rollback_summary.project_bk_evaluate=b.rollback_evaluate_info.project_bk_evaluate,a.rollback_summary.evaluate_user_cn_name=b.rollback_evaluate_info.user_cn_name,a.rollback_summary.assess_bk_date=b.rollback_evaluate_info.assess_bk_date,a.rollback_summary.assess_bk_time=b.rollback_evaluate_info.assess_bk_time)},function(a){j.alert(a.message,3)}),f.getAllUserCanExec().then(function(b){c(function(){b.user_dept_list&&(a.data.select_person=b.user_dept_list)},0)},function(a){j.alert(a.message,3)})};a.chooseFeedBackType=function(b){b.state?a.control.show_user_flag=!0:(a.control.show_user_flag=!1,a.control.user_is_none=!1,a.rollback_summary.notice_users=[],a.rollback_summary.user_cn_name="")},a.addEmailAddress=function(b){var c=0;if(!b)return j.alert("收件人不能为空！",3),!1;if(0!=a.rollback_summary.notice_users.length)for(var d=0;d<a.rollback_summary.notice_users.length;d++){var e=a.rollback_summary.notice_users[d];if(e.user_cn_name==b)return j.alert("收件人已经添加过！请添加新收件人",3),a.rollback_summary.user_cn_name="",!1}for(var f=0;f<a.data.select_person.length;f++){var g=a.data.select_person[f];if(g.user_cn_name==b){c++,a.rollback_summary.notice_users.push(g);break}}0==c&&j.alert("用户不存在！请重新添加！",3),a.rollback_summary.user_cn_name=""},a.deleteSingleUser=function(b){a.rollback_summary.notice_users.splice(b,1)},a.formSubmit=function(){return k.valiForm(a.form.rollback_form)?(l(),a.control.btnBus_loading=!0,void e.editRollbackSummary(a.rollback_summary).then(function(c){j.alert("评价完成！",2),a.control.btnBus_loading=!1,b.close(c)},function(b){a.control.btnBus_loading=!1,j.alert(b.message,3)})):!1},a.formCancel=function(){b.dismiss(!1)},m()}]),modal_m.controller("SummaryCtrl",["$scope","$modalInstance","$location","$timeout","Exec","User","Proj","IssueType","ProjectNature","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.summary={business_sys_name:j.busi_sys,syspublish_id:j.publish_id,prod_flag:1,problem_type_list:[],project_evaluate_list:[],project_bk_evaluate:"",project_evaluate:{},notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""},a.control={btnBus_loading:!1,show_user_flag:!1},a.data={select_person:[],feedback_type_list:[{key:1,value:"邮件",state:!1},{key:2,value:"短信",state:!1}]},a.email_msg={syspublish_id:"",project_short_name:"",business_sys_name:"",project_bk_desc:"",project_nature_cn:"",user_cn_name:"",pj_end_time:"",pj_start_time:"",prod_flag_cn:"",assess_time:"",assess_msg:"",problem_type:""};var m=c.url(),n=m.substring(0,m.indexOf("/",10));"/finish_proj"==n&&(a.summary.prod_flag=2);var o=function(){var b=new Date,c=[];if(a.email_msg.prod_flag_cn=1==a.summary.prod_flag?"成功":"失败",a.email_msg.assess_time=l.dtFormat(b)+" "+l.dttFormat(b),a.email_msg.assess_msg=a.summary.project_bk_evaluate,0!=a.summary.problem_type_list.length){for(var d=0;d<a.summary.problem_type_list.length;d++)c.push(l.findValue(a.summary.problem_type_list[d],h));a.email_msg.problem_type=c.join("|")}a.summary.feedback_msg=["<html><head></head><body>","<div>项目编号 ："+a.email_msg.project_name+"</div>","<div>项目简称 ："+a.email_msg.project_short_name+"</div>","<div>应用系统 ："+a.email_msg.business_sys_name+"</div>","<div>项目描述 ："+a.email_msg.project_bk_desc+"</div>","<div>发布类型 ："+a.email_msg.project_nature_cn+"</div>","<div>执行用户 ："+a.email_msg.user_cn_name+"</div>","<div>开始时间 ："+a.email_msg.pj_start_time+"</div>","<div>结束时间 ："+a.email_msg.pj_end_time+"</div>","<div>发布结果 ："+a.email_msg.prod_flag_cn+"</div>","<div>评价时间 ："+a.email_msg.assess_time+"</div>","<div>评价信息 ："+a.email_msg.assess_msg+"</div>",a.email_msg.problem_type?"<div>问题类型 ："+a.email_msg.problem_type+"</div>":"","</body>","</html>"].join("")},p=function(){a.all_problem_type=angular.copy(h),e.showSummaryProd(j.busi_sys,j.publish_id).then(function(b){if(b.pj_evaluate_bean){a.summary.prod_flag=b.pj_evaluate_bean.prod_flag?b.pj_evaluate_bean.prod_flag:1,a.summary.problem_type_list=b.pj_evaluate_bean.problem_type_list?b.pj_evaluate_bean.problem_type_list:[];for(var c=0;c<a.all_problem_type.length;c++){var d=a.all_problem_type[c];-1==a.summary.problem_type_list.indexOf(d.key)?d.checked=!1:d.checked=!0}b.pj_evaluate_bean.projectAssessInfo&&(a.summary.project_evaluate=b.pj_evaluate_bean.projectAssessInfo,a.summary.project_bk_evaluate=a.summary.project_evaluate.project_bk_evaluate)}},function(a){k.alert(a.message,3)}),f.getAllUserCanExec().then(function(b){d(function(){b.user_dept_list&&(a.data.select_person=b.user_dept_list)},0)},function(a){k.alert(a.message,3)})};a.chooseFeedBackType=function(b){b.state?a.control.show_user_flag=!0:(a.control.show_user_flag=!1,a.control.user_is_none=!1,a.summary.notice_users=[],a.summary.user_cn_name="")},a.addEmailAddress=function(b){var c=0;if(!b)return k.alert("收件人不能为空！",3),!1;if(0!=a.summary.notice_users.length)for(var d=0;d<a.summary.notice_users.length;d++){var e=a.summary.notice_users[d];if(e.user_cn_name==b)return k.alert("收件人已经添加过！请添加新收件人",3),a.summary.user_cn_name="",!1}for(var f=0;f<a.data.select_person.length;f++){var g=a.data.select_person[f];if(g.user_cn_name==b){c++,a.summary.notice_users.push(g);break}}0==c&&k.alert("用户不存在！请重新添加！",3),a.control.user_is_none=!1,a.summary.user_cn_name=""},a.deleteSingleUser=function(b){a.summary.notice_users.splice(b,1)},a.ok=function(){a.summary.problem_type_list=[];for(var c=0;c<a.all_problem_type.length;c++)a.all_problem_type[c].checked&&a.summary.problem_type_list.push(a.all_problem_type[c].key);return a.control.show_user_flag&&0==a.summary.notice_users.length?(a.control.user_is_none=!0,!1):0==a.summary.problem_type_list.length&&2==a.summary.prod_flag?(k.alert("未选择问题类型！",3),!1):a.summary.project_bk_evaluate?(o(),a.control.btnBus_loading=!0,e.summaryProd(a.summary).then(function(c){k.alert("评价完成！",2),a.control.btnBus_loading=!1,b.close(c)},function(b){a.control.btnBus_loading=!1,k.alert(b.message,3)}),void 0):(k.alert("未填写总结评价！",3),!1)},a.cancel=function(){b.dismiss(!1)},p()}]),modal_m.controller("addPordPacModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h){var i=d.pac_index,j=d.pac_flag,k=d.pre_info.version_soc_name;a.control={package_list_flag:d.is_prod_list,show_real:!1,propackage_btn_loading:!1},a.info={packlist_info:angular.copy(d.pre_info),form:{},version_info:{soc_name:k,root_bk_dir:"",init_path:"/"!=d.propackage_bk_path?d.propackage_bk_path:"",loading:!1,full_path:""}},a.config={prodpackage_fileupload:{suffixs:"",filetype:"",filenames:[],uploadpath:d.fileupload_path},prodlist_fileupload:{suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:d.fileupload_path}};var l=function(){for(var b=!1,c=a.info.packlist_info.propackage_list[i].package_name_list,d=0;d<c.length;d++)for(var e=c[d],f=0;f<a.info.version_info.checked_files.length;f++){var g=a.info.version_info.checked_files[f];if(e.propackage_full_path.substring(e.propackage_full_path.lastIndexOf("/")+1,e.propackage_full_path.length)==g.file){b=!0;break}}return b},m=function(){for(var b=!1,c=a.info.packlist_info.propackage_list[i].package_name_list,d=0;d<c.length;d++){var e=c[d];if(e.propackage_full_path.substring(e.propackage_full_path.lastIndexOf("/")+1,e.propackage_full_path.length)==a.config.prodpackage_fileupload.filename){b=!0;break}}return b},n=function(){if(2==a.info.packlist_info.upload_flag)for(var b=0;b<a.info.version_info.checked_files.length;b++){var c=a.info.version_info.checked_files[b],d=c.path+"/"+c.file,e={propackage_full_path:d};a.info.packlist_info.propackage_list[i].package_name_list.push(e),a.info.packlist_info.propackage_list[i].propackage_full_path.push(d),a.info.packlist_info.propackage_list[i].package_list.push(c.file)}else for(var b=0;b<a.config.prodpackage_fileupload.filenames.length;b++){for(var f=a.config.prodpackage_fileupload.filenames[b],g=!1,h=a.config.prodpackage_fileupload.uploadpath+f,j=0;j<a.info.packlist_info.propackage_list[i].package_name_list.length;j++){var k=a.info.packlist_info.propackage_list[i].package_name_list[j].propackage_full_path;if(h==k){g=!0;break}}g||(a.info.packlist_info.propackage_list[i].package_name_list.push({propackage_full_path:h}),a.info.packlist_info.propackage_list[i].propackage_full_path.push(h),a.info.packlist_info.propackage_list[i].package_list.push(f))}},o=function(){a.info.version_info.checked_files=[],a.info.version_info.paths=[],a.info.version_info.active=!1,a.info.version_info.loading=!1},p=function(){2==a.info.packlist_info.upload_flag&&(a.control.package_list_flag?a.info.version_info.init_path="/"!=d.prolist_bk_path?d.prolist_bk_path:"":a.info.version_info.init_path="/"!=d.propackage_bk_path?d.propackage_bk_path:"",a.info.version_info.init_path?c(function(){a.control.show_real=!0},1e3):e.getFileListBySoc(k,a.info.version_info.init_path).then(function(b){o(),a.info.version_info.path_files=b.file_bean_list?b.file_bean_list:[],a.info.version_info.full_path=b.root_bk_dir?b.root_bk_dir:"",a.info.version_info.init_path=b.root_bk_dir?b.root_bk_dir:"",a.control.show_real=!0},function(a){g.alert(a.message,3),b.dismiss()}))};a.uploadProdListSuccessThen=function(){a.info.packlist_info.prolist_full_path=a.config.prodlist_fileupload.uploadpath+a.config.prodlist_fileupload.filename},a.removeProdListFile=function(){a.config.prodlist_fileupload.filename="",a.info.packlist_info.prolist_full_path=""},a.downloadProdListFile=function(){h.downloadFile(a.config.prodlist_fileupload.uploadpath+a.info.packlist_info.prolist_full_path.substring(a.info.packlist_info.prolist_full_path.lastIndexOf("/")+1,a.info.packlist_info.prolist_full_path.length))},a.removeProdPackage=function(){},a.downloadProdPackage=function(){},a.resetDpp=function(){a.control.package_list_flag?(a.info.packlist_info.prolist_full_path=d.pre_info.prolist_full_path,a.info.version_info.checked_files=[],a.changePath(a.info.version_info),1==a.info.packlist_info.upload_flag&&(a.config.prodlist_fileupload.filenames=[])):(a.info.version_info.checked_files=[],a.changePath(a.info.version_info),1==a.info.packlist_info.upload_flag&&(a.config.prodpackage_fileupload.filenames=[])),a.info.form.newDppForm.$setPristine()},a.prodPacSubmit=function(){if(!h.valiForm(a.info.form.newDppForm))return!1;if(a.control.package_list_flag){var c="";if(1==a.info.packlist_info.upload_flag&&!a.config.prodlist_fileupload.filename)return g.alert("请上传本地清单文件！"),!1;if(2==a.info.packlist_info.upload_flag&&0==a.info.version_info.checked_files.length)return g.alert("请选择清单文件！"),!1;a.info.version_info.checked_files&&a.info.version_info.checked_files.length>0&&(c=a.info.version_info.checked_files[0],a.info.packlist_info.prolist_full_path=a.info.version_info.full_path+"/"+c.file),a.control.propackage_btn_loading=!0;var d={prolist_full_path:a.info.packlist_info.prolist_full_path};b.close(d)}else{if(1==a.info.version_info.upload_flag&&0==a.config.prodpackage_fileupload.filenames.length)return g.alert("请上传本地发布包！"),!1;if(2==a.info.version_info.upload_flag&&0==a.info.version_info.checked_files.length)return g.alert("请选择发布包！"),!1;if(2==a.info.version_info.upload_flag){if(l())return g.alert("发布包已经存在!"),a.control.propackage_btn_loading=!1,!1}else if(1==a.info.upload_flag&&m())return g.alert("发布包已经存在!"),a.control.propackage_btn_loading=!1,!1;n(j),a.control.propackage_btn_loading=!0;var e={dpp_param_info:a.info.packlist_info,propackage_full_path:a.info.packlist_info.propackage_full_path};b.close(e)}a.control.propackage_btn_loading=!1},a.changePath=function(a){a.loading=!0,e.getFileListBySoc(k,a.full_path).then(function(b){a.loading=!1,a.path_files=b.file_bean_list?b.file_bean_list:[]},function(b){a.loading=!1,a.err_msg=b.message})},a.cancel=function(){b.dismiss()},p()}]),modal_m.controller("addPlatformPackageModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Exec","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h){var i=(d.pac_index,d.sys_publish_id);a.control={propackage_btn_loading:!1},a.data={dir_names:angular.copy(d.dir_names)||{}},a.configs={scroll_info:f},a.info={form:{},file_nodes:{nodes:angular.copy(d.dir_names.nodes)||[],choosed_file_list:[]}};var j=function(){};a.prodPacSubmit=function(){a.control.propackage_btn_loading=!0;for(var c=[],d=[],f=0;f<a.info.file_nodes.choosed_file_list.length;f++){var h=a.info.file_nodes.choosed_file_list[f];c.push(h.file_path),d.push(h.file)}e.savePlatFilePath(i,c).then(function(c){c&&(a.control.propackage_btn_loading=!1,b.close(d))},function(b){a.control.propackage_btn_loading=!1,g.alert(b.message,3)})},a.cancel=function(){b.dismiss()},j()}]),modal_m.controller("showHumanInteractCtrl",["$scope","$modalInstance","$timeout","$interval","modalParam","Modal","Exec","CmptFunc","CodeMirrorOption","CV",function(a,b,c,d,e,f,g,h,i,j){var k,l=e.execute_id,m=e.phaseId,n=e.steps;a.get_loading=!0,a.paramShellLoaded=function(b){i.showParamsEditor(b,a)},a.form={},a.interact_info={interact_msg:"",label_send_cmd_msg:"",send_cmd_msg:"",end_interact_flag:!1},a.data={interact_dialog_list:[],key_word_list:[]},a.scroll_dialog_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}};var o=function(){g.getMonitorInteractLogMsg(l,m).then(function(b){b.msg&&(a.data.interact_dialog_list.push({msg:h.stringToCmds(b.msg),type:1}),q()),b.param_list&&(a.data.key_word_list=r(b.param_list)),b.end_flag&&(a.interact_info.end_interact_flag=!0),a.get_loading=!1},function(a){d.cancel(k),f.alert(a.message,3)})},p=function(){for(var b=0;b<n.length;b++)for(var c=0;c<n[b].phase_list.length;c++){var d=n[b].phase_list[c];d.phase_no==m&&d.exe_script&&(a.interact_info.interact_msg=h.stringToCmds(d.exe_script))}},q=function(){c(function(){$(".dialog_wrap").mCustomScrollbar("scrollTo","bottom",{scrollEasing:"linear"})},200)},r=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.param_cn_name=d.param_cn_name?d.param_cn_name:"--",b.push({key:"${"+d.param_name+"}",text:"${"+d.param_name+"} ["+d.param_cn_name+"]"})}return b},s=function(){p(),k=d(function(){o()},3e3),a.$watch("interact_info.end_interact_flag",function(){a.interact_info.end_interact_flag&&d.cancel(k)})};a.toggleShowStyle=function(b){a.show_flag=b,b&&a.interact_info.send_cmd_msg&&(a.interact_info.label_send_cmd_msg="1111111111")},a.sendCmdMsg=function(){if(!a.interact_info.send_cmd_msg)return!1;var b=a.show_flag;g.sendInteractCmdMsg(l,m,a.interact_info.send_cmd_msg,b).then(function(c){a.data.interact_dialog_list.push({msg:a.interact_info.send_cmd_msg,type:2,show_flag:b}),q(),a.interact_info.send_cmd_msg=""},function(a){f.alert(a.message,3)})},a.cancel=function(c){1==c?(b.close(!0),d.cancel(k)):a.interact_info.end_interact_flag?(b.close(!0),d.cancel(k)):f.confirm("交互正在进行中,请确认是否退出交互并停止？").then(function(){b.close(!1),d.cancel(k)})},s()}]),modal_m.controller("chooseRollbackProgCtrl",["$scope","$modalInstance","$timeout","$sce","Exec","modalParam","Modal","CodeMirrorOption","BusiSys","ScrollConfig","BsysFunc","CmptFunc","ProtocolType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=f.business_sys_name,p=f.publish_id,q="",r="";a.form={},a.rollback_info={business_sys_name:o,syspublish_id:p,prepare_msg:{},prog_cn_name:"",prog_id:"",group_list:[],param_list:[],propackage_list:[]},a.data={node_list:[],rollBack_program_list:[],rollback_info_list:[]},a.control={get_prog_loading:!1,get_prog_list_loading:!1,soc_flag:!1,valid_prog_complete:!1,valid_prog_loading:!1,get_prog_complete:!1,get_node_list_loading:!1,btnBus_loading:!1,param_list_flag:!1},a.config={rollback_scroll:j},a.paramShellLoaded=function(b){h.setParamsEditor(b),c(function(){a.code_reflash=!0},0)},a.viewOptions=h.Sh(!0);var s=function(b){a.control.get_node_list_loading=!0,a.data.node_list=[];for(var d=b?b:[],e=0;e<d.length;e++)a.data.node_list.push({soc_ip:d[e],is_checked:!0});c(function(){a.control.get_node_list_loading=!1},1e3)},t=function(){a.control.get_prog_list_loading=!0,i.getAllProgramList(o,1,2).then(function(b){c(function(){b&&(a.control.get_prog_list_loading=!1,a.data.rollBack_program_list=b.program_list?b.program_list:[])},0)},function(b){g.alert(b.message,3),a.control.get_prog_list_loading=!1})},u=function(){e.getHistroyRollbackInfo(o,p).then(function(b){b&&(a.data.rollback_info_list=b.rollback_list?b.rollback_list:[])},function(a){})},v=function(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];3!=e.param_type&&c++}0==c&&(a.control.param_list_flag=!0)},w=function(b){for(var c=b?b:[],d=0;d<c.length;d++){var e=c[d];e.package_name_list=[],e.package_list=[],e.propackage_full_path=e.propackage_full_path?e.propackage_full_path:[];for(var f=0;f<e.propackage_full_path.length;f++)e.package_name_list.push({propackage_full_path:e.propackage_full_path[f]})}a.rollback_info.propackage_list=c},x=function(){for(var b=0;b<a.rollback_info.propackage_list.length;b++){var c=a.rollback_info.propackage_list[b];if(c.required_flag&&0==c.package_name_list.length){a.control.package_exsit_flag=!0;break}}return!a.control.package_exsit_flag},y=function(a,b){for(var c=0;c<a.package_name_list.length;c++){var d=a.package_name_list[c];z(d,b,a)}},z=function(b,c,d){d.add_pac_btn_disable=!0,b.is_exsit_loading=!0,b.no_exsit=!1,e.downloadProdListFile(o,_project_name,a.rollback_info.version_soc_name,b.propackage_full_path).then(function(a){b.is_exsit_loading=!1,d.add_pac_btn_disable=!1},function(a){d.add_pac_btn_disable=!1,b.is_exsit_loading=!1,b.no_exsit=!0,g.alert(a.message,3)})},A=function(){t(),u()};a.selectProgram=function(b){a.rollback_info.prog_id=b,a.rollback_info.propackage_list=[],a.control.valid_prog_complete=!1,a.control.valid_prog_loading=!0,a.control.get_prog_complete=!1,i.validateProgComplete(a.rollback_info.prog_id).then(function(b){c(function(){b&&(a.control.valid_prog_loading=!1,a.control.valid_prog_complete=!0,a.errorMessage="",a.control.get_prog_loading=!0,e.getReadyPacParamInfo(p,a.rollback_info.prog_id).then(function(b){console.log(b),b&&(a.rollback_info.prepare_msg=b.prepare_msg,a.rollback_info.version_soc_name=b.version_soc_name,a.rollback_info.upload_flag=b.version_soc_name?2:1,a.rollback_info.param_list=b.prepare_msg.param_list?b.prepare_msg.param_list:[],v(a.rollback_info.param_list),a.rollback_info.group_list=b.prepare_msg.group_list?b.prepare_msg.group_list:[],k.processProgDate(a.rollback_info.group_list,b.prepare_msg.pac_type_list),s(b.node_list),w(b.prepare_msg.pac_type_list),r=b.file_upload_path,q=b.dftpropac_bk_dir,a.control.get_prog_loading=!1,a.control.get_prog_complete=!0)},function(a){g.alert(a.message,3)}))},0)},function(b){a.valid_prog_error_msg=b.message,a.control.valid_prog_complete=!1,a.control.valid_prog_loading=!1})},a.changeFileFlag=function(b){a.rollback_info.upload_flag=b,a.control.validate_pac=!1,2==b&&(a.control.is_prolist_add=!1),angular.forEach(a.rollback_info.propackage_list,function(a){a.propackage_full_path=a.propackage_full_path?[]:[],a.package_name_list=a.package_name_list?[]:[]})},a.addProdPackage=function(b,c){a.control.validate_msg=!1,a.control.validate_pac=!1,g.prodPreAddProdPac(q,r,"",b,c,!1,a.rollback_info).then(function(c){c&&(a.rollback_info.propackage_list[b].package_name_list=c.dpp_param_info.propackage_list[b].package_name_list,a.rollback_info.propackage_list[b].propackage_full_path=c.dpp_param_info.propackage_list[b].propackage_full_path,a.rollback_info.propackage_list[b].package_list=c.dpp_param_info.propackage_list[b].package_list,2==a.rollback_info.upload_flag&&y(a.rollback_info.propackage_list[b],c))})},a.removeProdPackage=function(a,b,c){for(var d=c.propackage_full_path.substring(c.propackage_full_path.lastIndexOf("/")+1,c.propackage_full_path.length),e=0;e<a.length;e++){var f=a[e];if(f.package_type==b.package_type){for(var g=0;g<f.package_name_list.length;g++){var h=f.package_name_list[g];if(h.propackage_full_path==c.propackage_full_path){a[e].package_name_list.splice(g,1);break}}for(var g=0;g<f.package_list.length;g++){var i=f.package_list[g];if(i==d){a[e].package_list.splice(g,1);break}}for(var j=0;j<f.propackage_full_path.length;j++){var k=f.propackage_full_path[j];if(k==c.propackage_full_path){a[e].propackage_full_path.splice(j,1);break}}}}},a.downloadPackage=function(a){var b=r+a.propackage_full_path.substring(a.propackage_full_path.lastIndexOf("/")+1,a.propackage_full_path.length);n.downloadFile(b)},a.toggleModulesDetail=function(a,b){a.show_detail=!a.show_detail,b.nav_show_flag=l.judgeShowDetail(b.phase_list),b.expand_flag=2==b.nav_show_flag?!0:!1},a.expandCollapseAll=function(a){a.nav_show_flag=l.expandAllModules(a.phase_list)},a.colseCollapseAll=function(a){a.nav_show_flag=l.closeAllModules(a.phase_list)},a.getProtocolTypeCnName=function(a){return n.findValue(a,m).substring(0,5).toLowerCase()},a.saveRollbackInfo=function(){var c=[];if(0!=a.data.node_list.length){for(var d=0;d<a.data.node_list.length;d++)a.data.node_list[d].is_checked&&c.push(a.data.node_list[d].soc_ip);if(0==c.length)return g.alert("请先选择要回退的运行节点！",3),!1}var f=angular.copy(a.rollback_info);a.rollback_info.prepare_msg.group_list=f.prepare_msg.group_list,a.rollback_info.prepare_msg.param_list=f.prepare_msg.param_list,a.rollback_info.prepare_msg.pac_type_list=f.prepare_msg.pac_type_list?f.prepare_msg.pac_type_list:[];var h={syspublish_id:p,prepare_msg:a.rollback_info.prepare_msg,node_list:c};return n.valiForm(a.form.saveRollInfoForm)&&(0==a.rollback_info.propackage_list.length||x())?(a.control.btnBus_loading=!0,void e.saveReadyInfo(h).then(function(c){c&&(a.control.btnBus_loading=!1,b.close(!0))},function(b){a.control.btnBus_loading=!1,g.alert(b.message,3)})):!1},a.cancel=function(){b.dismiss()},A()}]),modal_m.controller("addMonitorLogCtrl",["$scope","$modalInstance","$timeout","modalParam","Exec","Collection","EncodingType","Modal",function(a,b,c,d,e,f,g,h){var i=d.business_sys_name,j=(d.project_name,d.environment_id),k=d.node;a.monitor_log_info={node_ip:"",checked_files:[]},a.data={node_list:[],encode_type_list:g,all_checked_list:[]},a.node={path_files:[],checked_files:[],paths:[]},a.control={node_loading:!1,is_update:!1};var l,m=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.lable=c.file_soc_username+"@"+c.ip,c.index=b}},n=function(){a.data.node_list=[],a.control.node_loading=!0,e.getDefinePhyInfo(i,j).then(function(b){b&&(a.control.node_loading=!1,a.data.node_list=b.phy_node_list?b.phy_node_list:[],m(a.data.node_list))},function(b){h.alert(b.message,3),a.control.node_loading=!1})},o=function(b){var c=b,d="";c=c.length>1&&c.lastIndexOf("/")==c.length-1?c.slice(0,c.length-1):c;var e=c.lastIndexOf("/");c?-1==e?a.node.paths=[c]:1==c.length&&0==e?a.node.paths=[c]:0==e?(d="/",a.node.paths=[c.slice(1)]):(d=c.slice(0,e+1),a.node.paths=[c.slice(e+1)]):a.node.paths=[]},p=function(){n(),k&&(a.data.all_checked_list=angular.copy(k))};a.getFileList=function(b){var c={};c=a.data.node_list[b],a.node.paths=[],a.node.path_files=[],a.node.init_path=c.init_path?c.init_path:"",a.node.check_soc_name=c.execute_soc_name,a.node.download_soc_name=c.file_soc_name,a.node.execute_ip=c.ip,a.node.err_msg="",a.node.loading=!0;var d={node_ip:b,label:c.lable,business_sys_name:i,soc_name:a.node.check_soc_name,checked_files:[]};l=b;var e=0;if(0==a.data.all_checked_list.length)d.checked_files=a.node.checked_files,a.data.all_checked_list.push(d);else{for(var g=0;g<a.data.all_checked_list.length;g++){var h=a.data.all_checked_list[g];h.node_ip==b?(a.node.checked_files=h.checked_files,e=1):h.node_ip!=b&&0==h.checked_files.length&&a.data.all_checked_list.splice(g--,1)}0==e&&(a.node.checked_files=[],d.checked_files=a.node.checked_files,a.data.all_checked_list.push(d))}f.getFileListBySoc(c.file_soc_name,a.node.init_path,c.ip).then(function(b){a.node.loading=!1,a.node.init_temp=b.root_bk_dir,a.node.init_path=a.node.init_temp,o(a.node.init_temp),a.node.path_files=b.file_bean_list?b.file_bean_list:[]},function(b){a.node.paths=[],a.node.init_path="",a.node.path_files=[],a.init_temp="",a.node.loading=!1,a.node.err_msg=b.message})},a.changePath=function(b){if(0!=a.data.all_checked_list.length)for(var d=0;d<a.data.all_checked_list.length;d++){var e=a.data.all_checked_list[d];e.node_ip==l&&(a.node.checked_files=e.checked_files)}b.loading=!0,c(function(){f.getFileListBySoc(b.download_soc_name,b.full_path,b.ip).then(function(a){b.loading=!1,b.path_files=a.file_bean_list?a.file_bean_list:[]},function(a){b.paths=[],b.loading=!1,b.err_msg=a.message})},0)},a.saveMonitorNode=function(){if(a.monitor_log_info.checked_files=a.node.checked_files,0==a.monitor_log_info.checked_files.length)return h.alert("请至少选择一个监控日志文件！",3),!1;for(var c=0;c<a.monitor_log_info.checked_files.length;c++)if(!a.monitor_log_info.checked_files[c].word_coding)return h.alert("请选择文件的编码方式！",3),!1;b.close(a.data.all_checked_list)},a.cancel=function(){b.dismiss()},p()}]),modal_m.controller("configExecNodeCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal","CV",function(a,b,c,d,e,f){var g=d.phase_info;a.phase_info={},a.control={is_parallel:!0,is_quick_publish:d.quick_publish?d.quick_publish:2},a.data={};var h=function(){a.phase_info=angular.copy(g),a.control.is_parallel=a.phase_info.parallel_flag};a.changeNodeExec=function(a,b){b.is_exec=!b.is_exec},a.saveConfigInfo=function(){a.phase_info.parallel_flag=a.control.is_parallel,b.close(a.phase_info)},a.cancel=function(){b.dismiss()},h()}]),modal_m.controller("changeExecResultCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal","CV",function(a,b,c,d,e,f){d.node_info;a.form={},a.result_info={msg:""},a.control={},a.data={};var g=function(){};a.saveResult=function(){return f.valiForm(a.form.new_result_form)?void b.close(a.result_info):!1},a.cancel=function(){b.dismiss(!1)},g()}]),modal_m.controller("viewfileFullScreenCtrl",["$scope","$modalInstance","$timeout","modalParam","CodeMirrorOption","Version","Modal","CV",function(a,b,c,d,e,f,g,h){var i;a.file_info=d.file_info?d.file_info:{},a.file_post_header=d.file_post_header?d.file_post_header:{},a.codemethod_loading=!1,a.detailFileOptions={lineWrapping:!0,lineNumbers:!0,scrollbarStyle:"simple",readOnly:!0,refresh:!1,mode:"text/x-properties"};var j=function(){c(function(){k(),a.detailFileOptions.refresh=!0},800),a.has_file_icon=a.file_info.file_type>=1&&a.file_info.file_type<4},k=function(){var a=$("#modal-codemirror .CodeMirror");if(a.is(":visible")){var b=$(window).height()-parseInt(a.offset().top)-15;a.height(b)}},l=function(){a.codemethod_loading=!0,f.viewfileContent(a.file_post_header).then(function(b){a.file_info.file_content=b.file_content?Base64.decode(b.file_content):"",a.file_info.file_size=b.file_size?b.file_size:"",a.file_info.file_update_time=b.file_update_time?b.file_update_time:"",a.detailFileOptions.refresh=!0,a.codemethod_loading=!1},function(b){a.codemethod_loading=!1})};a.formatFileIconStyle=function(){var b="";return b=1==a.file_info.file_type?"txt-icon":2==a.file_info.file_type||3==a.file_info.file_type?"excel-icon":9==a.file_info.file_type?"tar-icon":""},a.changeCodeMethod=function(){i=a.file_post_header.encoding_type,"UTF-8"===i&&(a.file_post_header.encoding_type="GBK"),"GBK"===i&&(a.file_post_header.encoding_type="UTF-8"),l()},a.downloadFile=function(){var b={file_absolute_path:a.file_post_header.absolute_path,file_path:a.file_post_header.file_path,version_num:a.file_post_header.version_num,business_sys_name:d.business_sys_name,is_dir:!1};f.downloadFile(b).then(function(a){c(function(){a.download_url&&h.downloadFile(a.download_url)},0)},function(a){})},a.formCancel=function(){b.dismiss(!1)},$(window).resize(function(){c(function(){k()},100)}),j()}]),modal_m.controller("setNormalWindowTimeCtrl",["$scope","$modalInstance","PubWindow","ScrollConfig","Modal","CV",function(a,b,c,d,e,f){a.dateObj={start_bk_datetime:f.dtFormat(new Date),end_bk_datetime:"",
cycle_type:0,cycles:[],minDate:new Date},a.control={opened:!1,startTimeFlag:!1,save_loading:!1,viewtime_error:""},a.config={scroll_info:d};var g=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.open_time=[parseInt(c.hh)<10?"0"+parseInt(c.hh):parseInt(c.hh),":",parseInt(c.mi)<10?"0"+parseInt(c.mi):parseInt(c.mi)].join("")}},h=function(){};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.control.opened=!0},a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1)},a.addCirlTime=function(){a.dateObj.errorM||a.dateObj.cycles.push({cycle_type:a.dateObj.cycle_type,cycle_number:1,hh:0,mi:0,duration:1})},a.changeTimeUnitType=function(b){a.dateObj.cycle_type=b,0==a.dateObj.cycles.length?a.dateObj.cycles.push({cycle_type:a.dateObj.cycle_type,cycle_number:1,hh:0,mi:0,duration:1}):(a.dateObj.cycles[a.dateObj.cycles.length-1].cycle_type=b,a.dateObj.cycles[a.dateObj.cycles.length-1].cycle_number=1)},a.$watch("dateObj",function(){a.dateObj.start_bk_datetime?a.control.startTimeFlag=!1:a.control.startTimeFlag=!0},!0),a.ok=function(){if(!a.control.startTimeFlag&&!a.dateObj.errorM){if(!a.dateObj.end_bk_datetime)return e.alert("结束时间不可为空",3),!1;if(0==a.dateObj.cycles.length)return e.alert("时间周期不可为空",3),!1;if(a.dateObj.start_bk_datetime&&a.dateObj.end_bk_datetime&&+a.dateObj.start_bk_datetime>+a.dateObj.end_bk_datetime)return e.alert("开始时间不可大于结束时间！",3),!1;g(a.dateObj.cycles),a.control.save_loading=!0,c.saveRoutineWindow(f.dtFormat(a.dateObj.start_bk_datetime),f.dtFormat(a.dateObj.end_bk_datetime),a.dateObj.cycles).then(function(c){console.log(c),a.control.save_loading=!1,b.close(!0)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})}},a.close=function(){b.dismiss(!1)},h()}]),modal_m.controller("setSpecialWindowTimeCtrl",["$scope","$modalInstance","ScrollConfig","PubWindow","Modal","CV",function(a,b,c,d,e,f){a.dateObj={cycles:[]},a.cus_date={date:"",minDate:new Date},a.control={save_loading:!1},a.config={scroll_info:c};var g=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.open_time=[parseInt(c.hh)<10?"0"+parseInt(c.hh):parseInt(c.hh),":",parseInt(c.mi)<10?"0"+parseInt(c.mi):parseInt(c.mi)].join("")}},h=function(){};a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1)},a.$watch("cus_date.date",function(){if(""!=a.cus_date.date&&a.cus_date.date){for(var b=a.cus_date.date.getFullYear()+"年"+(a.cus_date.date.getMonth()+1)+"月"+a.cus_date.date.getDate()+"日",c=f.dtFormat(a.cus_date.date),d=0;d<a.dateObj.cycles.length;d++){var g=a.dateObj.cycles[d];if(b==g.date_str)return e.alert("已经存在该日期！！！",3),!1}a.dateObj.cycles.push({hh:0,mi:0,open_date:c,date_str:b,duration:0})}},!0),a.ok=function(){if(!a.dateObj.errorM){if(0==a.dateObj.cycles.length)return e.alert("特殊日期不可为空",3),!1;g(a.dateObj.cycles),a.control.save_loading=!0,d.saveSpecialWindow(a.dateObj.cycles).then(function(c){a.control.save_loading=!1,b.close(!0)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})}},a.close=function(){b.dismiss(!1)},h()}]),modal_m.controller("setBlackWindowTimeCtrl",["$scope","$modalInstance","ScrollConfig","PubWindow","Modal","CV",function(a,b,c,d,e,f){a.dateObj={cycles:[],special_reason:""},a.cus_date={date:"",minDate:new Date},a.control={save_loading:!1},a.config={scroll_info:c};var g=function(){};a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1)},a.$watch("cus_date.date",function(){if(""!=a.cus_date.date&&a.cus_date.date){for(var b=f.dtFormat(a.cus_date.date),c=0;c<a.dateObj.cycles.length;c++){var d=a.dateObj.cycles[c];if(b==d)return e.alert("已经存在该日期！！！",3),!1}a.dateObj.cycles.push(b)}},!0),a.ok=function(){a.control.save_loading=!0,d.saveSpecialDayWindow(a.dateObj.special_reason,a.dateObj.cycles).then(function(c){a.control.save_loading=!1,b.close(a.dateObj)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})},a.close=function(){b.dismiss(!1)},g()}]),modal_m.controller("closeWindowCtrl",["$scope","$modalInstance","modalParam","PubWindow","Modal","CV",function(a,b,c,d,e,f){var g=c.window;a.form={},a.result_info={msg:""},a.control={save_loading:!1};var h=function(){};a.saveResult=function(){return f.valiForm(a.form.pub_window_form)?(g.close_reason=a.result_info.msg,a.control.save_loading=!0,void d.closePubWindow(g).then(function(c){a.control.save_loading=!1,b.close(!0)},function(b){a.control.save_loading=!1,e.alert(b.message,3)})):!1},a.cancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("viewWindowDetailCtrl",["$scope","$modalInstance","modalParam","ScrollBarConfig","ProjectStatus","Project","Modal","CV",function(a,b,c,d,e,f,g,h){var i=c.event;a.info={close_reason:i.close_reason,pjpublish_id:i.pjpublish_id,error_message:"",publish_info:{}},a.config={scroll:d.Y()},a.control={get_project_loading:!1};var j=function(){a.info.error_message="",a.control.get_project_loading=!0,f.viewReleaseApply(a.info.pjpublish_id).then(function(b){b&&(a.control.get_project_loading=!1,a.info.publish_info=b.publish_bean||{})},function(b){a.control.get_project_loading=!1,a.info.error_message=b.message})};a.close=function(){b.dismiss(!1)},j()}]),modal_m.controller("releaseAppAddProjectCtrl",["$scope","$modalInstance","modalParam","PubWindow","ProjectStatus","Modal","CV",function(a,b,c,d,e,f,g){a.info={error_message:"",proj_list:[]},a.control={proj_list_loading:!0};var h=function(){};a.formSubmit=function(){a.info.proj_list.length>0&&b.close(a.info.proj_list)},a.formCancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("prepareChooseCtrl",["$scope","$state","$modalInstance","modalParam","Modal","CV",function(a,b,c,d,e,f){d.syspublish_id,d.business_sys_name;a.info={},a.data={},a.control={};var g=function(){};a.goToExecute=function(){c.close(1)},a.cancel=function(){c.close(2)},g()}]),modal_m.controller("interactiveExecuteCtrl",["$scope","$timeout","$modalInstance","modalParam","EncodingType","ScrollBarConfig","CodeMirrorOption","Exec","Modal",function(a,b,c,d,e,f,g,h,i){var j,k=d.execute_id||"",l="",m="";a.info={phase_name:d.phase_desc||"交互式SQL",phase_info:{node_list:[]},curr_node:{}},a.data={encoding:e},a.control={refresh_codemirror:!1,show_setting:!1,close_monitor:!1,show_notification:!1},a.config={scroll_bar:{axis:"y",theme:"custom-dark",scrollbarPosition:"outside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},fileReadOnlyLoaded:g.Sql("nocursor"),fileEditLoaded:function(b){g.setSqlFileEditor(b),b.on("blur",function(){l=b.somethingSelected()?b.getSelection():""}),b.on("focus",function(){a.control.show_setting=!1})}};var n=function(a){var b="";return 1e3>a?b=a+"毫秒":(b=Math.floor(a/1e3)+"秒",b>60&&(b=Math.floor(a/1e3)/60+"分")),b},o=function(c,d){a.msg_notification=c||"",a.control.show_notification=!0,d=d||3,a.control.add_enter_class=!0,b(function(){a.control.add_enter_class=!1,a.control.add_leave_class=!0,b(function(){a.msg_notification="",a.control.show_notification=!1},500)},1e3*d)},p=function(a){b(function(){a.change_encoding_loading=!1},1e3)},q=function(a,b){b.page_option.start_recd=b.page_option.limit_recd*(a-1),b.page_tbodys=b.tbodys.slice(b.page_option.start_recd,b.page_option.start_recd+b.page_option.limit_recd)},r=function(){if(!a.control.close_monitor){var c=a.info.curr_node||{};console.log(c,"当前节点对象"),h.interactiveSqlExeMonitor(k).then(function(a){var d=a.sql_exe_msg;if(d){c.exe_info_list=c.exe_info_list||[],0===c.exe_info_list.length&&c.exe_info_list.unshift(d[0]);for(var e=[],g=0;g<d.length;g++){var h=d[g];if(c.node_ip===h.node_ip){h.theads=h.theads||[],h.tbodys=h.tbodys||[],h.exe_timeused_cn=n(h.exe_timeused||0),h.disbaled_operate_btn=!h.tran_flag,h.scroll_x=f.X(),h.page_tbodys=h.tbodys.length>5?h.tbodys.slice(0,5):h.tbodys,h.page_option={curr:1,all:1,all_recd:h.tbodys.length,count:5,start_recd:0,limit_recd:5,click:function(a){q(a,h)}};for(var i=!0,j=0;j<c.exe_info_list.length;j++){var k=c.exe_info_list[j];h.exe_id===k.exe_id&&(c.exe_info_list[j]=h,i=!1)}i&&e.unshift(h)}}c.exe_info_list=e.concat(c.exe_info_list),b(function(){r()},100)}},function(a){console.log(a.message)})}},s=function(){h.interactiveSqlGetNode(k).then(function(c){b(function(){a.info.phase_info.node_list=c.node_list||[];for(var b=0;b<a.info.phase_info.node_list.length;b++){var d=a.info.phase_info.node_list[b];d.file_list=d.file_list||[],d.exe_info_list=d.exe_history_list?d.exe_history_list.reverse():[];for(var e=0;e<d.exe_info_list.length;e++){var g=d.exe_info_list[e];g.theads=g.theads||[],g.tbodys=g.tbodys||[],g.scroll_x=f.X(),g.exe_timeused_cn=n(g.exe_timeused||0),g.disbaled_operate_btn=!g.tran_flag,g.page_tbodys=g.tbodys.length>5?g.tbodys.slice(0,5):g.tbodys,g.page_option={curr:1,all:1,all_recd:g.tbodys.length,count:5,start_recd:0,limit_recd:5,click:function(a){q(a,g)}}}for(var h=0;h<d.file_list.length;h++){var i=d.file_list[h];i.is_original_area=!1,i.delimiter=i.delimiter||";",i.encoding_type=i.encoding_type||"UTF-8",i.file_edit_content=i.file_content}}a.info.phase_info.node_list.length&&(a.info.curr_node=a.info.phase_info.node_list[0],r())},0)},function(a){i.alert(a.message,3)})};a.changeTab=function(c,d){m="",l="",a.hidenGroupList(),a.info.curr_node=c,c.curr_file_index=d||0,b(function(){a.control.refresh_codemirror=!a.control.refresh_codemirror},100)},a.changeCoding=function(a,b){return b.encoding_type=a,b.change_encoding_loading=!0,m===a?!1:(p(b),void(m=a))},a.hidenGroupList=function(){a.control.show_setting=!1},a.showAnimate=function(a){j=b(function(){$("."+a).animate({right:"2px"},200,"linear")},200)},a.hiddenAnimate=function(a){j&&(b.cancel(j),j=null),j=b(function(){$("."+a).animate({right:"-97px"},200,"linear")},200)},a.syncHeight=function(){return{height:$(".node-container").height()+"px"}},a.exeSql=function(a){l?(a.generate_sql_loading=!0,a.curr_file_index=a.curr_file_index||0,h.interactiveSqlExeSql(k,a.node_ip,a.file_list[a.curr_file_index].delimiter,l).then(function(c){b(function(){a.generate_sql_loading=!1},0)},function(a){o(a.message,2)})):o("请选择SQL",2)},a.firstSqlHeight=function(a){1===a.sql_statement_list.length&&(a.hide_more_btn=$(".sql-block .row:first-child").height()<=26)},a.expandOrCollapseMoreSql=function(a,b){a.show_sql_more=!a.show_sql_more;var c=$("#sql-block-"+b),d=c.height();if(a.show_sql_more){var e=c.css("height","auto").height();c.height(d).animate({height:e},500)}else c.animate({height:"24px"})},a.exeStatusToCn=function(a){var b="";switch(a){case 1:b="执行中";break;case 2:b="执行成功";break;case 3:b="执行出错";break;case 4:b="回滚成功";break;case 5:b="提交成功";break;default:b="执行中"}return b},a.sqlOperate=function(a,b){h.interactiveSqlSubmitOrRollback(k,b,a.exe_id).then(function(a){var c=1==b?"已提交":"已回滚";i.alert(c,1)},function(a){i.alert(a.message,3)})},a.cancel=function(){i.confirm("确认关闭"+a.info.phase_name+" ?").then(function(b){b&&(a.control.close_monitor=!0,h.interactiveSqlClose(k).then(function(a){a&&c.close(!0)},function(a){i.alert(a.message)}))})},a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.control.close_monitor=!0}),s()}]),modal_m.controller("viewCmptDetailModalCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","modalParam","CodeMirrorOption","CmptFunc","pluginType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=f.id;a.config={view_sh_options:g.Sh(!0),view_sql_options:g.Sql(!0),view_py_options:g.Python(!0),view_java_options:g.Java(!0)},a.control={cmpt_detail_loading:!1,error_message:!1},a.info={cmpt_info:{}};var m=function(){d.viewModulegetModuleDetail(l).then(function(b){c(function(){a.control.cmpt_detail_loading=!0,a.info.cmpt_info={id:l,publish_state:b.publish_state,cn_name:b.component.cn_name,bk_desc:b.component.bk_desc,impl_type:b.component.impl_type,impl_type_cn:k.findValue(b.component.impl_type,e),ref_flag:b.ref_flag,file_path:b.file_path,param_list:b.component.param_list||[],out_param_list:b.component.out_param_list||[],cmds:b.component.cmds||[],script_list:b.component.script_list||[],language_version:b.component.language_version,tag_list:b.component.tag_list||[],plugin_list:b.component.plugin_list||[]},a.info.cmpt_info.script_list.length>0&&a.info.cmpt_info.script_list[0].cmds&&angular.forEach(a.info.cmpt_info.script_list,function(a){a.exec_script=h.cmdsToString(a.cmds),a.active="default"==a.script_type?!0:!1,a.code_mirror_control=!1}),a.info.cmpt_info.exec_script=h.cmdsToString(a.info.cmpt_info.cmds),b.component.command&&b.component.command.cmds&&(a.info.cmpt_info.command={exec_script:h.cmdsToString(b.component.command.cmds),cmds:b.component.command.cmds})},0)},function(b){j.alert(b.message,3),a.control.error_message=!0})};a.getPluginTypeCnName=function(a){return k.findValue(a,i)},a.selectScript=function(b){c(function(){a.info.cmpt_info.script_list[b].code_mirror_control=!0},200)},a.closeModal=function(){b.dismiss(!1)},m()}]),modal_m.controller("CmptSysCtrl",["$scope","$modalInstance","$timeout","CmptSysType","Modal",function(a,b,c,d,e){a.form={},a.control={other_flag:!1},a.data={sys_list:d},a.info={},a.formSubmit=function(){var c=a.info.script_type?a.info.script_type:a.info.other_script_type?a.info.other_script_type:"";return c?void b.close(c):void e.alert("请选择或填写脚本类型",3)},a.cancel=function(){b.dismiss()},a.selectScriptType=function(b){b?(a.info.other_script_type="",c(function(){a.control.other_flag=!1},50)):a.control.other_flag=!0}}]),modal_m.controller("CmptClassifyLabelCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal",function(a,b,c,d,e){a.form={},a.data={cmpt_label_list:angular.copy(d.data?d.data:[])},a.info={},a.control={valid_length_falg:!1},a.selectLabel=function(b,c){b.flag=!b.flag,!b.flag&&b.is_new&&a.data.cmpt_label_list.splice(c,1)},a.addNewLabel=function(b){if(""!=b&&void 0!=b){if(console.log(b.length),b.length>=50)return void(a.control.valid_length_falg=!0);a.control.valid_length_falg=!1;for(var c=0;c<a.data.cmpt_label_list.length;c++){var d=a.data.cmpt_label_list[c];if(d.value===b)return}a.data.cmpt_label_list.push({value:b,is_new:!0,flag:!0}),a.info.label=""}},a.formSubmit=function(){b.close(a.data.cmpt_label_list)},a.cancel=function(){b.dismiss()}}]),modal_m.controller("addCmptModalCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h,i){a.info={high_search_obj:{exec_type_list:angular.copy(e),classify_list:[]},error_message:"",cmpt_type:g.cmpt_type,cmpt_flag:g.cmpt_flag,cmpts_list:[],cmpt_list:[]},a.control={cmpt_list_loading:!0,search_flag:!0,tags_more_flag:!1,classify_flag:!1};var j=function(){2==a.info.cmpt_type&&d.getPublishedCmpt(a.info.cmpt_type,a.info.cmpt_flag).then(function(b){c(function(){b&&(a.info.cmpts_list=b.comp_list?b.comp_list:[],a.control.cmpt_list_loading=!1)},0)},function(b){a.info.error_message=b.message}),d.selectAllTas().then(function(b){b&&c(function(){for(var c=b.tag_list?b.tag_list:[],d=0;d<c.length;d++)a.info.high_search_obj.classify_list.push({value:c[d],flag:!1})},0)},function(a){h.alert(a.message,3)})},k=function(){for(var a=0;a<arguments.length;a++)for(var b=0;b<arguments[a].length;b++)arguments[a][b]=angular.extend(arguments[a][b],{flag:!1})};a.clear=function(){a.search_key_word=""},a.clearData=function(){k(a.info.high_search_obj.classify_list,a.info.high_search_obj.exec_type_list),a.info.high_search_obj.key_word=""},a.cancelSeniorSearch=function(){a.control.search_flag=!0},a.changeSearchFlag=function(b){a.control.search_flag=!1,b.stopPropagation()},a.formSubmit=function(){var c=[];if(a.info.cmpt_list.length>0)for(var d=0;d<a.info.cmpt_list.length;d++){var e=a.info.cmpt_list[d];e.checked&&c.push(e.id)}if(a.info.cmpts_list.length>0)for(var f=0;f<a.info.cmpts_list.length;f++){var g=a.info.cmpts_list[f];1==g.checked&&c.push(g.id)}0==c.length?h.alert("请至少选择一组",3):b.close(c)},a.formCancel=function(){b.dismiss(!1)},a.countTagDivHeight=function(){c(function(){var b=$(".classify-tag-id").height();b>48?a.control.classify_flag=!0:a.control.classify_flag=!1},500)},j()}]),modal_m.controller("modifyPhaseCtrl",["$scope","$modalInstance","$timeout","CmptFunc","IML_TYPE","CodeMirrorOption","envManage","Plugin","modalParam","pluginType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n=1;a.form={},a.phase_info={is_update:1,impl_type:"",language_version:"",cn_name:"",exec_script:"",plugin_list:[],command:{cmds:[],exec_script:""}},a.control={cmpt_save_disabled:!1},a.data={subgroup_list:e,language_version_list:[],plugin_list:[],plugin_hint_list:[],ref_param_list:d.translateAllParam(i.ref_param_list)},a.shellLoaded=function(b){m=b,f.setEditor(b),m.on("keypress",function(){a.data.ref_param_list&&0!=a.data.ref_param_list.length?m.showHint({pluginKeys:a.data.plugin_hint_list.concat(a.data.ref_param_list)}):m.showHint()})},a.commandShellLoaded=function(b){f.setUniqueParamsEditor(b,n,a.data.plugin_hint_list)},a.commandNoneShellLoaded=function(b){f.setNoneParamsEditor(b,n,a.data.plugin_hint_list)},a.cmpt_accessory_fileupload={suffixs:"",filetype:"",filename:"",uploadpath:""};var o=function(b){h.getAllPluginList(b).then(function(b){b&&(a.data.plugin_list=b.plugin_list?b.plugin_list:[])},function(a){})},p=function(){g.getUploadPath().then(function(b){b&&(a.cmpt_accessory_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(a){})},q=function(){i.is_update&&2!=i.is_update||(a.phase_info.is_update=i.is_update,a.phase_info.impl_type=i.impl_type,o(a.phase_info.impl_type),(14==a.phase_info.impl_type||7==a.phase_info.impl_type||8==a.phase_info.impl_type)&&(a.data.language_version_list=["1.5","1.6","1.7","1.8"]),a.phase_info.language_version=i.language_version,n=a.phase_info.impl_type<6?1:6==a.phase_info.impl_type?4:7==a.phase_info.impl_type||8==a.phase_info.impl_type?2:14==a.phase_info.impl_type?3:1,a.phase_info.cn_name=i.cn_name,a.phase_info.exec_script=i.exec_script,a.phase_info.plugin_list=i.plugin_list?i.plugin_list:[],a.phase_info.annex_file=i.annex_file,a.phase_info.command=i.command,a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),a.cmpt_accessory_fileupload.filename=i.annex_file?i.annex_file.substring(i.annex_file.lastIndexOf("/")+1):"",c(function(){15!=a.phase_info.impl_type&&(m.setOption("mode",4==n?"text/x-sql":2==n?"text/x-python":3==n?"text/x-java":"text/x-sh"),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0||a.data.ref_param_list&&0!=a.data.ref_param_list.length?m.showHint({pluginKeys:a.data.plugin_hint_list.concat(a.data.ref_param_list)}):m.showHint()}))},100)),p()};a.chooseImplType=function(b){a.data.language_version_list=[],a.data.plugin_list=[],a.phase_info.plugin_list=[],a.data.plugin_hint_list=[],n=6>b?1:6==b?4:7==b||8==b?2:14==b?3:1,m.setOption("mode",4==n?"text/x-sql":2==n?"text/x-python":3==n?"text/x-java":"text/x-sh"),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0?m.showHint({pluginKeys:a.data.plugin_hint_list}):m.showHint()}),14==b||7==b||8==b?a.data.language_version_list=["1.5","1.6","1.7","1.8"]:a.phase_info.language_version="",o(b)},a.addAvailablePlugin=function(){if(0!=a.phase_info.plugin_list.length){for(var b=0;b<a.phase_info.plugin_list.length;b++)if(!a.phase_info.plugin_list[b].plugin_name)return k.alert("请选择插件名",3),!1;if(a.data.plugin_list.length==a.phase_info.plugin_list.length)return k.alert("无可再添加的插件！",3),!1}a.phase_info.plugin_list.push({plugin_name:"",plugin_type:"",plugin_file_name:"",plugin_bk_desc:""})},a.bindPluginInfo=function(b,c,e){for(var f={},g=0;g<a.phase_info.plugin_list.length;g++){var h=a.phase_info.plugin_list[g].plugin_name;if(f[h])return k.alert("插件已经添加！",3),a.phase_info.plugin_list.splice(c,1),!1;f[h]=1}for(var i=0;i<a.data.plugin_list.length;i++){var j=a.data.plugin_list[i];if(b==j.plugin_name){e.plugin_type=j.plugin_type,e.plugin_file_name=j.plugin_file_name,e.plugin_bk_desc=j.plugin_bk_desc;break}}a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0||a.data.ref_param_list&&0!=a.data.ref_param_list.length?m.showHint({pluginKeys:a.data.plugin_hint_list.concat(a.data.ref_param_list)}):m.showHint()})},a.getPluginTypeCnName=function(a){return l.findValue(a,j)},a.deleteSinglePlugin=function(b){var c=a.phase_info.plugin_list[b].plugin_name;c?k.confirm("确认是否要删除[ "+c+" ]插件?").then(function(){a.phase_info.plugin_list.splice(b,1),a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0?m.showHint({pluginKeys:a.data.plugin_hint_list}):m.showHint()})}):(a.phase_info.plugin_list.splice(b,1),a.data.plugin_hint_list=d.translatePluginHint(a.phase_info.plugin_list),m.on("keypress",function(){a.data.plugin_hint_list&&a.data.plugin_hint_list.length>0?m.showHint({pluginKeys:a.data.plugin_hint_list}):m.showHint()}))},a.ImportAccessorySuccessThen=function(){a.phase_info.annex_file=a.cmpt_accessory_fileupload.uploadpath+"/"+a.cmpt_accessory_fileupload.filename},a.removeAccessoryFile=function(){a.cmpt_accessory_fileupload.filename="",a.phase_info.annex_file=""},a.downloadAccessoryFile=function(){l.downloadFile(a.phase_info.annex_file)},a.savePhase=function(){return l.valiForm(a.form.new_phase_form)?(a.phase_info.cmds=d.stringToCmds(a.phase_info.exec_script),a.phase_info.command&&a.phase_info.command.exec_script&&(a.phase_info.command.cmds=d.stringToCmds(a.phase_info.command.exec_script)),a.phase_info.phase_type=3,b.close(a.phase_info),void(a.show_phase=!1)):!1},a.formCancel=function(){b.dismiss(!1)},a.downLoadPlugin=function(a){l.downloadFile(a)},q()}]),modal_m.controller("programCurConfigCtrl",["$scope","$modalInstance","$timeout","modalParam","NodeReform","Collection","BusiSys","ProtocolType","Sys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=d.business_sys_name,n=d.node_soc_list?angular.copy(d.node_soc_list):[],o="";a.info={node_info:{logical_node_id:"",logical_node_name:"",node_list:[],node_soc_list:[]},node_dir:{path_files:[],checked_files:[],paths:[],init_path:""},form:{}},a.data={logic_node_list:[]},a.control={node_loading:!1,is_update:!1};var p=function(b){var c=b,d="";c=c.length>1&&c.lastIndexOf("/")==c.length-1?c.slice(0,c.length-1):c;var e=c.lastIndexOf("/");c?-1==e?a.info.node_dir.paths=[c]:1==c.length&&0==e?a.info.node_dir.paths=["/"]:0==e?(d="/",a.info.node_dir.paths=[c.slice(1)]):(d="/",a.info.node_dir.paths=c.slice(1).split("/")):a.info.node_dir.paths=[]},q=function(){if(a.data.logic_node_list=d.logic_node_list?d.logic_node_list:[],0!=n.length){var b=n[0];l=b.logical_node_id,a.info.node_info.logical_node_id=b.logical_node_id,a.info.node_info.logical_node_name=b.logical_node_name,a.getFileList(a.info.node_info.logical_node_id,a.info.node_info.logical_node_name)}};a.getFileList=function(b,c){0!=a.info.node_info.node_soc_list.length&&(a.info.node_info.node_soc_list[0].checked_files=[]),a.info.node_info.logical_node_name=c,a.info.node_dir.paths=[],a.info.node_dir.loading=!0,a.info.node_dir.init_path="",i.getRemoteDirectory(m,b,a.info.node_dir.init_path).then(function(b){b&&(a.info.node_dir.loading=!1,o=b.root_bk_dir,a.info.node_dir.init_path=o,p(o),a.info.node_dir.path_files=b.file_bean_list?b.file_bean_list:[])},function(b){a.info.node_dir.loading=!1,a.info.node_dir.err_msg=b.message})},a.changePath=function(){a.info.node_dir.loading=!0,0==n.length&&(a.info.node_info.node_soc_list=[]),i.getRemoteDirectory(m,a.info.node_info.logical_node_id,a.info.node_dir.full_path).then(function(b){if(b)if(a.info.node_dir.loading=!1,a.info.node_dir.path_files=b.file_bean_list?b.file_bean_list:[],0==n.length){var c={logical_node_name:a.info.node_info.logical_node_name,logical_node_id:a.info.node_info.logical_node_id,file_list:[],checked_files:[]};c.checked_files=a.info.node_dir.checked_files,a.info.node_info.node_soc_list.push(c)}else if(l==a.info.node_info.logical_node_id){var d=n[0];d.checked_files=[],d.file_list=d.file_list?d.file_list:[];for(var e=0;e<d.file_list.length;e++){var f=d.file_list[e];d.checked_files.push({path:f.substring(0,f.lastIndexOf("/")),file:f.substring(f.lastIndexOf("/")+1)})}a.info.node_info.node_soc_list=n,a.info.node_dir.checked_files=a.info.node_info.node_soc_list[0].checked_files}else{a.info.node_info.node_soc_list=[];var c={logical_node_name:a.info.node_info.logical_node_name,logical_node_id:a.info.node_info.logical_node_id,file_list:[],checked_files:[]};c.checked_files=a.info.node_dir.checked_files,a.info.node_info.node_soc_list.push(c)}},function(b){a.info.node_dir.loading=!1,a.info.node_dir.err_msg=b.message})},a.saveData=function(){if(!k.valiForm(a.info.form))return!1;var c=a.info.node_info.node_soc_list[0];if(!c||0==c.checked_files.length)return void j.alert("请选择文件",3);c.file_list=[],c.files_list=[];for(var d=0;d<c.checked_files.length;d++)"/"==c.checked_files[d].path.charAt(0)&&"/"==c.checked_files[d].path.charAt(1)?(c.file_list.push(c.checked_files[d].path.substring(2)+"/"+c.checked_files[d].file),c.files_list.push({file:c.checked_files[d].path.substring(2)+"/"+c.checked_files[d].file,ready_flag:!0})):(c.file_list.push(c.checked_files[d].path+"/"+c.checked_files[d].file),c.files_list.push({file:c.checked_files[d].path+"/"+c.checked_files[d].file,ready_flag:!0}));b.close(a.info.node_info.node_soc_list)},a.cancel=function(){b.dismiss()},q()}]),modal_m.controller("programManualPhaseCtrl",["$scope","$modalInstance","ScrollConfig","$sce","$timeout","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h){var i=f.script;a.info={manual:{},form:{},manual_phase_form:{}},a.config={scroll_info:c},a.info.manual.script="",a.control={link_show_flag:!1};var j=function(){i&&(a.info.manual.script=f.script.cmds[0],e(function(){$("#manual_id").html(a.info.manual.script)},300))},k=function(a,b){var c,d;if(window.getSelection){if(c=window.getSelection(),c.getRangeAt&&c.rangeCount){d=c.getRangeAt(0),d.deleteContents();var e=document.createElement("div");e.innerHTML=a;for(var f,g,h=document.createDocumentFragment();f=e.firstChild;)g=h.appendChild(f);var i=h.firstChild;d.insertNode(h),g&&(d=d.cloneRange(),d.setStartAfter(g),b?d.setStartBefore(i):d.collapse(!0),c.removeAllRanges(),c.addRange(d))}}else if((c=document.selection)&&"Control"!=c.type){var j=c.createRange();j.collapse(!0),c.createRange().pasteHTML(a),b&&(d=c.createRange(),d.setEndPoint("StartToStart",j),d.select())}};a.saveUrl=function(){if(!h.valiForm(a.info.form))return!1;var b=$("#manual_id").html();$("#manual_id").text()||(b=$("#manual_id").html().replace(/<br>/g,"")),$("#manual_id").html(b+'[<a href="'+a.info.manual.link_url+'" title="'+a.info.manual.link_url+'" target="_blank">'+a.info.manual.link_intro+"</a>]"),a.info.manual.link_intro="",a.info.manual.link_url="",a.info.form.$setPristine(),a.control.link_show_flag=!1},a.deleteUrl=function(){a.control.link_show_flag=!1,a.info.manual.link_intro="",a.info.manual.link_url=""},a.saveData=function(){var a=$("#manual_id").html();return""==$("#manual_id").text()?void g.alert("请输入内容",3):void b.close(a)},a.changeLine=function(a){13==a.keyCode&&k("<br>",!1)},a.cancel=function(){b.dismiss(!1)},e(function(){$("[contenteditable]").each(function(){try{document.execCommand("AutoUrlDetect",!1,!1)}catch(a){}$(this).on("paste",function(a){a.preventDefault();var b=null;if(b=window.clipboardData&&clipboardData.setData?window.clipboardData.getData("text"):(a.originalEvent||a).clipboardData.getData("text/plain")||prompt("在这里输入文本"),document.body.createTextRange){if(document.selection)var c=document.selection.createRange();else if(window.getSelection){var d=window.getSelection(),e=d.getRangeAt(0),f=document.createElement("span");f.innerHTML="&#FEFF;",e.deleteContents(),e.insertNode(f),c=document.body.createTextRange(),c.moveToElementText(f),f.parentNode.removeChild(f)}c.text=b,c.collapse(!1),c.select()}else document.execCommand("insertText",!1,b)}),$(this).on("keydown",function(a){if(a.ctrlKey||a.metaKey)switch(a.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:a.preventDefault()}})})},0),j()}]),modal_m.controller("programBatchConfigCtrl",["$scope","$modalInstance","$timeout","modalParam","ScrollConfig","NodeReform","BusiSys","ProtocolType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k,l=[],m=[],n=d.control,o=d.business_sys_name,p=d.srv_soc?d.srv_soc:[];a.form={},a.config={scroll_info:e},a.data_deal_info={},a.controls={next_step_flag:!1,operate_btn:1,copy_flag:!0,ip_loading:!1,soc_flag:!0,soc_config_type:1,check_phase_flag:!1,deal_loading:!1},a.data={copy_soc_list:[],phase_item:[]},a.program_info={group_list:[]},a.scroll_config_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:500,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},a.normal_ip_list=[],a.extra_ip_list=[],a.source_list=[],a.reqData={imply_type:"",two_soc_loading:!1,business_sys_name:o,two_soc:!1,check_ip:"",search_ver_key:"",protocol_type:"",normal_ip_list:[],extra_ip_list:[],ip_data_list:[],mid_ip_list:[],search_key_work:"",srv_soc:[],copy_soc_list:[]},a.sourceType_color=[{s_type:1,color:"#88B8FE",bg:"#F5F9FE"},{s_type:5,color:"#7BADA4",bg:"#D2F6EE"},{s_type:9,color:"#FC973E",bg:"#FFF4ED"},{s_type:10,color:"#88B8FE",bg:"#EAF8FC"},{s_type:14,color:"#FC973E",bg:"#FFF4ED"}];var q=function(){for(var b=0;b<d.group_list.length;b++){d.group_list[b].group_index=b;for(var c=0;c<d.group_list[b].phase_list.length;c++)d.group_list[b].phase_list[c].phase_index=c,d.group_list[b].phase_list[c].select_flag=!1}m=d.group_list,a.program_info.group_list=angular.copy(d.group_list)},r=function(b){for(var c=0;c<a.reqData.normal_ip_list.length;c++)b.exe_ip==a.reqData.normal_ip_list[c].exe_ip&&(a.reqData.normal_ip_list[c].is_show=!1)},s=function(b){if(1==a.controls.soc_config_type)if(a.reqData.two_soc){for(var c=0;c<a.reqData.extra_ip_list.length;c++)if(!a.reqData.extra_ip_list[c].delete_flag){var d={};d.exe_ip=a.reqData.extra_ip_list[c].exe_ip,d.exe_soc_list=[],d.ver_soc_list=[];for(var e=0;e<a.reqData.extra_ip_list[c].exe_soc_list.length;e++)d.exe_soc_list.push({soc_name:a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.extra_ip_list[c].exe_soc_list[e].state&&(d.exe_soc_name=a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,d.exe_protocol_type=a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type);for(var f=0;f<a.reqData.extra_ip_list[c].ver_ip_list.length;f++)if(a.reqData.extra_ip_list[c].ver_ip_list[f].is_check){d.ver_ip=a.reqData.extra_ip_list[c].ver_ip_list[f].ver_ip;for(var g=0;g<a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list.length;g++)d.ver_soc_list.push({soc_name:a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].ver_soc_name,protocol_type:a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].protocol_type}),a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].state&&(d.ver_soc_name=a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].ver_soc_name,d.ver_protocol_type=a.reqData.extra_ip_list[c].ver_ip_list[f].ver_soc_list[g].protocol_type);break}d.exe_soc_name&&d.ver_soc_name&&(d.execute_ip=d.exe_ip,d.execute_soc_name=d.exe_soc_name,d.execute_protocol_type=d.exe_protocol_type,d.support_soc_name=d.ver_soc_name,d.support_ip=d.ver_ip,d.support_protocol_type=d.ver_protocol_type,a.reqData.srv_soc.push(d))}}else for(var c=0;c<a.reqData.normal_ip_list.length;c++)if(a.reqData.normal_ip_list[c].is_show){var h={};h.exe_soc_list=[],h.exe_ip=a.reqData.normal_ip_list[c].exe_ip;for(var e=0;e<a.reqData.normal_ip_list[c].exe_soc_list.length;e++)h.exe_soc_list.push({soc_name:a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.normal_ip_list[c].exe_soc_list[e].state&&(h.exe_soc_name=a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,h.exe_protocol_type=a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type);h.exe_soc_name&&(h.execute_ip=h.exe_ip,h.execute_soc_name=h.exe_soc_name,h.execute_protocol_type=h.exe_protocol_type,a.reqData.srv_soc.push(h))}for(var i=1==a.controls.soc_config_type?a.reqData.srv_soc:a.reqData.copy_soc_list,c=0;c<b.length;c++)for(var j=b[c],e=0;e<j.phase_list.length;e++)j.phase_list[e].select_flag&&(j.phase_list[e].node_soc_list=i);
},t=function(b,c){a.data.copy_soc_list=[];for(var d=0,e=0;e<b.length;e++)for(var f=0;f<b[e].phase_list.length;f++){var g=b[e].phase_list[f];g.node_soc_list&&0!=g.node_soc_list.length&&c==g.impl_type&&(a.data.copy_soc_list.push({phase_name:g.phase_name,node_soc_list:g.node_soc_list,status:!1,phase_type:g.phase_type,copy_index:d}),d++)}},u=function(b){for(var c=[],d=a.data_deal_info.group_index,e=a.data_deal_info.phase_index,f=0;f<a.program_info.group_list.length;f++){var g=a.program_info.group_list[f];if(g.state)c=c.concat(angular.copy(g.phase_list));else for(var h=0;h<g.phase_list.length;h++)g.phase_list[h].select_flag&&c.push(angular.copy(g.phase_list[h]))}var i=b[d].phase_list.slice(0,e+1),j=b[d].phase_list.slice(e+1);b[d].phase_list=i.concat(c).concat(j)},v=function(){u(l)},w=function(){a.controls.ip_loading=!0,(a.reqData.imply_type>2&&a.reqData.imply_type<6||14==a.reqData.imply_type||15==a.reqData.imply_type)&&(a.reqData.two_soc=!0),a.reqData.ip_data_list=[],a.reqData.normal_ip_list=[],a.reqData.extra_ip_list=[],f.getIpWithProtocolAndSoc(o,a.reqData.imply_type).then(function(b){a.controls.ip_loading=!1;for(var c=b.node_list?b.node_list:[],d=0;d<c.length;d++){var e=c[d];a.reqData.ip_data_list.push(e.node_ip),a.reqData.two_soc||a.reqData.normal_ip_list.push({exe_ip:e.node_ip,exe_soc_list:[],is_show:!1,exe_soc_name:""})}for(var f=0;f<p.length;f++){if(!p[f].exe_soc_list){p[f].exe_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].exe_ip&&(p[f].exe_soc_list=c[g].exe_soc_list)}if(!p[f].ver_soc_list){p[f].ver_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].ver_ip&&(p[f].ver_soc_list=c[g].ver_soc_list)}}if(a.reqData.two_soc){for(var d=0;d<p.length;d++){for(var h=0;h<p[d].ver_soc_list.length;h++)p[d].ver_soc_list[h].ver_soc_name=p[d].ver_soc_list[h].soc_name,p[d].ver_soc_name==p[d].ver_soc_list[h].soc_name?p[d].ver_soc_list[h].state=!0:p[d].ver_soc_list[h].state=!1;for(var h=0;h<p[d].exe_soc_list.length;h++)p[d].exe_soc_list[h].exe_soc_name=p[d].exe_soc_list[h].soc_name,p[d].exe_soc_name==p[d].exe_soc_list[h].soc_name?p[d].exe_soc_list[h].state=!0:p[d].exe_soc_list[h].state=!1}for(var d=0;d<p.length;d++){for(var i=[],h=0;h<a.reqData.ip_data_list.length;h++)a.reqData.ip_data_list[h]==p[d].ver_ip?i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!0,ver_soc_list:p[d].ver_soc_list}):i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!1,ver_soc_list:[]});a.reqData.extra_ip_list.push({exe_ip:p[d].exe_ip,exe_soc_list:p[d].exe_soc_list,is_show:!1,delete_flag:!1,exe_soc_name:p[d].exe_soc_name,ver_ip_list:i,ver_ip:p[d].ver_ip})}}else for(var d=0;d<p.length;d++)for(var h=0;h<a.reqData.normal_ip_list.length;h++)if(p[d].exe_ip==a.reqData.normal_ip_list[h].exe_ip){a.reqData.normal_ip_list[h].is_show=!0,a.reqData.normal_ip_list[h].exe_soc_list=[],a.reqData.normal_ip_list[h].exe_soc_name=p[d].exe_soc_name;for(var j=0;j<p[d].exe_soc_list.length;j++)p[d].exe_soc_list[j].soc_name==p[d].exe_soc_name?a.reqData.normal_ip_list[h].exe_soc_list.push({state:!0,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type}):a.reqData.normal_ip_list[h].exe_soc_list.push({state:!1,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type})}},function(b){a.controls.ip_loading=!1,i.alert(b.message,3)})},x=function(b){for(var c=0;c<b.length;c++){var d=b[c];if(d.state)d.phase_list=[],d.owner_flag&&(n.owner_btn_flag=!0);else for(var e=0;e<d.phase_list.length;e++)d.phase_list[e].select_flag&&(5==d.phase_list[e].phase_type&&4==a.controls.operate_btn&&(n.owner_btn_flag=!0),d.phase_list.splice(e--,1))}};a.getPhaseItem=function(b){if(a.data.phase_item=[],1==a.controls.operate_btn)a.data.phase_item=a.program_info.group_list[b].phase_list;else{l=angular.copy(a.program_info.group_list),x(l);for(var c=0;c<l[b].phase_list.length;c++){var d=l[b].phase_list[c];d.phase_index=c}a.data.phase_item=l[b].phase_list}},a.clearVerIp=function(){a.reqData.search_ver_key=""},a.locationVerword=function(){for(var b=0,c=0;c<a.reqData.extra_ip_list.length;c++)if(a.reqData.extra_ip_list[c].exe_ip==a.reqData.check_ip){b=c;break}if(a.reqData.mid_ip_list=[],""==a.reqData.search_ver_key)for(var c=0;c<a.reqData.ip_data_list.length;c++)a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c]);else for(var c=0;c<a.reqData.ip_data_list.length;c++){var d=a.reqData.ip_data_list[c].indexOf(a.reqData.search_ver_key);-1!=d&&a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c])}for(var c=0;c<a.reqData.mid_ip_list.length;c++){for(var e=a.reqData.mid_ip_list[c],d=!1,f=0;f<a.reqData.extra_ip_list[b].ver_ip_list.length;f++)e==a.reqData.extra_ip_list[b].ver_ip_list[f].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.push({ver_ip:e,ver_soc_list:[],is_check:!1})}for(var c=a.reqData.extra_ip_list[b].ver_ip_list.length-1;c>=0;c--)if(!a.reqData.extra_ip_list[b].ver_ip_list[c].is_check){for(var d=!1,f=0;f<a.reqData.mid_ip_list.length;f++)a.reqData.mid_ip_list[f]==a.reqData.extra_ip_list[b].ver_ip_list[c].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.splice(c,1)}},a.checkNodeIP=function(b){if(b.is_show=!b.is_show,0==b.exe_soc_list.length){b.is_loading=!0;var c=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;""==o?Cmpt.getAllSocList(b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,i.alert(a.message,3)}):g.getSocListByIpAndBsys(o,b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,i.alert(a.message,3)})}b.is_show||r(b)},a.click_dataSource=function(b,c,d){b.state=!b.state;for(var e=0;e<a.reqData.normal_ip_list.length;e++)if(a.reqData.normal_ip_list[e].exe_ip==c)for(var f=0;f<a.reqData.normal_ip_list[e].exe_soc_list.length;f++)f!=d&&(a.reqData.normal_ip_list[e].exe_soc_list[f].state=!1)},a.selectTwo=function(){c(function(){a.addNodeIp(a.reqData.search_key_work)},10)},a.addNodeIp=function(b){if(""!=b){for(var c=!1,d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip==b&&(c=!0);if(!c){a.reqData.check_ip=b;for(var e=[],f="",h=[],d=0;d<a.reqData.ip_data_list.length;d++)h.push({ver_ip:a.reqData.ip_data_list[d],is_check:!1,ver_soc_list:[]});""==o?Cmpt.getAllSocList(b,2).then(function(c){for(var d=c.source_list?c.source_list:[],g=0;g<d.length;g++)new RegExp("agent").test(d[g])?(f.exe_soc_name=d[g],e.push({exe_soc_name:d[g].soc_name,state:!0,protocol_type:d[g].protocol_type})):e.push({exe_soc_name:d[g].soc_name,state:!1,protocol_type:d[g].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:[],ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:[],ver_ip:""}),i.alert(error.message,3)}):g.getSocListByIpAndBsys(o,b,2).then(function(c){for(var d=c.source_list?c.source_list:[],g=0;g<d.length;g++)new RegExp("agent").test(d[g])?(f.exe_soc_name=d[g],e.push({exe_soc_name:d[g].soc_name,state:!0,protocol_type:d[g].protocol_type})):e.push({exe_soc_name:d[g].soc_name,state:!1,protocol_type:d[g].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:h,ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:e,is_show:!0,delete_flag:!1,exe_soc_name:f,ver_ip_list:h,ver_ip:""}),i.alert(error.message,3)});for(var d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip!=b&&(a.reqData.extra_ip_list[d].is_show=!1)}}},a.clickNodeIP=function(b,c){if(a.reqData.check_ip==b.exe_ip)b.is_show=!1,a.reqData.check_ip="";else{a.reqData.check_ip=b.exe_ip;for(var d=0;d<a.reqData.extra_ip_list.length;d++)b.exe_ip!=a.reqData.extra_ip_list[d].exe_ip?a.reqData.extra_ip_list[d].is_show=!1:a.reqData.extra_ip_list[d].is_show=!0}},a.checkDeleteFlag=function(a,b){b.stopPropagation(),a.delete_flag=!a.delete_flag},a.clickExeDataSource=function(b,c,d){for(var e=0;e<a.reqData.extra_ip_list[d].exe_soc_list.length;e++)e!=c&&(a.reqData.extra_ip_list[d].exe_soc_list[e].state=!1);a.reqData.extra_ip_list[d].exe_soc_list[c].state=!a.reqData.extra_ip_list[d].exe_soc_list[c].state},a.clickVerNode=function(b,c,d){0==a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list.length&&(a.reqData.tow_soc_loading=!0,""==o?Cmpt.getAllSocList(b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,i.alert(b.message,3)}):g.getSocListByIpAndBsys(o,b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,i.alert(b.message,3)}));for(var e=0;e<a.reqData.extra_ip_list[d].ver_ip_list.length;e++)a.reqData.extra_ip_list[d].ver_ip_list[e].is_check=!1;a.reqData.extra_ip_list[d].ver_ip_list[c].is_check=!0},a.clickVerSource=function(b,c,d,e){for(var f=0;f<a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list.length;f++)f!=c&&(a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[f].state=!1);a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state=!a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state},a.getProtocolTypeCnName=function(a){return j.findValue(a,h)},a.find_dataSource_color=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].color},a.find_dataSource_bgcolor=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].bg},a.selectCopySoc=function(b){var c=a.data.copy_soc_list[b].node_soc_list;a.reqData.copy_soc_list=c},a.checkUsage=function(b){a.data_deal_info.group_index="",1==b?a.controls.copy_flag&&(a.controls.operate_btn=b):3==b?a.controls.soc_flag&&(a.controls.operate_btn=b,w()):a.controls.operate_btn=b},a.selectAllCheck=function(a,b){for(var c=0;c<a.phase_list.length;c++)b?(a.phase_list[c].select_flag=!0,5==a.phase_list[c].phase_type&&(a.owner_flag=!0)):(a.phase_list[c].select_flag=!1,5==a.phase_list[c].phase_type&&(a.owner_flag=!1))},a.nextStep=function(){for(var b=[],c=0;c<a.program_info.group_list.length;c++)for(var d=a.program_info.group_list[c],e=0;e<d.phase_list.length;e++)if(d.phase_list[e].select_flag)if(a.controls.check_phase_flag=!0,d.phase_list[e].phase_type>3){if(a.controls.soc_flag=!1,a.controls.operate_btn=2,5==d.phase_list[e].phase_type){a.controls.operate_btn=2,a.controls.copy_flag=!1;break}}else 0==b.length?b.push(d.phase_list[e].impl_type):-1==b.indexOf(d.phase_list[e].impl_type)&&(a.controls.soc_flag=!1,a.controls.operate_btn=2);return a.controls.check_phase_flag?(a.controls.step_flag=!0,void(0!=b.length&&(a.reqData.imply_type=b[0],3==a.controls.operate_btn&&a.reqData.imply_type!=k&&w(),a.controls.soc_flag&&t(a.program_info.group_list,a.reqData.imply_type)))):(i.alert("请选择阶段！"),void(a.controls.deal_loading=!1))},a.preStep=function(){k=a.reqData.imply_type,a.controls.step_flag=!1,a.controls.copy_flag=!0,a.controls.soc_flag=!0,a.data_deal_info.group_index="",a.controls.check_phase_flag=!1},a.cancel=function(){b.dismiss(!1)},a.saveData=function(){return j.valiForm(a.form.batch_from)?(a.controls.deal_loading=!0,void c(function(){if(1==a.controls.operate_btn)u(m);else if(2==a.controls.operate_btn)v(),m=l;else{if(4==a.controls.operate_btn)return l=angular.copy(a.program_info.group_list),x(l),void b.close(l);l=angular.copy(a.program_info.group_list),s(l),m=l}a.controls.deal_loading=!1,b.close(m)},200)):!1},q()}]),modal_m.controller("configCheckItemCtrl",["$scope","$modalInstance","$timeout","modalParam","CmptFunc","BusiSys","Cmpt","CmptType","ProtocolType","IML_TYPE","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=d.phase,o={},p={},q={script:{},phase_type:1},r={},s={cn_name:"",tag_list:[],data:{sort:"crt_bk_date,crt_bk_time",order:"desc",offset:0,limit:12},impl_types:"",start_modify_date:"",end_modify_date:"",crt_user_id:"",publish_state:1,component_purpose:1};a.cmpt_info={param_list:[],script_list:[],exe_soc_list:[],ver_soc_list:[],cmpt_list:[]},a.info={high_search_obj:{search_key_word:"",exec_type_list:angular.copy(j),classify_list:[]},user:""},a.config={form:{},view_options:k.Sh(!0)},a.control={search_flag:!0,tags_more_flag:!1,soc_config_flag:!1,script_loading:!1,cmpt_list_loading:!1,classify_flag:!1},a.data=d.user_info;var t=function(b){a.control.cmpt_list_loading=!0,g.getCmptPageList(b).then(function(b){c(function(){b&&(a.control.cmpt_list_loading=!1,a.cmpt_info.cmpt_list=b.comp_list?b.comp_list:[])},0)},function(b){a.control.cmpt_list_loading=!1,a.cmpt_info.error_message=b.message})},u=function(){for(var a=0;a<arguments.length;a++)for(var b=0;b<arguments[a].length;b++)arguments[a][b]=angular.extend(arguments[a][b],{flag:!1})},v=function(){c(function(){a.control.script_loading=!0},200),n.phase_name?(q.phase_name=n.phase_name,q.impl_type=n.impl_type,a.cmpt_info.impl_type=n.impl_type,a.cmpt_info.param_list=n.param_list,a.cmpt_info.exec_script=e.cmdsToString(n.script.cmds),a.control.soc_config_flag=!0,a.cmpt_info.cmpt_list=[{cn_name:n.phase_name,is_checked:!0}],o={execute_ip:n.node_soc_list[0].execute_ip,execute_protocol_type:n.node_soc_list[0].execute_protocol_type,execute_soc_name:n.node_soc_list[0].execute_soc_name},p={support_ip:n.node_soc_list[0].support_ip,support_protocol_type:n.node_soc_list[0].support_protocol_type,support_soc_name:n.node_soc_list[0].support_soc_name}):t(s),g.selectAllTas().then(function(b){b&&c(function(){for(var c=b.tag_list?b.tag_list:[],d=0;d<c.length;d++)a.info.high_search_obj.classify_list.push({value:c[d],flag:!1})},0)},function(a){l.alert(a.message,3)})};a.paramShellLoaded=function(a){k.setParamsEditor(a)},a.changeSearchFlag=function(b){a.control.search_flag=!1,b.stopPropagation()},a.clear=function(){a.info.high_search_obj.search_key_word=""},a.seniorSearch=function(){r.tag_list=[],r.impl_types=[];for(var b=0;b<a.info.high_search_obj.exec_type_list.length;b++)a.info.high_search_obj.exec_type_list[b].flag&&r.impl_types.push(a.info.high_search_obj.exec_type_list[b].key);for(var b=0;b<a.info.high_search_obj.classify_list.length;b++)a.info.high_search_obj.classify_list[b].flag&&r.tag_list.push(a.info.high_search_obj.classify_list[b].value);s.cn_name=a.info.high_search_obj.key_word,s.tag_list=r.tag_list,s.impl_types=r.impl_types,t(s),a.info.high_search_obj.search_key_word="",a.control.search_flag=!0},a.searchSubgroupByKeyword=function(){s.cn_name=a.info.high_search_obj.search_key_word,s.tag_list=[],s.impl_types=[],t(s)},a.clearData=function(){u(a.info.high_search_obj.classify_list,a.info.high_search_obj.exec_type_list),a.info.high_search_obj.key_word=""},a.checkCheckCmpt=function(b){b.id&&(angular.forEach(a.cmpt_info.cmpt_list,function(a){a.is_checked=!1}),b.is_checked=!0,q.phase_name=b.cn_name,a.control.script_loading=!1,g.viewModulegetModuleDetail(b.id).then(function(b){c(function(){if(b){a.cmpt_info.param_list=b.component.param_list?b.component.param_list:[],a.cmpt_info.script_list=b.component.script_list?b.component.script_list:[];for(var c=0;c<a.cmpt_info.script_list.length;c++)a.cmpt_info.script_list[c].exec_script=e.cmdsToString(a.cmpt_info.script_list[c].cmds),a.cmpt_info.script_list[c].script_type_cn="default"==a.cmpt_info.script_list[c].script_type?"缺省":a.cmpt_info.script_list[c].script_type;a.cmpt_info.script_type=b.component.script_list[0].script_type,a.cmpt_info.exec_script=b.component.script_list[0].exec_script,a.cmpt_info.impl_type=b.component.impl_type?b.component.impl_type:"",q.impl_type=a.cmpt_info.impl_type,q.script.cmds=e.stringToCmds(a.cmpt_info.exec_script),a.control.script_loading=!0}},0)},function(b){a.control.script_loading=!0,l.alert(b.message,3)}))},a.selectScriptByScriptType=function(a,b){for(var c=0;c<b.script_list.length;c++)if(b.script_list[c].script_type==a){b.exec_script=b.script_list[c].exec_script;break}},a.getProtocolTypeCnName=function(a){return m.findValue(a,i).toLowerCase()},a.cancelSeniorSearch=function(){a.control.search_flag=!0},a.countTagDivHeight=function(){c(function(){var b=$(".classify-tag-id").height();b>48?a.control.classify_flag=!0:a.control.classify_flag=!1},500)},a.save=function(){return q.phase_name?m.valiForm(a.config.form.user_form)&&(0==a.cmpt_info.param_list.length||m.valiForm(a.config.form.param_form))?(q.script.cmds=e.stringToCmds(a.cmpt_info.exec_script),q.node_soc_list=[angular.extend(o,p)],q.param_list=a.cmpt_info.param_list,void b.close(q)):!1:void l.alert("请选择组件")},a.cancel=function(){b.dismiss(!1)},v()}]),modal_m.controller("ServerAgentDeployCtrl",["$scope","$modalInstance","$timeout","modalParam","ProtocolType","Server","Modal","CV",function(a,b,c,d,e,f,g,h){a.form={},a.info={srv_info:{server_ip:d.server_ip,soc_name:""},agent_status:parseInt(d.agent_status),error_message:"",deploy_steps:[{status:1,step:"步骤一",value:"校验文件传输协议"},{status:1,step:"步骤二",value:"检测运行环境"},{status:1,step:"步骤三",value:"安装运行环境"},{status:1,step:"步骤四",value:"安装AGENT"},{status:1,step:"步骤五",value:"启动AGENT"},{status:1,step:"步骤六",value:"检测AGENT端口连接"},{status:1,step:"步骤七",value:"安装成功"}]},a.data=d.user_info,a.control={deploy_status:1===parseInt(d.agent_status)?1:3};var i=function(b){for(var c=0;c<a.info.deploy_steps.length;c++){var d=a.info.deploy_steps[c];d.status=b}},j=function(){i(1===parseInt(d.agent_status)?1:4)};a.deployAgent=function(){(h.valiForm(a.form.deploy_form)||6!=a.control.deploy_status&&1!=a.control.deploy_status)&&(i(1),a.info.deploy_steps[0].status=2,a.control.deploy_status=2,f.testFileTransform(a.info.srv_info.server_ip,a.info.srv_info.user).then(function(b){return a.info.deploy_steps[0].status=b.success?4:3,a.info.error_message=b.result||"",a.info.soc_list=b.soc_list||[],b.success?void c(function(){a.info.deploy_steps[1].status=2,f.testRunEnv(a.info.soc_list).then(function(b){return a.info.deploy_steps[1].status=b.success?4:3,a.info.error_message=b.result||"",a.info.deploy_path=b.deploy_path||"",b.success?void c(function(){a.info.deploy_steps[2].status=2,f.deployRunEnv(a.info.soc_list,b.sys_type,b.sys_bit,b.agent_run_env_flag).then(function(d){c(function(){return a.info.deploy_steps[2].status=d.success?4:3,a.info.error_message=d.result||"",d.success?(a.info.deploy_steps[3].status=2,void f.deployAgent(a.info.soc_list).then(function(d){return a.info.deploy_steps[3].status=d.success?4:3,a.info.error_message=d.result||"",d.success?void c(function(){a.info.deploy_steps[4].status=2,f.startAgent(a.info.soc_list,a.info.deploy_path,b.agent_run_env_flag).then(function(b){return a.info.deploy_steps[4].status=b.success?4:3,a.info.error_message=b.result||"",b.success?void c(function(){a.info.deploy_steps[5].status=2,f.testAgentPort(a.info.soc_list).then(function(b){return a.info.deploy_steps[5].status=b.success?4:3,a.info.error_message=b.result||"",b.success?void c(function(){a.info.deploy_steps[6].status=2,c(function(){a.info.deploy_steps[6].status=4,a.control.deploy_status=3},1500)},400):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[5].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},400):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[4].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},400):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[3].status=3,a.control.deploy_status=4,a.info.error_message=b.message})):void(a.control.deploy_status=4)},400)},function(b){a.info.deploy_steps[2].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},800):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[1].status=3,a.control.deploy_status=4,a.info.error_message=b.message})},800):void(a.control.deploy_status=4)},function(b){a.info.deploy_steps[0].status=3,a.control.deploy_status=4,a.info.error_message=b.message}))},a.uninstallAgent=function(){a.control.deploy_status=5,f.uninstallAgentByIp(a.info.srv_info.server_ip).then(function(b){a.control.deploy_status=6,i(1),a.info.agent_status=1},function(b){a.control.deploy_status=7,a.info.error_message=b.message})},a.cancel=function(){return 2==a.control.deploy_status?void g.alert("Agent部署中，不能关闭。"):(a.info.agent_status=3==a.control.deploy_status?3:1,void b.close(a.info.agent_status))},j()}]),modal_m.controller("cmptGroupDetailModalCtrl",["$scope","$modalInstance","$timeout","$routeParams","Cmpt","CodeMirrorOption","modalParam","CmptFunc","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=d.id;a.cmpt_group_control={nav_show_flag:0,expand_flag:!1};var m=function(){a.cmpt_group_info={id:"",cn_name:"",bk_desc:"",modules:[],params:[],publish_state:"",file_path:"",ref_flag:""}},n=function(){m(),e.checkCmptGroupReference(l,2).then(function(b){c(function(){b&&(a.cmpt_group_info.ref_flag=b.ref_flag)},0)},function(a){j.alert(a.message,3)}),e.viewSingleCmptGroup(l).then(function(b){c(function(){b.module_group&&(a.cmpt_group_info.cn_name=b.module_group.cn_name,a.cmpt_group_info.id=b.module_group.id,a.cmpt_group_info.bk_desc=b.module_group.bk_desc,a.cmpt_group_info.params=b.module_group.params?b.module_group.params:[],a.cmpt_group_info.publish_state=b.publish_state,a.cmpt_group_info.modules=b.module_group.modules?b.module_group.modules:[],a.cmpt_group_info.file_path=b.file_path,angular.forEach(a.cmpt_group_info.modules,function(a,b,c){a.params=a.params?a.params:[],a.ref_params=a.ref_params?a.ref_params:[],a.alias_name=a.alias_name?a.alias_name:a.cn_name,a.show_detail=!1,a.cmds&&0!=a.cmds.length&&(a.exec_script=h.cmdsToString(a.cmds)),a.impl_type&&(a.impl_type_formcat=k.findValue(a.impl_type,i))}))},0)},function(a){j.alert(a.message,3),$location.url("/cmpt/cmpts_list")})};a.editorOptions=f.Sh(!0),a.toggleModulesDetail=function(b){b.show_detail=!b.show_detail,a.cmpt_group_control.nav_show_flag=h.judgeShowDetail(a.cmpt_group_info.modules),2==a.cmpt_group_control.nav_show_flag?a.cmpt_group_control.expand_flag=!0:a.cmpt_group_control.expand_flag=!1},a.collapseAll=function(){a.cmpt_group_control.nav_show_flag=h.closeAllModules(a.cmpt_group_info.modules)},a.expandAll=function(){a.cmpt_group_control.nav_show_flag=h.expandAllModules(a.cmpt_group_info.modules)},a.stopPrevent=function(a){a.stopPropagation()},a.horizontalLineStyle=function(){return{width:"50px",height:"1px",position:"absolute",background:"#CCC",left:"20px",top:"15px"}},a.verticalLineStyle=function(){return{width:"1px",height:"100%",position:"absolute",background:"#77BBEE",left:"15px",top:"23px"}},a["return"]=function(){b.dismiss(!1)},n()}]),modal_m.controller("cmptGroupPublishPhaseSocModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Cmpt","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h){if(a.stepData={},a.stepInfo={type:d.step.type,cn_name:d.step.alias_name,srv_soc:d.step.srv_soc?angular.copy(d.step.srv_soc):[],flag:d.flag,impl_type:d.step.impl_type,impl_type_cn:h.findValue(d.step.impl_type,f),old_srv_soc:d.step.srv_soc?angular.copy(d.step.srv_soc):[],copy_soc:!0,package_list:d.step.package_list,package_names:d.step.package_names,testPreObj:d.testPreObj},!d.flag)for(var i=0;i<a.stepInfo.package_list.length;i++)a.stepInfo.package_list[i].flag&&a.stepInfo.package_names.push(a.stepInfo.package_list[i].package_name);a.preStepSoc=d.preStepSoc?d.preStepSoc:[],a.form={stepForm:{}},a.copySoc=function(){a.stepInfo.srv_soc=angular.copy(a.preStepSoc),a.stepInfo.copy_original_flag=!0,a.stepInfo.copy_shell_flag=!0},a.getSocByServer=function(b,d){a.stepInfo.copy_original_flag&&1==a.stepInfo.testPreObj.soc_ip_list.length?a.stepInfo.copy_original_flag=!1:c(function(){if(4==d||3==d||5==d){var c=a.stepInfo.srv_soc[b].soc_list;a.stepInfo.srv_soc[b].soc_list=[],""!=a.stepInfo.srv_soc[b].exe_ip&&a.stepInfo.srv_soc[b].exe_ip&&e.getAllSocList(a.stepInfo.srv_soc[b].exe_ip,2).then(function(d){d.soc_list.join("-")!=c.join("-")?(a.stepInfo.srv_soc[b].soc_list_loading=!1,a.stepInfo.srv_soc[b].soc_list=d.source_list?d.source_list:[],a.stepInfo.srv_soc[b].exe_soc_name=""):a.stepInfo.srv_soc[b].soc_list=d.soc_list?d.soc_list:[]},function(c){a.stepInfo.srv_soc[b].soc_list_loading=!1,g.alert(c.message,3)})}else{var c=a.stepInfo.srv_soc[b].soc_list;a.stepInfo.srv_soc[b].soc_list=[],""!=a.stepInfo.srv_soc[b].exe_ip&&a.stepInfo.srv_soc[b].exe_ip&&e.getAllSocList(a.stepInfo.srv_soc[b].exe_ip,d).then(function(d){d.soc_list.join("-")!=c.join("-")?(a.stepInfo.srv_soc[b].soc_list_loading=!1,a.stepInfo.srv_soc[b].soc_list=d.source_list?d.source_list:[],a.stepInfo.srv_soc[b].exe_soc_name=""):a.stepInfo.srv_soc[b].soc_list=d.soc_list?d.soc_list:[]},function(c){a.stepInfo.srv_soc[b].soc_list_loading=!1,g.alert(c.message,3)})}},500)},a.getShellSocByServer=function(b,d){a.stepInfo.copy_shell_flag&&1==a.stepInfo.testPreObj.soc_ip_list.length?a.stepInfo.copy_shell_flag=!1:c(function(){var c=a.stepInfo.srv_soc[b].shell_soc_list;a.stepInfo.srv_soc[b].shell_soc_list=[],""!=a.stepInfo.srv_soc[b].ver_ip&&a.stepInfo.srv_soc[b].ver_ip&&e.getAllSocList(a.stepInfo.srv_soc[b].ver_ip,d).then(function(d){d.soc_list.join("-")!=c.join("-")?(a.stepInfo.srv_soc[b].shell_soc_list_loading=!1,a.stepInfo.srv_soc[b].shell_soc_list=d.source_list?d.source_list:[],a.stepInfo.srv_soc[b].ver_soc_name=""):a.stepInfo.srv_soc[b].shell_soc_list=d.soc_list?d.soc_list:[]},function(c){a.stepInfo.srv_soc[b].shell_soc_list_loading=!1,g.alert(c.message,3)})},500)},a.removeOneSoc=function(b){a.stepInfo.srv_soc.splice(b,1)},a.addSoc=function(){a.stepData.soc_list=[];var b=a.stepInfo.srv_soc.length;0==b?a.stepInfo.srv_soc.push({exe_ip:"",exe_soc_name:"",ver_ip:"",ver_soc_name:"",soc_list:[],shell_soc_list:[]}):""==a.stepInfo.srv_soc[b-1].server_name?g.alert("请完善服务器名！"):a.stepInfo.srv_soc.push({exe_ip:"",exe_soc_name:"",ver_ip:"",ver_soc_name:"",soc_list:[],shell_soc_list:[]})},a.formSubmit=function(){if(a.stepInfo.flag)b.close("cancel");else{if(!h.valiForm(a.form.stepForm))return!1;b.close(a.stepInfo)}},a.cancel=function(){b.close("cancel")},a.selectItem=function(b){b.flag?a.stepInfo.package_names.push(b.package_name):a.stepInfo.package_names.splice(a.stepInfo.package_names.indexOf(b.package_name),1)}}]),modal_m.controller("addPluginCtrl",["$scope","$modalInstance","$timeout","modalParam","Plugin","Modal","CodeMirrorOption","CmptFunc","pluginType","envManage","CV",function(a,b,c,d,e,f,g,h,i,j,k){a.data={plugin_type_list:i},a.plugin_info={plugin_name:d.plugin_name,plugin_bk_desc:"",plugin_type:"",plugin_file_name:"",install_command:"",uninstall_command:""},a.control={change_type:!1,btn_loading:!1,get_path_loading:!0,is_update:d.is_update?d.is_update:!1,error_message:""},a.config={lib_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},add_plugin_form:{}};var l=function(){4==a.plugin_info.plugin_type?a.editOptions=g.Python():6==a.plugin_info.plugin_type?a.editOptions=g.Vbs():a.editOptions=g.Sh(),a.control.change_type=!1,c(function(){a.control.change_type=!0},10)},m=function(){j.getUploadPath().then(function(b){b&&(a.control.get_path_loading=!1,a.config.lib_fileupload.uploadpath=b.upload_path?b.upload_path:"",l())},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message}),d.is_update&&e.viewPluginInfo(d.plugin_name).then(function(b){c(function(){b.plugin&&(a.plugin_info.plugin_bk_desc=b.plugin.plugin_bk_desc?b.plugin.plugin_bk_desc:"",a.plugin_info.plugin_type=b.plugin.plugin_type?b.plugin.plugin_type:"",a.plugin_info.plugin_file_name=b.plugin.plugin_file_name?b.plugin.plugin_file_name:"",a.plugin_info.install_command=b.plugin.install_command?b.plugin.install_command:"",a.plugin_info.uninstall_command=b.plugin.uninstall_command?b.plugin.uninstall_command:"",a.config.lib_fileupload.filename=b.plugin.plugin_file_name?b.plugin.plugin_file_name.substring(b.plugin.plugin_file_name.lastIndexOf("/")+1):"",a.control.get_path_loading=!1,l())},0)},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message})};a.fileUploadSuccessThen=function(){a.plugin_info.plugin_file_name=a.config.lib_fileupload.uploadpath+"/"+a.config.lib_fileupload.filename;for(var b=a.config.lib_fileupload.filename.substring(a.config.lib_fileupload.filename.lastIndexOf(".")+1),c=0;c<a.data.plugin_type_list.length;c++)if(b===a.data.plugin_type_list[c].value){a.plugin_info.plugin_type=a.data.plugin_type_list[c].key,l();break}},a.removePluginFile=function(){a.config.lib_fileupload.filename="",a.plugin_info.plugin_file_name="",a.plugin_info.plugin_type="",l()},a.downloadPluginFile=function(){a.plugin_info.plugin_file_name&&k.downloadFile(a.plugin_info.plugin_file_name)},a.changePluginType=function(){l()},a.save=function(){return k.valiForm(a.config.add_plugin_form)?a.plugin_info.plugin_file_name?(a.control.btn_loading=!0,void(a.control.is_update?e.updateNewPlugin(a.plugin_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3)}):e.addNewPlugin(a.plugin_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3)}))):(f.alert("请上传插件文件",3),!1):!1},a.back=function(){b.dismiss(!1)},m()}]),modal_m.controller("addResourceCtrl",["$scope","$modalInstance","$timeout","modalParam","CommonResources","Modal","pluginType","envManage","CV",function(a,b,c,d,e,f,g,h,i){a.resource_info={resources_name:d.resources_name,resources_desc:""},a.control={btn_loading:!1,get_path_loading:!0,is_update:d.is_update?d.is_update:!1,error_message:""},a.config={lib_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},add_resource_form:{}};var j=function(){h.getUploadPath().then(function(b){b&&(a.control.get_path_loading=!1,a.config.lib_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message}),d.is_update&&e.viewResources(d.resources_name).then(function(b){c(function(){b.resourcesInfo&&(a.resource_info.resources_desc=b.resourcesInfo.resource_desc?b.resourcesInfo.resource_desc:"",a.resource_info.resources_file_path=b.resourcesInfo.resource_file_path?b.resourcesInfo.resource_file_path:"",a.config.lib_fileupload.filename=b.resourcesInfo.resource_file_path?b.resourcesInfo.resource_file_path.substring(b.resourcesInfo.resource_file_path.lastIndexOf("/")+1):"",a.control.get_path_loading=!1)},0)},function(b){a.control.get_path_loading=!1,a.control.error_message=b.message})};a.fileUploadSuccessThen=function(){a.resource_info.resources_file_path=a.config.lib_fileupload.uploadpath+"/"+a.config.lib_fileupload.filename},a.removeResourcesFile=function(){a.config.lib_fileupload.filename="",a.resource_info.resources_file_path=""},a.downloadResourcesFile=function(){a.resource_info.resources_file_path&&i.downloadFile(a.resource_info.resources_file_path)},a.save=function(){return i.valiForm(a.config.add_resource_form)?a.resource_info.resources_file_path?(a.control.btn_loading=!0,void(a.control.is_update?e.updateResources(a.resource_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3);
}):e.addResources(a.resource_info).then(function(c){c&&(a.control.btn_loading=!1,b.close())},function(b){a.control.btn_loading=!1,f.alert(b.message,3)}))):(f.alert("请上传文件",3),!1):!1},a.back=function(){b.dismiss(!1)},j()}]),modal_m.controller("busiSysAddNodeModalCtrl",["$scope","$modalInstance","$timeout","NodeReform","ProtocolType","modalParam","Cmpt","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=f.business_sys_name,l=f.node_name,m="",n=["PLT_FTP","SFTP"],o=["SSH","TELNET"],p=!1;a.form={},a.errMessage="",a.is_edit=f.flag,a.nodeControl={protocol_soc_loading:!1,protocol_soc_warn:!1,config_data_source:!1,config_common_data_source:!1},a.data={protocol_soc_list:[]};var q=function(){a.node_info={new_node:{node_soc_ip:"",ftp_config_soc:"",shell_config_soc:"",soc_name_list:[],need_conect_ftp:["---请选择---"],protocol_soc_list:[],business_sys_name:k}}},r=function(){q()},s=function(){q(),d.getNodeForUpdat(l).then(function(b){c(function(){if(a.node_info.new_node=angular.copy(b),a.node_info.new_node.protocol_soc_list=b.protocol_soc_list?b.protocol_soc_list:[],a.node_info.new_node.business_sys_name=k,a.node_info.new_node.soc_ip=b.node_soc_ip,a.node_info.new_node.need_conect_ftp=["---请选择---"],a.getProtocolAndDataSocList(),a.node_info.new_node.protocol_soc_list)for(var c=0;c<a.node_info.new_node.protocol_soc_list.length;c++){var d=a.node_info.new_node.protocol_soc_list[c];(5==d.protocol_type||10==d.protocol_type)&&(a.node_info.new_node.need_conect_ftp=a.node_info.new_node.need_conect_ftp.concat(d.soc_name_list))}},0)},function(a){i.alert(a.message,3)})},t=function(){return a.node_info.new_node.shell_config_soc&&!a.node_info.new_node.ftp_config_soc?(a.nodeControl.config_data_source=!0,!1):!0},u=function(){for(var b=0;b<a.data.protocol_soc_list.length;b++)for(var c=0;c<a.data.protocol_soc_list[b].soc_name_list.length;c++){var d=a.data.protocol_soc_list[b].soc_name_list[c];if(d.soc_name==a.node_info.new_node.shell_config_soc&&!d.has_connect_flag)return void(a.node_info.new_node.shell_config_soc="")}"---请选择---"==a.node_info.new_node.shell_config_soc&&(a.node_info.new_node.shell_config_soc="")},v=function(){u();for(var b=0;b<a.data.protocol_soc_list.length;b++)for(var c=0;c<a.data.protocol_soc_list[b].soc_name_list.length;c++){var d=a.data.protocol_soc_list[b].soc_name_list[c];d.state&&a.node_info.new_node.soc_name_list.push(d.soc_name)}},w=function(){for(var b=0;b<a.node_info.new_node.protocol_soc_list.length;b++)for(var c=0;c<a.node_info.new_node.protocol_soc_list[b].soc_name_list.length;c++)for(var d=a.node_info.new_node.protocol_soc_list[b].soc_name_list[c],e=0;e<a.data.protocol_soc_list.length;e++)for(var f=0;f<a.data.protocol_soc_list[e].soc_name_list.length;f++){var g=a.data.protocol_soc_list[e].soc_name_list[f];d==g.soc_name&&(g.state=!0),g.soc_name==a.node_info.new_node.shell_config_soc&&a.node_info.new_node.ftp_config_soc&&(g.has_connect_flag=!0)}};a.getProtocolAndDataSocList=function(){var b=/^((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d))))$/;c(function(){a.node_info.new_node.node_soc_ip||(m="",a.data.protocol_soc_list=[],a.node_info.new_node.soc_list=[],a.nodeControl.protocol_soc_warn=!1),""!=a.node_info.new_node.node_soc_ip&&m!=a.node_info.new_node.node_soc_ip&&b.test(a.node_info.new_node.node_soc_ip)&&(p=!1,a.nodeControl.protocol_soc_loading=!0,a.data.protocol_soc_list=[],1==a.is_edit&&(a.node_info.new_node.ftp_config_soc="",a.node_info.new_node.shell_config_soc="",a.node_info.new_node.need_conect_ftp=["---请选择---"]),a.node_info.new_node.soc_name_list=[],d.queryProtocolAndSocNameByIp(a.node_info.new_node.node_soc_ip).then(function(b){a.nodeControl.config_data_source=!1,m=a.node_info.new_node.node_soc_ip,c(function(){a.data.protocol_soc_list=b.protocol_soc_list?b.protocol_soc_list:[];for(var c=0;c<a.data.protocol_soc_list.length;c++){var d=a.data.protocol_soc_list[c];d.show_flag_by_protocol_type=!1,d.protocol_type=j.findValue(a.data.protocol_soc_list[c].protocol_type,e),-1!=n.indexOf(d.protocol_type)&&(d.show_flag_by_protocol_type=!0);for(var f=[],g=0;g<a.data.protocol_soc_list[c].soc_name_list.length;g++)f.push({soc_name:a.data.protocol_soc_list[c].soc_name_list[g],state:!1,show_select:!1,has_connect_flag:!1});a.data.protocol_soc_list[c].soc_name_list=f}a.nodeControl.protocol_soc_loading=!1,2==a.is_edit&&w()},200)},function(b){a.error_message=b.message,m=a.node_info.new_node.node_soc_ip,a.nodeControl.protocol_soc_loading=!1,a.nodeControl.protocol_soc_warn=!0}))},0)},a.selectRadioItem=function(b){a.nodeControl.config_common_data_source=!1,p=!0;for(var c=0;c<a.data.protocol_soc_list.length;c++)for(var d=0;d<a.data.protocol_soc_list[c].soc_name_list.length;d++){var e=a.data.protocol_soc_list[c].soc_name_list[d];e.has_connect_flag=!1,e.show_select=!1}b.state=!0,b.show_select=!0},a.clearSelect=function(b){a.node_info.new_node.ftp_config_soc="",b.state=!1,b.show_select=!1;for(var c=0;c<a.data.protocol_soc_list.length;c++)for(var d=0;d<a.data.protocol_soc_list[c].soc_name_list.length;d++){var e=a.data.protocol_soc_list[c].soc_name_list[d];e.has_connect_flag&&(e.has_connect_flag=!1,e.show_select=!1,a.node_info.new_node.shell_config_soc="")}a.nodeControl.config_data_source=!1},a.setNormalData=function(b,c){if(a.nodeControl.config_common_data_source=!1,b.state){if(b.soc_name==a.node_info.new_node.ftp_config_soc)return p=!0,void(b.show_select=!b.show_select);if(b.soc_name==a.node_info.new_node.shell_config_soc&&b.has_connect_flag)return;b.state=!1,-1!=o.indexOf(c)&&a.node_info.new_node.need_conect_ftp.splice(a.node_info.new_node.need_conect_ftp.indexOf(b.soc_name),1);for(var d=0;d<a.data.protocol_soc_list.length;d++)for(var e=0;e<a.data.protocol_soc_list[d].soc_name_list.length;e++){var f=a.data.protocol_soc_list[d].soc_name_list[e];f.show_select=!1}}else{b.state=!0,-1!=o.indexOf(c)&&a.node_info.new_node.need_conect_ftp.push(b.soc_name);for(var d=0;d<a.data.protocol_soc_list.length;d++)for(var e=0;e<a.data.protocol_soc_list[d].soc_name_list.length;e++){var f=a.data.protocol_soc_list[d].soc_name_list[e];f.show_select=!1}}},a.setConnectDataSource=function(b,c){if(p){for(var d=0;d<a.data.protocol_soc_list.length;d++)for(var e=0;e<a.data.protocol_soc_list[d].soc_name_list.length;e++){var f=a.data.protocol_soc_list[d].soc_name_list[e];f.has_connect_flag=!1,f.soc_name==b&&(f.state=!0,f.has_connect_flag=!0)}c.show_select=!1,p=!1,"---请选择---"==b?(c.has_connect_flag=!1,a.node_info.new_node.shell_config_soc=""):(a.node_info.new_node.shell_config_soc=b,a.nodeControl.config_data_source=!1)}},a.getTitleInfo=function(b){var c="";return b.state&&(b.soc_name==a.node_info.new_node.ftp_config_soc&&(c="配置数据源"),b.soc_name==a.node_info.new_node.shell_config_soc&&(c="校验数据源")),c},a.formSubmit=function(){return j.valiForm(a.form.addModifyNodeForm)?(v(),t(),0==a.node_info.new_node.soc_name_list.length?(a.nodeControl.config_common_data_source=!0,a.node_info.new_node.soc_name_list=[],!1):a.node_info.new_node.ftp_config_soc&&!a.node_info.new_node.shell_config_soc?(a.nodeControl.config_data_source=!0,a.node_info.new_node.soc_name_list=[],!1):(1==a.is_edit&&d.addBsNode(a.node_info.new_node).then(function(d){c(function(){i.alert("新增节点成功",2),b.close(a.node_info.new_node.node_soc_ip)},0)},function(b){a.data.protocol_soc_list=[],a.node_info.new_node.soc_list=[],a.node_info.new_node.node_soc_ip="",i.alert(b.message,3)}),void(2==a.is_edit&&d.updateBsNode(a.node_info.new_node).then(function(d){c(function(){i.alert("修改节点成功",2),b.close(a.node_info.new_node.node_soc_ip)},0)},function(a){i.alert(a.message,3)})))):!1},a.cancel=function(){b.close("cancel")},a.myKeyup=function(b){var c=b.keyCode;13==c&&a.getProtocolAndDataSocList()},a.changeScorll=function(){return a.data.protocol_soc_list.length>3?{overflow:"auto"}:void 0},2==a.is_edit?s():1==a.is_edit&&r()}]),modal_m.controller("envDeployCtrl",["$scope","$modalInstance","$timeout","envManage","LanguageName","modalParam","pluginExeEnv","operateSysBit","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){a.data={},a.data.language_list=angular.copy(e),a.controls={loading:!1};var k={};a.data.env_list=[];var l=function(b){a.controls.loading=!0,d.queryEnvList(b).then(function(b){a.data.env_list=b.language_env_list?b.language_env_list:[],a.controls.loading=!1},function(b){a.controls.loading=!1,i.alert(b.message,3)})};a.getValue=function(a,b){var c=1==b?g:h;return j.findValue(a,c)},a.chooseLanguage=function(b){b.choose_flag||(angular.forEach(a.data.language_list,function(a){b.key==a.key?a.choose_flag=!0:a.choose_flag=!1}),l(b.key),k.language_name=b.key)},a.chooseEnv=function(b,c){b.choose_flag||(angular.forEach(a.data.env_list,function(a,b){c==b?a.choose_flag=!0:a.choose_flag=!1}),k=angular.extend(k,b))},a.saveData=function(){return k.choose_flag?void b.close(k):void i.alert("请选择环境",3)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("plusePluginCtrl",["$scope","$modalInstance","$timeout","Plugin","ScrollConfig","LanguageName","modalParam","pluginExeEnv","operateSysBit","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=g.plugin_list?g.plugin_list:[];a.form={},a.data={plugin_list:[],user_info:g.user_info},a.info={search:"",server_user:""},a.controls={loading:!0},a.config={plugin_list_scroll:e,choosed_plugin_scroll:e};var m=function(){d.getAllPluginList().then(function(b){if(a.controls.loading=!1,a.data.plugin_list=b.plugin_list?b.plugin_list:[],l.length)for(var c=0;c<a.data.plugin_list.length;c++)for(var d=a.data.plugin_list[c],e=0;e<l.length;e++){var f=l[e];d.plugin_name===f.plugin_name&&(d.deploy_status=f.deploy_status?f.deploy_status:0,3!==d.deploy_status?d.is_deploy=!0:d.deploy_status=0)}},function(b){a.controls.loading=!1})};a.filterPluginNmae=function(b){return a.info.search?b.plugin_name.indexOf(a.info.search)>-1:!0},a.deleteChoosedPlugin=function(a){a.is_deploy=!1},a.deploy=function(){if(!k.valiForm(a.form.deployForm))return!1;for(var c=[],d=0;d<a.data.plugin_list.length;d++){var e=a.data.plugin_list[d];e.is_deploy&&c.push({deploy_status:e.deploy_status,plugin_name:e.plugin_name,error_message:""})}b.close({selected_plugin:c,server_user:a.info.server_user})},a.cancel=function(){b.dismiss(!1)},m()}]),modal_m.controller("addCollectCmptCtrl",["$scope","$modalInstance","$timeout","modalParam",function(a,b,c,d){var e=d.cj_cmpt_list?d.cj_cmpt_list:[];a.cj_cmpt={all_cj_cmpt_list:e};var f=function(b){for(var c=0;c<b.length;c++)b[c].is_checked&&(b[c].status=1,b[c].is_show=!0,a.cj_cmpt.checked_cj_cmpt_list.push(b[c]));return a.cj_cmpt.checked_cj_cmpt_list};a.checkCmpt=function(b){a.cj_cmpt.all_cj_cmpt_list[b].is_checked=!a.cj_cmpt.all_cj_cmpt_list[b].is_checked,a.cj_cmpt.all_cj_cmpt_list[b].is_show=!1,a.cj_cmpt.all_cj_cmpt_list[b].is_checked||(a.cj_cmpt.all_cj_cmpt_list[b].status=0)},a.saveCollectCmpt=function(){a.cj_cmpt.checked_cj_cmpt_list=[],b.close(f(a.cj_cmpt.all_cj_cmpt_list))},a.cancel=function(){b.dismiss()}}]),modal_m.controller("viewPluginProtocolCtrl",["$scope","$modalInstance","modalParam",function(a,b,c){a.lists=c.list,a.flag=c.flag,a.ip=c.ip,a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("schemeDetailCtrl",["$scope","$modalInstance","$timeout","modalParam","BusiSys","CodeMirrorOption","CmptFunc","IML_TYPE","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=d.prog_id;a.viewOptions=f.Sh(!0),a.progData={prog_source:1,prog_cn_name:"",prog_bk_desc:"",package_types:[],ref_package_list:[],pub_info:{phase_list:[],param_list:[]},rol_info:{phase_list:[],param_list:[]}},a.pubControls={nav_show_flag:!1,modules_loading:!1,submit_loading:!1,expand_flag:!1,import_loading:!1,data_source:1,upload_show:!0},a.rolControls={nav_show_flag:!1,modules_loading:!1,expand_flag:!1,import_loading:!1,data_source:1};var l=function(){e.viewPubProgramInfo(k).then(function(b){c(function(){if(b){a.progData.prog_cn_name=b.prog_cn_name,a.progData.prog_bk_desc=b.prog_bk_desc,a.progData.package_types=b.package_types?b.package_types:[],a.progData.pub_info=b.pub_info?b.pub_info:{phase_list:[],param_list:[]},a.progData.rol_info=b.rol_info?b.rol_info:{phase_list:[],param_list:[]},a.progData.pub_info.phase_list=a.progData.pub_info.phase_list?a.progData.pub_info.phase_list:[],a.progData.pub_info.param_list=a.progData.pub_info.param_list?a.progData.pub_info.param_list:[],console.log(a.progData.pub_info.param_list),a.progData.rol_info.phase_list=a.progData.rol_info.phase_list?a.progData.rol_info.phase_list:[],a.progData.rol_info.param_list=a.progData.rol_info.param_list?a.progData.rol_info.param_list:[];for(var c=0;c<a.progData.pub_info.phase_list.length;c++)if((1==a.progData.pub_info.phase_list[c].type||4==a.progData.pub_info.phase_list[c].type)&&(a.progData.pub_info.phase_list[c].alias_name||(a.progData.pub_info.phase_list[c].alias_name=a.progData.pub_info.phase_list[c].cn_name),a.progData.pub_info.phase_list[c].show_detail=!1,a.progData.pub_info.phase_list[c].type_cn=j.findValue(a.progData.pub_info.phase_list[c].impl_type,h),a.progData.pub_info.phase_list[c].exec_script=g.cmdsToString(a.progData.pub_info.phase_list[c].cmds),a.progData.pub_info.phase_list[c].ref_params=a.progData.pub_info.phase_list[c].ref_params?a.progData.pub_info.phase_list[c].ref_params:[],0!=a.progData.pub_info.phase_list[c].ref_params.length&&(a.progData.pub_info.phase_list[c].show_ref_param=!0)),2==a.progData.pub_info.phase_list[c].type){var d=a.progData.pub_info.phase_list[c];d.alias_name||(d.alias_name=d.cn_name),d.show_detail=!1;for(var e=0;e<d.modules.length;e++)if(d.modules[e].alias_name||(d.modules[e].alias_name=d.modules[e].cn_name),d.modules[e].exec_script=g.cmdsToString(d.modules[e].cmds),d.modules[e].type_cn=j.findValue(d.modules[e].impl_type,h),d.modules[e].ref_params=d.modules[e].ref_params?d.modules[e].ref_params:[],0!=d.modules[e].ref_params.length){for(var f=0;f<d.modules[e].ref_params.length;f++);d.modules[e].show_ref_param=!0}}for(var c=0;c<a.progData.rol_info.phase_list.length;c++){if((1==a.progData.rol_info.phase_list[c].type||4==a.progData.rol_info.phase_list[c].type)&&(a.progData.rol_info.phase_list[c].alias_name||(a.progData.rol_info.phase_list[c].alias_name=a.progData.rol_info.phase_list[c].cn_name),a.progData.rol_info.phase_list[c].show_detail=!1,a.progData.rol_info.phase_list[c].type_cn=j.findValue(a.progData.rol_info.phase_list[c].impl_type,h),a.progData.rol_info.phase_list[c].exec_script=g.cmdsToString(a.progData.rol_info.phase_list[c].cmds),a.progData.rol_info.phase_list[c].ref_params=a.progData.rol_info.phase_list[c].ref_params?a.progData.rol_info.phase_list[c].ref_params:[],0!=a.progData.rol_info.phase_list[c].ref_params.length)){for(var f=0;f<a.progData.rol_info.phase_list[c].ref_params.length;f++)a.progData.rol_info.phase_list[c].ref_params[f].ref_param_flag=judgeRefParam(a.progData.rol_info.phase_list[c].ref_params[f].ref,a.rolData.handle_param_list);a.progData.rol_info.phase_list[c].show_ref_param=!0}if(2==a.progData.rol_info.phase_list[c].type){var d=a.progData.rol_info.phase_list[c];d.alias_name||(d.alias_name=d.cn_name),d.show_detail=!1;for(var e=0;e<d.modules.length;e++)if(d.modules[e].alias_name||(d.modules[e].alias_name=d.modules[e].cn_name),d.modules[e].exec_script=g.cmdsToString(d.modules[e].cmds),d.modules[e].type_cn=j.findValue(d.modules[e].impl_type,h),d.modules[e].ref_params=d.modules[e].ref_params?d.modules[e].ref_params:[],0!=d.modules[e].ref_params.length){for(var f=0;f<d.modules[e].ref_params.length;f++)d.modules[e].ref_params[f].ref_param_flag=judgeRefParam(d.modules[e].ref_params[f].ref,a.rolData.handle_param_list);d.modules[e].show_ref_param=!0}}}}},0)},function(a){i.alert(a.message,3)})};a.changTab=function(b){2==b?c(function(){a.flagTab=!0},0):c(function(){a.flagTab=!1},0)},a.toggleModulesDetail=function(b,c){b.show_detail=!b.show_detail,1==c?(a.pubControls.nav_show_flag=g.judgeShowDetail(a.progData.pub_info.phase_list),2==a.pubControls.nav_show_flag?a.pubControls.expand_flag=!0:a.pubControls.expand_flag=!1):(a.rolControls.nav_show_flag=g.judgeShowDetail(a.progData.rol_info.phase_list),2==a.rolControls.nav_show_flag?a.rolControls.expand_flag=!0:a.rolControls.expand_flag=!1)},a.expandCollapseAll=function(b){1==b?a.pubControls.nav_show_flag=g.expandAllModules(a.progData.pub_info.phase_list):a.rolControls.nav_show_flag=g.expandAllModules(a.progData.rol_info.phase_list)},a.colseCollapseAll=function(b){1==b?a.pubControls.nav_show_flag=g.closeAllModules(a.progData.pub_info.phase_list):a.rolControls.nav_show_flag=g.closeAllModules(a.progData.rol_info.phase_list)},a.cancel=function(){b.dismiss(!1)},l()}]),modal_m.controller("uploadLogFileCtrl",["$scope","$modalInstance","$timeout","modalParam","BusiSys","CodeMirrorOption","CmptFunc","IML_TYPE","Modal","NodeReform","Col_Fmt","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.form={},a.maxDate=new Date,a.log_fileupload={suffixs:"",filetype:"",filename:"",uploadpath:""},a.datepicker={},a.upload_file_info={sys_name:d.sys_name,log_name:d.log_name,log_id:d.log_id,node_name:"",file_date:l.dtFormat(new Date),file_name:"",ip:"",temp_date:"",node_ip:""},a.data={node_ip_list:[],logSyncInfoList:[]},a.control={show_upload:!1};var m=function(){j.getNodeByBusi(d.sys_name).then(function(b){c(function(){a.data.node_ip_list=b.node_msg_list?b.node_msg_list:[]},0)},function(a){i.alert(a.message,3)})};a.getipAndPath=function(b){if(!a.upload_file_info.file_date)return i.alert("请先选择日期"),!1;for(var f="",g=0;g<a.data.node_ip_list.length;g++){var h=a.data.node_ip_list[g];if(h.soc_ip==b){f=h.node_name;break}}var j=l.dtFormat(a.upload_file_info.file_date);e.getLogUploadPath(f,d.sys_name,j,a.upload_file_info.log_id).then(function(b){c(function(){if(a.log_fileupload.uploadpath=b.path?b.path:"",a.control.show_upload=!0,a.data.file_list=b.file_list?b.file_list:[],a.data.file_list.length>0)for(var c=0;c<a.data.file_list.length;c++){var d=a.data.file_list[c];d.real_length=k.formByteToM(d.file_length)}},0)},function(a){i.alert(a.message,3)})},a.fileUploadSuccessThen=function(){a.upload_file_info.file_name=a.log_fileupload.filename},a.cancel=function(){b.dismiss(!1)},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.datepicker.opened=!0},a.formSubmit=function(){if(!l.valiForm(a.form.uploadFile))return!1;if(!a.upload_file_info.file_name)return i.alert("请上传文件"),!1;for(var d=0;d<a.data.node_ip_list.length;d++){var f=a.data.node_ip_list[d];if(f.soc_ip==a.upload_file_info.node_ip){a.upload_file_info.node_name=f.node_name;break}}a.upload_file_info.file_date=l.dtFormat(a.upload_file_info.file_date),e.saveLogUploadBase(a.upload_file_info).then(function(a){c(function(){i.alert("提交成功"),b.close(!1)},0)},function(a){i.alert(a.message,3),b.close(!1)})},m()}]),modal_m.controller("deployAgentCtrl",["$scope","$modalInstance","$timeout","modalParam","NodeReform","Modal",function(a,b,c,d,e,f){var g=d.protocol_soc_list?d.protocol_soc_list:[],h=d.node_name;a.data={protocol_soc_list:[]},a.control={deploy_loading:!1,deploy_success:!1,deploy_fail:!1};var i=function(a){for(var b=0;b<a.length;b++)a[b].is_check=!1},j=function(a){for(var b="",c=0;c<a.length;c++)a[c].is_check&&(b=a[c].soc_name);return b},k=function(){a.data.protocol_soc_list=g,i(a.data.protocol_soc_list)};a.chooseExecSoc=function(b){i(a.data.protocol_soc_list),a.data.protocol_soc_list[b].is_check=!0},a.startDeploy=function(){var b=j(a.data.protocol_soc_list);return b?(a.control.deploy_loading=!0,void e.deployAgent(b,h).then(function(b){b&&(a.control.deploy_loading=!1,b.success?a.control.deploy_success=!0:(a.deploy_error_message=b.result,a.control.deploy_fail=!0))},function(b){a.control.deploy_loading=!1,f.alert(b.message,3)})):(f.alert("请选择要执行的数据源！"),!1)},a.finishDeploy=function(){b.close(!0)},a.cancel=function(){b.dismiss()},k()}]),modal_m.controller("configDirCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","BusiSys","Modal",function(a,b,c,d,e,f,g){var h=d._flag?d._flag:1,i=d.soc_version?d.soc_version:"";a.info={version_info:{soc_name:i,root_bk_dir:"",init_path:"",loading:!1,full_path:""}},a.control={version_config_flag:h,show_real:!1};var j=function(){a.info.version_info.checked_files=[],a.info.version_info.paths=[],a.info.version_info.active=!1,a.info.version_info.loading=!1},k=function(){e.getFileListBySoc(i,a.info.version_info.init_path).then(function(b){j(),a.info.version_info.path_files=b.file_bean_list?b.file_bean_list:[],a.info.version_info.init_path=b.root_bk_dir?b.root_bk_dir:"",a.info.version_info.full_path=b.root_bk_dir?b.root_bk_dir:"",a.control.show_real=!0},function(a){g.alert(a.message,3),b.dismiss()})};a.changePath=function(a){a.loading=!0,e.getFileListBySoc(i,a.full_path).then(function(b){a.loading=!1,a.path_files=b.file_bean_list?b.file_bean_list:[]},function(b){a.loading=!1,a.err_msg=b.message})},a.save=function(){return 0==a.info.version_info.paths.length?(g.alert("请选择目录"),!1):void b.close(a.info.version_info.full_path)},a.back=function(){b.dismiss()},k()}]),modal_m.controller("ViewFileDirListCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Modal",function(a,b,c,d,e,f){var g=[];a.file_list=[],a.content=d.content,a.changePath=function(){a.node.is_dir&&(a.node.loading=!0,c(function(){e.getFileList(a.content.node_name,a.node.full_path).then(function(b){a.node.path_files=b.file_bean_list,a.node.loading=!1},function(a){f.alert(a.message,3)})}))};var h=function(){a.node={node_name:"",init_path:d.init_path?d.init_path:"",path_files:[],loading:!1,full_path:"",is_dir:!0,checked_files:[],deleted_files:[],modified_files:[],spical_files:[]}};a.formSubmit=function(){var c=!1;angular.forEach(a.node.path_files,function(b){b.checked&&(c=!0,b.file=a.node.full_path+"/"+b.file,console.log(b.file),g.push(b))}),c?b.close(g):f.alert("请至少选择一个目录或文件")},a.formCancel=function(){b.dismiss(!1)},h()}]),modal_m.controller("newCjProgramItemsModalCtrl",["$scope","$modalInstance","$timeout","modalParam","IML_TYPE","CmptFunc","Collection","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=d.business_sys_name,k=0,l=0;a.form={},a.is_edit=d.is_update,a.collect_item_info={collect_item_name:"",is_parallel:!0,coProgramModuleBeans:[],run_yn_flag:!0,start_bk_time:"",max_run_time:"",immediate_exec:0},a.start_time={plan_hour:"",plan_minute:""},a.run_time={flag:1,time:""},a.control={show_cmpts:!1,get_cmpts_loading:!1,get_cmpts_error:!1,time_format:!0},a.data={cj_cmpt_list:[],times:[{key:1,value:"分钟"},{key:2,value:"小时"}]};var m=function(a,b){if(0!=b.length)for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)a[c].module_id==b[d].module_id&&(a[c].is_check=!0);return a},n=function(){if(a.is_edit){if(a.collect_item_info=angular.copy(d.item),a.collect_item_info.coProgramModuleBeans)for(var b=0;b<a.collect_item_info.coProgramModuleBeans.length;b++){var c=a.collect_item_info.coProgramModuleBeans[b];c.script_content=f.cmdsToString(c.script)}a.collect_item_info.run_yn_flag?a.collect_item_info.immediate_exec=0:(a.collect_item_info.immediate_exec=1,a.start_time={plan_hour:a.collect_item_info.start_bk_time.substring(0,2),plan_minute:a.collect_item_info.start_bk_time.substring(3,a.collect_item_info.start_bk_time.length)}),a.collect_item_info.translate_run_time_m>0?(a.run_time.flag=1,a.run_time.time=a.collect_item_info.max_run_time/60):(a.run_time.flag=2,a.run_time.time=a.collect_item_info.max_run_time/60/60)}};a.showCollectCmpt=function(){a.control.show_cmpts=!0,a.control.get_cmpts_error=!1,a.control.get_cmpts_none=!1,a.control.get_cmpts_loading=!0,g.getCollectItemList(j).then(function(b){c(function(){if(b.module_list){a.data.cj_cmpt_list=b.module_list?b.module_list:[];for(var c=0;c<a.data.cj_cmpt_list.length;c++)a.data.cj_cmpt_list[c].impl_type_cn=i.findValue(a.data.cj_cmpt_list[c].impl_type,e),a.data.cj_cmpt_list[c].script_content=f.cmdsToString(a.data.cj_cmpt_list[c].script),a.data.cj_cmpt_list[c].show_script=!1,a.data.cj_cmpt_list[c].is_check=!1;m(a.data.cj_cmpt_list,a.collect_item_info.coProgramModuleBeans),a.control.get_cmpts_loading=!1}else a.control.get_cmpts_loading=!1,a.control.get_cmpts_none=!0},0)},function(b){a.control.get_cmpts_loading=!1,a.control.get_cmpts_error=!0,a.error_message=b.message})},a.addCollectCmpt=function(b){var c=a.data.cj_cmpt_list[b];c.is_check=!c.is_check,c.is_check?a.collect_item_info.coProgramModuleBeans.push(c):angular.forEach(a.collect_item_info.coProgramModuleBeans,function(b,d){b.module_id==c.module_id&&a.collect_item_info.coProgramModuleBeans.splice(d,1)})},a.deleteSingCmpt=function(b){a.collect_item_info.coProgramModuleBeans.splice(b,1),0==a.collect_item_info.coProgramModuleBeans.length&&(a.collect_item_info.immediate_exec=0,a.collect_item_info.max_run_time="",a.collect_item_info.run_yn_flag=!0,a.start_time={plan_hour:"",plan_minute:""},a.run_time={flag:1,time:""},a.control.time_format=!0)},a.upSingCmpt=function(b){var c=a.collect_item_info.coProgramModuleBeans,d=c[b];c[b]=c[b-1],c[b-1]=d,a.collect_item_info.coProgramModuleBeans=c},a.downSingCmpt=function(b){var c=a.collect_item_info.coProgramModuleBeans,d=c[b];c[b]=c[b+1],c[b+1]=d,a.collect_item_info.coProgramModuleBeans=c},a.close=function(){a.control.show_cmpts=!1},a.testTimeFormat=function(b,c,d){var e=/^[0-9]{1,2}$/;return 0!=a.collect_item_info.immediate_exec||b||c?(1==d?k++:l++,void(e.test(b)&&b>=0&&24>b?(a.control.time_format=!0,e.test(c)&&c>=0&&60>c?a.control.time_format=!0:l>0&&(a.control.time_format=!1)):k>0&&(a.control.time_format=!1))):!1},a.changeStartTime=function(b){0==b?(a.collect_item_info.run_yn_flag=!0,a.collect_item_info.immediate_exec=b,a.start_time={plan_hour:"",plan_minute:""},a.control.time_format=!0):(a.collect_item_info.run_yn_flag=!1,a.collect_item_info.immediate_exec=b)},a.saveCollectItem=function(){return a.collect_item_info.run_yn_flag?a.collect_item_info.start_bk_time="":(1==a.start_time.plan_hour.length&&(a.start_time.plan_hour="0"+a.start_time.plan_hour),1==a.start_time.plan_minute.length&&(a.start_time.plan_minute="0"+a.start_time.plan_minute),a.collect_item_info.start_bk_time=a.start_time.plan_hour+":"+a.start_time.plan_minute),1==a.run_time.flag?a.collect_item_info.max_run_time=60*parseFloat(a.run_time.time):a.collect_item_info.max_run_time=60*parseFloat(a.run_time.time)*60,0==a.collect_item_info.coProgramModuleBeans.length?(h.alert("请至少添加一个采集组件"),!1):i.valiForm(a.form.collect_item_form)?1!=a.collect_item_info.immediate_exec||a.start_time.plan_hour&&a.start_time.plan_minute?void b.close(a.collect_item_info):(a.control.time_format=!1,!1):!1},a.cancel=function(){b.dismiss()},n()}]),modal_m.controller("cjTaskCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection",function(a,b,c,d,e){a.modal_info=d.modal_info,a.all_node_list=d.node_list,a.checkedCount=0;var f=d.business_sys_name,g=d.module_index,h=function(){for(var b=0;b<a.all_node_list.length;b++)a.all_node_list[b].state=0,a.all_node_list[b].checked=!1,a.all_node_list[b].loading=!0;angular.forEach(a.modal_info.coTaskModuleBeans,function(b){b.cmpt_nodes=[],b.checkedCount=0,b.all_node_list=angular.copy(d.node_list),b.check_all=!1,c(function(){e.getNodesByCmptId(f,b.module_id).then(function(c){if(c.node_list)for(var d=0;d<c.node_list.length;d++)b.cmpt_nodes.push({node_name:c.node_list[d].node_name,node_ip:c.node_list[d].soc_ip,state:0,checked:!1});for(var d=0;d<b.cmpt_nodes.length;d++)for(var e=b.cmpt_nodes[d],f=0;f<b.all_node_list.length;f++){var g=b.all_node_list[f];e.node_ip==g.node_ip&&(g.state=1),g.loading=!1}if(b.coNodeBeans){a.checkedCount=0;for(var d=0;d<b.coNodeBeans.length;d++)for(var h=b.coNodeBeans[d],f=0;f<b.all_node_list.length;f++){var g=b.all_node_list[f];h.node_ip==g.node_ip&&(g.checked=!0,b.checkedCount++)}b.all_node_list.length==b.checkedCount&&(b.check_all=!0)}},function(a){})},1e3)})},i=function(a,b){var c=!0;return angular.forEach(a,function(a){a[b]||(c=!1)}),c},j=function(){a.modal_info.coTaskModuleBeans[g].show_detail=!1,a.toggleModulesDetail(a.modal_info.coTaskModuleBeans[g],g),h()};a.toggleModulesDetail=function(b,c){b.show_detail=!b.show_detail;for(var d=0;d<a.modal_info.coTaskModuleBeans.length;d++)d!=c&&(a.modal_info.coTaskModuleBeans[d].show_detail=!1);if(b.checkedCount=0,b.coNodeBeans)for(var d=0;d<b.coNodeBeans.length;d++)for(var e=b.coNodeBeans[d],f=0;f<b.all_node_list.length;f++){var g=b.all_node_list[f];e.node_ip==g.node_ip&&(g.checked=!0,b.checkedCount++)}},a.stateChangeData=function(a,b){if(0==b.state)return!1;b.checked=!b.checked,a.coNodeBeans=[];for(var c=0;c<a.all_node_list.length;c++){var d=a.all_node_list[c];1==d.state&&d.checked&&a.coNodeBeans.push({node_name:d.node_name,node_ip:d.node_ip})}a.checkedCount=a.coNodeBeans.length?a.coNodeBeans.length:0,a.check_all=i(a.all_node_list,"checked")},a.checkAll=function(a){if(a.coNodeBeans=[],console.log(a.check_all),a.check_all){for(var b=0;b<a.all_node_list.length;b++){var c=a.all_node_list[b];c.checked=!0,1==c.state&&c.checked&&a.coNodeBeans.push({node_name:c.node_name,node_ip:c.node_ip})}a.checkedCount=a.coNodeBeans.length?a.coNodeBeans.length:0}else console.log(0),angular.forEach(a.all_node_list,function(a){a.checked=!1}),a.coNodeBeans=[],a.checkedCount=0},a.formSubmit=function(){b.close(a.modal_info)},a.cancel=function(){b.close()},j()}]),modal_m.controller("addTargetModelCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Inspection",function(a,b,c,d,e,f){a.data={model_all_list:[],model_checked_list:[]};var g=d.model_list?d.model_list:[];a.data.model_checked_list=angular.copy(g);var h=function(){f.getAllIndexModel().then(function(b){a.data.model_all_list=b.indi_model_list?b.indi_model_list:[];for(var c=0;c<a.data.model_all_list.length;c++)angular.forEach(a.data.model_checked_list,function(b){b.indi_model_name==a.data.model_all_list[c].indi_model_name&&(a.data.model_all_list[c].checked=!0)})},function(a){Modal.alert(a.message,3)})};a.addSingleModel=function(b){b.checked=!b.checked;var c={show_detail:!1,indi_model_name:b.indi_model_name,indi_model_cn_name:b.indi_model_cn_name};b.checked?a.data.model_checked_list.push(c):angular.forEach(a.data.model_checked_list,function(c,d){c.indi_model_name==b.indi_model_name&&a.data.model_checked_list.splice(d,1)})},a.formSubmit=function(){b.close(a.data.model_checked_list)},a.cancel=function(){b.close()},h()}]),modal_m.controller("xjtaskConfigModalCtrl",["$scope","$modalInstance","$timeout","modalParam","Inspection",function(a,b,c,d,e){a.form_control={data_loading:!1,error_message:""},a.config_info={modify_chart_list:d.model_info.chart_list?d.model_info.chart_list:[],config_list:[],checkd_list:[]};var f=function(){a.form_control.data_loading=!0,e.getChartListByModelList(d.model_list).then(function(b){c(function(){b&&(a.form_control.data_loading=!1,a.config_info.config_list=b.model_node_list?b.model_node_list:[],angular.forEach(a.config_info.config_list,function(a){a.node_list=a.node_list?a.node_list:[]}),angular.forEach(a.config_info.modify_chart_list,function(b){var c=b;angular.forEach(a.config_info.config_list,function(a){var b=a;angular.forEach(b.node_list,function(a){c.indi_node_name==a.indi_node_name&&c.indi_model_name==a.indi_model_name&&(a.checked=!0)})})}))},0)},function(b){a.form_control.data_loading=!1,a.form_control.error_message=b.message})};a.formSubmit=function(){angular.forEach(a.config_info.config_list,function(b){angular.forEach(b.node_list,function(c){c.checked&&(c.indi_model_name=b.indi_model_name,a.config_info.checkd_list.push(c))})}),b.close(a.config_info.checkd_list)},a.formCancel=function(){b.dismiss(!1)},f()}]),modal_m.controller("configDataCollectionCtrl",["$scope","$modalInstance","$timeout","modalParam","Inspection","Cmpt","Modal","CV",function(a,b,c,d,e,f,g,h){var i=d.data,j=d.task_id,k=d.indi_model_name;a.form={},a.data={filter_info:"",finished_task_list:[],file_type_list:[{key:1,value:"csv"},{key:2,value:"json"},{key:3,value:"other"}],files_list:[]},a.data_config_controls={flag:!1,curr_config_type:1},a.cmpt_script_fileupload={suffixs:"sh",filetype:"SHELL",filename:"",uploadpath:""},a.tabs=[!0,!1],a.data_config_info={file_type:""};var l=function(){n(),e.getCotTaskList().then(function(b){c(function(){b&&(a.data.finished_task_list=b.task_list?b.task_list:[])},0)}),i.taskImportBean&&(1==i.taskImportBean.curr_config_type?(a.data_config_controls.curr_config_type=1,
c(function(){a.config_info_collection=i.taskImportBean,a.data.files_list=i.taskImportBean.all_files?i.taskImportBean.all_files:[]},0)):(a.data_config_controls.curr_config_type=2,a.tabs=[!1,!0],a.data_config_controls.flag=!0,c(function(){a.config_info_hand=angular.copy(i.taskImportBean),a.data_config_info.file_type=i.taskImportBean.import_file_type,a.changeFileType(a.data_config_info.file_type)},0)))},m=function(){e.getUploadFilePath().then(function(b){b&&(a.data_fileupload.uploadpath=b.file_path?b.file_path:"")},function(a){g.alert(a.message,3)})},n=function(){a.data_config_controls.flag=!1,a.data.files_list=[],a.data.filter_info="",a.data_config_info.file_type="",a.config_info_collection={indi_task_id:j,table_name:i.table_name,indi_model_name:k,indi_node_name:i.indi_node_name,co_task_name:"",import_type:0,import_file_type:"",files:[],is_need_clean:1},a.config_info_hand={indi_task_id:j,table_name:i.table_name,indi_model_name:k,indi_node_name:i.indi_node_name,import_type:1,uploadFiles:[],parse_cmd:"",is_need_clean:1},a.data_fileupload={suffixs:"",filename:"",filetype:"",uploadpath:""}};a.getFileList=function(b,d){if(b&&d){for(var f,i=0;i<a.data.finished_task_list.length;i++){var j=a.data.finished_task_list[i];if(j.task_name==d){f=j.task_no;break}}a.config_info_collection.files=[],e.getFileListByFileType(h.findValue(b,a.data.file_type_list),f).then(function(b){c(function(){if(b){var c=b.file_list?b.file_list:[];a.data.files_list=[],angular.forEach(c,function(b,c,d){a.data.files_list.push({state:!1,file_bk_path:b,file_name:b.slice(b.lastIndexOf("/")+1)})})}},0)},function(b){a.data.files_list=[],g.alert(b.message,3)})}},a.ImportSuccessThen=function(){var b={file_name:a.data_fileupload.filename};a.data_fileupload.filename="",a.config_info_hand.uploadFiles.push(b.file_name);a.data_fileupload.uploadpath+a.data_fileupload.filename},a.changeFileType=function(b){if(a.data_config_controls.flag=!1,a.config_info_collection.files=[],c(function(){a.data_config_controls.flag=!0},0),b&&3!=b){var d=h.findValue(b,a.data.file_type_list);a.data_fileupload.suffixs=d,a.data_fileupload.file_type=d}else a.data_fileupload.suffixs="",a.data_fileupload.file_type="";a.data_config_info.file_type=b},a.selectItem=function(b){a.config_info_collection.files=[];for(var c=0;c<a.data.files_list.length;c++){var d=a.data.files_list[c];d.state&&a.config_info_collection.files.push(d.file_bk_path)}},a.close=function(){b.dismiss(!1)},a.saveOrInportData=function(){var d={};if(1==a.data_config_controls.curr_config_type){if(!h.valiForm(a.form.collect_data_form))return!1;d=a.config_info_collection}else{if(!h.valiForm(a.form.collect_hand_form))return!1;if(0==a.config_info_hand.uploadFiles.length)return g.alert("请至少上传一个文件"),!1;d=a.config_info_hand}d.flag=!0,d.is_need_clean=1==d.is_need_clean?!0:!1,e.importXJConfigInfo(j,d).then(function(a){c(function(){a&&(i.import_state=2,i.monitor.import_seq=a.import_seq,b.close(d))},0)},function(a){g.alert(a.message,3)})},a.saveConfigInfo=function(){var c={};if(1==a.data_config_controls.curr_config_type){if(!h.valiForm(a.form.collect_data_form))return!1;a.config_info_collection.all_files=a.data.files_list,a.config_info_collection.curr_config_type=1,c=a.config_info_collection}else{if(!h.valiForm(a.form.collect_hand_form))return!1;if(0==a.config_info_hand.uploadFiles.length)return g.alert("请至少上传一个文件"),!1;a.config_info_hand.curr_config_type=2,c=a.config_info_hand}i.import_state=1,c.flag=!1,b.close(c)},a.changeConfigMethod=function(b){a.data_config_controls.curr_config_type=b,n(),m()},a.deleteFile=function(a,b){b.splice(a,1)},l()}]),modal_m.controller("dataGatherDetailCtrl",["$scope","$modalInstance","$timeout","$rootScope","$interval","Inspection","modalParam",function(a,b,c,d,e,f,g){var h=g.task_id,i=g.data;a.export_detail={source_data_name:i.table_cn_name,data_count:i.total_file_num,time:"",his_detail_list:[]},a.show_flag=3==d.listen_info.import_state?!0:!1,a.control={info_loading:!0};var j=function(){k(),f.viewXJImportHis(h,i.indi_model_name,i.indi_node_name).then(function(b){var c=b.import_bean_list?b.import_bean_list:[];a.control.info_loading=!1;for(var d=0;d<c.length;d++)c[d].day=c[d].import_bk_time.split(" ")[0],c[d].time=c[d].import_bk_time.split(" ")[1];a.export_detail.his_detail_list=c},function(b){a.control.info_loading=!1,Modal.alert(b.message,3)})},k=function(){if(d.listen_info.exec_detail){var b=d.listen_info.exec_detail.import_bk_time.split(" ")[1];a.export_detail.time=b.substring(0,b.lastIndexOf("."))}};a.close=function(){b.dismiss(!1)},j()}]),modal_m.controller("xjMessageTipsCtrl",["$scope","$modalInstance","$timeout","modalParam",function(a,b,c,d){a.remind_info=d.data,a.close=function(){b.close(!0)}}]),modal_m.controller("configLogCtrl",["$scope","$modalInstance","$timeout","BusiSys","NodeReform","Exec","Modal","EncodingType","Collection","LogXJ","logTimeStampType","newLogTimeStampType","ScrollBarConfig","modalParam",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=!1,p=0,q=[];a.log_info={sys_name:"",choose_ip_list:[]},a.data={busys_list:[],node_ip_list:[],encode_type_list:h,date_format_list:l},a.control={next_step:!1,loading_busys:!1,loading_node_ip:!1},a.config={scroll_config:m.Y()},a.log_info.sys_name=n.sys_name?n.sys_name:"",a.log_info.choose_ip_list=n.choose_ip_list?angular.copy(n.choose_ip_list):[],q=n.choose_ip_list?angular.copy(n.choose_ip_list):[],console.log(q),a.log_info.choose_ip_list.length>0&&(o=!0);var r=function(a,b,c){var d="."+a,e="."+b,f=$(d);if(f.is(c.target)||0!=f.has(c.target).length)return $(e).removeClass("display-none").addClass("display-block"),!1;var g=$(e);g.is(c.target)||0!==g.has(c.target).length||$(e).removeClass("display-block").addClass("display-none")},s=function(a,b){for(var c=!0,d=0;d<a.length;d++){var e=a[d];if(!e[b]){c=!1;break}}return c},t=function(){for(var b=0;b<a.log_info.choose_ip_list.length;b++){var c=a.log_info.choose_ip_list[b];c.init_path=c.web_root_path?c.web_root_path:"",c.checked_files=[],c.paths=[],c.active=!1}},u=function(b){a.control.loading_node_ip=!0,j.getAllNodeListBySys(b).then(function(b){c(function(){a.data.node_ip_list=b.prepare_node_list?b.prepare_node_list:[],angular.forEach(a.data.node_ip_list,function(a){a.checked=!1}),a.control.loading_node_ip=!1},0)},function(b){a.control.loading_node_ip=!1,g.alert(b.message,3)})},v=function(a,b){var c=!0;if(a.length==b.length)for(var d=0;d<a.length;d++)a[d].node_name!=b[d].node_name&&(c=!1);else c=!1;return c},w=function(){a.control.loading_busys=!0,d.getAllBusinessSys().then(function(b){c(function(){a.data.busys_list=b.list_bs?b.list_bs:[],b.list_bs&&angular.forEach(a.data.busys_list,function(b){o&&b.business_sys_name==a.log_info.sys_name?b.checked=!0:b.checked=!1}),a.control.loading_busys=!1},0)},function(b){a.control.loading_busys=!1,g.alert(b.message,3)}),o&&(a.control.loading_node_ip=!0,j.getAllNodeListBySys(a.log_info.sys_name).then(function(b){c(function(){a.data.node_ip_list=b.prepare_node_list?b.prepare_node_list:[],angular.forEach(a.data.node_ip_list,function(a){a.checked=!1});for(var c=0;c<a.data.node_ip_list.length;c++)for(var d=a.data.node_ip_list[c],e=0;e<a.log_info.choose_ip_list.length;e++){var f=a.log_info.choose_ip_list[e];d.soc_ip==f.soc_ip&&(d.checked=!0)}a.control.loading_node_ip=!1},0)},function(b){a.control.loading_node_ip=!1,g.alert(b.message,3)}))};a.checkBysys=function(b,c){for(var d=0;d<a.data.busys_list.length;d++){var e=a.data.busys_list[d];e.checked=!1}a.data.node_ip_list=[],b.checked=!0,a.log_info.sys_name=b.business_sys_name,u(b.business_sys_name)},a.chooseCurIp=function(a){a.checked=!a.checked},a.nextStep=function(){if(!a.log_info.sys_name)return g.alert("请选择系统"),!1;var b=[];if(angular.forEach(a.data.node_ip_list,function(a){a.checked&&b.push(a)}),0==b.length)return g.alert("请至少选择一个节点"),!1;v(a.log_info.choose_ip_list,b);o&&v(a.log_info.choose_ip_list,b)?a.log_info.choose_ip_list=q:(a.log_info.choose_ip_list=b,t()),a.control.next_step=!0},a.lastStep=function(){a.control.next_step=!1},a.selectTab=function(a){},a.selectFile=function(a){console.log(a)},a.changePath=function(a){a.loading=!0,i.getFileList(a.node_name,a.full_path).then(function(b){a.loading=!1,a.path_files=b.file_bean_list?b.file_bean_list:[],angular.forEach(a.path_files,function(a){if(!a.dir){var b=a.file.substring(a.file.lastIndexOf("."));".log"==b?a.log_flag=!0:a.log_flag=!1}})},function(b){a.loading=!1,a.err_msg=b.message})},a.chooseCurDateFormat=function(a,b){a[p].date_format=b.key,a[p].date_format_show=b.value;var c=b.value.indexOf("("),d=b.value.indexOf(")");a[p].date_format_show=b.value.substring(0,c),a[p].timestamp_show_title=b.value.substring(c+1,d),$(".target_log_choose").removeClass("display-block").addClass("display-none")},a.showChooseTime=function(a){p=a},a.changeHeight=function(){var a=69+54*p;return{top:a}},a.saveLogList=function(){for(var c=!0,d=!0,e=0;e<a.log_info.choose_ip_list.length;e++){var f=a.log_info.choose_ip_list[e];if(c=s(f.checked_files,"word_coding"),d=s(f.checked_files,"date_format_show"),!c||!d)break}return c&&d?(a.log_info.node_ip_list=a.data.node_ip_list,console.log(a.log_info),void b.close(a.log_info)):(g.alert("请完善日志文件编码或时间格式信息"),!1)},a.formCancel=function(){b.dismiss(!1)},$(document).mouseup(function(a){r("first_span_choose","target_log_choose",a)}),w()}]),modal_m.controller("configLogScreenCtrl",["$scope","$modalInstance","$timeout","BusiSys","NodeReform","Exec","Modal","EncodingType","modalParam","CV",function(a,b,c,d,e,f,g,h,i,j){if(a.form={},a.log_screen={start_hour:"00",start_minutes:"00",end_hour:"23",end_minutes:"59",keywords:"",key_line:""},a.control={time_input_err_msg:""},i.log_screen){console.log(i.log_screen);var k=angular.copy(i.log_screen);a.log_screen=k?k:""}a.timeInputBlur=function(b,c){var d=1==c?"开始时间小时":2==c?"开始时间分钟":3==c?"结束时间小时":4==c?"结束时间分钟":"";return b?a.log_screen.start_hour&&a.log_screen.end_hour&&parseInt(a.log_screen.end_hour)<parseInt(a.log_screen.start_hour)?(a.control.time_input_err_msg="时间间隔有误",!1):a.log_screen.start_hour&&a.log_screen.end_minutes&&a.log_screen.end_hour&&a.log_screen.end_minutes&&a.log_screen.end_hour==a.log_screen.start_hour&&parseInt(a.log_screen.end_minutes)<parseInt(a.log_screen.start_minutes)?(a.control.time_input_err_msg="时间间隔有误",!1):void(a.control.time_input_err_msg=""):(a.control.time_input_err_msg=d+"不能为空",!1)},a.formCancel=function(){b.dismiss(!1)},a.saveScreenInfo=function(){if(!j.valiForm(a.form.log_screen))return!1;if(a.log_screen.startDate>a.log_screen.endDate)return g.alert("开始时间大于结束时间，请重新输入"),!1;if(!a.log_screen.start_hour||!a.log_screen.start_minutes||!a.log_screen.end_hour||!a.log_screen.end_minutes||a.control.time_input_err_msg)return a.control.time_input_err_msg=a.control.time_input_err_msg?a.control.time_input_err_msg:"时间间隔有误",!1;if(a.log_screen.keywords&&!a.log_screen.key_line)return g.alert("请输入截取行数"),!1;if(a.log_screen.key_line&&!a.log_screen.keywords)return g.alert("请输入关键字"),!1;var c=angular.copy(a.log_screen);c.key_line=parseInt(a.log_screen.key_line?a.log_screen.key_line:0),b.close(c)}}]),modal_m.controller("reportLogChooseCtrl",["$scope","$modalInstance","$timeout","BusiSys","NodeReform","Exec","Modal","EncodingType","modalParam","ScrollConfig","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=1,m=!1,n=i.sys_name,o=new Date;a.info={datepicker:{},max_date:o},a.control={show_input:!0},a.config={scroll_config:j},a.data={log_type_list:[],log_ip_file:[],logSyncInfoList:[],curr_node:""},a.report_choose={start_date:"",end_date:"",choose_log_list:[],choose_log_name:""},a.form={};var p=function(b,c){for(var d=0;d<a.data.log_type_list.length;d++){var e=a.data.log_type_list[d],f=e.logSyncInfos?e.logSyncInfos:[],g=r(b,c,f);g.length>0?e.uncheck=!1:(e.uncheck=!0,e.choose_log=!1)}},q=function(){d.getAllLogList(n,l).then(function(b){c(function(){a.data.log_type_list=b.logBeanList?b.logBeanList:[],b.logBeanList&&angular.forEach(a.data.log_type_list,function(a){a.logSyncInfos&&a.logSyncInfos.length>0?a.uncheck=!1:a.uncheck=!0,a.checked=!1})},0)},function(a){g.alert(a.message,3)})},r=function(a,b,c){var d=[],e=k.dtFormat(a),f=k.dtFormat(b);return angular.forEach(c,function(a){e<=a.file_date&&a.file_date<=f&&d.push(a)}),d},s=function(){(i.report_choose.choose_log_list||i.report_choose.choose_log_name)&&(m=!0,a.report_choose=i.report_choose),m?d.getAllLogList(n,l).then(function(b){c(function(){if(a.data.log_type_list=b.logBeanList?b.logBeanList:[],b.logBeanList&&angular.forEach(a.data.log_type_list,function(a){a.checked=!1}),angular.forEach(a.data.log_type_list,function(b){b.log_name==a.report_choose.choose_log_name&&(b.checked=!0,a.data.logSyncInfoList=r(a.report_choose.start_date,a.report_choose.end_date,b.logSyncInfos),a.data.curr_node=b.logSyncInfos)}),a.report_choose.choose_log_list&&a.report_choose.choose_log_list.length>0)for(var c=0;c<a.report_choose.choose_log_list.length;c++)for(var d=a.report_choose.choose_log_list[c],e=0;e<a.data.log_type_list.length;e++){var f=a.data.log_type_list[e];f.log_name==d.log_name&&(f.choose_log=!0)}p(a.report_choose.start_date,a.report_choose.end_date)},0)},function(a){g.alert(a.message,3)}):q()};a.open=function(b,c){b.preventDefault(),b.stopPropagation(),a.info.datepicker.opened=!0},a.checkCurLogType=function(b){for(var c=0;c<a.data.log_type_list.length;c++){var d=a.data.log_type_list[c];d.checked=!1}if(b.checked=!0,a.report_choose.choose_log_name=b.log_name,a.data.curr_node=b.logSyncInfos,a.report_choose.start_date&&a.report_choose.end_date){var e=[];if(b.logSyncInfos)for(var f=0;f<b.logSyncInfos.length;f++){var g=b.logSyncInfos[f];g.file_date&&k.dtFormat(a.report_choose.start_date)<=g.file_date&&g.file_date<=k.dtFormat(a.report_choose.end_date)&&e.push(g)}a.data.logSyncInfoList=e}else a.data.logSyncInfoList=b.logSyncInfos?b.logSyncInfos:[]},a.saveReport=function(){if(!k.valiForm(a.form.log_screen))return!1;var c=[];return angular.forEach(a.data.log_type_list,function(a){a.choose_log&&c.push(a)}),a.report_choose.choose_log_list=c,a.report_choose.start_date=k.dtFormat(a.report_choose.start_date),a.report_choose.end_date=k.dtFormat(a.report_choose.end_date),a.report_choose.start_date>a.report_choose.end_date?(g.alert("时间输入不合法，请重新输入"),!1):0==a.report_choose.choose_log_list.length?(g.alert("未选择日志文件"),!1):void b.close(a.report_choose)},a.formCancel=function(){b.dismiss(!1)},a.$watch("report_choose.end_date",function(b,c){b!=c&&(a.data.logSyncInfoList=r(a.report_choose.start_date,a.report_choose.end_date,a.data.curr_node),p(a.report_choose.start_date,a.report_choose.end_date))}),s()}]),modal_m.controller("importProgramCtrl",["$scope","$modalInstance","$timeout","$location","Program","Modal","CV",function(a,b,c,d,e,f,g){a.import_program_btn_loading=!0,a.program_loading=!1,a.program_error_upload=!1;var h=!1;a.program_fileupload={suffixs:"sql",filetype:"SQL",filename:"",uploadpath:""};var i=function(){e.getimportProgramUploadPath().then(function(b){c(function(){b&&(a.program_fileupload.uploadpath=b.program_upload_path)},0)},function(a){f.alert(a.message,3)})};a.uploadSuccessThen=function(){a.import_program_btn_loading=!1,a.program_loading=!1,e.importUsableProgram(a.program_fileupload.filename).then(function(){h=!0,a.program_loading=!0},function(b){a.program_loading=!0,a.program_error_upload=!0,a.program_error_message=b.message})},a.cancel=function(){h?b.close(!0):b.dismiss(!1)},i()}]),modal_m.controller("pgChangeHandleTypeCtrl",["$scope","$modalInstance","modalParam","Workorder","Modal","CV",function(a,b,c,d,e,f){var g=c.workId;a.info={sub_tab:{temp_handle_type:"",order_bk_title:""},form:{}};var h=function(){d.getWorkorder(g).then(function(b){b.woorderbean&&(a.info.sub_tab.order_bk_title=b.woorderbean.order_bk_title)},function(a){e.alert(a.message)})};a.formSubmit=function(){return f.valiForm(a.info.form.changeTypeform)?void b.close(a.info.sub_tab):!1},a.cancel=function(){b.dismiss()},h()}]),modal_m.controller("workorderAddSQLModalCtrl",["$scope","$modalInstance","$timeout","$location","modalParam","CodeMirrorOption","SqlExec","Program","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=e.flag,m=[],n="1";a.control={save_btn_loading:!1,get_soc_loading:!1,get_sys_loading:!1,get_srv_loading:!1},a.info={form:{},error_message:"",sql_info:{},sensite_info:{}},a.data={sql_sys_list:[],sql_soc_list:[],sql_srv_list:[],srv_name:""},a.config={editorOptions:f.Sql()};var o=function(){1==l?(a.info.sql_info.sys_name=e.sub_tab.basicData.sys_name?e.sub_tab.basicData.sys_name:"",1==e.sub_tab.basicData.workorder_type&&a.info.sql_info.sys_name&&a.selectSys(a.info.sql_info.sys_name),a.info.sql_info={sql_steps:[],sys_name:e.sub_tab.basicData.sys_name?e.sub_tab.basicData.sys_name:""},4==e.sub_tab.handle_type&&(a.info.sensite_info={show_table_flag:!0,sensitive_list:[]})):a.info.sql_info={sys_name:"",sql_txt:"",soc_name:""},a.control.get_sys_loading=!0,i.getAllBusinessSys().then(function(b){c(function(){b&&(a.control.get_sys_loading=!1,a.data.sql_sys_list=b.list_bs?b.list_bs:[])},0)},function(b){a.control.get_sys_loading=!1,j.alert(b.message,3)}),p()},p=function(){a.control.get_srv_loading=!0,h.selectSrv(n).then(function(b){if(b){a.control.get_srv_loading=!1,m=b.server_bean_list;for(var c=0;c<m.length;c++)a.data.sql_srv_list[c]=m[c].server_ip}},function(b){j.alert(b.message,3),a.control.get_srv_loading=!1})};a.selectSrv=function(b){for(var c=0;c<m.length;c++)m[c].server_ip==b&&(a.data.sql_soc_list=m[c].all_soc_name)};var q=function(d){var e=d.basicData.order_seq,h=d.basicData.deal_bk_seq,i=a.info.sql_info.sys_name,k=a.info.sql_info.soc_name,l=a.info.sql_info.sql_txt;4==d.handle_type?g.addSelectSql(e,h,i,l,k).then(function(e){c(function(){if(e.parser_flag&&e.sl_msg_list){for(var c=0;c<e.sl_msg_list.length;c++){var g=e.sl_msg_list[c];g.sensite_list=a.info.sensite_info.sensitive_list,a.info.sql_info.sql_steps.push(g)}var h={sql_steps:a.info.sql_info.sql_steps,is_sql:d.is_sql};b.close(h)}else e.parser_failed_msg&&j.alert(e.parser_failed_msg);a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1)},0)},function(b){a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1),j.alert(b.message,3)}):g.addSql(e,h,i,l,k).then(function(e){c(function(){if(e.parser_flag&&e.sl_msg_list){for(var c=0;c<e.sl_msg_list.length;c++){var g=e.sl_msg_list[c];a.info.sql_info.sql_steps.push(g)}var h={sql_steps:a.info.sql_info.sql_steps,is_sql:d.is_sql};b.close(h)}else e.parser_failed_msg&&j.alert(e.parser_failed_msg);a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1)},0)},function(b){a.control.save_btn_loading=!1,a.config.editorOptions=f.Sql(!1),j.alert(b.message,3)})};a.selectSys=function(b){a.info.error_message="",a.control.get_soc_loading=!0,h.getSocByBusy(b,1).then(function(b){c(function(){if(b){a.info.sql_info.soc_name="",a.control.get_soc_loading=!1,a.data.sql_soc_list=[];for(var c=b.source_list?b.source_list:[],d=0;d<c.length;d++)a.data.sql_soc_list.push(c[d].soc_name)}},0)},function(b){a.control.get_soc_loading=!1,a.info.error_message=b.message})},a.addSensitiveParam=function(a){var b=a.length;return 0==b||""!=a[b-1].param_name&&""!=a[b-1].param_value?void a.push({param_name:"",param_value:""}):(j.alert("请完善当前数据操作"),!1)},a.removeSensitiveParam=function(a,b){b.splice(a,1)},a.formSubmit=function(){return k.valiForm(a.info.form.sql_handle_form)?(a.control.save_btn_loading=!0,a.config.editorOptions=f.Sql(!1),void(1==l?q(e.sub_tab):(a.info.sql_info.sql_txt=a.info.sql_info.sql_txt.trim(),h.addProgramStepSql(e.program_seq,a.info.sql_info.step_seq,a.info.sql_info.sql_txt,a.info.sql_info.sys_name).then(function(c){c&&(a.control.save_btn_loading=!1,a.info.sql_info.sql_param_list=c.sql_param_list?c.sql_param_list:[],b.close(a.info.sql_info))},function(b){a.control.save_btn_loading=!1,j.alert("请填写正确的SQL语句")})))):!1},a.formCancel=function(){b.dismiss(!1)},o()}]),modal_m.controller("importProgramSqlCtrl",["$scope","$modalInstance","$timeout","modalParam","Program","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h){a.info={sql_info:{sys_name:"",sql_txt:"",soc_name:"",sql_seq:0},form:{sql_handle_form:{}},handleData:d.handleData,error_message:""},a.data={busy_sys_list:[],sql_soc_list:[],srv_list:[]},a.control={soc_btn_loading:!1};var i=function(){a.info.handleData.checkFlag=0,a.changeSysNameAndSoc(a.info.handleData.sql_msg_list[0]),f.getAllBusinessSys().then(function(b){a.data.busy_sys_list=b.list_bs?b.list_bs:[]},function(a){g.alert(a.message,3)})};a.selectSys=function(b){a.info.error_message="",a.control.soc_btn_loading=!0,e.getSocByBusy(b,1).then(function(b){c(function(){if(b){a.data.sql_soc_list=[];for(var c=b.source_list?b.source_list:[],d=0;d<c.length;d++)a.data.sql_soc_list.push(c[d].soc_name);console.log(a.data.sql_soc_list),a.control.soc_btn_loading=!1}},0)},function(b){a.control.soc_btn_loading=!1,a.info.error_message=b.message})},a.changeSysNameAndSoc=function(b){b&&(a.info.sql_info.sys_name=b.sys_name,a.info.sql_info.soc_name=b.soc_name,a.info.sql_info.curr_index=b.curr_index,a.info.sql_info.sql_txt=b.sql_text,a.selectSys(a.info.sql_info.sys_name))},a.saveAddSql=function(){return h.valiForm(a.info.form.sql_handle_form)?void b.close(a.info.sql_info):!1},a.cancel=function(){b.dismiss()},i()}]),modal_m.controller("importBatchSQLCtrl",["$scope","$modalInstance","$timeout","modalParam","SqlExec","Modal","CV",function(a,b,c,d,e,f,g){a.info={sub_tab:d.sub_tab},a.config={sql_fileupload:{suffixs:"sql",filetype:"SQL",filename:"",uploadpath:a.info.sub_tab.batch_fileupload.uploadpath}},a.uploadSqlSuccessThen=function(){a.info.sub_tab.batch_fileupload.filename=a.config.sql_fileupload.filename},a.removeSqlFile=function(){a.config.sql_fileupload.filename="",a.info.sub_tab.batch_fileupload.filename=""},a.downloadSqlFile=function(){var b=a.config.sql_fileupload.uploadpath+"/"+a.config.sql_fileupload.filename;g.downloadFile(b)},a.submit=function(){return a.config.sql_fileupload.filename?(console.log(a.info.sub_tab),void b.close(a.info.sub_tab)):(f.alert("请先上传SQL文件！"),!1)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("viewExeInfoCtrl",["$scope","$modalInstance","modalParam",function(a,b,c){a.message=c.message?c.message:[],a.scroll_exec_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("viewTaskDetailCtrl",["$scope","$modalInstance","$timeout","modalParam","SqlExec","Task",function(a,b,c,d,e,f){var g=d.task_id?d.task_id:"";a.work_detail_list=[],a.currentPoint=0,a.data_loading=!0,a.error_message="",a.scroll_flow_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},f.getTaskDetail(g).then(function(b){a.data_loading=!1,a.work_detail_list=b.work_detail_list?b.work_detail_list:[],a.apply_bk_expl=b.apply_bk_expl?b.apply_bk_expl:"",a.pendwk_bk_expl=b.pendwk_bk_expl?b.pendwk_bk_expl:"",a.user_cn_name=b.user_cn_name?b.user_cn_name:"",a.workflow_state=b.workflow_state?b.workflow_state:"";for(var c=0;c<a.work_detail_list.length;c++)1==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="申请":2==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="复核":3==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="授权":4==a.work_detail_list[c].pend_type?a.work_detail_list[c].deal_type_name="执行":a.work_detail_list[c].deal_type_name="关闭";for(var c=0;c<a.work_detail_list.length;c++)a.work_detail_list[c].user_cn_name&&(a.currentPoint=c),a.work_detail_list[c].show=!1},function(b){a.data_loading=!1,a.error_message=b.message}),a.styleCh=function(a){return{position:"relative",top:(0==a?2:79*a)+"px"}},a.styleAng=function(b,c){return 2==a.workflow_state||4==a.workflow_state?{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state?"#0095A5":2==c.work_state?"#D85668":b==a.work_detail_list.length-1?"#fff":"#CCCCCC","border-radius":"20px",border:1==c.work_state?"2px solid #0095A5":2==c.work_state?"2px solid #D85668":b==a.work_detail_list.length-1?"2px solid #0095A5":"2px solid #CCCCCC",left:"100px",top:"10px","text-align":"center"}:1==a.workflow_state||3==a.workflow_state||5==a.workflow_state?{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state||3==c.work_state?"#0095A5":"#1c2837",border:"2px solid #0095A5","border-radius":"20px",left:"100px",top:"10px","text-align":"center"}:7==a.workflow_state?{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state&&b!=a.work_detail_list.length-1?"#0095A5":2==c.work_state?"#F37889":b==a.work_detail_list.length-1?"black":"#CCCCCC","border-radius":"20px",left:"100px",top:"10px","text-align":"center"}:{position:"absolute",width:"20px",height:"20px","background-color":1==c.work_state?"#0095A5":2==c.work_state?"#F37889":4==c.work_state?"#0095A5":"#CCCCCC","border-radius":"20px",left:"100px",top:"10px","text-align":"center"}},a.formCancel=function(){b.close(a.workflow_state)}}]),modal_m.controller("ProgramDetailSqlStepCtrl",["$scope","$modalInstance","$timeout","SqlExec","modalParam","SqlType","BucketType","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=e.sql_work_seq;a.info={sql_seq:"",sql_text:"",sys_cn_name:"",soc_priv:"",stp_info_list:[],sql_type:"",priv_yn_flag:"",sql_where:"",scp_info_list:[],exp_bk_num:"",exp_exec_time:"",bucket_type:""},a.control={sqldetail_loading:!1,sqldetail_error:!1,sqldetail_error_message:""};var k=function(){d.getSqlSchemeResult(j).then(function(b){c(function(){b.sql_detail_msg&&(a.info.sql_seq=b.sql_detail_msg.sql_seq,a.info.sql_text=b.sql_detail_msg.sql_text,a.info.sys_cn_name=b.sql_detail_msg.sys_cn_name,a.info.soc_priv=b.sql_detail_msg.soc_priv,a.info.stp_info_list=b.sql_detail_msg.stp_info_list?b.sql_detail_msg.stp_info_list:[],a.info.sql_type=b.sql_detail_msg.sql_type,a.info.priv_yn_flag=b.sql_detail_msg.priv_yn_flag,a.info.sql_where=b.sql_detail_msg.sql_where,a.info.scp_info_list=b.sql_detail_msg.scp_info_list?b.sql_detail_msg.scp_info_list:[],a.info.exp_bk_num=b.sql_detail_msg.exp_bk_num,a.info.exp_exec_time=b.sql_detail_msg.exp_exec_time,a.info.bucket_type=b.sql_detail_msg.bucket_type,a.info.sql_type_cn=i.findValue(a.info.sql_type,f),a.info.bucket_cn_type=i.findValue(a.info.bucket_type,g),a.control.sqldetail_loading=!0)},0)},function(b){a.control.sqldetail_loading=!0,a.control.sqldetail_error=!0,a.control.sqldetail_error_message=b.message})};a.closeModal=function(){b.dismiss(!1)},k()}]),modal_m.controller("ProgramConfirmSqlStatementCtrl",["$scope","$modalInstance","modalParam","Modal",function(a,b,c,d){a.info={sql_step:c.sql_step,unsubmit_sql_steps:c.un_submit_sql_steps},a.control={confirm_btn_loading:!1},a.viewSqlStepModal=function(a){d.viewSqlDetailStep(a).then(function(){})},a.confirm=function(){a.confirm_btn_loading=!0,b.close(a.sql_step)},a.cancel=function(){b.dismiss(!1)}}]),modal_m.controller("pgLocalauthCtrl",["$scope","$modalInstance","Workorder","modalParam","Modal",function(a,b,c,d,e){a.condition_text=d.data.condition_text,a.u={},a.authdprl_bk_expl=d.data.authdprl_bk_expl,a.btnBus_loading=!1,a.order_bk_title=d.srv_req.order_bk_title,a.program_name=d.srv_req.program_name,a.step_bk_title=d.srv_req.step_bk_title,a.ok=function(){if(a.btnBus_loading=!0,!a.u.userId)return e.alert("授权用户名为空！"),a.btnBus_loading=!1,!1;if(!a.u.userPwd)return e.alert("授权用户密码为空！"),a.btnBus_loading=!1,!1;var f={auth_dprl_code:d.data.auth_dprl_code,auth_user_id:a.u.userId,user_passed:a.u.userPwd,auth_key:d.data.auth_key};c.checkPgLocalAuth(f).then(function(a){1==a.pgsvdeal_type?b.close(a):2==a.pgsvdeal_type&&b.close(a)},function(c){a.btnBus_loading=!1,b.dismiss({status:"system",message:c.message})})},a.cancel=function(){b.close("system")}}]),modal_m.controller("pgRemoteauthCtrl",["$scope","$modalInstance","Task","modalParam","Modal","CV",function(a,b,c,d,e,f){a.info={order_bk_title:d.srv_req.order_bk_title,pendwk_bk_expl:d.data.condition_text,program_name:d.srv_req.program_name,step_bk_title:d.srv_req.step_bk_title,apply_bk_expl:"",form:{}},a.control={btnBus_loading:!1},a.submitRaForm=function(){if(a.control.btnBus_loading=!0,!f.valiForm(a.info.form.raForm))return a.control.btnBus_loading=!1,!1;var e=angular.copy(d.srv_req);d.data.pgsubmit_type=4,d.data.apply_bk_expl=a.info.apply_bk_expl,d.data.sql_list=e.sql_list,d.data.order_seq=e.order_seq,d.data.deal_bk_seq=e.deal_bk_seq,d.data.order_bk_title=e.order_bk_title,d.data.program_name=e.program_name,d.data.step_bk_title=e.step_bk_title,d.data.step_seq=e.step_seq,c.ExecuteTask(d.data,e.org_srv_name).then(function(a){a.success=!0,b.close(a)},function(c){a.control.btnBus_loading=!1,b.close("system")})},a.cancel=function(){b.close("system")}}]),modal_m.controller("viewScriptInfoCtrl",["$scope","$modalInstance","$timeout","modalParam","CodeMirrorOption","CmptFunc","ScriptExec",function(a,b,c,d,e,f,g){var h=d.order_seq,i=d.deal_bk_seq,j=d.script_bk_seq;a.info={impl_type:"",script_text:"",exe_msg_list:[],error_msg:""},a.control={error_flag:!1,loading_flag:!1},a.config={detailOptionShell:e.Sh(!0),detailOptionPython:e.Python(!0)};var k=function(){a.control.loading_flag=!0,g.viewStepDetail(h,i,j).then(function(b){c(function(){if(b.exetend_bean){a.control.loading_flag=!1,a.info.impl_type=b.exetend_bean.impl_type,a.info.script_text=b.exetend_bean.script_content?f.cmdsToString(b.exetend_bean.script_content):"",a.info.exe_msg_list=b.exetend_bean.source_list?b.exetend_bean.source_list:[];for(var c=0;c<a.info.exe_msg_list.length;c++)if(a.info.exe_msg_list[c].collapse_flag=!0,2==a.info.exe_msg_list[c].exe_result){a.control.error_flag=!0;break}}},0)},function(b){a.control.loading_flag=!1,a.info.error_msg=b.message})};a.close=function(){b.close(!0)},k()}]),modal_m.controller("viewWorkOrderFlowCtrl",["$scope","$modalInstance","$timeout","ScrollBarConfig","modalParam",function(a,b,c,d,e){a.info={pgDetailList:[]},a.config={scroll_y_info:d.Y()};var f=function(){a.info.pgDetailList=e.data.pg_detail_list?e.data.pg_detail_list:[]};a.formCancel=function(){b.close("error")},f()}]),modal_m.controller("faultProgramSqlDetailCtrl",["$scope","$modalInstance","$timeout","modalParam","Program","SqlType","Modal","CV",function(a,b,c,d,e,f,g,h){var i=d.program_seq,j=d.step_seq,k=d.sql_seq;a.info={step_seq:j,sql_index:k,sql_detail_info:{}},a.control={sql_detail_loading:!1,sql_detail_error:!1};var l=function(b,c,d){a.control.sql_detail_loading=!0,e.viewProgramStepSqlDetail(b,c,d).then(function(b){b.sql_parse_bean&&(a.info.sql_detail_info.sql_type=b.sql_parse_bean.sql_type,a.info.sql_detail_info.sql_type_cn=h.findValue(a.info.sql_detail_info.sql_type,f),a.info.sql_detail_info.sys_cn_name=b.sql_parse_bean.sys_cn_name,a.info.sql_detail_info.sql_text=b.sql_parse_bean.sql_text,a.info.sql_detail_info.sql_where=b.sql_parse_bean.sql_where,a.info.sql_detail_info.tbl_name_list=b.sql_parse_bean.tbl_name_list?b.sql_parse_bean.tbl_name_list:[],a.info.sql_detail_info.select_parse_list=b.sql_parse_bean.select_parse_list?b.sql_parse_bean.select_parse_list:[],a.info.sql_detail_info.modify_parse_list=b.sql_parse_bean.modify_parse_list?b.sql_parse_bean.modify_parse_list:[],a.control.sql_detail_loading=!1)},function(b){a.control.sql_detail_loading=!1,a.control.sql_detail_error=!0,a.info.sql_detail_info.errorMessage=b.message})},m=function(){l(i,j,k)};a.cancel=function(){b.dismiss(!1)},m()}]),modal_m.controller("importProgramStepCtrl",["$scope","$modalInstance","$timeout","modalParam","Program","Modal","CV",function(a,b,c,d,e,f,g){a.info={excel_download_path:""},a.config={program_step_fileupload:{suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:""}};var h=function(){e.getimportProgramUploadPath().then(function(b){c(function(){b&&(a.config.program_step_fileupload.uploadpath=b.program_upload_path?b.program_upload_path:"")},0)},function(a){f.alert(a.message,3)})};a.uploadSuccessThen=function(){a.info.excel_download_path=a.config.program_step_fileupload.uploadpath+a.config.program_step_fileupload.filename},a.downLoadExcel=function(){g.downloadFile(a.info.excel_download_path);
},a.deleteExcel=function(){a.config.program_step_fileupload.filename=""},a.saveProgramStep=function(){return a.config.program_step_fileupload.filename?void b.close(a.config.program_step_fileupload.filename):(f.alert("请先上传文件！"),!1)},a.cancel=function(){b.dismiss()},h()}]),modal_m.controller("viewTroubleTicketProgramCtrl",["$scope","$modalInstance","$timeout","modalParam","Task","WoStatusType","ScrollBarConfig","Modal",function(a,b,c,d,e,f,g,h){var i=d.task_id;a.info={},a.config={scroll_info:g.XY()};var j=function(b){e.viewTaskProgramDetail(b).then(function(b){c(function(){a.info=b},0)},function(a){h.alert(a.message,3)})},k=function(){j(i)};a.close=function(){b.dismiss(!1)},k()}]),modal_m.controller("faultPeakDateModalCtrl",["$scope","$modalInstance","WorkDayType","modalParam","TroubleConfig","Modal","CV",function(a,b,c,d,e,f,g){var h=d.time_work_seq,i=new Date;i.setHours(0),i.setMinutes(0);var j=new Date;j.setHours(23),j.setMinutes(59),a.info={peak_data:{time_cn_name:"",time_bk_desc:"",wday_type:"",start_bk_date:"",end_bk_date:"",times:[],start_time:i,end_time:j},form:{}},a.data={work_day_type_list:c},a.control={edit_flag:!1,show_date_flag:!1,show_time_group_flag:!1,save_btn_loading:!1};var k=function(){h&&e.viewPeakTimeIntervalInfo(h).then(function(b){if(b.time_interval_bean){var d=b.time_interval_bean;a.info.peak_data.time_work_seq=d.time_work_seq,a.info.peak_data.time_cn_name=d.time_cn_name,a.info.peak_data.time_bk_desc=d.time_bk_desc,a.info.peak_data.wday_type=d.wday_type,(3==a.info.peak_data.wday_type||4==a.info.peak_data.wday_type)&&(a.control.show_date_flag=!0),a.info.peak_data.wday_type_cn=g.findValue(d.wday_type,c),d.start_bk_date&&d.end_bk_date&&(a.info.peak_data.start_bk_date=d.start_bk_date,a.info.peak_data.end_bk_date=d.end_bk_date),a.info.peak_data.times=d.times}})};a.changeDateState=function(b){a.control.show_date_flag=3==b||4==b?!0:!1,(1==b||2==b)&&(a.info.peak_data.start_bk_date="",a.info.peak_data.end_bk_date="")},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.info.form.opened=!0},a.addTimeGroup=function(b,c){var d=g.dttFormat(b).substr(0,5),e=g.dttFormat(c).substr(0,5);if(b>c)return f.alert("开始时间大于结束时间，请重新选择"),!1;for(var h=0;h<a.info.peak_data.times.length;h++){var i=a.info.peak_data.times[h];if(d==i.start_time&&e==i.end_time)return f.alert("不可重复添加，重新选择！"),!1}a.info.peak_data.times.push({start_time:d,end_time:e})},a.deleteTimeGroup=function(b){a.info.peak_data.times.splice(b,1)},a.formSubmit=function(){if(!g.valiForm(a.info.form.peakForm))return!1;if(3==a.info.peak_data.wday_type||4==a.info.peak_data.wday_type){if(!a.info.peak_data.start_bk_date||!a.info.peak_data.end_bk_date)return f.alert("日期不可以为空"),!1;if(a.info.peak_data.start_bk_date>a.info.peak_data.end_bk_date)return f.alert("开始日期大于结束日期，请重新选择"),!1;a.info.peak_data.start_bk_date=g.dtFormat(a.info.peak_data.start_bk_date),a.info.peak_data.end_bk_date=g.dtFormat(a.info.peak_data.end_bk_date)}a.control.save_btn_loading=!0,h?e.modifyPeakTimeInterval(a.info.peak_data).then(function(c){c&&(f.alert("修改成功"),a.control.save_btn_loading=!1,b.close(!0))},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)}):e.addPeakTimeInterval(a.info.peak_data).then(function(c){c&&(a.control.save_btn_loading=!1,f.alert("新增成功"),b.close(!0))},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)})},a.formCancel=function(){b.dismiss(!1)},k()}]),modal_m.controller("faultTroubleTypeCtrl",["$scope","$modalInstance","$timeout","modalParam","TroubleConfig","Modal","CV",function(a,b,c,d,e,f,g){var h=d.trouble_key;a.info={form:{},trouble_type_info:{trouble_code:"",trouble_bk_desc:""}},a.control={edit_flag:!1,save_btn_loading:!1};var i=function(){h&&(a.control.edit_flag=!0,e.viewTroubleTypeInfo(h).then(function(b){c(function(){a.info.trouble_type_info.trouble_key=b.trouble_key,a.info.trouble_type_info.trouble_code=b.trouble_code?b.trouble_code:"",a.info.trouble_type_info.trouble_bk_desc=b.trouble_bk_desc?b.trouble_bk_desc:""},0)},function(a){f.alert(a.message,3)}))};a.formSubmit=function(){return a.control.save_btn_loading=!0,g.valiForm(a.info.form.trouble_type_form)?void(h?e.updateTroubleType(a.info.trouble_type_info).then(function(d){d&&c(function(){a.control.save_btn_loading=!1,f.alert("修改成功"),b.close(!0)},0)},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)}):e.addTroubleType(a.info.trouble_type_info).then(function(d){d&&c(function(){a.control.save_btn_loading=!1,f.alert("新增成功"),b.close(!0)},0)},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)})):(a.control.save_btn_loading=!1,!1)},a.formCancel=function(){b.dismiss(!1)},i()}]),modal_m.controller("schemePreviewCtrl",["$scope","$timeout","$routeParams","$modalInstance","modalParam","Program","Modal",function(a,b,c,d,e,f,g){a.info={program_seq:e.programSeq,steps:[]};var h=function(c){b(function(){f.previewProgram(c).then(function(b){a.info.steps=b.preview_pg_list?b.preview_pg_list:[]},function(a){g.alert(a.message,3)})},0)},i=function(){h(a.info.program_seq)};a.lineStyle=function(a){return{width:"2px",height:"100%",position:"absolute","background-color":2==a.type?"#3D9ED8":"#555f76",left:"-32px",top:"18px"}},a.cancel=function(){d.close(!0)},i()}]),modal_m.controller("workOrderRollbackCtrl",["$scope","$timeout","$modalInstance","modalParam","Workorder","Modal","CV",function(a,b,c,d,e,f,g){var h=d.order_seq;a.info={workorder_rollback_info:{order_seq:h,workorder_title:"",deal_bk_expl:""},form:{}},a.control={save_rollback_btn_loading:!1};var i=function(){e.getWorkorder(h).then(function(c){b(function(){c.woorderbean&&(a.info.workorder_rollback_info.workorder_title=c.woorderbean.order_bk_title)},0)},function(a){f.alert(a.message,3)})};a.formSubmit=function(){return g.valiForm(a.info.form.rollback_form)?(a.control.save_rollback_btn_loading=!0,void e.rollbackWorkorder(a.info.workorder_rollback_info).then(function(d){b(function(){d&&(a.control.save_rollback_btn_loading=!1,c.close(!0))},0)},function(b){a.control.save_rollback_btn_loading=!1,f.alert(b.message,3)})):!1},a.formCancel=function(){c.dismiss(!1)},i()}]),modal_m.controller("workOrderAppointCtrl",["$scope","$timeout","$modalInstance","$rootScope","modalParam","Workorder","Modal","CV",function(a,b,c,d,e,f,g,h){var i=e.order_seq,j=d.loginUser,k=j.org_user_id,l=j.org_dept_id;a.form={},a.info={workorder_appoint_info:{order_seq:i,deal_dept_id:"",deal_user_id:"",order_bk_title:""},form:{}},a.data={department_list:[],employee_list:[]},a.control={judge_cur_appoint:!1,save_appoint_btn_loading:!1,get_appoint_info_loading:!1};var m=function(c){f.getAppointStaffList(c).then(function(c){b(function(){a.data.employee_list=c.user_list?c.user_list:[]},0)},function(a){g.alert(a.message,3)})},n=function(b,c){l==b&&k==c?a.control.judge_cur_appoint=!0:a.control.judge_cur_appoint=!1},o=function(){a.control.get_appoint_info_loading=!0,f.getWorkorder(i).then(function(c){b(function(){c.woorderbean&&(a.control.get_appoint_info_loading=!1,a.info.workorder_appoint_info.order_bk_title=c.woorderbean.order_bk_title,a.info.workorder_appoint_info.deal_dept_id=c.woorderbean.deal_dept_id,a.info.workorder_appoint_info.deal_user_id=c.woorderbean.deal_user_id,m(a.info.workorder_appoint_info.deal_dept_id),n(a.info.workorder_appoint_info.deal_dept_id,a.info.workorder_appoint_info.deal_user_id))},0)},function(b){a.control.get_appoint_info_loading=!1,a.info.error_message=b.message}),f.getAppointDepartmentList().then(function(c){b(function(){a.data.department_list=c.dept_list?c.dept_list:[]},0)},function(a){g.alert(a.message,3)})};a.selectDepartment=function(b){a.info.workorder_appoint_info.deal_user_id="",m(b)},a.formSubmit=function(){return h.valiForm(a.info.form.pointForm)?(a.control.save_appoint_btn_loading=!0,void f.appiontWorkorder(a.info.workorder_appoint_info).then(function(d){b(function(){d&&(a.control.save_appoint_btn_loading=!1,c.close(!0))},0)},function(b){a.control.save_appoint_btn_loading=!1,g.alert(b.message,3)})):!1},a.formCancel=function(){c.dismiss(!1)},o()}]),modal_m.controller("workOrderChangeCtrl",["$scope","$timeout","$modalInstance","Workorder","modalParam","WoCloseType","WoRestartType","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=e.order_seq;a.info={workorder_change_info:{order_seq:j,workorder_title:"",flow_type:"",close_type:"",restart_type:"",deal_bk_expl:""},form:{}},a.control={save_change_btn_loading:!1},a.data={change_reason:[]};var k=function(){d.getWorkorder(j).then(function(c){b(function(){c.woorderbean&&(a.info.workorder_change_info.workorder_title=c.woorderbean.order_bk_title)},0)},function(a){h.alert(a.message,3)})};a.selectChangeType=function(b){a.info.workorder_change_info.flow_type=b,5==a.info.workorder_change_info.flow_type?a.data.change_reason=f:a.data.change_reason=g},a.formSubmit=function(){return a.info.workorder_change_info.flow_type?i.valiForm(a.info.form.change_form)?(a.control.save_change_btn_loading=!0,void d.changeWorkorder(a.info.workorder_change_info).then(function(d){b(function(){d&&(a.control.save_change_btn_loading=!1,c.close(!0))},0)},function(b){a.control.save_change_btn_loading=!1,h.alert(b.message,3)})):!1:(h.alert("请选择变更类型"),!1)},a.formCancel=function(){c.dismiss(!1)},k()}]),modal_m.controller("viewSingleWorkCtrl",["$scope","$rootScope","$modalInstance","$interval","$timeout","modalParam","AutoFlowOpType","IML_TYPE","dataBaseType","CmptType","CmptFunc","Cmpt","Flow","CodeMirrorOption","JobOpType","pluginType","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u,v,w=f.flow_job_list?f.flow_job_list:[],x=f.task_id?f.task_id:"",y=f.job?f.job:{},z=y.sd_job_bean.annex_file?y.sd_job_bean.annex_file.substring(y.sd_job_bean.annex_file.lastIndexOf("/")+1):"",A=z?k.judgeFileType(z.substring(z.lastIndexOf(".")+1)):"",B=1;b.dispatch_task_status=b.dispatch_task_status?b.dispatch_task_status:0,a.task_status=f.task_status?f.task_status:0,a.viewScriptEditor=n.Sh(!0),a.viewJavaCodeEditor=n.Java(!0),a.single_work={pre_job_list:y.sd_job_bean.pre_job_list?y.sd_job_bean.pre_job_list:[],job_status:y.sd_job_bean.job_status?y.sd_job_bean.job_status:0,job_type:y.type?y.type:0,job_cn_name:y.sd_job_bean.sdwork_cn_name?y.sd_job_bean.sdwork_cn_name:"",job_id:y.sd_job_bean.job_id?y.sd_job_bean.job_id:0,input_params:y.sd_job_bean.input?y.sd_job_bean.input:[],output_params:y.sd_job_bean.output?y.sd_job_bean.output:[],error_handle:y.sd_job_bean.error_handle?y.sd_job_bean.error_handle:1,over_type:y.sd_job_bean.over_type?y.sd_job_bean.over_type:1,env_name:y.sd_job_bean.env_name?y.sd_job_bean.env_name:"",plugin_list:y.sd_job_bean.plugin_list?y.sd_job_bean.plugin_list:[],annex_file:y.sd_job_bean.annex_file?y.sd_job_bean.annex_file:"",job_err_msg:""},a.controls={basic_loading:!1,basic_err_msg:"",operate_err_msg:"",codemirror_refresh:!1,is_detail:f.is_detail,task_finish:!1,complete_job:!1,job_error:!1,polling_end:!1,op_type:1,tem_op_list:[]},a.accessory_fileupload={suffixs:"",filetype:A,filename:z,uploadpath:""},a.config={scroll_config:q.Y()};var C=function(b){B=6>b?1:6==b?4:7==b||8==b?2:14==b?3:1,(14==a.single_work.job_type||15==a.single_work.job_type)&&(B=4),a.viewScriptEditor=4==B?n.Sql(!0):3==B?n.Java(!0):2==B?n.Python(!0):n.Sh(!0)},D=function(){for(var a,b=0;b<w.length;b++){var c=w[b];if(3!=c.type&&y.sd_job_bean.job_id===c.sd_job_bean.job_id){a=b;break}}return a},E=function(){for(var b=0;b<w.length;b++){var c=w[b];if(3!=c.type)for(var e=0;e<a.single_work.pre_job_list.length;e++){var f=a.single_work.pre_job_list[e];f.job_id==c.sd_job_bean.job_id&&(f.job_status=c.sd_job_bean.job_status?c.sd_job_bean.job_status:1,f.job_type=c.sd_job_bean.job_type?c.sd_job_bean.job_type:0,f.job_cn_name=c.sd_job_bean.sdwork_cn_name?c.sd_job_bean.sdwork_cn_name:"",c.sd_job_bean.sdwork_cn_name||1!=c.type||(f.job_cn_name="开始")),f.job_status>=3&&d.cancel(u)}}},F=function(a){u&&d.cancel(u),t&&d.cancel(t),c.close(a)},G=function(){e(function(){var b=$(".col-left"),c=$(".col-right").height(),d=$(".job_errmsg");b.height(c),a.single_work.job_err_msg&&d.css({"max-height":c-120+"px"})},200)},H=function(){a.controls.basic_err_msg="",m.viewSingleJobInfo(x,a.single_work.job_id).then(function(b){e(function(){b.job_info&&(G(),0!==a.single_work.pre_job_list.length&&(E(),u=d(function(){E()},1e3)),a.single_work.input_params=b.job_info.input_list?b.job_info.input_list:[],a.single_work.output_params=b.job_info.output_list?b.job_info.output_list:[],a.single_work.job_type<=2?(a.single_work.datetime_condition=b.job_info.datetime_condition?b.job_info.datetime_condition.substring(b.job_info.datetime_condition.lastIndexOf("."),-1):"",a.single_work.datetime_condition||(a.single_work.datetime_condition=y.sd_job_bean.datetime_condition?y.sd_job_bean.datetime_condition.substring(y.sd_job_bean.datetime_condition.lastIndexOf("."),-1):"")):(a.single_work.job_method=b.job_info.job_method?b.job_info.job_method:0,a.single_work.job_bk_desc=b.job_info.job_desp,a.single_work.timeout=b.job_info.timeout,a.single_work.polling_max_times=b.job_info.polling_max_times?b.job_info.polling_max_times:y.sd_job_bean.polling_max_times,a.single_work.polling_interval=b.job_info.polling_interval?b.job_info.polling_interval:y.sd_job_bean.polling_interval,(3==a.single_work.job_status||5==a.single_work.job_status)&&(a.single_work.input_params=b.job_info.input_list?b.job_info.input_list:[],a.single_work.output_params=b.job_info.output_list?b.job_info.output_list:[]),a.single_work.expr=y.sd_job_bean.expr?y.sd_job_bean.expr:"",b.job_info.component_info&&(a.single_work.exe_cn_type=b.job_info.component_info.impl_type?s.findValue(b.job_info.component_info.impl_type,h):"",a.single_work.script_list=b.job_info.component_info.script_list?b.job_info.component_info.script_list:[],a.single_work.script_source=b.job_info.component_info.component_source?b.job_info.component_info.component_source:1,a.single_work.comp_cn_name=b.job_info.component_info.cn_name,a.single_work.cmpt_cn_type="",C(b.job_info.component_info.impl_type),b.job_info.component_info.component_purposes&&0!=b.job_info.component_info.component_purposes.length&&angular.forEach(b.job_info.component_info.component_purposes,function(b){a.single_work.cmpt_cn_type+="  "+s.findValue(b,j)}),angular.forEach(a.single_work.script_list,function(a){a.exe_script=a.cmds?k.cmdsToString(a.cmds):""})),b.job_info.sdDefineCompBean&&(a.single_work.dataBase_type_cn=b.job_info.sdDefineCompBean.dataBase_type?s.findValue(b.job_info.sdDefineCompBean.dataBase_type,i):"",a.single_work.service_name=b.job_info.sdDefineCompBean.service_name,a.single_work.script_source=b.job_info.sdDefineCompBean.script_source,a.single_work.exe_script=b.job_info.sdDefineCompBean.exec_script,a.single_work.file_name=b.job_info.sdDefineCompBean.script_file_name,a.single_work.script_cn_type=b.job_info.sdDefineCompBean.comp_impl_type?s.findValue(b.job_info.sdDefineCompBean.comp_impl_type,h):"",C(b.job_info.sdDefineCompBean.comp_impl_type)),a.single_work.job_param_list=b.job_info.source_list?b.job_info.source_list:[],0===a.single_work.input_params.length&&(a.single_work.input_params=y.sd_job_bean.input?y.sd_job_bean.input:[]),0===a.single_work.output_params.length&&(a.single_work.output_params=y.sd_job_bean.output?y.sd_job_bean.output:[]))),a.controls.basic_loading=!1},0)},function(b){a.controls.basic_loading=!1,a.controls.basic_err_msg=b.message})},I=function(){m.viewSingleJobOpInfo(x,a.single_work.job_id).then(function(b){e(function(){if(a.controls.operate_err_msg="",b.job_operate_info){if(a.single_work.job_status=b.job_operate_info.job_status?b.job_operate_info.job_status:y.sd_job_bean.job_status,a.single_work.job_err_msg=b.job_operate_info.job_err_msg?b.job_operate_info.job_err_msg:"",1==a.controls.op_type){for(var c=b.job_operate_info.job_operate_list?b.job_operate_info.job_operate_list.sort(function(a,b){return Date.parse(b.operate_time)-Date.parse(a.operate_time)}):[],e=0,f=c.length;f>e;e++){var g=c[e];g.source_list=g.source_list?g.source_list:[];for(var h=0,i=g.source_list.length;i>h;h++)for(var j=g.source_list[h],k=0,l=a.controls.tem_op_list.length;l>k;k++){var m=a.controls.tem_op_list[k];if(m.operate_time===g.operate_time&&j.exe_ip===m.exe_ip){j.show_popover=m.show_popover;break}}}a.single_work.operate_list=c,angular.forEach(a.single_work.operate_list,function(a,b,c){a.sdmeddle_type>5&&a.sdmeddle_type<9?a.operate_type=1:16==a.sdmeddle_type?a.operate_type=2:9==a.sdmeddle_type?a.operate_type=3:11==a.sdmeddle_type||12==a.sdmeddle_type?a.operate_type=4:5==a.sdmeddle_type?a.operate_type=5:a.operate_type=0,a.operate_type&&(a.operate_cn_type=s.findValue(a.operate_type,o))})}else 3==a.single_work.job_status&&(H(),t&&d.cancel(t));a.controls.polling_end=6==a.single_work.job_type&&4==a.single_work.job_status,(4==a.single_work.job_status||7==a.single_work.job_status)&&(a.controls.job_error=!0),4==a.single_work.job_type||4!=a.single_work.job_status&&5!=a.single_work.job_status&&7!=a.single_work.job_status||(a.controls.complete_job=!0),G()}else a.single_work.operate_list=[]},0)},function(b){a.controls.operate_err_msg=b.message,a.single_work.operate_list=[]})},J=function(){I(),t=d(function(){I()},2e3)},K=function(b,c){for(var d,e=0,f=0,g=a.controls.tem_op_list.length;g>f;f++){var h=a.controls.tem_op_list[f];if(h.exe_ip===b.exe_ip&&h.operate_time===c.operate_time){d=!0,e=f;break}}if(d?a.controls.tem_op_list[e].show_popover=b.show_popover:a.controls.tem_op_list.push({operate_time:c.operate_time,exe_ip:b.exe_ip,show_popover:b.show_popover}),b.show_popover)for(var i=0,j=a.controls.tem_op_list.length;j>i;i++){var k=a.controls.tem_op_list[i];k.exe_ip===b.exe_ip&&k.operate_time===c.operate_time?console.log("当前选中"):k.show_popover=!1}},L=function(){angular.forEach(a.controls.tem_op_list,function(a,b,c){a.show_popover=!1})},M=function(){J(),G(),v=D(),H(),2!=a.single_work.error_handle||4!=a.single_work.job_status&&7!=a.single_work.job_status||(a.controls.task_finish=!0),(4==a.task_status||5==a.task_status)&&(a.controls.task_finish=!0,u&&d.cancel(u),t&&d.cancel(t)),a.controls.job_error=4==a.single_work.job_status||7==a.single_work.job_status,a.controls.complete_job=(4==a.single_work.job_status||5==a.single_work.job_status||7==a.single_work.job_status)&&4!=a.single_work.job_type};a.changeTab=function(b){a.controls.op_type!==b&&(a.controls.op_type=b,1===b?(u&&d.cancel(u),(4==a.task_status||5==a.task_status)&&t&&d.cancel(t)):H(),a.controls.tem_op_list=[],G())},a.singleWorkIcon=function(a,b){var c="",d="/60px";switch(a){case 1:c="url(img/dispatch/fl/palette/start.png)";break;case 2:c="url(img/dispatch/fl/palette/end.png)";break;case 4:c="url(img/dispatch/fl/context/condition.png)";break;case 5:c="url(img/dispatch/fl/context/stop.png)";break;case 6:c="url(img/dispatch/fl/context/rep.png)";break;case 7:c="url(img/dispatch/fl/context/ftpU.png)";break;case 8:c="url(img/dispatch/fl/context/ftpD.png)";break;case 9:c="url(img/dispatch/fl/context/sftpU.png)";break;case 10:c="url(img/dispatch/fl/context/sftpD.png)";break;case 11:c="url(img/dispatch/fl/context/zngtU.png)";break;case 12:c="url(img/dispatch/fl/context/zngtD.png)";break;case 13:c="url(img/dispatch/fl/context/copy.png)";break;case 14:c="url(img/dispatch/fl/context/sql.png)";break;case 15:c="url(img/dispatch/fl/context/sqlS.png)";break;case 16:c="url(img/dispatch/fl/context/web.png)";break;case 17:c="url(img/dispatch/fl/context/sysSt.png)";break;case 18:c="url(img/dispatch/fl/context/sysE.png)";break;case 19:c="url(img/dispatch/fl/context/python.png)";break;case 20:c="url(img/dispatch/fl/context/shell.png)";break;case 21:c="url(img/dispatch/fl/context/bat.png)";break;case 22:c="url(img/dispatch/fl/context/rb.png)";break;case 23:c="url(img/dispatch/fl/context/perl.png)";break;case 24:c="url(img/dispatch/fl/context/webs.png)";break;case 25:c="url(img/dispatch/fl/context/tcp.png)";break;case 26:c="url(img/dispatch/fl/context/http.png)";break;case 27:c="url(img/dispatch/fl/context/tux.png)";break;case 28:c="url(img/dispatch/fl/context/cl.png)";break;case 29:c="url(img/dispatch/fl/context/rpg.png)";break;case 30:c="url(img/dispatch/fl/context/java.png)";break;case 31:c="url(img/dispatch/fl/context/c.png)";break;case 32:c="url(img/dispatch/fl/context/c++.png)";break;default:c="url(img/dispatch/fl/context/ftpU.png)"}return b&&(d="/90%"),{background:c+"no-repeat center"+d}},a.operateBgColor=function(a,b){var c="";switch(b){case 1:c="#1295da";break;case 2:c="#9cb85f";break;case 3:c="#999";break;case 4:c="#ed6f67";break;default:c="#fff"}return 1===a?{"background-color":c}:{color:c}},a.singleNodeBorder=function(a){var b={cursor:"default",border:"1px solid transparent"};return(4==a.run_state||7==a.run_state)&&(b.cursor="pointer"),a.show_popover&&(b.border="1px solid #4A90E2"),b},a.viewNodeErrMsg=function(b,c){var d=a.single_work.operate_list[b];if(d.source_list){var e=d.source_list[c];e.show_popover=!e.show_popover;var f=$(".popover-modal-"+b+"-"+c);if(e.show_popover){for(var g=0;g<a.single_work.operate_list.length;g++){var h=a.single_work.operate_list[g];h.source_list=h.source_list?h.source_list:[];var i=h.source_list.length;if(0!==i)for(var j=0;i>j;j++){var k=h.source_list[j];b===g&&c===j?console.log(111):(k.show_popover=!1,$(".popover-modal-"+g+"-"+j).css({display:"none"}))}}f.fadeIn(),K(e,d)}else f.fadeOut(),L()}},a.popoverPosition=function(a,b,c){if(a.show_popover){var d=$(".popover-modal-"+b+"-"+c);(c+1-3)%4===0&&d.css({left:"auto",right:0}),(c+1-2)%4===0&&d.css({width:"340px"})}},a.stopPropagation=function(a){a.stopPropagation()},a.hidePopover=function(a,b,c){e(function(){a.show_popover=!1,L(),$(".popover-modal-"+b+"-"+c).fadeOut()},800)},a.changeScript=function(){a.controls.codemirror_refresh=!1,e(function(){a.controls.codemirror_refresh=!0},100)},a.getPluginTypeCnName=function(a){return s.findValue(a,p)},a.downloadAccessoryFile=function(){s.downloadFile(a.single_work.annex_file)},a.formSubmit=function(c){if(4==b.dispatch_task_status||5==b.dispatch_task_status)return r.alert("任务已处理完成"),!1;if(b.dispatch_task_status>=0&&b.dispatch_task_status<=2||6==b.dispatch_task_status)return r.alert("任务处理中，请稍侯..."),!1;var d={meddle_type:c,job_index:v,job_id:a.single_work.job_id};1==c?r.confirm("确认重试 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){F(d)}):2==c?r.confirm("确认重做 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){F(d)}):3==c?r.confirm("确认跳过 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){F(d)}):4==c?r.confirm("确认重试作业链 ?").then(function(){F(d)}):r.confirm("确认完成 ["+a.single_work.job_cn_name+"] 作业 ?").then(function(){r.completeJob(x,[a.single_work.job_id]).then(function(a){a&&(d.meddle_reason=a,F(d))})})},a.formCancel=function(){u&&d.cancel(u),t&&d.cancel(t),c.close()},M()}]),modal_m.controller("addSkipWorkParamsCtrl",["$scope","$modalInstance","$timeout","modalParam","AutoFlowOpType","IML_TYPE","CmptType","CmptFunc","Cmpt","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.form={},a.job_output_list=d.output_param?d.output_param:[],a.paramShellLoaded=function(a){j.setParamsEditor(a)},a.formSubmit=function(){return l.valiForm(a.form.job_param_form)?void b.close(a.job_output_list):!1},a.formCancel=function(){b.close()}}]),modal_m.controller("viewTaskProgressInfoCtrl",["$scope","$modalInstance","$timeout","$interval","DispatchTaskMonitor","modalParam","Modal","CV",function(a,b,c,d,e,f,g,h){var i;a.query_type=0,a.data={task_thread_list:[],job_thread_list:[],task_queue_list:[],job_queue_list:[]};var j=function(b){e.runingInfo(b).then(function(d){c(function(){1===b?a.data.task_thread_list=d.task_thread_list?d.task_thread_list:[]:2===b?a.data.job_thread_list=d.job_thread_list?d.job_thread_list:[]:3===b?a.data.task_queue_list=d.task_queue_list?d.task_queue_list:[]:a.data.job_queue_list=d.job_queue_list?d.job_queue_list:[]},0)},function(a){})},k=function(){e.runingInfo(1).then(function(b){c(function(){a.data.task_thread_list=b.task_thread_list?b.task_thread_list:[]},0)},function(a){}),i=d(function(){j(a.query_type)},2e3)};a.selectType=function(b){a.query_type!==b&&(a.query_type=b,j(a.query_type))},a.meddleTask=function(a,b,c){g.confirm("确认回收任务线程 "+c+" ?").then(function(){e.meddleTask(a,b).then(function(a){},function(a){})})},a.meddleJob=function(a,b,c,d){g.confirm("确认回收作业线程 "+d+" ?").then(function(){e.meddleJob(a,b,[c]).then(function(a){},function(a){})})},a.formCancel=function(){i&&d.cancel(i),b.dismiss(!1)},k()}]),modal_m.controller("inputStartJobParamsCtrl",["$scope","$modalInstance","$timeout","modalParam","AutoFlowOpType","IML_TYPE","CmptType","CmptFunc","Cmpt","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.form={},a.input_param_list=d.input_param?d.input_param:[],a.paramShellLoaded=function(a){j.setParamsEditor(a)},a.formSubmit=function(){return l.valiForm(a.form.input_param_form)?void b.close(a.input_param_list):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("completeJobCtrl",["$scope","$modalInstance","$timeout","modalParam","Flow","Modal","CV",function(a,b,c,d,e,f,g){a.form={},a.reason={complete_reason:""},a.formSubmit=function(){return g.valiForm(a.form.reason_form)?void b.close(a.reason.complete_reason):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("configFlowTimeConditionCtrl",["$scope","$modalInstance","$timeout","modalParam","Flow","Modal","CV",function(a,b,c,d,e,f,g){var h=d.data?d.data:{},i=new Date,j=i.getHours()<10?"0"+i.getHours():i.getHours(),k=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes(),l=h.date_str?new Date(h.date_str)<i?i:new Date(h.date_str):i;a.form={},a.datepicker={opened:!0},a.cus_date={minDate:new Date,date:l,hh:h.h_condition?h.h_condition:j,mm:h.m_condition?h.m_condition:k},a.formSubmit=function(){return g.valiForm(a.form.setTime)?a.cus_date.hh>23?(f.alert("小时输入有误，请重新输入"),!1):a.cus_date.mm>59?(f.alert("分钟输入有误，请重新输入"),!1):(a.cus_date.hh=a.cus_date.hh.length<2?"0"+a.cus_date.hh:a.cus_date.hh,a.cus_date.mm=a.cus_date.hh.length<2?"0"+a.cus_date.mm:a.cus_date.mm,void b.close(a.cus_date)):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("configFlowJobMethodCtrl",["$scope","$modalInstance","$timeout","Cmpt","Plugin","IML_TYPE","CmptType","modalParam","CodeMirrorOption","BusiSys","dataBaseType","CmptFunc","envManage","LanguageName","pluginExeEnv","pluginType","operateSysBit","RequestMethod","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u,v=[],w=h.job_data.job_method?h.job_data.job_method:1;w=h.job_type>23&&h.job_type<28?2:w,console.log(w,"job_method"),console.log(h.job_type,"job_type");var x=h.job_data.comp_id?h.job_data.comp_id:"",y=h.job_data.annex_file?h.job_data.annex_file.substring(h.job_data.annex_file.lastIndexOf("/")+1):"",z=y?l.judgeFileType(y.substring(y.lastIndexOf(".")+1)):"",A=1;a.is_detail=!!h.is_detail,a.is_special_element=!!h.is_special_element,console.log("查看：",a.is_detail,"特殊：",a.is_special_element),a.form={},a.form_control={job_method:w,is_service:!1,is_database:!1,refresh_script:!0},a.cmpt_control={},a.accessory_fileupload={suffixs:"",filetype:z,filename:y,uploadpath:""},a.cmpt_info={cmpt_list:[],cmpt_list_loading:!1,script_loading:!1,script_list:[],get_script_err:"",checked:-1},a.job_type=h.job_type,a.basic_data={plugin_list:[],plugin_hint_list:[],env_list:[],sys_list:[],iml_type_list:f,sql_type_list:[],dataBase_type_list:k,request_method_list:r},a.sava_data={},a.cmpt_data={},a.viewOptions=i.Sh(!0),a.paramShellLoaded=function(a){i.setParamsEditor(a)};var B=function(a){a=a||{};var b={comp_id:a.comp_id?a.comp_id:"",comp_cn_name:a.comp_cn_name?a.comp_cn_name:"",impl_type:a.comp_impl_type?a.comp_impl_type:"",script_source:a.script_source?a.script_source:1,script_file_name:a.script_file_name?a.script_file_name:"",exec_script:a.exec_script?a.exec_script:"",param_list:a.input?a.input:[],output:a.output?a.output:[],dataBase_type:a.dataBase_type?a.dataBase_type:"",sql_source:a.sql_source?a.sql_source:1,service_name:a.service_name?a.service_name:"",service_ip:a.service_ip?a.service_ip:"",service_url:a.service_url?a.service_url:"",service_port:a.service_port?a.service_port:"",service_comm_info:a.service_comm_info?a.service_comm_info:{},env_name:a.env_name?a.env_name:"",language_name:a.language_name?a.language_name:"",language_version:a.language_version?a.language_version:"",operating_system:a.operating_system?a.operating_system:"",bit_number:a.bit_number?a.bit_number:"",annex_file:a.annex_file?a.annex_file:"",plugin_list:a.plugin_list?a.plugin_list:[],command:a.command?a.command:[],request_method:a.request_method?a.request_method:1};return a.command&&a.command.cmds&&(b.command.exec_script=l.cmdsToString(a.command.cmds)),b},C=function(b){a.job_type>=24&&a.job_type<=27&&(a.form_control.is_service=!0,2==a.form_control.job_method&&(b&&0!=h.job_data.input.length?(a.sava_data.param_list=h.job_data.input,a.sava_data.output=h.job_data.output):(a.sava_data.param_list=[{param_name:"request",param_cn_name:"",param_source:1,param_value:""}],a.sava_data.output=[{param_name:"response",param_cn_name:""}]))),(14==a.job_type||15==a.job_type)&&(a.form_control.is_database=!0,1==a.form_control.job_method?a.cmpt_data.output=[{param_name:"sqlresult",param_cn_name:"sql输出结果"}]:a.sava_data.output=[{param_name:"sqlresult",param_cn_name:"sql输出结果"}])},D=function(a){for(var b=a.length||0,c=0;b>c;c++){var d=a[c];"/*"==d.cn_name.substring(0,2)&&(d.cn_name=d.cn_name.substring(2,b-2)),d.execute_type_cn=t.findValue(d.impl_type,f),d.cmpt_type_cn=t.findValue(d.module_purpose,g)}},E=function(b){for(var c=-1,d=0;d<a.cmpt_info.cmpt_list.length;d++){var e=a.cmpt_info.cmpt_list[d];if(e.id===b){c=d;break}}return c},F=function(){m.getUploadPath().then(function(b){b&&(a.accessory_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(a){})},G=function(a){for(var b=[],c=0;c<a.length;c++)a[c].plugin_name&&b.push(a[c].plugin_name);return b},H=function(b){b&&e.getAllPluginList(b).then(function(b){b&&(a.basic_data.plugin_list=b.plugin_list?b.plugin_list:[])},function(a){})},I=function(){a.cmpt_info.cmpt_list_loading=!0,a.cmpt_info.error_message="",d.getPublishedCmpt(1,3).then(function(b){c(function(){b&&(a.cmpt_info.cmpt_list_loading=!1,a.cmpt_info.cmpt_list=b.comp_list?b.comp_list:[],D(a.cmpt_info.cmpt_list),a.cmpt_info.checked=E(a.cmpt_data.comp_id),a.cmpt_info.cmpt_list.length&&a.cmpt_info.checked>-1&&(a.selectCmptGetScript(a.cmpt_info.checked),c(function(){if(a.cmpt_info.checked>5){var b=document.querySelectorAll(".scrollTbody > tr");b[a.cmpt_info.checked].scrollIntoView()}},0)))},0)},function(b){a.cmpt_info.error_message=b.message})},J=function(b){A=6>b?1:6==b?4:7==b||8==b?2:14==b?3:1,(14==a.job_type||15==a.job_type)&&(A=4),a.viewOptions=4==A?i.Sql(!0):3==A?i.Java(!0):2==A?i.Python(!0):i.Sh(!0)},K=function(b){a.basic_data.env_list=[],(14==b.impl_type||7==b.impl_type||8==b.impl_type)&&(a.basic_data.env_list=["1.5","1.6","1.7","1.8"]),H(b.impl_type)},L=function(a,b){var c=b.split("-");a.language_name=t.findKey(c[0],n),a.language_version=c[1],a.operating_system=t.findKey(c[2],o),a.bit_number=t.findKey(c[3],q)},M=function(){1==w?(a.cmpt_data=B(h.job_data),a.is_special_element||a.is_detail||I(),a.is_detail||K(a.cmpt_data)):(a.sava_data=B(h.job_data),J(a.sava_data.impl_type),K(a.sava_data)),C(!0),!a.is_detail&&F()};a.shellLoaded=function(b){var d;i.setEditor(b,A),u=b,b.on("blur",function(){d=c(function(){var b=G(a.sava_data.plugin_list),c=l.getParamsByScript(a.sava_data.exec_script?a.sava_data.exec_script:"",b);if(v.length==c.list.length){if(a.sava_data.script_msg=c.msg,0==v.length)return a.sava_data.param_list=[],!1;for(var d=0;d<c.list.length;d++){for(var e=!1,f=0;f<v.length;f++)if(c.list[d].param_name==v[f].param_name&&c.list[d].param_group==v[f].param_group){e=!0;break}e||(l.blurGetParams(c,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list))}}else l.blurGetParams(c,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list)},500)})},a.commandNoneShellLoaded=function(b){var d;i.setNoneParamsEditor(b,A,a.sava_data.plugin_list),b.on("blur",function(){d=c(function(){var b=G(a.sava_data.plugin_list);a.sava_data.command.cmds=a.sava_data.command.exec_script?a.sava_data.command.exec_script.split("\n"):[];
var c=a.sava_data.command.exec_script+""+a.sava_data.exec_script,d=l.getParamsByScript(c?c:"",b);if(v.length==d.list.length){if(a.sava_data.script_msg=d.msg,0==v.length)return a.sava_data.param_list=[],!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<v.length;g++)if(d.list[e].param_name==v[g].param_name&&d.list[e].param_group==v[g].param_group){f=!0;break}f||(l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list))}}else l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list)},500)})},a.commandShellLoaded=function(b){var d;i.setUniqueParamsEditor(b,A,a.sava_data.plugin_list),b.on("blur",function(){d=c(function(){var b=G(a.sava_data.plugin_list);a.sava_data.command.cmds=a.sava_data.command.exec_script?a.sava_data.command.exec_script.split("\n"):[];var c=a.sava_data.command.exec_script+""+a.sava_data.exec_script,d=l.getParamsByScript(c?c:"",b);if(v.length==d.list.length){if(a.sava_data.script_msg=d.msg,0==v.length)return a.sava_data.param_list=[],!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<v.length;g++)if(d.list[e].param_name==v[g].param_name&&d.list[e].param_group==v[g].param_group){f=!0;break}f||(l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list))}}else l.blurGetParams(d,a.sava_data,a.cmpt_control,v),1==a.form_control.job_method&&(a.cmpt_data.param_list=a.sava_data.param_list)},500)})},a.addInputParam=function(){a.sava_data.param_list.push({param_name:"",param_cn_name:"",param_source:1,param_value:""})},a.addOutputParam=function(b){return a.sava_data.output.some(function(a){return!a.param_name})?void s.alert("当前参数表输入不完整"):void a.sava_data.output.push({param_name:"",param_cn_name:""})},a.removeOutputParam=function(b,c){1===c?a.sava_data.param_list.splice(b,1):a.sava_data.output.splice(b,1)},a.changeJobType=function(b){a.form_control.job_method!=b&&(a.form_control.job_method=b,1===b?(a.cmpt_data=1==w?B(h.job_data):B(),I()):(a.sava_data=2==w?B(h.job_data):B(),J(a.sava_data.impl_type),K(a.sava_data)),C())},a.selectCmptGetScript=function(b){a.cmpt_info.checked=b,x=a.cmpt_info.cmpt_list[b].id||"",a.cmpt_info.script_loading=!0,a.cmpt_info.get_script_err="",d.viewModulegetModuleDetail(x).then(function(b){c(function(){if(b){a.cmpt_info.script_loading=!1,a.cmpt_info.script_list=b.component.script_list?b.component.script_list:[];for(var c=0;c<a.cmpt_info.script_list.length;c++)a.cmpt_info.script_list[c].exec_script=l.cmdsToString(a.cmpt_info.script_list[c].cmds),a.cmpt_info.script_list[c].script_type_cn="default"==a.cmpt_info.script_list[c].script_type?"缺省":a.cmpt_info.script_list[c].script_type;a.cmpt_data.comp_id=b.component.id,a.cmpt_data.comp_cn_name=b.component.cn_name,a.cmpt_data.exec_script=a.cmpt_info.script_list[0].exec_script,a.cmpt_data.script_source=b.component.component_source?b.component.component_source:1,a.cmpt_data.impl_type=b.component.impl_type?b.component.impl_type:"",a.cmpt_data.language_version=b.component.language_version?b.component.language_version:"",a.cmpt_data.output=b.component.out_param_list?b.component.out_param_list:[],a.cmpt_data.param_list=b.component.param_list?b.component.param_list:[],a.cmpt_data.plugin_list=b.component.plugin_list?b.component.plugin_list:[],a.cmpt_data.annex_file=b.component.annex_file?b.component.annex_file:"";for(var d=0;d<a.cmpt_data.param_list.length;d++)a.cmpt_data.param_list[d].param_source=1;C(),J(a.cmpt_data.impl_type),K(a.cmpt_data)}},0)},function(b){a.cmpt_info.script_loading=!1,a.cmpt_info.get_script_err=b.message})},a.selectEnvName=function(b){1==a.form_control.job_method?L(a.cmpt_data,b):L(a.sava_data,b)},a.selectScriptType=function(b){K(1==a.form_control.job_method?a.cmpt_data:a.sava_data),2==a.form_control.job_method&&(a.sava_data.plugin_list=[]),a.form_control.refresh_script=!1,c(function(){J(b),a.shellLoaded(u),a.form_control.refresh_script=!0},100)},a.getPluginTypeCnName=function(a){return t.findValue(a,p)},a.addAvailablePlugin=function(b){if(0!==b.plugin_list.length){if(b.plugin_list.some(function(a){return!a.plugin_name}))return s.alert("请选择插件名"),!1;if(b.plugin_list.length===a.basic_data.plugin_list.length)return s.alert("无可再添加的插件！"),!1}b.plugin_list.push({plugin_name:"",plugin_type:"",plugin_file_name:"",plugin_bk_desc:""})},a.deleteSinglePlugin=function(b,c){var d=c.plugin_list[b].plugin_name;d?s.confirm("确认是否要删除[ "+d+" ]插件?").then(function(){c.plugin_list.splice(b,1),a.basic_data.plugin_hint_list=l.translatePluginHint(c.plugin_list),u&&i.setEditor(u,A,a.basic_data.plugin_hint_list)}):(c.plugin_list.splice(b,1),a.basic_data.plugin_hint_list=l.translatePluginHint(c.plugin_list),u&&i.setEditor(u,A,a.basic_data.plugin_hint_list))},a.bindPluginInfo=function(b,c,d,e){for(var f=0,g=0;g<e.plugin_list.length;g++)b===e.plugin_list[g].plugin_name&&f++;if(f>1)return s.alert("插件已经添加！"),e.plugin_list.splice(c,1),!1;for(var h=0;h<a.basic_data.plugin_list.length;h++){var j=a.basic_data.plugin_list[h];if(b===j.plugin_name){d.plugin_type=j.plugin_type,d.plugin_file_name=j.plugin_file_name,d.plugin_bk_desc=j.plugin_bk_desc;break}}a.basic_data.plugin_hint_list=l.translatePluginHint(e.plugin_list),u&&i.setEditor(u,A,a.basic_data.plugin_hint_list)},a.ImportAccessorySuccessThen=function(b){b.annex_file=a.accessory_fileupload.uploadpath+"/"+a.accessory_fileupload.filename;var c=a.accessory_fileupload.filename.substring(a.accessory_fileupload.filename.lastIndexOf(".")+1);a.accessory_fileupload.filetype=l.judgeFileType(c)},a.removeAccessoryFile=function(b){a.accessory_fileupload.filename="",a.accessory_fileupload.filetype="",b.annex_file=""},a.downloadAccessoryFile=function(a){t.downloadFile(a.annex_file)},a.formSubmit=function(){if(1===a.form_control.job_method){if(-1===a.cmpt_info.checked&&!a.is_special_element)return s.alert("请选择组件"),!1;if(a.cmpt_info.get_script_err)return s.alert("组件信息获取异常,请重新选择组件"),!1;a.cmpt_data.input=a.cmpt_data.param_list||[],a.cmpt_data.job_method=a.form_control.job_method,b.close(a.cmpt_data)}else{if(!t.valiForm(a.form.job_form))return!1;a.sava_data.command&&a.sava_data.command.exec_script&&(a.sava_data.command.cmds=a.sava_data.command.exec_script?a.sava_data.command.exec_script.split("\n"):[]),a.sava_data.job_method=a.form_control.job_method,b.close(a.sava_data)}},a.formCancel=function(){b.dismiss(!1)},M()}]),modal_m.controller("configRefNodeCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","CodeMirrorOption","BusiSys","dataBaseType","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=g.source_list?g.source_list:[];a.ref_node_list=g.ref_node_list?g.ref_node_list:[];var o=function(){for(var b=0;b<a.ref_node_list.length;b++){var c=a.ref_node_list[b];c.checked=!1;for(var d=0;d<n.length;d++){var e=n[d];e.exe_ip===c.exe_ip&&e.exe_soc_name===c.exe_soc_name&&(c.checked=!0)}}};a.formSubmit=function(){for(var c=[],d=0;d<a.ref_node_list.length;d++){var e=a.ref_node_list[d];e.checked&&c.push({exe_ip:e.exe_ip,exe_soc_name:e.exe_soc_name})}b.close(c)},a.formCancel=function(){b.dismiss(!1)},o()}]),modal_m.controller("addSceneCtrl",["$scope","$modalInstance","$timeout","Scene","modalParam","ElementCategory","Modal","CV",function(a,b,c,d,e,f,g,h){a.form={},a.btn_loading=!1,a.scene_info={scene_list:[],checked_scene_list:e.scene_list?e.scene_list:[],scene_id_list:[]},a.control={scene_loading:!0,error_message:""};var i=function(a){return a?h.findValue(a,f):"--"},j=function(){var b=[];return angular.forEach(a.scene_info.scene_list,function(a,c,d){a.checked&&!a.is_ref&&b.push(a.scene_id)}),b};d.getSceneListByType({key_word:"",data:{offset:0}}).then(function(b){c(function(){a.control.scene_loading=!1,a.scene_info.scene_list=b.scene_list?b.scene_list.filter(function(a){return 3!==a.scene_type}):[];for(var c=0;c<a.scene_info.checked_scene_list.length;c++)for(var d=a.scene_info.checked_scene_list[c],e=0;e<a.scene_info.scene_list.length;e++){var f=a.scene_info.scene_list[e];d.scene_id===f.scene_id&&(f.checked=!0,f.is_ref=!0)}},0)},function(b){a.control.scene_loading=!1,a.control.error_message=b.message}),a.formSubmit=function(){return a.scene_info.scene_id_list=j(),0===a.scene_info.scene_id_list.length?(b.close(),!1):(a.btn_loading=!0,void d.getMultipleSceneElementDetail(a.scene_info.scene_id_list).then(function(d){c(function(){a.btn_loading=!1;var c=d.scene_list?d.scene_list:[];if(0===c.length)return g.alert("获取场景元素数据为空"),!1;for(var e=[],f=0;f<c.length;f++){var h=c[f];h.category_list=h.category_list?h.category_list:[];for(var j=0;j<h.category_list.length;j++){var k=h.category_list[j];k.element_list=k.element_list?k.element_list:[],k.category_cn=k.text?k.text:i(k.category);for(var l=0;l<k.element_list.length;l++){var m=k.element_list[l];m.category="7",m.sd_job_bean=m.element_info?m.element_info:{},m.sd_job_bean.is_special_element=!0,m.text=m.sd_job_bean.sdwork_cn_name?m.sd_job_bean.sdwork_cn_name:m.text}}e.push({scene_id:h.scene_id?h.scene_id:"",scene_name:h.scene_name?h.scene_name:"",category_list:h.category_list})}b.close(e)},0)},function(b){a.btn_loading=!1,g.alert(b.message,3)}))},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("addPrivateElementCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","ElementCategory","Scene","FlowCategoryData","CmptFunc","dataBaseType","JobErrorType","ParamValueSource","FlowJobType","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=j,t=g.element?angular.copy(g.element):{};a.btn_loading=!1,a.form={},a.single_element={category:"7",type:t.type,text:"",element_info:t.element_info},a.data={execute_type_list:e,database_type_list:l,error_handle_list:m,param_source_list:n},a.config={scroll_bar:p};var u=function(a){if(!a)return 0;for(var b,c=0;c<s.length;c++){for(var d=s[c],e=0;e<d.element_list.length;e++){var f=d.element_list[e];if(f.type===a){b={category:d.category,type_cn:f.text};break}}if(b)break}return b};a.elementIcon=function(){var a="",b="/50px";switch(t.type){case 1:a="url(img/dispatch/fl/palette/start.png)";break;case 2:a="url(img/dispatch/fl/palette/end.png)";break;case 4:a="url(img/dispatch/fl/context/condition.png)";break;case 5:a="url(img/dispatch/fl/context/stop.png)";break;case 6:a="url(img/dispatch/fl/context/rep.png)";break;case 7:a="url(img/dispatch/fl/context/ftpU.png)";break;case 8:a="url(img/dispatch/fl/context/ftpD.png)";break;case 9:a="url(img/dispatch/fl/context/sftpU.png)";break;case 10:a="url(img/dispatch/fl/context/sftpD.png)";break;case 11:a="url(img/dispatch/fl/context/zngtU.png)";break;case 12:a="url(img/dispatch/fl/context/zngtD.png)";break;case 13:a="url(img/dispatch/fl/context/copy.png)";break;case 14:a="url(img/dispatch/fl/context/sql.png)";break;case 15:a="url(img/dispatch/fl/context/sqlS.png)";break;case 16:a="url(img/dispatch/fl/context/web.png)";break;case 17:a="url(img/dispatch/fl/context/sysSt.png)";break;case 18:a="url(img/dispatch/fl/context/sysE.png)";break;case 19:a="url(img/dispatch/fl/context/python.png)";break;case 20:a="url(img/dispatch/fl/context/shell.png)";break;case 21:a="url(img/dispatch/fl/context/bat.png)";break;case 22:a="url(img/dispatch/fl/context/rb.png)";break;case 23:a="url(img/dispatch/fl/context/perl.png)";break;case 24:a="url(img/dispatch/fl/context/webs.png)";break;case 25:a="url(img/dispatch/fl/context/tcp.png)";break;case 26:a="url(img/dispatch/fl/context/http.png)";break;case 27:a="url(img/dispatch/fl/context/tux.png)";break;case 28:a="url(img/dispatch/fl/context/cl.png)";break;case 29:a="url(img/dispatch/fl/context/rpg.png)";break;case 30:a="url(img/dispatch/fl/context/java.png)";break;case 31:a="url(img/dispatch/fl/context/c.png)";break;case 32:a="url(img/dispatch/fl/context/c++.png)";break;default:a="url(img/dispatch/fl/context/ftpU.png)"}return{background:a+"no-repeat center"+b}},a.eleTypeTOCn=function(){return t.type?r.findValue(t.type,o):"--"},a.selectErrorHandle=function(b){3===b&&(a.single_element.element_info.retry_times=3,a.single_element.element_info.retry_interval=4)},a.setJobMethod=function(){q.setFlowJobMethod(a.single_element.type,a.single_element.element_info).then(function(b){if(a.single_element.element_info.job_method=b.job_method,1==b.job_method)a.single_element.element_info.comp_id=b.comp_id,a.single_element.element_info.comp_impl_type=b.impl_type,a.single_element.element_info.comp_cn_name=b.comp_cn_name,a.single_element.element_info.input=b.input||[],a.single_element.element_info.output=b.output||[],a.single_element.element_info.exec_script=b.exec_script,a.single_element.element_info.script_source=b.script_source;else{a.single_element.element_info.comp_id="",a.single_element.element_info.comp_impl_type=b.impl_type,a.single_element.element_info.output=b.output?b.output:[],a.single_element.element_info.input=b.param_list,a.single_element.element_info.exec_script=b.exec_script,a.single_element.element_info.business_sys_name=b.business_sys_name,a.single_element.element_info.script_source=b.script_source,a.single_element.element_info.sql_source=b.sql_source,a.single_element.element_info.script_file_name=b.script_file_name,a.single_element.element_info.dataBase_type=b.dataBase_type,a.single_element.element_info.service_name=b.service_name;for(var c=0;c<a.single_element.element_info.input.length;c++)a.single_element.element_info.input[c].param_source=1}})},a.formSubmit=function(){return r.valiForm(a.form.private_ele_form)?a.single_element.element_info.job_method?1!==a.single_element.element_info.job_method||a.single_element.element_info.comp_cn_name?(a.btn_loading=!0,a.single_element.text=a.single_element.element_info.sdwork_cn_name||u(t.type).type_cn,void i.addPrivateScene(a.single_element).then(function(c){a.single_element.sd_job_bean=a.single_element.element_info,a.single_element.sd_job_bean.is_special_element=!0,a.btn_loading=!1,b.close(a.single_element)},function(b){a.btn_loading=!1,q.alert(b.message,3)})):(q.alert("请重配内容类型"),!1):(q.alert("请设置内容类型"),!1):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("addSceneElementCtrl",["$scope","$modalInstance","$timeout","Cmpt","IML_TYPE","CmptType","modalParam","ElementCategory","Scene","FlowCategoryData","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j;a.is_update=g.is_update?g.is_update:!1,a.btn_loading=!1,a.form={},a.element_info={category:"",element_list:[]},a.data={element_category_list:h,element_data:n,category_ele:[]},a.elementIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette/rep.png)";break;case 7:b="url(img/dispatch/fl/palette/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette/copy.png)";break;case 14:b="url(img/dispatch/fl/palette/sql.png)";break;case 15:b="url(img/dispatch/fl/palette/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette/net.png)";break;case 17:b="url(img/dispatch/fl/palette/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette/python.png)";break;case 20:b="url(img/dispatch/fl/palette/shell.png)";break;case 21:b="url(img/dispatch/fl/palette/bat.png)";break;case 22:b="url(img/dispatch/fl/palette/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette/perl.png)";break;case 24:b="url(img/dispatch/fl/palette/web.png)";break;case 25:b="url(img/dispatch/fl/palette/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette/http.png)";break;case 27:b="url(img/dispatch/fl/palette/tux.png)";break;case 28:b="url(img/dispatch/fl/palette/cl.png)";break;case 29:b="url(img/dispatch/fl/palette/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette/java.png)";break;case 31:b="url(img/dispatch/fl/palette/c.png)";break;case 32:b="url(img/dispatch/fl/palette/c++.png)";break;default:b="url(img/dispatch/fl/palette/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.selectCategory=function(b){a.data.category_ele=[],a.element_info.category=b,a.data.element_data=angular.copy(n),a.data.category_ele=a.data.element_data.filter(function(a){return a.category===b})},a.selectElement=function(b,c){b.checked=!b.checked;for(var d=0;d<a.data.category_ele.length;d++){var e=a.data.category_ele[d];if(e.category===c)for(var f=0;f<e.element_list.length;f++){var g=e.element_list[f];g.type===b.type&&(g.checked=b.checked)}}},a.formSubmit=function(){if(!m.valiForm(a.form.element_form))return!1;if(!a.data.category_ele.length)return l.alert("元素不可为空"),!1;a.element_info.element_list=[];for(var c=0;c<a.data.category_ele[0].element_list.length;c++){var d=a.data.category_ele[0].element_list[c];d.checked&&a.element_info.element_list.push(d)}return 0===a.element_info.element_list.length?(l.alert("请选择元素"),!1):void b.close(a.element_info)},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("newStrategyGroupCtrl",["$scope","$modalInstance","$timeout","Cmpt","StrategyPriority","StrategyGroupType","modalParam","CodeMirrorOption","Strategy","dataBaseType","CmptFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.btn_loading=!1,a.form={},a.strategy_info={sdstrategy_id:"",sdstrategy_name:"",sdstrategy_desc:"",sdstrategy_concurrent:2,sdstrategy_type:1},a.data={strategy_type_list:f},a.formSubmit=function(){return m.valiForm(a.form.strategy_form)?(a.btn_loading=!0,void i.addStrategyGroup(a.strategy_info,a.is_update).then(function(d){c(function(){d&&(a.btn_loading=!1,b.close(!0))},0)},function(b){a.btn_loading=!1,l.alert(b.message,3)})):!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("RepeatFlowCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Modal","CV",function(a,b,c,d,e,f,g){a.flow_id=d.flow_id,a.form={},a.flow_info={flow_cn_name:""},a.formSubmit=function(){return g.valiForm(a.form.flow)?void b.close():!1},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("FlowPubReasonCtrl",["$scope","$modalInstance","$timeout","modalParam","Collection","Modal","CV",function(a,b,c,d,e,f,g){a.data={pub_reason:""},a.formSubmit=function(){b.close(a.data.pub_reason)},a.formCancel=function(){b.dismiss(!1)}}]),modal_m.controller("ywtaskChooseNodeCtrl",["$scope","$modalInstance","$timeout","modalParam","Flow","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h){a.node_info={node_ip:"",selected_node:d.node_list?d.node_list:[]},a.node_control={loading:!1},a.data={node_list:[]},a.config={scroll_bar:f};var i=function(){a.node_control.loading=!0,e.getAllNodesInfo().then(function(b){c(function(){if(b){for(var c=b.nodes_list?b.nodes_list:[],d=0,e=c.length;e>d;d++){var f=c[d];f.state=!1;for(var g=0;g<a.node_info.selected_node.length;g++){var h=a.node_info.selected_node[g];f.node_ip==h.node_ip&&(f.state=!0)}}a.data.node_list=c,a.node_control.loading=!1}},1e3)},function(b){a.node_control.loading=!1,g.alert(b.message,3)})};a.clearSearchInfo=function(){a.node_info.node_ip=""},a.selectNode=function(a){a.state=!a.state},a.saveNodeList=function(){for(var c=[],d=0;d<a.data.node_list.length;d++){var e=a.data.node_list[d];e.state&&c.push({node_ip:e.node_ip,node_detail:e.node_detail?e.node_detail:"暂无",state:!1})}b.close(c)},a.cancel=function(){b.dismiss(!1)},i()}]),modal_m.controller("configFlowTimeCtrl",["$scope","$modalInstance","modalParam","Flow","Modal","CV",function(a,b,c,d,e,f){a.dateObj={cycles:c.data.cycle_info.cycles?c.data.cycle_info.cycles:[],time_unit:c.data.cycle_info.time_unit?c.data.cycle_info.time_unit:0,period_list_str:c.data.period_list_str?c.data.period_list_str:[],start_bk_datetime:c.data.start_bk_datetime_val?c.data.start_bk_datetime_val:f.dtFormat(new Date),end_bk_datetime:c.data.end_bk_datetime_val?c.data.end_bk_datetime_val:"",cycle_type:c.data.cycle_info.cycle_type?c.data.cycle_info.cycle_type:1,flag:""==c.data.start_bk_datetime_val?1:0,view_flag:c.data.view_flag?c.data.view_flag:1,minDate:new Date,errorM:""},a.datepicker={},a.cus_date={date:"",minDate:new Date},a.control={startTimeFlag:!1,viewtime_error:""};var g=function(){3==a.dateObj.cycle_type&&0==a.dateObj.cycles.length&&(a.dateObj.cycles[0]=c.data.cycle_info.loop_time);for(var b=0;b<a.dateObj.cycles.length;b++)a.dateObj.cycles[b].dd=parseInt(a.dateObj.cycles[b].dd),a.dateObj.cycles[b].hh=parseInt(a.dateObj.cycles[b].hh),a.dateObj.cycles[b].mm=parseInt(a.dateObj.cycles[b].mm),a.dateObj.cycles[b].mi=parseInt(a.dateObj.cycles[b].mi),a.dateObj.cycles[b].ww=parseInt(a.dateObj.cycles[b].ww);2==a.dateObj.view_flag&&a.getCirclePeriod()};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.datepicker.opened=!0},a.toggleMin=function(){a.cus_date.minDate=""!=a.dateObj.start_bk_datetime?new Date(a.dateObj.start_bk_datetime):new Date},a.$watch("cus_date.date",function(){if(1==a.dateObj.view_flag){if(""==a.dateObj.start_bk_datetime)return a.control.startTimeFlag=!0,!1;if(""!=a.cus_date.date&&a.cus_date.date){var b=a.cus_date.date.getFullYear()+"年"+(a.cus_date.date.getMonth()+1)+"月"+a.cus_date.date.getDate()+"日",c=f.dtFormat(a.cus_date.date);a.dateObj.cycles.push({ww:0,dd:0,mm:0,hh:0,mi:0,customize_times:"",date:c,date_str:b})}}},!0),a.removeAutoTime=function(b){a.dateObj.cycles.splice(b,1),a.dateObj.errorM&&$(".ss").remove(),3==a.dateObj.cycle_type&&(a.dateObj.period_list_str=[])},a.changeOpexeType=function(b){a.dateObj.cycle_type=b,a.dateObj.cycles=[],a.dateObj.period_list_str=[],a.dateObj.time_unit=0,a.dateObj.errorM&&$(".ss").remove()},a.addCirlTime=function(){if(!a.dateObj.errorM){var b=0,c=0;3==a.dateObj.cycle_type&&(b=1,c=1),a.dateObj.cycles.push({unit:a.dateObj.time_unit,ww:1,dd:1,mm:1,hh:b,mi:c})}},a.changeTimeUnitType=function(b){var c=0,d=0;a.dateObj.cycles=[],a.dateObj.time_unit=b,a.dateObj.period_list_str&&(a.dateObj.period_list_str=[]),$(".ss").text()&&$(".ss").remove(),3==a.dateObj.cycle_type&&(c=1,d=1),a.dateObj.cycles.push({unit:a.dateObj.time_unit,ww:1,dd:1,mm:1,hh:c,mi:d})},a.getCirclePeriod=function(){if(a.dateObj.period_list_str=[],1!=a.dateObj.cycle_type&&!a.dateObj.errorM){if(0==a.dateObj.cycles.length&&2!=a.dateObj.view_flag)return 2==a.dateObj.cycle_type?(e.alert("周期列表不可为空"),!1):(e.alert("循环列表不可为空"),!1);var b={start_bk_datetime:f.dtFormat(a.dateObj.start_bk_datetime),end_bk_datetime:f.dtFormat(a.dateObj.end_bk_datetime),cycle_info:{cycleTimeBeen:3==a.dateObj.cycle_type?[]:a.dateObj.cycles,cycle_type:a.dateObj.cycle_type,loop_time:3==a.dateObj.cycle_type?a.dateObj.cycles[0]:{}}};d.caculatorExeTime(b).then(function(b){a.dateObj.period_list_str=b.next_time_list?b.next_time_list:[],1==a.dateObj.view_flag&&0==a.dateObj.period_list_str.length&&e.alert("暂无下次执行时间")},function(b){2==a.dateObj.view_flag?a.control.viewtime_error=b.message:e.alert(b.message,3)})}},a.$watch("dateObj",function(){a.dateObj.start_bk_datetime?(a.toggleMin(),a.control.startTimeFlag=!1):a.control.startTimeFlag=!0},!0),a.ok=function(){if(!a.control.startTimeFlag&&!a.dateObj.errorM){if(0==a.dateObj.cycles.length){var c=1==a.dateObj.cycle_type?"自定义时间":2==a.dateObj.cycle_type?"周期":"循环";return e.alert(c+"列表不可为空"),!1}return a.dateObj.start_bk_datetime&&a.dateObj.end_bk_datetime&&a.dateObj.start_bk_datetime>a.dateObj.end_bk_datetime?(e.alert("开始时间不可大于结束时间！"),!1):void b.close(a.dateObj)}},a.close=function(){b.dismiss(!1)},g()}]),modal_m.controller("JsonListCtrl",["$scope","$modalInstance","$state","Workorder","modalParam","Modal","CV",function(a,b,c,d,e,f,g){var h=e.task_seq;a.interface_info=e.data,a.control={aprov_type:e.aprov_type},console.log(a.interface_info);var i=function(){3==a.control.aprov_type&&(a.control.url=e.url,"execute_program_step"==a.control.url&&d.getApprovalExecuteProgramStep(h).then(function(a){console.log(a)},function(a){f.alert(a.message,3)}))};a.downloadAccessoryFile=function(a){g.downloadFile(a)},a.close=function(){b.close(!0)},i()}]),modal_m.controller("configDataSourceCtrl",["$scope","$modalInstance","$timeout","modalParam","Modal","NodeReform","BusiSys","Collection","OperateSys","BsysFunc","Cmpt","ScriptExec","ProtocolType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=d.business_sys_name;a.normal_ip_list=[],a.extra_ip_list=[],a.source_list=[];var p=d.srv_soc;a.reqData={imply_type:d.dataSource_type,tow_soc_loading:!1,business_sys_name:o,two_soc:!1,check_ip:"",search_ver_key:"",protocol_type:"",script_ip_list:[],normal_ip_list:[],extra_ip_list:[],ip_data_list:[],mid_ip_list:[],search_key_work:"",search_key:"",old_srv_soc:[],srv_soc:[],sc_search_key:"",flag:d.flag,script_kind:"",script_type:d.business_sys_name,ip_data_loading:!1},a.control={no_select_node:!1},a.selectOne=function(){c(function(){a.scLocationIp()},10)},a.scroll_config_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:500,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}},a.scroll_config_out_info={axis:"y",theme:"custom-dark",scrollbarPosition:"outside",scrollInertia:500,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}};var q=function(){if(1==a.reqData.flag){f.getIpByNone().then(function(b){a.reqData.ip_data_list=b.ip_list?b.ip_list:[];for(var c=0;c<a.reqData.ip_data_list.length;c++)a.reqData.ip_data_list[c]=a.reqData.ip_data_list[c].trim()},function(a){});for(var b=0;b<p.length;b++){a.reqData.normal_ip_list.push({soc_ip:p[b].soc_ip,is_show:!0,soc_name:p[b].soc_name,soc_name_list:[],ftp_soc_name_list:[],is_loading:!1,is_ftp_loading:!1,is_exsit_ftp:!1});for(var c=0;c<p[b].soc_name_list.length;c++)p[b].soc_name_list[c].soc_name==p[b].soc_name?a.reqData.normal_ip_list[b].soc_name_list.push({state:!0,soc_name:p[b].soc_name_list[c].soc_name,protocol_type:p[b].soc_name_list[c].protocol_type}):a.reqData.normal_ip_list[b].soc_name_list.push({state:!1,soc_name:p[b].soc_name_list[c].soc_name,protocol_type:p[b].soc_name_list[c].protocol_type});if(p[b].ftp_soc_name_list&&0!=p[b].ftp_soc_name_list.length){a.reqData.normal_ip_list[b].is_exsit_ftp=!0;for(var d=0;d<p[b].ftp_soc_name_list.length;d++)p[b].ftp_soc_name_list[d].soc_name==p[b].ftp_soc_name?a.reqData.normal_ip_list[b].ftp_soc_name_list.push({state:!0,soc_name:p[b].ftp_soc_name_list[d].soc_name,protocol_type:p[b].ftp_soc_name_list[d].protocol_type}):a.reqData.normal_ip_list[b].ftp_soc_name_list.push({state:!1,soc_name:p[b].ftp_soc_name_list[d].soc_name,protocol_type:p[b].ftp_soc_name_list[d].protocol_type})}}}else(a.reqData.imply_type>2&&a.reqData.imply_type<6||14==a.reqData.imply_type||15==a.reqData.imply_type||17==a.reqData.imply_type)&&(a.reqData.two_soc=!0),""==o?f.getIpByNone().then(function(b){for(var c=b.ip_list?b.ip_list:[],d=0;d<c.length;d++)c[d]=c[d].trim();for(var d=0;d<c.length;d++){var e=c[d];a.reqData.ip_data_list.push(e)}if(a.reqData.two_soc){for(var d=0;d<p.length;d++){for(var f=0;f<p[d].ver_soc_list.length;f++)p[d].ver_soc_list[f].ver_soc_name=p[d].ver_soc_list[f].soc_name,p[d].ver_soc_name==p[d].ver_soc_list[f].soc_name?p[d].ver_soc_list[f].state=!0:p[d].ver_soc_list[f].state=!1;for(var f=0;f<p[d].exe_soc_list.length;f++)p[d].exe_soc_list[f].exe_soc_name=p[d].exe_soc_list[f].soc_name,p[d].exe_soc_name==p[d].exe_soc_list[f].soc_name?p[d].exe_soc_list[f].state=!0:p[d].exe_soc_list[f].state=!1}for(var d=0;d<p.length;d++){for(var g=[],f=0;f<a.reqData.ip_data_list.length;f++)a.reqData.ip_data_list[f]==p[d].ver_ip&&g.push({ver_ip:a.reqData.ip_data_list[f],is_check:!0,ver_soc_list:p[d].ver_soc_list});a.reqData.extra_ip_list.push({exe_ip:p[d].exe_ip,exe_soc_list:p[d].exe_soc_list,is_show:!1,delete_flag:!1,exe_soc_name:p[d].exe_soc_name,ver_ip_list:g,ver_ip:p[d].ver_ip})}}else for(var d=0;d<p.length;d++){a.reqData.normal_ip_list.push({exe_ip:p[d].exe_ip,is_show:!0,exe_soc_name:p[d].soc_name,exe_soc_list:[],ftp_soc_name_list:[],is_loading:!1,is_ftp_loading:!1,is_exsit_ftp:!1});for(var h=0;h<p[d].exe_soc_list.length;h++)p[d].exe_soc_list[h].soc_name==p[d].exe_soc_name?a.reqData.normal_ip_list[d].exe_soc_list.push({state:!0,exe_soc_name:p[d].exe_soc_list[h].soc_name,protocol_type:p[d].exe_soc_list[h].protocol_type}):a.reqData.normal_ip_list[d].exe_soc_list.push({state:!1,exe_soc_name:p[d].exe_soc_list[h].soc_name,protocol_type:p[d].exe_soc_list[h].protocol_type})}},function(a){e.alert(a.message,3)}):f.getIpWithProtocolAndSoc(o,a.reqData.imply_type).then(function(b){for(var c=b.node_list?b.node_list:[],d=0;d<c.length;d++){var e=c[d];a.reqData.ip_data_list.push(e.node_ip),a.reqData.two_soc||a.reqData.normal_ip_list.push({exe_ip:e.node_ip,exe_soc_list:[],is_show:!1,exe_soc_name:""})}for(var f=0;f<p.length;f++){if(!p[f].exe_soc_list){p[f].exe_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].exe_ip&&(p[f].exe_soc_list=c[g].exe_soc_list)}if(!p[f].ver_soc_list){p[f].ver_soc_list=[];for(var g=0;g<c.length;g++)c[g].node_ip==p[f].ver_ip&&(p[f].ver_soc_list=c[g].ver_soc_list)}}if(a.reqData.two_soc){for(var d=0;d<p.length;d++){for(var h=0;h<p[d].ver_soc_list.length;h++)p[d].ver_soc_list[h].ver_soc_name=p[d].ver_soc_list[h].soc_name,p[d].ver_soc_name==p[d].ver_soc_list[h].soc_name?p[d].ver_soc_list[h].state=!0:p[d].ver_soc_list[h].state=!1;for(var h=0;h<p[d].exe_soc_list.length;h++)p[d].exe_soc_list[h].exe_soc_name=p[d].exe_soc_list[h].soc_name,p[d].exe_soc_name==p[d].exe_soc_list[h].soc_name?p[d].exe_soc_list[h].state=!0:p[d].exe_soc_list[h].state=!1}for(var d=0;d<p.length;d++){for(var i=[],h=0;h<a.reqData.ip_data_list.length;h++)a.reqData.ip_data_list[h]==p[d].ver_ip?i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!0,ver_soc_list:p[d].ver_soc_list}):i.push({ver_ip:a.reqData.ip_data_list[h],is_check:!1,ver_soc_list:[]});a.reqData.extra_ip_list.push({exe_ip:p[d].exe_ip,exe_soc_list:p[d].exe_soc_list,is_show:!1,delete_flag:!1,exe_soc_name:p[d].exe_soc_name,ver_ip_list:i,ver_ip:p[d].ver_ip})}}else for(var d=0;d<p.length;d++)for(var h=0;h<a.reqData.normal_ip_list.length;h++)if(p[d].exe_ip==a.reqData.normal_ip_list[h].exe_ip){a.reqData.normal_ip_list[h].is_show=!0,a.reqData.normal_ip_list[h].exe_soc_list=[],a.reqData.normal_ip_list[h].exe_soc_name=p[d].exe_soc_name;for(var j=0;j<p[d].exe_soc_list.length;j++)p[d].exe_soc_list[j].soc_name==p[d].exe_soc_name?a.reqData.normal_ip_list[h].exe_soc_list.push({state:!0,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type}):a.reqData.normal_ip_list[h].exe_soc_list.push({state:!1,exe_soc_name:p[d].exe_soc_list[j].soc_name,protocol_type:p[d].exe_soc_list[j].protocol_type})}a.reqData.ip_data_loading=!0},function(b){a.reqData.ip_data_loading=!0,e.alert(b.message,3)})};a.scLocationIp=function(){for(var b=!1,c=0;c<a.reqData.normal_ip_list.length;c++)a.reqData.normal_ip_list[c].soc_ip==a.reqData.sc_search_key&&(b=!0);if(b)a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].is_loading=!1,a.reqData.sc_search_key="";else{var d=angular.copy(a.reqData.sc_search_key);a.reqData.normal_ip_list.push({soc_ip:a.reqData.sc_search_key,is_show:!0,soc_name:"",soc_name_list:[],ftp_soc_name_list:[],is_loading:!0,is_ftp_loading:!1,is_exsit_ftp:!1}),l.getSocByNodeIp(a.reqData.sc_search_key,a.reqData.imply_type).then(function(b){for(var c=b.source_list?b.source_list:[],e=0;e<c.length;e++)c[e].state=!1;for(var e=0;e<a.reqData.normal_ip_list.length;e++)d==a.reqData.normal_ip_list[e].soc_ip&&(a.reqData.normal_ip_list[e].is_loading=!1,a.reqData.normal_ip_list[e].soc_name_list=c)},function(a){e.alert(a.message,3)})}},a.clickScSource=function(b,c,d,e){for(var f=!1,g=0;g<a.reqData.normal_ip_list[e].soc_name_list.length;g++)a.reqData.normal_ip_list[e].soc_name_list[g].soc_name==b.soc_name?(a.reqData.normal_ip_list[e].soc_name_list[g].state=!a.reqData.normal_ip_list[e].soc_name_list[g].state,f=a.reqData.normal_ip_list[e].soc_name_list[g].state):a.reqData.normal_ip_list[e].soc_name_list[g].state=!1;
c.is_exsit_ftp=!1,c.ftp_soc_name_list=[],f&&2==a.reqData.script_type&&(c.is_exsit_ftp=!0,c.is_ftp_loading=!0,l.getSocByNodeIp(c.soc_ip,1).then(function(a){for(var b=a.source_list?a.source_list:[],d=0;d<b.length;d++)b[d].state=!1;c.ftp_soc_name_list=b,c.is_ftp_loading=!1},function(a){c.is_ftp_loading=!1}))},a.clickScFtpSource=function(b,c,d,e){for(var f=0;f<a.reqData.normal_ip_list[e].ftp_soc_name_list.length;f++)a.reqData.normal_ip_list[e].ftp_soc_name_list[f].soc_name==b.soc_name?a.reqData.normal_ip_list[e].ftp_soc_name_list[f].state=!a.reqData.normal_ip_list[e].ftp_soc_name_list[f].state:a.reqData.normal_ip_list[e].ftp_soc_name_list[f].state=!1},a.locationIp=function(){if(a.reqData.mid_ip_list=[],""==a.reqData.search_key)for(var b=0;b<a.reqData.ip_data_list.length;b++)a.reqData.mid_ip_list.push(a.reqData.ip_data_list[b]);else for(var b=0;b<a.reqData.ip_data_list.length;b++){var c=a.reqData.ip_data_list[b].indexOf(a.reqData.search_key);-1!=c&&a.reqData.mid_ip_list.push(a.reqData.ip_data_list[b])}for(var b=0;b<a.reqData.mid_ip_list.length;b++){for(var d=a.reqData.mid_ip_list[b],c=!1,e=0;e<a.reqData.normal_ip_list.length;e++)d==a.reqData.normal_ip_list[e].exe_ip&&(c=!0);c||a.reqData.normal_ip_list.push({exe_ip:d,exe_soc_list:[],is_show:!1,exe_soc_name:""})}for(var b=a.reqData.normal_ip_list.length-1;b>=0;b--)if(!a.reqData.normal_ip_list[b].is_show){for(var c=!1,e=0;e<a.reqData.mid_ip_list.length;e++)a.reqData.mid_ip_list[e]==a.reqData.normal_ip_list[b].exe_ip&&(c=!0);c||a.reqData.normal_ip_list.splice(b,1)}},a.clearIp=function(){a.reqData.search_key=""},a.clearVerIp=function(){a.reqData.search_ver_key=""},a.locationVerword=function(){for(var b=0,c=0;c<a.reqData.extra_ip_list.length;c++)if(a.reqData.extra_ip_list[c].exe_ip==a.reqData.check_ip){b=c;break}if(a.reqData.mid_ip_list=[],""==a.reqData.search_ver_key)for(var c=0;c<a.reqData.ip_data_list.length;c++)a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c]);else for(var c=0;c<a.reqData.ip_data_list.length;c++){var d=a.reqData.ip_data_list[c].indexOf(a.reqData.search_ver_key);-1!=d&&a.reqData.mid_ip_list.push(a.reqData.ip_data_list[c])}for(var c=0;c<a.reqData.mid_ip_list.length;c++){for(var e=a.reqData.mid_ip_list[c],d=!1,f=0;f<a.reqData.extra_ip_list[b].ver_ip_list.length;f++)e==a.reqData.extra_ip_list[b].ver_ip_list[f].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.push({ver_ip:e,ver_soc_list:[],is_check:!1})}for(var c=a.reqData.extra_ip_list[b].ver_ip_list.length-1;c>=0;c--)if(!a.reqData.extra_ip_list[b].ver_ip_list[c].is_check){for(var d=!1,f=0;f<a.reqData.mid_ip_list.length;f++)a.reqData.mid_ip_list[f]==a.reqData.extra_ip_list[b].ver_ip_list[c].ver_ip&&(d=!0);d||a.reqData.extra_ip_list[b].ver_ip_list.splice(c,1)}},a.checkNodeIPNobusiness=function(){for(var b=!1,c=0;c<a.reqData.normal_ip_list.length;c++)a.reqData.normal_ip_list[c].exe_ip==a.reqData.search_key&&(b=!0);if(b)a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].is_loading=!1,a.reqData.search_key="";else{var d=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;a.reqData.normal_ip_list.push({exe_ip:a.reqData.search_key,is_show:!0,soc_name:"",exe_soc_list:[],ftp_soc_name_list:[],is_loading:!0,is_ftp_loading:!1,is_exsit_ftp:!1}),k.getAllSocList(a.reqData.search_key,d).then(function(b){for(var c=b.source_list?b.source_list:[],d=[],e=0;e<c.length;e++)c[e].state=!1,d.push({state:!1,exe_soc_name:c[e].soc_name,protocol_type:c[e].protocol_type});a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].is_loading=!1,a.reqData.normal_ip_list[a.reqData.normal_ip_list.length-1].exe_soc_list=d},function(a){e.alert(a.message,3)})}},a.testCh=function(b){c(function(){if(0==a.reqData.normal_ip_list[b].exe_soc_list.length){a.reqData.normal_ip_list[b].is_loading=!0;var c=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;g.getSocListByIpAndBsys(o,a.reqData.normal_ip_list[b].exe_ip,c).then(function(c){for(var d=c.source_list?c.source_list:[],e=0;e<d.length;e++)new RegExp("agent").test(d[e])?(a.reqData.normal_ip_list[b].exe_soc_name=d[e],a.reqData.normal_ip_list[b].exe_soc_list.push({exe_soc_name:d[e].soc_name,state:!0,protocol_type:d[e].protocol_type})):a.reqData.normal_ip_list[b].exe_soc_list.push({exe_soc_name:d[e].soc_name,state:!1,protocol_type:d[e].protocol_type});a.reqData.normal_ip_list[b].is_loading=!1},function(c){a.reqData.normal_ip_list[b].is_loading=!1,e.alert(c.message,3)})}a.reqData.normal_ip_list[b].is_show||r(a.reqData.normal_ip_list[b])},10)},a.checkNodeIP=function(b){if(b.is_show=!b.is_show,0==b.exe_soc_list.length){b.is_loading=!0;var c=7==a.reqData.imply_type||8==a.reqData.imply_type?2:a.reqData.imply_type;""==o?k.getAllSocList(b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,e.alert(a.message,3)}):g.getSocListByIpAndBsys(o,b.exe_ip,c).then(function(a){for(var c=a.source_list?a.source_list:[],d=0;d<c.length;d++)new RegExp("agent").test(c[d])?(b.exe_soc_name=c[d],b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!0,protocol_type:c[d].protocol_type})):b.exe_soc_list.push({exe_soc_name:c[d].soc_name,state:!1,protocol_type:c[d].protocol_type});b.is_loading=!1},function(a){b.is_loading=!1,e.alert(a.message,3)})}b.is_show||r(b)};var r=function(b){for(var c=0;c<a.reqData.normal_ip_list.length;c++)b.exe_ip==a.reqData.normal_ip_list[c].exe_ip&&(a.reqData.normal_ip_list[c].is_show=!1)};a.click_dataSource=function(b,c,d){b.state=!b.state;for(var e=0;e<a.reqData.normal_ip_list.length;e++)if(a.reqData.normal_ip_list[e].exe_ip==c)for(var f=0;f<a.reqData.normal_ip_list[e].exe_soc_list.length;f++)f!=d&&(a.reqData.normal_ip_list[e].exe_soc_list[f].state=!1)},a.selectTwo=function(){c(function(){a.addNodeIp(a.reqData.search_key_work)},10)},a.addNodeIp=function(b){if(""!=b){for(var c=!1,d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip==b&&(c=!0);if(!c){a.reqData.check_ip=b;for(var f=[],h="",i=[],d=0;d<a.reqData.ip_data_list.length;d++)i.push({ver_ip:a.reqData.ip_data_list[d],is_check:!1,ver_soc_list:[]});""==o?k.getAllSocList(b,2).then(function(c){for(var d=c.source_list?c.source_list:[],e=0;e<d.length;e++)new RegExp("agent").test(d[e])?(h.exe_soc_name=d[e],f.push({exe_soc_name:d[e].soc_name,state:!0,protocol_type:d[e].protocol_type})):f.push({exe_soc_name:d[e].soc_name,state:!1,protocol_type:d[e].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:[],ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:[],ver_ip:""}),e.alert(error.message,3)}):g.getSocListByIpAndBsys(o,b,2).then(function(c){for(var d=c.source_list?c.source_list:[],e=0;e<d.length;e++)new RegExp("agent").test(d[e])?(h.exe_soc_name=d[e],f.push({exe_soc_name:d[e].soc_name,state:!0,protocol_type:d[e].protocol_type})):f.push({exe_soc_name:d[e].soc_name,state:!1,protocol_type:d[e].protocol_type});a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:i,ver_ip:""})},function(){a.reqData.extra_ip_list.push({exe_ip:b,exe_soc_list:f,is_show:!0,delete_flag:!1,exe_soc_name:h,ver_ip_list:i,ver_ip:""}),e.alert(error.message,3)});for(var d=0;d<a.reqData.extra_ip_list.length;d++)a.reqData.extra_ip_list[d].exe_ip!=b&&(a.reqData.extra_ip_list[d].is_show=!1)}}},a.clickNodeIP=function(b,c){if(a.reqData.check_ip==b.exe_ip)b.is_show=!1,a.reqData.check_ip="";else{a.reqData.check_ip=b.exe_ip;for(var d=0;d<a.reqData.extra_ip_list.length;d++)b.exe_ip!=a.reqData.extra_ip_list[d].exe_ip?a.reqData.extra_ip_list[d].is_show=!1:a.reqData.extra_ip_list[d].is_show=!0}},a.checkDeleteFlag=function(a,b){b.stopPropagation(),a.delete_flag=!a.delete_flag},a.clickExeDataSource=function(b,c,d){for(var e=0;e<a.reqData.extra_ip_list[d].exe_soc_list.length;e++)e!=c&&(a.reqData.extra_ip_list[d].exe_soc_list[e].state=!1);a.reqData.extra_ip_list[d].exe_soc_list[c].state=!a.reqData.extra_ip_list[d].exe_soc_list[c].state},a.clickVerNode=function(b,c,d){0==a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list.length&&(a.reqData.tow_soc_loading=!0,""==o?k.getAllSocList(b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,e.alert(b.message,3)}):g.getSocListByIpAndBsys(o,b.ver_ip,a.reqData.imply_type).then(function(b){for(var e=b.source_list||[],f=[],g="",h=0;h<e.length;h++)new RegExp("agent").test(e[h])?(g.exe_soc_name=e[h],f.push({ver_soc_name:e[h].soc_name,state:!0,protocol_type:e[h].protocol_type})):f.push({ver_soc_name:e[h].soc_name,state:!1,protocol_type:e[h].protocol_type});a.reqData.extra_ip_list[d].ver_ip_list[c].ver_soc_list=f,a.reqData.tow_soc_loading=!1},function(b){a.reqData.tow_soc_loading=!1,e.alert(b.message,3)}));for(var f=0;f<a.reqData.extra_ip_list[d].ver_ip_list.length;f++)a.reqData.extra_ip_list[d].ver_ip_list[f].is_check=!1;a.reqData.extra_ip_list[d].ver_ip_list[c].is_check=!0},a.clickVerSource=function(b,c,d,e){for(var f=0;f<a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list.length;f++)f!=c&&(a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[f].state=!1);a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state=!a.reqData.extra_ip_list[e].ver_ip_list[d].ver_soc_list[c].state},a.formCancel=function(){b.dismiss(!1)},a.sourceType_color=[{s_type:1,color:"#88B8FE",bg:"#F5F9FE"},{s_type:5,color:"#7BADA4",bg:"#D2F6EE"},{s_type:9,color:"#FC973E",bg:"#FFF4ED"},{s_type:10,color:"#88B8FE",bg:"#EAF8FC"},{s_type:14,color:"#FC973E",bg:"#FFF4ED"}],a.getProtocolTypeCnName=function(a){return n.findValue(a,m)},a.find_dataSource_color=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].color},a.find_dataSource_bgcolor=function(b){for(var c=0;c<a.sourceType_color.length;c++)if(a.sourceType_color[c].s_type==b)return a.sourceType_color[c].bg},a.savebtn=function(){if(1==a.reqData.flag){for(var c=0;c<a.reqData.normal_ip_list.length;c++)if(a.reqData.normal_ip_list[c].is_show){var d={};d.soc_name_list=[],d.ftp_soc_name_list=[],d.soc_ip=a.reqData.normal_ip_list[c].soc_ip;for(var e=0;e<a.reqData.normal_ip_list[c].soc_name_list.length;e++)d.soc_name_list.push({soc_name:a.reqData.normal_ip_list[c].soc_name_list[e].soc_name,protocol_type:a.reqData.normal_ip_list[c].soc_name_list[e].protocol_type}),a.reqData.normal_ip_list[c].soc_name_list[e].state&&(d.soc_name=a.reqData.normal_ip_list[c].soc_name_list[e].soc_name,d.protocol_type=a.reqData.normal_ip_list[c].soc_name_list[e].protocol_type);if(0!=a.reqData.normal_ip_list[c].ftp_soc_name_list.length)for(var e=0;e<a.reqData.normal_ip_list[c].ftp_soc_name_list.length;e++)d.ftp_soc_name_list.push({soc_name:a.reqData.normal_ip_list[c].ftp_soc_name_list[e].soc_name,protocol_type:a.reqData.normal_ip_list[c].ftp_soc_name_list[e].protocol_type}),a.reqData.normal_ip_list[c].ftp_soc_name_list[e].state&&(d.ftp_soc_name=a.reqData.normal_ip_list[c].ftp_soc_name_list[e].soc_name,d.ftp_protocol_type=a.reqData.normal_ip_list[c].ftp_soc_name_list[e].protocol_type);(0!=a.reqData.normal_ip_list[c].ftp_soc_name_list.length&&d.ftp_soc_name&&d.soc_name||0==a.reqData.normal_ip_list[c].ftp_soc_name_list.length&&d.soc_name)&&a.reqData.srv_soc.push(d)}}else if(a.reqData.two_soc){for(var c=0;c<a.reqData.extra_ip_list.length;c++)if(!a.reqData.extra_ip_list[c].delete_flag){var f={};f.exe_ip=a.reqData.extra_ip_list[c].exe_ip,f.exe_soc_list=[],f.ver_soc_list=[];for(var e=0;e<a.reqData.extra_ip_list[c].exe_soc_list.length;e++)f.exe_soc_list.push({soc_name:a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.extra_ip_list[c].exe_soc_list[e].state&&(f.exe_soc_name=a.reqData.extra_ip_list[c].exe_soc_list[e].exe_soc_name,f.exe_protocol_type=a.reqData.extra_ip_list[c].exe_soc_list[e].protocol_type);for(var g=0;g<a.reqData.extra_ip_list[c].ver_ip_list.length;g++)if(a.reqData.extra_ip_list[c].ver_ip_list[g].is_check){f.ver_ip=a.reqData.extra_ip_list[c].ver_ip_list[g].ver_ip;for(var h=0;h<a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list.length;h++)f.ver_soc_list.push({soc_name:a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].ver_soc_name,protocol_type:a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].protocol_type}),a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].state&&(f.ver_soc_name=a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].ver_soc_name,f.ver_protocol_type=a.reqData.extra_ip_list[c].ver_ip_list[g].ver_soc_list[h].protocol_type);break}f.exe_soc_name&&f.ver_soc_name&&a.reqData.srv_soc.push(f)}}else for(var c=0;c<a.reqData.normal_ip_list.length;c++)if(a.reqData.normal_ip_list[c].is_show){var d={};d.exe_soc_list=[],d.exe_ip=a.reqData.normal_ip_list[c].exe_ip;for(var e=0;e<a.reqData.normal_ip_list[c].exe_soc_list.length;e++)d.exe_soc_list.push({soc_name:a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,protocol_type:a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type}),a.reqData.normal_ip_list[c].exe_soc_list[e].state&&(d.exe_soc_name=a.reqData.normal_ip_list[c].exe_soc_list[e].exe_soc_name,d.exe_protocol_type=a.reqData.normal_ip_list[c].exe_soc_list[e].protocol_type);d.exe_soc_name&&a.reqData.srv_soc.push(d)}b.close(a.reqData.srv_soc)},a.monitorSelect=function(){return a.control.no_select_node=!a.reqData.normal_ip_list.some(function(a){return a.is_show}),null},q()}]),modal_m.controller("nodeSocDetailCtrl",["$scope","$modalInstance","modalParam","ProtocolType","IML_TYPE","CV",function(a,b,c,d,e,f){a.phase=c.data,a.getProtocolTypeCnName=function(a){return f.findValue(a,d).substring(0,5).toLowerCase()},a.getImplTypeCnName=function(a){return a?9==a?"配置":10==a?"人工":f.findValue(a,e):void 0},a.cancel=function(){b.close(!0)},a.ok=function(){b.close(!0)}}]);var pCtrl=angular.module("ProjController",[]);pCtrl.controller("projectRegisterCtrl",["$scope","$timeout","$state","$stateParams","ScrollBarConfig","Project","BusiSys","LetterNavList","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){a.control={show_config_div:!1,user_exsit:!1,sys_keyword:""},a.info={project_id:"",project_name:"",project_desc:"",project_scale:1,project_managers:[],error_message:"",project_sys_list:[]},a.data={user_list:[],dept_user_list:[],sys_list:[],screen_sys_list:[],letter_nav_list:angular.copy(h)},a.config={dept_wrap_scroll:e.Y(),people_wrap_scroll:e.Y()};var k=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.is_check=!1,a[0].is_check=!0,c.user_list=c.user_list||[];for(var d=0;d<c.user_list.length;d++){var e=c.user_list[d];e.check_flag=!1}}},l=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.user_list=d.user_list||[];for(var e=0;e<d.user_list.length;e++){var f=d.user_list[e];f.check_flag&&b.push({dept_cn_name:d.dept_cn_name,dept_id:d.dept_id,user_id:f.user_id,user_cn_name:f.user_cn_name})}}return b},m=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.user_list)for(var d=0;d<c.user_list.length;d++){var e=c.user_list[d];if(e.check_flag)return!0}}return!1},n=function(a,b){var c={};return a.reduce(function(a,d){return c[d[b]]?"":c[d[b]]=a.push(d),a},[])},o=function(){for(var b=0;b<a.data.user_list.length;b++)for(var c=a.data.user_list[b],d=0;d<a.data.dept_user_list.length;d++){var e=a.data.dept_user_list[d];e.user_list=e.user_list||[];for(var f=0;f<e.user_list.length;f++){var g=e.user_list[f];g.user_id.trim()===c.user_id.trim()&&(g.check_flag=!0)}}},p=function(){f.getAllExcutedUser().then(function(b){a.data.dept_user_list=b.dept_user_list?b.dept_user_list:[],k(a.data.dept_user_list)},function(b){a.info.error_message=b.message}),g.getAllBusinessSys(!1).then(function(c){b(function(){if(c){a.data.sys_list=c.list_bs||[];for(var b=0;b<a.data.sys_list.length;b++){var d=a.data.sys_list[b],e=PinYin.toPyInitial(d.business_cn_name||"");d.letter=e[0].charAt(0).toUpperCase(),/[A-Z]/.test(d.letter)||(d.letter="#");for(var f=0;f<a.data.letter_nav_list.length;f++){var g=a.data.letter_nav_list[f];d.letter===g.letter&&(g.checked_count=0,g.list.push({sys_name:d.business_sys_name,sys_cn_name:d.business_cn_name}))}}a.data.screen_sys_list=a.data.letter_nav_list.filter(function(a){return a.list.length>0})}},0)},function(a){i.alert(a.message,3)})};a.configProjectUser=function(){a.control.show_config_div=!a.control.show_config_div,a.control.show_config_div&&o()},a.switchDept=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.is_check=!1}a.is_check=!0},a.hideConfig=function(){a.control.show_config_div=!1,k(a.data.dept_user_list)},a.saveResponseUser=function(){return m(a.data.dept_user_list)?(a.data.user_list=[],a.data.user_list=a.data.user_list.concat(l(a.data.dept_user_list)),a.data.user_list=n(a.data.user_list,"user_id"),a.control.user_exsit=!1,a.control.show_config_div=!1,void k(a.data.dept_user_list)):(i.alert("至少选择一个项目负责人！",3),!1)},a.deleteUser=function(b){a.data.user_list.splice(b,1)},a.checkSys=function(b,c){c.checked=!c.checked,c.checked?(b.checked_count++,a.info.project_sys_list.push({business_sys_name:c.sys_name})):(b.checked_count--,a.info.project_sys_list.pop())},a.formSubmit=function(){if(!j.valiForm(a.proj_form))return a.control.sava_btn_loading=!1,!1;if(0==a.data.user_list.length)return a.control.user_exsit=!0,a.control.sava_btn_loading=!1,!1;if(0===a.info.project_sys_list.length)return i.alert("请选择应用系统",1),!1;a.info.project_managers=[];for(var b=0;b<a.data.user_list.length;b++)a.info.project_managers.push(a.data.user_list[b].user_id);a.info.project_scale=parseInt(a.info.project_scale),a.control.sava_btn_loading=!0,f.addProj(a.info).then(function(b){b&&(a.control.sava_btn_loading=!1,i.alert("项目保存成功！",2),c.go("proj_list"))},function(b){a.control.sava_btn_loading=!1,i.alert(b.message,3)})},a.formCancel=function(){c.go("proj_list")},p()}]),pCtrl.controller("projectRegisterModifyCtrl",["$scope","$timeout","$state","$stateParams","ScrollBarConfig","Project","BusiSys","LetterNavList","User","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=d.project_id;a.control={update_flag:!0,show_config_div:!1,user_exsit:!1,sys_keyword:""},a.info={project_id:"",project_name:"",project_status:"",project_desc:"",project_scale:1,project_managers:[],error_message:"",project_sys_list:[]},a.data={user_list:[],all_user_list:[],dept_user_list:[],sys_list:[],screen_sys_list:[],letter_nav_list:angular.copy(h)},a.config={dept_wrap_scroll:e.Y(),people_wrap_scroll:e.Y()};var m=function(b){for(var c=0;c<b.length;c++){var d=b[c];d.is_check=!1,b[0].is_check=!0,d.user_list=d.user_list||[];for(var e=0;e<d.user_list.length;e++){var f=d.user_list[e];f.check_flag=!1,a.data.all_user_list.push(f)}}},n=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.user_list=d.user_list||[];for(var e=0;e<d.user_list.length;e++){var f=d.user_list[e];f.check_flag&&b.push({dept_cn_name:d.dept_cn_name,dept_id:d.dept_id,user_id:f.user_id,user_cn_name:f.user_cn_name})}}return b},o=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.user_list)for(var d=0;d<c.user_list.length;d++){var e=c.user_list[d];if(e.check_flag)return!0}}return!1},p=function(a,b){var c={};return a.reduce(function(a,d){return c[d[b]]?"":c[d[b]]=a.push(d),a},[])},q=function(){for(var b=0;b<a.data.user_list.length;b++)for(var c=a.data.user_list[b],d=0;d<a.data.dept_user_list.length;d++){var e=a.data.dept_user_list[d];e.user_list=e.user_list||[];for(var f=0;f<e.user_list.length;f++){var g=e.user_list[f];g.user_id.trim()===c.user_id.trim()&&(g.check_flag=!0)}}},r=function(){f.getAllExcutedUser().then(function(c){a.data.dept_user_list=c.dept_user_list?c.dept_user_list:[],m(a.data.dept_user_list),f.getProjectData(l).then(function(c){c&&b(function(){a.info.project_id=c.pjproject_info.project_id,a.info.project_name=c.pjproject_info.project_name,a.info.project_status=c.pjproject_info.project_status,a.info.project_desc=c.pjproject_info.project_desc,a.info.project_scale=c.pjproject_info.project_scale,a.info.project_sys_list=c.pjSys_info_list||[],a.data.sys_list=c.business_sys_list||[];for(var b=c.pjproject_info.project_managers?c.pjproject_info.project_managers.trim().split(","):[],d=a.data.all_user_list,e=0;e<d.length;e++)for(var f=0;f<b.length;f++)d[e].user_id.trim()==b[f].trim()&&a.data.user_list.push(d[e]);q();for(var g=0;g<a.data.sys_list.length;g++){var h=a.data.sys_list[g],i=PinYin.toPyInitial(h.business_cn_name||"");h.letter=i[0].charAt(0).toUpperCase(),/[A-Z]/.test(h.letter)||(h.letter="#");for(var j=0;j<a.data.letter_nav_list.length;j++){var k=a.data.letter_nav_list[j];h.letter===k.letter&&(k.checked_count=k.checked_count?k.checked_count:0,(1===h.sys_used_flag||2===h.sys_used_flag)&&(k.checked_count++,a.info.project_sys_list.push({business_sys_name:h.business_sys_name,sys_used_flag:h.sys_used_flag})),k.list.push({sys_name:h.business_sys_name,sys_cn_name:h.business_cn_name,checked:1===h.sys_used_flag,checked_disabled:2===h.sys_used_flag}))}}a.data.screen_sys_list=a.data.letter_nav_list.filter(function(a){return a.list.length>0})},0)},function(b){a.info.error_message=b.message})},function(b){a.info.error_message=b.message})};a.configProjectUser=function(){a.control.show_config_div=!a.control.show_config_div,a.control.show_config_div&&q()},a.switchDept=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.is_check=!1}a.is_check=!0},a.hideConfig=function(){a.control.show_config_div=!1,m(a.data.dept_user_list)},a.saveResponseUser=function(){return o(a.data.dept_user_list)?(a.data.user_list=[],a.data.user_list=a.data.user_list.concat(n(a.data.dept_user_list)),a.data.user_list=p(a.data.user_list,"user_id"),a.control.user_exsit=!1,a.control.show_config_div=!1,void m(a.data.dept_user_list)):(j.alert("至少选择一个项目负责人！",3),!1)},a.deleteUser=function(b){a.data.user_list.splice(b,1)},a.checkSys=function(b,c){c.checked=!c.checked,c.checked?(b.checked_count++,a.info.project_sys_list.push({business_sys_name:c.sys_name,sys_used_flag:c.sys_used_flag||0})):(b.checked_count--,a.info.project_sys_list.pop())},a.formSubmit=function(){if(!k.valiForm(a.proj_form))return a.control.sava_btn_loading=!1,!1;if(0==a.data.user_list.length)return a.control.user_exsit=!0,a.control.sava_btn_loading=!1,!1;if(0===a.info.project_sys_list.length)return j.alert("请选择应用系统",1),!1;a.info.project_managers=[];for(var b=0;b<a.data.user_list.length;b++)a.info.project_managers.push(a.data.user_list[b].user_id);a.info.project_scale=parseInt(a.info.project_scale),a.control.sava_btn_loading=!0,f.addProj(a.info).then(function(b){b&&(a.control.sava_btn_loading=!1,j.alert("项目修改成功！",2),c.go("proj_list"))},function(b){a.control.sava_btn_loading=!1,j.alert(b.message,3)})},a.formCancel=function(){c.go("proj_list")},r()}]),pCtrl.controller("projPreDetailCtrl",["$scope","$stateParams","$state","$timeout","$interval","$sce","ScrollConfig","Proj","Project","Exec","ProjectNature","pathType","ProjState","IssueType","ProdFlag","DirNodeShare","ProtocolType","BusiSys","Modal","CodeMirrorOption","CmptFunc","BsysFunc","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=b.sys_id,y=b.publish_id;a.config={viewOptions:t.Sh(!0),pub_scroll:g,rollback_scroll:g,config_file_scroll:g,prepare_scroll:g},a.control={pro_status:{error_status:!1,loading_status:!1,empty_status:!1},bs_status:{error_status:!1,loading_status:!1,empty_status:!1},plan_status:{error_status:!1,loading_status:!1,empty_status:!1},ready_status:{error_status:!1,loading_status:!1,empty_status:!1},pub_status:{error_status:!1,loading_status:!1,empty_status:!1},back_btn_active:0,pub_step_flag:!0,back_step_flag:!1,code_refresh:!1},a.info={public_info:{},pj_info:{},publish_info:{},pre_info:{}};var z=function(a){for(var b,c="",d=0;d<a.length;d++)c+=w.findValue(a[d],n)+" | ";return b=c.substring(0,c.lastIndexOf("|")-1),b?b:"无"},A=function(a,b){s.summary(a,b).then(function(a){C()})},B=function(a,b,c){s.rollbackSummary(a,b,c).then(function(a){C()})},C=function(){i.viewSysPublishDetail(y).then(function(b){b.sysPublishDetail&&(a.control.pro_status.loading_status=!1,a.info.pj_info.business_cn_name=b.sysPublishDetail.business_cn_name,a.info.pj_info.business_sys_name=b.sysPublishDetail.business_sys_name,a.info.pj_info.pjpublish_name=b.sysPublishDetail.pjpublish_name,a.info.pj_info.sys_publish_status=b.sysPublishDetail.sys_publish_status,a.info.pj_info.project_name=b.sysPublishDetail.project_name,a.info.pj_info.pjpublish_date=b.sysPublishDetail.publish_date+"  "+b.sysPublishDetail.publish_time,a.info.pj_info.user_cn_name=b.sysPublishDetail.manager_user_name?b.sysPublishDetail.manager_user_name:"--",a.info.pj_info.prod_flag=b.sysPublishDetail.syspublish_success_flag?b.sysPublishDetail.syspublish_success_flag:"",a.info.pj_info.prod_flag_cn=b.sysPublishDetail.syspublish_success_flag?w.findValue(b.sysPublishDetail.syspublish_success_flag,o):"无",a.info.pj_info.project_bk_evaluate=b.sysPublishDetail.project_bk_evaluate,a.info.pj_info.assess_bk_date=b.sysPublishDetail.assess_bk_date,a.info.pj_info.assess_bk_time=b.sysPublishDetail.assess_bk_time,a.info.pj_info.problem_types=b.sysPublishDetail.problem_types?b.sysPublishDetail.problem_types:[],a.info.pj_info.problem_type_list_cn=z(a.info.pj_info.problem_types)),a.info.pj_info.promanual_path=b.promanual_path,a.info.pj_info.proreport_path=b.proreport_path,a.info.pj_info.prolog_path=b.prolog_path,a.info.pj_info.proreport_pdf_path=b.proreport_pdf_path,a.info.pj_info.promanual_pdf_path=b.promanual_pdf_path},function(a){s.alert(a.message,3)})},D=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.nav_show_flag=0,c.expand_flag=!1,c.phase_list=v.dealPhase(c.phase_list);for(var d=0;d<c.phase_list.length;d++)c.phase_list[d].script&&c.phase_list[d].script.cmds&&(c.phase_list[d].exec_script=u.cmdsToString(c.phase_list[d].script.cmds)),6==c.phase_list[d].phase_type&&(c.phase_list[d].url_detail=f.trustAsHtml(c.phase_list[d].script.cmds[0])),c.phase_list[d].command&&c.phase_list[d].command.cmds&&(c.phase_list[d].command.exec_script=u.cmdsToString(c.phase_list[d].command.cmds))}},E=function(){d(function(){i.viewSysReadyDetail(y).then(function(b){b?(a.control.ready_status.loading_status=!1,a.info.pre_info.dpl_upload_flag=b.dpl_upload_flag,a.info.pre_info.dpp_upload_flag=b.dpp_upload_flag,a.info.pre_info.dpl_upload_flag_cn=w.findValue(a.info.pre_info.dpl_upload_flag,l),a.info.pre_info.dpp_upload_flag_cn=w.findValue(a.info.pre_info.dpp_upload_flag,l),a.info.pre_info.version_soc_name=b.version_soc_name,b.publish_program&&(a.info.pre_info.prog_id=b.publish_program.prog_id,a.info.pre_info.version_num=b.publish_program.version_num?b.publish_program.version_num:"--",a.info.pre_info.prog_cn_name=b.publish_program.prog_cn_name,a.info.pre_info.prolist_full_path=b.publish_program.list_name?b.publish_program.list_name_path:"",a.info.pre_info.publish_group_list=b.publish_program.group_list?b.publish_program.group_list:[],a.info.pre_info.pac_type_list=b.publish_program.pac_type_list?b.publish_program.pac_type_list:[],a.info.pre_info.config_file_list=b.publish_program.config_file_list?b.publish_program.config_file_list:[],v.processProgDate(a.info.pre_info.publish_group_list,a.info.pre_info.pac_type_list,a.info.pre_info.config_file_list),a.info.pre_info.publish_param_list=b.publish_program.param_list?b.publish_program.param_list:[],a.info.pre_info.package_file_path=b.publish_program.package_file_path?b.publish_program.package_file_path:[],a.info.pre_info.rollbackMsg_list=b.rollback_program?b.rollback_program:[],a.info.pre_info.rollbackMsg_list.length>=1&&(a.info.pre_info.back_cn_name=a.info.pre_info.rollbackMsg_list[0].prog_cn_name,a.info.pre_info.rollback_group_list=a.info.pre_info.rollbackMsg_list[0].group_list?a.info.pre_info.rollbackMsg_list[0].group_list:[],a.info.pre_info.rollback_param_list=a.info.pre_info.rollbackMsg_list[0].param_list?a.info.pre_info.rollbackMsg_list[0].param_list:[],a.info.pre_info.rollback_pac_type_list=a.info.pre_info.rollbackMsg_list[0].pac_type_list?a.info.pre_info.rollbackMsg_list[0].pac_type_list:[],a.info.pre_info.rollback_config_file_list=a.info.pre_info.rollbackMsg_list[0].rollback_config_file_list?a.info.pre_info.rollbackMsg_list[0].rollback_config_file_list:[],v.processProgDate(a.info.pre_info.rollback_group_list,a.info.pre_info.rollback_pac_type_list,a.info.pre_info.rollback_config_file_list)),a.info.pre_info.config_file_list=b.publish_program.config_list?b.publish_program.config_list:[])):a.control.ready_status.empty_status=!0},function(b){a.control.ready_status.loading_status=!1,a.control.ready_status.error_status=!0,a.info.pre_info.errorMessage=b.message})},0)},F=function(){d(function(){a.control.code_refresh=!a.control.code_refresh},50)},G=function(){a.control.pro_status.loading_status=!0,a.control.ready_status.loading_status=!0,C(),E()};a.downloadFile=function(a){w.downloadFile(a)},a.toggleModulesDetail=function(b,c){F(),b.show_detail=!b.show_detail,c.nav_show_flag=u.judgeShowDetail(c.phase_list),c.expand_flag=2==c.nav_show_flag?!0:!1,b.show_detail&&(a.code_refresh=!1,d(function(){a.code_refresh=!0},10))},a.expandCollapseAll=function(b){F(),b.nav_show_flag=u.expandAllModules(b.phase_list),2==b.nav_show_flag&&(a.code_refresh=!1,d(function(){a.code_refresh=!0},10))},a.colseCollapseAll=function(a){F(),a.nav_show_flag=u.closeAllModules(a.phase_list)},a.getProtocolTypeCnName=function(a){return w.findValue(a,q).substring(0,5).toLowerCase()},a.calculateParamTableWidth=function(a,b){var c=1==a?$("#param_table").width():$(".param_rollback_table").width();return{width:c/3+"px","max-width":c/3+"px","min-width":c/3+"px"}},a.calculatePlanWidth=function(a,b){var c=1/a.length*100;return{width:c+"%",color:b.checked?"":"#999"}},a.changeShowProj=function(a,b){for(var c=0;c<a.length;c++)a[c].checked=!1;b.checked=!0},a.showSummary=function(){A(y,x)},a.showRollbackSummary=function(){B(y,x,a.info.publish_info.project_status)},a.commentStyle=function(a){for(var b=$(a);b.outerHeight()>69;)b.text(b.text().replace(/(\s)*([a-zA-Z0-9]+|\W)(\.\.\.)?$/,"..."))},a.formatData=function(a){if(a.end_datetime){var b=new Date(a.end_datetime);a.format_tm=b}else a.format_tm=null;return a},a.shiftRolbackProgram=function(b,c){a.control.back_btn_active=c,a.info.pre_info.back_cn_name=b.prog_cn_name,a.info.pre_info.rollback_group_list=b.group_list?b.group_list:[],D(a.info.pre_info.rollback_group_list),a.info.pre_info.rollback_param_list=b.param_list?b.param_list:[]},a.downloadProdPackageOrList=function(a){w.downloadFile(a)},G()}]),pCtrl.controller("projListCtrl",["$scope","$state","$timeout","Project","ProjectStatus","ProjectReleaseType","ProjState","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=[],l=b.$current.self.name||"proj_list";a.info={error_msg:"",project_list:[],project_name:"",project_info:{}},a.data={release_type:f,project_status:e},a.control={project_list_loading:!1,wait_pub_choose_flag:!0,pub_exec_choose_flag:!1,pub_finish_choose_flag:!1,pub_close_flag:!1,show_filter_flag:!0,is_history_proj:"proj_history"===l,tab_flag:"proj_history"===l?"2":"1"},a.config={project_scroll:h.Y(),page_option:{curr:1,all:1,limit_recd:10,all_recd:0,count:10,page_info:{start_recd:0,limit_recd:10},click:function(a){n("",[],a)}}};var m=function(){n()},n=function(b,e,f){f=f||1;var g=b?b:"",h=e||[1];a.info.error_msg="",a.control.project_list_loading=!0,a.config.page_option.page_info.start_recd=a.config.page_option.page_info.limit_recd*(f-1),d.getProjList(g,h,a.control.is_history_proj,a.config.page_option.page_info).then(function(b){c(function(){a.config.page_option.all_recd=b.all_recd||0,
a.info.project_list=b.project_list||[],a.control.project_list_loading=!1},0)},function(b){a.control.project_list_loading=!1,a.info.error_msg=b.message})};a.getListByStatus=function(b){var c=[];1===b&&(a.control.wait_pub_choose_flag=!a.control.wait_pub_choose_flag),2===b&&(a.control.pub_exec_choose_flag=!a.control.pub_exec_choose_flag),3===b&&(a.control.pub_finish_choose_flag=!a.control.pub_finish_choose_flag),4===b&&(a.control.pub_close_flag=!a.control.pub_close_flag),a.control.wait_pub_choose_flag&&c.push(1),a.control.pub_exec_choose_flag&&c.push(2),a.control.pub_finish_choose_flag&&c.push(3),a.control.pub_close_flag&&c.push(4),k=c,n(a.info.project_name,c)},a.search=function(){n(a.info.project_name,k)},a.sysStatusStyle=function(a){var b="";switch(a){case 1:case 2:case 9:b="publish-wait";break;case 3:case 6:b="publishing";break;case 4:case 5:case 7:b="published";break;case 8:b="publish-error";break;default:b=""}return b},a.getSysStatusValue=function(a){return j.findValue(a,g)},a.closeProject=function(a,b,c){a.stopPropagation(),i.confirm("请确认是否关闭 [ "+c+" ] 项目？").then(function(a){a&&d.handleCloseProject(b).then(function(a){a&&(i.alert("关闭成功",2),n())},function(a){i.alert(a.message,3)})})},a.restartProject=function(a,b,c){a.stopPropagation(),i.confirm("请确认是否重启["+c+"]项目？").then(function(a){a&&d.reBootProject(b).then(function(a){a&&(i.alert("重启成功！",2),n())},function(a){i.alert(a.message,3)})})},m()}]),pCtrl.controller("projDetailCtrl",["$scope","$state","$stateParams","$timeout","Project","ProjectStatus","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i){a.info={error_msg:"",project_id:c.project_id,project_name:c.project_name,project_status:c.project_status||0},a.proj_detail_app_flag=!0,b.go("proj_detail.proj_application")}]);var prodCtrl=angular.module("ProdController",[]);prodCtrl.controller("pubPreCtrl",["$scope","$stateParams","$state","$timeout","$modal","$sce","Exec","BusiSys","Collection","CmptFunc","ProtocolType","BsysFunc","CodeMirrorOption","ProdFunc","Project","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b.sys_id,s=b.sys_publish_id,t="",u="",v="",w=[];a.data={node_list:[],solid_config_list:[],sub_tabs:[],program_list_publish:[],program_list_rollback:[],env_list:[]},a.control={validate_flag:!1,prolist_exsit_flag:!1,package_exsit_flag:!1,valid_prolist_loading:!1,config_info_flag:!1,pre_info_loading:!1,node_list_loading:!1,custom_config_flag:!1,code_reflash:!1,publish_param_list_flag:!1,rollback_param_list_flag:!1,expand_prog:!1,get_list_loading:!1,publish_loading:!1,rollback_loading:!1},a.info={pre_info:{business_sys_name:r,syspublish_id:s,upload_flag:1,version_soc_name:"",prolist_full_path:"",propackage_list:[],publish_program_list:[],publish_param_list:[],rollback_program_list:[],rollback_param_list:[],publish_prog_id:"",publish_program_cn_name:"",rollback_prog_id:"",rollback_program_cn_name:"",env_id:""},dir_names:{},prepare_msg:{}},a.config={config_tabs:[{active:!0},{active:!1}],prog_tabs:[{active:!0},{active:!1}],viewOptions:m.Sh(!0)};var x=function(b){for(var c=b?b:[],d=0;d<c.length;d++){var e=c[d];e.package_name_list=[],e.package_list=[],e.propackage_full_path=e.propackage_full_path?e.propackage_full_path:[];for(var f=0;f<e.propackage_full_path.length;f++)e.package_name_list.push({propackage_full_path:e.propackage_full_path[f]})}a.info.pre_info.propackage_list=c},y=function(){for(var b=0;b<a.info.pre_info.propackage_list.length;b++){var c=a.info.pre_info.propackage_list[b];if(c.required_flag&&0==c.package_list.length){a.control.package_exsit_flag=!0;break}}return!a.control.package_exsit_flag},z=function(b){for(var c=0;c<b.package_name_list.length;c++){var d=b.package_name_list[c];b.add_pac_btn_disable=!0,d.is_exsit_loading=!0,d.no_exsit=!1,g.downloadProdListFile(r,"",a.info.pre_info.version_soc_name,d.propackage_full_path).then(function(a){d.is_exsit_loading=!1,b.add_pac_btn_disable=!1},function(a){b.add_pac_btn_disable=!1,d.is_exsit_loading=!1,d.no_exsit=!0,p.alert(a.message,3)})}},A=function(b){a.control.node_list_loading=!0,g.getDefinePhyInfo(r,b).then(function(b){b&&(a.control.node_list_loading=!1,a.data.node_list=b.phy_node_list?b.phy_node_list:[],n.dealSocList(a.data.node_list))},function(b){p.alert(b.message,3),a.control.node_list_loading=!1})},B=function(a,b){var c=a;c=c.length>1&&c.lastIndexOf("/")==c.length-1?c.slice(0,c.length-1):c;var d=c.lastIndexOf("/");c?-1==d?b.paths=[c]:1==c.length&&0==d?b.paths=["/"]:0==d?b.paths=[c.slice(1)]:b.paths=c.slice(1).split("/"):b.paths=[]},C=function(b,c){for(var d=0,e=0;e<b.length;e++){var f=b[e];3!=f.param_type&&d++}0==d&&(a.control[c+"_param_list_flag"]=!0)},D=function(){a.control.get_list_loading=!0,o.getSysProgram(r).then(function(b){b&&(a.data.program_list_publish=b.program_list_publish?b.program_list_publish:[],a.data.program_list_rollback=b.program_list_rollback?b.program_list_rollback:[],a.data.env_list=b.env_list?b.env_list:[],a.control.get_list_loading=!1)},function(b){a.control.get_list_loading=!1,p.alert(b.message,3)})};a.chooseProgram=function(b,c,e){if(e){if(a.control[e+"_param_list_flag"]=!1,!b||!a.info.pre_info.env_id)return a.info.pre_info[e+"_program_list"]=[],a.info.pre_info[e+"_param_list"]=[],void(a.info.pre_info[e+"_program_cn_name"]="");a.control[e+"_loading"]=!0,"publish"==e?(a.control.custom_config_flag=!1,a.data.solid_config_list=[],a.data.modify_define_file_list=[],a.info.pre_info.propackage_list=[],a.info.pre_info.config_file_list=[],g.getQuickProjectPac(r,s,a.info.pre_info.env_id,b).then(function(b){d(function(){if(b){var c=[];a.info.prepare_msg=b.prepare_msg,a.info.dir_names=b.dir_names||{},a.info.publish_type=b.publish_type,a.info.pre_info.version_soc_name=b.version_soc_name?b.version_soc_name:"",a.info.pre_info.upload_flag=3==b.publish_type?3:b.version_soc_name?2:1,a.info.pre_info.channel_name=b.channel_name||"",u=b.dftpropac_bk_dir,v=b.file_upload_path,a.info.pre_info.prolist_full_path=b.prolist_full_path?b.prolist_full_path:"",x(b.prepare_msg.pac_type_list),a.info.pre_info[e+"_param_list"]=b.prepare_msg.param_list?b.prepare_msg.param_list:[],C(a.info.pre_info[e+"_param_list"],e),a.info.pre_info[e+"_program_list"]=b.prepare_msg.group_list?b.prepare_msg.group_list:[],l.processProgDate(a.info.pre_info[e+"_program_list"],b.prepare_msg.pac_type_list,b.prepare_msg.config_file_list),a.info.pre_info.publish_prog_id=b.prepare_msg.prog_id?b.prepare_msg.prog_id:"",a.info.pre_info.publish_program_cn_name=b.prepare_msg.prog_cn_name?b.prepare_msg.prog_cn_name:"",a.data.sub_tabs=[];for(var f=0;f<a.info.pre_info[e+"_program_list"].length;f++)for(var g=a.info.pre_info[e+"_program_list"][f],h=0;h<g.phase_list.length;h++){var i=g.phase_list[h];if(5==i.phase_type){var j={soc_index:"",node:{path_files:[],checked_files:[],paths:[],init_path:""},impl_type:i.impl_type,phase_type:i.phase_type,phase_name:i.phase_name,phase_no:i.phase_no,modify_define_file_list:[],active:!1};a.data.sub_tabs.push(j),w.push(i)}else 4==i.phase_type&&c.push(i)}0!=a.data.sub_tabs.length&&(a.control.custom_config_flag=!0,a.data.sub_tabs[0].active=!0,A(a.info.pre_info.env_id,r)),0!=c.length&&(a.data.solid_config_list=n.processConfigData(c)),d(function(){a.control.code_refresh=!0},10),a.control[e+"_loading"]=!1}},0)},function(b){a.control[e+"_loading"]=!1,p.alert(b.message,3)})):h.viewSingleProgramInfo(b).then(function(b){a.control[e+"_loading"]=!1,a.info.pre_info[e+"_program_list"]=b.program.group_list||[],a.info.pre_info[e+"_param_list"]=b.program.param_list||[],C(a.info.pre_info[e+"_param_list"],e),a.info.pre_info[e+"_program_cn_name"]=c,l.processProgDate(a.info.pre_info[e+"_program_list"],b.program.pac_type_list,b.program.config_file_list),d(function(){a.control.code_refresh=!0},10)},function(b){a.control[e+"_error_msg"]=b.message,a.control[e+"_loading"]=!1})}},a.getPrepareInfo=function(b,c,d){return a.info.pre_info.env_id&&a.info.pre_info.publish_prog_id?void 0:!1},a.expandCollapse=function(b){"div"==b.target.tagName.toLowerCase()&&(a.control.expand_prog=!a.control.expand_prog)},a.chooseTab=function(){a.control.code_refresh=!1,d(function(){a.control.code_refresh=!0},10)},a.paramShellLoaded=function(b){m.setParamsEditor(b),d(function(){a.control.code_refresh=!0},0)},a.changeFileFlag=function(b){a.info.pre_info.upload_flag=b,a.control.validate_flag=!1,a.info.pre_info.prolist_full_path="",angular.forEach(a.info.pre_info.propackage_list,function(a){a.propackage_full_path=a.propackage_full_path?[]:[],a.package_name_list=a.package_name_list?[]:[],a.package_list=a.package_list?[]:[]})},a.addProdPackage=function(b,c){a.control.validate_flag=!1,3!=c?p.prodPreAddProdPac(u,v,t,b,c,!1,a.info.pre_info).then(function(d){d&&(1==c&&(a.info.pre_info.propackage_list[b].package_name_list=d.dpp_param_info.propackage_list[b].package_name_list,a.info.pre_info.propackage_list[b].propackage_full_path=d.dpp_param_info.propackage_list[b].propackage_full_path,a.info.pre_info.propackage_list[b].package_list=d.dpp_param_info.propackage_list[b].package_list),2==c&&(a.info.pre_info.propackage_list[b]=d.dpp_param_info.propackage_list[b],z(a.info.pre_info.propackage_list[b])),a.control.package_exsit_flag=!1)}):p.prodPreAddProdPacFromPlatform(a.info.dir_names,b,s,a.info.pre_info).then(function(c){a.info.pre_info.propackage_list[b].package_list=c,a.control.package_exsit_flag=!1})},a.removeProdPackage=function(a,b,c){for(var d=c.propackage_full_path.substring(c.propackage_full_path.lastIndexOf("/")+1,c.propackage_full_path.length),e=0;e<a.length;e++){var f=a[e];if(f.package_type==b.package_type){for(var g=0;g<f.package_name_list.length;g++){var h=f.package_name_list[g];if(h.propackage_full_path==c.propackage_full_path){a[e].package_name_list.splice(g,1);break}}for(var g=0;g<f.package_list.length;g++){var i=f.package_list[g];if(i==d){a[e].package_list.splice(g,1);break}}for(var j=0;j<f.propackage_full_path.length;j++){var k=f.propackage_full_path[j];if(k==c.propackage_full_path){a[e].propackage_full_path.splice(j,1);break}}}}},a.downloadPackage=function(b){2==a.info.pre_info.upload_flag?q.downloadFile(_path):q.downloadFile(_path)},a.changeHeight=function(){var a=$(".left_content").css("height");return{height:a}},a.addProdList=function(){a.control.validate_flag=!1,p.prodPreAddProdPac("",v,t,"","",!0,a.info.pre_info).then(function(b){b&&(a.info.pre_info.prolist_full_path=b.prolist_full_path,2==a.info.pre_info.upload_flag&&(a.control.valid_prolist_loading=!0,g.downloadProdListFile(r,_proj_name,a.info.pre_info.version_soc_name,b).then(function(b){a.control.valid_prolist_loading=!1,a.control.prolist_exsit_flag=!0},function(b){a.control.valid_prolist_loading=!1,a.control.prolist_exsit_flag=!1})))})},a.downloadProdListFile=function(){var b=a.info.pre_info.prolist_full_path;q.downloadFile(b)},a.removeProdList=function(){a.info.pre_info.prolist_full_path=""},a.toggleModulesDetail=function(b,c){b.show_detail=!b.show_detail,c.nav_show_flag=j.judgeShowDetail(c.phase_list),c.expand_flag=2==c.nav_show_flag?!0:!1,a.control.code_refresh=!1,d(function(){a.control.code_refresh=!0},10)},a.expandCollapseAll=function(b){b.nav_show_flag=j.expandAllModules(b.phase_list),2==b.nav_show_flag&&(a.control.code_refresh=!1,d(function(){a.control.code_refresh=!0},10))},a.colseCollapseAll=function(a){a.nav_show_flag=j.closeAllModules(a.phase_list)},a.getProtocolTypeCnName=function(a){return q.findValue(a,k).substring(0,5).toLowerCase()},a.getFileList=function(b,c,d){d.file_soc_name=a.data.node_list[b].file_soc_name,d.execute_soc_name=a.data.node_list[b].execute_soc_name,d.execute_ip=a.data.node_list[b].ip,d.agent_user=a.data.node_list[b].agent_user?a.data.node_list[b].agent_user:"",d.init_temp="",d.node.paths=[],d.node.loading=!0,d.node.err_msg="",d.node.init_path="",i.getFileListBySoc(d.file_soc_name,d.node.init_path,d.execute_ip,d.agent_user).then(function(a){d.node.loading=!1,d.init_temp=a.root_bk_dir,d.node.init_path=d.init_temp,B(d.init_temp,d.node),d.node.path_files=a.file_bean_list?a.file_bean_list:[]},function(a){d.node.paths=[],d.node.init_path="",d.node.path_files=[],d.init_temp="",d.node.loading=!1,d.node.err_msg=a.message})},a.changePath=function(b,c){if(b.node.is_dir)b.node.loading=!0,d(function(){i.getFileListBySoc(b.file_soc_name,b.node.full_path,b.execute_ip,b.agent_user).then(function(a){b.node.loading=!1,b.node.path_files=a.file_bean_list?a.file_bean_list:[]},function(a){b.node.paths=[],b.node.loading=!1,b.node.err_msg=a.message})});else{var e=(b.execute_ip+r).replace(/\./g,""),f=b.execute_ip;p.compare(r,s,e,b.node.full_path,b.execute_soc_name,b.file_soc_name,f,!0,5).then(function(d){if(d){var e=b.soc_index,f=a.data.node_list,g=angular.copy(f[e]),h=w[c],i=b.node.full_path;h.phy_nodes=h.phy_nodes||[];for(var j=0;j<h.phy_nodes.length;j++)if(h.phy_nodes[j].ip===g.ip){h.phy_nodes[j].file_list.indexOf(i)<0&&h.phy_nodes[j].file_list.push(i),i=null;break}if(i){var k=angular.extend(g,{file_list:[i]});h.phy_nodes.push(k)}b.phy_nodes=h.phy_nodes}})}},a.showModifyFile=function(a,b,c){var d=b.execute_soc_name,e=(b.ip+r).replace(/\./g,""),f=b.file_soc_name,g=b.ip;p.compare(r,s,e,a.file,d,f,g,!0,c.phase_type,c.phase_no).then(function(b){b&&(a.is_modify=!0)})},a.showModifyDefineFile=function(a,b){var c=a.execute_soc_name,d=a.file_soc_name,e=(a.ip+r).replace(/\./g,""),f=a.ip;p.compare(r,s,e,b,c,d,f,!0).then(function(a){})},a.deleteDefineConfigModify=function(a,b,c,d,e){a.stopPropagation(),p.confirm("是否要删除已经修改的配置文件？").then(function(){b.file_list.length>1?b.file_list.splice(c,1):e.phy_nodes.splice(d,1)})},a.submitReadyForm=function(){var b=angular.copy(a.info.pre_info);a.info.prepare_msg.pac_type_list=b.propackage_list,a.info.prepare_msg.group_list=b.publish_program_list,a.info.prepare_msg.param_list=b.publish_param_list,a.info.prepare_msg.rollback_prog_id=b.rollback_prog_id,a.info.prepare_msg.list_name=b.prolist_full_path?b.prolist_full_path.substring(b.prolist_full_path.lastIndexOf("/")+1,b.prolist_full_path.length):"";var c={syspublish_id:s,sys_id:r,prepare_msg:a.info.prepare_msg};if(!q.valiForm(a.saveDppForm))return!1;if(0!=a.info.pre_info.propackage_list.length){if(!y())return!1;if(a.control.validate_flag)return!1}e.open({templateUrl:"templates/modal/loading_modal.html",controller:"submitModalCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{Message:function(){return c}}})},a.cancelReadyForm=function(){c.go("routine_release")},D()}]),prodCtrl.controller("prodExecDoCtrl",["$scope","$stateParams","$state","$rootScope","$timeout","$interval","$sce","Proj","Monitor","Exec","ProjState","ProdNodeState","ProdCmdState","CodeMirrorOption","ProdFunc","CmptFunc","ProtocolType","Modal","ProdFlag","ScrollConfig","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v,w,x,y,z=b.sys_id,A=b.sys_publish_id,B=(b.path_flag,b.auto_yn_flag),C=$("#codePanel"),D="",E=!0,F=0,G=0,H=!1;a.info={exec_type:b.exec_type,reset_phases:[],proj_info:{},instance_info:{steps:[]},phase_node_info:{nodes_info:{node_list:[],parallel_flag:!1},nodes_flag:!1,expand_flag:!1,phase_status:1,phase_id:1,nav_show_flag:0},remainTime:"",nowDate:"",nowTime:""},a.control={is_Exec:!0,show_prod_error:!1,reset_id:0,code_mirror_control:!1,get_nodes_loading:!1,is_quick_publish:b.quick_pub_flag?b.quick_pub_flag:2,curr:{_phase:0,_phaseDesc:"",_load:!1,_node:0},exec_btn:{phase:!0,auto:!0,skip:!0},can_exec:!1,is_log_minisize:!1},a.config={scroll_code_info:t,scroll_node_info:t,import_fileupload:{suffixs:"xls,xlsx,xml",filetype:"EXCEL",filename:"",uploadpath:""},view_options:n.Sh(!0)};var I=function(a){for(var b=[],c=[],d=[],e=0;e<a.length;e++)for(var f=a[e],g=0;g<f.phase_list.length;g++){var h=f.phase_list[g];if(h.node_list)for(var i=0;i<h.node_list.length;i++)c.push(h.node_list[i].exec_node_ip)}b=Array.from(new Set(c));for(var j=0;j<b.length;j++)d.push({exec_ip:b[j],is_show:!1});return d},J=function(b){e(function(){var c="#phase_"+b;a.inscrollTo($(c))},100)},K=function(a,b,c){r.rollbackSummary(a,b,c).then(function(a){})},L=function(b){var c=new Date(b.dtbs_bk_date.replace(/-/g,"/")+" "+b.dtbs_bk_time),d=c.getFullYear(),e=c.getMonth()+1<10?"0"+(c.getMonth()+1):c.getMonth()+1,g=c.getDate()<10?"0"+c.getDate():c.getDate(),h=c.getHours()<10?"0"+c.getHours():c.getHours(),i=c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes(),j=c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds(),k=new Date(b.pj_info_detail.pro_bk_date.replace(/-/g,"/")+" "+b.pj_info_detail.pro_bk_time),l=k.getTime(),m=c.getTime();a.info.nowDate=d+"-"+e+"-"+g,a.info.nowTime=h+":"+i+":"+j,a.SetTimer=function(){m+=1e3,c=new Date(m),g=c.getDate()<10?"0"+c.getDate():c.getDate(),h=c.getHours()<10?"0"+c.getHours():c.getHours(),i=c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes(),j=c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds(),a.info.nowDate=d+"-"+e+"-"+g,a.info.nowTime=h+":"+i+":"+j;var b=l-m,f=0,k=0,n=0,o=0;b>=0?(f=Math.floor(b/1e3/60/60/24),k=Math.floor(b/1e3/60/60%24)<10?"0"+Math.floor(b/1e3/60/60%24):Math.floor(b/1e3/60/60%24),n=Math.floor(b/1e3/60%60)<10?"0"+Math.floor(b/1e3/60%60):Math.floor(b/1e3/60%60),o=Math.floor(b/1e3%60)<10?"0"+Math.floor(b/1e3%60):Math.floor(b/1e3%60),f>0&&(k=24*f+parseInt(k)),a.info.remainTime=k+"时"+n+"分"+o+"秒"):a.control.can_exec=!0,a.$applyAsync()},y=f(a.SetTimer,1e3)},M=function(){j.getSysPubDetail(z,A).then(function(b){b.pj_info_detail&&(a.info.proj_info=b.pj_info_detail,a.info.proj_info.project_status=b.pj_info_detail.syspublish_status?b.pj_info_detail.syspublish_status:1,1==b.pj_info_detail.syspublish_status&&c.go("routine_release"),a.info.proj_info.project_status_cn=u.findValue(a.info.proj_info.project_status,k))},function(a){r.alert("获取系统发布信息异常："+a.message,3),c.go("routine_release")})},N=function(){j.getSysPubDetail(z,A).then(function(b){b.pj_info_detail&&(v=b.pj_info_detail.execute_id,2!=a.control.is_quick_publish?c.go("agile_pub_exe.console",{execute_id:v,stop_flag:1}):c.go("pub_exec.console",{execute_id:v,stop_flag:1}),a.info.proj_info=b.pj_info_detail,a.info.proj_info.project_status=b.pj_info_detail.syspublish_status?b.pj_info_detail.syspublish_status:1,1==a.info.exec_type?L(b):a.control.can_exec=!0,1==b.pj_info_detail.syspublish_status&&c.go("routine_release"),a.info.proj_info.project_status_cn=u.findValue(a.info.proj_info.project_status,k),i.monitorPjProject(v).then(function(b){if(b.group_list){a.info.reset_phases=[],a.info.instance_info.steps=b.group_list?b.group_list:[],a.info.phase_node_info.nodes_info.node_list=I(a.info.instance_info.steps),a.control.curr._phase=b.current_phase_no?b.current_phase_no:1,a.control.curr._node=b.current_phase_ip;for(var c=0;c<a.info.instance_info.steps.length;c++){var d=a.info.instance_info.steps[c];d.expand_flag=!0;for(var h=0;h<d.phase_list.length;h++){var i=d.phase_list[h];if(i.is_check=!1,i.time_used=i.time_used?i.time_used:0,i.phase_type<=3&&i.node_list)for(var k=0;k<i.node_list.length;k++)a.control.curr._node==i.node_list[k].exec_node_ip?i.exe_script=p.cmdsToString(i.node_list[k].cmds):i.exe_script=p.cmdsToString(i.node_list[0].cmds);6==i.phase_type&&i.cmds&&(i.url_detail=g.trustAsHtml(i.cmds[0])),a.control.curr._phase==i.phase_no&&E&&(i.is_check=!0,a.info.phase_node_info.phase_no=i.phase_no,a.info.phase_node_info.phase_status=i.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=i.parallel_flag,i.node_list?(a.info.phase_node_info.nodes_flag=!1,P(i.node_list)):a.info.phase_node_info.nodes_flag=!0,a.info.phase_node_info.nodes_info.node_list&&(a.info.phase_node_info.nav_show_flag=p.judgeShowDetail(a.info.phase_node_info.nodes_info.node_list),a.info.phase_node_info.expand_flag=2==a.info.phase_node_info.nav_show_flag?!0:!1))}}if(3==b.current_phase_status&&(a.control.curr._load=!1,a.control.show_prod_error=!0,a.control.exec_btn={phase:!1,auto:!1,skip:!0},f.cancel(x),w&&f.cancel(w)),2==b.current_phase_status&&(a.control.curr._load=!0,a.control.exec_btn={phase:!0,auto:!0,skip:!0},w=f(function(){O()},2e3)),1==b.current_phase_status&&1==B&&3==a.info.proj_info.project_status&&(a.control.curr._load=!1,a.control.exec_btn={phase:!0,auto:!0,skip:!0},f.cancel(x),w&&f.cancel(w)),-1==b.current_phase_no&&(F++,a.control.curr._load=!1,a.control.exec_btn={phase:!1,auto:!1,skip:!1},1==a.info.exec_type?(a.info.proj_info.project_status=4,2>F&&r.alert("恭喜！项目发布成功！").then(function(b){if(b)if(1==a.control.is_quick_publish)j.shutDownQuickProj(z,A,1).then(function(a){},function(a){r.alert(a.message,3)});else{var c={business_sys_name:z,syspublish_id:A,prod_flag:a.control.show_prod_error?2:1,problem_type_list:[],project_evaluate_list:[],project_bk_evaluate:"未评价",project_evaluate:{},notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""};j.summaryProd(c).then(function(b){M(),a.control.exec_btn={phase:!1,step:!1,reset:!1}},function(a){})}})):(a.info.proj_info.project_status=7,2>F&&r.alert("恭喜！项目回退成功！").then(function(b){var c={business_sys_name:z,syspublish_id:A,project_bk_evaluate:"未评价",rollback_flag:a.info.proj_info.project_status,evaluate_user_cn_name:"",notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""};j.editRollbackSummary(c).then(function(a){},function(a){})})),w&&f.cancel(w)),-1==a.control.curr._phase){var l=a.info.instance_info.steps[a.info.instance_info.steps.length-1],m=l.phase_list[l.phase_list.length-1];if(a.info.phase_node_info.phase_no=m.phase_no,a.info.phase_node_info.phase_status=m.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=m.parallel_flag,a.info.phase_node_info.nodes_info.node_list)for(var n=0;n<a.info.phase_node_info.nodes_info.node_list.length;n++)a.info.phase_node_info.nodes_info.node_list[n].is_show=!1;m.node_list?(a.info.phase_node_info.nodes_flag=!1,P(m.node_list)):a.info.phase_node_info.nodes_flag=!0,m.is_check=!0}o.bindCurrPhaseAndStep(a.control.curr._phase,a.info.instance_info.steps,a.control.curr),o.pushAllCanResetPhase(a.info.instance_info.steps,a.info.reset_phases),e(function(){a.control.code_mirror_control=!0,-1!=a.control.curr._phase&&J(a.control.curr._phase)},200)}},function(b){r.alert(b.message,3),1==a.control.is_quick_publish}))},function(a){r.alert("获取系统发布信息异常："+a.message,3),c.go("routine_release")})},O=function(){i.monitorPjProject(v).then(function(b){if(b.group_list){var c=b.group_list?b.group_list:[];a.info.reset_phases=[],a.control.curr._phase=b.current_phase_no?b.current_phase_no:1,a.control.curr._node=b.current_phase_ip;for(var d=0;d<c.length;d++)for(var g=c[d],h=0;h<g.phase_list.length;h++){var i=g.phase_list[h],k=a.info.instance_info.steps[d].phase_list[h];if(k){if(k.time_used=i.time_used?i.time_used:0,k.exe_msg=i.exe_msg?i.exe_msg:"",k.phase_status=i.phase_status,k.end_bk_tm=i.end_bk_tm?i.end_bk_tm:"",k.start_bk_tm=i.start_bk_tm?i.start_bk_tm:"",k.parallel_flag=i.parallel_flag,k.is_check=!1,i.node_list)for(var l=0;l<i.node_list.length;l++){var m=k.node_list[l];k.exe_script&&m.cmds&&(a.control.curr._node==m.exec_node_ip?k.exe_script=p.cmdsToString(m.cmds):k.exe_script=p.cmdsToString(k.node_list[0].cmds)),m.node_status=i.node_list[l].node_status,m.exe_msg=i.exe_msg}if(a.control.curr._phase==i.phase_no&&E){if(k.is_check=!0,a.info.phase_node_info.phase_no=k.phase_no,a.info.phase_node_info.phase_status=k.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=k.parallel_flag,a.info.phase_node_info.nodes_info.node_list)for(var l=0;l<a.info.phase_node_info.nodes_info.node_list.length;l++)a.info.phase_node_info.nodes_info.node_list[l].is_show=!1;k.node_list?(a.info.phase_node_info.nodes_flag=!1,P(k.node_list)):a.info.phase_node_info.nodes_flag=!0,a.info.phase_node_info.nodes_info.node_list&&(a.info.phase_node_info.nav_show_flag=p.judgeShowDetail(a.info.phase_node_info.nodes_info.node_list),a.info.phase_node_info.expand_flag=2==a.info.phase_node_info.nav_show_flag?!0:!1)}}}if(R(a.info.phase_node_info.nodes_info.node_list,!1),3==b.current_phase_status&&(a.control.curr._load=!1,a.control.show_prod_error=!0,a.control.exec_btn={phase:!1,auto:!1,skip:!0},f.cancel(x)),2==b.current_phase_status&&(a.control.curr._load=!0,a.control.exec_btn={phase:!0,auto:!0,skip:!0}),1==b.current_phase_status&&3==a.info.proj_info.project_status&&(a.control.curr._load=!1,a.control.exec_btn={phase:!0,auto:!0,skip:!0},f.cancel(x)),-1==b.current_phase_no&&(F++,a.control.curr._load=!1,a.control.exec_btn={phase:!1,auto:!1,skip:!1},1==a.info.exec_type?(a.info.proj_info.project_status=4,2>F&&r.alert("恭喜！项目发布成功！").then(function(b){if(b)if(1==a.control.is_quick_publish)j.shutDownQuickProj(z,A,1).then(function(a){},function(a){r.alert(a.message,3)});else{var c={business_sys_name:z,syspublish_id:A,prod_flag:a.control.show_prod_error?2:1,problem_type_list:[],project_evaluate_list:[],project_bk_evaluate:"未评价",project_evaluate:{},notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""};j.summaryProd(c).then(function(b){M(),a.control.exec_btn={phase:!1,step:!1,reset:!1}},function(a){})}})):(a.info.proj_info.project_status=7,2>F&&r.alert("恭喜！项目回退成功！").then(function(b){var c={business_sys_name:z,syspublish_id:A,project_bk_evaluate:"未评价",rollback_flag:a.info.proj_info.project_status,evaluate_user_cn_name:"",notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""};j.editRollbackSummary(c).then(function(a){},function(a){})}))),-1==a.control.curr._phase){var n=a.info.instance_info.steps[a.info.instance_info.steps.length-1],q=n.phase_list[n.phase_list.length-1];if(a.info.phase_node_info.phase_no=q.phase_no,a.info.phase_node_info.phase_status=q.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=q.parallel_flag,a.info.phase_node_info.nodes_info.node_list)for(var l=0;l<a.info.phase_node_info.nodes_info.node_list.length;l++)a.info.phase_node_info.nodes_info.node_list[l].is_show=!1;q.node_list?(a.info.phase_node_info.nodes_flag=!1,P(q.node_list)):a.info.phase_node_info.nodes_flag=!0,q.is_check=!0}o.bindCurrPhaseAndStep(a.control.curr._phase,a.info.instance_info.steps,a.control.curr),o.pushAllCanResetPhase(a.info.instance_info.steps,a.info.reset_phases),e(function(){a.control.code_mirror_control=!0,-1!=a.control.curr._phase&&H&&J(a.control.curr._phase)},200),b.interact_flag&&2==b.current_phase_status&&(x&&f.cancel(x),w&&f.cancel(w),0==G&&(6===b.impl_type?r.interactiveExecute(v,b.phase_bk_desc).then(function(b){b&&(a.control.curr._load=!1,a.control.exec_btn={phase:!0,auto:!0,skip:!0},O(),G=0,H=!0)}):r.interactOperation(v,a.control.curr._phase,a.info.instance_info.steps).then(function(b){b?(a.control.curr._load=!1,a.control.exec_btn={phase:!0,auto:!0,skip:!0},O()):j.stopByStep(v).then(function(b){b&&(a.control.curr._load=!1,a.control.exec_btn={phase:!1,auto:!1,skip:!0},O(),r.alert("停止成功",2),x&&f.cancel(x),w&&f.cancel(w))},function(a){r.alert(a.message,3),O(),x&&f.cancel(x),w&&f.cancel(w)}),G=0,H=!0})),G++)}},function(a){})},P=function(b){for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<a.info.phase_node_info.nodes_info.node_list.length;e++){var f=a.info.phase_node_info.nodes_info.node_list[e];d.exec_node_ip==f.exec_ip&&(f.is_show=!0,f.exec_node_ip=d.exec_node_ip,f.exec_protocol_type=d.exec_protocol_type,f.exec_soc_name=d.exec_soc_name,f.exe_msg=d.exe_msg,f.impl_type=d.impl_type,f.is_exec=d.is_exec,f.node_status=d.node_status,f.node_exec_seq=d.node_exec_seq,f.reset_flag=d.reset_flag,f.support_node_ip=d.support_node_ip?d.support_node_ip:"",f.support_protocol_type=d.support_protocol_type?d.support_protocol_type:"",f.support_soc_name=d.support_soc_name?d.support_soc_name:"",f.file_list=d.file_list?d.file_list:[])}},Q=function(a,b){j.monitorNodeMsg(z,a).then(function(c){c&&(b.node_monitor_msg=c.monitor_result_list?c.monitor_result_list:[],b.show_detail&&e(function(){Q(a,b)},5e3))},function(c){b.show_detail&&e(function(){Q(a,b)},5e3)})},R=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];b?d.show_detail=!1:d.is_show||(d.show_detail=!1)}},S=function(){j.canExec(z,A).then(function(b){a.control.is_Exec=!0},function(b){a.control.is_Exec=!1,r.confirm(b.message+" 是否离开当前界面").then(function(){1==a.control.is_quick_publish?c.go("agile_pub_list"):c.go("routine_release")})})},T=function(b,c){r.summary(b,c).then(function(b){M(),a.control.exec_btn={phase:!1,step:!1,reset:!1}})},U=function(b,c){W(V(),function(){a.control.curr._load=!0,H=!1,c?a.control.exec_btn={phase:!0,auto:!0,skip:!1}:a.control.exec_btn={phase:!1,auto:!0,skip:!0},1==a.info.exec_type?(a.info.proj_info.project_status=3,a.info.proj_info.project_status_cn=u.findValue(3,k)):(a.info.proj_info.project_status=6,a.info.proj_info.project_status_cn=u.findValue(6,k)),w=f(function(){O()},2e3),j.execByPhase(v,b,c).then(function(b){b&&(b.interact_flag?f.cancel(w):(O(),a.control.curr._load=!1,H=!0,f.cancel(w),a.info.proj_info.prolog_path||M()))},function(b){a.control.curr._load=!1,r.alert(b.message,3),a.control.exec_btn={phase:!0,auto:!0,skip:!0},O(),f.cancel(w)})})},V=function(){return D=3==a.info.proj_info.project_status||6==a.info.proj_info.project_status?!0:!1,D?!1:a.control.can_exec?!0:!1},W=function(a,b){a?j.excuteLocalAuthor(A).then(function(a){D=!0,b()},function(a){r.alert(a.message,3)}):b()},X=function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<c.phase_list.length;d++)c.phase_list[d].is_check=!1},Y=function(){1==B&&(a.control.curr._load=!0,x=f(function(){M(),O()},5e3),M(),O(),a.$watch("info.proj_info",function(a,b){var c=a.project_status;c>3&&6!=c&&x&&f.cancel(x)},!0)),N(),1==a.info.exec_type?S():a.control.is_Exec=!0,j.getInstanceImportPath().then(function(b){a.config.import_fileupload.uploadpath=b.instance_import_dir?b.instance_import_dir:""},function(a){r.alert(a.message,3)}),$("body").addClass("over_flow_y")};a.backToQuickProj=function(){r.confirm("确定要关闭敏捷发布项目并返回发布页？").then(function(){1==a.info.exec_type&&(a.control.curr._load=!1,j.shutDownQuickProj(z,A,2).then(function(a){a&&c.go("agile_pub_pre",{modify_flag:2,proj_name:A,sys_name:z})},function(a){r.alert(a.message,3)}))})},a.downloadFile=function(a){u.downloadFile(a)},a.execByPhase=function(b,c,d){E=!0;var e=1==d?!1:!0;e?r.confirm("是否要跳过[#"+a.control.curr._phaseDesc+"]阶段").then(function(){U(b,e)}):U(b,e)},a.execAuto=function(b){W(V(),function(){E=!0,a.control.curr._load=!0,H=!0,a.control.exec_btn={phase:!0,auto:!1,skip:!0},1==a.info.exec_type?(a.info.proj_info.project_status=3,a.info.proj_info.project_status_cn=u.findValue(3,k)):(a.info.proj_info.project_status=6,a.info.proj_info.project_status_cn=u.findValue(6,k)),w=f(function(){O()},3e3),j.autoExecByphase(v,b).then(function(b){b&&(a.control.curr._load=!1,O(),f.cancel(w),a.info.proj_info.prolog_path||M())},function(b){a.control.curr._load=!1,r.alert(b.message,3),a.control.exec_btn={phase:!0,auto:!0,skip:!0},O(),f.cancel(w)})})},a.scollToResetPhase=function(b){a.control.reset_id=b,J(b)},a.cancelResetPhase=function(){a.control.reset_id=0,J(a.control.curr._phase)},a.resetPhase=function(b){r.confirm("确定要重置到阶段["+b.phase_bk_desc+"]?").then(function(){j.resetPhase(b.phase_no,v).then(function(b){e(function(){E=!0,F=0,H=!0,a.control.show_prod_error=!1,a.control.exec_btn={phase:!0,auto:!0,skip:!0},O()},0)},function(a){r.alert(a.message,3)})})},a.pauseRunning=function(){r.confirm("是否要暂停正在执行的阶段?").then(function(){j.execPauseRunning(v).then(function(b){b&&(O(),r.alert("暂停成功",2),a.control.curr._load=!1,a.control.exec_btn={phase:!0,auto:!0,skip:!0},x&&f.cancel(x),w&&f.cancel(w))},function(a){r.alert(a.message,3),O(),x&&f.cancel(x),w&&f.cancel(w)})})},a.stopRunning=function(){r.confirm("是否要停止"+a.control.curr._phaseDesc+"的阶段?").then(function(){j.stopByStep(v).then(function(b){b&&(a.control.curr._load=!1,a.control.exec_btn={phase:!1,auto:!1,skip:!0},O(),r.alert("停止成功",2),x&&f.cancel(x),w&&f.cancel(w))},function(a){r.alert(a.message,3),O(),x&&f.cancel(x),w&&f.cancel(w)})})},a.showSummary=function(){T(A,z)},a.showRollbackSummary=function(){K(A,z,a.info.proj_info.project_status)},a.shutDown=function(){r.confirm("确定要手动结束当前执行项目？").then(function(){if(1==a.info.exec_type)if(a.control.curr._load=!1,1==a.control.is_quick_publish)j.shutDownQuickProj(z,A,2).then(function(b){b&&(M(),a.control.exec_btn={phase:!1,step:!1,reset:!1})},function(a){r.alert(a.message,3)});else{var b={business_sys_name:z,syspublish_id:A,prod_flag:a.control.show_prod_error?2:1,problem_type_list:[],project_evaluate_list:[],project_bk_evaluate:"未评价",project_evaluate:{},
notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""};j.summaryProd(b).then(function(b){M(),a.control.exec_btn={phase:!1,step:!1,reset:!1}},function(a){})}else{a.info.proj_info.project_status=8,a.control.exec_btn={phase:!1,auto:!1,skip:!1},a.control.curr._load=!1;var c={business_sys_name:z,syspublish_id:A,project_bk_evaluate:"未评价",rollback_flag:a.info.proj_info.project_status,evaluate_user_cn_name:"",notice_type:1,notice_users:[],user_cn_name:"",feedback_msg:""};j.editRollbackSummary(c).then(function(a){},function(a){})}})},a.toggleMinimize=function(){e(function(){var b=C.height(),c=$("#consoleDesk");a.control.is_log_minisize=!a.control.is_log_minisize,c.css("height",25==c.height()?"200":"25"),a.control.is_log_minisize?C.css("height",b+180):C.css("height",b-200+20)},10)},a.importInstance=function(){var b=a.config.import_fileupload.uploadpath+a.config.import_fileupload.filename;j.importInstance(v,b).then(function(b){Y(),a.control.exec_btn={phase:!0,auto:!0,skip:!0},a.control.show_prod_error=!1},function(a){r.alert(a.message,3)})},a.exportInstance=function(){j.getInstanceFullPath(v).then(function(a){if(a.instance_full_path){var b=a.instance_full_path;u.downloadFile(b)}},function(a){r.alert(a.message,3)})},a.changeTime=function(){a.control.show_plan_time=!0},a.resetTime=function(){a.control.show_plan_time=!1},a.chooseNodeConfig=function(b,c,d,f){E=!1,X(f),d.is_check=!0,a.control.get_nodes_loading=!0,e(function(){if(a.info.phase_node_info.nodes_info.node_list)for(var d=0;d<a.info.phase_node_info.nodes_info.node_list.length;d++)a.info.phase_node_info.nodes_info.node_list[d].is_show=!1;f[b].phase_list[c].node_list?(a.info.phase_node_info.nodes_flag=!1,P(f[b].phase_list[c].node_list),R(a.info.phase_node_info.nodes_info.node_list,!1)):(a.info.phase_node_info.nodes_flag=!0,R(a.info.phase_node_info.nodes_info.node_list,!0)),a.info.phase_node_info.phase_no=f[b].phase_list[c].phase_no,a.info.phase_node_info.phase_status=f[b].phase_list[c].phase_status,a.info.phase_node_info.nodes_info.parallel_flag=f[b].phase_list[c].parallel_flag,a.info.phase_node_info.nodes_info.node_list&&(a.info.phase_node_info.nav_show_flag=p.judgeShowDetail(a.info.phase_node_info.nodes_info.node_list),a.info.phase_node_info.expand_flag=2==a.info.phase_node_info.nav_show_flag?!0:!1),a.control.get_nodes_loading=!1},500)},a.configNode=function(b,c){r.configExeNode(b,a.control.is_quick_publish).then(function(b){a.info.phase_node_info.nodes_info=b,a.info.phase_node_info.phase_no=c.phase_no,j.savePhaseExecNodeInfo(v,c.phase_no,b.node_list,b.parallel_flag).then(function(c){for(var d=0;d<a.info.instance_info.steps.length;d++)for(var e=a.info.instance_info.steps[d],f=0;f<e.phase_list.length;f++)b.phase_no==e.phase[f].phase_no&&(e.phase[f]=a.info.phase_node_info.nodes_info)},function(a){r.alert(a.message,3)})})},a.toggleNodeExecInfo=function(a,b){a.show_detail=!a.show_detail,b.nav_show_flag=p.judgeShowDetail(b.nodes_info.node_list),b.expand_flag=2==b.nav_show_flag?!0:!1,a.show_detail&&Q(a.exec_node_ip,a)},a.expandAllNode=function(a){a.nav_show_flag=p.expandAllModules(a.nodes_info.node_list);for(var b=0;b<a.nodes_info.node_list.length;b++){var c=a.nodes_info.node_list[b];c.show_detail&&c.is_show&&!function(a,b){Q(a,b)}(c.exec_node_ip,c)}},a.closeAllNode=function(a){a.nav_show_flag=p.closeAllModules(a.nodes_info.node_list)},a.getProtocolTypeCnName=function(a){return u.findValue(a,q).substring(0,5).toLowerCase()},a.changeResult=function(b,c){r.execResultChange(b).then(function(d){j.handEditExecNodeInfo(v,c.nodes_info.phase_no,b.exec_node_ip,d.msg).then(function(b){O(),a.control.exec_btn={phase:!0,auto:!0,skip:!0},a.control.show_prod_error=!1},function(a){r.alert(a.message,3)})})},d.$on("$stateChangeSuccess",function(b,c,d,e,g){f.cancel(w),1==a.control.is_quick_publish?"agile_pub_exe"!=e.name&&f.cancel(y):"pub_exec"!=e.name&&f.cancel(y),R(a.info.phase_node_info.nodes_info.node_list,!0),$("body").removeClass("over_flow_y")}),Y(),a.caculateHeight=function(){var b=0;return b=a.control.is_log_minisize?$(window).height()-250-110+180:$(window).height()-250-110,{height:b+"px"}},a.caculateConsoleWidth=function(){var a=$("#codePanel").width();return{width:a+"px"}},a.caculateConsoleWidth=function(){var a=$("#codePanel").width();return{width:a+"px"}}}]),prodCtrl.controller("execConsoleCtrl",["$scope","$stateParams","$rootScope","$timeout","$interval","ProdFunc","Exec","ScrollConfig",function(a,b,c,d,e,f,g,h){var i,j=b.execute_id,k=b.stop_flag;a.info={console_msg:[]},a.config={scroll_console_info:h};var l=function(){d(function(){a.inscrollToBottom("bottom",{scrollEasing:"linear"})},1e3)},m=function(){g.getMonitorExecLogMsg(j).then(function(b){b&&(a.info.console_msg=b.phase?b.phase:[]),f.formatCmdStatus(a.info.console_msg),l()})},n=function(){m(),1!=k&&e.cancel(i)};c.$on("$stateChangeSuccess",function(){e.cancel(i)}),n()}]),prodCtrl.controller("submitModalCtrl",["$scope","$modalInstance","$state","Message","Exec","Modal",function(a,b,c,d,e,f){a.message="正在提交准备信息...",e.saveReadyInfo(d).then(function(a){a&&(b.close(!0),f.prepareChoose(d.syspublish_id,d.sys_id).then(function(a){1==a?c.go("pub_exec",{sys_publish_id:d.syspublish_id,sys_id:d.sys_id,exec_type:1,quick_pub_flag:2,auto_yn_flag:2,path_flag:1}):c.go("routine_release")}))},function(a){f.alert(a.message,3),b.close(!1)})}]),pCtrl.controller("agileReleaseListCtrl",["$scope","$state","$timeout","Modal","CV",function(a,b,c,d,e){a.goToQuickProd=function(){b.go("agile_pub_pre",{modify_flag:1,proj_name:"",sys_name:""})}}]),prodCtrl.controller("agilePubPreCtrl",["$scope","$state","$stateParams","$timeout","$sce","$modal","BusiSys","Proj","Exec","ProjectNature","ProtocolType","CodeMirrorOption","CmptFunc","BsysFunc","ProdFunc","Collection","Project","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u,v=c.modify_flag,w="",x="",y=[];a.info={pre_info:{register_flag:2,business_sys_name:"",project_id:"",environment_id:"",upload_flag:2,version_soc_name:"",propackage_list:[],group_list:[],param_list:[],config_file_list:[],prog_id:"",prog_info:{}},dir_names:{}},a.data={sys_list:[],project_list:[],program_list:[],env_list:[],node_list:[],ver_soc_list:[],exe_soc_list:[],solid_config_list:[],sub_tabs:[]},a.control={is_selected_busisys:!1,prog_list_loading:!1,prog_loading:!1,detail_prog_flag:!1,valid_prog_complete:!1,valid_prog_loading:!1,get_business_loading:!1,node_list_loading:!1,show_define_config:!1,package_exsit_flag:!1,param_list_flag:!1,pre_info_loading:!1,form:{}},a.config={config_tabs:[{active:!0},{active:!1}],viewOptions:l.Sh(!0)};var z=function(){for(var b=0;b<a.info.pre_info.propackage_list.length;b++){var c=a.info.pre_info.propackage_list[b];if(c.required_flag&&0==c.package_list.length){a.control.package_exsit_flag=!0;break}}return!a.control.package_exsit_flag},A=function(b,c){for(var d=b?b:[],e=0;e<d.length;e++){var f=d[e];f.package_name_list=[],f.package_list=[],f.propackage_full_path=f.propackage_full_path?f.propackage_full_path:[];for(var g=0;g<f.propackage_full_path.length;g++)f.package_name_list.push({propackage_full_path:f.propackage_full_path[g]})}a.info.pre_info.propackage_list=d},B=function(a,b){for(var c=0;c<a.package_name_list.length;c++){var d=a.package_name_list[c];C(d,b,a)}},C=function(b,c,d){d.add_pac_btn_disable=!0,b.is_exsit_loading=!0,b.no_exsit=!1,i.downloadProdListFile(a.info.pre_info.business_sys_name,a.info.pre_info.project_name,a.info.package_info.version_soc_name,b.propackage_full_path).then(function(a){b.is_exsit_loading=!1,d.add_pac_btn_disable=!1},function(a){d.add_pac_btn_disable=!1,b.is_exsit_loading=!1,b.no_exsit=!0,r.alert(a.message,3)})},D=function(b,c){a.control.node_list_loading=!0,i.getDefinePhyInfo(c,b).then(function(b){b&&(a.control.node_list_loading=!1,a.data.node_list=b.phy_node_list?b.phy_node_list:[],o.dealSocList(a.data.node_list))},function(b){r.alert(b.message,3),a.control.node_list_loading=!1})},E=function(b){for(var c=0,d=0;d<b.length;d++){var e=b[d];3!=e.param_type&&c++}0==c&&(a.control.param_list_flag=!0)},F=function(a,b){var c=a;c=c.length>1&&c.lastIndexOf("/")==c.length-1?c.slice(0,c.length-1):c;var d=c.lastIndexOf("/");c?-1==d?b.paths=[c]:1==c.length&&0==d?b.paths=["/"]:0==d?b.paths=[c.slice(1)]:b.paths=c.slice(1).split("/"):b.paths=[]},G=function(){a.control.get_business_loading=!0,g.getAllBusinessSys(!0).then(function(b){d(function(){b&&(a.control.get_business_loading=!1,a.data.sys_list=b.list_bs?b.list_bs:[])},0)},function(b){a.control.get_business_loading=!1,r.alert(b.message,3)}),i.getQuickProjectName().then(function(a){d(function(){a&&(t=a.syspublish_id)},0)},function(a){r.alert(a.message,3)})};a.loadPlusFormData=function(b){u=b,a.control.is_selected_busisys=!0,a.data.program_list=[],a.data.env_list=[],a.control.prog_list_loading=!0,a.control.detail_prog_flag=!1,a.info.pre_info.prog_id="",a.info.pre_info.prog_cn_name="",a.info.pre_info.environment_id="",q.getSysProgram(u).then(function(b){a.data.program_list=b.program_list_publish||[],a.data.env_list=b.env_list||[],a.control.prog_list_loading=!1},function(b){a.control.prog_list_loading=!1,r.alert(b.message,3)})},a.selectProgram=function(b){return 2==v&&1==a.data.program_list.length?!1:(a.info.pre_info.prog_id=b,a.control.show_define_config=!1,a.data.solid_config_list=[],a.data.modify_define_file_list=[],a.info.pre_info.propackage_list=[],a.info.pre_info.config_file_list=[],a.control.pre_info_loading=!0,void i.getQuickProjectPac(u,t,a.info.pre_info.environment_id,b).then(function(b){d(function(){if(b){var c=[];a.info.prepare_msg=b.prepare_msg,a.info.dir_names=b.dir_names||{},a.info.publish_type=b.publish_type,a.info.pre_info.version_soc_name=b.version_soc_name?b.version_soc_name:"",a.info.pre_info.upload_flag=3==b.publish_type?3:b.version_soc_name?2:1,a.info.pre_info.channel_name=b.channel_name||"",w=b.dftpropac_bk_dir,x=b.file_upload_path,a.info.pre_info.prolist_full_path=b.prolist_full_path?b.prolist_full_path:"",A(b.prepare_msg.pac_type_list),a.info.pre_info.param_list=b.prepare_msg.param_list?b.prepare_msg.param_list:[],E(a.info.pre_info.param_list),a.info.pre_info.group_list=b.prepare_msg.group_list?b.prepare_msg.group_list:[],n.processProgDate(a.info.pre_info.group_list,b.prepare_msg.pac_type_list,b.prepare_msg.config_file_list),a.info.pre_info.prog_id=b.prepare_msg.prog_id?b.prepare_msg.prog_id:"",a.info.pre_info.prog_cn_name=b.prepare_msg.prog_cn_name?b.prepare_msg.prog_cn_name:"",a.data.sub_tabs=[];for(var d=0;d<a.info.pre_info.group_list.length;d++)for(var e=a.info.pre_info.group_list[d],f=0;f<e.phase_list.length;f++){var g=e.phase_list[f];if(5==g.phase_type){var h={soc_index:"",node:{path_files:[],checked_files:[],paths:[],init_path:""},impl_type:g.impl_type,phase_type:g.phase_type,phase_name:g.phase_name,phase_no:g.phase_no,modify_define_file_list:[],active:!1};a.data.sub_tabs.push(h),y.push(g)}else 4==g.phase_type&&c.push(g)}0!=a.data.sub_tabs.length&&(a.control.custom_config_flag=!0,a.data.sub_tabs[0].active=!0,D(a.info.pre_info.environment_id,u)),0!=c.length&&(a.data.solid_config_list=o.processConfigData(c)),a.control.pre_info_loading=!1}},0)},function(b){a.control.pre_info_loading=!1,r.alert(b.message,3)}))},a.changeFileFlag=function(b){a.info.pre_info.upload_flag=b,a.control.validate_pac=!1,2==b&&(a.control.is_prolist_add=!1),angular.forEach(a.info.pre_info.propackage_list,function(a){a.propackage_full_path=a.propackage_full_path?[]:[],a.package_name_list=a.package_name_list?[]:[]})},a.addProdPackage=function(b,c){a.control.validate_pac=!1,3!=c?r.prodPreAddProdPac(w,x,"",b,c,!1,a.info.pre_info).then(function(d){d&&(1==c&&(a.info.pre_info.propackage_list[b].package_name_list=d.dpp_param_info.propackage_list[b].package_name_list,a.info.pre_info.propackage_list[b].propackage_full_path=d.dpp_param_info.propackage_list[b].propackage_full_path,a.info.pre_info.propackage_list[b].package_list=d.dpp_param_info.propackage_list[b].package_list),2==c&&B(a.info.pre_info.propackage_list[b],d),a.control.package_exsit_flag=!1)}):r.prodPreAddProdPacFromPlatform(a.info.dir_names,b,t,a.info.pre_info).then(function(c){a.info.pre_info.propackage_list[b].package_list=c,a.control.package_exsit_flag=!1})},a.removeProdPackage=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(e.package_type==b.package_type){for(var f=0;f<e.package_name_list.length;f++){var g=e.package_name_list[f];if(g.propackage_full_path==c.propackage_full_path){a[d].package_name_list.splice(f,1);break}}for(var f=0;f<e.package_list.length;f++){var h=e.package_list[f];if(h==_tar_name){a[d].package_list.splice(f,1);break}}for(var i=0;i<e.propackage_full_path.length;i++){var j=e.propackage_full_path[i];if(j==c.propackage_full_path){a[d].propackage_full_path.splice(i,1);break}}}}},a.downloadPackage=function(b){var c=x+b.propackage_full_path.substring(b.propackage_full_path.lastIndexOf("/")+1,b.propackage_full_path.length);2==a.info.pre_info.upload_flag?s.downloadFile(c):s.downloadFile(c)},a.getFileList=function(b,c,d){d.file_soc_name=a.data.node_list[b].file_soc_name,d.execute_soc_name=a.data.node_list[b].execute_soc_name,d.execute_ip=a.data.node_list[b].ip,d.agent_user=a.data.node_list[b].agent_user?a.data.node_list[b].agent_user:"",d.init_temp="",d.node.paths=[],d.node.loading=!0,d.node.err_msg="",d.node.init_path="",p.getFileListBySoc(d.file_soc_name,d.node.init_path,d.execute_ip,d.agent_user).then(function(a){d.node.loading=!1,d.init_temp=a.root_bk_dir,d.node.init_path=d.init_temp,F(d.init_temp,d.node),d.node.path_files=a.file_bean_list?a.file_bean_list:[]},function(a){d.node.paths=[],d.node.init_path="",d.node.path_files=[],d.init_temp="",d.node.loading=!1,d.node.err_msg=a.message})},a.changePath=function(b,c){if(b.node.is_dir)b.node.loading=!0,d(function(){p.getFileListBySoc(b.file_soc_name,b.node.full_path,b.execute_ip,b.agent_user).then(function(a){b.node.loading=!1,b.node.path_files=a.file_bean_list?a.file_bean_list:[]},function(a){b.node.paths=[],b.node.loading=!1,b.node.err_msg=a.message})});else{var e=(b.execute_ip+u).replace(/\./g,""),f=b.execute_ip;r.compare(u,t,e,b.node.full_path,b.execute_soc_name,b.file_soc_name,f,!0,5).then(function(d){if(d){var e=b.soc_index,f=a.data.node_list,g=angular.copy(f[e]),h=y[c],i=b.node.full_path;h.phy_nodes=h.phy_nodes||[];for(var j=0;j<h.phy_nodes.length;j++)if(h.phy_nodes[j].ip===g.ip){h.phy_nodes[j].file_list.indexOf(i)<0&&h.phy_nodes[j].file_list.push(i),i=null;break}if(i){var k=angular.extend(g,{file_list:[i]});h.phy_nodes.push(k)}b.phy_nodes=h.phy_nodes}})}},a.showModifyFile=function(b,c,d){var e=c.execute_soc_name,f=(c.ip+u).replace(/\./g,""),g=c.file_soc_name,h=c.ip;r.compare(a.info.pre_info.business_sys_name,t,f,b.file,e,g,h,!0,d.phase_type,d.phase_no).then(function(a){a&&(b.is_modify=!0)})},a.showModifyDefineFile=function(a,b){var c=a.execute_soc_name,d=a.file_soc_name,e=(a.ip+u).replace(/\./g,""),f=a.ip;r.compare(u,t,e,b,c,d,f,!0).then(function(a){})},a.deleteDefineConfigModify=function(a,b,c,d,e){a.stopPropagation(),r.confirm("是否要删除已经修改的配置文件？").then(function(){b.file_list.length>1?b.file_list.splice(c,1):e.phy_nodes.splice(d,1)})},a.toggleModulesDetail=function(b,c){b.show_detail=!b.show_detail,c.nav_show_flag=m.judgeShowDetail(c.phase_list),c.expand_flag=2==c.nav_show_flag?!0:!1,a.control.code_refresh=!1,d(function(){a.control.code_refresh=!0},10)},a.expandCollapseAll=function(b){b.nav_show_flag=m.expandAllModules(b.phase_list),2==b.nav_show_flag&&(a.control.code_refresh=!1,d(function(){a.control.code_refresh=!0},10))},a.colseCollapseAll=function(a){a.nav_show_flag=m.closeAllModules(a.phase_list)},a.getProtocolTypeCnName=function(a){return s.findValue(a,k).substring(0,5).toLowerCase()},a.submitReadyForm=function(){var b=angular.copy(a.info.pre_info);a.info.prepare_msg.pac_type_list=b.propackage_list,a.info.prepare_msg.group_list=b.group_list,a.info.prepare_msg.param_list=b.param_list;var c={syspublish_id:t,business_sys_name:u,prepare_msg:a.info.prepare_msg};return s.valiForm(a.control.form)?0==a.info.pre_info.propackage_list.length||z()?void f.open({templateUrl:"templates/modal/loading_modal.html",controller:"submitQuickModalCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{Message:function(){return c}}}):(r.alert("发布包不能为空！",3),!1):!1},a.quickCancel=function(){b.go("agile_pub_list")},a.paramShellLoaded=function(b){l.setParamsEditor(b),d(function(){a.control.code_reflash=!0},0)},G()}]),prodCtrl.controller("submitQuickModalCtrl",["$scope","$modalInstance","$state","$timeout","Message","Exec","Modal","CV",function(a,b,c,d,e,f,g,h){a.message="正在提交准备信息...",f.saveQuickReadyInfo(e).then(function(a){a&&(g.alert("项目准备成功，项目待执行！",2),b.close(!0)),c.go("agile_pub_exe",{sys_publish_id:e.syspublish_id,sys_id:e.business_sys_name,exec_type:1,quick_pub_flag:1,auto_yn_flag:2,path_flag:1})},function(a){g.alert(a.message,3),b.close(!1)})}]),pCtrl.controller("routineReleaseCtrl",["$scope","$state","$timeout","Project","Exec","Modal","CV",function(a,b,c,d,e,f,g){var h=[];a.info={key_word:"",error_msg:""},a.data={prepare_list:[]},a.control={get_list_loading:!1,wait_pub_choose_flag:!0,pub_exec_choose_flag:!0,pub_finish_choose_flag:!1};var i=function(b,c){var e=b?b:"";a.info.error_msg="",a.control.get_list_loading=!0,d.getPrepareList(e,c).then(function(b){if(b&&(a.data.prepare_list=b.publish_list?b.publish_list:[],a.control.get_list_loading=!1,a.data.prepare_list.length>1))for(var c=a.data.prepare_list[0].publish_date,d=1;d<a.data.prepare_list.length;d++)c==a.data.prepare_list[d].publish_date?a.data.prepare_list[d].publish_date="":c=a.data.prepare_list[d].publish_date},function(b){f.alert(b.message,3),a.control.get_list_loading=!1,a.info.error_msg=b.message})},j=function(){h=[1,2],i("",h)};a.getListByStatus=function(b){var c=[];1==b&&(a.control.wait_pub_choose_flag=!a.control.wait_pub_choose_flag),2==b&&(a.control.pub_exec_choose_flag=!a.control.pub_exec_choose_flag),3==b&&(a.control.pub_finish_choose_flag=!a.control.pub_finish_choose_flag),a.control.wait_pub_choose_flag&&c.push(1),a.control.pub_exec_choose_flag&&c.push(2),a.control.pub_finish_choose_flag&&c.push(3),h=0!=c.length?c:[1,2,3],i(a.info.key_word,h)},a.searchPrepareListByKeyword=function(a){i(a,h)},a.viewPublishApplication=function(a){b.go("view_application",{application_id:a.pjpublish_id})},a.showSecondaryOperation=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.sys_publish_list)for(var e=0;e<d.sys_publish_list.length;e++)d.sys_publish_list[e].operation_flag=!1}a.operation_flag=!0},a.goToSingleMonitor=function(a){b.go("monitor_detail",{sys_publish_id:a.syspublish_id,sys_id:a.business_sys_name,sys_status:a.sys_publish_status,quick_pub_flag:2})},a.goPrepare=function(a){b.go("pub_pre",{sys_publish_id:a.syspublish_id,sys_id:a.business_sys_name,path_flag:1})},a.goToExec=function(a){var c=6==a.sys_publish_status||9==a.sys_publish_status?2:1;b.go("pub_exec",{sys_publish_id:a.syspublish_id,sys_id:a.business_sys_name,exec_type:c,quick_pub_flag:2,auto_yn_flag:2,path_flag:1})},a.goToRollback=function(a){f.chooseRollbackProg(a.business_sys_name,a.syspublish_id).then(function(c){b.go("pub_exec",{sys_publish_id:a.syspublish_id,sys_id:a.business_sys_name,exec_type:2,quick_pub_flag:2,auto_yn_flag:2,path_flag:1})})},a.goToPubDetail=function(a){b.go("proj_detail_pre",{publish_id:a.syspublish_id,sys_id:a.business_sys_name})},a.resetPublish=function(a){e.reSet(a.syspublish_id).then(function(a){i("",h)},function(a){f.alert(a.message,3)})},j()}]),pCtrl.controller("viewPubApplicationCtrl",["$scope","$state","$stateParams","$timeout","Project","Modal","CV",function(a,b,c,d,e,f,g){var h=c.application_id;a.info={apply_info:{}},a.data={},a.control={};var i=function(){e.viewReleaseApply(h).then(function(b){d(function(){a.info.apply_info.pjpublish_name=b.publish_bean.pjpublish_name,a.info.apply_info.pjpublish_desc=b.publish_bean.pjpublish_desc,a.info.apply_info.execute_type=b.publish_bean.execute_type,a.info.apply_info.pjpublish_id=b.publish_bean.pjpublish_id,a.info.apply_info.pjpublish_date=b.publish_bean.pjpublish_date,a.info.apply_info.pjpublish_time=b.publish_bean.pjpublish_time,a.info.apply_info.publish_proj_list=b.publish_bean.pjpublish_project_list||[]},0)},function(a){f.alert(a.message,3)})};i()}]);var planCtrl=angular.module("PlanController",[]);planCtrl.controller("projPlanListCtrl",["$scope","$timeout","$state","$modal","Plan","Modal","CV",function(a,b,c,d,e,f,g){a.info={items:[]},a.control={tab_type:0},a.getPlanData=function(){var c=g.dtFormat(g.dateCalculate(new Date,"dd",-1));e.getPlan(c).then(function(c){b(function(){a.info.items=c.list_pjplancal?c.list_pjplancal:[];for(var b=0;b<a.info.items.length;b++)a.info.items[b].total_plan_list=[],a.info.items[b].number_plan=100*a.info.items[b].number_manual/(a.info.items[b].number_manual+a.info.items[b].number_auto),a.info.items[b].show=!1;0!=a.info.items.length&&(a.info.items[0].show=!0)},0)},function(a){f.alert(a.message,3)})};var h=function(){a.getPlanData()};a.changeTabState=function(a){c.go(a)},h()}]),planCtrl.controller("projPreListCtrl",["$scope","$timeout","$state","$modal","Plan","Modal","CV",function(a,b,c,d,e,f,g){a.info={pre_items:[]},a.control={tab_type:1};var h=function(){e.getPreGroupNumberList().then(function(c){b(function(){a.info.pre_items=c.group_number_list?c.group_number_list:[],0!=a.info.pre_items.length&&(a.info.pre_items[0].show=!0);for(var b=1;b<a.info.pre_items.length;b++)a.info.pre_items[b].show=!1},0)},function(a){f.alert(a.message,3)})},i=function(){h()};a.changeTabState=function(a){c.go(a)},i()}]),planCtrl.controller("projGroupListCtrl",["$scope","$timeout","$state","$stateParams","$modal","Plan","Monitor","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j,k=i.dtFormat(new Date);a.info={group_items:[],group_date:k},a.control={read_only:!1,tab_type:2};var l=function(a,b,c){h.editGroup(a,b,c).then(function(a){n()})},m=function(){h.newGroup().then(function(){n()})},n=function(){f.getGroupList().then(function(c){b(function(){a.info.group_items=c.group_id_list?c.group_id_list:[];for(var b=1;b<a.info.group_items.length;b++)a.info.group_items[b].show=!1;0!=a.info.group_items.length&&(a.info.group_items[0].show=!0)},0)},function(a){h.alert(a.message,3)})},o=function(a,b){for(var c=1,d=[],e=0;e<a.proj_list.length;e++){var f=a.proj_list[e],g={category:"OfNodes",isGroup:!0,key:c};c++,b.nodeLinkData.nodeDataArray.push(g);for(var h=void 0,i=0;i<f.phase_list.length;i++){b.node_length=b.node_length>i+1?b.node_length:i+1;var j=f.phase_list[i],k="";k=new Date((new Date).toLocaleDateString()).getTime()<new Date(f.start_date).getTime()?"今日":"昨天";var l={key:c,test:j.phase_cn_name,isGroup:!0,category:"OfGroups",time:0==i?f.start_time:i==f.phase_list.length-1?f.end_time:"",date_flag:0==i?k:"",group:g.key};if(c++,2==j.phase_status){var m={key:c,group:l.key,category:"executing",slices:[{start:-90,sweep:360,color:"#CCC",radius:20,center:20},{start:-90,sweep:3.6*j.phase_dynamic,color:"#2196f3",radius:20,center:20},{start:-90,sweep:360,color:"#fafafa",radius:16,center:20}],row:e+1,col:i+1};c++}else{var m={key:c,group:l.key,category:"noExecute",row:e+1,col:i+1,status:j.phase_status};c++}if(j.rely_list&&0!=j.rely_list.length)for(var n=0;n<j.rely_list.length;n++){var o=j.rely_list[n];d.push({to:m.key,proj_name:o.pre_proj_name,phase_id:o.pre_phase_name,to_row:n+1,to_col:i+1})}b.nodeLinkData.nodeDataArray.push(l),b.nodeLinkData.nodeDataArray.push(m),0!=i&&b.nodeLinkData.linkDataArray.push({from:h,to:m.key,statue:j.phase_status,extra_flag:!1}),h=m.key}}for(var e=0;e<d.length;e++)for(var p=0,i=0;i<a.proj_list.length;i++){p++;for(var f=a.proj_list[i],q=0;q<f.phase_list.length;q++)p+=2,f.proj_name==d[e].proj_name&&f.phase_list[q].phase_id==d[e].phase_id&&b.nodeLinkData.linkDataArray.push({to:d[e].to,from:p,statue:f.phase_list[q].phase_status,extra_flag:!0,to_row:d[e].to_row,to_col:d[e].to_col,from_row:i+1,from_col:q+1})}b.old_linkData=angular.copy(b.nodeLinkData.linkDataArray),b.loadingData=!0},p=function(a){g.getPjGroupToProcessMsg(j).then(function(b){a.group=b.process_list[0],o(a.group,a)},function(b){a.loading_error=!0})},q=function(){n()};a.changeTabState=function(a){c.go(a)},a.editGroup=function(a,b,c){a.stopPropagation(),l(b,c,k)},a.newGroup=function(){m()},a.editProcess=function(a,b,c,d){d.node_length=0,d.nodeLinkData={nodeDataArray:[],linkDataArray:[]},d.phase={},d.loadingData=!1,d.group={},j=b,p(d),d.show&&a.stopPropagation()},a.saveProcess=function(a,b){for(var c=[],d=0;d<a.nodeLinkData.linkDataArray.length;d++)if(!a.nodeLinkData.linkDataArray[d].statue||a.nodeLinkData.linkDataArray[d].extra_flag){for(var e={},f=0;f<a.nodeLinkData.nodeDataArray.length;f++)a.nodeLinkData.linkDataArray[d].from==a.nodeLinkData.nodeDataArray[f].key&&(e.row_from=a.nodeLinkData.nodeDataArray[f].row,e.col_from=a.nodeLinkData.nodeDataArray[f].col),a.nodeLinkData.linkDataArray[d].to==a.nodeLinkData.nodeDataArray[f].key&&(e.row_to=a.nodeLinkData.nodeDataArray[f].row,e.col_to=a.nodeLinkData.nodeDataArray[f].col);e.row_from&&e.row_to&&c.push(e)}for(var i=0;i<a.group.proj_list.length;i++)for(var j=0;j<a.group.proj_list[i].phase_list.length;j++)a.group.proj_list[i].phase_list[j].rely_list&&(a.group.proj_list[i].phase_list[j].rely_list=[]);for(var k=0;k<c.length;k++){var l=a.group.proj_list[c[k].row_from-1].proj_name,m=a.group.proj_list[c[k].row_from-1].business_sys_name,n=a.group.proj_list[c[k].row_from-1].phase_list[c[k].col_from-1].phase_id;a.group.proj_list[c[k].row_to-1].phase_list[c[k].col_to-1].rely_list||(a.group.proj_list[c[k].row_to-1].phase_list[c[k].col_to-1].rely_list=[]),a.group.proj_list[c[k].row_to-1].phase_list[c[k].col_to-1].rely_list.push({pre_proj_name:l,pre_phase_name:n,pre_sys_name:m})}a.process_loading=!0,g.savePjToProcess(a.group).then(function(b){a.process_loading=!1,h.alert("流程保存成功！",2)},function(b){a.process_loading=!1,h.alert(b.message,3)})},a.projStyle=function(a){return{position:"absolute",width:"124px",top:145*a+"px"}},q()}]),planCtrl.controller("projPlanHistoryCtrl",["$scope","$timeout","Plan","Modal","CV",function(a,b,c,d,e){a.info={his_plan_items:{}};var f=function(){c.getHistoryplan(e.dtFormat(new Date)).then(function(c){b(function(){a.info.his_plan_items=c.query_plan_list?c.query_plan_list:[],0!=a.info.his_plan_items.length&&(a.info.his_plan_items[0].show=!0);for(var b=1;b<a.info.his_plan_items.length;b++)a.info.his_plan_items[b].show=!1},0)},function(a){d.alert(a.message,3)})};f()}]),planCtrl.controller("planModalCtrl",["$scope","$modalInstance","Plan","TabParams","Modal","CV",function(a,b,c,d,e,f){var g,h=d.project_name,i=d.business_sys_name,j=[],k=[],l=!0;a.info={curr_proj:{},front_proj:{proj_list:[]}},a.control={show_front:!1,hasFrontProj:1,datepicker:{minDate:new Date}};var m=function(b){for(var c=[],d=b?b:[],e=0;e<d.length;e++){var g=d[e];c.push({key:g.project_name+"|"+g.business_sys_name,value:g.project_short_name});var h=g.start_bk_time.split(":");g.time_hour=h[0],g.time_minute=h[1],g.plan_date_time=f.toDate(g.pro_bk_date+" "+g.start_bk_time),g.project_busisys=g.project_name+"|"+g.business_sys_name}a.info.front_proj.proj_list=c,k=d},n=function(){c.queryPlanData(i,h).then(function(b){if(a.info.curr_proj=b.pj_web_plan.pj_plan_info,a.info.curr_proj.group_id||(a.control.show_front=!0),g=f.toDate(b.dtbs_bk_date+" "+b.dtbs_bk_time),a.info.curr_proj.plan_date_time=f.toDate(a.info.curr_proj.pro_bk_date+" "+a.info.curr_proj.start_bk_time),j=b.pj_web_plan.behind_plan_list?b.pj_web_plan.behind_plan_list:[],j.length>0&&(j[0].plan_date_time=f.toDate(j[0].pro_bk_date+" "+j[0].start_bk_time)),a.info.front_proj=b.pj_web_plan.front_plan_info?b.pj_web_plan.front_plan_info:{},a.control.hasFrontProj=b.pj_web_plan.front_plan_info?1:2,a.info.front_proj.project_name){var d=a.info.front_proj.start_bk_time.split(":");return a.info.front_proj.time_hour=d[0],a.info.front_proj.time_minute=d[1],a.info.front_proj.project_busisys=a.info.front_proj.project_name+"|"+a.info.front_proj.business_sys_name,a.info.front_proj.plan_date_time=f.toDate(a.info.front_proj.pro_bk_date+" "+a.info.front_proj.start_bk_time),c.getPreProjListByDate(h,i,a.info.front_proj.pro_bk_date)}return!1},function(a){e.alert(a.message,3)}).then(function(a){a&&m(a.pj_plan_list),l=!1},function(a){e.alert(a.message,3)})};a.changeCurrPlanTime=function(){var b;b=a.info.curr_proj.pro_bk_date instanceof Date==0?new Date(a.info.curr_proj.pro_bk_date):a.info.curr_proj.pro_bk_date,b.setHours(a.info.curr_proj.plan_date_time.getHours()),b.setMinutes(a.info.curr_proj.plan_date_time.getMinutes()),a.info.curr_proj.plan_date_time=b,a.info.curr_proj.plan_date_time<g&&(e.alert("计划时间不可小于当前时间！",3),a.info.curr_proj.plan_date_time=g),a.info.curr_proj.start_bk_time=f.dttFormat(a.info.curr_proj.plan_date_time)},a.changeFrontProj=function(b){1==b?a.info.front_proj.project_name||(a.info.front_proj.pro_bk_date=f.dtFormat(a.info.curr_proj.pro_bk_date)):a.info.front_proj={},a.control.hasFrontProj=b},a.$watch("info.front_proj.pro_bk_date",function(b){!l&&b&&(a.info.front_proj.project_busisys="",a.info.front_proj.start_bk_time="",a.info.front_proj.project_name="",c.getPreProjListByDate(h,i,b).then(function(b){b.pj_plan_list?m(b.pj_plan_list):a.info.front_proj.proj_list=[]},function(a){e.alert(a.message,3)}))}),a.selectPreProj=function(b){for(var c=0;c<k.length;c++){var d=k[c];if(d.project_busisys==b){a.info.front_proj.project_name=d.project_name,a.info.front_proj.business_sys_name=d.business_sys_name,a.info.front_proj.start_bk_time=d.start_bk_time,a.info.front_proj.plan_date_time=d.plan_date_time;var e=d.start_bk_time.split(":");a.info.front_proj.time_hour=e[0],a.info.front_proj.time_minute=e[1],a.info.front_proj.project_busisys=d.project_busisys}}},a.formSubmit=function(){return 1!=a.control.hasFrontProj||a.info.front_proj.project_name?a.info.front_proj.project_name&&a.info.curr_proj.plan_date_time<a.info.front_proj.plan_date_time?(e.alert("计划时间早于前置项目，请重新设置！",3),!1):j.length>0&&a.info.curr_proj.plan_date_time>j[0].plan_date_time?(e.alert("计划时间晚于后置项目时间["+f.dtFormat(j[0].plan_date_time)+" "+f.dttFormat(j[0].plan_date_time)+"]，请重新设置！"),!1):(a.btnBus_loading=!0,void c.updatePlan({sysName:a.info.curr_proj.business_sys_name,projName:a.info.curr_proj.project_name,plandate:f.dtFormat(a.info.curr_proj.pro_bk_date),plantime:a.info.curr_proj.start_bk_time,preSysName:a.info.front_proj.business_sys_name,preProjName:a.info.front_proj.project_name,autoYnFlag:a.info.curr_proj.auto_yn_flag}).then(function(a){b.close(!0)},function(b){a.btnBus_loading=!1,e.alert(b.message,3)})):(e.alert("请设置前置项目",3),!1)},a.formCancel=function(){b.dismiss(!1)},n()}]),planCtrl.controller("planSysSetCtrl",["$scope","$timeout","$state","$stateParams","$modal","Plan","Monitor","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=d.publish_id;console.log(j),a.info={item:{node_length:0,nodeLinkData:{nodeDataArray:[],linkDataArray:[]},phase:{},group:{}},group_date:""},a.control={read_only:!1,data_loading:!1,process_loading:!1},a.data={publish_list:[]};var k=function(a,b){for(var c=1,d=[],e=0;e<a.proj_list.length;e++){var f=a.proj_list[e],g={category:"OfNodes",isGroup:!0,key:c};c++,b.nodeLinkData.nodeDataArray.push(g);for(var h=void 0,i=0;i<f.phase_list.length;i++){b.node_length=b.node_length>i+1?b.node_length:i+1;var j=f.phase_list[i],k={key:c,test:j.phase_cn_name,isGroup:!0,category:"OfGroups",time:0==i?f.start_time:i==f.phase_list.length-1?f.end_time:"",group:g.key};if(c++,2==j.phase_status){var l={key:c,group:k.key,category:"executing",slices:[{start:-90,sweep:360,color:"#CCC",radius:20,center:20},{start:-90,sweep:3.6*j.phase_dynamic,color:"#2196f3",radius:20,center:20},{start:-90,sweep:360,color:"#fafafa",radius:16,center:20}],row:e+1,col:i+1};c++}else{var l={key:c,group:k.key,category:"noExecute",row:e+1,col:i+1,status:j.phase_status};c++}if(j.rely_list&&0!=j.rely_list.length)for(var m=0;m<j.rely_list.length;m++){var n=j.rely_list[m];d.push({to:l.key,business_sys_name:n.pre_sys_name,phase_id:n.pre_phase_id,to_row:m+1,to_col:i+1})}b.nodeLinkData.nodeDataArray.push(k),b.nodeLinkData.nodeDataArray.push(l),0!=i&&b.nodeLinkData.linkDataArray.push({from:h,to:l.key,statue:j.phase_status,extra_flag:!1
}),h=l.key}}for(var e=0;e<d.length;e++)for(var o=0,i=0;i<a.proj_list.length;i++){o++;for(var f=a.proj_list[i],p=0;p<f.phase_list.length;p++)o+=2,f.business_sys_name==d[e].business_sys_name&&f.phase_list[p].phase_id==d[e].phase_id&&b.nodeLinkData.linkDataArray.push({to:d[e].to,from:o,statue:f.phase_list[p].phase_status,extra_flag:!0,to_row:d[e].to_row,to_col:d[e].to_col,from_row:i+1,from_col:p+1})}b.old_linkData=angular.copy(b.nodeLinkData.linkDataArray)},l=function(b){a.control.data_loading=!0,f.getProjectPlanInfo(j).then(function(c){c&&(console.log(c),b.group={proj_list:c.pubProSys_list?c.pubProSys_list:[]},k(b.group,b),a.control.data_loading=!1)},function(b){a.control.data_loading=!1,a.control.data_loading_error=!0,h.alert(b.message,3)})},m=function(){l(a.info.item)};a.saveProcess=function(b){for(var d=[],e=0;e<b.nodeLinkData.linkDataArray.length;e++)if(!b.nodeLinkData.linkDataArray[e].statue||b.nodeLinkData.linkDataArray[e].extra_flag){for(var g={},i=0;i<b.nodeLinkData.nodeDataArray.length;i++)b.nodeLinkData.linkDataArray[e].from==b.nodeLinkData.nodeDataArray[i].key&&(g.row_from=b.nodeLinkData.nodeDataArray[i].row,g.col_from=b.nodeLinkData.nodeDataArray[i].col),b.nodeLinkData.linkDataArray[e].to==b.nodeLinkData.nodeDataArray[i].key&&(g.row_to=b.nodeLinkData.nodeDataArray[i].row,g.col_to=b.nodeLinkData.nodeDataArray[i].col);g.row_from&&g.row_to&&d.push(g)}for(var k=0;k<b.group.proj_list.length;k++)for(var l=0;l<b.group.proj_list[k].phase_list.length;l++)b.group.proj_list[k].phase_list[l].rely_list&&(b.group.proj_list[k].phase_list[l].rely_list=[]);for(var m=0;m<d.length;m++){var n=b.group.proj_list[d[m].row_from-1].publish_program_id,o=b.group.proj_list[d[m].row_from-1].business_sys_name,p=b.group.proj_list[d[m].row_from-1].phase_list[d[m].col_from-1].phase_cn_name,q=b.group.proj_list[d[m].row_from-1].phase_list[d[m].col_from-1].phase_id;b.group.proj_list[d[m].row_to-1].phase_list[d[m].col_to-1].rely_list||(b.group.proj_list[d[m].row_to-1].phase_list[d[m].col_to-1].rely_list=[]),b.group.proj_list[d[m].row_to-1].phase_list[d[m].col_to-1].rely_list.push({pre_phase_id:q,pre_phase_name:p,pre_sys_name:o,pre_program_id:n})}a.control.process_loading=!0,f.saveProjectPlanInfo(j,b.group.proj_list).then(function(b){a.control.process_loading=!1,h.alert("编排保存成功！",2),c.go("proj_alive")},function(b){a.control.process_loading=!1,h.alert(b.message,3)})},a.projStyle=function(a){return{position:"absolute",width:"124px",top:145*a+"px"}},m()}]),planCtrl.controller("releaseCalendarCtrl",["$scope","$timeout","Plan","PubWindow","Modal","CV",function(a,b,c,d,e,f){a.info={eventSources:[]},a.data={pub_window_list:[]},a.control={},a.uiConfig={calendar:{editable:!1,selectable:!1,eventLimit:3,firstDay:1,showNonCurrentDates:!1,aspectRatio:2.35,header:{left:"title",right:"today prev,next"},buttonText:{today:"今日"},events:function(b,c,h,i){d.getPublishProjectByDate(f.dtFormat(b._d),f.dtFormat(c._d)).then(function(b){if(b.publish_window_list){a.data.pub_window_list=b.publish_window_list?g(b.publish_window_list):[];for(var c=$(".fc-bg td[data-date]"),d=0;d<c.length;d++)for(var e=0;e<b.publish_window_list.length;e++){var f=b.publish_window_list[e];$(c[d]).attr("data-date").toString()==f.open_date&&(2==f.window_status?$(c[d]).css({"background-color":"#46505e",color:"#fff"}):1==f.window_type?$(c[d]).css({"background-color":"#3bb8d5",color:"#fff"}):2==f.window_type&&$(c[d]).css({"background-color":"#E9416E",color:"#fff"}))}i(a.data.pub_window_list)}},function(a){e.alert(a.message,3)})},eventRender:function(a,b,c){b.attr({title:a.title})},eventClick:function(a,b,c){h(a)},loading:function(a,b){}}};var g=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=new Date(d.open_date).getFullYear(),f=new Date(d.open_date).getMonth(),g=new Date(d.open_date).getDate();if(d.sys_publish_list)for(var h=0;h<d.sys_publish_list.length;h++){var i=d.sys_publish_list[h];b.push({title:i.pjpublish_name,allDay:!0,start:new Date(e,f,g),className:"default-event-style",pjpublish_id:i.pjpublish_id,close_reason:d.close_reason})}}return b},h=function(a){e.viewWindowDetail(a)}}]),planCtrl.controller("pubWindowSetCtrl",["$scope","PubWindow","Modal","CV",function(a,b,c,d){a.info={},a.control={};var e=function(){};e()}]);var anaCtrl=angular.module("AnalysisController",["highcharts-ng"]);anaCtrl.controller("regularanalysisCtrl",["$scope","$timeout","Analysis","Charts","Modal","CV",function(a,b,c,d,e,f){var g=(new Date).getFullYear();a.info={yearCount:0,yearSucc:0,yearFail:0,historyYear:g-1,historyYearString:(g-1).toString()+"年度",yearList:[],programCount:0,programSucc:0,programFail:0},a.config={programChartConfig:{},monthChartConfig:{},historyChartConfig:{},dayChartConfig:{}},a.control={show:!0};var h=function(){for(var b=0;10>=b;b++)a.info.yearList.push((g-b).toString()+"年度")},i=function(){c.getProgramData().then(function(c){b(function(){a.info.programCount=c.pro_bk_num,a.info.programSucc=c.success_bk_num,a.info.programFail=c.fail_bk_num;for(var b=[],e=[],f=[],g=c.program_prod_list?c.program_prod_list:[],h=0;h<g.length;h++){var i=g[h],j="";j=i.prog_cn_name?i.prog_cn_name:i.pub_prog_id,b.push(j),e.push(i.success_bk_num),f.push(i.fail_bk_num)}var k={categories:b,success:e,fail:f};a.config.programChartConfig=d.getBarConfig(k)},1e3)},function(a){e.alert(a.message)})},j=function(b,f){c.getYearDataGroupMonth(b).then(function(b){a.info.yearCount=b.prod_sum,a.info.yearSucc=b.prod_success,a.info.yearFail=b.prod_fail;for(var c=[],e=[],g=b.prodpermonth_list?b.prodpermonth_list:[],h=1;12>=h;h++){for(var i=!1,j=0;j<g.length;j++){var k=g[j];if(k.pro_bk_month==h){c.push(k.success_bk_num),e.push(k.fail_bk_num),i=!0;break}}i||(c.push(0),e.push(0))}var l={categories:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],success:c,fail:e};f?a.config.monthChartConfig=d.getBarConfig(l):a.config.historyChartConfig=d.getBarConfig(l)},function(a){e.alert("APP_RELEASE_INPUT_YEAR_LESS_THEN_TABLE_LEAST_YEAR"==a.message?"无"+b+"年份数据！":a.message)})},k=function(b){c.getYearDataGroupMonth(b).then(function(b){a.info.yearCount=b.prod_sum,a.info.yearSucc=b.prod_success,a.info.yearFail=b.prod_fail;for(var c=[],e=[],f=[],g=b.prodperwindow_list?b.prodperwindow_list:[],h=0;h<g.length;h++){var i=g[h],j=i.pro_bk_date;if(j){var k=j.substr(0,j.indexOf("/")),l=j.substr(j.lastIndexOf("/")+1,j.length-1);l=10>l?"0"+l:""+l,10>k?k="0"+k+"/":k+="/"}else j="";var m=k+l;c.push(m),e.push(i.success_bk_num),f.push(i.fail_bk_num)}var n={categories:c,success:e,fail:f};a.config.dayChartConfig=d.getBarConfig(n)},function(a){e.alert(a.message)})};a.selectTab=function(b){"program"==b?i():"month"==b?j(g,!0):"day"==b?k(g):(j(a.info.historyYear,!1),a.info.historyYearString=(g-1).toString()+"年度")},a.changeYear=function(b){a.info.historyYear=b.substring(0,4),j(a.info.historyYear,!1)},h()}]),anaCtrl.controller("pubAnalysisCtrl",["$scope","CV",function(a,b){var c=new Date;a.info={yearCount:0,yearFail:0,nyearCount:0,nyearFail:0,n_year_list:[],m_year_list:[],endDay:"",historyNormalYear:"",historyNormalYearString:"",historyMajorYear:"",historyMajorYearString:""};var d=function(){a.info.endDay=b.dtFormat(new Date(c.getTime()-1728e5));var d=a.info.endDay.substring(0,4);a.info.historyNormalYear=d,a.info.historyNormalYearString=d.toString()+"年度",a.info.historyMajorYear=d,a.info.historyMajorYearString=d.toString()+"年度";for(var e=0;10>e;e++){var f=(d-e).toString()+"年度";a.info.n_year_list.push(f),a.info.m_year_list.push(f)}};a.changeNormalYear=function(b){a.historyNormalYear=b.substring(0,4)},a.changeMajorYear=function(b){a.historyMajorYear=b.substring(0,4)},d()}]),anaCtrl.controller("urgentAnalysisCtrl",["$scope","CV",function(a,b){var c=(new Date).getFullYear();a.info={yearCount:0,yearFail:0,yearList:[],endDay:"",historyYear:"",historyYearString:""};var d=function(){a.info.endDay=b.dtFormat(new Date((new Date).getTime()-1728e5)),a.info.historyYear=c,a.info.historyYearString=c.toString()+"年度";for(var d=0;10>=d;d++)a.info.yearList.push((c-d).toString()+"年度")};a.changeYear=function(b){a.info.historyYear=b.substring(0,4)},d()}]);var releaseAppCtrl=angular.module("ReleaseApplicationController",[]);releaseAppCtrl.controller("pubApplicationCtrl",["$scope","$state","$stateParams","$timeout","$sce","BusiSys","Project","CmptFunc","BsysFunc","PubWindow","CodeMirrorOption","ProtocolType","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.info={apply_info:{pjpublish_name:"",pjpublish_type:1,pjpublish_date:"",pjpublish_time:"",pjpublish_desc:"",publish_win_id:"",execute_type:1,pjpublish_project_list:[]},publish_proj_list:[],pjpublish_manager:"",publish_minute:"00",publish_hour:18,publish_date_type:2,time_err_msg:""},a.config={scroll_sys_info:m,data_picker_max_date:new Date},a.data={user_list:[],window_list:[]},a.control={start_opened:!1,save_btn_loading:!1};var p=function(){j.getPubWindowList(1).then(function(b){a.data.window_list=b.window_list||[],0==a.data.window_list.length&&(a.info.publish_date_type=2)},function(a){n.alert(a.message,3)})};a.choosePubWindow=function(b,c){a.info.apply_info.pjpublish_date=c},a.open=function(b,c){a.control.start_opened=1==b?!0:!1,c.stopPropagation()},a.addProject=function(b,c){n.releaseAddProject().then(function(b){var c=b,d=a.info.publish_proj_list,e=d.length;if(0==d.length)a.info.publish_proj_list=c;else for(var f=0;f<c.length;f++)for(var g=0;e>g&&c[f].project_id!=d[g].project_id;g++)c[f].project_id!=d[g].project_id&&g==e-1&&d.push(c[f])})},a.deleteProj=function(b,c){c.stopPropagation(),n.confirm("确认删除当前项目？").then(function(c){c&&a.info.publish_proj_list.splice(b,1)})},a.fmtPublishDate=function(){a.control.start_opened=!1,a.info.apply_info.pjpublish_date&&(a.info.apply_info.pjpublish_date=o.dtFormat(a.info.apply_info.pjpublish_date))},a.checkSystem=function(a){2!=a.sys_used_flag&&(a.checked=!a.checked)},a.formSubmit=function(){if(a.info.apply_info.pjpublish_project_list=[],!o.valiForm(a.application_form))return!1;if(0==a.info.publish_proj_list.length)return void n.alert("请添加项目!");a.control.save_btn_loading=!0;for(var c=0;c<a.info.publish_proj_list.length;c++){for(var d={project_id:a.info.publish_proj_list[c].project_id,project_name:a.info.publish_proj_list[c].project_name,project_desc:a.info.publish_proj_list[c].project_desc,business_sys_list:[]},e=a.info.publish_proj_list[c].business_sys_list||[],f=0;f<e.length;f++)e[f].checked||2==e[f].sys_used_flag||d.business_sys_list.push(e[f]);if(0==d.business_sys_list.length)return n.alert("项目"+d.project_name+"应至少选择一个系统！"),void(a.control.save_btn_loading=!1);a.info.apply_info.pjpublish_project_list.push(d)}a.info.apply_info.pjpublish_date=o.dtFormat(a.info.apply_info.pjpublish_date),a.info.apply_info.pjpublish_time=[parseInt(a.info.publish_hour)<10?"0"+parseInt(a.info.publish_hour):parseInt(a.info.publish_hour),":",parseInt(a.info.publish_minute)<10?"0"+parseInt(a.info.publish_minute):parseInt(a.info.publish_minute)].join("");var h=angular.extend({},a.info.apply_info);h.pjpublish_date=o.dtFormat(a.info.apply_info.pjpublish_date),h.publish_win_id=1==a.info.publish_date_type?a.info.apply_info.publish_win_id:null,g.applyRelease(h).then(function(c){b.go("pub_application_list"),a.control.save_btn_loading=!1},function(b){a.control.save_btn_loading=!1,n.alert(b.message,3)})},a.formcancel=function(){b.go("pub_application_list")},p()}]),releaseAppCtrl.controller("updatePubApplicationCtrl",["$scope","$state","$stateParams","$timeout","$sce","BusiSys","Project","CmptFunc","BsysFunc","PubWindow","CodeMirrorOption","ProtocolType","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=c.pjpublish_id;a.info={apply_info:{pjpublish_name:"",pjpublish_type:1,pjpublish_date:"",pjpublish_time:"",pjpublish_desc:"",publish_win_id:"",execute_type:1,pjpublish_project_list:[]},publish_proj_list:[],pjpublish_manager:"",publish_minute:"00",publish_hour:18,publish_date_type:2,time_err_msg:""},a.config={scroll_sys_info:m,data_picker_max_date:new Date},a.data={user_list:[],window_list:[]},a.control={start_opened:!1,save_btn_loading:!1};var q=function(){j.getPubWindowList(1).then(function(b){a.data.window_list=b.window_list||[],0==a.data.window_list.length&&(a.info.publish_date_type=2)},function(a){n.alert(a.message,3)}),g.viewReleaseApply(p).then(function(b){d(function(){if(b){var c=parseInt(b.publish_bean.pjpublish_time.split(":")[1]);a.info.apply_info.pjpublish_name=b.publish_bean.pjpublish_name,a.info.apply_info.pjpublish_desc=b.publish_bean.pjpublish_desc,a.info.apply_info.execute_type=b.publish_bean.execute_type,a.info.apply_info.pjpublish_id=b.publish_bean.pjpublish_id,a.info.apply_info.publish_win_id=b.publish_bean.publish_win_id,a.info.publish_date_type=b.publish_bean.publish_win_id?1:2,a.info.apply_info.pjpublish_date=b.publish_bean.pjpublish_date,a.info.apply_info.pjpublish_time=b.publish_bean.pjpublish_time,a.info.publish_hour=parseInt(b.publish_bean.pjpublish_time.split(":")[0]),a.info.publish_minute=10>c?"0"+c:c,a.info.publish_proj_list=b.publish_bean.pjpublish_project_list||[];for(var d=0;d<a.info.publish_proj_list.length;d++)for(var e=a.info.publish_proj_list[d].business_sys_list||[],f=0;f<e.length;f++)1==e[f].sys_used_flag&&(e[f].checked=!0)}},0)},function(a){n.alert(a.message,3)})};a.choosePubWindow=function(b,c){a.info.apply_info.pjpublish_date=c},a.open=function(b,c){a.control.start_opened=1==b?!0:!1,c.stopPropagation()},a.addProject=function(b,c){n.releaseAddProject().then(function(b){var c=b,d=a.info.publish_proj_list,e=d.length;if(0==d.length)a.info.publish_proj_list=c;else for(var f=0;f<c.length;f++)for(var g=0;e>g&&c[f].project_id!=d[g].project_id;g++)c[f].project_id!=d[g].project_id&&g==e-1&&d.push(c[f])})},a.deleteProj=function(b,c){c.stopPropagation(),n.confirm("确认删除当前项目？").then(function(c){c&&a.info.publish_proj_list.splice(b,1)})},a.fmtPublishDate=function(){a.control.start_opened=!1,a.info.apply_info.pjpublish_date&&(a.info.apply_info.pjpublish_date=o.dtFormat(a.info.apply_info.pjpublish_date))},a.checkSystem=function(a){2!=a.sys_used_flag&&(a.checked=!a.checked)},a.formSubmit=function(){if(a.info.apply_info.pjpublish_project_list=[],!o.valiForm(a.application_form))return!1;if(0==a.info.publish_proj_list.length)return void n.alert("请添加项目!");a.control.save_btn_loading=!0;for(var c=0;c<a.info.publish_proj_list.length;c++){for(var d={project_id:a.info.publish_proj_list[c].project_id,project_name:a.info.publish_proj_list[c].project_name,project_desc:a.info.publish_proj_list[c].project_desc,business_sys_list:[]},e=a.info.publish_proj_list[c].business_sys_list||[],f=0;f<e.length;f++)e[f].checked||2==e[f].sys_used_flag||d.business_sys_list.push(e[f]);if(0==d.business_sys_list.length)return n.alert("项目"+d.project_name+"应至少选择一个系统！"),void(a.control.save_btn_loading=!1);a.info.apply_info.pjpublish_project_list.push(d)}a.info.apply_info.pjpublish_date=o.dtFormat(a.info.apply_info.pjpublish_date),a.info.apply_info.pjpublish_time=[parseInt(a.info.publish_hour)<10?"0"+parseInt(a.info.publish_hour):parseInt(a.info.publish_hour),":",parseInt(a.info.publish_minute)<10?"0"+parseInt(a.info.publish_minute):parseInt(a.info.publish_minute)].join("");var h=angular.extend({},a.info.apply_info);h.pjpublish_date=o.dtFormat(a.info.apply_info.pjpublish_date),h.publish_win_id=1==a.info.publish_date_type?a.info.apply_info.publish_win_id:null,g.applyRelease(h).then(function(c){b.go("pub_application_list"),a.control.save_btn_loading=!1},function(b){a.control.save_btn_loading=!1,n.alert(b.message,3)})},a.formcancel=function(){b.go("pub_application_list")},q()}]),pCtrl.controller("pubApplicationListCtrl",["$scope","$state","$stateParams","$timeout","Project","ProjectStatus","ProjectReleaseType","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){a.info={error_msg:"",project_info:{},project_info_his:{},apply_list:[],history_apply_list:[],history_app_index:0,apply_release_list:[],apply_release_history_list:[],project_id:c.project_id||""},a.data={release_type:g,project_status:f},a.control={project_list_loading:!1,project_history_list_loading:!1,active_index:0,active_his_index:0,his_list_flag:c.his_list_flag,apply_sys_loading:!1,apply_his_sys_loading:!1,view_proj_app_flag:a.proj_detail_app_flag},a.config={sys_scroll:h.Y(),project_scroll:h.Y(),page_option:{limit_recd:10,curr:1,all_recd:10,count:8,click:function(a){m(a)}}};var k=function(){a.control.his_list_flag?m(1):l()},l=function(){a.info.error_msg="",a.control.project_list_loading=!0,e.getApplyReleaseList(a.info.project_id).then(function(b){d(function(){a.info.apply_release_list=b.pjpublish_list||[],n(a.control.active_index),a.control.project_list_loading=!1},0)},function(b){a.control.project_list_loading=!1,a.info.error_msg=b.message})},m=function(b){var c={limit_recd:a.config.page_option.limit_recd,project_id:a.info.project_id,start_recd:a.config.page_option.limit_recd*(b-1)};a.info.error_his_msg="",a.control.project_history_list_loading=!0,a.info.apply_release_history_list=[],a.control.active_his_index=0,e.getApplyReleaseHistoryList(c).then(function(b){d(function(){a.config.page_option.all_recd=b.all_recd,a.info.apply_release_history_list=b.pjpublish_list||[],o(a.control.active_his_index),a.control.project_history_list_loading=!1},0)},function(b){a.control.project_history_list_loading=!1,a.info.error_his_msg=b.message})},n=function(b){a.info.project_info=a.info.apply_release_list[b]},o=function(b){a.info.project_info_his=a.info.apply_release_history_list[b]};a.chooseProject=function(b,c){c?(a.control.active_index=b,n(a.control.active_index)):(a.control.active_his_index=b,o(a.control.active_his_index))},a.getEnumValue=function(a,b){return j.findValue(a,b)},a.goToApplication=function(a){b.go("pub_application",{project_id:a})},a.goToPubDetail=function(a){b.go("proj_detail_pre",{publish_id:a.syspublish_id,sys_id:a.business_sys_name})},a.updateApplication=function(a,c){b.go("pub_application_update",{pjpublish_id:a,project_id:c})},a.deleteApplication=function(a){i.confirm("确认撤销申请？").then(function(){e.deleteReleaseApply(a).then(function(a){a&&(i.alert("撤销成功",2),l())},function(a){i.alert(a.message,3)})})},a.reBootPublish=function(a){i.confirm("请确认是否重启该发布申请？").then(function(b){b&&e.reBootPjpublish(a).then(function(a){a&&(i.alert("重启成功",2),m(1))},function(a){i.alert(a.message,3)})})},a.goToPlanSys=function(a){b.go("plan_sys_set",{publish_id:a})},a.syncHeight=function(){var b=a.control.view_proj_app_flag?100:30;return{height:$(".ui-view-content").height()-b}},a.syncSysHeight=function(b){return b=a.control.view_proj_app_flag?0:b,{height:$(".proj-content").height()-85-b}},$(window).resize(function(){d(function(){a.syncHeight(),a.syncSysHeight()},50)}),k()}]);var monitorCtrl=angular.module("MonitorController",[]);monitorCtrl.controller("execMonirorListCtrl",["$scope","$timeout","$routeParams","$rootScope","$state","$interval","Monitor","Plan","Project","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l={},m=0;a.info={all_project_count:0,pub_project_count:0,wait_project_count:0,pubed_project_count:0,pub_percent:0,head_date:{},mouth_date:{},tomorrow_date:{},pjplan_list:[]},a.control={monitor_info_loading:!0,begin_flag:!0,finish_flag:!1};var n=function(){a.info.all_project_count=0,a.info.pub_project_count=0,a.info.wait_project_count=0,a.info.pubed_project_count=0,a.info.pub_percent=0},o=function(){0!=a.info.all_project_count&&(a.info.pub_percent=Math.round(a.info.pubed_project_count/a.info.all_project_count*100)),t(),m=a.info.pub_percent},p=function(b){b=b||[],a.info.all_project_count=b.length,angular.forEach(b,function(b,c,d){2===b.pjpublish_status?a.info.pub_project_count++:1===b.pjpublish_status&&a.info.wait_project_count++}),a.info.pubed_project_count=a.info.all_project_count-a.info.pub_project_count-a.info.wait_project_count},q=function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++){var f=b[e];if(d.pjpublish_id&&f.pjpublish_id&&d.pjpublish_id==f.pjpublish_id){d.publish_count=f.publish_count,d.exec_count=f.exec_count,d.exec_end_count=f.exec_end_count,d.project_status=f.project_status;break}}p(a),o()},r=function(){g.getAllMonitorInfomation().then(function(b){var c=b.pjplan_list?b.pjplan_list:[];n(),q(a.info.pjplan_list,c)},function(a){})},s=function(){g.getAllMonitorInfomation().then(function(b){var c=b.pjplan_list?b.pjplan_list:[];p(c),o(),a.info.pjplan_list=c,a.control.monitor_info_loading=!1,l=f(function(){r()},5e3)},function(b){a.control.monitor_info_loading=!1})},t=function(){0==m&&0!=a.info.pub_percent&&b(function(){a.control.begin_flag=!1},1e3),100!=m&&100==a.info.pub_percent&&b(function(){a.control.finish_flag=!0},2e3)};a.changeState=function(a,b){3==a?e.go("group_monitor_detail",{publish_id:b.pjpublish_id,application_name:b.pjpublish_name}):2==a?e.go("proj_detail_pre",{proj_id:b.project_name,sys_id:b.business_sys_name}):e.go("monitor_detail",{proj_id:b.project_name,sys_id:b.business_sys_name,proj_status:b.project_status})},a.goToSingleMonitor=function(a){e.go("monitor_detail",{sys_publish_id:a.syspublish_id,sys_id:a.business_sys_name,sys_status:a.sys_publish_status,quick_pub_flag:2})},d.$on("$stateChangeSuccess",function(){b(function(){f.cancel(l)},6e3)}),s()}]),monitorCtrl.controller("monitorGroupCtrl",["$scope","$timeout","$stateParams","$rootScope","$state","$interval","Plan","Monitor",function(a,b,c,d,e,f,g,h){var i={};a.info={publish_id:c.publish_id,pjpublish_name:c.application_name,nodeLinkData:{nodeDataArray:[],linkDataArray:[]},node_length:0,group:{}},a.control={read_only:!0,loadingData:!0,loading_error:!1};var j=function(b){a.node_length=0,a.info.nodeLinkData={nodeDataArray:[],linkDataArray:[]};for(var c=1,d=[],e=0;e<b.proj_list.length;e++){var f=b.proj_list[e],g={category:"OfNodes",isGroup:!0,key:c};c++,f.phase_list=f.phase_list||[],a.info.nodeLinkData.nodeDataArray.push(g);for(var h=void 0,i=0;i<f.phase_list.length;i++){a.node_length=a.node_length>i+1?a.node_length:i+1;var j=f.phase_list[i],k={key:c,test:j.phase_cn_name,isGroup:!0,category:"OfGroups",group:g.key,time:0==i?f.start_time:i==f.phase_list.length-1?f.end_time:""};if(c++,2==j.phase_status){var l={key:c,group:k.key,category:"executing",slices:[{start:-90,sweep:360,color:"#CCC",radius:20,center:20},{start:-90,sweep:3.6*j.phase_dynamic,color:"#2196f3",radius:20,center:20},{start:-90,sweep:360,color:"#fafafa",radius:16,center:20}],dynamic:j.phase_dynamic,row:e+1,col:i+1};c++}else{var l={key:c,group:k.key,category:"noExecute",row:e+1,col:i+1,status:j.phase_status};c++}if(j.rely_list&&0!=j.rely_list.length)for(var m=0;m<j.rely_list.length;m++){var n=j.rely_list[m];d.push({to:l.key,business_sys_name:n.pre_sys_name,phase_id:n.pre_phase_id,to_row:m+1,to_col:i+1})}a.info.nodeLinkData.nodeDataArray.push(k),a.info.nodeLinkData.nodeDataArray.push(l),0!=i&&a.info.nodeLinkData.linkDataArray.push({from:h,to:l.key,statue:j.phase_status}),h=l.key}}for(var e=0;e<d.length;e++)for(var o=0,i=0;i<b.proj_list.length;i++){o++;for(var f=b.proj_list[i],p=0;p<f.phase_list.length;p++)o+=2,f.business_sys_name==d[e].business_sys_name&&f.phase_list[p].phase_id==d[e].phase_id&&a.info.nodeLinkData.linkDataArray.push({to:d[e].to,from:o,statue:f.phase_list[p].phase_status})}a.control.loadingData=!0},k=function(){a.control.loadingData=!1,l(),i=f(function(){l()},1e4)},l=function(){g.getProjectPlanInfo(a.info.publish_id).then(function(b){b&&(a.info.group={proj_list:b.pubProSys_list?b.pubProSys_list:[],project_cn_name:b.project_cn_name?b.project_cn_name:"--",dynamic:b.dynamic?b.dynamic:0},j(a.info.group),a.control.loadingData=!0)},function(b){a.control.loadingData=!0,a.control.loading_error=!0,a.control.error_message=b.message})};a.projStyle=function(a){return{top:145*a+"px"}},a.goToSingleMonitor=function(a){e.go("monitor_detail",{sys_publish_id:a.syspublish_id,sys_id:a.business_sys_name,sys_status:a.sys_publish_status,quick_pub_flag:2})},a.returnMonitorList=function(){e.go("monitor_list")},a.$on("$stateChangeSuccess",function(){b(function(){f.cancel(i)},1e3)}),k()}]),prodCtrl.controller("monitorDetailCtrl",["$scope","$stateParams","$state","$rootScope","$interval","$timeout","$sce","Proj","Monitor","Exec","ProjState","ProdFlag","IssueType","ProdNodeState","ProdCmdState","Modal","ProdFunc","CmptFunc","ProtocolType","CodeMirrorOption","ScrollConfig","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w,x,y=b.sys_id,z=b.sys_publish_id,A=b.sys_status<6?1:2,B={},C={},D=$("#codePanel");a.info={proj_info:{},exec_type:6>A?1:2,instance_info:{steps:[]},phase_node_info:{nodes_info:{node_list:[],parallel_flag:!1},nodes_flag:!1,expand_flag:!1,phase_status:1,phase_no:1,nav_show_flag:0},exe_log_info:{},log_info:{search_key_word:"",curr_checked_ip:"",monitor_log_list:[]},nowDate:"",nowTime:"",remainTime:""},a.control={is_log_minisize:!1,is_Exec:!0,show_prod_error:!1,show_monitor_div_flag:!0,monitor_flag:!1,scroll_is_lock:!1,code_mirror_control:!1,tab_type:!0,show_monitor_log:!1,show_key_word_search_input:!1,show_start_search:!0,is_quick_publish:b.quick_pub_flag?b.quick_pub_flag:2,curr:{_phase:0,_node:0},can_exec:!1,show_plan_time:!1},a.data={key_word_count:0,checked_node_list:[],log_tasks:{}},a.config={scroll_code_info:u,scroll_node_info:u,scroll_console_info:u,scroll_log_files_info:u,scroll_log_content_info:u,view_options:t.Sh(!0)};var E=function(b){f(function(){var c="#phase_"+b;a.inscrollTo($(c))},100)},F=function(a){for(var b=[],c=[],d=[],e=0;e<a.length;e++)for(var f=a[e],g=0;g<f.phase_list.length;g++){var h=f.phase_list[g];if(h.node_list)for(var i=0;i<h.node_list.length;i++)c.push(h.node_list[i].exec_node_ip)}b=Array.from(new Set(c));for(var j=0;j<b.length;j++)d.push({exec_ip:b[j],is_show:!1});return d},G=function(b){var c=new Date(b.dtbs_bk_date.replace(/-/g,"/")+" "+b.dtbs_bk_time),d=c.getFullYear(),f=c.getMonth()+1<10?"0"+(c.getMonth()+1):c.getMonth()+1,g=c.getDate()<10?"0"+c.getDate():c.getDate(),h=c.getHours()<10?"0"+c.getHours():c.getHours(),i=c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes(),j=c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds(),k=new Date(b.pj_info_detail.pro_bk_date.replace(/-/g,"/")+" "+b.pj_info_detail.pro_bk_time),l=k.getTime(),m=c.getTime();a.info.nowDate=d+"-"+f+"-"+g,a.info.nowTime=h+":"+i+":"+j,a.setTimer=function(){m+=1e3,c=new Date(m),g=c.getDate()<10?"0"+c.getDate():c.getDate(),h=c.getHours()<10?"0"+c.getHours():c.getHours(),i=c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes(),j=c.getSeconds()<10?"0"+c.getSeconds():c.getSeconds(),a.info.nowDate=d+"-"+f+"-"+g,a.info.nowTime=h+":"+i+":"+j;var b=l-m,e=0,k=0,n=0,o=0;b>=0?(e=Math.floor(b/1e3/60/60/24),k=Math.floor(b/1e3/60/60%24)<10?"0"+Math.floor(b/1e3/60/60%24):Math.floor(b/1e3/60/60%24),n=Math.floor(b/1e3/60%60)<10?"0"+Math.floor(b/1e3/60%60):Math.floor(b/1e3/60%60),o=Math.floor(b/1e3%60)<10?"0"+Math.floor(b/1e3%60):Math.floor(b/1e3%60),e>0&&(k=24*e+parseInt(k)),a.info.remainTime=k+"时"+n+"分"+o+"秒"):a.control.can_exec=!0,a.$applyAsync()},C=e(a.setTimer,1e3)},H=function(){j.getSysPubDetail(y,z).then(function(b){a.info.proj_info=b.pj_info_detail,a.info.proj_info.project_status=b.pj_info_detail.syspublish_status?b.pj_info_detail.syspublish_status:1,a.info.proj_info.project_status_cn=v.findValue(a.info.proj_info.project_status,k)},function(a){})},I=function(){i.monitorPjProject(w).then(function(b){if(b.group_list){var c=b.group_list?b.group_list:[];a.control.curr._phase=b.current_phase_no?b.current_phase_no:1,a.control.curr._node=b.current_phase_ip;for(var d=0;d<c.length;d++)for(var e=c[d],g=0;g<e.phase_list.length;g++){var h=a.info.instance_info.steps[d].phase_list[g],i=e.phase_list[g];if(h.time_used=i.time_used?i.time_used:0,h.exe_msg=i.exe_msg?i.exe_msg:"",h.phase_status=i.phase_status,h.end_bk_tm=i.end_bk_tm?i.end_bk_tm:"",h.start_bk_tm=i.start_bk_tm?i.start_bk_tm:"",h.parallel_flag=i.parallel_flag,h.is_check=!1,i.node_list)for(var j=0;j<i.node_list.length;j++){var k=h.node_list[j];h.exe_script&&k.cmds&&(a.control.curr._node==k.exec_node_ip?h.exe_script=r.cmdsToString(k.cmds):h.exe_script=r.cmdsToString(h.node_list[0].cmds)),k.node_status=i.node_list[j].node_status,k.exe_msg=i.exe_msg}if(a.control.curr._phase==i.phase_no){if(h.is_check=!0,a.info.phase_node_info.phase_no=h.phase_no,a.info.phase_node_info.phase_status=h.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=h.parallel_flag,a.info.phase_node_info.nodes_info.node_list)for(var j=0;j<a.info.phase_node_info.nodes_info.node_list.length;j++)a.info.phase_node_info.nodes_info.node_list[j].is_show=!1;h.node_list?(a.info.phase_node_info.nodes_flag=!1,q.dealPhaseNode(h.node_list,a.info.phase_node_info.nodes_info.node_list)):a.info.phase_node_info.nodes_flag=!0,a.info.phase_node_info.nodes_info.node_list&&(a.info.phase_node_info.nav_show_flag=r.judgeShowDetail(a.info.phase_node_info.nodes_info.node_list),a.info.phase_node_info.expand_flag=2==a.info.phase_node_info.nav_show_flag?!0:!1)}}if(K(a.info.phase_node_info.nodes_info.node_list,!1),3==b.current_phase_status&&(a.control.show_prod_error=!0),-1==a.control.curr._phase){var l=a.info.instance_info.steps[a.info.instance_info.steps.length-1],m=l.phase_list[l.phase_list.length-1];if(a.info.phase_node_info.phase_no=m.phase_no,a.info.phase_node_info.phase_status=m.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=m.parallel_flag,a.info.phase_node_info.nodes_info.node_list)for(var j=0;j<a.info.phase_node_info.nodes_info.node_list.length;j++)a.info.phase_node_info.nodes_info.node_list[j].is_show=!1;m.node_list?(a.info.phase_node_info.nodes_flag=!1,q.dealPhaseNode(m.node_list,a.info.phase_node_info.nodes_info.node_list)):a.info.phase_node_info.nodes_flag=!0,m.is_check=!0}f(function(){-1!=a.control.curr._phase&&E(a.control.curr._phase),a.control.code_mirror_control=!0},200)}},function(a){p.alert(a.message,3),c.go("pub_window")})},J=function(a,b){j.monitorNodeMsg(y,a).then(function(c){c&&(b.node_monitor_msg=c.monitor_result_list?c.monitor_result_list:[],b.show_detail&&f(function(){J(a,b)},5e3))},function(c){b.show_detail&&f(function(){J(a,b)},5e3)})},K=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];b?d.show_detail=!1:d.is_show||(d.show_detail=!1)}},L=function(){j.getSysPubDetail(y,z).then(function(b){if(b.pj_info_detail){w=b.pj_info_detail.execute_id,x=b.pj_info_detail.environment_id;var d=4==a.info.proj_info.project_status||5==a.info.proj_info.project_status||7==a.info.proj_info.project_status||8==a.info.proj_info.project_status?2:1;c.go("monitor_detail.console",{execute_id:w,stop_flag:d}),a.info.proj_info=b.pj_info_detail,a.info.proj_info.project_status=b.pj_info_detail.syspublish_status?b.pj_info_detail.syspublish_status:1,1==a.info.exec_type?G(b):a.control.can_exec=!0,1==b.pj_info_detail.syspublish_status&&c.go("pub_window"),a.info.proj_info.project_status_cn=v.findValue(a.info.proj_info.project_status,k),i.monitorPjProject(w).then(function(b){if(b.group_list){a.info.instance_info.steps=b.group_list?b.group_list:[],a.info.phase_node_info.nodes_info.node_list=F(a.info.instance_info.steps),a.control.curr._phase=b.current_phase_no?b.current_phase_no:1,a.control.curr._node=b.current_phase_ip;for(var c=0;c<a.info.instance_info.steps.length;c++){var d=a.info.instance_info.steps[c];d.expand_flag=!0;for(var e=0;e<d.phase_list.length;e++){var h=d.phase_list[e];if(h.is_check=!1,h.time_used=h.time_used?h.time_used:0,h.phase_type<=3&&h.node_list)for(var i=0;i<h.node_list.length;i++)a.control.curr._node==h.node_list[i].exec_node_ip?h.exe_script=r.cmdsToString(h.node_list[i].cmds):h.exe_script=r.cmdsToString(h.node_list[0].cmds);6==h.phase_type&&h.cmds&&(h.url_detail=g.trustAsHtml(h.cmds[0])),a.control.curr._phase==h.phase_no&&(h.is_check=!0,a.info.phase_node_info.phase_no=h.phase_no,a.info.phase_node_info.phase_status=h.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=h.parallel_flag,h.node_list?(a.info.phase_node_info.nodes_flag=!1,q.dealPhaseNode(h.node_list,a.info.phase_node_info.nodes_info.node_list)):a.info.phase_node_info.nodes_flag=!0,a.info.phase_node_info.nodes_info.node_list&&(a.info.phase_node_info.nav_show_flag=r.judgeShowDetail(a.info.phase_node_info.nodes_info.node_list),a.info.phase_node_info.expand_flag=2==a.info.phase_node_info.nav_show_flag?!0:!1));
}}if(3==b.current_phase_status&&(a.control.show_prod_error=!0),-1==a.control.curr._phase){var j=a.info.instance_info.steps[a.info.instance_info.steps.length-1],k=j.phase_list[j.phase_list.length-1];if(a.info.phase_node_info.phase_no=k.phase_no,a.info.phase_node_info.phase_status=k.phase_status,a.info.phase_node_info.nodes_info.parallel_flag=k.parallel_flag,a.info.phase_node_info.nodes_info.node_list)for(var l=0;l<a.info.phase_node_info.nodes_info.node_list.length;l++)a.info.phase_node_info.nodes_info.node_list[l].is_show=!1;k.node_list?(a.info.phase_node_info.nodes_flag=!1,q.dealPhaseNode(k.node_list,a.info.phase_node_info.nodes_info.node_list)):a.info.phase_node_info.nodes_flag=!0,k.is_check=!0}f(function(){a.control.code_mirror_control=!0,-1!=a.control.curr._phase&&E(a.control.curr._phase)},200)}},function(a){p.alert(a.message,3),c.go("pub_window"),B&&e.cancel(B)})}},function(a){B&&e.cancel(B)}),B=e(function(){H(),I()},5e3),a.$watch("info.proj_info",function(a,b){var c=a.project_status;c>3&&6!=c&&B&&e.cancel(B)},!0),$("body").addClass("over_flow_y")};d.$on("$stateChangeSuccess",function(b,c,d,f,g){"monitor_detail"!=f.name&&(e.cancel(C),e.cancel(B)),K(a.info.phase_node_info.nodes_info.node_list,!0),a.control.monitor_flag=!1,$("body").removeClass("over_flow_y")}),a.downloadFile=function(a){v.downloadFile(a)},a.changeTime=function(){a.control.show_plan_time=!0},a.resetTime=function(){a.control.show_plan_time=!1};var M=function(b){var c={file:b.file,file_path:b.file_path,log_name:b.log_name,no_log_flag:b.no_log_flag,node_ip:b.node_ip,node_name:b.node_name,path:b.path,task_id:b.task_id,word_coding:b.word_coding};c.key_word=a.info.exe_log_info.key_word?a.info.exe_log_info.key_word:"",j.getMonitorLogInfo(c).then(function(c){c&&f(function(){var d=!1;return c.log_task&&(c.log_task.stop_mark||(d=!0),c.log_task.log_name==b.file_path&&(c.log_task.log_text?(b.no_log_flag=!1,b.log_msg=b.log_msg.concat(c.log_task.log_text),b.log_msg.length>=2e3&&b.log_msg.splice(0,b.log_msg.length-2e3),b.log_text=b.log_msg,a.control.scroll_is_lock||f(function(){a.logscrollToBottom("bottom",{scrollEasing:"linear"})},100)):b.no_log_flag=!0)),d?(p.alert("监控日志超时,已自动停止！",2),a.control.monitor_flag=!1,!1):a.control.monitor_flag?void M(b):!1},1e3)},function(b){a.control.monitor_flag=!1,p.alert("监控日志异常终止",3)})};a.addMonitorContent=function(){p.addMonitorModal(y,z,a.info.log_info.monitor_log_list,x).then(function(b){b&&(a.info.log_info.monitor_log_list=b)})},a.startFileMonitor=function(b){a.control.monitor_flag=!0,b.file_path=b.path+"/"+b.file,j.startMonitorNode(b).then(function(a){a&&(a.log_task&&a.log_task.log_name==b.file_path&&(b.task_id=a.log_task.task_id,b.log_name=b.file_path,b.log_msg=[]),M(b))},function(b){a.control.monitor_flag=!1,p.alert(b.message,3)})},a.stopNodeMonitor=function(b){a.info.exe_log_info.key_word="",j.endMonitorNode({task_id:b.task_id}).then(function(b){b&&f(function(){a.control.monitor_flag=!1,p.alert("已停止监控!",2)},0)},function(a){p.alert(a.message,3)})},a.searchByKeyword=function(b){return b?b.length<2?(p.alert("关键字请至少输入两个字符",3),!1):void $(".common_top").each(function(){var a=new RegExp(b,"g"),c=$(this).children(":last").text().replace(a,function(a){return"<strong class='high_light'>"+a+"</strong>"});$(this).children(":last").html(c)}):(a.logClearSearch(""),!1)},a.firstHighLight=function(b){if(!a.info.log_info.search_key_word)return p.alert("请先输入关键字！",3),!1;a.searchByKeyword(a.info.log_info.search_key_word);var c=$(".high_light");$(c[0]).removeClass("high_light").addClass("cur_high_light"),document.querySelector(".cur_high_light").scrollIntoView(!0)},a.preHighLight=function(b){if(!a.info.log_info.search_key_word)return p.alert("请先输入关键字！",3),!1;for(var c=$("strong"),d=0,e=0;e<c.length;e++)if("cur_high_light"==c[e].className){d++,0==e?p.alert("已经是第一个了",3):($(c[e]).removeClass("cur_high_light").addClass("high_light"),$(c[e-1]).removeClass("high_light").addClass("cur_high_light"));break}0==d&&$(c[0]).removeClass("high_light").addClass("cur_high_light"),document.querySelector(".cur_high_light").scrollIntoView(!0)},a.backHighLight=function(b){if(!a.info.log_info.search_key_word)return p.alert("请先输入关键字！",3),!1;for(var c=$("strong"),d=0,e=0;e<c.length;e++)if("cur_high_light"==c[e].className){d++,e==c.length-1?p.alert("已经是最后一个了",3):($(c[e]).removeClass("cur_high_light").addClass("high_light"),$(c[e+1]).removeClass("high_light").addClass("cur_high_light"));break}0==d&&$(c[0]).removeClass("high_light").addClass("cur_high_light"),document.querySelector(".cur_high_light").scrollIntoView(!0)},a.lastHighLight=function(b){if(!a.info.log_info.search_key_word)return p.alert("请先输入关键字！",3),!1;a.searchByKeyword(a.info.log_info.search_key_word);var c=$(".high_light");$(c[c.length-1]).removeClass("high_light").addClass("cur_high_light"),document.querySelector(".cur_high_light").scrollIntoView(!0)},a.showKeyWordLine=function(b){return b?b.length<2?(p.alert("关键字请至少输入两个字符",3),!1):(a.control.show_key_line=!0,a.control.show_start_search=!1,a.control.monitor_flag&&(a.info.exe_log_info.key_word=a.info.log_info.search_key_word,a.control.scroll_is_lock=!1),void 0):(p.alert("请先输入关键字！",3),!1)},a.cancelKeyWordLine=function(){a.control.show_key_word_search_input=!1,a.control.monitor_flag&&a.control.show_key_line&&(a.control.show_key_line=!1,a.info.exe_log_info.key_word="",a.info.log_info.search_key_word="",a.control.scroll_is_lock=!1)},a.lockLogScroll=function(){a.control.scroll_is_lock=!a.control.scroll_is_lock,a.control.monitor_flag&&(a.control.scroll_is_lock?a.instop():f(function(){a.logscrollToBottom("bottom",{scrollEasing:"linear"})},100))},a.showSearchInput=function(){a.control.show_key_word_search_input=!0};var N=function(a){for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<c.phase_list.length;d++)c.phase_list[d].is_check=!1};a.chooseNodeConfig=function(b,c,d,e){N(e),d.is_check=!0,a.control.get_nodes_loading=!0,f(function(){if(a.info.phase_node_info.nodes_info.node_list)for(var d=0;d<a.info.phase_node_info.nodes_info.node_list.length;d++)a.info.phase_node_info.nodes_info.node_list[d].is_show=!1;e[b].phase_list[c].node_list?(a.info.phase_node_info.nodes_flag=!1,q.dealPhaseNode(e[b].phase_list[c].node_list,a.info.phase_node_info.nodes_info.node_list),K(a.info.phase_node_info.nodes_info.node_list,!1)):(a.info.phase_node_info.nodes_flag=!0,K(a.info.phase_node_info.nodes_info.node_list,!0)),a.info.phase_node_info.phase_no=e[b].phase_list[c].phase_no,a.info.phase_node_info.phase_status=e[b].phase_list[c].phase_status,a.info.phase_node_info.nodes_info.parallel_flag=e[b].phase_list[c].parallel_flag,a.info.phase_node_info.nodes_info.node_list&&(a.info.phase_node_info.nav_show_flag=r.judgeShowDetail(a.info.phase_node_info.nodes_info.node_list),a.info.phase_node_info.expand_flag=2==a.info.phase_node_info.nav_show_flag?!0:!1),a.control.get_nodes_loading=!1},1e3)},a.toggleNodeExecInfo=function(a,b){a.show_detail=!a.show_detail,b.nav_show_flag=r.judgeShowDetail(b.nodes_info.node_list),b.expand_flag=2==b.nav_show_flag?!0:!1,a.show_detail&&J(a.exec_node_ip,a)},a.expandAllNode=function(a){a.nav_show_flag=r.expandAllModules(a.nodes_info.node_list);for(var b=0;b<a.nodes_info.node_list.length;b++){var c=a.nodes_info.node_list[b];c.show_detail&&c.is_show&&!function(a,b){J(a,b)}(c.exec_node_ip,c)}},a.closeAllNode=function(a){a.nav_show_flag=r.closeAllModules(a.nodes_info.node_list)},a.getProtocolTypeCnName=function(a){return v.findValue(a,s).substring(0,5).toLowerCase()},a.changeMontiorType=function(b){a.control.tab_type=1==b?!0:!1},a.chooseMonitorFile=function(b,c){a.control.show_monitor_log=!a.control.show_monitor_log,a.info.exe_log_info=angular.copy(b),a.info.exe_log_info.node_ip=c.node_ip,a.info.exe_log_info.business_sys_name=c.business_sys_name,a.info.exe_log_info.soc_name=c.soc_name,a.info.exe_log_info.show_monitor_log=!0},a.returnMonitorList=function(){return a.control.monitor_flag?(p.alert("日志正在监控中,请勿切换到列表",3),!1):(a.info.log_info.search_key_word="",void(a.control.show_monitor_log=!1))},a.caculateMonitorHeight=function(){var a=$(window).innerHeight()-260;return{height:a+"px"}},a.deleteMonitorLog=function(b,c,d,e){b.stopPropagation(),p.confirm("请确认是否删除该监控文件?").then(function(){d.checked_files.splice(c,1),0==d.checked_files.length&&a.info.log_info.monitor_log_list.splice(e,1)})},a.toggleMinimize=function(){f(function(){var b=D.height(),c=$("#consoleDesk");a.control.is_log_minisize=!a.control.is_log_minisize,c.css("height",25==c.height()?"200":"25"),a.control.is_log_minisize?D.css("height",b+180):D.css("height",b-200+20)},10)},a.caculateHeight=function(){var b=0;return b=a.control.is_log_minisize?$(window).height()-250-110+180:$(window).height()-250-110,{height:b+"px"}},a.caculateConsoleWidth=function(){var a=$("#codePanel").width();return{width:a+"px"}},L()}]);var versionCtrl=angular.module("VersionController",[]);versionCtrl.controller("versionNewCtrl",["$scope","$timeout","$stateParams","$cookieStore","$rootScope","$state","Version","DataSource","ScriptExec","Collection","VersionEncodingData","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=c.sys_name||"",o=c.sys_cn_name||"",p=$(".version-new"),q="",r="",s={upload_path:"",soc_name:"",root_bk_dir:"",init_path:"",full_path:"",checked_files:[],encoding:"UTF-8",add_type:1,business_cn_name:o};a.info={version_app_info:angular.extend(s),app_data:{ver_soc_list:[],encoding_list:k},app_fileupload:{suffixs:"tar,zip,gz",filetype:"",filename:"",uploadpath:q},version_config_info:angular.extend(s),config_data:{ver_soc_list:[],encoding_list:k},config_fileupload:{suffixs:"tar,zip,gz",filetype:"",filename:"",uploadpath:r}},a.control={show_add_type:!1,show_Ftp:!1,show_config_ftp:!1,layers_loading:!1},a.submit_info={business_cn_name:o,app_base:{soc_name:"",add_type:1,business_sys_name:n,upload_url:"",ver_soc_list:[],upload_path:""},config_base:{add_type:1,ver_soc_list:[],soc_name:"",file_list:[]}};var t=function(a,b,c){var d=[];if(1==a)for(var e=0;e<b.length;e++){var f={soc_name:"",add_type:1,business_sys_name:n,upload_url:b[e].file_path,encoding:b[e].encoding?b[e].encoding:"UTF-8"};d.push(f)}else if(2==a)for(var g=0;g<b.length;g++){var h={soc_name:c,add_type:2,business_sys_name:n,upload_url:b[g].path+"/"+b[g].file,encoding:b[g].encoding?b[g].encoding:"UTF-8"};d.push(h)}return d},u=function(){a.info.version_app_info.checked_files=[],a.info.version_app_info.paths=[],a.info.version_app_info.active=!1},v=function(){a.info.version_config_info.checked_files=[],a.info.version_config_info.paths=[],a.info.version_config_info.active=!1},w=function(){a.info.version_app_info.init_path="",a.info.version_app_info.soc_name&&j.getFileListBySoc(a.info.version_app_info.soc_name,a.info.version_app_info.init_path).then(function(b){u(),a.info.version_app_info.path_files=b.file_bean_list||[],a.info.version_app_info.init_path=b.root_bk_dir||"",a.info.version_app_info.full_path=b.root_bk_dir||"",a.control.show_Ftp=!0},function(b){a.control.show_Ftp=!0,l.alert(b.message)})},x=function(){a.info.version_config_info.init_path="",a.info.version_config_info.soc_name&&j.getFileListBySoc(a.info.version_config_info.soc_name,a.info.version_config_info.init_path).then(function(b){v(),a.info.version_config_info.path_files=b.file_bean_list||[],a.info.version_config_info.init_path=b.root_bk_dir||"",a.info.version_config_info.full_path=b.root_bk_dir||"",a.control.show_config_ftp=!0},function(b){a.control.show_config_ftp=!0,l.alert(b.message)})},y=function(){var b={app_bean:{soc_name:"",add_type:"",business_sys_name:n,upload_url:"",encoding:""},config_list:[],other_list:[],business_sys_name:n};return 1==a.info.version_app_info.add_type?(b.app_bean.upload_url=a.info.app_fileupload.uploadpath+a.info.app_fileupload.filename,b.app_bean.add_type=1,b.app_bean.encoding=a.info.version_app_info.encoding):(b.app_bean.add_type=2,b.app_bean.soc_name=a.info.version_app_info.soc_name,a.info.version_app_info.checked_files.length>0&&(b.app_bean.upload_url=a.info.version_app_info.checked_files[0].path+"/"+a.info.version_app_info.checked_files[0].file,b.app_bean.encoding=a.info.version_app_info.checked_files[0].encoding?a.info.version_app_info.checked_files[0].encoding:"UTF-8")),1==a.info.version_config_info.add_type?a.submit_info.config_base.file_list.length>0&&(b.config_list=t(1,a.submit_info.config_base.file_list,"")):a.info.version_config_info.checked_files.length>0&&(b.config_list=t(2,a.info.version_config_info.checked_files,a.info.version_config_info.soc_name)),b},z=function(){g.getInitializeUploadPath(n).then(function(c){b(function(){c&&(a.info.app_fileupload.uploadpath=c.app_path,a.info.config_fileupload.uploadpath=c.config_path,q=c.app_path,r=c.config_path)},0)},function(a){l.alert(a.message)}),i.getSocByNodeIp("",1).then(function(b){a.info.app_data.ver_soc_list=b.source_list?b.source_list:[],a.info.config_data.ver_soc_list=b.source_list?b.source_list:[]},function(a){l.alert(a.message)})};a.changeAppPackUploadType=function(b){1==b?(a.info.version_app_info={business_cn_name:c.business_cn_name?c.business_cn_name:"",upload_path:"",soc_name:"",root_bk_dir:"",init_path:"",full_path:"",checked_files:[],add_type:1,encoding:"UTF-8"},a.control.show_Ftp=!1):(a.info.app_fileupload={suffixs:"tar,zip,gz",filetype:"",filename:"",uploadpath:q},w())},a.changeConfigPackUploadType=function(b){1==b?(a.info.version_config_info={business_cn_name:c.business_cn_name?c.business_cn_name:"",upload_path:"",soc_name:"",root_bk_dir:"",init_path:"",full_path:"",checked_files:[],add_type:1,encoding:"UTF-8"},a.control.show_config_ftp=!1):(a.info.config_fileupload={suffixs:"tar,zip,gz",filetype:"",filename:"",uploadpath:r},a.submit_info.config_base.file_list=[],x())},a.changeAppSoc=function(){a.control.show_Ftp=!1,w()},a.changeConfigSoc=function(){a.control.show_config_ftp=!1,x()},a.changeFilePath=function(a){a.soc_name&&(a.loading=!0,j.getFileListBySoc(a.soc_name,a.full_path).then(function(b){a.loading=!1,a.path_files=b.file_bean_list||[]},function(b){a.loading=!1,a.err_msg=b.message}))},a.downloadAppPackFile=function(){a.submit_info.app_base.upload_path?m.downloadFile(a.submit_info.app_base.upload_path):l.alert("文件找不到")},a.removeVersionFile=function(){a.info.app_fileupload.filename=""},a.fileUploadSuccessThen=function(b){if(1==b)a.submit_info.app_base.upload_path=a.info.app_fileupload.uploadpath+a.info.app_fileupload.filename;else if(2==b){var c={file_name:a.info.config_fileupload.filename,file_path:a.info.config_fileupload.uploadpath+a.info.config_fileupload.filename};a.submit_info.config_base.file_list.push(c),a.info.config_fileupload={suffixs:"tar,zip,gz",filetype:"",filename:"",uploadpath:r}}},a.downloadConfigPackage=function(a){a?m.downloadFile(a.file_path):l.alert("文件找不到")},a.removeConfigPackage=function(b){a.submit_info.config_base.file_list.splice(b,1)},a.calculateLayerHeight=function(){if(a.control.layers_loading){var b=p.offset().left-5,c=p.offset().top-5,d=$(window).height()-c-15,e=p.width()+40;return{top:c,left:b,height:d,width:e}}},a.save=function(){var b=y(),c=function(){a.control.layers_loading=!0,g.addOneVersion(b).then(function(b){a.control.layers_loading=!1,l.confirm("初始化成功，是否进入全量流列表").then(function(){a.cancel()})},function(b){l.alert(b.message),a.control.layers_loading=!1})};1==a.info.version_app_info.add_type&&!a.info.app_fileupload.filename||2==a.info.version_app_info.add_type&&0==a.info.version_app_info.checked_files.length?l.confirm("当前不存在目录信息，是否继续初始化？").then(function(){b.app_bean=null,c()}):c()},a.cancel=function(){f.go("version_full_stream_list")},$(window).resize(function(){b(function(){a.control.layers_loading&&a.calculateLayerHeight()},100)}),z()}]),versionCtrl.controller("pubStreamListCtrl",["$scope","$timeout","$state","Version","Modal",function(a,b,c,d,e){a.info={search_key_word:"",pub_stream_list:[]},a.control={loading:!1};var f=function(){a.control.loading=!0,d.getStreamListByKey(a.info.search_key_word,2).then(function(c){c&&b(function(){a.control.loading=!1,a.info.pub_stream_list=c.vsVersion_list||[]},0)},function(b){a.control.loading=!1,e.alert(b.message)})};a.clearKeyWord=function(){a.info.search_key_word=""},a.searchByKeyword=function(){a.control.loading=!0,d.getStreamListByKey(a.info.search_key_word,2).then(function(c){c&&b(function(){a.control.loading=!1,a.version.pub_stream_list=c.vsVersion_list||[]},0)},function(b){a.control.loading=!1,e.alert(b.message)})},a.goPubVersion=function(a){a.vsversion_id?c.go("version_pub_stream_detail",{sys_name:a.business_sys_name,version_id:a.vsversion_id}):e.alert("当前系统暂无发布流")},a.stopPrevent=function(a){a.stopPropagation()},f()}]),versionCtrl.controller("pubStreamDetailCtrl",["$scope","$timeout","$stateParams","$rootScope","$state","$interval","Monitor","Plan","Version","VersionStatus","ReleaseFileType","CodeMirrorOption","TempCompareData","ScrollBarConfig","Modal","CV","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r,s,t,u=1,v=[],w=c.version_id,x=c.sys_name,y="",z=1;a.config={scroll_y_config:n.Y(),scroll_xy_config:n.XY(),compare_left_config:{status:"left",compare_mode:!0},compare_right_config:{status:"right",compare_mode:!0},pkg_loading_config:{disabled_control:!1},configfile_loading_config:{disabled_control:!1}},a.compare_left_scroll={whileScrolling:function(){var a=Math.abs(this.mcs.top),b=Math.abs(this.mcs.left);B(0,a,b)}},a.compare_right_scroll={whileScrolling:function(){var a=Math.abs(this.mcs.top),b=Math.abs(this.mcs.left);B(1,a,b)}},a.tabs=[],a.flow_control={curr_index:0,curr_project_index:0,show_broken_line:!0},a.detailFileOptions=l.Properties(!0);var A=function(b){b||(a.version={version_list:[],full_version_list:[],compare_ver_num:"",compare_path:"",file_absolute_path:"",version_type:2}),a.package_input={key_word:""},a.search_info={search_list:[]},a.file_nodes={loading:!1,nodes:[],curr_fold_path:"",curr_file:{}},a.pack_file_tree={loading:!1,nodes:[],no_init_flag:!0,curr_fold_path:"",curr_file:{}},a.config_files_tree={loading:!1,nodes:[],no_init_flag:!0,curr_fold_path:"",curr_file:{}},a.manifest_files_tree={loading:!1,nodes:[],no_init_flag:!0,curr_fold_path:"",curr_file:{}},a.control={show_version_pop:!1,loading:!1,btn_list_show:!1,curr_btn_index:1,fold_tree_control:!1,show_fold_compare:!1,view_compare_mode:!1,fold_flag:!1,go_to_compare:!1,pub_fold_flag:!1,compare_pac_flag:!1,compare_full_flag:!0,compare_tar_flag:1,publish_back_btn:!1,download_loading:!1,pre_pub_flag:!1},a.file_control={refresh:!1,file_loading:!1,show_file_history:!1,codemethod_loading:!1,show_file_compare:!1,pack_file:{},config_file:{},manifest_file:{}},a.ip_data={pub_config_ip:"",back_config_ip:"",back_manifet_ip:"",back_config_ip_list:[],pub_config_ip_list:[],manifet_ip_list:[]},a.file_info={file_content:"",file_type:"",file_size:"",file_name:"",file_update_time:"",error_msg:"",version_num:""},a.config_file_info={file_content:"",file_type:"",file_size:"",file_name:"",file_update_time:"",error_msg:""},a.manifest_file_info={file_type:"",file_size:"",file_name:"",file_update_time:"",error_msg:""},a.pub_bak_list_compare={loading:!1,nodes:[],compare_path2:"",compare_path1:"",curr_fold_path:"",curr_file:{}},a.file_post_header={version_num:a.one_pub&&a.one_pub.version_num?a.one_pub.version_num:"",business_sys_name:x,absolute_path:"",encoding_type:"UTF-8",file_path:"",version_type:2}},B=function(a,b,c){var d=[$("#left_scroll_container"+u),$("#right_scroll_container"+u)],e=[b,c];t=t||0;for(var f=0;f<d.length;f++)t!==f&&a!==f&&d[f].mCustomScrollbar("scrollTo",e,{scrollInertia:10})},C=function(c,d){i.getPubStreamFileList(a.version.file_absolute_path+c,d).then(function(c){b(function(){a.config_files_tree.nodes=c.config_file_list||[],a.pack_file_tree.nodes=c.package_list||[],v=angular.copy(a.pack_file_tree.nodes),a.manifest_files_tree.nodes=c.manifest_list||[],a.pub_or_back_path=c.version_base_path||"",a.control.change_version_loading=!1},0)},function(b){a.control.change_version_loading=!1,o.alert(b.message)})},D=function(b){var c=1===b?"update":"backup",d=a.version.file_absolute_path+c;2===u&&1===b&&(d+="/config"),i.getIpBypath(d).then(function(c){if(a.compare_view_info.bak_pac_ip_list=[],a.ip_data.pub_config_ip_list=[],a.ip_data.manifet_ip_list=[],1===u||0===u){for(var d=c.ip_list||[],e=0;e<d.length;e++){var f={key:d[e],value:d[e]};a.compare_view_info.bak_pac_ip_list.push(f)}a.compare_view_info.bak_ip=a.compare_view_info.bak_pac_ip_list.length>1?a.compare_view_info.bak_pac_ip_list[0].key:"",a.compare_view_info.bak_pac_ip_list.length>1&&a.selectBakPacIp(a.compare_view_info.bak_ip)}else 2===u?(a.ip_data.pub_config_ip_list=c.ip_list||[],a.ip_data.pub_config_ip=c.ip_list?c.ip_list[0]:"",a.ip_data.pub_config_ip_list.length>1&&a.selectConfigOrListIp(a.ip_data.pub_config_ip,b)):2===b&&(a.ip_data.manifet_ip_list=c.ip_list||[],a.ip_data.back_manifet_ip=c.ip_list?c.ip_list[0]:"",a.ip_data.manifet_ip_list.length>1&&a.selectConfigOrListIp(a.ip_data.back_manifet_ip,b))})},E=function(a,b){a=a||[];var c=[];return angular.forEach(a,function(a,d){b!==d&&(d===b+1?c.unshift({version_num:a.version_num,version_view:"与前版本比对"}):d===b-1&&0!==d?c.unshift({version_num:a.version_num,version_view:"与后版本比对"}):0!==d&&c.push({version_num:a.version_num,version_view:a.version_num}))}),a.length&&0!==b&&c.unshift({version_num:a[0].version_num,version_view:"与最新版本比对"}),c},F=function(b){b&&(a.detailFileOptions=l.Properties(!0),5===b&&(a.detailFileOptions=l.Sh(!0)),14===b&&(a.detailFileOptions=l.Sql(!0)),15===b&&(a.detailFileOptions=l.Python(!0)),16===b&&(a.detailFileOptions=l.Java(!0)))},G=function(){a.file_control.refresh=!1,b(function(){a.file_control.refresh=!1},50)},H=function(){var b;switch(u){case 1:b=a.control.fold_flag?a.file_nodes.curr_file:a.pack_file_tree.curr_file;break;case 2:b=a.config_files_tree.curr_file;break;case 3:b=a.manifest_files_tree.curr_file;break;default:b=a.file_nodes.curr_file}return b},I=function(a,b){a.error_msg="",a.file_content=b.file_content?Base64.decode(b.file_content).trim():"",a.file_size=b.file_size||"",a.file_update_time=b.file_update_time||""},J=function(c){var d=a.file_control.codemethod_loading;switch(a.file_control.file_loading=!d,d||(1===u&&(a.file_info.file_content=""),2===u&&(a.config_file_info.file_content="")),a.file_post_header.file_path=1===c?a.file_nodes.curr_file.relate_path:"",a.file_post_header.version_type=1===c?2:3,a.control.pre_pub_flag&&(a.file_post_header.version_num=a.version.pre_pub_ver),c){case 1:a.file_post_header.absolute_path=a.file_nodes.curr_file.file_path+"/";break;case 2:a.file_post_header.absolute_path=a.config_files_tree.curr_file.file_path+"/"+a.config_files_tree.curr_file.file;break;case 3:a.file_post_header.absolute_path=a.manifest_files_tree.curr_file.file_path+"/"+a.manifest_files_tree.curr_file.file;break;case 4:a.file_post_header.absolute_path=a.pack_file_tree.curr_file.file_path+"/"+a.pack_file_tree.curr_file.file;break;default:a.file_post_header.absolute_path=a.file_nodes.curr_file.file_path+"/"}i.viewfileContent(a.file_post_header).then(function(d){d&&b(function(){switch(c){case 1:case 4:I(a.file_info,d);break;case 2:I(a.config_file_info,d);break;case 3:I(a.manifest_file_info,d);break;default:I(a.file_info,d)}a.file_control.file_loading=!1,a.file_control.codemethod_loading=!1,a.file_control.refresh=!0},0)},function(b){a.file_control.file_loading=!1,a.file_control.codemethod_loading=!1,a.file_info.error_msg=b.message,a.config_file_info.error_msg=b.message,a.manifest_file_info.error_msg=b.message})},K=function(){A(),a.control.loading=!0,i.getOnePub(w).then(function(c){c&&b(function(){a.control.loading=!1,a.one_pub=c.vsInfoDetailbean||{},a.version.file_absolute_path=c.vsInfoDetailbean.remote_path||"",a.one_pub.v_status_cn=p.findValue(c.vsInfoDetailbean.version_status,j),a.file_info.version_num=c.vsInfoDetailbean.version_num,a.file_post_header.version_num=c.vsInfoDetailbean.version_num,a.version.version_list=E(c.compare_version_list,0),C("update",1),i.getfileVersionNum({busisys_name:x,version_type:1}).then(function(c){b(function(){a.version.full_version_list=c.version_list||[]},0)},function(a){o.alert(a.message)})},0)},function(b){o.alert(b.message),a.control.loading=!1,a.control.version_view=!1}),a.goData={project_data:[],publish_data:[],real_project_data:[]},i.getPubData(x).then(function(b){a.goData.project_data=b.project_data||[],a.goData.publish_data=b.publish_data||[],a.goData.publish_data.length&&(a.goData.publish_data[0].is_checked=!0);for(var c=0,d=0;d<a.goData.project_data.length;d++){var e=a.goData.project_data[d];e.sys_publish_status>1&&e.sys_publish_status<4&&(c++,a.goData.real_project_data.push(e))}0===c&&(a.flow_control.show_broken_line=!1)},function(a){o.alert(a.message)})};a.projLineStyle=function(){return{height:50*q("getProjStateGreaterThanThree")(a.goData.project_data).length+90+"px"}},a.endHollowLind=function(){return{top:50*q("getProjStateGreaterThanThree")(a.goData.project_data).length+62+44+"px",position:"absolute",left:"-10px"}},a.hollowHeight=function(){return{height:50*q("getProjStateGreaterThanThree")(a.goData.project_data).length+62+"px"}},a.projCircleStyle=function(a){return{position:"absolute",left:"-7px",cursor:"pointer",bottom:50*(a+1)+"px"}},a.publishCircleStyle=function(b){return{position:"absolute",height:"70px",width:"4px",background:"#44dcfd",left:"-2px",top:50*q("getProjStateGreaterThanThree")(a.goData.project_data).length+127+70*b+"px"}},a.showBtnList=function(){a.control.btn_list_show=!a.control.btn_list_show},a.backPubStreamList=function(){e.go("version_pub_stream_list"),m.clearList()},a.showVersionPop=function(){a.control.show_version_pop=!a.control.show_version_pop},a.comparePubVersion=function(b,c){a.control.show_version_pop=!1,a.control.version_flag=!0,b&&(a.version.compare_ver_num=c.version_num,a.version.compare_path=a.version.file_absolute_path.replace(a.one_pub.version_num,c.version_num),a.control.show_full_compare_flag=!1,a.control.show_pub_compare_flag=!1),a.control.show_fold_compare=b},a.changeVersion=function(c){a.control.pre_pub_flag=!1,a.goData.real_project_data.length&&(a.goData.real_project_data[a.flow_control.curr_project_index].is_checked=!1);var d=a.flow_control.curr_index;if(c!==d||!a.control.pre_pub_flag){a.goData.publish_data[d].is_checked=!1,a.goData.publish_data[c].is_checked=!0,a.flow_control.curr_index=c,m.clearList();var e=a.goData.publish_data[c].vsversion_id;a.control.change_version_loading=!0,i.getOnePub(e).then(function(d){d&&b(function(){A(),v=[],y="",a.tabs[0]=!0,a.changeFileMethod(1),a.control.loading=!1,a.control.version_view=!0,a.one_pub=d.vsInfoDetailbean||{},a.version.file_absolute_path=d.vsInfoDetailbean.remote_path||"",a.one_pub.v_status_cn=p.findValue(d.vsInfoDetailbean.version_status,j),a.file_info.version_num=d.vsInfoDetailbean.version_num,a.file_post_header.version_num=d.vsInfoDetailbean.version_num,a.version.version_list=E(d.compare_version_list,c),C("update",1),i.getfileVersionNum({busisys_name:x,version_type:1}).then(function(c){b(function(){a.version.full_version_list=c.version_list||[]},0)},function(a){o.alert(a.message)})},0)},function(b){a.control.change_version_loading=!1,o.alert(b.message)})}},a.switchBackAndpub=function(b,c){if(a.control.btn_list_show=!1,a.control.curr_btn_index==c)return!1;A(!0),a.control.view_compare_mode=!1,a.control.fold_tree_control=!1,a.control.publish_back_btn=b,a.control.fold_flag=!1;var d=b?2:1,e=b?"backup":"update";a.control.curr_btn_index=d,C(e,d)},a.filterPackage=function(){a.pack_file_tree.nodes=[],b(function(){a.pack_file_tree.nodes=q("filter")(angular.copy(v),{file:a.package_input.key_word})},50)},a.filterFile=function(){a.search_info.search_list=[],a.package_input.key_word?(a.control.search_mode_flag=!0,a.search_info.loading=!0,i.searchFile(r,a.package_input.key_word,a.package_input.relate_path,!0).then(function(b){a.search_info.search_list=b.file_list?b.file_list:[],a.search_info.loading=!1},function(a){o.alert(a.message)})):(a.control.search_mode_flag=!1,a.file_nodes.curr_file.relate_path=a.package_input.relate_path)},a.getDetailFold=function(b){a.search_info.search_list=[],a.control.search_mode_flag=!1,a.file_nodes.curr_file.relate_path=b.substring(0,b.lastIndexOf("/")+1)},a.packageDetail=function(b,c){if(!b.curr_file.dir)if(b.curr_file.file_type>=9&&b.curr_file.file_type<=13)a.file_info={file_content:"",file_type:"",file_size:"",file_name:"",file_update_time:"",error_msg:"",version_num:""},a.control[c]=!0;else{var d=b.curr_file,e=d.file_type;a.file_info.file_type=e,a.file_control.pack_file.has_file_icon=e>=1&&4>e,a.file_control.pack_file.is_excel=2==e||3==e,a.file_control.pack_file.un_view=e>8&&14>e||a.file_control.pack_file.is_excel,a.file_control.pack_file.show_file=(!e||e&&!(e>8&&14>e))&&d.hasOwnProperty("dir")&&!d.dir,F(e),!d.dir&&(9>e||e>13||angular.isUndefined(e))&&(a.file_info.file_name=d.file||"",J(4))}},a.getRootFile=function(b,c,d){return a.control[d]?i.getFoldInTarPac(r,c.curr_file.relate_path,a.one_pub.business_sys_name).then(function(b){return c.curr_file=b.file_bean||{},c.curr_file.file_path=c.curr_file.tar_path,a.control.down_btn=!0,b.file_list||[]},function(a){o.alert(a.message)}):(r=b.curr_file.file_path+"/"+b.curr_file.file,i.getPubStreamFold(b.curr_file.file_path+"/"+b.curr_file.file,a.one_pub.business_sys_name).then(function(b){a.control[d]=!0,c.curr_file=b.file_bean||{};var e=c.curr_file.file?-1==c.curr_file.file.lastIndexOf(".")?0:p.findKey(c.curr_file.file.substring(c.curr_file.file.lastIndexOf(".")+1),k):"";c.curr_file.file_type=e;var f=angular.copy(c.curr_file);return f.dir=!0,f.nodes=b.file_list||[],a.package_input.relate_path=b.file_list&&0!=b.file_list.length?b.file_list[0].relate_path:"",[f]},function(a){o.alert(a.message)}))},a.getPacConfigListFold=function(a,b){return i.getFoldTree(a.curr_fold_path,!1).then(function(c){a.curr_file=c.file_bean||{};var d=c.version_base_path.split("/");if(7==d.length){c.file_list=c.file_list||[];for(var e=0;e<c.file_list.length;e++){var f=c.file_list[e];if(f.file==b)return[f]}return c.file_list||[]}return c.file_list||[]},function(a){o.alert(a.message)})},a.expandPkgfold=function(){a.control.fold_flag&&(a.control.fold_flag=!1,a.control.fold_tree_control=!1,a.control.down_btn=!1,a.package_input.key_word="",a.file_nodes={loading:!1,nodes:[],curr_fold_path:"",curr_file:{}},a.file_info={file_content:"",file_type:"",file_size:"",file_name:"",file_update_time:"",error_msg:"",version_num:""})},a.getPubConfigFileByIp=function(b,c){var d=a.control.publish_back_btn?b.curr_fold_path+"/"+c:b.curr_fold_path;return i.getConfigFileByIp(d).then(function(a){return b.curr_file=a.file_bean||{},a.file_list||[]},function(a){o.alert(a.message)})},a.selectBakPacIp=function(c){var d=a.version.file_absolute_path+"backup/"+c;a.pub_bak_nodes.compare_path1=s,a.pub_bak_nodes.nodes=[],a.pub_bak_nodes.compare_path2=d,a.control.pub_fold_flag=!1,a.control.compare_tar_flag=1,b(function(){a.pub_bak_nodes.compare_path1&&a.pub_bak_nodes.compare_path2&&(a.pub_bak_nodes.nodes=[],a.control.pub_fold_flag=!0,z=1)},500)},a.switchViewToCompare=function(c,d){return a.control.btn_list_show=!1,a.control.curr_btn_index==d?!1:(a.control.curr_btn_index=0,a.control.pub_fold_flag=!1,a.control.config_control=!1,a.control.list_control=!1,a.pub_manifest_tree={loading:!1,nodes:[],no_init_flag:!0,curr_fold_path:"",curr_file:{}},a.bak_manifest_tree={loading:!1,nodes:[],curr_fold_path:"",curr_file:{}},a.pub_bak_nodes={loading:!1,nodes:[],compare_path2:"",compare_path1:"",curr_fold_path:"",curr_file:{}},a.compare_view_info={bak_ip:"",pack_list:[],bak_pac_ip_list:[],back_package_list:[]},a.pub_bak_list_compare={loading:!1,nodes:[],compare_path2:"",compare_path1:"",curr_fold_path:"",curr_file:{}},a.control.view_compare_mode=c,void(a.control.view_compare_mode&&(u=0,i.getPubStreamFileList(a.version.file_absolute_path+"update",1).then(function(c){b(function(){a.compare_view_info.package_list=c.package_list?c.package_list:[],a.pub_bak_nodes.compare_path1=s=c.package_list?a.version.file_absolute_path+"update/pkg":"",a.pub_manifest_tree.nodes=c.manifest_list?c.manifest_list:[]},0)},function(a){o.alert(a.message)}))))},a.pubBakTreeCompare=function(){return i.pubAndBakTreeCompare(a.pub_bak_nodes.compare_path1,a.pub_bak_nodes.compare_path2,z,1,a.one_pub.business_sys_name).then(function(b){
return a.control.compare_tar_flag=2,z=3,a.pub_bak_nodes.curr_file=b.file_bean||{},b.diff_list||[]},function(a){o.alert(a.message)})},a.goCompare=function(){var b=angular.copy(a.pub_bak_nodes.temp);a.$broadcast(a.pub_bak_nodes.curr_fold_path,b)},a.goCompareList=function(){var b=angular.copy(a.pub_bak_list_compare.temp);a.$broadcast(a.pub_bak_list_compare.curr_fold_path,b)},a.viewPrePubVersion=function(c){A(),a.control.loading=!1,a.goData.publish_data[a.flow_control.curr_index].is_checked=!1;var d=a.flow_control.curr_project_index;a.control.pre_pub_flag=!0,(c!==d||a.control.pre_pub_flag)&&(d>=0&&(a.goData.real_project_data[d].is_checked=!1),a.goData.real_project_data[c].is_checked=!0,a.flow_control.curr_project_index=c,m.clearList(),i.getPubVersionList(a.one_pub.business_sys_name).then(function(b){a.version.version_list=b.pub_num_list||[],a.version.full_version_list=b.full_num_list||[]},function(a){o.alert(a.message)}),a.version.pre_pub_path="/bank/"+a.one_pub.business_sys_name+"/pretags/"+a.one_pub.business_sys_name+a.goData.real_project_data[c].project_name+"/update",a.version.pre_project_name=a.goData.real_project_data[c].project_name,a.version.pre_pub_ver=a.one_pub.business_sys_name+a.goData.real_project_data[c].project_name,a.control.change_version_loading=!0,i.getPubStreamFileList(a.version.pre_pub_path,1).then(function(c){b(function(){a.config_files_tree.nodes=c.config_file_list||[],a.pack_file_tree.nodes=c.package_list||[],v=angular.copy(a.pack_file_tree.nodes),a.manifest_files_tree.nodes=c.manifest_list||[],a.pub_or_back_path=c.version_base_path||"",a.control.change_version_loading=!1},0)},function(b){a.control.change_version_loading=!1,o.alert(b.message)}))},a.showFoldCompareList=function(b){1==b?(a.control.show_full_compare_flag=!1,a.control.show_pub_compare_flag=!a.control.show_pub_compare_flag):(a.control.show_pub_compare_flag=!1,a.control.show_full_compare_flag=!a.control.show_full_compare_flag)},a.startFoldCompare=function(b,c,d,e){b?(a.control.compare_full_flag=1==d?!1:!0,a.version.compare_path1=r,a.version.compare_ver_num=c.version_num,a.version.compare_path=1==d?r:"/bank/"+a.one_pub.business_sys_name+"/fulltags/"+a.one_pub.version_num+"/app",a.control.compare_pac_flag=!0,e.stopPropagation()):a.control.compare_pac_flag=!1,a.control.show_fold_compare=b,a.control.show_full_compare_flag=!1,a.control.show_pub_compare_flag=!1},a.pubListTreeCompare=function(){return i.foldTreeCompare(a.pub_bak_list_compare.compare_path1,a.pub_bak_list_compare.compare_path2).then(function(b){return a.pub_bak_list_compare.curr_file=b.file_bean||{},b.diff_list?b.diff_list:[]},function(a){o.alert(a.message)})},a.changeFileMethod=function(b,c){if(u!==b){switch(u=b,a.file_post_header.encoding_type="UTF-8",b){case 1:a.file_post_header.version_type=2;break;case 2:case 3:a.file_post_header.version_type=3}c&&D(2===u?1:2),G()}},a.formatFileIconStyle=function(){var b="",c=a.file_info.file_type;return 2==u?c=a.config_file_info.file_type:3==u&&(c=a.manifest_file_info.file_type),1==c?b="txt-icon":2==c||3==c?b="excel-icon":9==c&&(b="tar-icon"),b},a.getFileContent=function(b,c,d,e,f){if(f){var g=-1==f.file.lastIndexOf(".")?0:p.findKey(f.file.substring(f.file.lastIndexOf(".")+1),k);a.file_nodes.curr_file={file_path:f.file_path,relate_path:f.relate_path,file:f.file,file_type:g,dir:!1,modify_time:""}}var h=b.curr_file,i=h.file_type;c.file_type=i,a.file_control[d]={has_file_icon:i>=1&&4>i,is_excel:2==i||3==i,un_view:i>8&&14>i||2==i||3==i,show_file:(!i||i&&!(i>8&&14>i))&&h.hasOwnProperty("dir")&&!h.dir},F(i),!h.dir&&(9>i||i>13||angular.isUndefined(i))&&(c.file_name=h.file||"",J(e))},a.selectConfigOrListIp=function(c){2===u&&(a.pub_bak_list_compare.compare_path1=a.version.file_absolute_path+"update/config/"+c,a.pub_bak_list_compare.compare_path2=a.version.file_absolute_path+"backup/"+c+"/config"),3===u&&(a.bak_manifest_tree.curr_fold_path=a.version.file_absolute_path+"backup/"+a.ip_data.back_manifet_ip+"/list"),a.control.config_control=!1,a.control.list_control=!1,b(function(){a.pub_bak_list_compare.compare_path1&&a.pub_bak_list_compare.compare_path2&&2===u&&(a.pub_bak_list_compare.nodes=[],a.control.config_control=!0),a.bak_manifest_tree.curr_fold_path&&3===u&&(a.control.list_control=!0)},200)},a.dbClickCompareFile=function(){a.curr_file_info={file_size:"",file_update_time:"",file_absolute_path:1===u?a.pub_bak_nodes.compare_path1:a.pub_bak_list_compare.compare_path1,compare_path:1===u?a.pub_bak_nodes.compare_path2:a.pub_bak_list_compare.compare_path2,curr_version_num:a.one_pub.version_num,compare_version_num:a.one_pub.version_num,is_pub_compare:!0},a.file_control.show_file_compare=!0},a.changeCodeMethod=function(b){y=a.file_post_header.encoding_type,"UTF-8"===y?a.file_post_header.encoding_type="GBK":a.file_post_header.encoding_type="UTF-8",a.file_control.codemethod_loading=!0,J(b)},a.fullScreen=function(){var b={1:a.file_info,2:a.config_file_info,3:a.manifest_file_info};o.fileContentFullScreen(b[u],a.file_post_header,x)},a.viewHistory=function(){var b=H();b&&(a.file_header={file_path:b.file_path,file_name:b.file,file_type:b.file_type,pkg_file_path:a.file_post_header.file_path,version_num:a.file_post_header.version_num,busisys_name:a.one_pub.business_sys_name,version_type:2,view_file_flag:1===u&&a.control.fold_flag?2:1},a.file_control.show_file_history=!0)},a.selectSingleVersion=function(b){var c=H();c&&(a.curr_file_info={file_size:c.file_size,file_update_time:c.file_update_time,file_absolute_path:1===u?r:a.file_post_header.absolute_path,pkg_file_path:a.file_post_header.file_path,curr_version_num:a.file_post_header.version_num,compare_version_num:b},a.file_control.show_file_compare=!0)},a.fileCompareReturn=function(b){a.curr_file_info.is_fold_compare?($("#fold-compare").removeClass("ng-hide").addClass("ng-show"),a.file_control.show_file_compare=!1):a.file_control.show_file_compare=!1,a.curr_file_info.is_single_detail&&(a.file_control.show_file_compare=!1,$("#file-history").removeClass("ng-hide").addClass("ng-show")),b||m.clearList()},a.downloadFile=function(c){if(c){var d,e;if(1===c)d={file_absolute_path:a.version.file_absolute_path,is_dir:!0};else if(4===c){switch(u){case 1:e=a.pub_or_back_path;break;case 2:e=a.pub_or_back_path;break;case 3:e=a.pub_or_back_path}d={file_absolute_path:e,is_dir:!0}}else{var f=H();if(!f)return;d=5===c||6===c?{file_absolute_path:f.file_path,is_dir:f.dir,file_path:f.relate_path}:{file_absolute_path:f.file_path+"/"+f.file,is_dir:f.dir}}angular.extend(d,{version_num:a.one_pub.version_num},{business_sys_name:x}),a.control.download_loading=!0,i.downloadFile(d).then(function(c){b(function(){a.control.download_loading=!1,c.download_url&&p.downloadFile(c.download_url)},0)},function(b){a.control.download_loading=!1,o.alert(b.message)})}},a.pacDownloadFile=function(){var c={file_absolute_path:r,is_dir:!1,version_num:a.one_pub.version_num,business_sys_name:x};a.control.download_loading=!0,i.downloadFile(c).then(function(c){b(function(){a.control.download_loading=!1,c.download_url&&p.downloadFile(c.download_url)},0)},function(b){a.control.download_loading=!1,o.alert(b.message)})},a.batchDownloadFile=function(c){if(c){var d={version_num:a.one_pub.version_num,business_sys_name:x,file_absolute_path:"",is_dir:!0};1===u&&(1===c?d.file_absolute_path=a.version.file_absolute_path+"update/pkg/":d.file_absolute_path=a.version.file_absolute_path+"backup/"+a.compare_view_info.bak_ip+"/pkg/"),2===u&&(1===c?d.file_absolute_path=a.version.file_absolute_path+"update/config/"+a.ip_data.pub_config_ip:d.file_absolute_path=a.version.file_absolute_path+"backup/"+a.ip_data.pub_config_ip+"/config"),3===u&&(1===c?d.file_absolute_path=a.version.file_absolute_path+"update/list":d.file_absolute_path=a.version.file_absolute_path+"backup/"+a.ip_data.back_manifet_ip+"/list"),i.downloadFile(d).then(function(a){b(function(){a.download_url&&p.downloadFile(a.download_url)},0)},function(a){o.alert(a.message)})}},a.fileHistoryReturn=function(){a.file_control.show_file_history=!1},a.leftScrollBarMouseover=function(){t=0},a.rightScrollBarMouseover=function(){t=1},a.$on("compareFile",function(b,c){a.curr_file_info=c}),d.$on("$stateChangeSuccess",function(){m.clearList()}),K()}]),versionCtrl.controller("fullStreamListCtrl",["$scope","$timeout","$state","$rootScope","$interval","Version","Modal",function(a,b,c,d,e,f,g){var h;a.info={search_key_word:"",full_stream_list:[]},a.control={loading:!1,refresh:!1};var i=function(a){for(var b=!1,c=0;c<a.length;c++)if(4==a[c].version_status){b=!0;break}return b},j=function(){f.getStreamListByKey(a.info.search_key_word,1).then(function(c){c&&b(function(){a.control.loading=!1,a.info.full_stream_list=c.vsVersion_list||[],a.control.refresh=i(a.info.full_stream_list)},0)},function(b){g.alert(b.message),a.control.loading=!1}),a.control.refresh=i(a.info.full_stream_list)},k=function(){a.control.loading=!0,j(),h=e(function(){a.control.refresh&&j()},5e3)};a.clearKeyWord=function(){a.info.search_key_word=""},a.searchByKeyword=function(){a.control.loading=!0,f.getStreamListByKey(a.info.search_key_word,1).then(function(c){b(function(){a.control.loading=!1,a.info.full_stream_list=c.vsVersion_list||[]},0)},function(b){a.control.loading=!1,g.alert(b.message)})},a.goFullStreamDetail=function(a){a.vsversion_id?c.go("version_full_stream_detail",{sys_name:a.business_sys_name,version_id:a.vsversion_id}):c.go("version_new",{sys_name:a.business_sys_name,sys_cn_name:a.business_cn_name})},a.stopPrevent=function(a){a.stopPropagation()},d.$on("$stateChangeSuccess",function(){b(function(){e.cancel(h)},1e3)}),k()}]),versionCtrl.controller("fullStreamDetailCtrl",["$scope","$timeout","$stateParams","$rootScope","$cookieStore","$state","$interval","Monitor","Plan","Version","VersionStatus","CodeMirrorOption","ReleaseFileType","TempCompareData","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=c.version_id,s=c.sys_name,t="",u=[];a.config={scroll_config:o.Y(),scroll_xy_config:o.XY()},a.detailFileOptions=l.Properties(!0);var v=function(){a.version={compare_path:"",compare_ver_num:"",one_pub:{},version_list:[],search_file_word:"",file_absolute_path:"",version_type:1},a.search_info={search_list:[]},a.file_nodes={loading:!1,nodes:[],curr_fold_path:"",curr_file:{}},a.control={show_version_flag:!1,loading:!1,show_fold_compare:!1,fold_show_compare_flag:!1,search_mode_flag:!1,download_loading:!1},a.file_control={refresh:!1,un_view:!1,show_file:!1,file_loading:!1,show_file_history:!1,codemethod_loading:!1,show_file_compare:!1},a.curr_file_info={file_size:"",file_update_time:"",file_absolute_path:"",curr_version_num:"",compare_version_num:""},a.file_info={file_content:"",file_type:"",file_size:"",file_name:"",file_update_time:"",error_msg:"",version_num:""},a.file_post_header={business_sys_name:s,version_num:"",version_soc_name:"",absolute_path:"",encoding_type:"UTF-8",version_type:1}},w=function(a){for(var b=0,c=0;c<u.length;c++)if(a===u[c].vsversion_id){b=c;break}return b},x=function(a,b){a=a||[];var c=[];return angular.forEach(a,function(a,d){b!==d&&(d===b+1?c.unshift({version_num:a.version_num,version_view:"与前版本比对"}):d===b-1&&0!==d?c.unshift({version_num:a.version_num,version_view:"与后版本比对"}):0!==d&&c.push({version_num:a.version_num,version_view:a.version_num}))}),a.length&&0!==b&&c.unshift({version_num:a[0].version_num,version_view:"与最新版本比对"}),c},y=function(b){b&&(5===b&&(a.detailFileOptions=l.Sh(!0)),14===b&&(a.detailFileOptions=l.Sql(!0)),15===b&&(a.detailFileOptions=l.Python(!0)),16===b&&(a.detailFileOptions=l.Java(!0)))},z=function(){var b=a.file_control.codemethod_loading;a.file_control.file_loading=!b,b||(a.file_info.file_content=""),a.file_post_header.absolute_path=a.file_nodes.curr_file.file_path+"/"+a.file_nodes.curr_file.file,j.viewfileContent(a.file_post_header).then(function(b){a.file_info.file_content=b.file_content?Base64.decode(b.file_content).trim():"",a.file_info.file_size=b.file_size?b.file_size:"",a.file_info.file_update_time=b.file_update_time?b.file_update_time:"",a.file_control.file_loading=!1,a.file_control.codemethod_loading=!1,a.file_control.refresh=!0,a.file_info.error_msg=""},function(b){a.file_control.file_loading=!1,a.file_control.codemethod_loading=!1,a.file_info.error_msg=b.message})},A=function(){v(),j.getOnePub(r).then(function(c){c&&b(function(){a.control.loading=!1,a.one_pub=c.vsInfoDetailbean,a.version.file_absolute_path=c.vsInfoDetailbean.remote_path?c.vsInfoDetailbean.remote_path.substring(0,c.vsInfoDetailbean.remote_path.lastIndexOf("/")):"",a.one_pub.v_status_cn=q.findValue(c.vsInfoDetailbean.version_status,k),a.version.version_list=x(c.compare_version_list,0),a.file_info.version_num=c.vsInfoDetailbean.version_num,a.file_post_header.version_num=c.vsInfoDetailbean.version_num},0)},function(a){f.go("version_full_stream_list"),p.alert(a.message)}),a.goData={nodeDataArray:[],linkDataArray:[]},j.getflowData(s).then(function(b){var c=0,d=[],e=[];u=b.full_data?b.full_data:[],a.goData.nodeDataArray.push({key:-1,isGroup:!0,category:"OfGroups",color:"#FC9E22",data:"全量流"}),a.goData.nodeDataArray.push({key:-2,isGroup:!0,category:"OfGroups",color:"#44dcfd",data:"发布流"});var f=b.publish_data?b.publish_data.length:0,g=b.full_data?b.full_data.length:0,h=g>f?g:f;a.linkLength=120*h+80;for(var i=0;g>i;i++){var j=b.full_data[i];a.goData.nodeDataArray.push({key:c,isGroup:!0,category:"OfNodes",group:-1,date_time:j.date_time.replace(/-/g,".").substring(0,16),version_number:j.full_version_number,proj_cn_name:""}),c++,a.goData.nodeDataArray.push({key:c,isGroup:!1,category:"node",group:c-1,color:"#FC9E22",select:0==i?!0:!1,pid:j.pid,vsversion_id:j.vsversion_id}),d.push({key:c,pid:j.pid,vsversion_id:j.vsversion_id}),c++}for(var k=0;f>k;k++){var l=b.publish_data[k];a.goData.nodeDataArray.push({key:c,isGroup:!0,category:"OfNodes",group:-2,date_time:l.date_time.replace(/-/g,".").substring(0,16),version_number:l.publish_version_number,proj_cn_name:l.proj_cn_name}),c++,a.goData.nodeDataArray.push({key:c,isGroup:!1,category:"node",group:c-1,color:"#44dcfd",select:!1,pid:l.pid,operasion_user_name:l.operasion_user_name,proj_cn_name:l.proj_cn_name,date_time:l.date_time.replace(/-/g,".").substring(0,16),vsversion_id:l.vsversion_id}),e.push({key:c,pid:l.pid,vsversion_id:l.vsversion_id}),c++}for(var m=0;m<e.length;m++)for(var n=e[m],o=0;o<d.length;o++){var p=d[o];n.pid==p.vsversion_id&&a.goData.linkDataArray.push({from:n.key,to:p.key}),n.vsversion_id==p.pid&&a.goData.linkDataArray.push({to:n.key,from:p.key})}},function(a){p.alert(a.message)})};a.backFullStreamList=function(){f.go("version_full_stream_list"),n.clearList()},a.showVersionList=function(){a.control.show_version_flag=!a.control.show_version_flag},a.changeVersion=function(c){var d=w(c);a.control.change_version_loading=!0,n.clearList(),j.getOnePub(c).then(function(c){c&&b(function(){v(),a.one_pub=c.vsInfoDetailbean,a.version.file_absolute_path=c.vsInfoDetailbean.remote_path?c.vsInfoDetailbean.remote_path.substring(0,c.vsInfoDetailbean.remote_path.lastIndexOf("/")):"",a.one_pub.v_status_cn=q.findValue(c.vsInfoDetailbean.version_status,k),a.version.version_list=x(c.compare_version_list,d),a.file_info.version_num=c.vsInfoDetailbean.version_num,a.file_post_header.version_num=c.vsInfoDetailbean.version_num,a.control.change_version_loading=!1},0)},function(b){a.control.change_version_loading=!1,p.alert(b.message)})},a.getRootFile=function(){return a.file_nodes.curr_fold_path=a.file_nodes.curr_fold_path?a.file_nodes.curr_fold_path:a.version.file_absolute_path,j.getFoldTree(a.file_nodes.curr_fold_path).then(function(b){return a.file_nodes.curr_file=b.file_bean?b.file_bean:{},b.file_list?b.file_list:[]},function(a){return a})},a.searchFile=function(){a.search_info.search_list=[],a.version.search_file_word?(a.control.search_mode_flag=!0,a.search_info.loading=!0,j.searchFile(a.version.file_absolute_path,a.version.search_file_word).then(function(b){a.search_info.search_list=b.file_list?b.file_list:[],a.search_info.loading=!1},function(a){p.alert(a.message)})):(a.control.search_mode_flag=!0,b(function(){a.control.search_mode_flag=!1},0),a.file_nodes.curr_fold_path=a.version.file_absolute_path)},a.getDetailFold=function(b){a.search_info.search_list=[],a.control.search_mode_flag=!1,a.file_nodes.curr_fold_path=b},a.showFoldCompareList=function(){a.control.fold_show_compare_flag=!a.control.fold_show_compare_flag},a.startFoldCompare=function(b,c){a.control.version_flag=!1,b&&(a.version.compare_ver_num=c.version_num,a.version.compare_path=a.file_nodes.curr_fold_path.replace(a.file_info.version_num,c.version_num),a.control.show_version_flag=!1),a.control.show_fold_compare=b,a.control.fold_show_compare_flag=!1},a.comparePubVersion=function(b,c){a.control.version_flag=!0,b&&(a.version.compare_ver_num=c.version_num,a.version.compare_path=a.version.file_absolute_path.replace(a.file_info.version_num,c.version_num)),a.control.show_fold_compare=b,a.control.show_version_flag=!1,a.control.fold_show_compare_flag=!1},a.formatFileIconStyle=function(){var b="";return 1==a.file_info.file_type?b="txt-icon":(2==a.file_info.file_type||3==a.file_info.file_type)&&(b="excel-icon"),b},a.getFileContent=function(b){if(b){var c=-1==b.file.lastIndexOf(".")?0:q.findKey(b.file.substring(b.file.lastIndexOf(".")+1),m);a.file_nodes.curr_file={file_path:b.file_path,relate_path:b.relate_path,file:b.file,file_type:c,dir:!1,modify_time:""}}var d=a.file_nodes.curr_file.file_type;a.file_info.file_type=d,a.file_control.has_file_icon=d>=1&&4>d,a.file_control.is_excel=2==d||3==d,a.file_control.un_view=d>8&&14>d||a.file_control.is_excel,a.file_control.show_file=(!d||d&&!(d>8&&14>d))&&a.file_nodes.curr_file&&!a.file_nodes.curr_file.dir,y(d),!a.file_nodes.curr_file.dir&&(9>d||d>13||angular.isUndefined(d))&&(a.file_info.file_name=a.file_nodes.curr_file.file||"",z())},a.fullScreen=function(){p.fileContentFullScreen(a.file_info,a.file_post_header,s)},a.viewHistory=function(b){a.file_control.show_file_history=!0,a.file_header={file_path:a.file_nodes.curr_file.file_path,file_name:a.file_nodes.curr_file.file,file_type:a.file_info.file_type,version_soc_name:a.file_post_header.version_soc_name,version_num:a.file_post_header.version_num,busisys_name:a.one_pub.business_sys_name,version_type:b}},a.changeCodeMethod=function(){t=a.file_post_header.encoding_type,"UTF-8"===t?a.file_post_header.encoding_type="GBK":a.file_post_header.encoding_type="UTF-8",a.file_control.codemethod_loading=!0,z()},a.selectSingleVersion=function(b){a.file_control.show_file_compare=!0,a.curr_file_info={file_size:a.file_info.file_size,file_update_time:a.file_info.file_update_time,file_absolute_path:a.file_post_header.absolute_path,curr_version_num:a.file_post_header.version_num,compare_version_num:b}},a.fileCompareReturn=function(b){a.curr_file_info.is_fold_compare?($("#fold-compare").removeClass("ng-hide").addClass("ng-show"),a.file_control.show_file_compare=!1):a.file_control.show_file_compare=!1,a.curr_file_info.is_single_detail&&(a.file_control.show_file_compare=!1,$("#file-history").removeClass("ng-hide").addClass("ng-show")),b||n.clearList()},a.downloadFile=function(c){if(c){var d=null;d=1===c?{file_absolute_path:a.version.file_absolute_path,is_dir:!0}:{file_absolute_path:a.file_nodes.curr_file.file_path+"/"+a.file_nodes.curr_file.file,is_dir:a.file_nodes.curr_file.dir},angular.extend(d,{version_num:a.one_pub.version_num},{business_sys_name:s}),a.control.download_loading=!0,j.downloadFile(d).then(function(c){b(function(){a.control.download_loading=!1,c.download_url&&q.downloadFile(c.download_url)},0)},function(b){a.control.download_loading=!1,p.alert(b.message)})}},a.fileHistoryReturn=function(){a.file_control.show_file_history=!1},a.$on("compareFile",function(b,c){a.curr_file_info=c}),d.$on("$stateChangeSuccess",function(){n.clearList()}),a.stopPrevent=function(a){a.stopPropagation()},A()}]),versionCtrl.controller("viewFileHistoryCtrl",["$scope","$timeout","$stateParams","$cookieStore","$rootScope","$state","$interval","CodeMirrorOption","Version","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=a.file_header?a.file_header:{},n=m.version_num?m.version_num:1,o=m.busisys_name?m.busisys_name:"";a.detailFileOptions=h.Properties(!0),a.file_control={refresh:!1,codemethod_loading:!1,has_file_icon:m.file_type>=1&&m.file_type<4,version_loading:!0,version_err_msg:"",version_loading_msg:"",curr_index:0},a.file_info={file_content:"",file_size:"",file_update_time:"",file_type:m.file_type,file_name:m.file_name,version_num:m.version_num,error_msg:""},a.version_info={version_type:m.version_type,business_sys_name:m.busisys_name,version_num:m.version_num,file_path:m.pkg_file_path?m.file_path:m.file_path+"/"+m.file_name,file_name:m.file_name},a.data={version_list:[],compare_version_list:[]},a.file_post_header={version_num:m.version_num,business_sys_name:o,absolute_path:m.pkg_file_path?m.file_path:m.file_path+"/"+m.file_name,encoding_type:"UTF-8",version_type:m.view_file_flag,file_path:m.pkg_file_path?m.pkg_file_path:""};var p=function(b){a.data.compare_version_list=[],angular.forEach(a.data.version_list,function(c,d){b!==d&&(d===b+1?a.data.compare_version_list.unshift({version_num:c.version_num,version_cn:"与前版本比对"}):d===b-1&&0!==d?a.data.compare_version_list.unshift({version_num:c.version_num,version_cn:"与后版本比对"}):0!==d&&a.data.compare_version_list.push({version_num:c.version_num,version_cn:c.version_num}))}),a.data.version_list.length&&0!==b&&a.data.compare_version_list.unshift({version_num:a.data.version_list[0].version_num,version_cn:"与最新版本比对"})},q=function(b,c){var d=a.data.version_list[b].version_num;a.file_post_header.absolute_path=a.file_post_header.absolute_path.replace(d,n),a.file_post_header.version_num=n,a.file_info.error_msg="",a.file_control.codemethod_loading=!0,i.viewfileContent(a.file_post_header).then(function(b){a.file_info.file_content=b.file_content?Base64.decode(b.file_content).trim():"",a.file_info.file_size=b.file_size?b.file_size:"",a.file_info.file_update_time=b.file_update_time?b.file_update_time:"",a.file_control.refresh=!0,a.file_control.codemethod_loading=!1,c&&s()},function(b){a.file_control.codemethod_loading=!1,a.file_info.error_msg=b.message})},r=function(){var a=$(".file-history .left");if(a.is(":visible")){var b=$(window).height()-parseInt(a.offset().top)-15;a.height(b)}},s=function(){var a=$(".file-history .CodeMirror");if(a.is(":visible")&&a.offset()){var b=$(window).height()-parseInt(a.offset().top)-15;a.height(b)}},t=function(){var c=m.file_name?m.file_name:"";a.file_control.version_loading_msg=c?"正在获取文件 ["+c+"] 历史版本 ...":"正在获取文件历史版本 ...",i.getUpdatefileVersionNum(a.version_info).then(function(c){b(function(){a.file_control.version_loading=!1,a.data.version_list=c.version_list?c.version_list:[],0!==a.data.version_list.length&&(a.data.version_list[0].active=!0,p(0),q(0,!0),r())},0)},function(b){a.file_control.version_loading=!1,a.file_control.version_err_msg=b.message})};a.selectHisVersion=function(b){var c={file_size:a.file_info.file_size,file_update_time:a.file_info.file_update_time,file_absolute_path:a.file_post_header.absolute_path,pkg_file_path:a.file_post_header.file_path,curr_version_num:a.file_post_header.version_num,compare_version_num:b,is_single_detail:!0};a.$emit("compareFile",c),$("#file-history").addClass("ng-hide").removeClass("ng-show"),a.$parent.file_control.show_file_compare=!0},a.changeVersion=function(b){var c=a.file_control.curr_index;b!==c&&(a.data.version_list[c].active=!1,a.data.version_list[b].active=!0,a.file_control.curr_index=b,n=a.data.version_list[b].version_num,q(c),p(b))},a.changeCodeMethod=function(){l=a.file_post_header.encoding_type,"UTF-8"===l&&(a.file_post_header.encoding_type="GBK"),"GBK"===l&&(a.file_post_header.encoding_type="UTF-8"),q(a.file_control.curr_index)},a.fullScreen=function(){j.fileContentFullScreen(a.file_info,a.file_post_header,o)},a.downloadSingleFile=function(){var c={file_absolute_path:a.file_post_header.absolute_path.replace(m.version_num,n),business_sys_name:o,version_num:n,is_dir:!1};i.downloadFile(c).then(function(a){b(function(){a.download_url&&k.downloadFile(a.download_url)},0)},function(a){j.alert(a.message)})},$(window).resize(function(){b(function(){s(),r()},100)}),t()}]),versionCtrl.controller("viewFileCompareCtrl",["$scope","$timeout","$stateParams","$rootScope","$state","$interval","CodeMirrorOption","Version","ReleaseFileType","TempCompareData","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,o=-1,p=-1,q=a.curr_file_info.encoding_type,r=a.curr_file_info.compare_version_num,s=/<td.*?>(.*?)<\/td>/g,t=/<td nowrap="nowrap">(.*?)<\/td>/g,u=/("diff_next")|("diff_header")/g;a.compare_info={file_name:"",file_size:a.curr_file_info.file_size,file_update_time:a.curr_file_info.file_update_time,file_absolute_path:a.curr_file_info.file_absolute_path,full_absolute_path:a.curr_file_info.full_absolute_path?a.curr_file_info.full_absolute_path:"",compare_full_type:a.curr_file_info.compare_full_type?a.curr_file_info.compare_full_type:1,encoding_type:a.curr_file_info.encoding_type?a.curr_file_info.encoding_type:"UTF-8",compare_file_path:a.curr_file_info.compare_path,inner_file_path:a.curr_file_info.pkg_file_path,curr_version_num:a.curr_file_info.curr_version_num,compare_version_num:a.curr_file_info.compare_version_num,is_pre_pub_ver:a.$parent.control.pre_pub_flag,pre_pub_project:a.$parent.version.pre_project_name,compare_path1:a.curr_file_info.compare_path1||"",compare_path2:a.curr_file_info.compare_path2||"",real_file_path:"",compare_content_list:[],compare_update_time:"",compare_file_size:"",compare_type:1,left_file_path:"",right_file_path:""},a.file_str={left_str:"",right_str:"",left_all_str:"",right_all_str:"",left_chg_str:"",right_chg_str:"",left_table:[],right_table:[],left_chg_table:[],right_chg_table:[]},a.version_data={version_list:[]},a.temp_data={compare_tab_list:[]},a.get_all_version_header={busisys_name:a.$parent.one_pub.business_sys_name,version_type:a.$parent.version.version_type},a.control={left_loading:!1,right_loading:!1,has_file_icon:!1,is_init:!0,is_error:!1,is_new_version:!1,left_error:"",right_error:""},a.tab_control={cm_refresh:!1};var v=function(a){var b;return b=a.is_pub_compare?{file_path:a.compare_info.file_absolute_path,compare_file_path:a.compare_info.compare_file_path,inner_file_path:a.compare_info.inner_file_path,encoding_type:a.compare_info.encoding_type?a.compare_info.encoding_type:"UTF-8"}:a.compare_info.full_absolute_path?{file_path:a.compare_info.file_absolute_path,compare_file_path:a.compare_info.full_absolute_path.replace(r,a.compare_info.compare_version_num).replace("pretags","fulltags"),inner_file_path:a.compare_info.inner_file_path,compare_full_type:a.compare_info.compare_full_type,encoding_type:a.compare_info.encoding_type?a.compare_info.encoding_type:"UTF-8"}:{file_path:a.compare_info.file_absolute_path||a.compare_info.compare_path1,compare_full_type:a.compare_info.compare_full_type,compare_file_path:a.compare_info.file_absolute_path?a.compare_info.file_absolute_path.replace(a.compare_info.curr_version_num,a.compare_info.compare_version_num).replace("pretags","pubtags"):a.compare_info.compare_path2?a.compare_info.compare_path2.replace(a.compare_info.curr_version_num,a.compare_info.compare_version_num).replace("pretags","pubtags"):"",inner_file_path:a.compare_info.inner_file_path,encoding_type:a.compare_info.encoding_type?a.compare_info.encoding_type:"UTF-8"},a.compare_info.left_file_path=b.file_path?b.file_path:a.compare_info.compare_path1,a.compare_info.right_file_path=b.compare_file_path?b.compare_file_path:a.compare_info.compare_path2,b},w=function(c,d){var e=v(d);return!e||e.file_path&&e.compare_file_path?(d.control.is_error=!1,d.control.right_error="",d.control.left_loading=!0,d.control.right_loading=!0,void h.getFileCompareContent(e).then(function(c){b(function(){d.compare_info.file_size=c.file_size?c.file_size:"",d.compare_info.file_update_time=c.file_update_time?c.file_update_time:"",d.compare_info.compare_file_size=c.compare_file_size?c.compare_file_size:"",d.compare_info.compare_update_time=c.compare_file_update_time?c.compare_file_update_time:"",a.control.is_init=!1,d.file_str.left_table=[],d.file_str.right_table=[];var e=c.diff_txt?z(Base64.decode(c.diff_txt)):"";d.compare_info.compare_content_list=e?e.split("\n"):[],d.compare_info.compare_content_list.map(function(a,b,c){if(u.test(a)){var e=a.match(t),f=e[0]&&e[0].replace(t,function(a){return a.substring(a.indexOf(">")+1,a.lastIndexOf("<"))}),g=e[1]&&e[1].replace(t,function(a){return a.substring(a.indexOf(">")+1,a.lastIndexOf("<"))});A(f,"left",d),A(g,"right",d)}else if(!u.test(a)){var h=a.match(s),i=h[1]&&h[1].replace(s,function(a){return a.substring(a.indexOf(">")+1,a.lastIndexOf("<"))})+"\n";d.file_str.left_table.push(i),d.file_str.right_table.push(i)}}),b(function(){d.file_str.left_all_str=d.file_str.left_table.join(""),d.file_str.left_str=d.file_str.left_all_str.substring(0,d.file_str.left_all_str.length-1),d.control.left_loading=!1},1e3),b(function(){d.file_str.right_all_str=d.file_str.right_table.join(""),d.file_str.right_str=d.file_str.right_all_str.substring(0,d.file_str.right_all_str.length-1),d.control.right_loading=!1},1500)},0)},function(c){b(function(){d.control.right_loading=!1,d.control.is_error=!0,a.control.is_init=!1,c.message.indexOf("不存在")>-1?(d.file_str.right_str="",d.control.right_error=d.compare_info.file_name?"对比文件"+d.compare_info.file_name+"不存在":"对比文件不存在"):d.control.right_error=c.message,d.control.left_loading=!0,H(d,!1,!0)},500)})):(d.control.left_loading=!0,d.control.right_loading=!0,H(d,!e.file_path,!e.compare_file_path),!1)},x=function(c){c&&(2===c.compare_info.compare_full_type&&(a.get_all_version_header.version_type=1),h.getfileVersionNum(a.get_all_version_header).then(function(a){b(function(){c.version_list=a.version_list?a.version_list:[];for(var b=0;b<c.version_list.length;b++){var d=c.version_list[b];if(c.compare_info.curr_version_num===d.version_num){c.version_list.splice(b,1);break}}c.version_list.length>0&&(c.control.is_new_version=c.compare_info.curr_version_num===c.version_list[0].version_num)},0)},function(a){k.alert(a.message)}),w(!0,c))},y=function(){var b;a.compare_info.inner_file_path?(a.compare_info.file_absolute_path=a.compare_info.file_absolute_path.endsWith("/")?a.compare_info.file_absolute_path:a.compare_info.file_absolute_path+"/",a.compare_info.real_file_path=a.compare_info.file_absolute_path+a.compare_info.inner_file_path,b=a.compare_info.inner_file_path.substring(a.compare_info.inner_file_path.lastIndexOf("/")+1,a.compare_info.inner_file_path.length)):(a.compare_info.real_file_path=a.compare_info.file_absolute_path?a.compare_info.file_absolute_path:a.compare_info.full_absolute_path?a.compare_info.full_absolute_path:a.compare_info.compare_file_path||a.compare_info.compare_path2,b=a.compare_info.real_file_path.substring(a.compare_info.real_file_path.lastIndexOf("/")+1,a.compare_info.real_file_path.length)),a.compare_info.file_name=b,a.compare_info.file_type=-1==b.lastIndexOf(".")?0:l.findKey(b.substring(b.lastIndexOf(".")+1),i)},z=function(a){var b="";return 0===a.length?"":(b=a.replace(/&lt;/g,"<"),b=b.replace(/&gt;/g,">"),b=b.replace(/&nbsp;/g," "),b=b.replace(/&#39;/g,"'"),b=b.replace(/&quot;/g,'"'),b=b.replace(/<br>/g,"\n"))},A=function(a,b,c){var d="";d=a.replace(/<span class="diff_sub">(.*?)<\/span>/g,function(a){var b=a.substring(a.indexOf(">")+1,a.lastIndexOf("<"));return" "!==b?"ì"+b+"ì":""}).replace(/<span class="diff_add">(.*?)<\/span>/g,function(a){var b=a.substring(a.indexOf(">")+1,a.lastIndexOf("<"));return" "!==b?"í"+b+"í":""}).replace(/<span class="diff_chg">(.*?)<\/span>/g,function(a){var b=a.substring(a.indexOf(">")+1,a.lastIndexOf("<"));return" "!==b?"ī"+b+"ī":""}),"left"===b&&c.file_str.left_table.push(d+"\n"),"right"===b&&c.file_str.right_table.push(d+"\n"),"left_chg"===b&&c.file_str.left_chg_table.push(d+"\n"),"right_chg"===b&&c.file_str.right_chg_table.push(d+"\n")},B=function(a,c){if(a){c=c||200;var d=$(a+" span.cm-compare-delete"),e=$(a+" span.cm-compare-add"),f=$(a+" span.cm-compare-change");
b(function(){d.length&&d.is(":visible")&&angular.forEach(d,function(a,b,c){/ì/g.test(a.innerHTML)&&(a.innerHTML=a.innerHTML.replace(/ì/g,""))}),e.length&&e.is(":visible")&&angular.forEach(e,function(a,b,c){/í/g.test(a.innerHTML)&&(a.innerHTML=a.innerHTML.replace(/í/g,""))}),f.length&&f.is(":visible")&&angular.forEach(f,function(a,b,c){/ī/g.test(a.innerHTML)&&(a.innerHTML=a.innerHTML.replace(/ī/g,""))})},c)}},C=function(a,c){c=c||600,a&&b(function(){var b=$(a+" span.cm-compare-delete"),c=$(a+" span.cm-compare-add"),d=$(a+" span.cm-compare-change");angular.forEach(b,function(a,b,c){/ì/g.test(a.innerHTML)&&(a.innerHTML=a.innerHTML.replace(/ì/g,""))}),angular.forEach(c,function(a,b,c){/í/g.test(a.innerHTML)&&(a.innerHTML=a.innerHTML.replace(/í/g,""))}),angular.forEach(d,function(a,b,c){/ī/g.test(a.innerHTML)&&(a.innerHTML=a.innerHTML.replace(/ī/g,""))})},c)},D=function(a,b){for(var c=[m,n],d=[],e=0;e<c.length;e++){var f=c[e].getScrollInfo();f&&d.push(c[e].getScrollInfo().top)}"left"===b?n.scrollTo(0,d[0]):m.scrollTo(0,d[1])},E=function(a){a.control.left_loading=!0,a.control.right_loading=!0,a.file_str.right_str="",a.file_str.left_str="",a.file_str.left_chg_str&&a.file_str.right_chg_str||a.compare_info.compare_content_list.map(function(b,c,d){if(u.test(b)){var e=b.match(t),f=e[0]&&e[0].replace(t,function(a){return a.substring(a.indexOf(">")+1,a.lastIndexOf("<"))}),g=e[1]&&e[1].replace(t,function(a){return a.substring(a.indexOf(">")+1,a.lastIndexOf("<"))});A(f,"left_chg",a),A(g,"right_chg",a)}}),b(function(){!a.file_str.left_chg_str&&(a.file_str.left_chg_str=a.file_str.left_chg_table.join("")),a.file_str.left_str=a.file_str.left_chg_str.substring(0,a.file_str.left_chg_str.length-1),a.control.left_loading=!1,a.file_str.left_str&&C("#file-left")},500),b(function(){!a.file_str.right_chg_str&&(a.file_str.right_chg_str=a.file_str.right_chg_table.join("")),a.file_str.right_str=a.file_str.right_chg_str.substring(0,a.file_str.right_chg_str.length-1),a.control.right_loading=!1,a.file_str.right_str&&C("#file-right")},600)},F=function(a){a.control.left_loading=!0,a.control.right_loading=!0,a.file_str.right_str="",a.file_str.left_str="",b(function(){a.file_str.left_str=a.file_str.left_all_str.substring(0,a.file_str.left_all_str.length-1),a.control.left_loading=!1},500),b(function(){a.file_str.right_str=a.file_str.right_all_str.substring(0,a.file_str.right_all_str.length-1),a.control.right_loading=!1},600)},G=function(c,d){a.tab_control.cm_refresh=!1,!a.control.is_init&&d&&(c.control.tab_change=!0),b(function(){a.tab_control.cm_refresh=!0,!a.control.is_init&&d&&(c.control.tab_change=!1),2==c.compare_info.compare_type&&(c.file_str.left_str&&C("#file-left",5),c.file_str.right_str&&C("#file-right",5))},50)},H=function(c,d,e){c.control.is_error=!1,c.control.left_error="",c.control.right_error="";var f={version_num:e?c.compare_info.curr_version_num:c.compare_info.compare_version_num,business_sys_name:a.$parent.one_pub.business_sys_name,absolute_path:e?c.compare_info.left_file_path:c.compare_info.right_file_path.replace(r,c.compare_info.compare_version_num),encoding_type:c.compare_info.encoding_type,file_path:c.compare_info.inner_file_path,version_type:c.compare_info.inner_file_path?2:1};h.viewfileContent(f).then(function(f){f&&b(function(){c.file_str.left_str=f.file_content&&e?Base64.decode(f.file_content).trim():"",c.file_str.right_str=f.file_content&&d?Base64.decode(f.file_content).trim():"",c.compare_info.file_size=f.file_size?f.file_size:"",c.compare_info.file_update_time=f.file_update_time?f.file_update_time:"",c.control.left_loading=!1,c.control.right_loading=!1,c.control.is_error=!0,a.control.is_init=!1,c.control.left_error=d?"文件"+c.compare_info.file_name+"不存在":"",c.control.right_error=e?"对比文件"+c.compare_info.file_name+"不存在":"",G(c)},0)},function(a){c.control.left_loading=!1,c.control.right_loading=!1,c.control.is_error=!c.file_str.left_str||!c.file_str.right_str,c.control.left_error=c.file_str.left_str?"":a.message,c.control.right_error=c.file_str.right_str?"":a.message})},I=function(){y();for(var b=j.getList(),c=0;c<b.length;c++){var d=b[c];if(d.compare_info.real_file_path===a.compare_info.real_file_path){o=c;break}}-1===o?(j.addItem({active:!0,left_editor:a.detailLeftOptions,right_editor:a.detailRightOptions,is_pub_compare:a.curr_file_info.is_pub_compare,compare_info:a.compare_info,file_str:a.file_str,control:a.control,version_list:a.version_data.version_list}),a.temp_data.compare_tab_list=j.getList(),a.curr_control=a.temp_data.compare_tab_list[0].control,x(a.temp_data.compare_tab_list[a.temp_data.compare_tab_list.length-1])):(a.temp_data.compare_tab_list=j.getList(),angular.forEach(a.temp_data.compare_tab_list,function(a,b,c){a.active=!1}),a.temp_data.compare_tab_list[o].active=!0,a.curr_control=a.temp_data.compare_tab_list[o].control,a.control.is_init=!1,a.curr_file_info.compare_version_num!==a.temp_data.compare_tab_list[o].compare_info.compare_version_num&&(a.temp_data.compare_tab_list[o].compare_info.compare_version_num=a.curr_file_info.compare_version_num,a.control.is_init=!0,x(a.temp_data.compare_tab_list[o])))};a.changeCompareTab=function(b){p!==b&&(a.temp_data.compare_tab_list[b].active=!0,p=b,m={},n={},G(a.temp_data.compare_tab_list[b],!0))},a.detailLeftOptions=function(a){m=a,g.setFileCompareBg(a),a.on("scroll",function(c,d){e&&b.cancel(e);var e=b(function(){D(a,"left")},50)}),a.on("viewportChange",function(a,b,c){c&&B("#file-left",50)})},a.detailRightOptions=function(a){n=a,g.setFileCompareBg(a),a.on("scroll",function(c,d){e&&b.cancel(e);var e=b(function(){D(a,"right")},50)}),a.on("viewportChange",function(a,b,c){c&&B("#file-right",50)})},a.selectCompareVersion=function(b,c){r===b||a.control.is_init||(c.compare_info.compare_type=1,w(!1,c),r=c.compare_info.compare_version_num)},a.changeCompareType=function(a,b){b.compare_info.compare_type!=a&&(2===a?E(b):F(b),b.compare_info.compare_type=a)},a.changeCompareCodeMethod=function(a){q=a.compare_info.encoding_type,"UTF-8"===q?a.compare_info.encoding_type="GBK":a.compare_info.encoding_type="UTF-8",a.compare_info.compare_type=1,w(!1,a)},a.formatFileIconStyle=function(a){var b="";return 1==a.compare_info.file_type?b="txt-icon":(2==a.compare_info.file_type||3==a.compare_info.file_type)&&(b="excel-icon"),b},I()}]),versionCtrl.controller("foldController",["$scope","$timeout","Version","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f){var g,h=a.version.compare_ver_num,i=a.version.compare_ver_num,j=a.control.compare_full_flag?2:4,k=a.control.compare_full_flag?2:1;a.compare_data_info={fold_name:a.control.version_flag?a.one_pub.version_num:a.file_nodes.curr_file.file,fold_path:a.control.version_flag?a.version.file_absolute_path:a.file_nodes.curr_file.file_path,compare_version_num:a.version.compare_ver_num,relate_path:a.file_nodes.curr_file.relate_path,diff_version_num:a.version.compare_ver_num,version_list:a.control.compare_pac_flag&&a.control.compare_full_flag?a.version.full_version_list:a.version.version_list},a.fold_compare_control={fold_load_flag:!0,show_differ_flag:!1},a.common_control={disabled_control:!1},a.diff_common_control={disabled_control:!1},a.leftConfig={status:"left",compare_mode:!0},a.rightConfig={status:"right",compare_mode:!0},a.differ_compare_nodes={},a.config={scroll_xy_config:d.XY()},a.compare_left_scroll={whileScrolling:function(){var a=Math.abs(this.mcs.top),b=Math.abs(this.mcs.left);l(0,a,b)}},a.compare_right_scroll={whileScrolling:function(){var a=Math.abs(this.mcs.top),b=Math.abs(this.mcs.left);l(1,a,b)}};var l=function(b,c,d){var e=(a.fold_compare_control.show_differ_flag?2:1,[$("#left_scroll_container"+_curr_checked_tab),$("#right_scroll_container"+_curr_checked_tab)]),f=[c,d];g=g||0;for(var h=0;h<e.length;h++)g!==h&&b!==h&&e[h].mCustomScrollbar("scrollTo",f,{scrollInertia:10})},m=function(){a.control.compare_pac_flag?a.compare_info_nodes={loading:!1,nodes:[],compare_path2:a.control.pre_pub_flag?a.control.compare_full_flag?a.version.compare_path.replace(a.one_pub.version_num,a.version.compare_ver_num).replace("pretags",a.control.compare_full_flag?"fulltags":"pubtags"):a.version.compare_path.replace(a.version.pre_pub_ver,a.version.compare_ver_num).replace("pretags",a.control.compare_full_flag?"fulltags":"pubtags"):a.version.compare_path.replace(a.one_pub.version_num,a.version.compare_ver_num),compare_path1:a.version.compare_path1,curr_fold_path:"",curr_file:{relate_path:a.file_nodes.curr_file.relate_path}}:a.compare_info_nodes={loading:!1,nodes:[],compare_path2:a.version.compare_path,compare_path1:a.control.version_flag?a.version.file_absolute_path:a.file_nodes.curr_fold_path,curr_fold_path:"",curr_file:{}}};a.leftScrollBarMouseover=function(){g=0},a.rightScrollBarMouseover=function(){g=1},a.compareData=function(){var b=angular.copy(a.compare_info_nodes.temp);a.$broadcast(a.compare_info_nodes.curr_fold_path,b)},a.goDiff=function(){var b=angular.copy(a.differ_compare_nodes.temp);a.$broadcast(a.differ_compare_nodes.curr_fold_path,b)},a.getRootFile=function(b){return b=b?b:a.compare_info_nodes,a.control.compare_pac_flag?c.pubAndBakTreeCompare(b.compare_path1,b.compare_path2,j,k,a.one_pub.business_sys_name,a.compare_data_info.relate_path,a.compare_data_info.relate_path).then(function(a){return b.curr_file=a.file_bean?a.file_bean:{},j=3,a.diff_list?a.diff_list:[]},function(a){e.alert(a.message)}):c.foldTreeCompare(b.compare_path1,b.compare_path2).then(function(a){return b.curr_file=a.file_bean?a.file_bean:{},a.diff_list?a.diff_list:[]},function(a){e.alert(a.message)})},a.dbClickCompareFile=function(b){b=b?b:a.compare_info_nodes;var c={file_size:"",file_update_time:"",file_absolute_path:b.compare_path1,full_absolute_path:a.control.compare_full_flag?b.compare_path2:"",compare_full_type:a.control.compare_full_flag?2:1,curr_version_num:a.control.pre_pub_flag?a.version.pre_pub_ver:a.one_pub.version_num,compare_version_num:a.control.compare_full_flag?a.compare_data_info.compare_version_num:h,compare_path1:b.compare_path1||"",compare_path2:b.compare_path2||"",is_fold_compare:!0};a.$emit("compareFile",c),$("#fold-compare").addClass("ng-hide").removeClass("ng-show"),a.file_control.show_file_compare=!0},a.selectCompareVersion=function(c){i!=c&&(h=c,a.compare_info_nodes.nodes=[],a.differ_compare_nodes.nodes=[],a.fold_compare_control.show_differ_flag?a.fold_compare_control.diff_load_flag=!1:a.fold_compare_control.fold_load_flag=!1,a.control.compare_pac_flag?(j=a.control.compare_full_flag?2:4,a.compare_info_nodes.compare_path1=a.version.compare_path1,a.compare_info_nodes.compare_path2=a.control.pre_pub_flag?a.control.compare_full_flag?a.version.compare_path.replace(a.one_pub.version_num,c).replace("pretags",a.control.compare_full_flag?"fulltags":"pubtags"):a.version.compare_path.replace(a.version.pre_pub_ver,c).replace("pretags",a.control.compare_full_flag?"fulltags":"pubtags"):a.version.compare_path.replace(a.one_pub.version_num,c)):(a.compare_info_nodes.compare_path1=a.control.version_flag?a.compare_data_info.fold_path:a.compare_data_info.fold_path+"/"+a.compare_data_info.fold_name,a.compare_info_nodes.compare_path2=a.compare_info_nodes.compare_path1.replace(a.one_pub.version_num,c)),a.fold_compare_control.show_differ_flag?(a.differ_compare_nodes.no_init_flag=!1,a.differ_compare_nodes.compare_path1=a.compare_info_nodes.compare_path1,a.differ_compare_nodes.compare_path2=a.compare_info_nodes.compare_path2,b(function(){a.fold_compare_control.diff_load_flag=!0},200)):(a.compare_info_nodes.no_init_flag=!1,b(function(){a.fold_compare_control.fold_load_flag=!0},200)),i=c)},a.showDifference=function(c){a.fold_compare_control.show_differ_flag!=c&&(c?(a.fold_compare_control.diff_load_flag=!1,a.compare_data_info.diff_version_num=a.compare_data_info.compare_version_num,a.differ_compare_nodes=angular.copy(a.compare_info_nodes),a.differ_compare_nodes.no_init_flag=!0,b(function(){a.fold_compare_control.diff_load_flag=!0},200)):(a.fold_compare_control.fold_load_flag=!1,a.compare_data_info.compare_version_num=a.compare_data_info.diff_version_num,a.compare_info_nodes=angular.copy(a.differ_compare_nodes),a.compare_info_nodes.no_init_flag=!0,b(function(){a.fold_compare_control.fold_load_flag=!0},200)),a.fold_compare_control.show_differ_flag=c)},m()}]);var monitor=angular.module("LargeScreenMonitorController",["ui.bootstrap","ngCookies","CvService","ReleaseHttpSrv","CvDirectives","ChartsService","ModalCtrl","GlobalData"]);monitor.value("baseUrl","/clWeb/"),monitor.controller("sysMonitorCtrl",["$scope","$rootScope","$cookieStore","$location","$timeout","$interval","$window","CommData","Charts","weekType","ProtocolType","LargeMonitor","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o,p,q=new Date;a.info={today_date:n.dtFormatCn(q),week_cn_num:n.findValue(q.getDay(),j),now_time:"",sys_detail_index:0},a.data={un_publish_project_list:[],published_project_list:[],publish_project_list:[],all_project_list:[]},a.control={sys_show_index:0,unpublish_index:0,published_index:0,get_unpublish_loading:!1,get_publish_loading:!1,get_running_loading:!1};var r=function(a,b,c){var d=function(){var d=new Date,e=new Date(a.replace(/-/g,"/")+" "+b),g=e.getTime(),h=d.getTime(),i=g-h,j=0,k=0,l=0,m=0;i>=0?(j=Math.floor(i/1e3/60/60/24),k=Math.floor(i/1e3/60/60%24)<10?"0"+Math.floor(i/1e3/60/60%24):Math.floor(i/1e3/60/60%24),l=Math.floor(i/1e3/60%60)<10?"0"+Math.floor(i/1e3/60%60):Math.floor(i/1e3/60%60),m=Math.floor(i/1e3%60)<10?"0"+Math.floor(i/1e3%60):Math.floor(i/1e3%60),j>0&&(k=24*j+parseInt(k)),c.remainTime=k+":"+l+":"+m):(c.time_interval&&f.cancel(c.time_interval),c.deplay_flag=!0)};c.time_interval=f(d,1e3)},s=function(a){var b,c,d,e,f=Math.floor(a/1e3),g="";return b=Math.floor(a/1e3/60/60/24),c=Math.floor(a/1e3/60/60%24),d=Math.floor(a/1e3/60%60),e=Math.floor(a/1e3%60),f&&(g=60>f?e+"秒":3600>f?d+"分"+e+"秒":216e3>f?c+"时"+d+"分"+e+"秒":b+"天"+c+"时"+d+"分"+e+"秒"),g},t=function(b){1==b?(a.control.get_unpublish_loading=!0,a.control.get_publish_loading=!0,a.control.get_running_loading=!0,e(function(){for(var b=[{project_name:"卡系统一期",business_cn_name:"卡系统",syspublish_id:"1",publish_date:"2018-09-26",publish_time:"15:00",manager_user_name:"超级管理员"},{project_name:"卡系统二期",business_cn_name:"卡系统",syspublish_id:"2",publish_date:"2018-09-20",publish_time:"18:00",manager_user_name:"超级管理员"},{project_name:"网银系统上线",business_cn_name:"网银",syspublish_id:"3",publish_date:"2018-09-26",publish_time:"18:30",manager_user_name:"超级管理员"},{project_name:"卡系统三期",business_cn_name:"卡系统",syspublish_id:"1",publish_date:"2018-09-26",publish_time:"15:00",manager_user_name:"超级管理员"},{project_name:"卡系统五期",business_cn_name:"卡系统",syspublish_id:"2",publish_date:"2018-09-20",publish_time:"18:00",manager_user_name:"超级管理员"},{project_name:"核心系统上线",business_cn_name:"核心系统",syspublish_id:"3",publish_date:"2018-09-18",publish_time:"18:30",manager_user_name:"超级管理员"}],c=0;c<b.length;c++){var d=b[c];d.project_name||(d.project_name="敏捷项目"),r(d.publish_date,d.publish_time,d)}for(var f=[{project_name:"核心上线一期",start_datetime:"2018-09-17 15:00:00",end_datetime:"2018-09-17 17:00:11",time_used:72e5,sys_publish_status:4,syspublish_success_flag:1},{project_name:"核心上线二期",start_datetime:"2018-09-17 17:00:22",end_datetime:"2018-09-17 18:00:11",time_used:36e5,sys_publish_status:4,syspublish_success_flag:2},{project_name:"集中业务一期",start_datetime:"2018-09-17 15:30:22",end_datetime:"2018-09-17 17:00:22",time_used:54e5,sys_publish_status:6,syspublish_success_flag:1},{project_name:"集中业务一期",start_datetime:"2018-09-17 15:00:22",end_datetime:"2018-09-17 17:00:22",time_used:72e5,sys_publish_status:7,syspublish_success_flag:1},{project_name:"核心上线三期",start_datetime:"2018-09-17 15:00:00",end_datetime:"2018-09-17 17:00:11",time_used:72e5,sys_publish_status:4,syspublish_success_flag:1},{project_name:"核心上线五期",start_datetime:"2018-09-17 17:00:22",end_datetime:"2018-09-17 18:00:11",time_used:36e5,sys_publish_status:4,syspublish_success_flag:2}],g=0;g<f.length;g++){var h=f[g];h.project_name||(h.project_name="敏捷项目"),h.time_used=s(h.time_used)}for(var i=[{time_used:0,business_sys_name:"ronghui1",business_cn_name:"核心系统",project_name:"核心系统项目1",syspublish_id:"SP201809190000267",sys_publish_status:1,publish_date:"2018-09-20",publish_time:"18:00:00",project_id:"PJ201809070000060",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"ronghui",business_cn_name:"合并发布测试系统",project_name:"核心系统项目2",syspublish_id:"SP201809190000266",sys_publish_status:1,publish_date:"2018-09-20",publish_time:"18:00:00",project_id:"PJ201809070000060",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"YL_TEST",business_cn_name:"压力测试",project_name:"核心系统项目3",syspublish_id:"SP201809190000268",sys_publish_status:2,last_pub_execute_id:"PE201809190000135",publish_date:"2018-09-19",publish_time:"11:00:00",last_execute_id:"PE201809190000135",project_id:"PJ201809190000064",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"YL_TEST",business_cn_name:"压力测试",project_name:"网银系统1",syspublish_id:"SP201809140000262",sys_publish_status:3,last_pub_execute_id:"PE201809190000134",publish_date:"2018-09-14",publish_time:"15:00:00",last_execute_id:"PE201809190000134",project_id:"PJ201809140000061",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"test-08-15",business_cn_name:"测试系统09-08",project_name:"网银系统2",syspublish_id:"SP201809080000253",sys_publish_status:4,last_pub_execute_id:"PE201809080000128",syspublish_success_flag:1,publish_date:"2018-09-08",publish_time:"14:00:00",last_execute_id:"PE201809080000128",project_id:"PJ201809030000059",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"yaw_sys",business_cn_name:"测试系统",project_name:"网银系统3",syspublish_id:"SP201809080000252",sys_publish_status:1,publish_date:"2018-09-08",publish_time:"14:00:00",project_id:"PJ201809030000059",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"test-08-15",business_cn_name:"测试系统09-08",syspublish_id:"SP201809080000254",sys_publish_status:3,last_pub_execute_id:"PE201809080000129",publish_date:"2018-09-08",publish_time:"12:21:42",last_execute_id:"PE201809080000129",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"CHN_Latest",business_cn_name:"CHN最新测试",project_name:"cl项目发布",syspublish_id:"SP201809030000202",sys_publish_status:4,last_pub_execute_id:"PE201809030000114",syspublish_success_flag:1,publish_date:"2018-09-03",publish_time:"16:10:00",last_execute_id:"PE201809030000114",project_id:"PJ201809030000055",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"CHN_Latest",business_cn_name:"CHN最新测试",project_name:"cl项目发布2",syspublish_id:"SP201809030000204",sys_publish_status:3,last_pub_execute_id:"PE201809060000125",publish_date:"2018-09-03",publish_time:"16:00:00",last_execute_id:"PE201809060000125",project_id:"PJ201809030000057",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"YL_SYS",business_cn_name:"我的系统",project_name:"网银优化项目",syspublish_id:"SP201808300000201",sys_publish_status:1,last_pub_execute_id:"PE201809060000123",publish_date:"2018-08-30",publish_time:"18:00:00",last_execute_id:"PE201809060000123",project_id:"PJ201808220000051",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"YL_SYS",business_cn_name:"我的系统",project_name:"呵呵呵",syspublish_id:"SP201808280000198",sys_publish_status:6,last_roll_execute_id:"PE201808290000111",last_pub_execute_id:"PE201808280000110",syspublish_success_flag:1,publish_date:"2018-08-28",publish_time:"10:00:00",last_execute_id:"PE201808290000111",project_id:"PJ201808280000053",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0},{time_used:0,business_sys_name:"guxm_sys",business_cn_name:"guxm_sys",project_name:"proj4",syspublish_id:"SP201808210000190",sys_publish_status:1,publish_date:"2018-08-23",publish_time:"18:00:00",project_id:"PJ201808200000050",manager_user_name:"超级管理员",manager_user_id:"admin",dynamic:0}],j=0;j<i.length;j++){var k=i[j];k.project_name=k.project_name||"敏捷发布",k.project_status=k.sys_publish_status||0,2===k.syspublish_success_flag&&(k.project_status=10)}var l=[{project_name:"测试中间项目1",dynamic:"50",status:1,execute_faile:!0,publish_time:"12:00:00",start_datetime:"2018-09-20 12:00:00.123",manager_user_name:"超级管理员",start_time:"18:00:00",use_time:"00:12:10",current_phase:{phase_type:1,phase_name:"这是执行中的阶段",impl_type:2,parallel_flag:1,phase_status:2,phase_id:5,dynamic:"60",node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:5},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:6},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:8},{node_ip:"10.1.1.230",soc_name:"230ssh",protocol_type:15,node_status:2}]},phase_list:[{phase_type:1,phase_name:"这是跳过的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:6,phase_no:1,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行跳过",node_status:6},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,exe_msg:"执行成功",node_status:4},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:9,exe_msg:"执行成功",node_status:4}]},{phase_type:1,phase_name:"这是第二个阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:5,phase_no:2,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行成功",node_status:5},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,exe_msg:"执行成功",node_status:5},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:5}]},{phase_type:1,phase_name:"这是手动修改成功的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:8,phase_no:3,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行成功",node_status:8},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,exe_msg:"执行成功",node_status:8},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:8}]},{phase_type:1,phase_name:"这是错误的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:4,phase_no:4,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行成功",node_status:4},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,exe_msg:"执行成功",node_status:4},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行出错",node_status:4}]},{phase_type:1,phase_name:"这是执行中的阶段",impl_type:11,parallel_flag:!0,interactor_flag:!1,phase_status:2,phase_no:5,dynamic:"60",node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:5},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:6},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:8},{node_ip:"10.1.1.230",soc_name:"230ssh",protocol_type:15,node_status:2}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:6,node_soc_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:7,node_soc_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:6,node_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:7,node_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:6,node_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:7,node_soc_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:6,node_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:7,node_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:6,node_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]}]},{project_name:"测试中间项目2",dynamic:"87",status:1,publish_time:"12:00:00",start_datetime:"2018-09-20 12:00:00.123",execute_faile:!1,manager_user_name:"张三",start_time:"18:00:00",use_time:"00:12:10",current_phase:{phase_type:1,phase_name:"这是执行中的阶段",impl_type:1,parallel_flag:1,phase_status:2,phase_id:4,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:2},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:1}]},phase_list:[{phase_type:1,phase_name:"这是跳过的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:6,phase_no:1,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行跳过",node_status:6},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,exe_msg:"执行成功",node_status:4},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:4}]},{phase_type:1,phase_name:"这是第二个阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:5,phase_no:2,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,exe_msg:"执行成功",node_status:5},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,exe_msg:"执行成功",node_status:5},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:5}]},{phase_type:1,phase_name:"这是手动修改成功的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:8,phase_no:3,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行成功",node_status:8},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,exe_msg:"执行成功",node_status:8},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:8}]},{phase_type:1,phase_name:"这是执行中的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:2,phase_no:4,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:2},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:5,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:6,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:1}]}]},{project_name:"测试中间项目3",dynamic:"87",status:1,publish_time:"12:00:00",start_datetime:"2018-09-20 12:00:00.123",execute_faile:!1,manager_user_name:"李四",start_time:"18:00:00",use_time:"00:12:10",current_phase:{phase_type:1,phase_name:"这是执行中的阶段",impl_type:1,parallel_flag:1,phase_status:2,phase_id:4,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:2},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:1}]},phase_list:[{phase_type:1,phase_name:"这是跳过的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:6,phase_no:1,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",
protocol_type:5,exe_msg:"执行跳过",node_status:6},{node_ip:"10.1.1.227",soc_name:"227ssh",exec_protocol_type:5,exe_msg:"执行成功",node_status:4},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:4}]},{phase_type:1,phase_name:"这是第二个阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:5,phase_no:2,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行成功",node_status:5},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:5},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:5}]},{phase_type:1,phase_name:"这是手动修改成功的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:8,phase_no:3,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,exe_msg:"执行成功",node_status:8},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,exe_msg:"执行成功",node_status:8},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,exe_msg:"执行成功",node_status:8}]},{phase_type:1,phase_name:"这是执行中的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:2,phase_no:4,node_soc_list:[{node_ip:"10.1.1.220",soc_name:"220ssh",protocol_type:5,node_status:2},{node_ip:"10.1.1.227",soc_name:"227ssh",protocol_type:5,node_status:1},{node_ip:"10.1.1.228",soc_name:"228ssh",protocol_type:5,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:5,node_soc_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]},{phase_type:1,phase_name:"这是未执行的阶段",impl_type:1,parallel_flag:!1,interactor_flag:!1,phase_status:1,phase_no:6,node_list:[{exec_node_ip:"10.1.1.220",exec_soc_name:"220ssh",exec_protocol_type:5,support_soc_name:"220ftp",support_node_ip:"10.1.1.220",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.227",exec_soc_name:"227ssh",exec_protocol_type:5,support_soc_name:"227ftp",support_node_ip:"10.1.1.227",support_protocol_type:2,node_status:1},{exec_node_ip:"10.1.1.228",exec_soc_name:"228ssh",exec_protocol_type:5,support_soc_name:"228ftp",support_node_ip:"10.1.1.228",support_protocol_type:2,node_status:1}]}]}];e(function(){a.data.un_publish_project_list=b,a.data.published_project_list=f,a.data.all_project_list=i,a.data.publish_project_list=l,a.control.get_unpublish_loading=!1,a.control.get_publish_loading=!1,a.control.get_running_loading=!1},1e3)},5e3)):(a.control.get_unpublish_loading=!0,a.control.get_publish_loading=!0,a.control.get_running_loading=!0,l.getUnpublishSys().then(function(b){b&&e(function(){var c=[];c=b.sysPublishList?b.sysPublishList:[];for(var d=0;d<c.length;d++){var f=c[d];f.project_name||(f.project_name="敏捷项目"),r(f.publish_date,f.publish_time,f)}e(function(){a.data.un_publish_project_list=c,a.control.get_unpublish_loading=!1},1e3)},0)},function(b){a.control.get_unpublish_loading=!1}),l.getPublishedSys().then(function(b){b&&e(function(){var c=[];c=b.sysPublishList?b.sysPublishList:[];for(var d=0;d<c.length;d++){var e=c[d];e.project_name||(e.project_name="敏捷项目"),e.time_used=s(e.time_used)}a.data.published_project_list=c,a.control.get_publish_loading=!1},0)},function(b){a.control.get_publish_loading=!1}),l.getAllSys().then(function(b){e(function(){var c=[];c=b.sysPublishList?b.sysPublishList.slice(0,30):[];for(var d=0;d<c.length;d++){var e=c[d];e.project_name=e.project_name||"敏捷发布",e.project_status=e.sys_publish_status||0,2===e.syspublish_success_flag&&(e.project_status=10)}a.data.all_project_list=c},0)},function(a){}),l.getRunningPublishSys().then(function(b){b&&e(function(){console.log(b);var c=[];c=b.sysPublishList?b.sysPublishList:[];for(var d=0;d<c.length;d++){var e=c[d];e.project_name||(e.project_name="敏捷项目")}a.data.publish_project_list=c,a.control.get_running_loading=!1},1e3)},function(a){}))},u=function(){o=function(){var b=new Date,c=b.getHours()<10?"0"+b.getHours():b.getHours(),d=b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes(),e=b.getSeconds()<10?"0"+b.getSeconds():b.getSeconds(),f=c>12?"下午":"上午";a.info.now_time=f+" "+c+"时"+d+"分"+e+"秒",a.$applyAsync()},p=f(o,1e3),t(1)};a["return"]=function(){g.history.back(),sessionStorage.removeItem("com_data")},u()}]);var pCtrl=angular.module("ProgramController",[]);pCtrl.controller("faultProgramNewCtrl",["$scope","$stateParams","$state","$timeout","$modal","Program","SparamType","Workorder","SparamAuthType","SqlExec","WoFlowType","transactionType","IssuFunc","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r=[];a.control={program_basic_save_loading:!1,show_detail_flag:!1,add_step_by_hand_flag:!1,import_flag:!1,batch_import_btn_flag:!1,batch_select_add_btn_flag:!1,import_program_type:2,program_save_btn_loading:!1,program_preview_btn:!1,by_handleData_btn:b.flag},a.info={program_info:{tran_flag:1,program_name:"",program_bk_desc:""},import_program_info:{step_list:[]},form:{new_fault_program_form:{}},workorderData:{show_all_detail:!1,basicData:{},flowData:[]},handleData:{show_all_detail:!1,sql_msg_list:[],sql_msg_detail_list:[]}},a.data={param_type_list:g,busy_sys_list:[],soc_list:[],transaction_type_list:l,auth_type:i,param_type:g,auth_dept_list:[]};var s=function(b){if(0!=r.length)if(1==b.flag){for(var c=0;c<r.length;c++)if(b.sql_info.curr_index==r[c].curr_index){a.info.handleData.sql_msg_list.push(r[c]),r.splice(c,1);break}}else for(var c=0;c<r.length;c++)for(var d=r[c],e=0;e<b.sql_info.sql_list.length;e++){var f=b.sql_info.sql_list[e];if(d.curr_index==f.curr_index){a.info.handleData.sql_msg_list.push(f),r.splice(c,1);break}}},t=function(){if(n.getAllBusinessSys().then(function(b){a.data.busy_sys_list=b.list_bs?b.list_bs:[]},function(a){o.alert(a.message)}),h.getAppointDepartmentList().then(function(b){a.data.auth_dept_list=b.dept_list?b.dept_list:[]},function(a){o.alert(a.message)}),a.control.by_handleData_btn){var c=b.order_seq,d=b.deal_bk_seq;a.importSql=function(b,c){var d=a.info.program_info.step_list[c];return p.valiForm(d.new_step_form)?void o.importSqlInCreateProgram(a.info.handleData).then(function(c){if(c){var e=a.info.program_info.program_seq;f.addProgramStepSql(e,b.step_seq,c.sql_txt,c.sys_name).then(function(e){d.sql_list.push({editable:!0,sql_text:c.sql_txt,sys_name:c.sys_name,soc_name:c.soc_name,curr_index:c.curr_index,sys_name_text:m.getNameBySysName(c.sys_name,a.data.busy_sys_list),sql_param_list:e.sql_param_list?e.sql_param_list:[],param_list:e.sql_param_list?e.sql_param_list:[],pg_source:a.info.program_info.pg_source}),b.new_sql_btn=!1,b.show_detail=!1},function(a){o.alert("请填写正确的SQL语句")});var g=a.info.handleData.checkFlag;r.push(a.info.handleData.sql_msg_list[g]),a.info.handleData.sql_msg_list.splice(g,1)}}):!1},h.getWorkorder(c).then(function(b){a.info.workorderData.basicData=b.woorderbean?b.woorderbean:{}},function(a){o.alert(a.message)}),j.submitedSqlList(c,d).then(function(b){a.info.handleData.sql_msg_list=b.sql_msg_list?b.sql_msg_list:[],angular.forEach(a.info.handleData.sql_msg_list,function(a,b){a.curr_index=b,a.sys_name_text=a.sys_cn_name}),a.info.handleData.sql_msg_detail_list=angular.copy(a.info.handleData.sql_msg_list)},function(a){o.alert(a.message)}),h.getWorkorderFlowList(c).then(function(b){a.info.workorderData.flowData=b.order_flow_list?b.order_flow_list:[];for(var c=0;c<a.info.workorderData.flowData.length;c++){var d=a.info.workorderData.flowData[c];d.deal_bk_date&&(d.deal_time=d.deal_bk_date+" "+d.deal_bk_time.substring(0,d.deal_bk_time.length-3)),d.flow_type=p.findValue(d.flow_type,k)}},function(a){o.alert(a.message)})}};a.importFaultProgram=function(){o.importProgram().then(function(a){a&&c.go("fault_program_list")})},a.programSaveBasicInfo=function(){return a.control.program_basic_save_loading=!0,p.valiForm(a.info.form.new_fault_program_form)?void f.saveFaultProgram(a.info.program_info.program_name,a.info.program_info.program_bk_desc).then(function(b){b&&(a.control.program_basic_save_loading=!1,a.control.show_detail_flag=!0,a.info.program_info.step_list=[],a.info.program_info.program_seq=b.program_seq,a.info.program_info.work_seq=b.work_seq)},function(b){a.control.program_basic_save_loading=!1,o.alert(b.message)}):(a.control.program_basic_save_loading=!1,!1)},a.addNewProgramStep=function(b){m.addNewFaultProgramStep(a.info.program_info,a.control,b)},a.importProgramStep=function(b){a.info.import_program_info.step_list=[],o.importAllStep().then(function(c){a.control.get_excel_data=!0,f.importBatchProgramStep(c,b).then(function(b){b&&(a.info.import_program_info.step_list=b.pg_stage_msg?b.pg_stage_msg:[],a.control.get_excel_data=!1)},function(b){a.info.import_program_info.step_list=[],a.control.add_step_by_hand_flag=!1,a.control.batch_import_btn_flag=!1,a.control.batch_select_add_btn_flag=!1,a.control.get_excel_data=!1,o.alert(b.message)}),a.control.import_flag=!0,a.control.import_program_type=b})},a.stepFormSubmit=function(b){m.saveFaultProgramStep(a.info.program_info,b,a.control)},a.deleteProgramStep=function(b,c,d){d.stopPropagation(),o.confirm("请确定是否要删除当前步骤及步骤下的SQL?").then(function(){f.deleteProgramStep(b,c).then(function(d){d&&(s({flag:2,sql_info:a.info.program_info.step_list[c-1]}),a.info.program_info.step_list.splice(c-1,1),m.refreshFaultProgramStep(b,a.info.program_info,a.control,a.data.busy_sys_list),a.info.program_info.next_step=a.info.program_info.step_list.length+1,m.showFaultProgramPreviewBtn(a.info.program_info,a.control))},function(a){o.alert(a.message)})})},a.deleteUnFinStep=function(b,c){m.deleteUnSaveProgramStep(a.info.program_info,b,a.control,c)},a.addSqlForm=function(b,c){m.addStepSqlForm(a.info.program_info,c,a.data.busy_sys_list,b)},a.sqlParamFormSubmit=function(b,c,d){m.saveFaultProgramStepSqlParam(a.info.program_info,b,c,d,a.control)},a.getSqlParamAuthRoleByDept=function(a,b,c,d){f.getSqlParamAuthRoleByDept(a).then(function(a){d.authRole=a.dept_role_list?a.dept_role_list:[]},function(a){o.alert(a.message)})},a.viewSqlDetailInfo=function(a,b,c,d){o.viewSqlDetail(a,b,c,d)},a.editSqlParam=function(a,b,c){c.sql_param_btn=!1,c.editable=!0},a.deleteSql=function(b,c){s({flag:1,sql_info:a.info.program_info.step_list[b].sql_list[c]}),m.deleteSqlInProgramStep(a.info.program_info,b,c,a.control)},a.programPreview=function(a){o.previewProgram(a)},a.submitProgram=function(b){var d=m.validFaultProgramAllSqlSubmit(a.info.program_info);if(a.control.import_flag){if(!p.valiForm(a.info.form.new_fault_program_form))return!1;a.control.btn_program_save_loading=!0,f.saveImportProgram(b,a.info.program_info.program_name,a.info.program_info.program_bk_desc,a.info.import_program_info.step_list,a.info.program_info.tran_flag,a.control.import_program_type).then(function(b){a.control.btn_program_save_loading=!1,o.alert("新建批量方案保存成功"),c.go("fault_program_list")},function(b){a.control.btn_program_save_loading=!1,o.alert(b.message)})}else{if(0==a.info.program_info.step_list.length)return o.alert("请至少添加一个步骤"),!1;if(2==d)return o.alert("存在未提交的sql"),!1;if(1==d)return o.alert("步骤中至少添加一条sql"),!1;a.control.btn_program_save_loading=!0,f.saveProgram(b).then(function(b){o.alert("新建方案保存成功"),a.control.btn_program_save_loading=!1,c.go("fault_program_list")},function(b){a.control.btn_program_save_loading=!1,o.alert(b.message)})}},a.getDownTime=function(){q=(new Date).getTime()},a.toggleDetail=function(a){var b=(new Date).getTime();b-q>300||(a.show_detail=!a.show_detail)},a.sortableOptions={start:function(a,b){b.item.sortable.model.show_detail||b.item.sortable.cancel()},update:function(b,c){f.slideProgramStep(a.info.program_info.program_seq,c.item.sortable.index+1,c.item.sortable.dropindex+1).then(function(){m.refreshFaultProgramStep(a.info.program_info.program_seq,a.info.program_info,a.control,a.data.busy_sys_list)},function(a){o.alert(a.message)})}},a.cancel=function(){c.go("fault_program_list")},a.stopPrevent=function(a){a.stopPropagation()},t()}]),pCtrl.controller("faultProgramModifyCtrl",["$scope","$state","$stateParams","$timeout","$modal","Program","SparamType","Workorder","transactionType","SparamAuthType","IssuFunc","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o,p=c.program_id;a.info={program_info:{tran_flag:1,program_name:"",program_bk_desc:""},import_program_info:{step_list:[]},form:{modify_fault_program_form:{}}},a.control={program_info_loading:!1,program_is_ok:!0,add_step_by_hand_flag:!1,batch_import_btn_flag:!1,batch_select_add_btn_flag:!1,program_edit_save_btn_loading:!1,program_preview_btn:!1},a.data={busy_sys_list:[],transaction_type_list:i,auth_type:j,param_type:g,auth_dept_list:[]};var q=function(){a.control.program_info_loading=!0,l.getAllBusinessSys().then(function(b){a.data.busy_sys_list=b.list_bs?b.list_bs:[]},function(c){a.control.program_info_loading=!1,m.alert(c.message),b.go("fault_program_list")}).then(function(){k.refreshFaultProgramStep(p,a.info.program_info,a.control,a.data.busy_sys_list)}),h.getAppointDepartmentList().then(function(b){a.data.auth_dept_list=b.dept_list?b.dept_list:[]},function(a){m.alert(a.message)})};a.importProgramStep=function(b){a.info.import_program_info.step_list=[],m.importAllStep().then(function(c){a.control.get_excel_data=!0,f.importBatchProgramStep(c,b).then(function(b){b&&(a.info.import_program_info.step_list=b.pg_stage_msg?b.pg_stage_msg:[],a.control.get_excel_data=!1)},function(b){a.info.import_program_info.step_list=[],a.control.add_step_by_hand_flag=!1,a.control.batch_import_btn_flag=!1,a.control.batch_select_add_btn_flag=!1,a.control.get_excel_data=!1,m.alert(b.message)}),a.control.import_flag=!0,a.control.import_program_type=b})},a.programPreview=function(a){m.previewProgram(a)},a.addNewProgramStep=function(b){k.addNewFaultProgramStep(a.info.program_info,a.control,b)},a.stepFormSubmit=function(b){k.saveFaultProgramStep(a.info.program_info,b,a.control)},a.deleteUnFinStep=function(b,c){k.deleteUnSaveProgramStep(a.info.program_info,b,a.control,c)},a.deleteStep=function(b,c,d){d.stopPropagation(),m.confirm("请确定是否要删除当前步骤及步骤下的SQL?").then(function(){f.deleteProgramStep(b,c).then(function(d){d&&(a.info.program_info.step_list.splice(c-1,1),k.refreshFaultProgramStep(b,a.info.program_info,a.control,a.data.busy_sys_list),a.info.program_info.next_step=a.info.program_info.step_list.length+1),a.control.program_is_ok=!1},function(a){m.alert(a.message)})})},a.initSqlForm=function(b,c){k.addStepSqlForm(a.info.program_info,c,a.data.busy_sys_list,b)},a.sqlParamFormSubmit=function(b,c,d){k.saveFaultProgramStepSqlParam(a.info.program_info,b,c,d,a.control)},a.viewSqlDetailInfo=function(a,b,c,d){m.viewSqlDetail(a,b,c,d)},a.editSqlParam=function(a,b,c){c.sql_param_btn=!1,c.editable=!0},a.deleteSql=function(b,c){k.deleteSqlInProgramStep(a.info.program_info,b,c,a.control)},a.getSqlParamAuthRoleByDept=function(a,b,c,d){f.getSqlParamAuthRoleByDept(a).then(function(a){d.authRole=a.dept_role_list?a.dept_role_list:[]},function(a){m.alert(a.message)})},a.getDownTime=function(){o=(new Date).getTime()},a.toggleDetail=function(a){var b=(new Date).getTime();b-o>300||(a.show_detail=!a.show_detail)},a.sortableOptions={start:function(a,b){b.item.sortable.model.step_bk_title&&b.item.sortable.model.show_detail||b.item.sortable.cancel()},update:function(b,c){f.slideProgramStep(p,c.item.sortable.index+1,c.item.sortable.dropindex+1).then(function(){k.refreshFaultProgramStep(p,a.info.program_info,a.control,a.data.busy_sys_list),a.control.program_is_ok=!1},function(a){m.alert(a.message)})}},a.submitProgram=function(c){var d=k.validFaultProgramAllSqlSubmit(a.info.program_info);if(a.control.program_edit_save_btn_loading=!0,!n.valiForm(a.info.form.modify_fault_program_form))return a.control.program_edit_save_btn_loading=!1,!1;if(a.control.import_flag)f.saveImportProgram(c,a.info.program_info.program_name,a.info.program_info.program_bk_desc,a.info.import_program_info.step_list,a.info.program_info.tran_flag,a.control.import_program_type).then(function(a){m.alert("批量方案保存成功"),b.go("fault_program_list")},function(b){a.control.program_edit_save_btn_loading=!1,m.alert(b.message)});else{if(2==d)return m.alert("存在未提交的sql"),a.control.program_edit_save_btn_loading=!1,!1;if(1==d)return m.alert("步骤中至少添加一条sql"),a.control.program_edit_save_btn_loading=!1,!1;f.editProgram(c,a.info.program_info.program_name,a.info.program_info.program_bk_desc).then(function(d){d&&(angular.extend(a.info.program_info,d),a.info.program_info.step_list&&0!=a.info.program_info.step_list.length&&f.saveProgram(c).then(function(a){m.alert("修改方案成功"),b.go("fault_program_list")},function(b){a.control.btn_program_edit_loading=!1,m.alert(b.message)}))},function(b){a.control.program_edit_save_btn_loading=!1,m.alert(b.message)})}},a.cancel=function(){b.go("fault_program_list")},a.$watch("control.program_is_ok",function(){a.program_is_ok||f.checkProgram(p).then(function(b){a.control.program_is_ok=!0},function(a){m.alert(a.message)})}),a.stopPrevent=function(a){a.stopPropagation()},q()}]),pCtrl.controller("faultProgramDetailCtrl",["$scope","$stateParams","$state","$timeout","$modal","Program","SparamType","Workorder","IssuFunc","SparamAuthType","BusiSys","transactionType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b.program_id,p=b.program_source;a.info={program_info:{},import_program_info:{}},a.control={program_info_loading:!1,input_disabled:!0},a.data={database_list:[],param_type_list:g,transaction_type_list:l,auth_type:j,param_type:g,auth_dept_list:[]};var q=function(){a.info.program_info.pg_source=p,a.control.program_info_loading=!0,1==p||3==p?(k.getAllBusinessSys().then(function(b){a.data.busy_sys_list=b.list_bs?b.list_bs:[]},function(a){m.alert(a.message),c.go("fault_program_list")}).then(function(){f.getProgramAllInfoAndStepList(o).then(function(b){d(function(){if(b){a.info.program_info.program_bk_desc=b.program_bk_desc,a.info.program_info.program_seq=o,a.info.program_info.program_name=b.program_name,a.info.program_info.pg_yn_flag=b.pg_yn_flag,a.info.program_info.step_list=b.program_step_list?b.program_step_list:[];for(var c=0;c<a.info.program_info.step_list.length;c++){var d=a.info.program_info.step_list[c];d.program_sql_list=d.program_sql_list||[],d.sql_list=d.program_sql_list;for(var e=0;e<d.sql_list.length;e++){var f=d.sql_list[e];f.editable=!1,f.pg_source=b.pg_source?b.pg_source:1,f.sys_name_text=i.getNameBySysName(f.sys_name,a.data.busy_sys_list),f.sql_param_list=f.sql_param_list?f.sql_param_list:[],f.param_list=f.sql_param_list;for(var g=0;g<f.param_list.length;g++){var h=f.param_list[g];h.param_auth_list=h.param_auth_list?h.param_auth_list:[];for(var k=0;k<h.param_auth_list.length;k++)h.param_auth_list[k].sparam_auth_list=j}}}a.control.program_info_loading=!1}},0)},function(a){m.alert(a.message),c.go("fault_program_list")})}),h.getAppointDepartmentList().then(function(b){a.data.auth_dept_list=b.dept_list?b.dept_list:[]},function(a){m.alert(a.message)})):f.viewImportProgram(o).then(function(b){d(function(){b&&(a.info.program_info.program_bk_desc=b.program_bk_desc,a.info.program_info.program_name=b.program_name,a.info.program_info.program_seq=o,a.info.program_info.pg_yn_flag=b.pg_yn_flag,a.info.program_info.tran_flag=b.tran_flag,a.info.import_program_info.step_list=b.pg_stage_msg?b.pg_stage_msg:[],a.control.program_info_loading=!1)},0)},function(a){m.alert(a.message),c.go("fault_program_list")})};a.programPreview=function(a){m.previewProgram(a)},a.exportProgram=function(a){f.exportUsableProgram(a).then(function(a){n.downloadFile(a.file_full_path)},function(a){m.alert(a.message)})},a.sqlDetail=function(a,b,c,d){m.viewSqlDetail(a,b,c,d)},a.getSqlParamAuthRoleByDept=function(a,b,c,d){f.getSqlParamAuthRoleByDept(a).then(function(a){d.authRole=a.dept_role_list?a.dept_role_list:[]},function(a){m.alert(a.message)})},a.back=function(){c.go("fault_program_list")},q()}]);var woCtrl=angular.module("WorkorderController",[]);woCtrl.controller("DemoCtrl",["$scope",function(a){}]),woCtrl.controller("woImportCtrl",["$scope","$stateParams","$state","Workorder","Modal",function(a,b,c,d,e){var f=b.file_name;a.info={total_size:0,success_num:0,file_name:f},a.saveImportOrder=function(){d.importExcelWorkorder(f).then(function(a){c.go("wo_mine",{tab_name:"create"})},function(a){e.alert(a.message),c.go("wo_new")})},a.cancel=function(){c.go("wo_new")}}]),woCtrl.controller("woNewCtrl",["$scope","$timeout","$state","$modal","$rootScope","Workorder","IssuFunc","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=e.loginUser,l=k.org_user_id,m=k.org_dept_id;a.info={workorder_info:{},form:{}},a.control={workorder_save_btn_loading:!1},a.data={workorder_errortype_list:[],department_list:[],workorder_sys_list:[],user_list:[]},a.config={excel_upload:{suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:""}};var n=function(){a.info.workorder_info=g.initWorkOrderInfo(a.info.workorder_info,m),a.loadStaffObj(a.info.workorder_info.deal_dept_id),f.getOrderUploadPath().then(function(b){a.config.excel_upload.uploadpath=b.order_upload_path?b.order_upload_path:""},function(a){i.alert(a.message)}),f.getTroubleTypeList().then(function(c){b(function(){a.data.workorder_errortype_list=c.trouble_type_list?c.trouble_type_list:[]},0)},function(a){i.alert(a.message)}),h.getAllBusinessSys().then(function(c){b(function(){a.data.workorder_sys_list=c.list_bs?c.list_bs:[]},0)},function(a){i.alert(a.message)}),f.getAppointDepartmentList().then(function(c){b(function(){a.data.department_list=c.dept_list?c.dept_list:[]},0)},function(a){i.alert(a.message)})};a.importSuccessThen=function(){c.go("wo_import",{file_name:a.config.excel_upload.filename})},a.changeOrderType=function(b){a.info.workorder_info=g.initWorkOrderInfo(a.info.workorder_info,m,b),a.loadStaffObj(a.info.workorder_info.deal_dept_id),a.info.form.workorder_form.$setPristine()},a.loadStaffObj=function(c){f.getAppointStaffList(c).then(function(c){b(function(){a.data.user_list=c.user_list?c.user_list:[]},0)},function(a){i.alert(a.message)}),c!=m?a.info.workorder_info.deal_user_id="":a.info.workorder_info.deal_user_id=l},a.formSubmit=function(){return a.control.workorder_save_btn_loading=!0,j.valiForm(a.info.form.workorder_form)?(a.info.workorder_info.urgency_level=a.info.workorder_info.urgency_state?2:1,a.info.workorder_info.trouble_key=a.info.workorder_info.trouble_key?a.info.workorder_info.trouble_key:0,void f.saveWorkorderInfo(a.info.workorder_info).then(function(e){b(function(){e&&(a.control.workorder_save_btn_loading=!1,a.info.workorder_info.order_seq=e.order_seq?e.order_seq:"",d.open({templateUrl:"templates/modal/workorder_conform.html",controller:["$scope","$modalInstance","workOrderInfo","CV",function(a,b,c,d){a.info={workorder_info:c},a.continueWorkOrder=function(){b.close(1)},a.dealWorkOrder=function(){b.close(2)},a.cancelWorkOrder=function(){b.close(3)}}],backdrop:"static",keyboard:!1,size:"md",resolve:{workOrderInfo:function(){return a.info.workorder_info}}}).result.then(function(b){1==b?a.changeOrderType(1):2==b?c.go("wo_mine",{tab_name:"handle",order_seq:a.info.workorder_info.order_seq}):c.go("wo_mine",{tab_name:"create"})}))},0)},function(b){a.control.workorder_save_btn_loading=!1,i.alert(b.message)})):(a.control.workorder_save_btn_loading=!1,!1)},a.formCancel=function(){c.go("wo_mine",{tab_name:"create"})},n()}]),woCtrl.controller("woModifyCtrl",["$scope","$timeout","$state","$stateParams","Workorder","IssuFunc","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=d.wo_seq;a.info={workorder_info:{},form:{}},a.control={edit_flag:!0,workorder_info_btn_loading:!1,workorder_save_btn_loading:!1},a.data={workorder_errortype_list:[],workorder_sys_list:[]};var k=function(){f.initWorkOrderInfo(a.info.workorder_info),a.control.workorder_info_btn_loading=!0,e.getWorkorder(j).then(function(c){b(function(){c.woorderbean&&(a.control.workorder_info_btn_loading=!1,a.info.workorder_info=c.woorderbean?c.woorderbean:{},a.info.workorder_info.urgency_state=2==a.info.workorder_info.urgency_level?!0:!1)})},function(b){a.control.workorder_info_btn_loading=!1,h.alert(b.message),c.go("wo_mine",{tab_name:"create"})}),e.getTroubleTypeList().then(function(c){b(function(){a.data.workorder_errortype_list=c.trouble_type_list?c.trouble_type_list:[]},0)},function(a){h.alert(a.message)}),g.getAllBusinessSys().then(function(c){b(function(){a.data.workorder_sys_list=c.list_bs?c.list_bs:[]},0)},function(a){h.alert(a.message)})};a.formSubmit=function(){return a.control.workorder_save_btn_loading=!0,i.valiForm(a.info.form.workorder_form)?(a.info.workorder_info.urgency_level=a.info.workorder_info.urgency_state?2:1,void e.updateWorkorder(a.info.workorder_info).then(function(d){b(function(){d&&(a.control.workorder_save_btn_loading=!1,h.alert("编号 "+a.info.workorder_info.order_seq+"  工单已修改成功！"),c.go("wo_mine",{tab_name:"create"}))},0)},function(b){a.control.workorder_save_btn_loading=!1,h.alert(b.message)})):(a.control.workorder_save_btn_loading=!1,!1)},a.formCancel=function(){c.go("wo_mine",{tab_name:"create"})},k()}]),woCtrl.controller("woMineCtrl",["$scope","$timeout","$state","$stateParams","$location","Workorder","CodeMirrorOption","Program","WoStatusType","WoFlowType","BucketType","SqlExec","IssuFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=d.tab_name,q=d.order_seq,r=e.absUrl();a.form={},a.info={pending_number:0},a.control={active_tab:"",exist_index:-1},a.data={sub_tabs:[],sql_sys_list:[]};var s=function(b){"create"==b&&(a.control.active_tab="create",c.go("wo_mine.create_list")),b&&"pending"==b&&(a.control.active_tab="pending",c.go("wo_mine.pending_list")),b&&"processed"==b&&(a.control.active_tab="processed",c.go("wo_mine.processed_list")),b&&"handle"==b&&(a.control.active_tab="handle",c.go("wo_mine.wo_handle"))},t=function(){var b=/\/wo_mine\/create_list/g,d=/\/wo_mine\/pending_list/g,e=/\/wo_mine\/processed_list/g,f=/\/wo_mine\/wo_handle/g;b.test(r)&&(a.control.active_tab="create",c.go("wo_mine.create_list")),d.test(r)&&(a.control.active_tab="pending",c.go("wo_mine.pending_list")),e.test(r)&&(a.control.active_tab="processed",c.go("wo_mine.processed_list")),f.test(r)&&(a.control.active_tab="handle",c.go("wo_mine.wo_handle"))},u=function(d,e,k,p,q,r){a.control.exist_index=-1;for(var s=0;s<a.data.sub_tabs.length;s++){var t=a.data.sub_tabs[s];t.active=!1,d==t.wo_id&&(a.control.exist_index=s)}if(-1!=a.control.exist_index&&a.data.sub_tabs[a.control.exist_index].handle_type){var u=a.data.sub_tabs[a.control.exist_index];u.active=!0,u.is_detail=r,u.show_all_detail=!1}else{var v={task_id:"",is_detail:r,wo_id:d,active:!0,show_all_detail:!1,steps:[],program_seq:"",program_name:"",sql_steps:[],flowData:[],wo_handle_loading:!1,temp_handle_type:e,handle_type:e,original_handle_type:e,script_info:{rollback_flag:!1,stop_watch_flag:!1,execute_list:[],form_control:{executing:!1,is_rollback:!1,exec_result_list:[],cache_soc_list:[],exec_result:""},data:{soc_name_list:[],ftp_soc_name_list:[],impl_type_list:[{key:2,value:"shell"},{key:7,value:"python2"},{key:8,value:"python3"}]},script_fileupload:{suffixs:"sh",filetype:"SHELL",filename:"",uploadpath:""},view_options:g.Sh(!0),edit_options:g.Sh(),python_options:g.Python(),view_python_options:g.Python(!0),script_form:{soc_list:[],script_source:1,exe_script:"",script_content:[],script_file_path:"",impl_type:""}},sql_soc_list:[],batch_fileupload:{suffixs:"sql",filetype:"SQL",filename:"",uploadpath:""},control:{}};a.data.sub_tabs[a.control.exist_index]?a.data.sub_tabs[a.control.exist_index]=v:a.data.sub_tabs.push(v);var w=a.data.sub_tabs[a.data.sub_tabs.length-1];w.show_all_detail=!1,w.exc_step_flag=!1,w.basicData=angular.copy(p);var x=w.basicData.handle_type?w.basicData.handle_type:e,y=w.basicData.order_seq;w.basicData.order_cn_state=o.findValue(w.basicData.order_state,i),w.handle_type=x?x:e,w.temp_handle_type=x?x:e,w.original_handle_type=x?x:e,w.basicData.sqlexe_type=w.basicData.sqlexe_type?w.basicData.sqlexe_type:k,w.sqlexe_type=w.basicData.sqlexe_type?w.basicData.sqlexe_type:k,w.basicData.flag=q,w.basicData.sys_name&&h.getSocByBusy(w.basicData.sys_name,1).then(function(a){b(function(){if(a){w.sql_soc_list=[];for(var b=a.source_list?a.source_list:[],c=0;c<b.length;c++)w.sql_soc_list.push(b[c].soc_name)}},0)},function(a){n.alert(a.message)}),2==q&&(1==w.sqlexe_type||4==x)&&l.submitedSqlList(y,w.basicData.deal_bk_seq).then(function(a){var b=a.sql_msg_list?a.sql_msg_list:[];angular.forEach(b,function(a){a.pend_work_seq&&(a.is_single_task_author=!0),a.generate_sql={generate_sql_list:[]}}),b&&(w.sql_steps=b,m.sqlBucketTranslateCnType(w.sql_steps),m.sqlHandleAllSubmitBtnControl(w),m.quitHandleBtnControl(w),m.finishHandleBtnControl(w))},function(a){n.alert(a.message)}),f.getWorkorderFlowList(d).then(function(a){w.wo_handle_loading=!0,w.flowData=a.order_flow_list?a.order_flow_list:{};for(var b=0;b<w.flowData.length;b++)w.flowData[b].deal_bk_date&&(w.flowData[b].deal_time=w.flowData[b].deal_bk_date+" "+w.flowData[b].deal_bk_time.substring(0,w.flowData[b].deal_bk_time.length-3)),w.flowData[b].flow_type=o.findValue(w.flowData[b].flow_type,j)},function(a){n.alert(a.message)})}a.control.active_tab="handle",c.go("wo_mine.wo_handle")},v=function(){p?s(p):t(),a.getPendingWorkorderNumber(),q&&f.getWorkorder(q).then(function(b){var c=b.woorderbean.stop_yn_flag?b.woorderbean.stop_yn_flag:1;a.addProcessOrder(q,!1,c)},function(a){n.alert(a.message)})};a.getPendingWorkorderNumber=function(){f.queryWoOrderNumber().then(function(b){a.info.pending_number=b.process_num?b.process_num:0},function(a){n.alert(a.message)})},a.closeProcessOrder=function(b,c){-1==b?angular.forEach(a.data.sub_tabs,function(a,b,d){a.wo_id==c&&d.splice(b,1)}):n.confirm("确认关闭当前处理页面？").then(function(c){c&&a.data.sub_tabs.splice(b,1)})},a.switchTab=function(b){a.control.active_tab=b,"create"==b&&c.go("wo_mine.create_list"),"pending"==b&&c.go("wo_mine.pending_list"),"processed"==b&&c.go("wo_mine.processed_list"),"handle"==b&&(0!=a.data.sub_tabs.length&&(a.control.exist_index=a.data.sub_tabs.length-1),c.go("wo_mine.wo_handle"))},a.addProcessOrder=function(a,b,c){var d=null,e=null,g={},h=0;1!=c||b?f.getWorkorder(a).then(function(c){g=c.woorderbean?angular.copy(c.woorderbean):{},h=g.deal_bk_seq,u(a,d,e,angular.copy(g),2,b)},function(a){n.alert(a.message)}):n.chooseHandleType(a).then(function(c){1==c.temp_handle_type?(d=1,e=1):4==c.temp_handle_type?(d=1,e=2):d=5==c.temp_handle_type?4:parseInt(c.temp_handle_type),f.getHandlerType(a,d,e).then(function(c){h=c.deal_bk_seq?c.deal_bk_seq:0,f.getWorkorder(a).then(function(c){g=c.woorderbean?angular.copy(c.woorderbean):{},u(a,d,e,angular.copy(g),1,b)},function(a){n.alert(a.message)})},function(a){n.alert(a.message)})})},v()}]),woCtrl.controller("woHandleCtrl",["$scope","$timeout","$state","$stateParams","Workorder","Task","BusiSys","IssuFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){a.handle_control={curr_index:0};var k=function(){for(var b,c=0;c<a.data.sub_tabs.length;c++)if(a.data.sub_tabs[c].active){b=c;break}return b},l=function(){a.handle_control.curr_index=k()||0,a.pgauthflag={btn_loading:!1},g.getAllBusinessSys().then(function(c){b(function(){c&&(a.data.sql_sys_list=c.list_bs?c.list_bs:[])},0)},function(a){i.alert(a.message)})};a.viewTaskAuthorDetail=function(a,b){var c=b?b.pend_work_seq:a.task_id;i.viewBatchImportAuthorDetail(c).then(function(c){c&&(b?b.workflow_state=c:(a.workflow_state=c,a.control.finish_author=6==c?!0:!1))})},a.closeBatchExeTask=function(a,b,c,d){var e={pend_wk_seq:b.pend_work_seq,workflow_state:7};b.is_close_loading=!0,f.CloseTask(e).then(function(e){b.workflow_state=7,b.is_close_loading=!1,b.is_single_task_author=!1,3!=c?a.sql_steps.splice(d,1):(b.all_executesql_success=!0,b.generate_sql_list=[],b.is_generate_sql_author=!1),h.quitHandleBtnControl(a),h.finishHandleBtnControl(a),i.alert("任务成功关闭！")},function(a){b.is_close_loading=!1,
i.alert(a.message)})},a.goToPendingList=function(){a.control.active_tab="pending",c.go("wo_mine.pending_list")},a.abandonHandle=function(b){var c=k(),d=b.handle_type,f=b.basicData.order_seq,g=b.basicData.deal_bk_seq;i.confirm("确认放弃对工单的处理？").then(function(b){b&&e.wo_StopOrderAction(d,f,g).then(function(b){a.data.sub_tabs.splice(c,1)},function(a){i.alert(a.message)})})},a.finishDealWorkOrder=function(b){i.confirm("确认完成工单处理 ?").then(function(c){if(c){var d=k();e.complateOrder(b.wo_id).then(function(b){a.data.sub_tabs.splice(d,1),a.getPendingWorkorderNumber()},function(a){i.alert(a.message)})}})},l()}]),woCtrl.controller("woSqlHandCtrl",["$scope","$timeout","$interval","$modal","Workorder","Program","WoFlowType","ProgramExec","SqlExec","IssuFunc","WoStatusType","CodeMirrorOption","Cmpt","CommData","Task","ScriptExec","CmptFunc","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){a.modify_info={sql_work_seq:"",theads:"",modify_string:"",modify_list:[]};var u=function(a){var c=[],d=10*a.sql_step.page.current_page;c.push({sql_work_seq:a.sub_tab.sql_steps[a.sql_step_index].sql_work_seq,sql_text:a.sub_tab.sql_steps[a.sql_step_index].sql_text,order_seq:a.sub_tab.basicData.order_seq,deal_bk_seq:a.sub_tab.basicData.deal_bk_seq}),a.sql_step.page_data_loading=!0,i.execSelectSqlList(c,d,10).then(function(c){b(function(){if(c.query_msg){a.sql_step.page_data_loading=!1,a.sql_step.read_only=a.sql_step.generate_sql.all_executesql_success&&0!=a.sql_step.generate_sql.generate_sql_list.length?!0:!1;for(var b=0;b<c.query_msg.length;b++)c.query_msg[b].theads&&(c.query_msg[b].theads=j.setPrimaryKeySort(c.query_msg[b].theads));j.createPageNumberByData(a.sql_step,c.query_msg);var d=c.query_msg;j.getSqlMsgList(d,a.sub_tab.sql_steps),a.sub_tab.show_all_submit_btn=!1,a.sub_tab.sql_steps[a.sql_step_index].submit_sql_btn_loading=!1,j.quitHandleBtnControl(a.sub_tab),j.finishHandleBtnControl(a.sub_tab)}},0)},function(b){a.sql_step.page_data_loading=!1,a.sub_tab.sql_steps[a.sql_step_index].submit_sql_btn_loading=!1,b.task_id?(a.sub_tab.sql_steps[a.sql_step_index].pend_work_seq=b.task_id,a.sub_tab.sql_steps[a.sql_step_index].is_single_task_author=!0,j.quitHandleBtnControl(a.sub_tab)):s.alert(b.message)})};a.addHandleSQL=function(a){j.addSqlText(a)},a.deleteSqlStep=function(a,b,c,d){j.deleteHandleSqlText(d,a,c,b)},a.viewSqlStepDetailModal=function(a){s.viewSqlDetailStep(a).then(function(){})},a.submitSqlStep=function(a,c,d,e,f){var g=[],h=[],k=[],l="",m=e?e:0,n=f?f:10;s.confirmSqlStatement(a,l).then(function(){d.sql_steps[c].submit_sql_btn_loading=!0,1==d.sql_steps[c].sql_type?(g.push({sql_work_seq:d.sql_steps[c].sql_work_seq,sql_text:d.sql_steps[c].sql_text,order_seq:d.basicData.order_seq,deal_bk_seq:d.basicData.deal_bk_seq}),i.execSelectSqlList(g,m,n).then(function(e){b(function(){if(e.query_msg){for(var b=0;b<e.query_msg.length;b++)e.query_msg[b].theads&&(e.query_msg[b].theads=j.setPrimaryKeySort(e.query_msg[b].theads));j.createPageNumberByData(a,e.query_msg);var f=e.query_msg;j.getSqlMsgList(f,d.sql_steps),d.show_all_submit_btn=!1,d.sql_steps[c].submit_sql_btn_loading=!1,j.quitHandleBtnControl(d),j.finishHandleBtnControl(d)}},0)},function(a){d.sql_steps[c].submit_sql_btn_loading=!1,a.task_id?(d.sql_steps[c].pend_work_seq=a.task_id,d.sql_steps[c].is_single_task_author=!0,j.quitHandleBtnControl(d)):s.alert(a.message)})):(h.push({sql_work_seq:d.sql_steps[c].sql_work_seq,sql_text:d.sql_steps[c].sql_text,order_seq:d.basicData.order_seq,deal_bk_seq:d.basicData.deal_bk_seq}),k.push({sql_work_seq:d.sql_steps[c].sql_work_seq,sql_text:d.sql_steps[c].sql_text}),i.execModifySqlList(h,k).then(function(a){b(function(){if(a.modify_msg){var b=a.modify_msg;d.sql_steps[c].submit_sql_btn_loading=!1,d.show_all_submit_btn=!1,j.getSqlMsgList(b,d.sql_steps),j.quitHandleBtnControl(d),j.finishHandleBtnControl(d)}},0)},function(a){d.sql_steps[c].submit_sql_btn_loading=!1,a.task_id?(d.sql_steps[c].pend_work_seq=a.task_id,d.sql_steps[c].is_single_task_author=!0,j.quitHandleBtnControl(d)):s.alert(a.message)}))})},a.submitSingleSqlAuthor=function(a,c,d){var e="",f={};d.sql_steps[c].is_close_loading=!0,1==d.sql_steps[c].sql_type?(e="sl_ExecuteQuerySqlAction",f={submit_type:2,pend_work_seq:a.pend_work_seq,query_sql_list:[],sql_text:d.sql_steps[c].sql_text,sensite_list:d.sql_steps[c].sensite_list}):(e="sl_ExecuteModifySqlAction",f={submit_type:2,pend_work_seq:a.pend_work_seq,modify_sql_list:[]}),d.sql_steps[c].submit_sql_btn_loading=!0,o.ExecuteTask(f,e).then(function(e){b(function(){if(e){var b=[];if(d.sql_steps[c].is_close_loading=!1,d.sql_steps[c].is_single_task_author=!1,1==d.sql_steps[c].sql_type){b=e.query_msg?e.query_msg:[];for(var f=0;f<e.query_msg.length;f++)e.query_msg[f].theads&&(e.query_msg[f].theads=j.setPrimaryKeySort(e.query_msg[f].theads));j.createPageNumberByData(a,e.query_msg)}else b=e.modify_msg?e.modify_msg:[];j.getSqlMsgList(b,d.sql_steps),d.sql_steps[c].all_executesql_success=!0,d.show_all_submit_btn=!1,d.sql_steps[c].submit_sql_btn_loading=!1,j.quitHandleBtnControl(d),j.finishHandleBtnControl(d),e.download_path_list&&(d.sql_steps[c].download_bk_path=e.download_path_list[0])}},0)},function(a){d.sql_steps[c].submit_sql_btn_loading=!1,d.sql_steps[c].is_close_loading=!1,s.alert(a.message)})},a.switchPage=function(a,b){switch(b.sql_step.page.current_page=a.value,a.key){case 1:a.value>0&&a.value<b.sql_step.page.numbers-1&&(b.sql_step.page.show_page=[{key:1,value:a.value-1},{key:2,value:a.value},{key:3,value:a.value+1},{key:4,value:a.value+2}]);break;case 4:a.value>2&&a.value<b.sql_step.page.numbers-1&&(b.sql_step.page.show_page=[{key:1,value:a.value-2},{key:2,value:a.value-1},{key:3,value:a.value},{key:4,value:a.value+1}])}u(b)},a.nextPage=function(a,b){if(a){if(b.sql_step.page.current_page==b.sql_step.page.numbers-1)return void s.alert("已是最后一页");for(var c=(++b.sql_step.page.current_page,0);c<b.sql_step.page.show_page.length;c++){var d=b.sql_step.page.show_page[c];if(b.sql_step.page.current_page==d.value)return void u(b)}angular.forEach(b.sql_step.page.show_page,function(a,b,c){a.value++})}else{if(0==b.sql_step.page.current_page)return void s.alert("已是最前一页");for(var c=(--b.sql_step.page.current_page,0);c<b.sql_step.page.show_page.length;c++){var d=b.sql_step.page.show_page[c];if(b.sql_step.page.current_page==d.value)return void u(b)}angular.forEach(b.sql_step.page.show_page,function(a,b,c){a.value--})}u(b)},a.skipMostPage=function(a,b){if(a){var c=b.sql_step.page.numbers-1;b.sql_step.page.current_page=b.sql_step.page.numbers-1,b.sql_step.page.show_page=[{key:1,value:c-3},{key:2,value:c-2},{key:3,value:c-1},{key:4,value:c}]}else b.sql_step.page.current_page=0,b.sql_step.page.show_page=[{key:1,value:0},{key:2,value:1},{key:3,value:2},{key:4,value:3}];u(b)},a.resetAll=function(a,b){var c=a.sql_steps[b].generate_sql.generate_sql_list?a.sql_steps[b].generate_sql.generate_sql_list:[];return c.length>0&&i.clearSqlList(c).then(function(c){a.sql_steps[b].read_only=!1,a.sql_steps[b].can_insert=!0,a.sql_steps[b].all_executesql_success=!1,a.sql_steps[b].generate_sql.generate_sql_list=[]},function(a){return s.alert(a.message),!1}),!0},a.generateModifySql=function(c,d,e,f){a.modify_info.modify_list=[],f.sql_steps[c].generate_sql.generate_sql_list=f.sql_steps[c].generate_sql.generate_sql_list?f.sql_steps[c].generate_sql.generate_sql_list:[],f.sql_steps[c].generate_sql_loading=!0,a.modify_info.sql_work_seq=d,a.modify_info.theads=e.theads;for(var g=0;g<e.tbodys.length;g++){var h=e.tbodys[g];if(4==h.row_status){for(var k={row_status:h.row_status},l=0;l<e.theads.length;l++){var m=e.theads[l];m.primary_key&&(k[m.key]=h[m.key])}a.modify_info.modify_list.push(k)}if(2==h.row_status){for(var n={row_status:h.row_status},o=0;o<e.theads.length;o++){var p=e.theads[o];p.primary_key?n[p.key]=h[p.key]:(h["original_"+p.key]!=h[p.key]||h[p.key+"modify_flag"])&&(n[p.key]=h[p.key])}a.modify_info.modify_list.push(n)}if(3==h.row_status){for(var q={row_status:h.row_status},r=0;r<e.theads.length;r++){var t=e.theads[r];h[t.key]?q[t.key]=h[t.key]:q[t.key]=""}a.modify_info.modify_list.push(q)}}a.modify_info.modify_string=angular.toJson(a.modify_info.modify_list),i.generateSqlByTable(a.modify_info).then(function(a){b(function(){if(a.sl_msg_list){j.sqlBucketTranslateCnType(a.sl_msg_list);for(var b=0;b<a.sl_msg_list.length;b++)for(var d=0;d<f.sql_steps[c].generate_sql.generate_sql_list.length;d++){var e=f.sql_steps[c].generate_sql.generate_sql_list[d];a.sl_msg_list[b].sql_text==e.sql_text&&(e.delete_mark=!0)}f.sql_steps[c].generate_sql.generate_sql_list=f.sql_steps[c].generate_sql.generate_sql_list.concat(a.sl_msg_list),i.mergRepeatSql(f.sql_steps[c].generate_sql.generate_sql_list).then(function(a){},function(a){s.alert(a.message)})}f.sql_steps[c].generate_sql_loading=!1,f.sql_steps[c].all_executesql_success=!1},0)},function(a){f.sql_steps[c].generate_sql_loading=!1,s.alert(a.message)})},a.allExecuteSql=function(a,c,d){d.sql_steps[c].generate_sql.all_executesql_btnloading=!0;for(var e=[],f=[],g=0;g<a.length;g++){var h=a[g];1==h.sql_type||h.delete_mark||(e.push({sql_work_seq:h.sql_work_seq,sql_text:h.sql_text,order_seq:d.basicData.order_seq,deal_bk_seq:d.basicData.deal_bk_seq}),f.push({sql_work_seq:h.sql_work_seq,sql_text:h.sql_text}))}e.length>0&&i.execModifySqlList(e,f).then(function(a){b(function(){if(a.modify_msg){var b=a.modify_msg;j.getSqlMsgList(b,d.sql_steps),d.sql_steps[c].read_only=!0,d.sql_steps[c].can_insert=!1,d.sql_steps[c].generate_sql.all_executesql_success=!0,d.sql_steps[c].generate_sql.all_executesql_btnloading=!1}},0)},function(a){d.sql_steps[c].generate_sql.all_executesql_btnloading=!1,a.task_id?(d.sql_steps[c].generate_sql.pend_work_seq=a.task_id,d.sql_steps[c].generate_sql.is_generate_sql_author=!0,d.sql_steps[c].read_only=!0,d.sql_steps[c].can_insert=!1,d.sql_steps[c].generate_sql.all_executesql_success=!0,d.hide_no_handle_btn=!0,d.finish_handle_btn=!1):s.alert(a.message)})},a.submitAuthorSqlStep=function(a,c,d){var e="sl_ExecuteModifySqlAction",f={};d.sql_steps[c].is_close_loading=!0,f={submit_type:2,pend_work_seq:a.generate_sql.pend_work_seq,modify_sql_list:[]},d.sql_steps[c].submit_sql_btn_loading=!0,o.ExecuteTask(f,e).then(function(a){b(function(){if(a){d.sql_steps[c].is_close_loading=!1,d.sql_steps[c].is_single_task_author=!1;var b=a.modify_msg?a.modify_msg:[];j.getSqlMsgList(b,d.sql_steps[c].generate_sql.generate_sql_list),d.sql_steps[c].is_generate_sql_author=!1,d.sql_steps[c].generate_sql.is_generate_sql_author=!1,d.sql_steps[c].generate_sql.all_executesql_success=!0,d.sql_steps[c].all_executesql_success=!0,d.show_all_submit_btn=!1,d.sql_steps[c].submit_sql_btn_loading=!1,j.quitHandleBtnControl(d),j.finishHandleBtnControl(d),a.download_path_list&&(d.sql_steps[c].download_bk_path=a.download_path_list[0])}},0)},function(a){d.sql_steps[c].submit_sql_btn_loading=!1,d.sql_steps[c].is_close_loading=!1,s.alert(a.message)})}}]),woCtrl.controller("woSqlBatchCtrl",["$scope","$routeParams","$timeout","$interval","$modal","Workorder","Program","WoFlowType","ProgramExec","SqlExec","BucketType","WoStatusType","CodeMirrorOption","Cmpt","CommData","Task","ScriptExec","CmptFunc","BusiSys","IssuFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=function(){if(-1==a.control.exist_index){var b=a.data.sub_tabs[a.data.sub_tabs.length-1],d=b.basicData.order_seq,e=b.basicData.deal_bk_seq;2==b.basicData.flag?j.getImportFileUploadPath(d).then(function(f){c(function(){f&&(b.batch_fileupload.uploadpath=f.program_upload_path,j.submitedImportSqlList(d,e).then(function(c){b.sql_steps=c.batch_sql_list?c.batch_sql_list:[],angular.forEach(b.sql_steps,function(c){c.tran_flag=2,c.act_exec_time=c.act_exec_time?t.sqlExeTimeUsedFmt(c.act_exec_time):0,c.import_file_info=c,c.act_exec_time&&(c.exe_result_info=c),c.exe_success=c.act_exec_time?!0:!1,c.is_exe_detail=!0,c.parse_success=!0,c.pend_work_seq&&(c.is_task_author=!0,c.sql_state=1),c.fileupload={suffixs:"sql",filetype:"SQL",filename:c.sql_bk_path?c.sql_bk_path.substring(c.sql_bk_path.lastIndexOf("/")+1,c.sql_bk_path.length):"",uploadpath:b.batch_fileupload.uploadpath},c.sql_info={script_file_path:b.batch_fileupload.uploadpath+c.fileupload.filename,sys_name:c.sys_name,soc_name:c.soc_name,sql_soc_list:[]},c.sys_name&&a.selectSys(c.sys_name,c,!0),t.quitHandleBtnControl(b),t.finishHandleBtnControl(b)})},function(a){u.alert(a.message)}))},0)},function(a){u.alert(a.message)}):a.importSQL(b)}};a.addSqlFileModal=function(a){u.showAddBatchSqlFile(a).then(function(b){if(b){var c=angular.copy(b.batch_fileupload.filename);a.show_file_upload=!1,a.batch_fileupload.filename="",a.sql_steps.push({fileupload:{filename:c,uploadpath:""},sql_info:{sql_soc_list:a.sql_soc_list?a.sql_soc_list:[],sys_name:a.basicData.sys_name?a.basicData.sys_name:"",script_file_path:a.batch_fileupload.uploadpath+c},import_file_info:{},exe_result_info:{}}),t.finishHandleBtnControl(a)}})},a.deleteImportSql=function(a,b,c,d,e){var f=1==d?"确认删除":"文件已解析，确认重置";u.confirm(f+"?").then(function(){2==d?j.resetImportSql(a.basicData.order_seq,a.basicData.deal_bk_seq,e.step_seq).then(function(d){d&&(b.splice(c,1),t.quitHandleBtnControl(a),t.finishHandleBtnControl(a))},function(a){u.alert(a.message)}):(b.splice(c,1),t.quitHandleBtnControl(a),t.finishHandleBtnControl(a))})},a.downloadImportFile=function(a){v.downloadFile(a.sql_info.script_file_path)},a.selectSys=function(a,b,d){b.soc_loading=!0,g.getSocByBusy(a,1).then(function(a){c(function(){if(a){b.soc_loading=!1,d||(b.sql_info.soc_name=""),b.sql_info.sql_soc_list=[];for(var c=a.source_list?a.source_list:[],e=0;e<c.length;e++)b.sql_info.sql_soc_list.push(c[e].soc_name)}},0)},function(a){b.soc_loading=!1,u.alert(a.message)})},a.parseImportFile=function(a,b){return b.sql_info.sys_name?b.sql_info.soc_name?(b.parse_loading=!0,b.step_seq=b.step_seq?b.step_seq:0,void j.parseImportFile(a.basicData.order_seq,a.basicData.deal_bk_seq,b.fileupload.filename,b.sql_info.sys_name,b.sql_info.soc_name,b.step_seq).then(function(a){c(function(){a&&(b.import_file_info=a.result?a.result:{},b.parse_success=!0,b.parse_loading=!1,b.step_seq=a.step_seq?a.step_seq:0,b.tran_flag=2)},0)},function(a){b.parse_success=!1,b.parse_loading=!1,u.alert(a.message)})):(u.alert("数据源不可为空"),!1):(u.alert("数据库不可为空"),!1)},a.importSQL=function(a){j.getImportFileUploadPath(a.basicData.order_seq).then(function(b){c(function(){b&&(a.basicData.sqlexe_type=2,a.batch_fileupload.uploadpath=b.program_upload_path,a.is_import=!0,a.batch_sql_executed=!1)},0)},function(a){u.alert(a.message)})},a.batchExeSQL=function(a,b){var d=!1;b.batch_exe_loading=!0,2==b.tran_flag&&(d=!0),j.batchExeSql(a.basicData.order_seq,a.basicData.deal_bk_seq,b.sql_info.sys_name,b.sql_info.soc_name,b.fileupload.filename,b.step_seq,d).then(function(d){c(function(){d.result&&(d.result.act_exec_time=d.result.act_exec_time?t.sqlExeTimeUsedFmt(d.result.act_exec_time):"--",b.exe_result_info=d.result,b.exe_success=!0,b.batch_exe_loading=!1,t.quitHandleBtnControl(a),t.finishHandleBtnControl(a))},0)},function(c){b.exe_success=!1,b.batch_exe_loading=!1,c.task_id?(b.pend_work_seq=c.task_id,b.sql_state=1,b.is_task_author=!0,t.quitHandleBtnControl(a),t.finishHandleBtnControl(a)):u.alert(c.message)})},a.authorExeSQL=function(a,b){b.is_close_loading=!0;var d="sl_BatchExecuteSqlAction",e={submit_type:2,pend_work_seq:b.pend_work_seq,deal_bk_seq:a.basicData.deal_bk_seq,order_seq:a.basicData.order_seq,file_name:b.fileupload.filename,sys_name:b.sql_info.sys_name,soc_name:b.sql_info.soc_name,step_seq:b.step_seq};p.ExecuteTask(e,d).then(function(d){c(function(){b.is_close_loading=!1,d.result&&(d.result.act_exec_time=d.result.act_exec_time?t.sqlExeTimeUsedFmt(d.result.act_exec_time):"--",b.exe_result_info=d.result,b.exe_success=!0,b.sql_state=1,b.is_task_author=!1,t.quitHandleBtnControl(a),t.finishHandleBtnControl(a))},0)},function(a){b.is_close_loading=!1,u.alert(a.message)})},a.viewExeDetail=function(a,b){var c=1==b?a.import_file_info.parse_message:a.exe_result_info.message;u.viewBatchSqlExecDetail(c).then()},a.downloadDetailFile=function(a){a&&v.downloadFile(a)},w()}]),woCtrl.controller("woSolidProgramCtrl",["$scope","$stateParams","$timeout","$modal","Workorder","Program","ProgramExec","Task","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a){g.reSelect(a.basicData.order_seq,a.basicData.deal_bk_seq).then(function(b){a.showParamList=!0,a.batchProgramBtn=!1,a.batchSelectProgramBtn=!1,a.steps=[],a.basicData.deal_bk_seq=b.deal_bk_seq,a.finish_deal_order=!1,a.first_show_resetall=!1},function(a){j.alert(a.message)})},m=function(a,b,c){b.auth_step_exsit=!1,b.steps[c].pgsubmit_type=1;var d=a.next_step;b.next_step_btn=a.next_step,b.steps[c].type=2,b.first_show_resetall=!0,b.steps[c].is_exception=!1,b.steps[c].exception_reason="",b.steps[c].checkData={sql_basic_list:[],sql_result_list:[],isSuccess:a.success,fail_reason:a.fail_reason?a.fail_reason:"",total_count:0};for(var e=0;e<a.sql_result_list.length;e++)b.steps[c].checkData.sql_result_list.push(a.sql_result_list[e]),b.steps[c].checkData.sql_result_list.length>0&&angular.forEach(b.steps[c].checkData.sql_result_list,function(a){a.scroll_x_config=i.X(),a.content_list=a.content_list?a.content_list:[],a.start_num=a.start_num?a.start_num:0,a.end_num=a.end_num?a.end_num:10,a.title_list=a.title_list?a.title_list:[],angular.forEach(a.title_list,function(a){a.key=a.key.toLowerCase()})}),a.sql_result_list[e].content_list&&1==a.sql_result_list[e].sql_type&&(b.steps[c].checkData.total_count=b.steps[c].checkData.total_count+a.sql_result_list[e].total_count);for(var f=0;f<b.steps[c].sql_list.length;f++)if(b.steps[c].sql_list[f].sql_param_list)for(var h=0;h<b.steps[c].sql_list[f].sql_param_list.length;h++){var k;k=b.steps[c].sql_list[f].sql_param_list[h].sparam_cn_name?b.steps[c].sql_list[f].sql_param_list[h].sparam_cn_name:b.steps[c].sql_list[f].sql_param_list[h].sparam_name,b.steps[c].checkData.sql_basic_list.push({key:k,value:b.steps[c].sql_list[f].sql_param_list[h].sparam_value_text})}if(-1!=d)if(d!=c+1){var l=!1;angular.forEach(b.steps,function(a){2==a.pgsubmit_type&&(l=!0,b.auth_step_exsit=!0,b.first_show_resetall=!1,a.type=1)}),l||g.getStepByProgramStepId(b.program_seq,d).then(function(a){a.sql_list&&(b.steps[d-1].sql_list=a.sql_list,b.steps[d-1].type=1,b.steps[d-1].stepFormLock=!1,b.steps[d-1].pgsubmit_type=1),b.finish_deal_order=!1},function(a){j.alert(a.message)})}else b.finish_deal_order=!0;else j.alert("执行出错");for(var f=0;f<b.steps[c].checkData.sql_result_list.length;f++){var m=b.steps[c].checkData.sql_result_list[f];o(m)}},n=function(a,b,c,d){j.pglocalauth(a,b).then(function(e){"system"!=e.state&&(1==e.pgsvdeal_type?(b.pgsubmit_type=3,h.ExecuteTask(b,"pg_ExecuteProgramStepAction").then(function(e){1==e.pgsvdeal_type?m(e,c,d):3==e.pgsvdeal_type&&(b.org_srv_name="pg_ExecuteProgramStepAction",j.pgremoteauth(a,b).then(function(a){a.success?(c.first_show_resetall=!1,c.steps[d].pgsubmit_type=2,c.steps[d].pg_work_seq=a.pg_work_seq,c.steps[d].stepFormLock=!0,c.steps[d].pgwork_status=1,c.steps[d].viewFlow=!0,c.auth_step_exsit=!0):c.steps[d].stepFormLock=!1,c.steps[d].pgsvdeal_type=a.pgsvdeal_type},function(a){j.alert(a.message)}))},function(a){j.alert(a.message)})):2==e.pgsvdeal_type&&n(e,b,c,d))},function(a){j.alert(a.message)})},o=function(a){var b=Math.ceil(a.total_count/10),d=4>b?b:4;if(a.page)a.page.numbers=b;else{a.page={numbers:b,current_page:0,show_page:[]};for(var e=0;d>e;e++)a.page.show_page.push({key:e+1,value:e})}c(function(){a.page_number_show=!0},1e3)},p=function(a){var b=a.sql_step_index,c=a.sql_index,d=10*a.sql_step.page.current_page,e={order_bk_title:a.sub_tab.basicData.order_bk_title,program_name:a.sub_tab.program_name,step_bk_title:a.sub_tab.steps[b].step_bk_title,order_seq:a.sub_tab.basicData.order_seq,deal_bk_seq:a.sub_tab.basicData.deal_bk_seq,step_seq:b+1,sql_list:a.sub_tab.steps[b].sql_list,pgsubmit_type:"",pg_work_seq:a.sub_tab.steps[b].pg_work_seq?a.sub_tab.steps[b].pg_work_seq:""};a.sql_step.page_data_loading=!0,g.execProgramStep(e,d,10).then(function(d){a.sql_step.page_data_loading=!1,a.sub_tab.steps[b].checkData.sql_result_list[c].content_list=d.sql_result_list[c].content_list?d.sql_result_list[c].content_list:[]},function(b){a.sql_step.page_data_loading=!1,j.alert(b.message)})},q=function(){if(-1==a.control.exist_index){var b=a.data.sub_tabs[a.data.sub_tabs.length-1],d=b.basicData.order_seq,e=b.basicData.deal_bk_seq;if(2!=b.basicData.flag)b.showParamList=!0;else{b.auth_step_exsit=!1;var h,i,l=!1;g.getProgramType(d,e).then(function(a){c(function(){a&&(a.pg_source||(b.showParamList=!0),1==a.pg_source?g.getExedProgramStep(d,e).then(function(a){b.showParamList=!1;var c=a.step_exe_list?a.step_exe_list:[];0!=c.length&&(b.exc_step_flag=!0),h=a.next_step,b.next_step_btn=a.next_step,1==h&&0==c.length?b.first_show_resetall=!1:b.first_show_resetall=!0,i=0==c.length?0:c[c.length-1].step_seq,b.next_step=a.next_step,b.program_seq=a.program_seq,b.program_name=a.program_name,f.getProgramInfoAndStepList(a.program_seq).then(function(a){if(a.program_step_list)for(var d=0;d<a.program_step_list.length;d++){for(var e={step_seq:a.program_step_list[d].step_seq,step_bk_title:a.program_step_list[d].step_bk_title,sql_list:[],pgsubmit_type:"",type:0,data:[],reset_show:!0,is_exception:!1,exception_reason:""},f=null,g=0,h=[],i=0;i<c.length;i++){var j=c[i];if(j.step_seq==e.step_seq){for(var m=j.program_sql_list?j.program_sql_list:[],n=j.sql_result_list?j.sql_result_list:[],o=0;o<m.length;o++){var p=m[o],q=n[o];1==p.sql_type&&(g+=q.total_count);for(var r=p.sql_param_list?p.sql_param_list:[],s=0;s<r.length;s++){var t=r[s];if(t.sparam_value_text="",1==t.sparam_type||5==t.sparam_type)t.sparam_value_text=t.sparam_value;else{var u=angular.fromJson(t.sparam_scope);if(3==t.sparam_type){var v=[],w=[];w=t.sparam_value.split(",");for(var x=0;x<w.length;x++)v.push(k.findValue(w[x],u));t.sparam_value_text=v.join(",")}(2==t.sparam_type||4==t.sparam_type)&&(t.sparam_value_text=k.findValue(t.sparam_value,u))}h.push({key:t.sparam_cn_name,value:t.sparam_value_text})}}f=j;break}}f&&(f.pg_work_seq?(l=!0,b.first_show_resetall=!1,b.auth_step_exsit=!0,e.pg_work_seq=f.pg_work_seq,e.viewFlow=!0,1==f.pgwork_status?(e.stepFormLock=!0,e.pgsubmit_type=2,e.pgwork_status=1):2==f.pgwork_status?(e.stepFormLock=!0,e.closeTask=!0,e.pgwork_status=2):3==f.pgwork_status&&(e.stepFormLock=!0,e.pgsubmit_type=2,e.pgwork_status=3),e.type=1):e.type=2,e.sql_list=f.program_sql_list,e.checkData={sql_basic_list:h,sql_result_list:[],isSuccess:f.success,fail_reason:f.fail_reason?c[d].fail_reason:"",total_count:g}),b.steps.push(e)}return b},function(a){j.alert(a.message)}).then(function(b){-1==h?b.finish_deal_order=!1:h==i?b.finish_deal_order=!0:(b.finish_deal_order=!1,!l&&b&&g.getStepByProgramStepId(a.program_seq,h).then(function(a){a.sql_list&&(b.steps[h-1].sql_list=a.sql_list?a.sql_list:[],b.steps[h-1].type=1,b.steps[h-1].stepFormLock=!1,b.steps[h-1].pgsubmit_type=1)},function(a){j.alert(a.message)}))})},function(a){j.alert(a.message)}):2==a.pg_source?(b.showParamList=!1,b.batchProgramBtn=!0,b.batch_program_fileupload={suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:""},g.getImportPath(b.wo_id,a.program_seq).then(function(a){a&&(b.batch_program_fileupload.uploadpath=a.pg_excel_path)},function(a){j.alert(a.message)}),b.program_seq=a.program_seq,b.program_name=a.program_name,g.getExecdMsg(d,a.program_seq,e).then(function(a){a&&(a.select_path?(b.auth_step_exsit=!1,b.exc_step_flag=!0,b.pg_source=3,b.control={show_result:!0,show_exec_btn:!1,is_task_author:!1},b.batch_program_fileupload.filename=a.file_path.substring(a.file_path.lastIndexOf("/")+1,a.file_path.length),b.program_file_full_path=a.file_path,b.select_path=a.select_path,b.finish_deal_order=!0):(b.pg_source=2,0!=a.task_sql_num&&6==a.workflow_state?(b.auth_step_exsit=!1,b.exc_step_flag=!0,b.program_result_msg={total_sql:a.task_sql_num,success_num:a.success_num,fail_num:a.fail_num,used_time:a.used_time,task_msg:a.task_msg?a.task_msg:[]},b.control={show_result:!0,show_exec_btn:!1,is_task_author:!1},b.batch_program_fileupload.filename=a.file_path.substring(a.file_path.lastIndexOf("/")+1,a.file_path.length),b.program_file_full_path=a.file_path,b.task_id=a.pend_work_seq,b.workflow_state=a.workflow_state,b.finish_deal_order=!0):a.workflow_state?(b.auth_step_exsit=!0,b.exc_step_flag=!0,b.control={show_result:!0,show_exec_btn:!1,is_task_author:!0},b.batch_program_fileupload.filename=a.file_path.substring(a.file_path.lastIndexOf("/")+1,a.file_path.length),b.program_file_full_path=a.file_path,b.task_id=a.pend_work_seq,b.workflow_state=a.workflow_state):0!=a.task_sql_num?(b.auth_step_exsit=!1,b.exc_step_flag=!0,b.program_result_msg={total_sql:a.task_sql_num,success_num:a.success_num,fail_num:a.fail_num,used_time:a.used_time,task_msg:a.task_msg?a.task_msg:[]},b.control={show_result:!0,show_exec_btn:!1,is_task_author:!1},b.batch_program_fileupload.filename=a.file_path.substring(a.file_path.lastIndexOf("/")+1,a.file_path.length),b.program_file_full_path=a.file_path,b.task_id=a.pend_work_seq,b.finish_deal_order=!0):(b.exc_step_flag=!1,b.control={show_result:!1,show_exec_btn:!0,is_task_author:!1})))},function(a){j.alert(a.message)})):3==a.pg_source&&(b.showParamList=!1,b.batchSelectProgramBtn=!0,b.program_seq=a.program_seq,b.program_name=a.program_name,b.select_program_form={},f.getSelectProgramAllInfo(a.program_seq,d,e).then(function(a){b.step_list=a.program_step_list?a.program_step_list:[],a.file_path?(b.control={show_result:!0,show_exec_btn:!1,exec_loading:!1,is_disable:!0},b.select_path=a.file_path,b.finish_deal_order=!0,b.auth_step_exsit=!1):a.workflow_state?(b.auth_step_exsit=!0,b.exc_step_flag=!0,b.control={show_result:!0,show_exec_btn:!1,exec_loading:!1,is_task_author:!0,is_disable:!0},b.task_id=a.pend_work_seq,b.workflow_state=a.workflow_state):(b.exc_step_flag=!1,b.control={show_result:!1,show_exec_btn:!0,is_task_author:!1}),a.exe_msg&&a.exe_msg.error_message&&(b.control={show_result:!0,show_exec_btn:!1,exec_loading:!1,is_disable:!0},b.exc_step_flag=!1,b.error_message=a.exe_msg.error_message,b.control.show_error_message=!0,b.finish_deal_order=!0,b.auth_step_exsit=!1)})))},0)},function(a){j.alert(a.message)})}}};a.switchPage=function(a,b){b.sql_step.page.show_page.length;switch(b.sql_step.page.current_page=a.value,a.key){case 1:a.value>0&&a.value<b.sql_step.page.numbers-1&&(b.sql_step.page.show_page=[{key:1,value:a.value-1},{key:2,value:a.value},{key:3,value:a.value+1},{key:4,value:a.value+2}]);break;case 4:a.value>2&&a.value<b.sql_step.page.numbers-1&&(b.sql_step.page.show_page=[{key:1,value:a.value-2},{key:2,value:a.value-1},{key:3,value:a.value},{key:4,value:a.value+1}])}p(b)},a.nextPage=function(a,b){b.sql_step.page.show_page.length;if(a){if(b.sql_step.page.current_page==b.sql_step.page.numbers-1)return void j.alert("已是最后一页");for(var c=(++b.sql_step.page.current_page,0);c<b.sql_step.page.show_page.length;c++){var d=b.sql_step.page.show_page[c];if(b.sql_step.page.current_page==d.value)return void p(b)}angular.forEach(b.sql_step.page.show_page,function(a,b,c){a.value++})}else{if(0==b.sql_step.page.current_page)return void j.alert("已是最前一页");for(var c=(--b.sql_step.page.current_page,0);c<b.sql_step.page.show_page.length;c++){var d=b.sql_step.page.show_page[c];if(b.sql_step.page.current_page==d.value)return void p(b)}angular.forEach(b.sql_step.page.show_page,function(a,b,c){a.value--})}p(b)},a.skipMostPage=function(a,b){if(a){var c=b.sql_step.page.numbers-1;b.sql_step.page.current_page=b.sql_step.page.numbers-1,b.sql_step.page.show_page=[{key:1,value:c-3},{key:2,value:c-2},{key:3,value:c-1},{key:4,value:c}]}else b.sql_step.page.current_page=0,b.sql_step.page.show_page=[{key:1,value:0},{key:2,value:1},{key:3,value:2},{key:4,value:3}];p(b)},a.downloadProgramFile=function(a){k.downloadFile(a.program_file_full_path)},a.downloadSelectExcel=function(a){k.downloadFile(a)},a.importProgramFileUploadSuccessThen=function(a){a.program_file_full_path=a.batch_program_fileupload.uploadpath+a.batch_program_fileupload.filename},a.stepTitleStyle=function(a,b){for(var c=$(b).eq(a);c.outerHeight()>40;)c.text(c.text().replace(/(\s)*([a-zA-Z0-9]+|\W)(\.\.\.)?$/,"..."))},a.clearStep=function(a,b){b?j.confirm("确认重选方案 ?").then(function(){l(a)}):l(a)},a.saveOneStep=function(b,c){a.pgauthflag.btn_loading=!0;for(var d=0;d<b.steps.length;d++)b.steps[d].reset_show=!0;var f={order_bk_title:b.basicData.order_bk_title,program_name:b.program_name,step_bk_title:b.steps[c].step_bk_title,order_seq:b.basicData.order_seq,deal_bk_seq:b.basicData.deal_bk_seq,step_seq:c+1,start_num:b.start_num?b.start_num:0,end_num:b.end_num?b.end_num:10,sql_list:b.steps[c].sql_list,pgsubmit_type:b.steps[c].pgsubmit_type?b.steps[c].pgsubmit_type:1,pg_work_seq:b.steps[c].pg_work_seq?b.steps[c].pg_work_seq:""};b.steps[c].closeTask?e.closePgWorkAction(b.steps[c].pg_work_seq).then(function(d){b.steps[c].closeTask=!1,a.resetOneStep(b.steps[c],b)},function(a){j.alert(a.message)}):g.execProgramStep(f,0,10).then(function(d){a.pgauthflag.btn_loading=!1,b.exc_step_flag=!0;var e=d?d:{};1==d.pgsvdeal_type?m(d,b,c):2==d.pgsvdeal_type?n(e,f,b,c):3==d.pgsvdeal_type?(f.pgsubmit_type=1,f.org_srv_name="pg_ExecuteProgramStepAction",j.pgremoteauth(e,f).then(function(a){if(a.success){if(b.first_show_resetall=!1,b.steps[c].pgsubmit_type=2,b.steps[c].stepFormLock=!0,b.steps[c].pg_work_seq=a.pg_work_seq,b.steps[c].pgwork_status=1,b.steps[c].viewFlow=!0,b.auth_step_exsit=!0,b.steps[c].checkData)for(var d=0;d<b.steps[c].checkData.sql_result_list.length;d++){var e=b.steps[c].checkData.sql_result_list[d];o(e)}}else b.steps[c].stepFormLock=!1},function(a){j.alert(a.message)})):(b.steps[c].pg_work_seq=d.pg_work_seq,b.steps[c].stepFormLock=!0)},function(d){b.steps[c].type=2,b.steps[c].is_exception=!0,a.pgauthflag.btn_loading=!1,b.steps[c].exception_reason=d.message})},a.resetOneStep=function(b,d){a.pgauthflag.btn_loading=!1,c(function(){b.pgsubmit_type=1,b.pgwork_status=0,b.viewFlow=!1;var a;1!=b.step_seq||2!=d.next_step_btn&&-1!=d.next_step_btn||(d.first_show_resetall=!1);for(var c=0;c<d.steps.length;c++)d.steps[c].reset_show=!1,2==d.steps[c].pgsubmit_type&&(d.steps[c].type=-1),d.next_step_btn==c+1&&(d.steps[c].type=-1),b.step_seq==d.steps[c].step_seq&&(a=c);g.resetProgramStep(d.wo_id,d.basicData.deal_bk_seq,a+1).then(function(a){b.checkData={sql_basic_list:[],sql_result_list:[]},b.type=1,d.finish_deal_order=!1,b.stepFormLock=!1},function(a){j.alert(a.message)})},10)},a.resetAllStep=function(a){g.resetAllExedStep(a.basicData.order_seq,a.basicData.deal_bk_seq,a.program_seq).then(function(b){a.basicData.deal_bk_seq=b.deal_bk_seq;for(var c=0;c<a.steps.length;c++)0==c?(a.steps[c].type=1,a.steps[c].checkData={},a.steps[c].pgsubmit_type=1,a.steps[c].pgwork_status=0,a.steps[c].stepFormLock=!1,a.steps[c].viewFlow=!1):(a.steps[c].type=0,a.steps[c].sql_list={},a.steps[c].viewFlow=!1,a.steps[c].checkData={});a.finish_deal_order=!1,a.first_show_resetall=!1},function(a){j.alert(a.message)})},a.startProgramExec=function(a){var b=a.basicData.order_seq,d=a.program_seq,e=a.batch_program_fileupload.filename,f=a.basicData.deal_bk_seq;a.control={show_result:!0,show_exec_btn:!1,exec_loading:!0},2==a.pg_source?g.startExecProgram(b,d,e,f).then(function(e){c(function(){e&&g.getExecdMsg(b,d,f).then(function(b){a.exc_step_flag=!0,a.auth_step_exsit=!1,a.program_result_msg={total_sql:b.task_sql_num,success_num:b.success_num,fail_num:b.fail_num,used_time:b.used_time,task_msg:b.task_msg?b.task_msg:[]},a.program_file_full_path=b.file_path,a.finish_deal_order=!0,a.control.exec_loading=!1},function(b){a.control.exec_loading=!1,j.alert(b.message)})},0)},function(b){a.auth_step_exsit=!0,a.exc_step_flag=!0,a.control.exec_loading=!1,b.task_id?(a.task_id=b.task_id,a.control.is_task_author=!0):(a.control.show_exec_btn=!0,a.control.show_result=!1,j.alert(b.message))}):g.startSelectProgram(b,d,e,f).then(function(e){c(function(){e&&g.getExecdMsg(b,d,f).then(function(b){a.exc_step_flag=!0,a.auth_step_exsit=!1,a.select_path=b.select_path,a.program_file_full_path=b.file_path,
a.finish_deal_order=!0,a.control.exec_loading=!1},function(b){a.control.exec_loading=!1,j.alert(b.message)})},0)},function(b){a.auth_step_exsit=!0,a.exc_step_flag=!0,a.control.exec_loading=!1,a.control.show_exec_btn=!0,a.control.show_result=!1,j.alert(b.message)})},a.startSelectProgramExec=function(a){var b=a.basicData.order_seq,d=a.program_seq,e=a.basicData.deal_bk_seq;return k.valiForm(a.select_program_form)?(a.control={show_result:!0,show_exec_btn:!1,exec_loading:!0,is_disable:!0},void g.startSelectExecProgram(b,d,e,a.step_list).then(function(b){c(function(){b&&(a.exc_step_flag=!0,a.auth_step_exsit=!1,a.select_path=b.file_path,b.exe_msg&&(a.error_message=b.exe_msg.error_message,a.control.show_error_message=!0),a.finish_deal_order=!0,a.control.exec_loading=!1)},0)},function(b){a.auth_step_exsit=!0,a.exc_step_flag=!0,a.control.exec_loading=!1,a.control.is_disable=!1,b.task_id?(a.task_id=b.task_id,a.control.is_task_author=!0):(a.control.show_result=!1,a.control.show_exec_btn=!0,j.alert(b.message))})):!1},a.startProgramAuthoExec=function(a){var b="pg_ExcuteBatchPgAction",d={submit_type:2,pend_work_seq:a.task_id,order_seq:a.basicData.order_seq,program_seq:a.program_seq,file_name:a.batch_program_fileupload.filename,deal_bk_seq:a.basicData.deal_bk_seq};a.control.exec_loading=!0,h.ExecuteTask(d,b).then(function(b){c(function(){b&&g.getExecdMsg(a.basicData.order_seq,a.program_seq,a.basicData.deal_bk_seq).then(function(b){a.program_result_msg={total_sql:b.task_sql_num,success_num:b.success_num,fail_num:b.fail_num,used_time:b.used_time,task_msg:b.task_msg?b.task_msg:[]},a.program_file_full_path=b.file_path,a.finish_deal_order=!0,a.control.exec_loading=!1,a.control.is_task_author=!1},function(b){a.control.exec_loading=!1,j.alert(b.message)})},0)},function(b){a.control.exec_loading=!1,j.alert(b.message)})},a.startSelectProgramAuthoExec=function(a){var b="pg_ExcuteSelpgAction",d={submit_type:2,pend_work_seq:a.task_id,order_seq:a.basicData.order_seq,program_seq:a.program_seq,deal_bk_seq:a.basicData.deal_bk_seq};a.control.exec_loading=!0,h.ExecuteTask(d,b).then(function(b){c(function(){b&&(a.exc_step_flag=!0,a.auth_step_exsit=!1,a.control.is_task_author=!1,a.select_path=b.file_path,b.exe_msg&&(a.error_message=b.exe_msg.error_message,a.control.show_error_message=!0),a.finish_deal_order=!0,a.control.exec_loading=!1)},0)},function(b){a.control.exec_loading=!1,j.alert(b.message)})},a.viewProgramTaskAuthorDetail=function(a){j.viewBatchImportAuthorDetail(a.task_id).then(function(b){b&&(a.workflow_state=b,a.control.finish_author=6==b?!0:!1)})},a.viewAuthProcess=function(b,c){a.pgauthflag.btn_loading=!1;var d=b.steps[c].pg_work_seq;e.getPgWorkDetail(d).then(function(d){b.steps[c].pgwork_status=d.pgwork_status,2==d.pgwork_status?(b.steps[c].stepFormLock=!0,b.steps[c].closeTask=!0):1==d.pgwork_status?b.steps[c].stepFormLock=!0:b.steps[c].stepFormLock=!1,d&&j.viewWorkOrderFlow(d).then(function(b){a.pgauthflag.btn_loading=!1},function(b){a.pgauthflag.btn_loading=!1,j.alert(b.message)})},function(a){j.alert(a.message)})},a.closeProgramBatchExeTask=function(a){var b={pend_wk_seq:a.task_id,workflow_state:7};h.CloseTask(b).then(function(b){a.control={show_result:!1,show_exec_btn:!0,exec_loading:!1,is_task_author:!1},a.workflow_state="",a.batch_program_fileupload={suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:""},g.getImportPath(a.basicData.order_seq,a.program_seq).then(function(b){b&&(a.batch_program_fileupload.uploadpath=b.pg_excel_path)},function(a){j.alert(a.message)})},function(a){j.alert(a.message)})},a.closeSelectProgramBatchExeTask=function(a){var b={pend_wk_seq:a.task_id,workflow_state:7};h.CloseTask(b).then(function(b){a.control={show_result:!1,show_exec_btn:!0,exec_loading:!1,is_task_author:!1},a.workflow_state=""},function(a){j.alert(a.message)})},q()}]),woCtrl.controller("woScriptHandleCtrl",["$scope","$timeout","$interval","$modal","Workorder","Program","WoFlowType","ProgramExec","SqlExec","BucketType","WoStatusType","CodeMirrorOption","Cmpt","CommData","Task","ScriptExec","CmptFunc","BusiSys","Modal","ProtocolType","IssuFunc","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=function(a){for(var b=0;b<a.soc_list.length;b++){var c=a.soc_list[b];c.protocol_type_cn=v.findValue(c.protocol_type,t),c.ftp_protocol_type&&(c.ftp_protocol_type_cn=v.findValue(c.ftp_protocol_type,t))}},x=function(a){p.viewHistoryList(a.basicData.order_seq,a.basicData.deal_bk_seq).then(function(c){a.script_info.execute_list=c.execute_info_list?c.execute_info_list:[],angular.forEach(a.script_info.execute_list,function(a){a.his_style_flag=!0,a.str_script=a.script_content?a.script_content.join(" "):""}),b(function(){$("#history-record-scroll").animate({scrollTop:"0"},500)},2e3)},function(a){s.alert(a.message)}),p.getScriptUploadPath(a.basicData.order_seq,a.basicData.deal_bk_seq).then(function(b){a.basicData.script_path=b.script_path,a.basicData.script_bk_seq=b.script_bk_seq,a.script_info.script_fileupload.uploadpath=b.script_path},function(a){s.alert(a.message)})},y=function(a){a.script_info.exe_timer=c(function(){p.viewStepDetail(a.basicData.order_seq,a.basicData.deal_bk_seq,a.basicData.script_bk_seq).then(function(d){b(function(){d&&(a.script_info.form_control.exec_result_list=d.exetend_bean.source_list?d.exetend_bean.source_list:[],a.script_info.stop_watch_flag&&(x(a),c.cancel(a.script_info.exe_timer)))},100)},function(b){c.cancel(a.script_info.exe_timer)})},3e3)},z=function(){if(-1==a.control.exist_index){var c=a.data.sub_tabs[a.data.sub_tabs.length-1],d=(c.basicData.handle_type?c.basicData.handle_type:_original_handle_type,c.basicData.order_seq),e=c.basicData.deal_bk_seq;a.toggle_show=!1,b(function(){c.script_info.script_form.impl_type=2},0),p.viewAuthStepDetail(d,e).then(function(a){a.pend_work_seq&&6!=a.workflow_state&&(c.control={is_task_author:!0,finish_author:!1},c.task_id=a.pend_work_seq,c.workflow_state=a.workflow_state?a.workflow_state:"",c.script_info.script_form.impl_type=a.exetend_bean.impl_type,c.script_info.script_form.script_source=a.exetend_bean.script_source,c.script_info.script_form.script_file_path=a.exetend_bean.scre_bk_path,c.script_info.script_form.soc_list=a.exetend_bean.source?a.exetend_bean.source:[],c.basicData.script_bk_seq=a.exetend_bean.script_bk_seq?c.basicData.script_bk_seq:"",c.script_info.script_form.exe_script=q.cmdsToString(a.exetend_bean.script_content),c.script_info.script_fileupload.filename=a.exetend_bean.scre_bk_path.slice(a.exetend_bean.scre_bk_path.lastIndexOf("/")+1),c.script_info.script_fileupload.uploadpath=a.exetend_bean.scre_bk_path.slice(0,a.exetend_bean.scre_bk_path.lastIndexOf("/")),w(c.script_info.script_form)),c.basicData.script_bk_seq||p.getScriptUploadPath(d,e).then(function(a){c.basicData.script_path=a.script_path,c.basicData.script_bk_seq=a.script_bk_seq,c.script_info.script_fileupload.uploadpath=a.script_path},function(a){s.alert(a.message)})},function(a){s.alert(a.message)}),p.viewHistoryList(d,e).then(function(b){c.script_info.execute_list=b.execute_info_list?b.execute_info_list:[];for(var d=0;d<c.script_info.execute_list.length;d++)c.script_info.execute_list[d].script_content&&(c.script_info.execute_list[d].str_script=c.script_info.execute_list[d].script_content.join(" ")),c.script_info.execute_list[d].his_style_flag=c.is_detail?!1:!0;c.is_detail&&c.script_info.execute_list.length>0&&a.rollbackScript(c,c.script_info.execute_list[0],0)},function(a){s.alert(a.message)})}};a.calculateMaxHeight=function(){var a=parseInt($(".orderTabs .tab-pane.active .left-content").css("height"))-25;return a=0>=a?309:a,{height:a+"px"}},a.select=function(){b(function(){a.calculateMaxHeight()},100)},a.selectScriptMethod=function(b,c){var d=c.script_info;d.script_fileupload.suffixs=2==b?"sh":"py",d.script_fileupload.filetype=2==b?"SHELL":"PYTHON",d.script_form.exe_script="",d.script_form.script_content=[],d.script_form.script_file_path="",d.form_control={exec_result_list:[],exec_result:"",executing:!1,cache_soc_list:[]},d.script_fileupload.filename="",a.form.script_handle_form.$setPristine(),d.script_form.impl_type=b},a.configExecuteDataSource=function(a){var b=2==a.impl_type&&1==a.script_source?1:2;s.configDataSource(a.impl_type,b,a.soc_list,1).then(function(b){a.soc_list=b?b:[],w(a)})},a.deleteSingleSoc=function(a,b){s.confirm("是否要删除此条数据源?").then(function(){b.splice(a,1)})},a.changeScriptSource=function(a,b){a.script_form.exe_script="",a.script_form.script_content=[],a.script_form.soc_list=[],a.form_control.exec_result_list=[],a.script_fileupload.filename=""},a.removeScriptFile=function(a){s.confirm("确认删除文件【"+a.script_fileupload.filename+"】吗？").then(function(b){b&&(a.rollback_flag?(a.script_fileupload.filename="",a.script_form.script_file_path="",a.script_form.exe_script=""):p.deleteFile(a.script_form.script_file_path).then(function(b){a.script_fileupload.filename="",a.script_form.script_file_path="",a.script_form.exe_script=""},function(a){s.alert(a.message)}),a.form_control.exec_result_list=[])})},a.downloadScriptFile=function(a){v.downloadFile(a.script_form.script_file_path)},a.uploadScriptFileSuccessThen=function(a){a.rollback_flag=!1,a.script_form.script_file_path=a.script_fileupload.uploadpath+a.script_fileupload.filename,p.parseScriptFile(a.script_form.script_file_path).then(function(c){b(function(){c&&(a.script_form.exe_script=q.cmdsToString(c.script_content),a.script_form.script_content=c.script_content?c.script_content:[])},0)},function(a){s.alert(a.message)})},a.viewExeInfo=function(a,b,c){s.viewScriptDetail(a,b,c).then()},a.rollbackScript=function(a,b,c){if(a.script_info.form_control.is_rollback=!0,a.script_info.form_control.exec_result_list=[],a.script_info.form_control.no_sys_soc_show=!1,a.script_info.script_form.soc_list=[],p.viewStepDetail(b.order_seq,b.deal_bk_seq,b.script_bk_seq).then(function(b){a.script_info.form_control.is_rollback=!1,a.script_info.rollback_flag=!0,a.script_info.script_form=b.exetend_bean,a.script_info.script_form.script_file_path=b.exetend_bean.scre_bk_path?b.exetend_bean.scre_bk_path:"",a.script_info.script_fileupload.filename=a.script_info.script_form.script_file_path.slice(a.script_info.script_form.script_file_path.lastIndexOf("/")+1),a.script_info.script_fileupload.filetype=2==b.exetend_bean.impl_type?"SHELL":"PYTHON",a.script_info.script_fileupload.suffixs=2==b.exetend_bean.impl_type?"sh":"py",b.exetend_bean.script_content&&(a.script_info.script_form.exe_script=q.cmdsToString(b.exetend_bean.script_content)),a.script_info.script_form.soc_list=!a.is_detail&&c?[]:b.exetend_bean.source_list,a.script_info.form_control.exec_result_list=a.is_detail&&b.exetend_bean.source_list?b.exetend_bean.source_list:[],a.script_info.form_control.cache_soc_list=b.exetend_bean.source_list?b.exetend_bean.source_list:[],w(a.script_info.script_form),a.script_info.language_name=b.exetend_bean.language_name?b.exetend_bean.language_name:"",a.script_info.language_version=b.exetend_bean.language_version?b.exetend_bean.language_version:"",a.script_info.operating_system=b.exetend_bean.operating_system?b.exetend_bean.operating_system:"",a.script_info.bit_number=b.exetend_bean.bit_number?b.exetend_bean.bit_number:""},function(a){s.alert(a.message)}),p.getScriptUploadPath(b.order_seq,b.deal_bk_seq).then(function(b){a.basicData.script_path=b.script_path,a.basicData.script_bk_seq=b.script_bk_seq,a.script_info.script_fileupload.uploadpath=b.script_path},function(a){s.alert(a.message)}),1==b.script_source&&a.script_info.script_fileupload.filename&&(a.script_info.script_form.script_file_path="",a.script_info.script_fileupload.filename=""),a.is_detail){if(b.his_style_flag)return;angular.forEach(a.script_info.execute_list,function(a){a.his_style_flag=!1}),b.his_style_flag=!0}},a.submitScriptHandle=function(c,d){if(c.control={is_task_author:!1,finish_author:!1},!v.valiForm(a.form.script_handle_form))return!1;if(0==d.script_form.soc_list.length)return d.form_control.no_sys_soc_show=!0,!1;if(2==d.script_form.script_source&&!d.script_fileupload.filename)return s.alert("请上传脚本文件"),!1;d.form_control.executing=!0,d.stop_watch_flag=!1,b(function(){y(c)},0),d.script_form.order_seq=c.basicData.order_seq,d.script_form.script_bk_seq=c.basicData.script_bk_seq,d.script_form.deal_bk_seq=c.basicData.deal_bk_seq,d.script_form.source=d.script_form.soc_list,d.script_form.script_content=q.stringToCmds(d.script_form.exe_script),d.form_control.exec_result_list=[];for(var e={deal_bk_seq:d.script_form.deal_bk_seq,order_seq:d.script_form.order_seq,script_bk_seq:d.script_form.script_bk_seq,impl_type:d.script_form.impl_type,script_source:d.script_form.script_source,script_file_path:d.script_form.script_file_path,script_content:d.script_form.script_content,source:[],script_text:d.script_form.exe_script},f=0;f<d.script_form.soc_list.length;f++){var g=d.script_form.soc_list[f];e.source.push({soc_ip:g.soc_ip,soc_name:g.soc_name,ftp_soc_name:g.ftp_soc_name})}p.execute(e).then(function(a){a&&(d.stop_watch_flag=!0,d.form_control.has_exec_flag=!0,d.form_control.executing=!1)},function(a){a.task_id?(c.task_id=a.task_id,c.control.is_task_author=!0):s.alert(a.message),d.stop_watch_flag=!0,c.workflow_state="",c.script_info.form_control.executing=!1})},a.execScriptBatchExeTask=function(a){var c="sc_ExecuteScriptAction";a.script_info.form_control.executing=!0,a.script_info.stop_watch_flag=!1,b(function(){y(a)},0),a.script_info.script_form.order_seq=a.basicData.order_seq,a.script_info.script_form.script_bk_seq=a.basicData.script_bk_seq,a.script_info.script_form.deal_bk_seq=a.basicData.deal_bk_seq,a.script_info.script_form.source=a.script_info.script_form.soc_list,a.script_info.script_form.script_content=q.stringToCmds(a.script_info.script_form.exe_script);for(var d={submit_type:2,pend_work_seq:a.task_id,deal_bk_seq:a.script_info.script_form.deal_bk_seq,order_seq:a.script_info.script_form.order_seq,script_bk_seq:a.script_info.script_form.script_bk_seq,impl_type:a.script_info.script_form.impl_type,script_source:a.script_info.script_form.script_source,script_file_path:a.script_info.script_form.script_file_path,script_content:a.script_info.script_form.script_content,source:[]},e=0;e<a.script_info.script_form.soc_list.length;e++){var f=a.script_info.script_form.soc_list[e];d.source.push({soc_ip:f.soc_ip,soc_name:f.soc_name,ftp_soc_name:f.ftp_soc_name})}o.ExecuteTask(d,c).then(function(c){b(function(){c&&(a.script_info.stop_watch_flag=!0,a.control.is_task_author=!1,a.control.finish_author=!0,a.script_info.form_control.has_exec_flag=!0,a.script_info.form_control.executing=!1)},0)},function(b){a.script_info.stop_watch_flag=!0,a.script_info.form_control.executing=!1,s.alert(b.message)})},a.stopScriptExecute=function(a){var b=a.basicData.order_seq,c=a.basicData.deal_bk_seq,d=a.basicData.script_bk_seq;p.stopScriptExec(b,c,d).then(function(a){},function(a){s.alert(a.message)})},a.resetScriptHandle=function(b,c){c.form_control.no_sys_soc_show=!1;var d=angular.copy(c.script_form.impl_type);c.script_form={soc_list:[],script_source:1,exe_script:"",script_content:[],script_file_path:""},c.form_control={exec_result_list:[],exec_result:"",executing:!1,cache_soc_list:[]},c.script_fileupload.filename="",a.form.script_handle_form.$setPristine(),c.script_form.impl_type=d,c.form_control.exec_result_list=[];({pend_wk_seq:b.task_id,workflow_state:7});console.log(b.basicData.order_seq),p.getScriptUploadPath(b.basicData.order_seq,b.basicData.deal_bk_seq).then(function(a){b.basicData.script_path=a.script_path,b.basicData.script_bk_seq=a.script_bk_seq,b.script_info.script_fileupload.uploadpath=a.script_path},function(a){s.alert(a.message)})},a.deleteExecResult=function(a){a.script_info.form_control.exec_result_list=[]},z()}]),woCtrl.controller("woExportDataCtrl",["$scope","$timeout","$interval","$modal","Workorder","Program","WoFlowType","ProgramExec","SqlExec","BucketType","WoStatusType","CodeMirrorOption","Cmpt","CommData","Task","ScriptExec","CmptFunc","BusiSys","IssuFunc","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){a.addHandleSQL=function(a){s.addSqlText(a)},a.deleteSqlStep=function(a,b,c,d){s.deleteHandleSqlText(d,a,c,b)},a.viewSqlStepDetailModal=function(a){t.viewSqlDetailStep(a).then(function(){})},a.submitSqlStep=function(a,b,c,d,e){var f=[],g="";t.confirmSqlStatement(a,g).then(function(){c.sql_steps[b].submit_sql_btn_loading=!0,f.push({sql_work_seq:c.sql_steps[b].sql_work_seq,sql_text:c.sql_steps[b].sql_text,order_seq:c.basicData.order_seq,deal_bk_seq:c.basicData.deal_bk_seq}),i.exportQueryData(f,c.sql_steps[b].sql_text,c.sql_steps[b].sensite_list).then(function(a){if(a.query_msg){var d=a.query_msg;s.getSqlMsgList(d,c.sql_steps),c.sql_steps[b].submit_sql_btn_loading=!1,c.show_all_submit_btn=!1,s.quitHandleBtnControl(c),s.finishHandleBtnControl(c)}a.download_path_list&&(c.sql_steps[b].download_bk_path=a.download_path_list[0])},function(a){c.sql_steps[b].submit_sql_btn_loading=!1,a.task_id?(c.sql_steps[b].pend_work_seq=a.task_id,c.sql_steps[b].is_single_task_author=!0,s.quitHandleBtnControl(c)):t.alert(a.message)})})},a.dataExportAuthor=function(a,c,d){var e="sl_ExportSelectDataAction",f=[],g={};d.sql_steps[c].is_close_loading=!0,f.push({sql_work_seq:d.sql_steps[c].sql_work_seq,sql_text:d.sql_steps[c].sql_text}),g={submit_type:2,pend_work_seq:a.pend_work_seq,query_sql_list:[],sql_text:d.sql_steps[c].sql_text,sensite_list:d.sql_steps[c].sensite_list},d.sql_steps[c].submit_sql_btn_loading=!0,o.ExecuteTask(g,e).then(function(a){b(function(){if(a){d.sql_steps[c].is_close_loading=!1,d.sql_steps[c].is_single_task_author=!1;for(var b=a.query_msg?a.query_msg:[],e=0;e<a.query_msg.length;e++)a.query_msg[e].theads&&(a.query_msg[e].theads=s.setPrimaryKeySort(a.query_msg[e].theads));s.createPageNumberByData(d.sql_steps[c],b),s.getSqlMsgList(b,d.sql_steps),d.sql_steps[c].submit_sql_btn_loading=!1,s.quitHandleBtnControl(d),s.finishHandleBtnControl(d),a.download_path_list&&(d.sql_steps[c].download_bk_path=a.download_path_list[0])}},0)},function(a){d.sql_steps[c].submit_sql_btn_loading=!1,d.sql_steps[c].is_close_loading=!1,t.alert(a.message)})},a.loadData=function(a){u.downloadFile(a)}}]),woCtrl.controller("woAllListCtrl",["$scope","Workorder","BusiSys","WoStatusType","WorkorderType","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h){a.data={senior_header_list:[]},a.info={nomarlKeyWord:"",hightSearchObj:{key_word:"",crt_user_id:"",deal_user_id:"",crt_start_date:"",crt_end_date:"",deal_start_date:"",deal_end_date:"",workorder_type:[],workorder_status:[],system_list:[],create_user_list:[],handler_user_list:[]}},a.control={searchSeniorFlag:!1,systemFlag:!1,crt_opened:!1},a.config={datepicker:{maxDate:new Date},scroll_config:f.Y()};var i=function(){for(var f=0;f<e.length;f++)a.info.hightSearchObj.workorder_type.push({key:e[f].key,value:e[f].value,flag:!1});for(var f=0;f<d.length;f++)a.info.hightSearchObj.workorder_status.push({key:d[f].key,value:d[f].value,flag:!1});c.getAllBusinessSys().then(function(b){if(b.list_bs){for(var c=0;c<b.list_bs.length;c++)a.info.hightSearchObj.system_list.push({value:b.list_bs[c],flag:!1});a.info.hightSearchObj.system_list.length>3&&(a.control.systemFlag=!1),a.info.hightSearchObj.system_list.length>0&&a.info.hightSearchObj.system_list.length<=3&&(a.control.systemFlag=!0)}},function(a){g.alert(a.message)}),b.getAllCreaterList().then(function(b){b&&(a.data.create_user_list=b.user_list)},function(a){g.alert(a.message)}),b.getAllHandlerList().then(function(b){b&&(a.data.handler_user_list=b.user_list)},function(a){g.alert(a.message)})};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.control.crt_opened=!0},a.dealOpen=function(b){b.preventDefault(),b.stopPropagation(),a.control.deal_opened=!0},a.$watch("info.hightSearchObj",function(b,c){a.data.senior_header_list=[],a.info.hightSearchObj.key_word&&a.data.senior_header_list.push({key:1,value:"关键字："+a.info.hightSearchObj.key_word});for(var d=0;d<a.info.hightSearchObj.system_list.length;d++)a.info.hightSearchObj.system_list[d].flag&&a.data.senior_header_list.push({key:2,value:a.info.hightSearchObj.system_list[d].value.business_cn_name});for(var d=0;d<a.info.hightSearchObj.workorder_type.length;d++)a.info.hightSearchObj.workorder_type[d].flag&&a.data.senior_header_list.push({key:3,value:a.info.hightSearchObj.workorder_type[d].value});for(var d=0;d<a.info.hightSearchObj.workorder_status.length;d++)a.info.hightSearchObj.workorder_status[d].flag&&a.data.senior_header_list.push({key:4,value:a.info.hightSearchObj.workorder_status[d].value});if(a.info.hightSearchObj.crt_user_id)for(var d=0;d<a.data.create_user_list.length;d++)a.info.hightSearchObj.crt_user_id==a.data.create_user_list[d].user_id&&a.data.senior_header_list.push({key:5,value:"创建人："+a.data.create_user_list[d].user_cn_name});if(a.info.hightSearchObj.deal_user_id)for(var d=0;d<a.data.handler_user_list.length;d++)a.info.hightSearchObj.deal_user_id==a.data.handler_user_list[d].user_id&&a.data.senior_header_list.push({key:6,value:"处理人："+a.data.handler_user_list[d].user_cn_name});if(a.info.hightSearchObj.crt_start_date)if(a.info.hightSearchObj.crt_end_date){if(a.info.hightSearchObj.crt_end_date.getTime()<a.info.hightSearchObj.crt_start_date.getTime())return g.alert("创建日期不合法"),a.info.hightSearchObj.crt_start_date="",a.info.hightSearchObj.crt_end_date="",!1;a.data.senior_header_list.push({key:7,value:"创建日期："+h.dtFormat(a.info.hightSearchObj.crt_start_date,"-")+"/"+h.dtFormat(a.info.hightSearchObj.crt_end_date,"-")})}else a.data.senior_header_list.push({key:7,value:"创建时间："+h.dtFormat(a.info.hightSearchObj.crt_start_date,"-")+"/至今"});else a.info.hightSearchObj.crt_end_date&&a.data.senior_header_list.push({key:7,value:"创建日期：从前至"+h.dtFormat(a.info.hightSearchObj.crt_end_date,"-")});if(a.info.hightSearchObj.deal_start_date)if(a.info.hightSearchObj.deal_end_date){if(a.info.hightSearchObj.deal_end_date.getTime()<a.info.hightSearchObj.deal_start_date.getTime())return g.alert("结束日期不合法"),a.info.hightSearchObj.crt_start_date="",a.info.hightSearchObj.crt_end_date="",!1;a.data.senior_header_list.push({key:8,value:"处理日期："+h.dtFormat(a.info.hightSearchObj.deal_start_date,"-")+"/"+h.dtFormat(a.info.hightSearchObj.deal_end_date,"-")})}else a.data.senior_header_list.push({key:8,value:"处理日期："+h.dtFormat(a.info.hightSearchObj.deal_start_date,"-")+"/至今"});else a.info.hightSearchObj.deal_end_date&&a.data.senior_header_list.push({key:8,value:"处理日期：从前至"+h.dtFormat(a.info.hightSearchObj.deal_end_date,"-")})},!0),i()}]),woCtrl.controller("woDetailCtrl",["$scope","$timeout","$state","$stateParams","$location","BucketType","ProgramExec","Program","WoStatusType","SqlExec","Workorder","WoFlowType","ScriptExec","BusiSys","CodeMirrorOption","Modal","ProtocolType","IssuFunc","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=d.wo_seq;a.sub_tab={wo_id:t,show_all_detail:!1,showParamList:!0,steps:[],flowData:[],is_detail:!0,script_info:{view_options:o.Sh(!0),view_python_options:o.Python(!0),data:{impl_type_list:[{key:2,value:"shell"},{key:7,value:"python2"},{key:8,value:"python3"}]},script_form:{soc_list:[],script_source:1,exe_script:"",script_content:[],script_file_path:"",impl_type:2},form_control:{exec_result_list:[],cache_soc_list:[],exec_result:""},script_fileupload:{filename:""}},sql_steps:[]},a.control={wo_detail_flag:!0};var u=function(a){for(var b="",c=0;c<a.length-1;c++)b+=a[c]+"\n";return b+=a[a.length-1]},v=function(c,d,e){m.viewStepDetail(c,d,e).then(function(c){b(function(){if(c){a.sub_tab.script_info.script_form=c.exetend_bean,a.sub_tab.script_info.script_form.exe_script=c.exetend_bean.script_content?u(c.exetend_bean.script_content):"",a.sub_tab.script_info.form_control.exec_result_list=c.exetend_bean.source_list?c.exetend_bean.source_list:[];for(var d=0;d<a.sub_tab.script_info.form_control.exec_result_list.length;d++){var e=a.sub_tab.script_info.form_control.exec_result_list[d];e.protocol_type_cn=s.findValue(e.protocol_type,q),e.ftp_protocol_type&&(e.ftp_protocol_type_cn=s.findValue(e.ftp_protocol_type,q))}a.sub_tab.script_info.script_form.soc_list=a.sub_tab.script_info.form_control.exec_result_list,a.sub_tab.script_info.script_fileupload.filetype=2==c.exetend_bean.impl_type?"SHELL":"PYTHON",a.sub_tab.script_info.script_form.script_file_path=c.exetend_bean.scre_bk_path?c.exetend_bean.scre_bk_path:"",a.sub_tab.script_info.script_fileupload.filename=a.sub_tab.script_info.script_form.script_file_path.slice(a.sub_tab.script_info.script_form.script_file_path.lastIndexOf("/")+1),b(function(){angular.forEach(a.sub_tab.script_info.form_control.exec_result_list,function(a,b){a.show_expand_btn=!1;var c=$("#exec-result-"+b);c.width()>299&&(a.show_expand_btn=!0)})},500)}},0)},function(a){})},w=function(){k.getWorkorder(t).then(function(c){if(c.woorderbean){a.sub_tab.basicData=c.woorderbean?c.woorderbean:{};var d=a.sub_tab.basicData.handle_type,e=a.sub_tab.basicData.order_seq,f=a.sub_tab.basicData.deal_bk_seq;a.sub_tab.handle_type=d?d:"",a.sub_tab.sqlexe_type=a.sub_tab.basicData.sqlexe_type,a.sub_tab.basicData.order_cn_state=s.findValue(a.sub_tab.basicData.order_state,i),(1==d||4==d)&&(1==a.sub_tab.basicData.sqlexe_type||4==d?j.submitedSqlList(e,f).then(function(b){var c=b.sql_msg_list?b.sql_msg_list:[];a.sub_tab.sql_steps=c,r.sqlBucketTranslateCnType(c)},function(a){p.alert(a.message)}):j.submitedImportSqlList(e,f).then(function(b){a.sub_tab.sql_steps=b.batch_sql_list?b.batch_sql_list:[],angular.forEach(a.sub_tab.sql_steps,function(b){b.act_exec_time=b.act_exec_time?r.sqlExeTimeUsedFmt(b.act_exec_time):0,b.import_file_info=b,b.act_exec_time&&(b.exe_result_info=b),b.exe_success=b.act_exec_time?!0:!1,b.is_exe_detail=!0,b.parse_success=!0,b.parse_loading=!1,b.pend_work_seq&&(b.is_task_author=!0,b.sql_state=1),b.fileupload={suffixs:"sql",filetype:"SQL",filename:b.sql_bk_path?b.sql_bk_path.substring(b.sql_bk_path.lastIndexOf("/")+1,b.sql_bk_path.length):"",uploadpath:a.sub_tab.sql_import_path},b.sql_info={script_file_path:a.sub_tab.sql_import_path+b.fileupload.filename,sys_name:b.sys_name,soc_name:b.soc_name,sql_soc_list:[]}})},function(a){p.alert(a.message)})),2==d&&(a.sub_tab.showParamList=!1,g.getProgramType(e,f).then(function(c){b(function(){if(c)if(1==c.pg_source){var b,d;g.getExedProgramStep(e,f).then(function(c){a.sub_tab.showParamList=!1;var e=c.step_exe_list?c.step_exe_list:[];0!=e.length&&(a.sub_tab.exc_step_flag=!0),b=c.next_step,a.sub_tab.next_step_btn=c.next_step,1==b&&0==e.length?a.sub_tab.first_show_resetall=!1:a.sub_tab.first_show_resetall=!0,d=0==e.length?0:e[e.length-1].step_seq,a.sub_tab.next_step=c.next_step,a.sub_tab.program_seq=c.program_seq,a.sub_tab.program_name=c.program_name,h.getProgramInfoAndStepList(c.program_seq).then(function(b){if(b.program_step_list)for(var c=0;c<b.program_step_list.length;c++){for(var d={step_seq:b.program_step_list[c].step_seq,step_bk_title:b.program_step_list[c].step_bk_title,sql_list:[],pgsubmit_type:"",type:0,data:[],reset_show:!0,is_exception:!1,exception_reason:""},f=null,g=0,h=[],i=0;i<e.length;i++){var j=e[i];if(j.step_seq==d.step_seq){for(var k=j.program_sql_list?j.program_sql_list:[],l=j.sql_result_list?j.sql_result_list:[],m=0;m<k.length;m++){var n=k[m],o=l[m];1==n.sql_type&&(g+=o.total_count);for(var p=n.sql_param_list?n.sql_param_list:[],q=0;q<p.length;q++){var r=p[q];if(r.sparam_value_text="",1==r.sparam_type||5==r.sparam_type)r.sparam_value_text=r.sparam_value;else{var t=angular.fromJson(r.sparam_scope);if(3==r.sparam_type){var u=[],v=[];v=r.sparam_value.split(",");for(var w=0;w<v.length;w++)u.push(s.findValue(v[w],t));r.sparam_value_text=u.join(",")}(2==r.sparam_type||4==r.sparam_type)&&(r.sparam_value_text=s.findValue(r.sparam_value,t))}h.push({key:r.sparam_cn_name,value:r.sparam_value_text})}}f=j;break}}f&&(f.pg_work_seq?(a.sub_tab.first_show_resetall=!1,a.sub_tab.auth_step_exsit=!0,d.pg_work_seq=f.pg_work_seq,d.viewFlow=!0,1==f.pgwork_status?(d.stepFormLock=!0,d.pgsubmit_type=2,d.pgwork_status=1):2==f.pgwork_status?(d.stepFormLock=!0,d.closeTask=!0,d.pgwork_status=2):3==f.pgwork_status&&(d.stepFormLock=!0,d.pgsubmit_type=2,d.pgwork_status=3),d.type=1):d.type=2,d.sql_list=f.program_sql_list,d.checkData={sql_basic_list:h,sql_result_list:[],isSuccess:f.success,fail_reason:f.fail_reason?e[c].fail_reason:"",total_count:g}),a.sub_tab.steps.push(d)}return a.sub_tab},function(a){p.alert(a.message)})},function(a){p.alert(a.message)})}else 2==c.pg_source?(a.sub_tab.batchProgramBtn=!0,a.sub_tab.showParamList=!0,a.sub_tab.pg_source=2,a.sub_tab.batch_program_fileupload={suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:""},a.sub_tab.program_seq=c.program_seq,a.sub_tab.program_name=c.program_name,g.getExecdMsg(e,c.program_seq,f).then(function(b){b&&(0!=b.task_sql_num&&6==b.workflow_state?(a.sub_tab.program_result_msg={total_sql:b.task_sql_num,success_num:b.success_num,fail_num:b.fail_num,used_time:b.used_time,task_msg:b.task_msg?b.task_msg:[]},a.sub_tab.control={is_disable:!0,show_result:!0,show_exec_btn:!1,is_task_author:!1},a.sub_tab.batch_program_fileupload.filename=b.file_path.substring(b.file_path.lastIndexOf("/")+1,b.file_path.length),a.sub_tab.program_file_full_path=b.file_path,a.sub_tab.task_id=b.pend_work_seq,a.sub_tab.workflow_state=b.workflow_state):b.workflow_state?(a.sub_tab.control={is_disable:!0,show_result:!0,show_exec_btn:!1,is_task_author:!0},a.sub_tab.batch_program_fileupload.filename=b.file_path.substring(b.file_path.lastIndexOf("/")+1,b.file_path.length),a.sub_tab.program_file_full_path=b.file_path,a.sub_tab.task_id=b.pend_work_seq,a.sub_tab.workflow_state=b.workflow_state):a.sub_tab.control={is_disable:!0,show_result:!1,show_exec_btn:!0,is_task_author:!1})},function(a){p.alert(a.message)})):(a.sub_tab.showParamList=!0,a.sub_tab.batchProgramBtn=!1,a.sub_tab.batchSelectProgramBtn=!0,a.sub_tab.program_seq=c.program_seq,a.sub_tab.program_name=c.program_name,h.getSelectProgramAllInfo(c.program_seq,e,f).then(function(b){a.sub_tab.step_list=b.program_step_list?b.program_step_list:[],b.file_path?(a.sub_tab.control={show_result:!0,show_exec_btn:!1,is_disable:!0},a.sub_tab.select_path=b.file_path):b.workflow_state?(a.sub_tab.control={is_disable:!0,show_result:!0,show_exec_btn:!1,is_task_author:!0},a.sub_tab.task_id=b.pend_work_seq,a.sub_tab.workflow_state=b.workflow_state):a.sub_tab.control={show_result:!1,show_exec_btn:!0,is_task_author:!1},b.exe_msg&&b.exe_msg.error_message&&(a.sub_tab.control={show_result:!0,show_exec_btn:!1,exec_loading:!1,is_disable:!0},a.sub_tab.error_message=b.exe_msg.error_message,a.sub_tab.control.show_error_message=!0),a.sub_tab.is_detail=!0}))},0)},function(a){p.alert(a.message)})),3==d&&(a.sub_tab.showParamList=!1,m.viewHistoryList(e,f).then(function(c){a.sub_tab.script_info.execute_list=[],a.sub_tab.script_info.execute_list=c.execute_info_list?c.execute_info_list:[];for(var d,e=0;e<a.sub_tab.script_info.execute_list.length;e++)a.sub_tab.script_info.execute_list[e].str_script=a.sub_tab.script_info.execute_list[e].script_content?a.sub_tab.script_info.execute_list[e].script_content.join(" "):"",a.sub_tab.script_info.execute_list[e].his_style_flag=!1;a.sub_tab.script_info.execute_list.length>0&&(d=a.sub_tab.script_info.execute_list[0],a.sub_tab.script_info.execute_list[0].his_style_flag=!0,b(function(){v(d.order_seq,d.deal_bk_seq,d.script_bk_seq)},500))},function(a){p.alert(a.message)}))}},function(a){p.alert(a.message)}),k.getWorkorderFlowList(t).then(function(b){a.sub_tab.flowData=b.order_flow_list?b.order_flow_list:{};for(var c=0;c<a.sub_tab.flowData.length;c++)a.sub_tab.flowData[c].deal_bk_date&&(a.sub_tab.flowData[c].deal_time=a.sub_tab.flowData[c].deal_bk_date+" "+a.sub_tab.flowData[c].deal_bk_time.substring(0,a.sub_tab.flowData[c].deal_bk_time.length-3)),a.sub_tab.flowData[c].flow_type=s.findValue(a.sub_tab.flowData[c].flow_type,l)},function(a){p.alert(a.message)})};a.downloadProgramFile=function(a){s.downloadFile(a.program_file_full_path)},a.viewProgramTaskAuthorDetail=function(a){p.viewBatchImportAuthorDetail(a.task_id).then()},a.viewAuthProcess=function(a,b){var c=a.steps[b].pg_work_seq;k.getPgWorkDetail(c).then(function(a){
a&&p.viewWorkOrderFlow(a).then(function(a){},function(a){p.alert(a.message)})},function(a){p.alert(a.message)})},a.stepTitleStyle=function(a,b){for(var c=$(b).eq(a);c.outerHeight()>40;)c.text(c.text().replace(/(\s)*([a-zA-Z0-9]+|\W)(\.\.\.)?$/,"..."))},a.lineStyle=function(a){return{width:"2px",height:"100%",position:"absolute","background-color":2==a.type?"#3D9ED8":"rgb(224, 224, 224)",left:"-32px",top:"20px"}},a.smallCircle=function(a){return{width:"16px",height:"16px",position:"relative",top:"-18px",left:"2px","background-color":a.type>0?"#3D9ED8":"#ccc","border-radius":"8px"}},a.borderStyle=function(a){return{border:a.type>0?"1px solid #ccc":"",padding:"10px 20px",position:"relative"}},a.viewSqlStepDetailModal=function(a){p.viewSqlDetailStep(a).then(function(){})},a.viewTaskAuthorDetail=function(a,b){var c=b?b.pend_work_seq:a.task_id;p.viewBatchImportAuthorDetail(c).then()},a.downloadImportFile=function(a){s.downloadFile(a.sql_info.script_file_path)},a.downloadDetailFile=function(a){a&&s.downloadFile(a)},a.viewExeDetail=function(a,b){var c=1==b?a.import_file_info.parse_message:a.exe_result_info.message;p.viewBatchSqlExecDetail(c).then()},a.loadData=function(a){s.downloadFile(a)},a.calculateMaxHeight=function(){var a=parseInt($(".left-content").css("height"))-25;return a=0>=a?309:a,{height:a+"px"}},a.viewExeInfo=function(a,b,c){p.viewScriptDetail(a,b,c).then()},a.downloadScriptFile=function(a){s.downloadFile(a.script_form.script_file_path)},a.backToWoList=function(){c.go("wo_all_list")},w()}]);var inspectionCtrl=angular.module("InspectionController",["highcharts-ng"]);inspectionCtrl.controller("logPickCtrl",["$scope","$timeout","CodeMirrorOption","NodeReform","LogXJ","Dispatch","Modal","BusiSys","CV",function(a,b,c,d,e,f,g,h,i){var j=0,k=new Date;a.info={datepicker:{},max_date:k,log_pick_info:{sys_name:"",log_name:"",node_names:[],log_id:"",begin_date:"",end_date:""}},a.control={save_base_info:!1,save_loading:!1,log_batch_loading:!1,choose_all_log:!1,check_one_log:!1,loading_file:!1,loading_node:!1},a.data={sys_list:[],log_file_list:[],node_ip_list:[],pick_log_list:[],node_msg_list:[]};var l=function(){var b=[];return angular.forEach(a.data.node_ip_list,function(a){a.checked&&b.push(a.node_name)}),b},m=function(b){var c=[],d=[];if(angular.forEach(a.data.log_file_list,function(a){a.checked=!1}),b.checked=!0,b.logSyncInfos)for(var e=0;e<b.logSyncInfos.length;e++){var f=b.logSyncInfos[e];c.push(f.node_name)}if(b.log_configs)for(var g=0;g<b.log_configs.length;g++){var h=b.log_configs[g];c.push(h.node_name)}if(d=n(c),a.data.node_msg_list.length>0)for(var i=0;i<d.length;i++)for(var j=d[i],k=0;k<a.data.node_msg_list.length;k++){var l=a.data.node_msg_list[k];j==l.node_name&&a.data.node_ip_list.push(l)}},n=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=!1,f=0;f<b.length;f++){var g=b[f];if(d==g){e=!0;break}}e||b.push(d)}return b},o=function(){angular.forEach(a.data.pick_log_list,function(a){0==parseInt(a.file_length)?a.size_str="0M":parseInt(a.file_length)<1024?a.size_str=a.file_length+"b":parseInt(a.file_length)>1024&&(parseInt(a.file_length)<1048576?a.size_str=Math.floor(parseInt(a.file_length)/1024)+"kb":a.size_str=Math.floor(parseInt(a.file_length)/1048576)+"M")})},p=function(){h.getAllLogBysiness().then(function(c){b(function(){a.data.sys_list=c.list_bs||[]},0)},function(a){g.alert(a.message)})};a.openDate=function(b){b.preventDefault(),b.stopPropagation(),a.info.datepicker.opened=!0},a.getFileListBysys=function(c){a.info.log_pick_info.sys_name=c,a.data.log_file_list=[],a.data.node_ip_list=[],a.data.pick_log_list=[],a.control.choose_all_log=!1,a.info.log_pick_info.log_name="",a.control.loading_file=!0,h.getAllLogList(c,j).then(function(c){b(function(){a.data.log_file_list=c.logBeanList?c.logBeanList:[],a.control.loading_file=!1},0)},function(b){g.alert(b.message),a.control.loading_file=!1})},a.chooseIp=function(a){a.checked=!a.checked},a.chooseLogFile=function(c){return a.info.log_pick_info.sys_name?(a.control.loading_node=!0,a.data.pick_log_list=[],void d.getNodeByBusi(a.info.log_pick_info.sys_name).then(function(d){b(function(){a.data.node_msg_list=d.node_msg_list||[],a.data.node_ip_list=[],a.control.loading_node=!1,a.control.save_base_info=!1,a.info.log_pick_info.log_name=c.log_name,a.info.log_pick_info.log_id=c.log_id,m(c)},0)},function(b){g.alert(b.message),a.control.loading_node=!1})):!1},a.chooseAllLog=function(b){angular.forEach(a.data.pick_log_list,function(a){a.choose_log=b}),a.data.pick_log_list.length>0&&(a.control.check_one_log=b)},a.choosePickedLog=function(b){var c=!0,d=!1;angular.forEach(a.data.pick_log_list,function(a){a.choose_log?d=!0:c=!1}),a.control.choose_all_log=c,a.control.check_one_log=d},a.batchDownloadLog=function(){if(!i.valiForm(a.log_pick_form))return!1;if(a.data.pick_log_list.length>0){for(var c=!1,d=0;d<a.data.pick_log_list.length;d++){var f=a.data.pick_log_list[d];if(f.choose_log){c=!0;break}}if(!c)return g.alert("请选择日志"),!1}g.confirm("是否批量下载").then(function(c){if(c){var d=[];angular.forEach(a.data.pick_log_list,function(a){a.choose_log&&d.push(a)}),a.control.log_batch_loading=!0,e.combinePickLog(d).then(function(c){b(function(){i.downloadFile(c.download_url),a.control.log_batch_loading=!1},3e3)},function(b){a.control.log_batch_loading=!1,g.alert(b.message)})}})},a.formSubmit=function(){return i.valiForm(a.log_pick_form)?(a.info.log_pick_info.node_names=l(),a.info.log_pick_info.begin_date=i.dtFormat(a.info.log_pick_info.begin_date),a.info.log_pick_info.end_date=i.dtFormat(a.info.log_pick_info.end_date),a.info.log_pick_info.begin_date>a.info.log_pick_info.end_date?(g.alert("开始时间大于结束时间，请重新选择"),!1):a.info.log_pick_info.log_name?(a.info.log_pick_info.business_sys_name=a.info.log_pick_info.sys_name,a.control.save_loading=!0,void e.savePickTogetFileList(a.info.log_pick_info).then(function(c){b(function(){a.control.choose_all_log=!1,a.control.save_base_info=!0,a.control.totalItems=c.all_recd,a.data.pick_log_list=c.logSyncInfoList||[],a.control.save_loading=!1,o()},0)},function(b){g.alert(b.message),a.control.save_loading=!1})):(g.alert("请选择日志文件"),!1)):!1},a.downLoadLog=function(a){var b=a.download_url;g.confirm("确认下载?").then(function(a){a&&i.downloadFile(b)})},p()}]),inspectionCtrl.controller("logAnalysisCtrl",["$scope","$cookieStore","$state","$window","$location","$interval","$timeout","CodeMirrorOption","LogXJ","Dispatch","Modal","BusiSys","NodeReform","CmptFunc","ScrollBarConfig","Charts","newLogTimeStampType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=0,t=[],u=500,v="",w=0,x={start_hour:"00",start_minutes:"00",end_hour:"23",end_minutes:"59",keywords:"",key_line:""},y=$(".line-num-container"),z=[],A=0;a.info={log_analysis_info:{sys_name:"",startDate:"",endDate:"",start_hour:"0",start_minutes:"0",end_hour:"23",end_minutes:"59",log_name:"",node_names:[],is_regular:!1,offset:1,size:500,page_size:500,search_key_word:"",keywords:"",keyword:"",context_line:1,is_regular_exps:[],choose_ip_list:[],log_detail:[],file_index:-1,timestamp_exp:"",result_state:"",show_result:!1,error_message:"",screen_info:angular.copy(x)},page_info:{total_page:0,page:{}}},a.control={show_hide_view:!0,time_input_err_msg:"",result_dynamic:"",file_loading:!1,page_show:!1,is_pie:!0,no_move:!1,show_keyword_chart:!1,log_search_result_loading:!1},a.config={scroll_y_config:o.Y(),scroll_xy_config:o.XY()},a.scollbar_callbacks={setLeft:0,setTop:0,whileScrolling:function(){A=Math.abs(this.mcs.top),A&&y.css({marginTop:-A,height:y.height()+A})}},a.data={node_ip_list:[],search_key_list:[],wordCountBeanList:[],log_tab_list:[],log_tab_show_list:[],ip_file_list:[],log_time_stamp_type:q};var B=function(a){var c={tem_file:a.tem_file,log_condition:a},d=-1;if(a.tem_file){for(var e=0;e<z.length;e++){var f=z[e];if(f.tem_file==c.tem_file){d=e;break}}d>-1&&z.splice(d,1),z.push(c),b.put("log_list",z)}},C=function(){a.info.page_info={},a.info.log_analysis_info.log_detail=[]},D=function(a,b,c){a.total_line=c,b.total_line=c},E=function(b,c,d,e,f){if(c.checked=!1,d>-1)if(a.data.log_tab_list[d].modify_option){for(var g=0;g<e.length;g++)g==d?e[g].checked=!0:e[g].checked=!1;a.changeContentBylog(b,a.data.log_tab_list[d],d)}else for(var h=0;h<e.length;h++)e[h].checked=!1;else for(var i=0;i<a.data.ip_file_list[f].tem_files.length;i++){var j=a.data.ip_file_list[f].tem_files[i];j.checked=!1}},F=function(b,c,d){b.log_search_result_loading=!0,b.result_dynamic=0,b.log_search_result_error="",b.error_message="",b.error_mesag="",b.timer=f(function(){b.result_dynamic<90&&(b.result_dynamic=b.result_dynamic+10)},1200),a.info.log_analysis_info.error_message="",a.data.ip_file_list[c].tem_files[d].log_search_result_error=!1,a.data.ip_file_list[c].tem_files[d].log_search_result_loading=!0,a.data.ip_file_list[c].tem_files[d].error_message="",a.data.ip_file_list[c].tem_files[d].error_mesag=""},G=function(b,c,d,e){a.control.no_move=!1,a.info.log_analysis_info.show_result=!0,a.data.log_tab_list[d].error_mesag=e.message,a.info.log_analysis_info.error_message=e.message,a.data.ip_file_list[c].tem_files[d].error_mesag=e.message,b.log_search_result_loading=!1,b.log_search_result_error=!0,K(),f.cancel(b.timer)},H=function(a){if(!a)return!1;for(var b=$(".log-data-row"),c=0;c<b.length;c++){var d=$(b[c]).children(":last"),e=new RegExp(a,"g"),f=d.text().replace(e,function(a){return'<strong  id="keyword-'+c+'" class="log-keyword-high-light keyword-mark">'+a+"</strong>"});d.html(f)}},I=function(b){g(function(){a.scrollToView(b)},50)},J=function(){A=0,y.css({marginTop:0,height:"auto"})},K=function(){a.info.log_analysis_info.log_detail=[],a.data.search_key_list=[]},L=function(a,b){for(var c=b.length,d=[];c--;)d.push(a[b[c]]);return d.join("|")},M=function(a,b){for(var c=[],d={},e=0,f=a.length;f>e;e++){var g=L(a[e],b);g in d||(d[g]=!0,c.push(a[e]))}return c},N=function(b){for(var c=!1,d=0;d<a.data.log_time_stamp_type.length;d++){var e=a.data.log_time_stamp_type[d],f=e.value.substring(0,e.value.indexOf("("));if(b==f){c=!0;break}}return c},O=function(a){for(var b=$(".keyword-mark"),c=a.split("|"),d=[],e=0;e<c.length;e++)for(var f=0;f<b.length;f++){var g=$(b[f]),h=new RegExp(c[e],"g");if(h.test(g.text())){var i=$(g).parent().siblings(".inner-row-num").text(),j=$(g).parent().siblings(".inner-row-num").attr("dataid"),k={line_count:i,key_word:c[e],index_count:j,checked:!1};d.push(k)}}return M(d,["line_count","key_word"])},P=function(b,c){var d=5>c?c:5;a.info.log_analysis_info.offset>c&&(a.info.log_analysis_info.offset=1),b.page={numbers:c,current_page:a.info.log_analysis_info.offset?a.info.log_analysis_info.offset:1,show_page:[]};for(var e=1;d>=e;e++)b.page.show_page.push({key:e,value:e});g(function(){b.page_number_show=!0},1e3)},Q=function(b,c,d){d=parseInt(d);var e=4>c-d?c-d:4;a.info.log_analysis_info.offset>c&&(a.info.log_analysis_info.offset=1),b.page={numbers:c,current_page:d?d:1,show_page:[]};for(var f=d;d+e>=f;f++)b.page.show_page.push({key:f,value:f});var h=b.page.show_page.length,i=5-h;if(d-h>=-2)for(var j=0,k=d;d+i>k;k++)j+=1,d-j>0&&b.page.show_page.unshift({key:d-j,value:d-j});g(function(){b.page_number_show=!0},1e3)},R=function(b){if(a.info.log_analysis_info.offset=b.page.current_page,K(),a.info.log_analysis_info.log_name){a.control.file_loading=!0;var c=Z(),d=a.data.log_tab_list[a.info.log_analysis_info.file_index];g(function(){aa(c,d,1,1,"")},1500)}},S=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d[b]=c}},T=function(a){var b="";return 0==a.length?b="":1==a.length?b="0"+a:2==a.length&&(b=a),b},U=function(){var b=-1!=a.info.log_analysis_info.file_index?a.info.log_analysis_info.file_index:0,c=-1!=a.info.log_analysis_info.node_index?a.info.log_analysis_info.node_index:0,d={};if(a.data.log_tab_list.length>0){var e=a.data.ip_file_list[c].tem_files[b],f=":";f=":"==e.start_time.charAt(2)?":":"-",d={start_hour:e.start_time.split(f)[0]?e.start_time.split(f)[0]:"00",start_minutes:e.start_time.split(f)[1]?e.start_time.split(f)[1]:"00",end_hour:e.end_time.split(f)[0]?e.end_time.split(f)[0]:"23",end_minutes:e.end_time.split(f)[1]?e.end_time.split(f)[1]:"59",keywords:e.keywords?e.keywords:"",key_line:e.context_line?e.context_line:""}}else d=x;return d},V=function(b){var c=-1!=a.info.log_analysis_info.file_index?a.info.log_analysis_info.file_index:0,d=-1!=a.info.log_analysis_info.node_index?a.info.log_analysis_info.node_index:0;if(a.data.log_tab_list.length>0){var e=a.data.ip_file_list[d].tem_files[c];if(a.data.ip_file_list[d].tem_files.length>0)for(var f=0;f<a.data.ip_file_list[d].tem_files.length;f++)a.data.ip_file_list[d].tem_files[f].checked=!1;e.start_time=b.start_time?b.start_time:"",e.end_time=b.end_time?b.end_time:"",e.keywords=b.keywords?b.keywords:"",e.context_line=b.context_line?b.context_line:0,e.checked=!0,e.modify_option=!0}if(a.data.log_tab_list.length>0){for(var g=0;g<a.data.log_tab_list.length;g++)a.data.log_tab_list[g].checked=!1;a.data.log_tab_list[c].checked=!0}},W=function(b,c){for(var d=a.data.ip_file_list[b],e=0;e<d.tem_files.length;e++){var f=d.tem_files[e];c.tem_file==f.tem_file?f.checked=!0:d.tem_files[e].checked=!1}},X=function(b,c,d,e,h){a.control.no_move=!0;var j=angular.copy(a.info.log_analysis_info.node_index),l=angular.copy(a.info.log_analysis_info.file_index),m=angular.copy(a.data.ip_file_list[j]),n=angular.copy(a.data.ip_file_list[j].tem_files[l]);n.node_name=m.node_name,n.sys_name=a.info.log_analysis_info.sys_name,n.node_ip=m.soc_ip,n.lines=n.context_line,n.timestamp.charAt(11)&&("-"==n.timestamp.charAt(11)?(n.start_time=n.start_time.replace(/:/g,"-"),n.end_time=n.end_time.replace(/:/g,"-"),n.finish_time="23-59-59"):n.finish_time="23:59:59");for(var o=a.data.log_tab_list[a.info.log_analysis_info.file_index],p=0;p<a.data.log_tab_list.length;p++)a.data.log_tab_list[p].log_search_result_loading=!1;F(o,j,l),g(function(){a.info.log_analysis_info.offset=1,n.offset=1,n.size=a.info.log_analysis_info.page_size,n.log_name=n.file,i.getAnalysisByNodeFiles(n).then(function(m){a.control.no_move=!1,n.local_path=m.local_path,n.remote_path=m.remote_path,n.server_flag=1;var p=m.result.msg?m.result.msg:"",q=p.indexOf("exist")>=0,r=p.indexOf("G")>=0;o.result_dynamic=100,o.log_search_result_loading=!1,e[l].log_search_result_loading=!1,o.log_search_result_error=!1,q?(a.control.file_loading=!0,K(),aa(n,c,2,2,e)):r?k.confirm("["+m.result.msg+"]是否下载文件？").then(function(){F(o,j,l),a.control.no_move=!0,i.OnlineScreen(n).then(function(b){if(o.result_dynamic=100,g(function(){o.log_search_result_loading=!1,e[l].log_search_result_loading=!1},1e3),2!=b.log_status)a.info.log_analysis_info.result_state=b.log_status,o.log_search_result_error=!1,a.control.file_loading=!0,aa(n,c,2,2,e);else{B(n);var d={message:b.log_message?b.log_message:"下载失败"};G(o,j,l,d)}},function(b){a.control.no_move=!1,G(o,j,l,b)})},function(a){E(b,c,d,e,h),c.modify_option=!1,e[l].modify_option=!1,e[l].log_search_result_loading=!1}):(F(o,j,l),a.control.no_move=!0,i.OnlineScreen(n).then(function(b){if(o.result_dynamic=100,g(function(){o.log_search_result_loading=!1,e[l].log_search_result_loading=!1},1e3),2!=b.log_status)a.info.log_analysis_info.result_state=b.log_status,o.log_search_result_error=!1,a.control.file_loading=!0,K(),aa(n,c,2,2,e);else{var d={message:b.log_message?b.log_message:"下载失败"};G(o,j,l,d)}},function(b){a.control.no_move=!1,G(o,j,l,b)})),f.cancel(o.timer)},function(a){B(n),G(o,j,l,a)})},1e3)},Y=function(a){for(var b=[],c={start_hour:"00",start_minutes:"00",end_hour:"23",end_minutes:"59",keywords:"",key_line:0},d=T(c.start_hour)+":"+T(c.start_minutes)+":00",e=T(c.end_hour)+":"+T(c.end_minutes)+":59",f=0;f<a.length;f++){var g={node_name:"",tem_files:[],node_index:0,soc_ip:""},h=a[f];g.node_name=h.node_name,g.soc_ip=h.soc_ip;for(var i=0;i<h.checked_files.length;i++){var j=h.checked_files[i],k=j.path+"/"+j.file,l="";l=N(j.date_format_show)?j.date_format:j.date_format_show;var m={tem_file:j.file||"",encoding:j.word_coding||"",file:k||"",lines:c.key_line,key_word:c.keywords,start_time:d,timestamp:l?l:"",end_time:e,result_dynamic:0,log_search_result_loading:!1};g.tem_files.push(m)}b.push(g)}return S(t,"node_index"),b},Z=function(){var b=angular.copy(a.info.log_analysis_info),c=-1!=a.info.log_analysis_info.file_index?a.info.log_analysis_info.file_index:0,d=-1!=a.info.log_analysis_info.node_index?a.info.log_analysis_info.node_index:0,e=a.data.ip_file_list[d].tem_files[c];return e.timestamp.charAt(11)&&"-"==e.timestamp.charAt(11)&&(e.start_time=e.start_time.replace(/:/g,"-"),e.end_time=e.end_time.replace(/:/g,"-")),b.start_time=e.start_time||"",b.end_time=e.end_time||"",b.keywords=e.keywords||"",b.context_line=e.context_line||0,b.node_name=a.data.ip_file_list[d].node_name,b.log_name=e.file,b.size=a.info.log_analysis_info.page_size,b},_=function(b){if(a.info.log_analysis_info.log_name="",a.info.log_analysis_info.search_key_word="",a.info.log_analysis_info.show_result=!1,a.info.log_analysis_info.log_name="",a.info.log_analysis_info.choose_ip_list=b.choose_ip_list||[],a.info.log_analysis_info.sys_name=b.sys_name,a.info.log_analysis_info.choose_ip_list.length>0){a.info.log_analysis_info.soc_ip=b.choose_ip_list[0].soc_ip,a.selectLogIp(a.info.log_analysis_info.soc_ip);var c="";if(a.info.log_analysis_info.choose_ip_list[0].checked_files.length>0){var d=a.info.log_analysis_info.choose_ip_list[0].checked_files[0];c=N(d.date_format_show)?d.date_format:d.date_format_show}a.info.log_analysis_info.timestamp_exp=c}},aa=function(b,c,d,e,f){a.control.file_loading=!0,B(b),i.getLogBypage(b).then(function(g){if(a.control.file_loading=!1,a.data.search_key_list=[],a.control.no_move=!1,a.control.page_show=!0,a.info.log_analysis_info.search_key_word="",a.info.log_analysis_info.error_message="",1==d){if(g){a.info.log_analysis_info.log_detail=g.beanList||[];var h=Math.ceil(parseInt(c.total_line)/parseInt(a.info.log_analysis_info.page_size));a.data.total_line=c.total_line,a.info.page_info.total_page=h,2==e&&P(a.info.page_info,h)}}else if(2==d){var i=angular.copy(a.info.log_analysis_info.file_index),j=a.data.log_tab_list[a.info.log_analysis_info.file_index];if(g&&a.info.log_analysis_info.log_name==b.file){K(),a.info.log_analysis_info.show_result=!0,a.info.log_analysis_info.log_detail=g.beanList||[],a.data.total_line=parseInt(g.page_numeber),D(f[i],j,g.page_numeber);var k=Math.ceil(parseInt(g.page_numeber)/parseInt(a.info.log_analysis_info.page_size));a.info.page_info.total_page=k,P(a.info.page_info,k),a.control.page_show=!0}}g.beanList&&(a.scollbar_callbacks.setLeft=0,a.scollbar_callbacks.setTop=0,J())},function(b){a.control.no_move=!1,a.control.file_loading=!1,K()})},ba=function(){i.deleteLogAnalysisFile().then(function(a){},function(a){}),l.getAllBusinessSys().then(function(b){g(function(){a.data.busys_list=b.list_bs?b.list_bs:[],b.list_bs&&angular.forEach(a.data.busys_list,function(a){a.checked=!1})},0)},function(a){}),a.changeHeight(1),a.changeHeight(2)};a.selectLog=function(){k.configLogBase(a.info.log_analysis_info.sys_name,a.info.log_analysis_info.choose_ip_list).then(function(b){b&&(C(),a.data.ip_file_list=Y(b.choose_ip_list),K(),_(b))})},a.showScreenModal=function(b,c,d){b.stopPropagation();var e=a.info.log_analysis_info.file_index;if(a.control.no_move)return!1;a.info.log_analysis_info.show_result=!1,angular.forEach(a.data.log_tab_list,function(a){a.checked=!1}),d.checked=!0,a.info.log_analysis_info.error_message=d.error_mesag||"",a.info.log_analysis_info.file_index=c,a.info.log_analysis_info.log_name=d.file;for(var f=angular.copy(a.info.log_analysis_info.node_index),g=angular.copy(a.info.log_analysis_info.file_index),h=a.data.ip_file_list[f].tem_files,i=0;i<h.length;i++)i==g?h[i].checked=!0:h[i].checked=!1;v!=d.file&&K(),v=d.file,a.info.log_analysis_info.screen_info=U(),k.configScreenBase(a.info.log_analysis_info.screen_info).then(function(c){if(c){a.control.no_move=!1,v=d.file,a.info.log_analysis_info.log_name=d.file,a.info.log_analysis_info.screen_info=c,x=c;var g=T(c.start_hour)+":"+T(c.start_minutes)+":00",i=T(c.end_hour)+":"+T(c.end_minutes)+":59";a.info.log_analysis_info.start_time=g,a.info.log_analysis_info.end_time=i,a.info.log_analysis_info.keywords=c.keywords?c.keywords:"",a.info.log_analysis_info.context_line=c.key_line?c.key_line:0,V(a.info.log_analysis_info),d.modify_option=!0,a.data.log_tab_list.length>0&&X(b,d,e,h,f)}},function(c){a.control.no_move=!1,E(b,d,e,h,f)})},a.changeScreenLogPrev=function(a){return 4>=a-w?!1:(w++,void $("#log_tab").animate({"margin-left":-(100*w)+"px"}))},a.changeScreenLogNext=function(a){return 0==w?!1:(w--,void $("#log_tab").animate({"margin-left":-(100*w)+"px"}))},a.changeContentBylog=function(b,c,d){if(a.control.no_move)return!1;if(angular.forEach(a.data.log_tab_list,function(a){a.checked=!1,a.log_search_result_loading=!1}),c.checked=!0,c.modify_option){if(a.info.log_analysis_info.file_index=d,a.info.log_analysis_info.log_name=c.file,c.result_dynamic>0&&c.result_dynamic<100&&(c.log_search_result_loading=!0),W(a.info.log_analysis_info.node_index,c),v==c.file)return!1;a.info.log_analysis_info.offset=1,K(),s=0,a.control.file_loading=!0,a.control.no_move=!0;var e=Z();v=c.file,a.info.log_analysis_info.result_state&&!c.error_mesag?(a.control.page_show=!1,aa(e,c,1,2,"")):(a.control.no_move=!1,a.control.error_loading=!0,g(function(){a.info.log_analysis_info.error_message=a.data.log_tab_list[d].error_mesag,a.control.error_loading=!1},1e3),a.control.file_loading=!1)}else a.showScreenModal(b,d,c)},a.anotherPageLog=function(a,b){for(var c=!1,f=0;f<z.length;f++){var g=z[f];if(g.tem_file==a.tem_file){c=!0;break}}if(!c)return k.alert("请先下载日志"),!1;var h=e.absUrl().substring(e.absUrl().indexOf("?")+1),i=h.substring(0,h.indexOf("#"));d.open("views/inspection/log/log_monitor.html?userName="+i+"&log_name="+a.tem_file+"=true","_blank","height=700, width=900, toolbar=no, menubar=no, scrollbars=yes, resizable=no, location=no, status=no")},a.selectLogIp=function(b){a.control.page_show=!1,a.info.log_analysis_info.error_message="",a.info.log_analysis_info.show_result=!1,a.data.log_tab_list=[],a.data.log_tab_show_list=[],C(),K();for(var c,d,e,f=!1,h=0;h<a.data.ip_file_list.length;h++){var i=a.data.ip_file_list[h];if(i.soc_ip==b){c=i,a.info.log_analysis_info.node_index=h;break}}a.data.log_tab_list=angular.copy(c.tem_files)||[];for(var j=0;j<a.data.log_tab_list.length;j++){var k=a.data.log_tab_list[j];k.log_search_result_loading=!1,k.checked&&k.modify_option&&(f=!0,k.log_search_result_loading=!1,e=k.error_mesag||"",a.info.log_analysis_info.file_index=j,v=k.file,d=k)}e&&(a.info.log_analysis_info.error_message=e),g(function(){if(a.info.log_analysis_info.log_name&&f&&!e){a.control.file_loading=!0,a.info.log_analysis_info.offset=1;var b=Z();g(function(){K(),aa(b,d,1,2,"")},1500)}},200)},a.toggleKeywordTable=function(){a.control.show_hide_view=!a.control.show_hide_view},a.clearKeyword=function(){a.info.log_analysis_info.search_key_word=""},a.changeSinglePageKeywordContent=function(b,c){if(2==c){if(!b)return a.info.log_analysis_info.page_size=u,b=u,!1;if(isNaN(b))return k.alert("输入不合法"),a.info.log_analysis_info.page_size=u,b=u,!1;if(0==parseInt(b))return k.alert("每页显示至少为1行"),a.info.log_analysis_info.page_size=u,b=u,!1;if(b>1e3)return k.alert("每页最多1000行"),a.info.log_analysis_info.page_size=u,b=u,!1;if(u==b)return!1;u=b}a.info.log_analysis_info.size=b;var d=!1;if(a.data.log_tab_list.length>0&&(d=a.data.log_tab_list[a.info.log_analysis_info.file_index].modify_option),a.info.log_analysis_info.log_name&&d){a.control.file_loading=!0,a.control.page_show=!1,a.info.log_analysis_info.offset=1;var e=Z();K(),g(function(){var b=a.data.log_tab_list[a.info.log_analysis_info.file_index];aa(e,b,1,2,"")},1500)}},a.generateReportChart=function(){if(!r.valiForm(a.log_analysis_form))return!1;if(!a.info.log_analysis_info.result_state)return k.alert("请完善条件信息"),!1;if(!a.info.log_analysis_info.search_key_word)return k.alert("请完善关键字信息"),!1;var b,d={};if(a.data.ip_file_list.length>0){var e=-1!=a.info.log_analysis_info.file_index?a.info.log_analysis_info.file_index:0,f=-1!=a.info.log_analysis_info.node_index?a.info.log_analysis_info.node_index:0,g=a.data.ip_file_list[f].tem_files[e],h=a.data.ip_file_list[f].node_name,i=g.start_time,j=g.end_time,l=g.keywords,m=g.context_line,n=g.file;b=i.indexOf(":")>0?h.replace(/\./g,"")+i.replace(new RegExp(/(:)/g),"")+j.replace(new RegExp(/(:)/g),"")+l+m+n:h.replace(/\./g,"")+i.replace(new RegExp(/(-)/g),"")+j.replace(new RegExp(/(-)/g),"")+l+m+n,d={log_name:n,encoding:"",node_file:b||"",timestamps:g.timestamp,keywords:a.info.log_analysis_info.search_key_word,is_regular_exp:a.info.log_analysis_info.is_regular}}return d.node_file?(a.control.show_keyword_chart=!0,void c.go("inspection_log_analysis.keyword_chart",{keyword_info:d})):(k.alert("请完善日志选择信息"),!1)},a.switchPageToPageNum=function(a,b){switch(b.page.current_page=a.value,a.key){case 1:a.value>0&&a.value<b.page.numbers-1&&(b.page.show_page=[{key:1,value:a.value},{key:2,value:a.value+1},{key:3,value:a.value+2},{key:4,value:a.value+3}]);break;case 4:a.value>2&&a.value<b.page.numbers-1&&(b.page.show_page=[{key:1,value:a.value-2},{key:2,value:a.value-1},{key:3,value:a.value},{key:4,value:a.value+1}])}R(b)},a.nextPage=function(a,b){if(a){if(b.page.current_page==b.page.numbers)return void k.alert("已是最后一页");for(var c=0;c<b.page.show_page.length;c++){var d=b.page.show_page[c];if(b.page.current_page==d.value)return void R(b)}angular.forEach(b.page.show_page,function(a,b,c){a.value++})}else{if(1==b.page.current_page)return void k.alert("已是最前一页");for(var c=0;c<b.page.show_page.length;c++){var d=b.page.show_page[c];if(b.page.current_page==d.value)return void R(b)}angular.forEach(b.page.show_page,function(a,b,c){a.value--})}R(b)},a.searchByKeyword=function(b){if(!b)return!1;for(var c=$(".log-data-row"),d=0;d<c.length;d++){var e=$(c[d]).children(":last"),f=new RegExp(b,"g"),h=e.text().replace(f,function(a){return'<strong id="keyword-'+d+'" class="log-keyword-high-light keyword-mark">'+a+"</strong>"});e.html(h)}g(function(){a.data.search_key_list=[],a.data.search_key_list=O(b),0===a.data.search_key_list.length&&k.alert("暂无搜索数据")},300)},a.firstHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;if(a.data.search_key_list.length>0){var b=a.data.search_key_list[0];a.scrollByLineCount(b.key_word,b.line_count,b.index_count,b,0)}},a.preHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;var b=a.data.search_key_list.length;if(b>0)if(0==s)a.firstHighLight(a.info.log_analysis_info.search_key_word);else{var c=parseInt(s)-1,d=a.data.search_key_list[c];d&&a.scrollByLineCount(d.key_word,d.line_count,d.index_count,d,c)}},a.nextHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;var b=a.data.search_key_list.length;if(b>0)if(s==b);else{var c=parseInt(s)+1,d=a.data.search_key_list[c];d&&a.scrollByLineCount(d.key_word,d.line_count,d.index_count,d,c)}},a.lastHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;if(a.data.search_key_list.length>0){var b=a.data.search_key_list.length-1,c=a.data.search_key_list[b];a.scrollByLineCount(c.key_word,c.line_count,c.index_count,c,b)}},a.scrollByLineCount=function(b,c,d,e,f){var g=0;s=f,angular.forEach(a.data.search_key_list,function(a){a.checked=!1}),e.checked=!0,H(a.info.log_analysis_info.search_key_word);for(var h=$(".log-data-row").eq(d).children("span").eq(1).children(".log-keyword-high-light"),i=0;i<h.length;i++){var j=h[i];j.textContent===b&&(g++,1===g&&I($(j)),$(j).removeClass("log-keyword-high-light").addClass("log-keyword-high-light-checked"))}},a.changeHeight=function(a){var b,c={},d=$(window).height();return 1==a?(b=d-255,b>463?c.height=b+7:c.height=464):2==a&&(c.height=d-255-18),c},a.deleteDownLoadProcess=function(a){a.log_search_result_loading=!1,a.timer&&f.cancel(a.timer)},a.changeCurPage=function(b,c,d){if(d>a.info.page_info.total_page)return k.alert("输入页数不允许超过总页数"),!1;if(0==d)return k.alert("输入页数不可以为0"),!1;if(a.info.log_analysis_info.size=b,a.info.log_analysis_info.log_name){a.control.file_loading=!0,a.control.page_show=!1;var e=Z();K(),a.control.file_loading=!0,g(function(){i.getLogBypage(e).then(function(b){if(a.control.file_loading=!1,a.info.log_analysis_info.search_key_word="",b){a.info.log_analysis_info.show_result=!0,a.info.log_analysis_info.log_detail=b.beanList||[];var c=Math.ceil(parseInt(a.data.total_line)/parseInt(a.info.log_analysis_info.page_size));a.info.page_info.total_page=c,Q(a.info.page_info,c,d),a.control.page_show=!0,g(function(){a.searchByKeyword(a.info.log_analysis_info.search_key_word)},500)}},function(b){a.control.file_loading=!1,K()})},1e3)}},ba()}]),inspectionCtrl.controller("logAnalysisKeywordChartCtrl",["$scope","$state","$stateParams","LogXJ","Charts","Modal","CV",function(a,b,c,d,e,f,g){var h=c.keyword_info;a.control={genetate_pie:!1},a.data={keyword_report_list:[]};var i=function(a){var b={title:0==a.time_interval_type?"关键字出现次数":"关键字走势",subtitle:0==a.time_interval_type?a.start_date:a.start_date+"至"+a.end_date,chart_type:a.time_interval_type,yAxis_name:"出现次数",xAxis_type:"5",columns:[{name:"关键字",data:a.count_by_units}],units:a.units};return e.getLogColumnConfig(b,260)},j=function(b){a.control.genetate_pie=!0;for(var c=[],d=0,f=[],g=0;g<b.keywords.length;g++){var h={key_word:b.keywords[g],error_count:"",scale:""};c.push(h)}if(b.counts.length>0)for(var i=0;i<b.counts.length;i++)d+=b.counts[i];if(0==d)return void(a.control.genetate_pie=!1);for(var j=0;j<b.counts.length;j++)c[j].error_count=b.counts[j],0==d?c[j].scale=0:c[j].scale=b.counts[j]/d*100;for(var k=0;k<c.length;k++){var l=[c[k].key_word,c[k].scale];f.push(l)}var m={title:"关键字分析图表",dataname:"关键字占比",name:"关键字占比",data:f};return e.getPieConfig(m,260)},k=function(){return h?void d.analysisKeyToChart(h).then(function(b){b&&(a.data.keyword_report_list=b.wordCountBeanList||[],angular.forEach(a.data.keyword_report_list,function(a){a.chart_config=i(a),a.err_table=j(a)}))},function(a){f.alert(a.message)}):void a.backLogAnalysis()};a.backLogAnalysis=function(){a.$parent.control.show_keyword_chart=!1,b.go("inspection_log_analysis")},k()}]),inspectionCtrl.controller("logReportNewCtrl",["$scope","$state","$stateParams","$window","$timeout","LogXJ","BusiSys","ReportTemplateDateType","Charts","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=0;a.info={choosed_cyclic_log:{},log_report_info:{report_name:"",sys_name:"",log_names:[],log_ids:[],start_date:"",end_date:"",is_regular:!1,time_interval_type:""}},a.data={log_file_list:[],sys_list:[],report_template:h},a.control={is_preview:!1,save_loading:!1,is_add_log:!1};var m=function(){var b={error_code_list:[],regexp_list:[],use_reg:a.info.log_report_info.is_regular};b.error_code_list=a.info.log_report_info.error_release.split("|");for(var c=0;c<b.error_code_list.length;c++)b.regexp_list.push(b.use_reg);return b},n=function(){g.getAllLogBysiness().then(function(b){e(function(){a.data.sys_list=b.list_bs||[]},0)},function(a){j.alert(a.message)})};a.chooseLogFile=function(){return a.info.log_report_info.sys_name?void j.reportLogChoose(a.info.choosed_cyclic_log,a.info.log_report_info.sys_name).then(function(b){if(b){var c=[],d=[];if(a.control.is_add_log=!0,a.info.choosed_cyclic_log=b,b.choose_log_list)for(var e=0;e<b.choose_log_list.length;e++){var f=b.choose_log_list[e];c.push(f.log_name),d.push(f.log_id)}a.info.log_report_info.start_date=b.start_date,a.info.log_report_info.end_date=b.end_date,a.info.log_report_info.log_names=c,a.info.log_report_info.log_ids=d}}):(j.alert("请先选择系统"),!1)},a.selectSys=function(b){g.getAllLogList(b,l).then(function(b){e(function(){a.data.log_file_list=b.logBeanList||[],a.info.log_report_info.log_names=[],a.info.log_report_info.log_ids=[],a.info.choosed_cyclic_log={}},0)},function(a){j.alert(a.message)})},a.formSubmit=function(c){if(!k.valiForm(a.log_report_form))return!1;if(0==a.info.log_report_info.log_names.length)return j.alert("日志文件为空"),!1;var d=m(),e={report_name:a.info.log_report_info.report_name,sys_name:a.info.log_report_info.sys_name,log_names:a.info.log_report_info.log_names,
log_ids:a.info.log_report_info.log_ids,start_date:a.info.log_report_info.start_date,end_date:a.info.log_report_info.end_date,time_interval_type:a.info.log_report_info.time_interval_type,keywords:d.error_code_list,is_regular_exps:d.regexp_list,save_flag:c};if(1==c)a.control.save_loading=!0,f.getInspectContent(e).then(function(a){b.go("inspection_log_report_list")},function(b){a.control.save_loading=!1,j.alert(b.message)});else{a.control.is_preview=!0;var g={time_interval_type_cn:k.findValue(a.info.log_report_info.time_interval_type,h),error_release:a.info.log_report_info.error_release};b.go("inspection_log_report_new.log_preview",{submit_info:angular.extend(e,g)})}},a.cancel=function(){b.go("inspection_log_report_list")},n()}]),inspectionCtrl.controller("logReportReviewCtrl",["$scope","$timeout","$state","$stateParams","LogXJ","Charts","Modal",function(a,b,c,d,e,f,g){var h=d.submit_info;a.info={basic_info:h||{},report_info:{}},a.control={loading:!1,curr_page:0,toggle_basic_info:!1},a.config={chart_config:{}},a.data={report_preview_list:[],error_list:[]};var i=function(a){var b={title:0==a.time_interval_type?"错误时间分布":"错误数走势",subtitle:0==a.time_interval_type?a.start_date:a.start_date+"至"+a.end_date,chart_type:a.time_interval_type,yAxis_name:"错误数",xAxis_type:"5",columns:[{name:"错误数",data:a.count_by_units}],units:a.units};return f.getLogColumnConfig(b,260)},j=function(a){for(var b=[],c=0,d=0;d<a.keywords.length;d++){var e={key_word:a.keywords[d],error_count:"",scale:""};b.push(e)}if(a.counts.length>0)for(var f=0;f<a.counts.length;f++)c+=a.counts[f];for(var g=0;g<a.counts.length;g++)b[g].error_count=a.counts[g],0==a.total_count?b[g].scale="无":b[g].scale=a.counts[g]/c*100+"%";return b},k=function(){return h?(a.control.loading=!0,void e.getInspectContent(h).then(function(c){b(function(){a.control.loading=!1,a.data.report_preview_list=c.wordCountBeanList||[],a.data.report_preview_list.length>0&&(a.info.report_info=a.data.report_preview_list[0],a.config.chart_config=i(a.info.report_info),a.data.error_list=j(a.info.report_info))},0)},function(c){b(function(){a.control.loading=!1,a.backReportNew(),g.alert(c.message)},1e3)})):void a.backReportNew()};a.toggleBasicInfo=function(){a.control.toggle_basic_info=!a.control.toggle_basic_info},a.getPreReport=function(){$("#mainLog").fadeOut("fast"),b(function(){$("#mainLog").fadeIn("slow");var b=a.data.report_preview_list.length,c=(a.control.curr_page+b-1)%b;a.info.report_info=a.data.report_preview_list[c],a.config.chart_config=i(a.info.report_info),a.data.error_list=j(a.info.report_info),a.control.curr_page=c},500)},a.getNextReport=function(){$("#mainLog").fadeOut("fast"),b(function(){$("#mainLog").fadeIn("slow");var b=a.control.curr_page+1,c=a.data.report_preview_list.length,d=b%c;a.info.report_info=a.data.report_preview_list[d],a.config.chart_config=i(a.info.report_info),a.data.error_list=j(a.info.report_info),a.control.curr_page=d},500)},a.backReportNew=function(){a.$parent.control.is_preview=!1,c.go("inspection_log_report_new")},k()}]);var logModule=angular.module("LogModule",["ui.bootstrap","CvService","InspectionHttpSrv","ngCookies","CommHttpSrv","CvDirectives","ModalCtrl","GlobalData"]);logModule.value("baseUrl","/clWeb/"),logModule.controller("LogViewCtrl",["$scope","$rootScope","$cookieStore","$location","$timeout","$window","LogMonitor","Inspection","ScrollBarConfig","ScrollConfig","Modal",function(a,b,c,d,e,f,g,h,i,j,k){var l=c.get("log_list"),m=d.absUrl(),n=m.split("=")[2]?m.split("=")[2]:"",o={},p=0,q=500,r={start_hour:"00",start_minutes:"00",end_hour:"23",end_minutes:"59",keywords:"",key_line:""},s=$(".line-num-container");a.info={log_analysis_info:{sys_name:"",startDate:"",endDate:"",start_hour:"0",start_minutes:"0",end_hour:"23",end_minutes:"59",log_name:n,node_names:[],is_regular:!1,offset:1,size:500,page_size:500,search_key_word:"",keywords:"",keyword:"",context_line:1,is_regular_exps:[],choose_ip_list:[],log_detail:[],file_index:-1,timestamp_exp:"",result_state:"",show_result:!1,error_message:"",screen_info:angular.copy(r)},page_info:{total_page:0,page:{}}},a.control={show_hide_view:!0,time_input_err_msg:"",result_dynamic:"",file_loading:!1,page_show:!1,is_pie:!0,no_move:!1,show_keyword_chart:!1,log_search_result_loading:!1},a.config={scroll_y_config:i.Y(),scroll_xy_config:i.XY(),scroll_config:j},a.scollbar_callbacks={whileScrolling:function(){var a=Math.abs(this.mcs.top);a&&s.css({marginTop:-a,height:s.height()+a})}},a.data={node_ip_list:[],search_key_list:[],wordCountBeanList:[],log_tab_list:[],log_tab_show_list:[],ip_file_list:[]};var t=function(){s.css({marginTop:0,height:"auto"})},u=function(a,b,c){a.total_line=c,b.total_line=c},v=function(a){if(!a)return!1;for(var b=$(".log-data-row"),c=0;c<b.length;c++){var d=$(b[c]).children(":last"),e=new RegExp(a,"g"),f=d.text().replace(e,function(a){return'<strong  id="keyword-'+c+'" class="log-keyword-high-light keyword-mark">'+a+"</strong>"});d.html(f)}},w=function(b){e(function(){a.scrollToView(b)},50)},x=function(){a.info.log_analysis_info.log_detail=[],a.data.search_key_list=[]},y=function(a,b){for(var c=b.length,d=[];c--;)d.push(a[b[c]]);return d.join("|")},z=function(a,b){for(var c=[],d={},e=0,f=a.length;f>e;e++){var g=y(a[e],b);g in d||(d[g]=!0,c.push(a[e]))}return c},A=function(a){for(var b=$(".keyword-mark"),c=a.split("|"),d=[],e=0;e<c.length;e++)for(var f=0;f<b.length;f++){var g=$(b[f]),h=new RegExp(c[e],"g");if(h.test(g.text())){var i=$(g).parent().siblings(".inner-row-num").text(),j=$(g).parent().siblings(".inner-row-num").attr("dataid"),k={line_count:i,key_word:c[e],index_count:j,checked:!1};d.push(k)}}return z(d,["line_count","key_word"])},B=function(b,c){var d=5>c?c:5;a.info.log_analysis_info.offset>c&&(a.info.log_analysis_info.offset=1),b.page={numbers:c,current_page:a.info.log_analysis_info.offset?a.info.log_analysis_info.offset:1,show_page:[]};for(var f=1;d>=f;f++)b.page.show_page.push({key:f,value:f});e(function(){b.page_number_show=!0},1e3)},C=function(b,c,d){d=parseInt(d);var f=4>c-d?c-d:4;a.info.log_analysis_info.offset>c&&(a.info.log_analysis_info.offset=1),b.page={numbers:c,current_page:d?d:1,show_page:[]};for(var g=d;d+f>=g;g++)b.page.show_page.push({key:g,value:g});var h=b.page.show_page.length,i=5-h;if(d-h>=-2)for(var j=0,k=d;d+i>k;k++)j+=1,d-j>0&&b.page.show_page.unshift({key:d-j,value:d-j});e(function(){b.page_number_show=!0},1e3)},D=function(b){if(a.info.log_analysis_info.offset=b.page.current_page,x(),a.info.log_analysis_info.log_name){a.control.file_loading=!0,o.offset=b.page.current_page;var c=o;e(function(){E(c,o,1,1,"")},1500)}},E=function(b,c,d,e,f){a.control.file_loading=!0,g.getLogMonitorBypage(b).then(function(g){if(a.control.file_loading=!1,a.data.search_key_list=[],a.control.no_move=!1,a.control.page_show=!0,a.info.log_analysis_info.search_key_word="",a.info.log_analysis_info.error_message="",1==d){if(g){a.info.log_analysis_info.log_detail=g.beanList||[];var h=Math.ceil(parseInt(c.total_line)/parseInt(a.info.log_analysis_info.page_size));a.data.total_line=c.total_line,a.info.page_info.total_page=h,2==e&&B(a.info.page_info,h)}}else if(2==d){var i=angular.copy(a.info.log_analysis_info.file_index),j=o;if(g&&a.info.log_analysis_info.log_name==b.file){x(),a.info.log_analysis_info.show_result=!0,a.info.log_analysis_info.log_detail=g.beanList||[],a.data.total_line=parseInt(g.page_numeber),u(f[i],j,g.page_numeber);var k=Math.ceil(parseInt(g.page_numeber)/parseInt(a.info.log_analysis_info.page_size));a.info.page_info.total_page=k,B(a.info.page_info,k),a.control.page_show=!0}}g.beanList&&(a.scollbar_callbacks.setLeft=0,a.scollbar_callbacks.setTop=0,t())},function(b){a.control.no_move=!1,a.control.file_loading=!1,x()})},F=function(){for(var b=0;b<l.length;b++){var c=l[b];if(c.tem_file==n){o=c.log_condition;break}}a.control.file_loading=!0,g.getLogMonitorBypage(o).then(function(b){if(b){a.control.file_loading=!1,a.control.no_move=!1,a.control.page_show=!0,a.info.log_analysis_info.log_detail=b.beanList||[],a.data.total_line=parseInt(b.page_numeber);var c=Math.ceil(parseInt(a.data.total_line)/parseInt(a.info.log_analysis_info.page_size));o.total_line=a.data.total_line,a.info.page_info.total_page=c,B(a.info.page_info,c)}},function(b){k.alert(b.message),a.control.file_loading=!1})};a.toggleKeywordTable=function(){a.control.show_hide_view=!a.control.show_hide_view},a.clearKeyword=function(){a.info.log_analysis_info.search_key_word=""},a.changeSinglePageKeywordContent=function(b,c){if(2==c){if(!b)return a.info.log_analysis_info.page_size=q,b=q,!1;if(isNaN(b))return k.alert("输入不合法"),a.info.log_analysis_info.page_size=q,b=q,!1;if(0==parseInt(b))return k.alert("每页显示至少为1行"),a.info.log_analysis_info.page_size=q,b=q,!1;if(b>1e3)return k.alert("每页最多1000行"),a.info.log_analysis_info.page_size=q,b=q,!1;if(q==b)return!1;q=b}a.info.log_analysis_info.size=b;var d=!0;a.info.log_analysis_info.log_name&&d&&(a.control.file_loading=!0,a.control.page_show=!1,a.info.log_analysis_info.offset=1,o.size=b,o.offset=1,x(),e(function(){E(o,o,1,2,"")},1500))},a.switchPageToPageNum=function(a,b){switch(b.page.current_page=a.value,a.key){case 1:a.value>0&&a.value<b.page.numbers-1&&(b.page.show_page=[{key:1,value:a.value},{key:2,value:a.value+1},{key:3,value:a.value+2},{key:4,value:a.value+3}]);break;case 4:a.value>2&&a.value<b.page.numbers-1&&(b.page.show_page=[{key:1,value:a.value-2},{key:2,value:a.value-1},{key:3,value:a.value},{key:4,value:a.value+1}])}D(b)},a.nextPage=function(a,b){if(a){if(b.page.current_page==b.page.numbers)return void k.alert("已是最后一页");for(var c=0;c<b.page.show_page.length;c++){var d=b.page.show_page[c];if(b.page.current_page==d.value)return void D(b)}angular.forEach(b.page.show_page,function(a,b,c){a.value++})}else{if(1==b.page.current_page)return void k.alert("已是最前一页");for(var c=0;c<b.page.show_page.length;c++){var d=b.page.show_page[c];if(b.page.current_page==d.value)return void D(b)}angular.forEach(b.page.show_page,function(a,b,c){a.value--})}D(b)},a.searchByKeyword=function(b){if(!b)return!1;for(var c=$(".log-data-row"),d=0;d<c.length;d++){var f=$(c[d]).children(":last"),g=new RegExp(b,"g"),h=f.text().replace(g,function(a){return'<strong id="keyword-'+d+'" class="log-keyword-high-light keyword-mark">'+a+"</strong>"});f.html(h)}e(function(){a.data.search_key_list=[],a.data.search_key_list=A(b),0===a.data.search_key_list.length&&k.alert("暂无搜索数据")},300)},a.firstHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;if(a.data.search_key_list.length>0){var b=a.data.search_key_list[0];a.scrollByLineCount(b.key_word,b.line_count,b.index_count,b,0)}},a.preHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;var b=a.data.search_key_list.length;if(b>0)if(0==p)a.firstHighLight(a.info.log_analysis_info.search_key_word);else{var c=parseInt(p)-1,d=a.data.search_key_list[c];d&&a.scrollByLineCount(d.key_word,d.line_count,d.index_count,d,c)}},a.nextHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;var b=a.data.search_key_list.length;if(b>0)if(p==b);else{var c=parseInt(p)+1,d=a.data.search_key_list[c];d&&a.scrollByLineCount(d.key_word,d.line_count,d.index_count,d,c)}},a.lastHighLight=function(){if(!a.info.log_analysis_info.search_key_word)return k.alert("请先输入关键字！"),!1;if(a.data.search_key_list.length>0){var b=a.data.search_key_list.length-1,c=a.data.search_key_list[b];a.scrollByLineCount(c.key_word,c.line_count,c.index_count,c,b)}},a.scrollByLineCount=function(b,c,d,e,f){var g=0;p=f,angular.forEach(a.data.search_key_list,function(a){a.checked=!1}),e.checked=!0,v(a.info.log_analysis_info.search_key_word);for(var h=$(".log-data-row").eq(d).children("span").eq(1).children(".log-keyword-high-light"),i=0;i<h.length;i++){var j=h[i];j.textContent===b&&(g++,1===g&&w($(j)),$(j).removeClass("log-keyword-high-light").addClass("log-keyword-high-light-checked"))}},a.changeHeight=function(a){var b,c={},d=$(window).height();return 1==a?(b=d-190,b>463?c.height=b+7:c.height=464):2==a&&(c.height=d-190-18),c},a.changeCurPage=function(b,c,d){if(d>a.info.page_info.total_page)return k.alert("输入页数不允许超过总页数"),!1;if(0==d)return k.alert("输入页数不可以为0"),!1;if(a.info.log_analysis_info.size=b,a.info.log_analysis_info.log_name){a.control.file_loading=!0,a.control.page_show=!1,x(),a.control.file_loading=!0;var f=o;f.size=b,f.offset=d,e(function(){g.getLogMonitorBypage(f).then(function(b){if(a.control.file_loading=!1,a.info.log_analysis_info.search_key_word="",b){a.info.log_analysis_info.show_result=!0,a.info.log_analysis_info.log_detail=b.beanList||[];var c=Math.ceil(parseInt(a.data.total_line)/parseInt(a.info.log_analysis_info.page_size));a.info.page_info.total_page=c,C(a.info.page_info,c,d),a.control.page_show=!0,e(function(){a.searchByKeyword(a.info.log_analysis_info.search_key_word)},500)}},function(b){a.control.file_loading=!1,x()})},1e3)}},F(),$(window).resize(function(){e(function(){a.changeHeight(1),a.changeHeight(2)},50)})}]);var pdfModule=angular.module("PDFModule",["highcharts-ng","ui.bootstrap","CvService","InspectionHttpSrv","CommHttpSrv","ChartsService","ModalCtrl","GlobalData"]);pdfModule.value("baseUrl","/clWeb/"),pdfModule.controller("LogReportCtrl",["$scope","$rootScope","$location","$timeout","$window","LogXJ","Inspection","Charts","Modal",function(a,b,c,d,e,f,g,h,i){var j=c.absUrl();a.log_inspect_info={report_name:j.split("=")[1]?j.split("=")[1]:"",sys_name:"",log_names:[],start_date:"",end_date:"",keywords:[],is_regular:!1,time_interval_type:"",is_regular_exps:[]},a.data={log_file_list:[],sys_list:[],date_circle:[],wordCountBeanList:[]},a.control={export_loading:!1,loading_all:!0};var k=function(){a.control.loading_all=!0,f.getReportMessage(a.log_inspect_info.report_name).then(function(b){b.info.down_file_path?f.getReportChartByName(j.split("=")[1]).then(function(b){d(function(){a.data.wordCountBeanList=b.wordCountBeanList||[],angular.forEach(a.data.wordCountBeanList,function(a){a.chart_config=l(a),a.err_table=m(a)}),a.control.loading_all=!1},0)},function(b){a.control.loading_all=!1,i.alert(b.message)}):f.getReportChartByName(j.split("=")[1]).then(function(b){d(function(){a.data.wordCountBeanList=b.wordCountBeanList||[],angular.forEach(a.data.wordCountBeanList,function(a){a.chart_config=l(a),a.err_table=m(a)}),a.control.loading_all=!1,d(function(){a.control.export_loading=!0,f.getInspectPdf(a.log_inspect_info.report_name,j.replace("false","true"),"1024*768").then(function(b){d(function(){a.control.export_loading=!1,i.alert("导出成功")},0)},function(b){a.control.export_loading=!1,i.alert(b.message)})},1e3)},0)},function(b){a.control.loading_all=!1,i.alert(b.message)})},function(b){i.alert(b.message),a.control.loading_all=!1})},l=function(a){var b={title:0==a.time_interval_type?"错误时间分布":"错误数走势",subtitle:0==a.time_interval_type?a.start_date:a.start_date+"至"+a.end_date,chart_type:a.time_interval_type,yAxis_name:"错误数",xAxis_type:"5",columns:[{name:"错误数",data:a.count_by_units}],units:a.units};return h.getLogColumnConfig(b,260)},m=function(a){for(var b=[],c=0;c<a.keywords.length;c++){var d={key_word:a.keywords[c],error_count:"",scale:""};b.push(d)}for(var e=0;e<a.counts.length;e++)b[e].error_count=a.counts[e],0==a.total_count?b[e].scale="无":b[e].scale=a.counts[e]/a.total_count*100+"%";return b},n=function(){k()};a.saveToPdf=function(){a.control.export_loading=!0,f.getInspectPdf(a.log_inspect_info.report_name,j.replace("false","true"),"1024*768").then(function(b){d(function(){a.control.export_loading=!1,i.alert("导出成功")},0)},function(b){a.control.export_loading=!1,i.alert(b.message)})},n()}]);var flow=angular.module("dispatchFlowController",[]);flow.controller("flowBasicInfoNewCtrl",["$scope","$stateParams","$timeout","$cookieStore","$state","Flow","FlowType","Scene","Strategy","StrategyPriority","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){a.data={scene_list:[],strategy_group_list:[],strategy_priority_list:j,flow_type_list:angular.copy(g),save_btn_label:"保存"},a.info={sdflow_cn_name:"",sdarrange_method:1,sdparallel_task:1,sddispatch_type:1,sd_strategy_id:"",sd_priority:5,sdflow_types:[]},a.control={show_basic_detail:!1,scene_loading:!1,strategy_loading:!1,name_edit_flag:!0,basic_saveing:!1};var m=function(){a.control.scene_loading=!0,h.getSceneListByType({key_word:"",data:{offset:0}}).then(function(b){c(function(){a.control.scene_loading=!1,a.data.scene_list=b.scene_list?b.scene_list.filter(function(a){return 3!==a.scene_type}):[]},0)},function(b){a.control.scene_loading=!1,k.alert(b.message)})},n=function(){i.getStrategyGroupList().then(function(b){c(function(){a.control.strategy_loading=!1,b.strategy_group_list&&(a.data.strategy_group_list=b.strategy_group_list,a.info.sd_strategy_id||a.data.strategy_group_list.some(function(b,c){return 1===b.sdstrategy_type&&(a.info.sd_strategy_id=a.data.strategy_group_list[c].sdstrategy_id)}))},0)},function(b){a.control.strategy_loading=!1,k.alert(b.message)})},o=function(b){if(!b)return{};for(var c,d=0;d<a.data.strategy_group_list.length;d++){var e=a.data.strategy_group_list[d];if(e.sdstrategy_id===b){c={strategy_name:e.sdstrategy_name?e.sdstrategy_name:"",strategy_type:e.sdstrategy_type?e.sdstrategy_type:0,strategy_concurrent:e.sdstrategy_concurrent?e.sdstrategy_concurrent:0};break}}return c},p=function(){m(),n()};a.selectStrategy=function(b){var c=o(b);a.info.sd_strategy_id=b,c&&(a.control.strategy_type=c.strategy_type,a.control.strategy_concurrent=c.strategy_concurrent,a.info.strategy_name=c.strategy_name)},a.save=function(){if(!l.valiForm(a.info.workorder_form))return!1;a.control.basic_saveing=!0;for(var b=0;b<a.data.flow_type_list.length;b++){var c=a.data.flow_type_list[b];c.flag&&a.info.sdflow_types.push(a.data.flow_type_list[b].key)}f.saveFlowBasicData(a.info,!1).then(function(a){a&&e.go("dispatch_flow_edit",{flow_id:a.sdflow_id,version_id:a.sdversion_id})},function(b){a.control.basic_saveing=!1,k.alert(b.message)})},p()}]),flow.controller("flowBasicInfoEditCtrl",["$scope","$stateParams","$timeout","$cookieStore","$state","Flow","FlowType","Scene","Strategy","StrategyPriority","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b.flow_id,n=b.version_id;a.data={scene_list:[],strategy_group_list:[],strategy_priority_list:j,flow_type_list:angular.copy(g),save_btn_label:"修改"},a.info={sdflow_cn_name:"",sdarrange_method:1,sdparallel_task:1,sddispatch_type:1,sd_strategy_id:"",sd_priority:5,sdflow_types:[]},a.control={show_basic_detail:!0,scene_loading:!1,strategy_loading:!1,name_edit_flag:!0,basic_saveing:!1};var o=function(){a.control.scene_loading=!0,h.getSceneListByType({key_word:"",data:{offset:0}}).then(function(b){c(function(){a.control.scene_loading=!1,a.data.scene_list=b.scene_list?b.scene_list.filter(function(a){return 3!==a.scene_type}):[]},0)},function(b){a.control.scene_loading=!1,k.alert(b.message)})},p=function(){i.getStrategyGroupList().then(function(b){c(function(){a.control.strategy_loading=!1,b.strategy_group_list&&(a.data.strategy_group_list=b.strategy_group_list,a.info.sd_strategy_id||a.data.strategy_group_list.some(function(b,c){return 1===b.sdstrategy_type&&(a.info.sd_strategy_id=a.data.strategy_group_list[c].sdstrategy_id)}))},0)},function(b){a.control.strategy_loading=!1,k.alert(b.message)})},q=function(){f.viewFlowBasicInfo(m,n).then(function(b){angular.extend(a.info,b.basicInfo?b.basicInfo:{}),a.info.sd_strategy_id&&a.selectStrategy(a.info.sd_strategy_id);for(var c=a.info.sdflow_type.split(","),d=0;d<a.data.flow_type_list.length;d++)for(var e=a.data.flow_type_list[d],f=0;f<c.length;f++)e.key==c[f]&&(a.data.flow_type_list[d].flag=!0)},function(a){k.alert(a.message)})},r=function(b){if(!b)return{};for(var c,d=0;d<a.data.strategy_group_list.length;d++){var e=a.data.strategy_group_list[d];if(e.sdstrategy_id===b){c={strategy_name:e.sdstrategy_name?e.sdstrategy_name:"",strategy_type:e.sdstrategy_type?e.sdstrategy_type:0,strategy_concurrent:e.sdstrategy_concurrent?e.sdstrategy_concurrent:0};break}}return c},s=function(){o(),p(),q()};a.selectStrategy=function(b){var c=r(b);a.info.sd_strategy_id=b,c&&(a.control.strategy_type=c.strategy_type,a.control.strategy_concurrent=c.strategy_concurrent,a.info.strategy_name=c.strategy_name)},a.save=function(){if(!l.valiForm(a.info.workorder_form))return!1;a.control.basic_saveing=!0;for(var b=0;b<a.data.flow_type_list.length;b++){var c=a.data.flow_type_list[b];c.flag&&a.info.sdflow_types.push(a.data.flow_type_list[b].key)}f.saveFlowBasicData(a.info,!0).then(function(a){a&&e.go("dispatch_flow_edit",{flow_id:m,version_id:n})},function(b){a.control.basic_saveing=!1,k.alert(b.message)})},a.$on("addPalette",function(b,c){a.$broadcast("privatePalette",c)}),s()}]),flow.controller("flowBasicInfoDetailCtrl",["$scope","$stateParams","$timeout","$state","Flow","FlowType","Scene","Strategy","Modal",function(a,b,c,d,e,f,g,h,i){a.info={},a.data={flow_type_list:angular.copy(f)},a.control={show_basic_detail:!0};var j=function(){var b=a.info.sdflow_type;b=b.split(",");for(var c=0;c<a.data.flow_type_list.length;c++)for(var d=a.data.flow_type_list[c],e=0;e<b.length;e++)d.key==b[e]&&(d.flag=!0)},k=function(a){if(a.cycle_info)if(a.cycle_info.cycles=[],1==a.cycle_info.cycle_type){if(a.cycle_info.customize_time_list)for(var b=0;b<a.cycle_info.customize_time_list.length;b++){var c=a.cycle_info.customize_time_list[b].substring(0,10),d=a.cycle_info.customize_time_list[b].substring(0,4)+"年"+a.cycle_info.customize_time_list[b].substring(5,7)+"月"+a.cycle_info.customize_time_list[b].substring(8,10),e=a.cycle_info.customize_time_list[b].substring(11,13),f=a.cycle_info.customize_time_list[b].substring(14,16);a.cycle_info.cycles.push({ww:0,dd:0,mm:0,hh:e,mi:f,customize_times:"",date:c,date_str:d})}}else 2==a.cycle_info.cycle_type?(a.cycle_info.cycles=a.cycle_info.cycleTimeBeen,a.cycle_info.time_unit=a.cycle_info.cycleTimeBeen[0].unit):a.cycle_info.loop_time&&(a.cycle_info.cycles=[a.cycle_info.loop_time],a.cycle_info.time_unit=a.cycle_info.loop_time.unit);return a},l=function(a){a.start_bk_datetime&&(a.start_bk_datetime_val=a.start_bk_datetime.substring(0,4)+"年"+a.start_bk_datetime.substring(5,7)+"月"+a.start_bk_datetime.substring(8,10)),a.end_bk_datetime&&(a.end_bk_datetime_val=a.end_bk_datetime.substring(0,4)+"年"+a.end_bk_datetime.substring(5,7)+"月"+a.end_bk_datetime.substring(8,10));var b=angular.copy(a);return k(b),a.cycle_info=b.cycle_info||{},a};a.configTime=function(b){var c=angular.copy(a.info);k(c),c.view_flag=b,i.configFlowTime(c).then(function(a){})};var m=function(){e.viewFlowBasicInfo(b.flow_id,b.version_id).then(function(b){a.info=b.basicInfo,a.info.sdarrange_method=b.basicInfo.sdarrange_method||1,a.info.scene_name=b.scene_name||"--",a.info.sdstrategy_name=b.sdstrategy_name||"--",a.info.strategy_concurrent=b.strategy_concurrent||"",a.info.strategy_type=b.strategy_type||"",a.info.scene_id=b.scene_main_id||"",j(),angular.extend(a.info,l(b.sdFlowJsonBean?b.sdFlowJsonBean:{}))},function(a){i.alert(a.message)})};m()}]),flow.controller("flowBasicInfoCopyCtrl",["$scope","$stateParams","$timeout","$state","Flow","FlowType","Scene","Strategy","StrategyPriority","Params","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b.flow_id,n=b.version_id;a.data={scene_list:[],strategy_group_list:[],strategy_priority_list:i,flow_type_list:angular.copy(f),save_btn_label:"保存"},a.info={workorder_form:"",sdflow_cn_name:"",sdarrange_method:1,sdparallel_task:1,sddispatch_type:1,sd_strategy_id:"",sd_priority:5,sdflow_types:[]},a.control={show_basic_detail:!1,scene_loading:!1,strategy_loading:!1,name_edit_flag:!0,basic_saveing:!1};var o=function(){a.control.scene_loading=!0,g.getSceneListByType({key_word:"",data:{offset:0}}).then(function(b){c(function(){a.control.scene_loading=!1,a.data.scene_list=b.scene_list?b.scene_list.filter(function(a){return 3!==a.scene_type}):[]},0)},function(b){a.control.scene_loading=!1,k.alert(b.message)})},p=function(){h.getStrategyGroupList().then(function(b){c(function(){a.control.strategy_loading=!1,b.strategy_group_list&&(a.data.strategy_group_list=b.strategy_group_list,a.info.sd_strategy_id||a.data.strategy_group_list.some(function(b,c){return 1===b.sdstrategy_type&&(a.info.sd_strategy_id=a.data.strategy_group_list[c].sdstrategy_id)}))},0)},function(b){a.control.strategy_loading=!1,k.alert(b.message)})},q=function(){e.viewFlowBasicInfo(m,n).then(function(b){a.info.sdflow_cn_name="",a.info.sdflow_bk_desc="",a.info.sddispatch_type=b.basicInfo.sddispatch_type||1,a.info.sdparallel_task=b.basicInfo.sdparallel_task||1,a.info.sdarrange_method=b.basicInfo.sdarrange_method||1,a.info.sdflow_type=b.basicInfo.sdflow_type||"",a.info.sd_strategy_id=b.basicInfo.sd_strategy_id||"",a.info.scene_main_id=b.basicInfo.scene_main_id||"",a.info.sd_strategy_id&&a.selectStrategy(a.info.sd_strategy_id);for(var c=a.info.sdflow_type.split(","),d=0;d<a.data.flow_type_list.length;d++)for(var e=a.data.flow_type_list[d],f=0;f<c.length;f++)e.key==c[f]&&(a.data.flow_type_list[d].flag=!0)},function(a){k.alert(a.message)})},r=function(b){if(!b)return{};for(var c,d=0;d<a.data.strategy_group_list.length;d++){var e=a.data.strategy_group_list[d];if(e.sdstrategy_id===b){c={strategy_name:e.sdstrategy_name?e.sdstrategy_name:"",strategy_type:e.sdstrategy_type?e.sdstrategy_type:0,strategy_concurrent:e.sdstrategy_concurrent?e.sdstrategy_concurrent:0};break}}return c},s=function(){o(),p(),q()};a.selectStrategy=function(b){var c=r(b);a.info.sd_strategy_id=b,c&&(a.control.strategy_type=c.strategy_type,a.control.strategy_concurrent=c.strategy_concurrent,a.info.strategy_name=c.strategy_name)},a.save=function(){if(!l.valiForm(a.info.workorder_form))return!1;a.control.basic_saveing=!0;for(var b=0;b<a.data.flow_type_list.length;b++){var c=a.data.flow_type_list[b];c.flag&&a.info.sdflow_types.push(a.data.flow_type_list[b].key)}e.saveFlowBasicData(a.info,!1).then(function(a){a&&(j.setParams({flow_id:m,version_id:n}),d.go("dispatch_flow_edit",{flow_id:a.sdflow_id,version_id:a.sdversion_id}))},function(b){a.control.basic_saveing=!1,k.alert(b.message)})},s()}]),flow.controller("flowChartEditCtrl",["$scope","$stateParams","$timeout","$state","Flow","FlowType","Scene","Strategy","ElementCategory","User","ScrollConfig","Params","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=l.getParams().flow_id?l.getParams().flow_id:b.flow_id,p=l.getParams().version_id?l.getParams().version_id:b.version_id;a.info.sdflow_id=b.flow_id,a.info.sdversion_id=b.version_id,angular.extend(a.control,{modify_flag:b.modify_flag||!1,job_config:!1,reflash_node:!1,load_flow:!1,selectKeyFromIns:0,user_config_show:!1,basic_ele:!1,private_ele:!1,palette0:!1,palette1:!0,palette2:!0,palette3:!0,palette4:!0,palette5:!0,palette6:!0,palette7:!0,palette8:!0}),a.data={user_list:[],palette_list:{condition_list:[],polling_list:[{category:"7",text:"轮询",type:6,sd_job_bean:{}}],file_list:[{category:"7",text:"ftp文件",type:7,sd_job_bean:{}},{category:"7",text:"ftp文件",type:8,sd_job_bean:{}},{category:"7",text:"sftp文件",type:9,sd_job_bean:{}},{category:"7",text:"sftp文件",type:10,sd_job_bean:{}},{category:"7",text:"agent文件",type:11,sd_job_bean:{}},{category:"7",text:"agent文件",type:12,sd_job_bean:{}},{category:"7",text:"拷贝文件",type:13,sd_job_bean:{}}],db_list:[{category:"7",text:"数据库",type:14,sd_job_bean:{}},{category:"7",text:"数据库脚本",type:15,sd_job_bean:{}}],web_list:[{category:"7",text:"网络配置",type:16,sd_job_bean:{}}],apply_list:[{category:"7",text:"应用启动",type:17,sd_job_bean:{}},{category:"7",text:"应用停止",type:18,sd_job_bean:{}}],shell_list:[{category:"7",text:"Python",type:19,sd_job_bean:{}},{category:"7",text:"Shell",type:20,sd_job_bean:{}},{category:"7",text:"Bat",type:21,sd_job_bean:{}},{category:"7",text:"Java",type:30,sd_job_bean:{}},{category:"7",text:"C",type:31,sd_job_bean:{}},{category:"7",text:"C++",type:32,sd_job_bean:{}}],webS_list:[{category:"7",text:"WebService",type:24,sd_job_bean:{}},{category:"7",text:"Tcp",type:25,sd_job_bean:{}},{category:"7",text:"HTTP",type:26,sd_job_bean:{}}],other_list:[{category:"7",text:"CL",type:28,sd_job_bean:{}},{category:"7",text:"RPG",type:29,sd_job_bean:{}}]},private_palette_list:[],scene_palette_list:[],attr_data:{pre_job_basic_data:[],ref_job_list:[]}},a.configs={drag_left_scroll:k,undoOpreation:{},redoOpreation:{},layoutArray:{autoArrang:!1}},a.flow_info={nodeDataArray:[],linkDataArray:[]};var q=function(){1==a.info.sdarrange_method?a.data.palette_list.condition_list=[{category:"1",text:"开始",type:1,sd_job_bean:{}},{category:"2",text:"结束",type:2,sd_job_bean:{}},{category:"6",text:"作业分组",isGroup:!0,type:3,grid:0},{category:"3",text:"条件",type:4,sd_job_bean:{}},{category:"5",text:"中断",type:5,sd_job_bean:{}}]:a.data.palette_list.condition_list=[{category:"1",text:"开始",type:1,sd_job_bean:{}},{category:"2",text:"结束",type:2,sd_job_bean:{}},{category:"3",text:"条件",type:4,sd_job_bean:{}},{category:"5",text:"中断",type:5,sd_job_bean:{}}],a.control.load_flow=!0},r=function(a){return a?n.findValue(a,i):"--"},s=function(){j.getAllUserCanExec().then(function(b){a.data.user_list=b.user_dept_list||[],a.flow_info.exe_user_list=a.flow_info.exe_user_ids||[];for(var c=0;c<a.flow_info.exe_user_list.length;c++)for(var d=a.flow_info.exe_user_list[c],e=0;e<a.data.user_list.length;e++){var f=a.data.user_list[e];f.user_id===d&&(f.flag=!0)}t(a.info.scene_main_id)},function(b){a.control.basic_saveing=!1,m.alert(b.message)})},t=function(b){g.getSingleSceneDetail(b,!0).then(function(b){c(function(){for(var d=b.scene_bean&&b.scene_bean.category_list?b.scene_bean.category_list:[],e=b.private_scene_bean&&b.private_scene_bean.category_list?b.private_scene_bean.category_list:[],f=0;f<d.length;f++){var g=d[f];g.element_list=g.element_list?g.element_list:[],g.category_cn=g.text?g.text:r(g.category);for(var h=0;h<g.element_list.length;h++){var i=g.element_list[h];i.category="7",i.sd_job_bean=i.element_info?i.element_info:{},i.text=i.sd_job_bean.sdwork_cn_name?i.sd_job_bean.sdwork_cn_name:i.text,i.sd_job_bean.is_special_element=!0}}if(d.length){var j={scene_id:b.scene_bean.scene_id,scene_name:b.scene_bean.scene_name,category_list:d};c(function(){a.data.scene_palette_list.push(j)},10)}for(var k=[],l=0;l<e.length;l++){var m=e[l];m.element_list=m.element_list?m.element_list:[],m.category_cn=m.text?m.text:r(m.category);for(var n=0;n<m.element_list.length;n++){var o=m.element_list[n];o.element_info=o.element_info?o.element_info:{},o.element_info.is_special_element=!0,k.push({category:"7",type:o.type,text:o.element_info.sdwork_cn_name?o.element_info.sdwork_cn_name:o.text,sd_job_bean:o.element_info})}}k.length&&(a.data.private_palette_list=k),a.control.collapse_basic_detail=!0,k.length&&a.$broadcast("updatePalette"),u(500,!0)},0)},function(a){m.alert(a.message)})},u=function(b,d){var e=b||5;c(function(){if($(".header_bg").offset()){var b=$(window).height()-$(".header_bg").offset().top-75;$(".dragLeft").css("height",b),$(".dragMid").css("height",b),$(".grid_bg").css("height",b),$(".job_div").css("height",b-31-58),$(".jobno_div").css("height",b-1),d&&a.autoArray()}},e)},v=function(){a.flow_info.link_list=a.flow_info.link_list||[];for(var b=0;b<a.flow_info.link_list.length;b++){var c=a.flow_info.link_list[b];c.visible&&(c.text=c.expr)}if(a.flow_info.linkDataArray=a.flow_info.link_list,a.flow_info.start_bk_datetime){var d=a.flow_info.start_bk_datetime;a.flow_info.start_bk_datetime_val=d.substring(0,4)+"年"+d.substring(5,7)+"月"+d.substring(8,10)}if(a.flow_info.end_bk_datetime){var e=a.flow_info.end_bk_datetime;a.flow_info.end_bk_datetime_val=e.substring(0,4)+"年"+e.substring(5,7)+"月"+e.substring(8,10)}var f=angular.copy(a.flow_info);if(f.cycle_info){if(1==f.cycle_info.cycle_type){if(f.cycle_info.customize_time_list){f.cycle_info.cycles=[];for(var b=0;b<f.cycle_info.customize_time_list.length;b++){var g=f.cycle_info.customize_time_list[b],h=g.substring(0,10),i=g.substring(11,13),j=g.substring(14,16),k=g.substring(0,4)+"年"+g.substring(5,7)+"月"+g.substring(8,10);f.cycle_info.cycles.push({ww:0,dd:0,mm:0,hh:i,mi:j,customize_times:"",date:h,date_str:k})}}}else 2==f.cycle_info.cycle_type?(f.cycle_info.cycles=f.cycle_info.cycleTimeBeen,
f.cycle_info.time_unit=f.cycle_info.cycleTimeBeen[0].unit):3==f.cycle_info.cycle_type&&(f.cycle_info.cycles=[f.cycle_info.loop_time],f.cycle_info.time_unit=f.cycle_info.loop_time.unit);a.flow_info.cycle_info=f.cycle_info}},w=function(){e.viewFlowDetailData(o,p).then(function(b){angular.extend(a.flow_info,b.sdFlowJsonBean?b.sdFlowJsonBean:{}),a.flow_info.exe_user_ids=a.flow_info.exe_user_ids?a.flow_info.exe_user_ids:a.info.exe_user_ids?a.info.exe_user_ids.split(","):[],a.flow_info.nodeDataArray=a.flow_info.sd_node_list||[];for(var c=0;c<a.flow_info.nodeDataArray.length;c++){var d=a.flow_info.nodeDataArray[c];d.category=d.category.toString(),d.isGroup=d.is_group,d.group=d.group<0?-d.group:d.group,d.key=d.key<0?-d.key:d.key;var e=d.sd_job_bean;e&&(e.sdwork_cn_name&&(e.config=!0),e.datetime_condition&&(e.date_condition=e.datetime_condition.substring(0,10),e.h_condition=e.datetime_condition.substring(11,13),e.m_condition=e.datetime_condition.substring(14,16)))}v(),a.autoArray(),s(),u(20),q()},function(a){})};a.autoArray=function(){a.configs.layoutArray.autoArrang=!a.configs.layoutArray.autoArrang},a.addScene=function(){m.addScene(a.data.scene_palette_list).then(function(b){b&&(a.data.scene_palette_list=a.data.scene_palette_list.concat(b))})},a.saveExendData=function(){if(1==a.info.sddispatch_type&&0==a.flow_info.exe_user_list.length)return m.alert("请配置执行人！"),!1;if(2==a.info.sddispatch_type&&!a.flow_info.start_bk_datetime_val)return m.alert("请配置执行时间！"),!1;if(2==a.info.sddispatch_type&&a.flow_info.cycle_info.cycle_type&&0==a.flow_info.cycle_info.cycles.length)return m.alert("执行时间配置不完整，请重配！"),!1;for(var b=0;b<a.flow_info.nodeDataArray.length;b++){var c=a.flow_info.nodeDataArray[b];(1==c.type||2==c.type)&&(c.sd_job_bean.job_id=c.key),c.is_group=c.isGroup,c.key=c.key<0?-c.key:c.key,c.sd_job_bean&&(c.sd_job_bean.job_id=c.key+""),3!=c.type&&(c.group=c.group<0?-c.group:c.group)}for(var b=0;b<a.flow_info.linkDataArray.length;b++){var f=a.flow_info.linkDataArray[b];f.visible&&(f.expr=f.text),f.from=f.from<0?-f.from:f.from,f.to=f.to<0?-f.to:f.to}a.flow_info.sdversion_id=a.info.sdversion_id,a.flow_info.sdflow_id=a.info.sdflow_id,e.saveFlowExtendData(a.flow_info).then(function(){1==a.info.sddispatch_type?d.go("dispatch_flow_list",{active_name:"handle"}):d.go("dispatch_flow_list",{active_name:"auto"})},function(a){m.alert(a.message)})},a.configTime=function(){a.flow_info.cycle_info=a.flow_info.cycle_info||{},a.flow_info.cycle_info.customize_time_list=a.flow_info.cycle_info.customize_time_list||[],a.flow_info.cycle_info.cycleTimeBeen=a.flow_info.cycle_info.cycleTimeBeen||[],a.flow_info.cycle_info.loop_time=a.flow_info.cycle_info.loop_time||{};var b=angular.copy(a.flow_info);m.configFlowTime(b).then(function(b){if(a.flow_info.start_bk_datetime=b.start_bk_datetime,a.flow_info.end_bk_datetime=b.end_bk_datetime,a.flow_info.start_bk_datetime_val=n.dtFormat(b.start_bk_datetime),a.flow_info.end_bk_datetime_val=n.dtFormat(b.end_bk_datetime),a.flow_info.cycle_info.cycle_type=b.cycle_type,a.flow_info.cycle_info.cycles=b.cycles,a.flow_info.period_list_str=b.period_list_str,a.flow_info.time_unit=b.time_unit,a.flow_info.cycle_info.time_unit=b.time_unit,a.flow_info.cycle_info.customize_time_list=[],1==a.flow_info.cycle_info.cycle_type)for(var c=0;c<a.flow_info.cycle_info.cycles.length;c++){var d=a.flow_info.cycle_info.cycles[c];d.hh=d.hh||"00",d.mi=d.mi||"00";var e=parseInt(d.hh),f="";f=e>=0&&10>e?"0"+e:e;var g=parseInt(d.mi),h="";h=g>=0&&10>g?"0"+g:g,a.flow_info.cycle_info.customize_time_list.push(d.date+" "+f+":"+h+":00")}else if(2==a.flow_info.cycle_info.cycle_type){for(var c=0;c<a.flow_info.cycle_info.cycles.length;c++)a.flow_info.cycle_info.cycles[c].unit=b.time_unit;a.flow_info.cycle_info.cycleTimeBeen=a.flow_info.cycle_info.cycles}else{for(var c=0;c<a.flow_info.cycle_info.cycles.length;c++)a.flow_info.cycle_info.cycles[c].unit=b.time_unit;a.flow_info.cycle_info.loop_time=a.flow_info.cycle_info.cycles[0]}console.log(a.flow_info.cycle_info)})},a.configUser=function(){a.control.user_config_show=!a.control.user_config_show},a.chooseUser=function(b){var c=a.data.user_list[b];if(c.flag=!c.flag,c.flag)a.flow_info.exe_user_list.push(c.user_id);else for(var d=0;d<a.flow_info.exe_user_list.length;d++){var e=a.flow_info.exe_user_list[d];e==c.user_id&&a.flow_info.exe_user_list.splice(d,1)}},a.saveFlowExeUser=function(){return 1==a.info.sddispatch_type&&0===a.flow_info.exe_user_list.length?(m.alert("请选择执行人！"),!1):(a.control.save_exeuser_loading=!0,a.flow_info.sdflow_id=a.info.sdflow_id,a.flow_info.sdversion_id=a.info.sdversion_id,void e.editFLowExeUser(a.flow_info).then(function(b){a.control.user_config_show=!a.control.user_config_show,a.control.save_exeuser_loading=!1},function(b){a.control.save_exeuser_loading=!1,m.alert(b.message)}))},a.config=function(b){var c={linkDataArray:a.flow_info.linkDataArray,nodeDataArray:a.flow_info.nodeDataArray},e=a.control.modify_flag?"dispatch_flow_modify":"dispatch_flow_edit";d.go(e+".config",{config_data:c,node_obj:b})},a.goToNoDataPage=function(){var b=a.control.modify_flag?"dispatch_flow_modify":"dispatch_flow_edit";u(),d.go(b+".no_data")},a.removeScene=function(b,c,d){d.stopPropagation();var e=c?"删除[ "+c+" ]场景 ?":"删除场景 ?";m.confirm(e).then(function(){a.data.scene_palette_list.splice(b,1)})},a.togledetail=function(){a.control.show_basic_detail=!a.control.show_basic_detail,u(800,!0)},$(window).resize(function(){u()}),a.$on("privatePalette",function(b,c){a.$broadcast("addPalette",c)}),a.$on("$stateChangeSuccess",function(){l.init()}),w()}]),flow.controller("flowChartDetailCtrl",["$scope","$stateParams","$timeout","$state","Flow","FlowType","Scene","Strategy","User","Modal",function(a,b,c,d,e,f,g,h,i,j){a.info.sdflow_id=b.flow_id,a.info.sdversion_id=b.version_id,a.data={user_list:[]},a.flow_info={nodeDataArray:[],linkDataArray:[]};var k=function(a){var b=a||5;c(function(){if($(".header_bg").offset()){var a=$(window).height()-$(".header_bg").offset().top-75;$(".dragMid").css("height",a),$(".grid_bg_detail").css("height",a-1),$(".job_div").css("height",a-31),$(".jobno_div").css("height",a)}},b)},l=function(){a.flow_info.link_list=a.flow_info.link_list||[];for(var b=0;b<a.flow_info.link_list.length;b++){var c=a.flow_info.link_list[b];c.visible&&(c.text=c.expr)}if(a.flow_info.linkDataArray=a.flow_info.link_list,a.flow_info.start_bk_datetime){var d=a.flow_info.start_bk_datetime;a.flow_info.start_bk_datetime_val=d.substring(0,4)+"年"+d.substring(5,7)+"月"+d.substring(8,10)}if(a.flow_info.end_bk_datetime){var e=a.flow_info.end_bk_datetime;a.flow_info.end_bk_datetime_val=e.substring(0,4)+"年"+e.substring(5,7)+"月"+e.substring(8,10)}var f=angular.copy(a.flow_info);if(f.cycle_info){if(1==f.cycle_info.cycle_type){if(f.cycle_info.customize_time_list){f.cycle_info.cycles=[];for(var b=0;b<f.cycle_info.customize_time_list.length;b++){var g=f.cycle_info.customize_time_list[b],h=g.substring(0,10),i=g.substring(11,13),j=g.substring(14,16),k=g.substring(0,4)+"年"+g.substring(5,7)+"月"+g.substring(8,10);f.cycle_info.cycles.push({ww:0,dd:0,mm:0,hh:i,mi:j,customize_times:"",date:h,date_str:k})}}}else 2==f.cycle_info.cycle_type?(f.cycle_info.cycles=f.cycle_info.cycleTimeBeen,f.cycle_info.time_unit=f.cycle_info.cycleTimeBeen[0].unit):3==f.cycle_info.cycle_type&&(f.cycle_info.cycles=[f.cycle_info.loop_time],f.cycle_info.time_unit=f.cycle_info.loop_time.unit);a.flow_info.cycle_info=f.cycle_info}},m=function(){i.getAllUserCanExec().then(function(b){a.data.user_list=b.user_dept_list||[],a.flow_info.exe_user_list=a.flow_info.exe_user_ids||[];for(var c=0;c<a.flow_info.exe_user_list.length;c++)for(var d=a.flow_info.exe_user_list[c],e=0;e<a.data.user_list.length;e++){var f=a.data.user_list[e];f.user_id===d&&(f.flag=!0)}},function(b){a.control.basic_saveing=!1,j.alert(b.message)})},n=function(){e.viewFlowDetailData(b.flow_id,b.version_id).then(function(b){angular.extend(a.flow_info,b.sdFlowJsonBean?b.sdFlowJsonBean:{}),a.flow_info.exe_user_ids=a.flow_info.exe_user_ids?a.flow_info.exe_user_ids:a.info.exe_user_ids?a.info.exe_user_ids.split(","):[],a.flow_info.nodeDataArray=a.flow_info.sd_node_list||[];for(var c=0;c<a.flow_info.nodeDataArray.length;c++){var d=a.flow_info.nodeDataArray[c];d.category=d.category.toString(),d.isGroup=d.is_group,d.group=d.group<0?-d.group:d.group,d.key=d.key<0?-d.key:d.key;var e=d.sd_job_bean;e&&e.datetime_condition&&(e.date_condition=e.datetime_condition.substring(0,10),e.h_condition=e.datetime_condition.substring(11,13),e.m_condition=e.datetime_condition.substring(14,16))}l(),m(),k(50)},function(a){j.alert(a.message)})};a.config=function(b){var c={linkDataArray:a.flow_info.linkDataArray,nodeDataArray:a.flow_info.nodeDataArray};d.go("dispatch_flow_detail.config",{config_data:c,node_obj:b})},a.configTime=function(b){var c=angular.copy(a.flow_info);if(c.cycle_info)if(c.cycle_info.cycles=[],1==c.cycle_info.cycle_type){if(c.cycle_info.customize_time_list)for(var d=0;d<c.cycle_info.customize_time_list.length;d++){var e=c.cycle_info.customize_time_list[d].substring(0,10),f=c.cycle_info.customize_time_list[d].substring(0,4)+"年"+c.cycle_info.customize_time_list[d].substring(5,7)+"月"+c.cycle_info.customize_time_list[d].substring(8,10),g=c.cycle_info.customize_time_list[d].substring(11,13),h=c.cycle_info.customize_time_list[d].substring(14,16);c.cycle_info.cycles.push({ww:0,dd:0,mm:0,hh:g,mi:h,customize_times:"",date:e,date_str:f})}}else 2==c.cycle_info.cycle_type?(c.cycle_info.cycles=c.cycle_info.cycleTimeBeen,c.cycle_info.time_unit=c.cycle_info.cycleTimeBeen[0].unit):(c.cycle_info.cycles=[c.cycle_info.loop_time],c.cycle_info.time_unit=c.cycle_info.loop_time.unit);else c.cycle_info={};c.view_flag=b,j.configFlowTime(c).then(function(a){})},a.configUser=function(){a.control.user_config_show=!a.control.user_config_show},a.togledetail=function(){a.control.show_basic_detail=!a.control.show_basic_detail,k(800)},$(window).resize(function(){k()}),n()}]),flow.controller("flowAttributeCtrl",["$scope","$stateParams","$timeout","$state","Flow","FlowType","Scene","Strategy","JobErrorType","PreJobErrorType","ParamValueSource","FlowJobType","CodeMirrorOption","CmptFunc","ProtocolType","CommData","RequestMethod","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=[1,2,3,5];a.data={error_handle_list:i,pre_error_handle_list:j,param_source_list:k,request_method_list:q,linkDataArray:b.config_data?b.config_data.linkDataArray:[],nodeDataArray:b.config_data?b.config_data.nodeDataArray:[]},a.info={current_node:{},attr_data:{}},a.config={drag_right_scroll:r};var v=function(b){b=b||{},a.jobForm&&a.jobForm.$setPristine(),a.info.attr_data={is_special_element:b.is_special_element||!1,exec_script:b.exec_script||"",business_sys_name:b.business_sys_name||"",script_source:b.script_source||1,sql_source:b.sql_source||1,script_file_name:b.script_file_name||"",dataBase_type:b.dataBase_type||1,service_name:b.service_name||"",service_ip:b.service_ip||"",service_url:b.service_url||"",service_port:b.service_port||"",service_comm_info:b.service_comm_info||{},config:b.config||!1,comp_cn_name:b.comp_cn_name||"",sdwork_cn_name:b.sdwork_cn_name||"",job_bk_desc:b.job_bk_desc||"",over_type:b.over_type||1,comp_id:b.comp_id||"",input:b.input||[],comp_impl_type:b.comp_impl_type||"",datetime_condition:b.datetime_condition||"",date_condition:b.date_condition||"",h_condition:b.h_condition||"",m_condition:b.m_condition||"",timeused:b.timeused||"",pre_job_list:b.pre_job_list||[],timeout:b.timeout||"",error_handle:b.error_handle||1,retry_interval:b.retry_interval||"",retry_times:b.retry_times||"",source_list:b.source_list||[],pre_job_basic_data:b.pre_job_basic_data||[],ref_job_list:b.ref_job_list||[],ref_job_param_list:b.ref_job_param_list||[],polling_interval:b.polling_interval||"",polling_max_times:b.polling_max_times||"",output:b.output||[],expr:b.expr||"",result_judge:b.result_judge||"",job_method:b.job_method||0,env_name:b.env_name||"",language_name:b.language_name||"",language_version:b.language_version||"",operating_system:b.operating_system||"",bit_number:b.bit_number||"",annex_file:b.annex_file||"",plugin_list:b.plugin_list||[],command:b.command||{},request_method:b.request_method||1}},w=function(b){var c="",d=[];a.info.current_node=b,a.control.job_config=!0,a.info.current_node.templateLib_type_cn=t.findValue(b.type,l),6==b.type?a.data.error_handle_list=[{key:1,value:"等待"},{key:2,value:"跳过"}]:a.data.error_handle_list=i,b.sd_job_bean.job_id?v(b.sd_job_bean):b.sd_job_bean.sdwork_cn_name?v(b.sd_job_bean):v(),a.info.attr_data.job_id=b.key;for(var e=0;e<a.data.linkDataArray.length;e++){var f=a.data.linkDataArray[e];b.group?f.to==b.group&&(c=f.from,d.push(c)):f.to==b.key&&(c=f.from,d.push(c))}var g=function(b){if(b||0===b)for(var c=0;c<a.data.linkDataArray.length;c++){var e=a.data.linkDataArray[c];if(b==e.to){d.push(e.from),g(e.from);break}}};g(c),a.info.attr_data.pre_job_basic_data=[],a.info.attr_data.ref_job_list=[],a.info.attr_data.ref_node_list=[];for(var h=0;h<d.length;h++)for(var j=d[h],e=0;e<a.data.nodeDataArray.length;e++){var k=a.data.nodeDataArray[e];if(k.sd_job_bean){var m=k.sd_job_bean.job_id||"",n=k.text,o=k.sd_job_bean.source_list?k.sd_job_bean.source_list:[];(k.key!=j||4!=k.type)&&k.key==j&&3!=k.type&&(a.info.attr_data.pre_job_basic_data.push({job_id:m,sdwork_cn_name:n}),a.info.attr_data.ref_job_list.push({job_id:m,sdwork_cn_name:n,source_list:o}))}}if(b.sd_job_bean.input){var p=b.sd_job_bean.input.length;if(0===p)return;for(var q=0;p>q;q++){var r=b.sd_job_bean.input[q];2==r.param_source&&r.ref_job_id&&a.getRefJobParme(r.ref_job_id,r,!0)}}},x=function(a){var b=a||0;c(function(){if($(".header_bg").offset()){var a=$(window).height()-$(".header_bg").offset().top-75;$(".grid_bg").css("height",a),$(".job_div").css("height",a-31-58),$(".jobno_div").css("height",a-1)}},b)},y=function(){b.node_obj&&w(b.node_obj),x(200)};a.dispatchParamShellLoaded=function(b){m.getDynamicRefParams(b),a.$watch("info.attr_data",function(c,d){if(-1==u.indexOf(a.info.current_node.type)){var e=[],f=[];f=4==a.info.current_node.type?angular.copy(c.input):angular.copy(c.output),angular.forEach(f,function(a,b,c){a.param_name&&e.push({key:"${"+a.param_name+"}",text:"${"+a.param_name+"}["+a.param_cn_name+"]"})}),m.getDynamicRefParams(b,e)}},!0)},a.startAddSoc=function(){a.info.attr_data.input.push({param_name:"",param_cn_name:"",param_value:""})},a.removeStartSoc=function(b){a.info.attr_data.input.splice(b,1)},a.addPrivateElement=function(){var b={type:a.info.current_node.type,element_info:a.info.attr_data};s.convertPrivateEle(b).then(function(b){if(b){var c=b.element_info.sdwork_cn_name||"";a.$emit("addPalette",b),s.alert("私有元素 [ "+c+" ] 添加成功")}})},a.addInputParam=function(b){a.info.attr_data.input.push({param_name:"",param_cn_name:"",param_source:b?b:1,param_value:""})},a.removeInputParam=function(b){a.info.attr_data.input.splice(b,1)},a.selectErrorHandle=function(b){3===b&&(a.info.attr_data.retry_times=3,a.info.attr_data.retry_interval=4)},a.addPreJobList=function(){a.info.attr_data.pre_job_list.push({job_id:"",sdwork_cn_name:"",error_handle:1})},a.removePreJob=function(b){a.info.attr_data.pre_job_list.splice(b,1)},a.choosePreJob=function(b,c){for(var d=0;d<a.info.attr_data.pre_job_basic_data.length;d++)a.info.attr_data.pre_job_basic_data[d].job_id==b&&(c.sdwork_cn_name=a.info.attr_data.pre_job_basic_data[d].sdwork_cn_name)},a.setTimeCondition=function(){var b={date_str:a.info.attr_data.date_condition,h_condition:a.info.attr_data.h_condition,m_condition:a.info.attr_data.m_condition};s.configFlowTimeCondition(b).then(function(b){if(b){var c=b.date.getMonth()+1<10?"0"+(b.date.getMonth()+1):b.date.getMonth()+1,d=b.date.getDate()<10?"0"+b.date.getDate():b.date.getDate();a.info.attr_data.date_condition=b.date.getFullYear()+"-"+c+"-"+d,a.info.attr_data.h_condition=b.hh,a.info.attr_data.m_condition=b.mm}})},a.getRefJobParme=function(b,c,d){c.is_no_node=!1,d||(c.ref_job_list=[],c.ref_param_name=""),4==a.info.current_node.type&&(c.param_source=2);for(var e=0;e<a.data.nodeDataArray.length;e++){var f=a.data.nodeDataArray[e];f.sd_job_bean&&f.sd_job_bean.job_id==b&&((1==f.type||f.type>23&&f.type<28)&&(c.is_no_node=!0),a.info.attr_data.ref_job_param_list=f.sd_job_bean.output?f.sd_job_bean.output:[],a.info.attr_data.ref_node_list=f.sd_job_bean.source_list?f.sd_job_bean.source_list:[])}},a.addSoc=function(){c(function(){a.info.attr_data.source_list.push({ip:"",soc_name:"",ip2:"",soc_name2:""})},0)},a.removeOneSoc=function(b){a.info.attr_data.source_list.splice(b,1)},a.noSelectJobHeight=function(){var a=$(".dragMid").height();return{height:a?a-1:0}},a.getProtocolTypeCnName=function(a){return t.findValue(a,o).substring(0,5).toLowerCase()},a.configSoc=function(b){var c=b;(14==a.info.current_node.type||15==a.info.current_node.type)&&(c=""),s.configDataSource(c,"",a.info.attr_data.source_list,2).then(function(c){for(var d=[],e=0;e<c.length;e++)b>2&&6>b?c[e].exe_soc_name&&c[e].ver_soc_name&&d.push(c[e]):c[e].exe_soc_name&&d.push(c[e]);a.info.attr_data.source_list=d})},a.selectRefNode=function(b){b.ref_job_list=b.ref_job_list||[],s.selectFlowRefNode(b.ref_job_list,a.info.attr_data.ref_node_list).then(function(a){a&&(b.ref_job_list=a)})},a.setJobMethod=function(){var b=a.info.attr_data.is_special_element||!1;s.setFlowJobMethod(a.info.current_node.type,a.info.attr_data,!1,b).then(function(b){if(a.info.attr_data.job_method=b.job_method,1==b.job_method)a.info.attr_data.comp_id=b.comp_id,a.info.attr_data.comp_impl_type=b.impl_type,a.info.attr_data.comp_cn_name=b.comp_cn_name,a.info.attr_data.input=b.input||[],a.info.attr_data.output=b.output||[],a.info.attr_data.exec_script=b.exec_script,a.info.attr_data.script_source=b.script_source,a.info.attr_data.env_name=b.env_name,a.info.attr_data.language_name=b.language_name,a.info.attr_data.language_version=b.language_version,a.info.attr_data.operating_system=b.operating_system,a.info.attr_data.bit_number=b.bit_number,a.info.attr_data.plugin_list=b.plugin_list,a.info.attr_data.annex_file=b.annex_file;else{a.info.attr_data.comp_id="",a.info.attr_data.comp_impl_type=b.impl_type,a.info.attr_data.output=b.output?b.output:[],a.info.attr_data.input=b.param_list,a.info.attr_data.exec_script=b.exec_script,a.info.attr_data.business_sys_name=b.business_sys_name,a.info.attr_data.script_source=b.script_source,a.info.attr_data.sql_source=b.sql_source,a.info.attr_data.script_file_name=b.script_file_name,a.info.attr_data.dataBase_type=b.dataBase_type,a.info.attr_data.service_name=b.service_name,a.info.attr_data.service_port=b.service_port,a.info.attr_data.service_ip=b.service_ip,a.info.attr_data.service_url=b.service_url,a.info.attr_data.env_name=b.env_name,a.info.attr_data.language_name=b.language_name,a.info.attr_data.language_version=b.language_version,a.info.attr_data.operating_system=b.operating_system,a.info.attr_data.bit_number=b.bit_number,a.info.attr_data.plugin_list=b.plugin_list,a.info.attr_data.annex_file=b.annex_file,a.info.attr_data.request_method=b.request_method||1,b.command&&b.command.cmds&&(a.info.attr_data.command.exec_script=n.cmdsToString(b.command.cmds));for(var c=0;c<a.info.attr_data.input.length;c++)a.info.attr_data.input[c].param_source=1}})},a.saveJobConfig=function(){if(!t.valiForm(a.jobForm))return!1;if(25==a.info.current_node.type){if(!a.info.attr_data.service_ip)return void s.alert("请设置作业方式");a.info.attr_data.service_comm_info=p}if(24==a.info.current_node.type||26==a.info.current_node.type){if(!a.info.attr_data.service_name)return void s.alert("请设置作业方式");a.info.attr_data.service_comm_info=p}if(""!=a.info.attr_data.h_condition||""!=a.info.attr_data.m_condition)var b=1==a.info.attr_data.h_condition.length?"0"+a.info.attr_data.h_condition:a.info.attr_data.h_condition,d=1==a.info.attr_data.m_condition.length?"0"+a.info.attr_data.m_condition:a.info.attr_data.m_condition;else b="00",d="00";if(a.info.attr_data.date_condition){if(b>23)return s.alert("时间条件小时输入有误，请重新输入"),!1;if(d>59)return s.alert("时间条件分钟输入有误，请重新输入"),!1;a.info.attr_data.datetime_condition=a.info.attr_data.date_condition+" "+b+":"+d+":00"}1==a.info.current_node.type&&(a.info.attr_data.sdwork_cn_name="开始",a.info.attr_data.output=a.info.attr_data.input||[]),2==a.info.current_node.type&&(a.info.attr_data.sdwork_cn_name="结束",a.info.attr_data.output=a.info.attr_data.input||[]);for(var e=0;e<a.data.nodeDataArray.length;e++)a.data.nodeDataArray[e].key==a.info.current_node.key&&(a.data.nodeDataArray[e].text=a.info.attr_data.sdwork_cn_name,a.data.nodeDataArray[e].sd_job_bean=a.info.attr_data,a.data.nodeDataArray[e].sd_job_bean.config=!0);a.control.reflash_node=!a.control.reflash_node,a.control.job_config=!1,c(function(){var a=$(window).height()-$(".header_bg").offset().top-55;$(".jobno_div").css("height",a-1)},10),v()},a.cancelJobConfig=function(){a.control.job_config=!1,c(function(){var a=$(window).height()-$(".header_bg").offset().top-55;$(".jobno_div").css("height",a-1)},10)},$(window).resize(function(){x()}),y()}]),flow.controller("flowAttributeDetailCtrl",["$scope","$stateParams","$timeout","$state","Flow","FlowType","Scene","Strategy","JobErrorType","PreJobErrorType","ParamValueSource","FlowJobType","CodeMirrorOption","CmptFunc","ProtocolType","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){a.info={current_node:{},attr_data:{}},a.data={error_handle_list:i,pre_error_handle_list:j,param_source_list:k,linkDataArray:b.config_data?b.config_data.linkDataArray:[],nodeDataArray:b.config_data?b.config_data.nodeDataArray:[]},a.config={scroll_bar:p},a.result_options=m.Sh(!0);var s=function(b){b=b||{},a.info.attr_data={exec_script:b.exec_script?b.exec_script:"",business_sys_name:b.business_sys_name?b.business_sys_name:"",script_source:b.script_source?b.script_source:1,sql_source:b.sql_source?b.sql_source:1,script_file_name:b.script_file_name?b.script_file_name:"",dataBase_type:b.dataBase_type?b.dataBase_type:1,service_name:b.service_name?b.service_name:"",config:b.config?b.config:!1,comp_cn_name:b.comp_cn_name?b.comp_cn_name:"",sdwork_cn_name:b.sdwork_cn_name?b.sdwork_cn_name:"",job_bk_desc:b.job_bk_desc?b.job_bk_desc:"",over_type:b.over_type?b.over_type:1,comp_id:b.comp_id?b.comp_id:"",input:b.input?b.input:[],comp_impl_type:b.comp_impl_type?b.comp_impl_type:"",datetime_condition:b.datetime_condition?b.datetime_condition:"",date_condition:b.date_condition?b.date_condition:"",h_condition:b.h_condition?b.h_condition:"",m_condition:b.m_condition?b.m_condition:"",timeused:b.timeused?b.timeused:"",pre_job_list:b.pre_job_list?b.pre_job_list:[],timeout:b.timeout?b.timeout:"",error_handle:b.error_handle?b.error_handle:1,retry_interval:b.retry_interval?b.retry_interval:"",retry_times:b.retry_times?b.retry_times:"",source_list:b.source_list?b.source_list:[],pre_job_basic_data:b.pre_job_basic_data?b.pre_job_basic_data:[],ref_job_list:b.ref_job_list?b.ref_job_list:[],ref_job_param_list:b.ref_job_param_list?b.ref_job_param_list:[],ref_node_list:b.ref_node_list?b.ref_node_list:[],output:b.output?b.output:[],expr:b.expr?b.expr:"",result_judge:b.result_judge?b.result_judge:"",job_method:b.job_method?b.job_method:1,env_name:b.env_name?b.env_name:"",language_name:b.language_name?b.language_name:"",language_version:b.language_version?b.language_version:"",operating_system:b.operating_system?b.operating_system:"",bit_number:b.bit_number?b.bit_number:"",annex_file:b.annex_file?b.annex_file:"",plugin_list:b.plugin_list?b.plugin_list:[],request_method:b.request_method?b.request_method:1}},t=function(b){var c="",d=[],e=!1;a.info.current_node=b,b.sd_job_bean.job_id?(s(b.sd_job_bean),a.info.attr_data.job_id=b.sd_job_bean.job_id):s();for(var f=0;f<a.data.linkDataArray.length;f++)b.group?a.data.linkDataArray[f].to==b.group&&(c=a.data.linkDataArray[f].from,d.push(c)):a.data.linkDataArray[f].to==b.key&&(c=a.data.linkDataArray[f].from,d.push(c));var g=function(b){for(var c=0;c<a.data.linkDataArray.length;c++)if(b==a.data.linkDataArray[c].to){d.push(a.data.linkDataArray[c].from),g(a.data.linkDataArray[c].from);break}};g(c),a.info.attr_data.pre_job_basic_data=[],a.info.attr_data.ref_job_list=[];for(var f=0;f<d.length;f++){for(var h=d[f],i=0;i<a.data.nodeDataArray.length;i++){var j=a.data.nodeDataArray[i];if(j.sd_job_bean){if(j.key==h&&4==j.type){e=!0;break}if(j.key==h&&3!=j.type&&1!=j.type){var k=j.sd_job_bean.job_id||"",l=j.text;a.info.attr_data.pre_job_basic_data.push({job_id:k,sdwork_cn_name:l}),a.info.attr_data.ref_job_list.push({job_id:k,sdwork_cn_name:l})}if(j.group==h){var k=j.sd_job_bean.job_id||"",l=j.sd_job_bean.text;a.info.attr_data.pre_job_basic_data.push({job_id:k,sdwork_cn_name:l}),a.info.attr_data.ref_job_list.push({job_id:k,sdwork_cn_name:l})}}}if(e)break}u(100)},u=function(a){var b=a||0;c(function(){if($(".header_bg").offset()){var a=$(window).height()-$(".header_bg").offset().top-75;$(".grid_bg_detail").css("height",a-1),$(".right_config_div").css("height",a-30)}},b)},v=function(){u(),b.node_obj&&t(b.node_obj)};a.paramShellLoaded=function(a){m.setParamsEditor(a)},a.getProtocolTypeCnName=function(a){return r.findValue(a,o).substring(0,5).toLowerCase()},a.errorHandleTOCn=function(a){return a?r.findValue(a,i):"--"},$(window).resize(function(){u()}),v()}]),flow.controller("flowListCtrl",["$scope","$stateParams","$timeout","$state","ScrollBarConfig","Modal",function(a,b,c,d,e,f){a.control={active_tab:b.active_name||"handle"},a.flow_list_reflash={flag:!1},a.tabs=[],a.tabs.handle={type:1,dispatch:!0},a.tabs.auto={type:2,dispatch:!0},a.tabs.attention={type:"",dispatch:!1},a.flow_list_scroll=e.Y(),a.switchTab=function(b){a.control.active_tab=b,d.go("dispatch_flow_list",{active_name:b})},a.viewDetail=function(b,c){d.go("dispatch_flow_list.flow_info",{active_name:a.control.active_tab,flow_id:b,version_id:c})},a.calculateFlowinfoHeight=function(){return{height:$(".ui-view-content").height()-135}},a.calculateFlowListHeight=function(){return{height:$(".ui-view-content").height()-70}},$(window).resize(function(){c(function(){a.calculateFlowinfoHeight(),a.calculateFlowListHeight()},50)})}]),flow.controller("flowListInfoCtrl",["$scope","$stateParams","$timeout","$state","Flow","FlowType","Scene","Strategy","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=b.flow_id,l=b.version_id;a.info={basic:{flow_type_list:[]},flow:{}},angular.extend(a.control,{is_publish:!1,show_config:!1,error:!1,focus_flag:!1,hand_up:!1});var m=function(){e.viewFlowBasicInfo(k,l).then(function(b){angular.extend(a.info.basic,b.basicInfo),a.control.is_publish=1==a.info.basic.sdflow_status?!1:!0,a.info.basic.sdflow_type&&1!=a.info.basic.sdflow_type.length?a.info.basic.flow_type_list=a.info.basic.sdflow_type.split(","):a.info.basic.flow_type_list=[a.info.basic.sdflow_type];for(var c=0;c<a.info.basic.flow_type_list.length;c++)a.info.basic.flow_type_list[c]=j.findValue(a.info.basic.flow_type_list[c],f);a.control.show_modify=!1,a.control.error=!1,a.control.focus_flag=a.info.basic.focus_flag||!1,a.control.hand_up=3==parseInt(a.info.basic.sdflow_status)?!0:!1},function(b){a.control.error=!0}),e.viewFlowDetailData(k,l).then(function(b){a.info.flow=b.sdFlowJsonBean?b.sdFlowJsonBean:{},b.sdFlowJsonBean&&(a.info.basic.user_cn_names=b.sdFlowJsonBean.user_cn_names||b.sdFlowJsonBean.exe_user_ids),a.info.flow.nodeDataArray=a.info.flow.sd_node_list||[],a.info.flow.link_list=a.info.flow.link_list||[];for(var c=0;c<a.info.flow.nodeDataArray.length;c++){var d=a.info.flow.nodeDataArray[c];d.category=d.category.toString(),d.isGroup=d.is_group,d.group=d.group<0?-d.group:d.group}for(var c=0;c<a.info.flow.link_list.length;c++){var e=a.info.flow.link_list[c];e.visible&&(e.text=e.expr)}if(a.info.flow.linkDataArray=a.info.flow.link_list,a.info.flow.start_bk_datetime){var f=a.info.flow.start_bk_datetime;a.info.flow.start_bk_datetime_val=f.substring(0,4)+"年"+f.substring(5,7)+"月"+f.substring(8,10)}if(a.info.flow.end_bk_datetime){var g=a.info.flow.end_bk_datetime;a.info.flow.end_bk_datetime_val=g.substring(0,4)+"年"+g.substring(5,7)+"月"+g.substring(8,10)}},function(b){a.control.error=!0})},n=function(){k&&l&&m()};a.configTime=function(b){var c=angular.copy(a.info.flow);if(c.cycle_info.cycles=[],1==c.cycle_info.cycle_type){if(c.cycle_info.customize_time_list)for(var d=0;d<c.cycle_info.customize_time_list.length;d++){var e=c.cycle_info.customize_time_list[d],f=e.substring(0,10),g=e.substring(0,4)+"年"+e.substring(5,7)+"月"+e.substring(8,10),h=e.substring(11,13),j=e.substring(14,16);c.cycle_info.cycles.push({ww:0,dd:0,mm:0,hh:h,mi:j,customize_times:"",date:f,date_str:g})}}else 2==c.cycle_info.cycle_type?(c.cycle_info.cycles=c.cycle_info.cycleTimeBeen||[],c.cycle_info.time_unit=c.cycle_info.cycleTimeBeen?c.cycle_info.cycleTimeBeen[0].unit:0):(c.cycle_info.cycles=[c.cycle_info.loop_time],c.cycle_info.time_unit=c.cycle_info.loop_time.unit);c.view_flag=b,i.configFlowTime(c)},a.removeDetail=function(){i.confirm("确认删除["+a.info.basic.sdflow_cn_name+"]流程？").then(function(b){b&&e.deleteOpFlow(a.info.basic.sdflow_id,a.info.basic.sdversion_id).then(function(b){a.flow_list_reflash.flag=!a.flow_list_reflash.flag,a.info={basic:{},flow:{}},a.sdflow_id=""},function(a){i.alert(a.message)})})},a.showModify=function(){a.control.show_modify=!a.control.show_modify},a.attentionFlow=function(){a.control.focus_flag=!a.control.focus_flag,e.attentionFlow(a.info.basic.sdflow_id,a.control.focus_flag,a.info.basic.sdversion_id).then(function(b){a.flow_list_reflash.flag=!a.flow_list_reflash.flag,a.control.focus_flag?i.alert("关注成功"):i.alert("取消关注成功")},function(b){i.alert(b.message),a.control.focus_flag=!a.control.focus_flag})},a.handleUpOrDownFlow=function(b){a.control.is_publish?e.handleUpOrDownflow(a.info.basic.sdflow_id,b,a.info.basic.sdversion_id).then(function(c){1==b?(a.control.hand_up=!a.control.hand_up,i.alert("挂起成功")):(a.control.hand_up=!a.control.hand_up,i.alert("解挂成功")),a.flow_list_reflash.flag=!a.flow_list_reflash.flag},function(b){i.alert(b.message),a.control.focus_flag=!a.control.focus_flag}):i.alert("流程未发布！")},a.pubFlow=function(){for(var b=!1,c=!0,d=0;d<a.info.flow.nodeDataArray.length;d++){var f=a.info.flow.nodeDataArray[d];if(!f.isGroup&&!f.sd_job_bean.job_id){b=!0;break}1!=f.type&&2!=f.type&&(c=!1)}b||c?i.alert("流程未完善,不可发布！"):i.publishReasonModal().then(function(b){e.publishFlow(a.info.basic.sdflow_id,a.info.flow.sdversion_id,b).then(function(b){a.control.is_publish=!0,a.flow_list_reflash.flag=!a.flow_list_reflash.flag},function(a){i.alert(a.message)})})},a.executeFlow=function(){e.getOptaskId(a.info.basic.sdflow_id,a.info.flow.sdversion_id).then(function(a){var b=a.task_id?a.task_id:"";d.go("dispatch_task.execute",{task_id:b})},function(a){i.alert(a.message)})},a.calculateHeight=function(){return{height:$(".flow-info-view").height()-140}},a.mouseEnterPopover=function(){$(".flowtype_popover").css("display","block")},a.mouseLeavePopover=function(){$(".flowtype_popover").css("display","none")},n()}]);var task=angular.module("dispatchTaskController",[]);task.controller("taskListCtrl",["$scope","$stateParams","$timeout","$state","$location","FlowType","ExecuteType","User","Modal",function(a,b,c,d,e,f,g,h,i){var j=e.absUrl(),k=new Date;a.control={active_tab:j.slice(j.lastIndexOf("/")+1),open_senior_flag:!1,search_keyword:"",datepicker_open:!1},a.data={user_list:[],task_type_list:f,execute_type_list:g},a.info={key_word:"",start_date:"",end_date:"",exe_user_id:"",exe_type:"",task_type:"",task_name:""},a.switchTab=function(b){a.control.active_tab=b,d.go("dispatch_task_list."+b)};var l=function(){k.setDate(k.getDate()),a.maxDate=k,h.getAllUserCanExec().then(function(b){a.data.user_list=b.user_dept_list?b.user_dept_list:[]},function(a){i.alert(a.message)})};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.control.datepicker_open=!0},a.selectDate=function(){""!=a.info.startDate&&""!=a.info.endDate&&(a.control.datepicker_open=!1)},l()}]),task.controller("taskCommonCtrl",["$scope",function(a){a.control={basic_info_expand:!1}}]),task.controller("taskBasicInfoCtrl",["$scope","$rootScope","$stateParams","$timeout","$state","Flow","FlowType","OpTaskExeStatus","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){
var k=c.task_id||"";a.info={flow_id:"",task_cn_name:"",task_type_cn:"",exe_types:0,exe_user_name:"",task_status:0};var l=function(){f.viewTaskDetail(k).then(function(b){a.info.task_status=b.taskBean.sdtask_status,a.info.task_state_cn=j.findValue(b.taskBean.sdtask_status,h),a.info.version_id=b.taskBean.sdversion_id?b.taskBean.sdversion_id:"",a.info.task_id=b.taskBean.sdtask_id,a.info.task_cn_name=b.taskBean.sdtask_cn_name,a.info.end_bk_datetime=b.taskBean.end_bk_datetime?b.taskBean.end_bk_datetime.substring(b.taskBean.end_bk_datetime.lastIndexOf("."),-1):"",a.info.start_bk_datetime=b.taskBean.start_bk_datetime?b.taskBean.start_bk_datetime.substring(b.taskBean.start_bk_datetime.lastIndexOf("."),-1):"",a.info.exe_types=b.taskBean.sddispatch_type?b.taskBean.sddispatch_type:0,a.info.time_used=b.taskBean.time_used?j.usedCnTime(b.taskBean.time_used):"--",a.info.exe_user_name=b.taskBean.exe_user_name?b.taskBean.exe_user_name:b.taskBean.exe_user_id?b.taskBean.exe_user_id:"--",b.taskBean.sdflow_type&&(a.info.task_type=b.taskBean.sdflow_type.split(","),angular.forEach(a.info.task_type,function(b){a.info.task_type_cn+=j.findValue(b,g)+" "}))},function(a){i.alert(a.message),e.go("dispatch_task_list.cur_task")})};l()}]),task.controller("taskExecuteCtrl",["$scope","$rootScope","$stateParams","$timeout","$interval","$state","Flow","FlowType","OpTaskExeStatus","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r,s,t,u=c.task_id||"";angular.extend(a.control,{one_exec_btn:!1,step_exec_btn:!1,close_task:!1,middle_stop:!1,suspend_task:!1,one_click:!1,clear_click_event:!1}),a.info={flow_id:"",exe_types:0,exe_start_datetime:"",exe_end_datetime:"",flow_job_list:[],task_status:0,job_id_list:[],exe_log_path:"",flow_diagram_info:{}};var v=function(){if(0!==a.info.job_id_list.length){var b=a.info.job_id_list.slice(1);p=e(function(){g.monitorJobStatus(u,b).then(function(b){a.info.task_status=b.task_status,a.info.task_state_cn=k.findValue(b.task_status,i),11!==a.info.task_status&&(e.cancel(p),8===a.info.task_status?(a.control.one_exec_btn=!1,a.control.step_exec_btn=!1):(a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,E(-1)))},function(a){})},2e3)}},w=function(a,b){return b=b||[],1===a?!0:b.some(function(a){return 2===a.job_status})},x=function(b,c){var f=c.sd_job_bean.input||[],h=c.sd_job_bean.job_id||"1",i=6==b?0:-1,k=6==b;j.inputStartJobParams(f).then(function(c){c&&g.saveTaskInputParam(u,h,c).then(function(c){s=2,6==b&&(a.info.job_id_list=[h]),a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,a.control.close_task=!1,a.control.one_click=6!=b,g.meddleTaskExecute(u,b).then(function(a){d(function(){console.log("干预成功")},0)},function(b){j.alert(b.message),a.control.one_exec_btn=!1,a.control.step_exec_btn=!1,a.control.middle_stop=!1,a.control.suspend_task=!1,l&&e.cancel(l)}),D(),E(i,!1,k)},function(a){j.alert(a.message)})})},y=function(){var a=!1,b=q.sd_job_bean.job_status||0,c=r.sd_job_bean.job_status||0;return(2===b||2===c)&&(a=!0),a},z=function(a){var b=a||[];return b.some(function(a){return 2===a.job_status})},A=function(b,c){g.meddleTaskExecute(u,b).then(function(a){},function(b){j.alert(b.message),a.control.close_task=!0,e.cancel(n),a.info.task_state_cn=c})},B=function(c){a.info.job_id_list=L(),0!==a.info.job_id_list.length&&(n&&e.cancel(n),n=e(function(){g.monitorJobStatus(u,a.info.job_id_list).then(function(d){a.info.task_status=d.task_status;var f=d.job_status_list?d.job_status_list:[],g=a.info.flow_diagram_info.nodeDataArray.length;if(b.dispatch_task_status=0,g>0)for(var h=0;h<f.length;h++)for(var l=f[h],m=0;g>m;m++){var o=a.info.flow_diagram_info.nodeDataArray[m];3!=o.type&&o.sd_job_bean.job_id==l.job_id&&(o.sd_job_bean.job_status=l.job_status?l.job_status:1)}1==c?(4==a.info.task_status||5==a.info.task_status)&&(e.cancel(n),a.control.close_task=!1,M(),j.alert("任务关闭完成"),a.info.task_state_cn=k.findValue(a.info.task_status,i),b.dispatch_task_status=a.info.task_status):(2==c||5==c)&&(7==a.info.task_status||3==a.info.task_status||10==a.info.task_status?(a.info.task_state_cn=k.findValue(a.info.task_status,i),b.dispatch_task_status=a.info.task_status,3==a.info.task_status||10==a.info.task_status?(a.control.close_task=!0,2==c?e.cancel(n):z(f)||e.cancel(n)):(a.control.middle_stop=!1,a.control.one_exec_btn=!1,a.control.step_exec_btn=2==a.info.exe_types,F()&&(e.cancel(n),a.control.close_task=!0,j.alert("任务已暂停")))):8==a.info.task_status&&(z(f)||(e.cancel(n),a.control.one_exec_btn=!1,a.control.step_exec_btn=!1,a.info.task_state_cn=k.findValue(a.info.task_status,i),b.dispatch_task_status=a.info.task_status))),a.control.close_task=1!=c},function(a){})},3e3))},C=function(a){a.timer&&e.cancel(a.timer),a.width&&a.width>=110||(a.timer=e(function(){a.width+=~~(8*Math.random())},1e3))},D=function(c,d,f,h){0!==a.info.job_id_list.length&&g.monitorJobStatus(u,a.info.job_id_list).then(function(c){a.info.task_status=c.task_status,a.info.task_state_cn=k.findValue(c.task_status,i);var g=a.info.task_status,m=!0,n=c.job_status_list?c.job_status_list:[];if(d&&7==g&&(g=2==a.info.exe_types?1:8,a.info.task_state_cn=2==a.info.exe_types?"执行中":"手动等待"),!t&&f||!t&&d)t=w(g,n);else{d&&(g=a.info.task_status);var o=a.info.flow_diagram_info.nodeDataArray.length;if(o>0){for(var p=0;p<n.length;p++)for(var q=n[p],r=0;o>r;r++){var s=a.info.flow_diagram_info.nodeDataArray[r];3!=s.type&&s.sd_job_bean.job_id==q.job_id&&(s.sd_job_bean.job_status=q.job_status?q.job_status:1,s.sd_job_bean.width=s.sd_job_bean.width?s.sd_job_bean.width:0,2==s.sd_job_bean.job_status?(C(s.sd_job_bean),s.sd_job_bean.width>=100&&(s.sd_job_bean.width=110,s.sd_job_bean.timer&&e.cancel(s.sd_job_bean.timer))):3==s.sd_job_bean.job_status||5==s.sd_job_bean.job_status?(s.sd_job_bean.width=120,s.sd_job_bean.timer&&e.cancel(s.sd_job_bean.timer)):(4==s.sd_job_bean.job_status||7==s.sd_job_bean.job_status)&&(s.sd_job_bean.width=s.sd_job_bean.width?s.sd_job_bean.width:10,s.sd_job_bean.timer&&e.cancel(s.sd_job_bean.timer)),2==s.sd_job_bean.job_status&&7==g&&(m=!1))}1==a.info.flow_diagram_info.nodeDataArray[0].sd_job_bean.job_status&&(a.control.close_task=!0)}2==a.info.exe_types&&(a.control.step_exec_btn=!0,a.control.one_exec_btn=!0),7==g&&(a.control.one_exec_btn=!1,a.control.step_exec_btn=2==a.info.exe_types,m&&(l&&e.cancel(l),h||(a.control.close_task=!0,a.info.task_state_cn="任务暂停",j.alert("任务已暂停")))),(4==g||5==g)&&(a.control.close_task=!1,l&&e.cancel(l),M()),7!=g&&8!=g&&(a.control.one_exec_btn=!0,a.control.step_exec_btn=!0),a.control.suspend_task=(2==a.info.exe_types||a.control.one_click)&&(1==g||6==g),a.control.middle_stop=(1==g||6==g)&&!y(),a.control.close_task=3==g||g>6}f&&t&&(7==g||8==g)&&(a.control.one_exec_btn=!1,a.control.step_exec_btn=!1,e.cancel(l)),b.dispatch_task_status=a.info.task_status},function(a){})},E=function(b,c,d){l&&e.cancel(l),m&&e.cancel(m),0>b&&(a.info.job_id_list=L()),(d||c)&&(t=!1),l=e(function(){D(b,c,d)},4e3)},F=function(){for(var b=!0,c=a.info.flow_diagram_info.nodeDataArray.length,d=0;c>d;d++){var e=a.info.flow_diagram_info.nodeDataArray[d];3!=e.type&&e.sd_job_bean.job_status&&2==e.sd_job_bean.job_status&&(b=!1)}return b},G=function(b,c){I(b),a.info.task_state_cn="跳过等待",a.control.step_exec_btn=!0,a.control.one_exec_btn=!0,g.skipOneStepJob(u,c).then(function(a){d(function(){H(b)},0)},function(b){j.alert(b.message),l&&e.cancel(l),a.info.task_state_cn="执行异常"})},H=function(c,d){if(l&&e.cancel(l),o&&e.cancel(o),m&&e.cancel(m),c){var f=a.info.flow_diagram_info.nodeDataArray,h=f[c].sd_job_bean,n=0,p=0;o=e(function(){0!==a.info.job_id_list.length&&g.monitorJobStatus(u,[h.job_id]).then(function(g){var l=g.task_status,m=g.job_status_list?g.job_status_list:[];a.info.task_status=g.task_status;for(var q=0;q<m.length;q++){var r=m[q];if(h.job_id==r.job_id){(4==r.job_status||7==r.job_status)&&4!=f[c].type||d&&5==r.job_status?h.job_status=2:h.job_status=r.job_status?r.job_status:1;break}}5!=h.job_status||d||(n++,1===n&&j.alert("[ "+h.sdwork_cn_name+" ] 跳过完成")),3==h.job_status&&d&&(p++,1===p&&(h.width=120,j.alert("[ "+h.sdwork_cn_name+" ] 完成"))),(n||p)&&(e.cancel(o),1!=a.info.exe_types||a.control.one_click?E(-1):5!=l&&4!=l&&7!=l&&(a.control.one_exec_btn=!1,a.control.step_exec_btn=!1)),a.control.close_task=3==a.info.task_status||a.info.task_status>6,4===f[c].type&&(a.info.task_status=l),b.dispatch_task_status=a.info.task_status,a.info.task_state_cn=k.findValue(a.info.task_status,i)},function(a){})},3e3)}},I=function(b,c){var d=a.info.flow_diagram_info.nodeDataArray,e=d[b].sd_job_bean;e&&(c?12!=c&&(e.job_status=2,e.width=5):4!==d[b].type&&(e.job_status=2))},J=function(b,c,d,e){for(var f,g=0;g<d.length;g++){var h=d[g];if(10==e){if(b.job_id==h.job_id&&2==h.job_status){f=!0;break}}else if(11==e){if(b.job_id==h.job_id&&2==h.job_status&&(6==c||1==c)){f=!0;break}}else if(12==e){var i=a.info.flow_diagram_info.nodeDataArray;if(6==h.job_status||2==h.job_status)for(var j=0;j<i.length;j++){var k=i[j];if(3!=k.type&&k.sd_job_bean.job_id==h.job_id){f=!0,k.sd_job_bean.job_status=2!=h.job_status?6:2;break}}if(f)break}}return f},K=function(c,d){l&&e.cancel(l),m&&e.cancel(m);var f,h=a.info.flow_diagram_info.nodeDataArray[c].sd_job_bean,j=0;m=e(function(){0!==a.info.job_id_list.length&&g.monitorJobStatus(u,a.info.job_id_list).then(function(c){var g=c.task_status,l=c.job_status_list?c.job_status_list:[];if(f||(f=J(h,g,l,d)),f){for(var n=0;n<l.length;n++)for(var o=l[n],p=0;p<a.info.flow_diagram_info.nodeDataArray.length;p++){var q=a.info.flow_diagram_info.nodeDataArray[p];if(3!=q.type){var r=q.sd_job_bean;r.job_id==o.job_id&&(r.job_status=o.job_status?o.job_status:1,r.width=r.width?r.width:0,2==r.job_status?(C(r),r.width>=100&&(r.timer&&e.cancel(r.timer),r.width=110)):3==r.job_status||5==r.job_status?(r.timer&&e.cancel(r.timer),r.width=120):(4==r.job_status||7==r.job_status)&&(r.timer&&e.cancel(r.timer),r.width=r.width?r.width:10,3==g&&(a.control.close_task=!0)))}}10!=d||4!=h.job_status&&7!=h.job_status||(j++,1==j&&A(15,a.info.task_state_cn)),12==d&&(a.control.middle_stop=1==g||6==g),a.info.task_status=g,a.info.task_state_cn=k.findValue(g,i),7==a.info.task_status&&10==d&&(a.info.task_state_cn="重试等待"),2!=h.job_status||10!=d&&11!=d||(a.info.task_state_cn=10==d?"重做中":"重试中");var s=!1;(10==d||11==d)&&(3==h.job_status||5==h.job_status?(s=!0,m&&e.cancel(m)):(4==h.job_status||7==h.job_status)&&3==g&&(m&&e.cancel(m),h.timer&&e.cancel(h.timer))),(s||12==d)&&(e.cancel(m),E(-1)),1!=c.task_status&&6!=c.task_status||12!=d||(a.info.task_status=c.task_status,a.info.task_state_cn=k.findValue(a.info.task_status,i)),a.control.close_task=3==g||g>6}b.dispatch_task_status=a.info.task_status},function(a){})},3e3)},L=function(b){for(var c=a.info.flow_diagram_info.nodeDataArray,d=[],e=0;e<c.length;e++){var f=c[e];3!=f.type&&(b||!f.sd_job_bean.job_status||1==f.sd_job_bean.job_status||2==f.sd_job_bean.job_status)&&(f.sd_job_bean.job_id=f.sd_job_bean.job_id?f.sd_job_bean.job_id:0,d.push(f.sd_job_bean.job_id))}return d},M=function(){d(function(){g.viewTaskDetail(u).then(function(c){d(function(){c.taskBean&&(a.info.task_status=c.taskBean.sdtask_status,a.info.task_state_cn=k.findValue(c.taskBean.sdtask_status,i),a.info.end_bk_datetime=c.taskBean.end_bk_datetime?c.taskBean.end_bk_datetime.substring(c.taskBean.end_bk_datetime.lastIndexOf("."),-1):"",a.info.start_bk_datetime=c.taskBean.start_bk_datetime?c.taskBean.start_bk_datetime.substring(c.taskBean.start_bk_datetime.lastIndexOf("."),-1):"",b.dispatch_task_status=a.info.task_status,(4==a.info.task_status||5==a.info.task_status)&&(a.info.exe_log_path=c.taskBean.exe_log_path?c.taskBean.exe_log_path:"",a.control.close_task=!1,a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,a.control.middle_stop=!1,a.control.suspend_task=!1,l&&e.cancel(l),m&&e.cancel(m),n&&e.cancel(n),o&&e.cancel(o)))},0)},function(a){})},6e3)},N=function(){g.viewTaskDetail(u).then(function(c){if(a.info.task_status=c.taskBean.sdtask_status,a.info.flow_id=c.taskBean.sdflow_id?c.taskBean.sdflow_id:"",a.info.version_id=c.taskBean.sdversion_id?c.taskBean.sdversion_id:"",a.info.task_id=c.taskBean.sdtask_id,a.info.exe_log_path=c.taskBean.exe_log_path?c.taskBean.exe_log_path:"",a.info.end_bk_datetime=c.taskBean.end_bk_datetime?c.taskBean.end_bk_datetime.substring(c.taskBean.end_bk_datetime.lastIndexOf("."),-1):"",a.info.start_bk_datetime=c.taskBean.start_bk_datetime?c.taskBean.start_bk_datetime.substring(c.taskBean.start_bk_datetime.lastIndexOf("."),-1):"",a.info.time_used=c.taskBean.time_used?k.usedCnTime(c.taskBean.time_used):"--",a.info.exe_user_name=c.taskBean.exe_user_name?c.taskBean.exe_user_name:c.taskBean.exe_user_id?c.taskBean.exe_user_id:"--",s=c.taskBean.start_param_flag?c.taskBean.start_param_flag:2,b.dispatch_task_status=a.info.task_status,c.flowBean){a.info.flow_diagram_info=c.flowBean?c.flowBean:{},a.info.flow_diagram_info.nodeDataArray=a.info.flow_diagram_info.sd_node_list?a.info.flow_diagram_info.sd_node_list:[],a.info.flow_diagram_info.linkDataArray=a.info.flow_diagram_info.link_list?a.info.flow_diagram_info.link_list:[];for(var d=0;d<a.info.flow_diagram_info.nodeDataArray.length;d++){var f=a.info.flow_diagram_info.nodeDataArray[d];f.category=f.category.toString(),f.isGroup=f.is_group,f.group=f.group<0?-f.group:f.group,f.key=f.key<0?-f.key:f.key,1===f.type?q=f:2===f.type&&(r=f)}for(var g=0;g<a.info.flow_diagram_info.linkDataArray.length;g++){var h=a.info.flow_diagram_info.linkDataArray[g];h.visible&&(h.text=h.expr)}a.info.flow_diagram_info.nodeDataArray.length>0?(a.info.job_id_list=L(),D(-1,!1,!1,!0),a.control.suspend_task=(2==a.info.exe_types||a.control.one_click)&&1==a.info.task_status,a.control.middle_stop=1==a.info.task_status&&!y()):(a.control.one_exec_btn=!0,a.control.step_exec_btn=!0),2==a.info.exe_types&&(a.control.step_exec_btn=!0,a.control.one_exec_btn=!0),(a.info.task_status<4||6==a.info.task_status||10==a.info.task_status)&&(a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,E(-1)),a.info.task_status>3&&6!=a.info.task_status&&10!=a.info.task_status&&(l&&e.cancel(l),7==a.info.task_status&&(a.control.one_exec_btn=!1,a.control.step_exec_btn=2==a.info.exe_types),(4==a.info.task_status||5==a.info.task_status)&&(a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,a.control.close_task=!1),11==a.info.task_status&&v())}},function(a){j.alert(a.message),f.go("dispatch_task_list.cur_task")})};a.viewSingleJob=function(c){b.dispatch_task_status=a.info.task_status,j.viewSingleWorkInfo(u,a.info.flow_diagram_info.nodeDataArray,c,a.info.task_status,!1).then(function(b){if(b){var c=b.meddle_reason?b.meddle_reason:"",f=b.job_index+"",h=b.job_id,i=0;3!=b.meddle_type?(1==b.meddle_type?(a.info.task_state_cn="重试等待",i=11):2==b.meddle_type?(a.info.task_state_cn="重做等待",i=10):4==b.meddle_type?(a.info.task_state_cn="重试链等待",i=12):(a.info.task_state_cn="等待完成",i=16),I(f,i),a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,a.control.close_task=!1,g.meddleJobExecute(u,i,[h],c).then(function(b){d(function(){10==i||11==i||16==i?a.info.job_id_list=[h]:a.info.job_id_list=L(!0),16==i?H(f,!0):K(f,i)},0)},function(b){j.alert(b.message),l&&e.cancel(l),a.control.close_task=!0,a.info.task_state_cn="执行异常"})):(I(f,i),a.oneStepSkip(f))}a.control.clear_click_event=!0,d(function(){a.control.clear_click_event=!1},100)})},a.oneClickExe=function(){if(1==s&&q&&1==q.sd_job_bean.job_status)x(7,q);else{var b=!1;if(a.info.job_id_list=L(),0===a.info.job_id_list.length)return;a.control.one_click=!0,a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,a.control.close_task=!1,7==a.info.task_status&&(b=!0,a.info.task_state_cn="执行中"),g.meddleTaskExecute(u,7).then(function(a){d(function(){console.log("一键干预成功")},0)},function(b){j.alert(b.message),a.control.one_exec_btn=!1,a.control.step_exec_btn=!1,a.control.middle_stop=!1,a.control.suspend_task=!1,e.cancel(l),7==a.info.task_status&&(a.info.task_state_cn="任务暂停")}),E(-1,b)}},a.singleStepExe=function(){if(1==s&&q&&1==q.sd_job_bean.job_status)x(6,q);else{var b=!1;if(a.info.job_id_list=L(),0===a.info.job_id_list.length)return;a.control.one_click=!1,a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,a.control.close_task=!1,7==a.info.task_status&&(b=!0,a.info.task_state_cn="手动等待"),g.meddleTaskExecute(u,6).then(function(a){d(function(){console.log("单步干预完成")},0)},function(b){j.alert(b.message),a.control.one_exec_btn=!1,a.control.step_exec_btn=!1,a.control.middle_stop=!1,e.cancel(l),7==a.info.task_status&&(a.info.task_state_cn="任务暂停")}),E(-1,b,!0)}},a.oneStepSkip=function(b){if(b>-1)var c=a.info.flow_diagram_info.nodeDataArray[b].sd_job_bean,e=[{job_id:c.job_id,job_status:c.job_status}];if(e){var f=a.info.flow_id,h=a.info.version_id;g.getJobOutput(u,f,h,e).then(function(a){d(function(){a.step_list?j.addSkipWorkParams(a.step_list).then(function(a){a?G(b,a):c.job_status=4}):G(b,e)},0)},function(a){j.alert(a.message)})}},a.meddleTask=function(c){var d=1==c?"关闭":2==c?"暂停":5==c?"中止":"";j.confirm("确认"+d+"任务 ?").then(function(){var f=a.info.task_state_cn;a.info.task_state_cn="正在"+d,a.control.middle_stop=2==c,a.control.close_task=!1,a.control.one_exec_btn=!0,a.control.step_exec_btn=!0,a.control.suspend_task=!1,b.dispatch_task_status=0,l&&e.cancel(l),1==c&&(m&&e.cancel(m),o&&e.cancel(o)),A(c,f),B(c)})},a.stopPropagation=function(a){a.stopPropagation()},a.downloadExecLog=function(){var b=a.info.exe_log_path;b&&k.downloadFile(b)},b.$on("$stateChangeSuccess",function(){l&&e.cancel(l),m&&e.cancel(m),n&&e.cancel(n),o&&e.cancel(o),p&&e.cancel(p)}),N()}]),task.controller("taskExecuteDetailCtrl",["$scope","$rootScope","$stateParams","$timeout","$interval","$state","Flow","FlowType","OpTaskExeStatus","Charts","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n=c.task_id||"";angular.extend(a.control,{task_info_loading:!1,clear_click_event:!1}),a.info={flow_id:"",exe_types:0,exe_user_name:"",exe_start_datetime:"",exe_end_datetime:"",job_id_list:[],exe_log_path:"",flow_diagram_info:{nodeDataArray:[],linkDataArray:[]}};var o=function(a){a.timer&&e.cancel(a.timer),a.width&&a.width>=110||(a.timer=e(function(){a.width+=~~(8*Math.random())},1e3))},p=function(){for(var b=a.info.flow_diagram_info.nodeDataArray,c=[],d=0;d<b.length;d++){var e=b[d];3!=e.type&&(e.sd_job_bean.job_status&&1!=e.sd_job_bean.job_status&&2!=e.sd_job_bean.job_status||(e.sd_job_bean.job_id=e.sd_job_bean.job_id?e.sd_job_bean.job_id:0,c.push(e.sd_job_bean.job_id)))}return c},q=function(){g.monitorJobStatus(n,a.info.job_id_list).then(function(b){d(function(){a.info.task_status=b.task_status,a.info.task_state_cn=l.findValue(b.task_status,i);var c=b.job_status_list?b.job_status_list:[],d=a.info.flow_diagram_info.nodeDataArray,f=d.length;if(0!=f)for(var g=0;g<c.length;g++)for(var h=c[g],j=0;f>j;j++){var k=d[j];3!=k.type&&k.sd_job_bean.job_id==h.job_id&&(k.sd_job_bean.job_status=h.job_status?h.job_status:1,k.sd_job_bean.width=k.sd_job_bean.width?k.sd_job_bean.width:0,2==k.sd_job_bean.job_status?(o(k.sd_job_bean),k.sd_job_bean.width>=100&&(k.sd_job_bean.timer&&e.cancel(k.sd_job_bean.timer),k.sd_job_bean.width=110)):3==k.sd_job_bean.job_status||5==k.sd_job_bean.job_status?(k.sd_job_bean.timer&&e.cancel(k.sd_job_bean.timer),k.sd_job_bean.width=120):(4==k.sd_job_bean.job_status||7==k.sd_job_bean.job_status)&&(k.sd_job_bean.timer&&e.cancel(k.sd_job_bean.timer),k.sd_job_bean.width=k.sd_job_bean.width?k.sd_job_bean.width:10))}},0)},function(a){})},r=function(){m=e(function(){q(),a.$watch("info.task_status",function(a,b){a!=b&&(4==a||5==a||7==a)&&m&&e.cancel(m)})},5e3),a.control.task_info_loading=!0,g.viewTaskDetail(n).then(function(b){d(function(){a.control.task_info_loading=!1,a.info.task_status=b.taskBean.sdtask_status,a.info.task_state_cn=l.findValue(b.taskBean.sdtask_status,i),a.info.task_cn_name=b.taskBean.sdtask_cn_name,a.info.end_bk_datetime=b.taskBean.end_bk_datetime?b.taskBean.end_bk_datetime.substring(b.taskBean.end_bk_datetime.lastIndexOf("."),-1):"",a.info.start_bk_datetime=b.taskBean.start_bk_datetime?b.taskBean.start_bk_datetime.substring(b.taskBean.start_bk_datetime.lastIndexOf("."),-1):"",a.info.exe_log_path=b.taskBean.exe_log_path||"",a.info.time_used=b.taskBean.time_used?l.usedCnTime(b.taskBean.time_used):"--",a.info.flow_diagram_info=b.flowBean?b.flowBean:{},a.info.flow_diagram_info.nodeDataArray=a.info.flow_diagram_info.sd_node_list?a.info.flow_diagram_info.sd_node_list:[],a.info.flow_diagram_info.linkDataArray=a.info.flow_diagram_info.link_list?a.info.flow_diagram_info.link_list:[];for(var c=0;c<a.info.flow_diagram_info.nodeDataArray.length;c++){var d=a.info.flow_diagram_info.nodeDataArray[c];d.category=d.category.toString(),d.isGroup=d.is_group,d.group=d.group<0?-d.group:d.group,d.key=d.key<0?-d.key:d.key}for(var f=0;f<a.info.flow_diagram_info.linkDataArray.length;f++){var g=a.info.flow_diagram_info.linkDataArray[f];g.visible&&(g.text=g.expr)}0!=a.info.flow_diagram_info.nodeDataArray.length?(a.info.job_id_list=p(),q()):(a.control.one_exec_btn=!0,a.control.step_exec_btn=!0),(4==a.info.task_status||5==a.info.task_status)&&e.cancel(m)},0)},function(a){k.alert(a.message)})};a.viewSingleJob=function(b){k.viewSingleWorkInfo(n,a.info.flow_diagram_info.nodeDataArray,b,a.info.task_status,!0).then(function(b){a.control.clear_click_event=!0,d(function(){a.control.clear_click_event=!1},100)})},a.downloadExecLog=function(){var b=a.info.exe_log_path;b&&l.downloadFile(b)},b.$on("$stateChangeSuccess",function(){m&&e.cancel(m)}),r()}]),task.controller("taskPreviewCtrl",["$scope","$rootScope","$state","$location","$timeout","Flow","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i){var j=d.absUrl();a.control={active_name:j.slice(j.lastIndexOf("/")+1),first_opened:!1,second_opened:!1,node_opened:!1},a.info={all_task:{left_scroll:g,right_scroll:g,start_date:"",next_date:"",first_task:{loading:!1,error_message:"",task_list:[]},second_task:{loading:!1,error_message:"",task_list:[]}},attention_task:{left_scroll:g,right_scroll:g,start_date:"",next_date:"",first_task:{loading:!1,error_message:"",task_list:[]},second_task:{loading:!1,error_message:"",task_list:[]}},node_task:{left_scroll:g,right_scroll:g,start_date:"",node_list:[],first_task:{loading:!1,error_message:"",task_list:[]},second_task:{loading:!1,error_message:"",task_list:[]}}};var k=function(){var b=new Date,c=angular.copy(b);for(var d in a.info){var e=a.info[d];e.start_date=b,e.start_date_cn=l(b),"node_task"!=d&&(c.setDate(b.getDate()+1),e.next_date=c,e.next_date_cn=l(c),n("all_task"==d?!1:!0,e.start_date,e.first_task),n("all_task"==d?!1:!0,e.next_date,e.second_task))}},l=function(a){var b=a.getFullYear(),c=parseInt(a.getMonth()+1)<10?"0"+(a.getMonth()+1):a.getMonth()+1,d=parseInt(a.getDate())<10?"0"+a.getDate():a.getDate();return b+"年"+c+"月"+d+"日"},m=function(b){var c=229*a.info.node_task.node_list.length,d=229*b,e=parseFloat($(".node_flow").css("width")),f=parseInt((e-458)/2),g=e>c-d+f?e-c+25:0==b||f>=d?0:f-d;c>e&&$(".node_flow>div").css("left",g+"px")},n=function(a,b,c){var d=i.dtFormat(b);c.loading=!0,f.getTaskListByDate(a,d).then(function(a){e(function(){a&&(c.loading=!1,c.task_list=a.task_run_list?a.task_run_list:[],c.error_message="")},1e3)},function(a){c.loading=!1,c.error_message=a.message})},o=function(a,b,c){var d=i.dtFormat(b);c.loading=!0,f.getTaskListByDateAndNode(a,d).then(function(a){e(function(){a&&(c.loading=!1,c.task_list=a.task_run_list?a.task_run_list:[],c.error_message="")},1e3)},function(a){c.loading=!1,c.error_message=a.message})},p=function(){for(var b=a.info.node_task.start_date,c=0,d=0;c<a.info.node_task.node_list.length;c++){var e=a.info.node_task.node_list[c];if(e.state){if(0!=d){o(e.node_ip,b,a.info.node_task.second_task);break}o(e.node_ip,b,a.info.node_task.first_task),d++}}},q=function(){var b=a.info.node_task.node_list,c=[];if(0!==b.length)return angular.forEach(b,function(a,b,d){[].push.call(c,{node_ip:a.node_ip})}),c},r=function(){k()};a.jumpTo=function(b){a.control.active_name=b,c.go("dispatch_task_preview."+b)},a.dateCallBack=function(a,b,c,d,e){var f=a[c],g=angular.copy(f);a[c+"_cn"]=l(f),g.setDate(g.getDate()+b),a[d]=g,a[d+"_cn"]=l(g),n(e,a.start_date,a.first_task),n(e,a.next_date,a.second_task)},a.openCalendar=function(b,c){c.preventDefault(),c.stopPropagation(),a.control[b]=!a.control[b]},a.frontOrNextDate=function(b,c,d,e,f){var g=angular.copy(b[d]);g.setDate(g.getDate()+c),b[d]=g,a.dateCallBack(b,1,d,e,f)},a.chooseNodesModal=function(b){var c=b?q():[];h.chooseNodes(c).then(function(b){b.length>0&&(b[0].state=!0,b.length>1&&(b[1].state=!0),p()),a.info.node_task.node_list=b})},a.frontOrNextNode=function(b){var c=-1;if(a.info.node_task.node_list.length>2){for(var d=0;d<a.info.node_task.node_list.length-1;d++){var e=a.info.node_task.node_list[d],f=a.info.node_task.node_list[d+1];if(e.state&&f.state){-1==b?d+2==a.info.node_task.node_list.length-1?(e.state=!1,c=d+1,a.info.node_task.node_list[d+2].state=!0):d+2<a.info.node_task.node_list.length-1&&(e.state=!1,f.state=!1,c=d+2,a.info.node_task.node_list[d+2].state=!0,a.info.node_task.node_list[d+3].state=!0):d-1==0?(c=0,a.info.node_task.node_list[d-1].state=!0,a.info.node_task.node_list[d+1].state=!1):d-1>0&&(e.state=!1,f.state=!1,c=d-2,a.info.node_task.node_list[d-1].state=!0,a.info.node_task.node_list[d-2].state=!0),-1!=c&&p();break}}c!=a.info.node_task.node_list.length-1&&-1!=c&&m(c)}},a.selectDate=function(a,b){var c=a[b];a[b+"_cn"]=l(c),p()},a.setNodeStyle=function(b,c){return{"border-color":b.state?"#FC9E22":"",color:b.state?"#FC9E22":"","margin-right":c==a.info.node_task.node_list.length-1?"0px":"25px"}},r()}]);var scene=angular.module("dispatchSceneController",[]);scene.controller("sceneNewCtrl",["$scope","$stateParams","$timeout","$state","IML_TYPE","dataBaseType","JobErrorType","ParamValueSource","ElementCategory","FlowJobType","Scene","RequestMethod","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.info={scene_id:"",scene_name:"",scene_desc:"",category_list:[]},a.control={is_update:!1,btn_loading:!1,active_element_i:-1,config_element:!1,tem_element_list:[]},a.data={execute_type_list:e,database_type_list:f,error_handle_list:g,param_source_list:h,request_method_list:l,element_data:{}};var o=function(b){b=b||{},a.data.element_data={exec_script:b.exec_script||"",script_source:b.script_source||1,sql_source:b.sql_source||1,dataBase_type:b.dataBase_type||1,service_name:b.service_name||"",service_comm_info:b.service_comm_info||"",config:b.config||!1,comp_cn_name:b.comp_cn_name||"",sdwork_cn_name:b.sdwork_cn_name||"",job_bk_desc:b.job_bk_desc||"",comp_id:b.comp_id||"",input:b.input||[],output:b.output||[],comp_impl_type:b.comp_impl_type||"",datetime_condition:b.datetime_condition||"",date_condition:b.date_condition||"",h_condition:b.h_condition||"",m_condition:b.m_condition||"",timeused:b.timeused||"",pre_job_list:b.pre_job_list||[],timeout:b.timeout||"",error_handle:b.error_handle||1,retry_interval:b.retry_interval||"",retry_times:b.retry_times||"",polling_interval:b.polling_interval||"",polling_max_times:b.polling_max_times||"",result_judge:b.result_judge||"",job_method:b.job_method||0,env_name:b.env_name||"",language_name:b.language_name||"",language_version:b.language_version||"",operating_system:b.operating_system||"",bit_number:b.bit_number||"",annex_file:b.annex_file||"",plugin_list:b.plugin_list||[],request_method:b.request_method||1}},p=function(){a.control.tem_element_list=[];for(var b=0;b<a.info.category_list.length;b++){var c=a.info.category_list[b];c.element_list=c.element_list?c.element_list:[];for(var d=0;d<c.element_list.length;d++){var e=c.element_list[d];e.category=e.category?e.category:c.category,e.element_id=c.category+"_"+d,e.element_info=e.element_info?e.element_info:{},e.element_info.config=!!e.element_info.sdwork_cn_name,a.control.tem_element_list.push(e)}}},q=function(b){var c=a.control.active_element_i;b!==c&&(a.control.tem_element_list[c]&&(a.control.tem_element_list[c].active=!1),a.control.tem_element_list[b].active=!0,a.control.active_element_i=b)},r=function(b,c){for(var d=0,e=0;e<a.control.tem_element_list.length;e++){var f=a.control.tem_element_list[e];if(f.type===b&&f.element_id===c){d=e;break}}return d},s=function(){for(var b=!0,c=0;c<a.info.category_list.length;c++){var d=a.info.category_list[c];d.element_list=d.element_list||[];for(var e=0;e<d.element_list.length;e++){var f=d.element_list[e];f.element_info.sdwork_cn_name||(b=!1)}}return b},t=function(){};a.addElement=function(){m.addSceneElement().then(function(b){if(b){var c=a.info.category_list.length;if(0===c)a.info.category_list[0]=b;else{for(var d=!0,e=0;c>e;e++){var f=a.info.category_list[e];if(f.category===b.category){d=!1;for(var g=0;g<b.element_list.length;g++){var h=b.element_list[g];f.element_list.push(h)}break}if(!d)break}d&&a.info.category_list.push(b)}p()}})},a.removeElement=function(b,c,d,e){e.stopPropagation();var f=d.text?"删除[ "+d.text+" ] ?":"确认删除 ?";m.confirm(f).then(function(){b.splice(c,1);for(var e=0;e<a.control.tem_element_list.length;e++){var f=a.control.tem_element_list[e];if(f.type===d.type&&f.element_id===d.element_id){a.control.tem_element_list.splice(e,1);break}}})},a.configElement=function(b,c,d){c.element_info=c.element_info||{},a.control.config_element=!0;var e=c.type,f=c.element_id||b+"_"+d,g=r(e,f);a.tabOne(g)},a.removeCurrConfigElement=function(){var b=a.data.element_data.sdwork_cn_name?"删除 [ "+a.data.element_data.sdwork_cn_name+" ] 元素 ?":"删除元素 ?";m.confirm(b).then(function(){a.curr_ele_index=a.curr_ele_index||0;for(var b,c=a.control.tem_element_list[a.curr_ele_index].element_id,d=0;d<a.info.category_list.length;d++){var e=a.info.category_list[d];e.element_list=e.element_list||[];for(var f=0;f<e.element_list.length;f++){var g=e.element_list[f];if(g.element_id=g.element_id||e.category+"_"+f,g.element_id===c){e.element_list.splice(f,1),b=!0;break}}if(b)break}a.control.tem_element_list.splice(a.curr_ele_index,1),a.closeElementConfig()})},a.tabOne=function(b){q(b);var c=a.control.tem_element_list[b];a.curr_ele_category=c.category,a.curr_ele_type=c.type,a.curr_ele_index=b,o(c.element_info),8===a.curr_ele_category&&a.data.error_handle_list.pop()},a.elementHightIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette/rep.png)";break;case 7:b="url(img/dispatch/fl/palette/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette/copy.png)";break;case 14:b="url(img/dispatch/fl/palette/sql.png)";break;case 15:b="url(img/dispatch/fl/palette/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette/net.png)";break;case 17:b="url(img/dispatch/fl/palette/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette/python.png)";break;case 20:b="url(img/dispatch/fl/palette/shell.png)";break;case 21:b="url(img/dispatch/fl/palette/bat.png)";break;case 22:b="url(img/dispatch/fl/palette/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette/perl.png)";break;case 24:b="url(img/dispatch/fl/palette/web.png)";break;case 25:b="url(img/dispatch/fl/palette/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette/http.png)";break;case 27:b="url(img/dispatch/fl/palette/tux.png)";break;case 28:b="url(img/dispatch/fl/palette/cl.png)";break;case 29:b="url(img/dispatch/fl/palette/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette/java.png)";break;case 31:b="url(img/dispatch/fl/palette/c.png)";break;case 32:b="url(img/dispatch/fl/palette/c++.png)";break;default:b="url(img/dispatch/fl/palette/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.elementOriginalIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";
break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette_original/rep.png)";break;case 7:b="url(img/dispatch/fl/palette_original/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette_original/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette_original/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette_original/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette_original/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette_original/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette_original/copy.png)";break;case 14:b="url(img/dispatch/fl/palette_original/sql.png)";break;case 15:b="url(img/dispatch/fl/palette_original/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette_original/net.png)";break;case 17:b="url(img/dispatch/fl/palette_original/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette_original/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette_original/python.png)";break;case 20:b="url(img/dispatch/fl/palette_original/shell.png)";break;case 21:b="url(img/dispatch/fl/palette_original/bat.png)";break;case 22:b="url(img/dispatch/fl/palette_original/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette_original/perl.png)";break;case 24:b="url(img/dispatch/fl/palette_original/web.png)";break;case 25:b="url(img/dispatch/fl/palette_original/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette_original/http.png)";break;case 27:b="url(img/dispatch/fl/palette_original/tux.png)";break;case 28:b="url(img/dispatch/fl/palette_original/cl.png)";break;case 29:b="url(img/dispatch/fl/palette_original/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette_original/java.png)";break;case 31:b="url(img/dispatch/fl/palette_original/c.png)";break;case 32:b="url(img/dispatch/fl/palette_original/c++.png)";break;default:b="url(img/dispatch/fl/palette_original/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.elementIcon=function(){var b="",c="/45px";switch(a.curr_ele_type){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/context/condition.png)";break;case 5:b="url(img/dispatch/fl/context/stop.png)";break;case 6:b="url(img/dispatch/fl/context/rep.png)";break;case 7:b="url(img/dispatch/fl/context/ftpU.png)";break;case 8:b="url(img/dispatch/fl/context/ftpD.png)";break;case 9:b="url(img/dispatch/fl/context/sftpU.png)";break;case 10:b="url(img/dispatch/fl/context/sftpD.png)";break;case 11:b="url(img/dispatch/fl/context/zngtU.png)";break;case 12:b="url(img/dispatch/fl/context/zngtD.png)";break;case 13:b="url(img/dispatch/fl/context/copy.png)";break;case 14:b="url(img/dispatch/fl/context/sql.png)";break;case 15:b="url(img/dispatch/fl/context/sqlS.png)";break;case 16:b="url(img/dispatch/fl/context/web.png)";break;case 17:b="url(img/dispatch/fl/context/sysSt.png)";break;case 18:b="url(img/dispatch/fl/context/sysE.png)";break;case 19:b="url(img/dispatch/fl/context/python.png)";break;case 20:b="url(img/dispatch/fl/context/shell.png)";break;case 21:b="url(img/dispatch/fl/context/bat.png)";break;case 22:b="url(img/dispatch/fl/context/rb.png)";break;case 23:b="url(img/dispatch/fl/context/perl.png)";break;case 24:b="url(img/dispatch/fl/context/webs.png)";break;case 25:b="url(img/dispatch/fl/context/tcp.png)";break;case 26:b="url(img/dispatch/fl/context/http.png)";break;case 27:b="url(img/dispatch/fl/context/tux.png)";break;case 28:b="url(img/dispatch/fl/context/cl.png)";break;case 29:b="url(img/dispatch/fl/context/rpg.png)";break;case 30:b="url(img/dispatch/fl/context/java.png)";break;case 31:b="url(img/dispatch/fl/context/c.png)";break;case 32:b="url(img/dispatch/fl/context/c++.png)";break;default:b="url(img/dispatch/fl/context/ftpU.png)"}return{background:b+"no-repeat center"+c}},a.categoryTOCn=function(a){return n.findValue(a,i)},a.eleTypeTOCn=function(a){return a?n.findValue(a,j):"--"},a.closeElementConfig=function(){a.control.config_element=!1,a.control.active_element_i=-1,angular.forEach(a.control.tem_element_list,function(a){a.active=!1}),window.scroll({top:0})},a.setJobMethod=function(){var b=a.control.active_element_i,c=a.control.tem_element_list[b];m.setFlowJobMethod(c.type,a.data.element_data,!1).then(function(b){if(a.data.element_data.job_method=b.job_method,1===b.job_method)a.data.element_data.comp_id=b.comp_id,a.data.element_data.comp_impl_type=b.impl_type,a.data.element_data.comp_cn_name=b.comp_cn_name,a.data.element_data.input=b.input||[],a.data.element_data.output=b.output||[],a.data.element_data.exec_script=b.exec_script,a.data.element_data.script_source=b.script_source,a.data.element_data.env_name=b.env_name,a.data.element_data.language_name=b.language_name,a.data.element_data.language_version=b.language_version,a.data.element_data.operating_system=b.operating_system,a.data.element_data.bit_number=b.bit_number,a.data.element_data.plugin_list=b.plugin_list,a.data.element_data.annex_file=b.annex_file;else{a.data.element_data.comp_id="",a.data.element_data.comp_impl_type=b.impl_type,a.data.element_data.output=b.output?b.output:[],a.data.element_data.input=b.param_list,a.data.element_data.exec_script=b.exec_script,a.data.element_data.business_sys_name=b.business_sys_name,a.data.element_data.script_source=b.script_source,a.data.element_data.sql_source=b.sql_source,a.data.element_data.script_file_name=b.script_file_name,a.data.element_data.dataBase_type=b.dataBase_type,a.data.element_data.service_name=b.service_name,a.data.element_data.env_name=b.env_name,a.data.element_data.language_name=b.language_name,a.data.element_data.language_version=b.language_version,a.data.element_data.operating_system=b.operating_system,a.data.element_data.bit_number=b.bit_number,a.data.element_data.plugin_list=b.plugin_list,a.data.element_data.annex_file=b.annex_file;for(var c=0;c<a.data.element_data.input.length;c++)a.data.element_data.input[c].param_source=1}})},a.selectErrorHandle=function(b){a.data.element_data.retry_times=3===b?3:"",a.data.element_data.retry_interval=3===b?4:""},a.formSubmit=function(b){if(!n.valiForm(a.new_element_form))return!1;if(1===b){if(0===a.info.category_list.length)return m.alert("请添加元素"),!1;if(!s())return m.alert("元素配置不完整"),!1;a.control.btn_loading=!0,k.addScene(a.info,!1).then(function(b){a.control.btn_loading=!1,m.alert("新增成功"),a.formCancel()},function(b){a.control.btn_loading=!1,m.alert(b.message)})}else{var c=a.control.active_element_i,d=a.control.tem_element_list[c];if(!a.data.element_data.job_method)return m.alert("请设置内容类型"),!1;if(1===a.data.element_data.job_method&&!a.data.element_data.comp_cn_name)return m.alert("请重配内容类型"),!1;a.data.element_data.config=!0;for(var e=0;e<a.info.category_list.length;e++){var f=a.info.category_list[e];if(f.category===d.category)for(var g=0;g<f.element_list.length;g++){var h=f.element_list[g];if(h.type===d.type&&h.element_id===d.element_id){h.element_info=a.data.element_data;break}}}a.control.config_element=!1,o()}},a.formCancel=function(){d.go("dispatch_scene_list")},t()}]),scene.controller("sceneModifyCtrl",["$scope","$stateParams","$timeout","$state","IML_TYPE","dataBaseType","JobErrorType","ParamValueSource","ElementCategory","FlowJobType","Scene","RequestMethod","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b.scene_id?b.scene_id:"";a.info={scene_id:o,scene_name:"",scene_desc:"",category_list:[]},a.control={is_update:!0,btn_loading:!1,active_element_i:-1,config_element:!1,tem_element_list:[],element_data:{}},a.data={execute_type_list:e,database_type_list:f,error_handle_list:g,param_source_list:h,request_method_list:l};var p=function(b){b=b||{},a.data.element_data={exec_script:b.exec_script||"",script_source:b.script_source||1,sql_source:b.sql_source||1,dataBase_type:b.dataBase_type||1,service_name:b.service_name||"",service_comm_info:b.service_comm_info||"",config:b.config||!1,comp_cn_name:b.comp_cn_name||"",sdwork_cn_name:b.sdwork_cn_name||"",job_bk_desc:b.job_bk_desc||"",comp_id:b.comp_id||"",input:b.input||[],output:b.output||[],comp_impl_type:b.comp_impl_type||"",datetime_condition:b.datetime_condition||"",date_condition:b.date_condition||"",h_condition:b.h_condition||"",m_condition:b.m_condition||"",timeused:b.timeused||"",pre_job_list:b.pre_job_list||[],timeout:b.timeout||"",error_handle:b.error_handle||1,retry_interval:b.retry_interval||"",retry_times:b.retry_times||"",polling_interval:b.polling_interval||"",polling_max_times:b.polling_max_times||"",result_judge:b.result_judge||"",job_method:b.job_method||0,env_name:b.env_name||"",language_name:b.language_name||"",language_version:b.language_version||"",operating_system:b.operating_system||"",bit_number:b.bit_number||"",annex_file:b.annex_file||"",plugin_list:b.plugin_list||[],request_method:b.request_method||1}},q=function(){a.control.tem_element_list=[];for(var b=0;b<a.info.category_list.length;b++){var c=a.info.category_list[b];c.element_list=c.element_list?c.element_list:[];for(var d=0;d<c.element_list.length;d++){var e=c.element_list[d];e.category=e.category?e.category:c.category,e.element_id=c.category+"_"+d,e.element_info=e.element_info?e.element_info:{},e.element_info.config=!!e.element_info.sdwork_cn_name,a.control.tem_element_list.push(e)}}},r=function(b){var c=a.control.active_element_i;b!==c&&(a.control.tem_element_list[c]&&(a.control.tem_element_list[c].active=!1),a.control.tem_element_list[b].active=!0,a.control.active_element_i=b)},s=function(b,c){for(var d=0,e=0;e<a.control.tem_element_list.length;e++){var f=a.control.tem_element_list[e];if(f.type===b&&f.element_id===c){d=e;break}}return d},t=function(){for(var b=!0,c=0;c<a.info.category_list.length;c++){var d=a.info.category_list[c];d.element_list=d.element_list||[];for(var e=0;e<d.element_list.length;e++){var f=d.element_list[e];f.element_info.sdwork_cn_name||(b=!1)}}return b},u=function(){k.getSingleSceneDetail(o).then(function(b){c(function(){a.info.scene_name=b.scene_info&&b.scene_info.scene_name?b.scene_info.scene_name:"",a.info.scene_desc=b.scene_info&&b.scene_info.scene_desc?b.scene_info.scene_desc:"",a.info.category_list=b.scene_bean&&b.scene_bean.category_list?b.scene_bean.category_list:[],q()},0)},function(a){m.alert(a.message),d.go("dispatch_scene_list")})};a.addElement=function(){m.addSceneElement().then(function(b){if(b){var c=a.info.category_list.length;if(0===c)a.info.category_list[0]=b;else{for(var d=!0,e=0;c>e;e++){var f=a.info.category_list[e];if(f.category===b.category){d=!1;for(var g=0;g<b.element_list.length;g++){var h=b.element_list[g];f.element_list.push(h)}break}if(!d)break}d&&a.info.category_list.push(b)}q()}})},a.removeElement=function(b,c,d,e){e.stopPropagation();var f=d.text?"删除[ "+d.text+" ] ?":"确认删除 ?";m.confirm(f).then(function(){b.splice(c,1);for(var e=0;e<a.control.tem_element_list.length;e++){var f=a.control.tem_element_list[e];if(f.type===d.type&&f.element_id===d.element_id){a.control.tem_element_list.splice(e,1);break}}})},a.configElement=function(b,c,d){c.element_info=c.element_info||{},a.control.config_element=!0;var e=c.type,f=c.element_id||b+"_"+d,g=s(e,f);a.tabOne(g)},a.removeCurrConfigElement=function(){var b=a.data.element_data.sdwork_cn_name?"删除 [ "+a.data.element_data.sdwork_cn_name+" ] 元素 ?":"删除元素 ?";m.confirm(b).then(function(){a.curr_ele_index=a.curr_ele_index||0;for(var b,c=a.control.tem_element_list[a.curr_ele_index].element_id,d=0;d<a.info.category_list.length;d++){var e=a.info.category_list[d];e.element_list=e.element_list||[];for(var f=0;f<e.element_list.length;f++){var g=e.element_list[f];if(g.element_id=g.element_id||e.category+"_"+f,g.element_id===c){e.element_list.splice(f,1),b=!0;break}}if(b)break}a.control.tem_element_list.splice(a.curr_ele_index,1),a.closeElementConfig()})},a.tabOne=function(b){r(b);var c=a.control.tem_element_list[b];a.curr_ele_category=c.category,a.curr_ele_type=c.type,a.curr_ele_index=b,p(c.element_info),8===a.curr_ele_category&&a.data.error_handle_list.pop()},a.elementHightIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette/rep.png)";break;case 7:b="url(img/dispatch/fl/palette/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette/copy.png)";break;case 14:b="url(img/dispatch/fl/palette/sql.png)";break;case 15:b="url(img/dispatch/fl/palette/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette/net.png)";break;case 17:b="url(img/dispatch/fl/palette/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette/python.png)";break;case 20:b="url(img/dispatch/fl/palette/shell.png)";break;case 21:b="url(img/dispatch/fl/palette/bat.png)";break;case 22:b="url(img/dispatch/fl/palette/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette/perl.png)";break;case 24:b="url(img/dispatch/fl/palette/web.png)";break;case 25:b="url(img/dispatch/fl/palette/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette/http.png)";break;case 27:b="url(img/dispatch/fl/palette/tux.png)";break;case 28:b="url(img/dispatch/fl/palette/cl.png)";break;case 29:b="url(img/dispatch/fl/palette/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette/java.png)";break;case 31:b="url(img/dispatch/fl/palette/c.png)";break;case 32:b="url(img/dispatch/fl/palette/c++.png)";break;default:b="url(img/dispatch/fl/palette/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.elementOriginalIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette_original/rep.png)";break;case 7:b="url(img/dispatch/fl/palette_original/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette_original/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette_original/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette_original/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette_original/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette_original/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette_original/copy.png)";break;case 14:b="url(img/dispatch/fl/palette_original/sql.png)";break;case 15:b="url(img/dispatch/fl/palette_original/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette_original/net.png)";break;case 17:b="url(img/dispatch/fl/palette_original/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette_original/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette_original/python.png)";break;case 20:b="url(img/dispatch/fl/palette_original/shell.png)";break;case 21:b="url(img/dispatch/fl/palette_original/bat.png)";break;case 22:b="url(img/dispatch/fl/palette_original/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette_original/perl.png)";break;case 24:b="url(img/dispatch/fl/palette_original/web.png)";break;case 25:b="url(img/dispatch/fl/palette_original/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette_original/http.png)";break;case 27:b="url(img/dispatch/fl/palette_original/tux.png)";break;case 28:b="url(img/dispatch/fl/palette_original/cl.png)";break;case 29:b="url(img/dispatch/l/palette_original/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette_original/java.png)";break;case 31:b="url(img/dispatch/fl/palette_original/c.png)";break;case 32:b="url(img/dispatch/fl/palette_original/c++.png)";break;default:b="url(img/dispatch/fl/palette_original/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.elementIcon=function(){var b="",c="/45px";switch(a.curr_ele_type){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/context/condition.png)";break;case 5:b="url(img/dispatch/fl/context/stop.png)";break;case 6:b="url(img/dispatch/fl/context/rep.png)";break;case 7:b="url(img/dispatch/fl/context/ftpU.png)";break;case 8:b="url(img/dispatch/fl/context/ftpD.png)";break;case 9:b="url(img/dispatch/fl/context/sftpU.png)";break;case 10:b="url(img/dispatch/fl/context/sftpD.png)";break;case 11:b="url(img/dispatch/fl/context/zngtU.png)";break;case 12:b="url(img/dispatch/fl/context/zngtD.png)";break;case 13:b="url(img/dispatch/fl/context/copy.png)";break;case 14:b="url(img/dispatch/fl/context/sql.png)";break;case 15:b="url(img/dispatch/fl/context/sqlS.png)";break;case 16:b="url(img/dispatch/fl/context/web.png)";break;case 17:b="url(img/dispatch/fl/context/sysSt.png)";break;case 18:b="url(img/dispatch/fl/context/sysE.png)";break;case 19:b="url(img/dispatch/fl/context/python.png)";break;case 20:b="url(img/dispatch/fl/context/shell.png)";break;case 21:b="url(img/dispatch/fl/context/bat.png)";break;case 22:b="url(img/dispatch/fl/context/rb.png)";break;case 23:b="url(img/dispatch/fl/context/perl.png)";break;case 24:b="url(img/dispatch/fl/context/webs.png)";break;case 25:b="url(img/dispatch/fl/context/tcp.png)";break;case 26:b="url(img/dispatch/fl/context/http.png)";break;case 27:b="url(img/dispatch/fl/context/tux.png)";break;case 28:b="url(img/dispatch/fl/context/cl.png)";break;case 29:b="url(img/dispatch/fl/context/rpg.png)";break;case 30:b="url(img/dispatch/fl/context/java.png)";break;case 31:b="url(img/dispatch/fl/context/c.png)";break;case 32:b="url(img/dispatch/fl/context/c++.png)";break;default:b="url(img/dispatch/fl/context/ftpU.png)"}return{background:b+"no-repeat center"+c}},a.categoryTOCn=function(a){return n.findValue(a,i)},a.eleTypeTOCn=function(a){return a?n.findValue(a,j):"--"},a.closeElementConfig=function(){a.control.config_element=!1,a.control.active_element_i=-1,angular.forEach(a.control.tem_element_list,function(a){a.active=!1}),window.scroll({top:0})},a.setJobMethod=function(){var b=a.control.active_element_i,c=a.control.tem_element_list[b];m.setFlowJobMethod(c.type,a.data.element_data,!1).then(function(b){if(a.data.element_data.job_method=b.job_method,1===b.job_method)a.data.element_data.comp_id=b.comp_id,a.data.element_data.comp_impl_type=b.impl_type,a.data.element_data.comp_cn_name=b.comp_cn_name,a.data.element_data.input=b.input||[],a.data.element_data.output=b.output||[],a.data.element_data.exec_script=b.exec_script,a.data.element_data.script_source=b.script_source,a.data.element_data.env_name=b.env_name,a.data.element_data.language_name=b.language_name,a.data.element_data.language_version=b.language_version,a.data.element_data.operating_system=b.operating_system,a.data.element_data.bit_number=b.bit_number,a.data.element_data.plugin_list=b.plugin_list,a.data.element_data.annex_file=b.annex_file;else{a.data.element_data.comp_id="",a.data.element_data.comp_impl_type=b.impl_type,a.data.element_data.output=b.output?b.output:[],a.data.element_data.input=b.param_list,a.data.element_data.exec_script=b.exec_script,a.data.element_data.business_sys_name=b.business_sys_name,a.data.element_data.script_source=b.script_source,a.data.element_data.sql_source=b.sql_source,a.data.element_data.script_file_name=b.script_file_name,a.data.element_data.dataBase_type=b.dataBase_type,a.data.element_data.service_name=b.service_name,a.data.element_data.env_name=b.env_name,a.data.element_data.language_name=b.language_name,a.data.element_data.language_version=b.language_version,a.data.element_data.operating_system=b.operating_system,a.data.element_data.bit_number=b.bit_number,a.data.element_data.plugin_list=b.plugin_list,a.data.element_data.annex_file=b.annex_file;for(var c=0;c<a.data.element_data.input.length;c++)a.data.element_data.input[c].param_source=1}})},a.selectErrorHandle=function(b){a.data.element_data.retry_times=3===b?3:"",a.data.element_data.retry_interval=3===b?4:""},a.formSubmit=function(b){if(!n.valiForm(a.new_element_form))return!1;if(1===b){if(0===a.info.category_list.length)return m.alert("请添加元素"),!1;if(!t())return m.alert("元素配置不完整"),!1;a.control.btn_loading=!0,k.addScene(a.info,!0).then(function(b){a.control.btn_loading=!1,m.alert("修改成功"),a.formCancel()},function(b){a.control.btn_loading=!1,m.alert(b.message)})}else{var c=a.control.active_element_i,d=a.control.tem_element_list[c];if(!a.data.element_data.job_method)return m.alert("请设置内容类型"),!1;if(1===a.data.element_data.job_method&&!a.data.element_data.comp_cn_name)return m.alert("请重配内容类型"),!1;a.data.element_data.config=!0;for(var e=0;e<a.info.category_list.length;e++){var f=a.info.category_list[e];if(f.category===d.category)for(var g=0;g<f.element_list.length;g++){var h=f.element_list[g];if(h.type===d.type&&h.element_id===d.element_id){h.element_info=a.data.element_data;break}}}a.control.config_element=!1,p()}},a.formCancel=function(){d.go("dispatch_scene_list")},u()}]),scene.controller("sceneDetailCtrl",["$scope","$stateParams","$location","$timeout","$state","Scene","ElementCategory","FlowJobType","dataBaseType","JobErrorType","RequestMethod","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b.scene_id?b.scene_id:"";a.info={basic_info:{},category_list:[]},a.control={active_element_i:-1,config_element:!1,tem_element_list:[]},a.data={element_data:{}};var o=function(b){b=b||{},a.data.element_data={exec_script:b.exec_script?b.exec_script:"",script_source:b.script_source?b.script_source:1,sql_source:b.sql_source?b.sql_source:1,dataBase_type:b.dataBase_type?b.dataBase_type:1,service_name:b.service_name?b.service_name:"",service_comm_info:b.service_comm_info?b.service_comm_info:"",config:b.config?b.config:!1,comp_cn_name:b.comp_cn_name?b.comp_cn_name:"",sdwork_cn_name:b.sdwork_cn_name?b.sdwork_cn_name:"",job_bk_desc:b.job_bk_desc?b.job_bk_desc:"",comp_id:b.comp_id?b.comp_id:"",input:b.input?b.input:[],output:b.output?b.output:[],comp_impl_type:b.comp_impl_type?b.comp_impl_type:"",datetime_condition:b.datetime_condition?b.datetime_condition:"",date_condition:b.date_condition?b.date_condition:"",h_condition:b.h_condition?b.h_condition:"",m_condition:b.m_condition?b.m_condition:"",timeused:b.timeused?b.timeused:"",pre_job_list:b.pre_job_list?b.pre_job_list:[],timeout:b.timeout?b.timeout:"",error_handle:b.error_handle?b.error_handle:1,retry_interval:b.retry_interval?b.retry_interval:"",retry_times:b.retry_times?b.retry_times:"",result_judge:b.result_judge?b.result_judge:"",job_method:b.job_method?b.job_method:0,env_name:b.env_name?b.env_name:"",language_name:b.language_name?b.language_name:"",language_version:b.language_version?b.language_version:"",operating_system:b.operating_system?b.operating_system:"",bit_number:b.bit_number?b.bit_number:"",annex_file:b.annex_file?b.annex_file:"",plugin_list:b.plugin_list?b.plugin_list:[],request_method:b.request_method?b.request_method:1}},p=function(){a.control.tem_element_list=[];for(var b=0;b<a.info.category_list.length;b++){var c=a.info.category_list[b];c.element_list=c.element_list?c.element_list:[];for(var d=0;d<c.element_list.length;d++){var e=c.element_list[d];e.category=e.category?e.category:c.category,e.element_id=c.category+"_"+d,e.element_info=e.element_info?e.element_info:{},a.control.tem_element_list.push(e)}}},q=function(b){var c=a.control.active_element_i;b!==c&&(-1!==c&&a.control.tem_element_list[c]&&(a.control.tem_element_list[c].active=!1),a.control.tem_element_list[b].active=!0,a.control.active_element_i=b)},r=function(b,c){for(var d,e=0;e<a.control.tem_element_list.length;e++){var f=a.control.tem_element_list[e];if(f.type===b&&f.element_id===c){d=e;break}}return d},s=function(){f.getSingleSceneDetail(n).then(function(b){d(function(){b.scene_info&&(b.scene_info.crt_bk_time=b.scene_info.crt_bk_date+" "+b.scene_info.crt_bk_time,a.info.basic_info=b.scene_info?b.scene_info:{},a.info.category_list=b.scene_bean.category_list?b.scene_bean.category_list:[],p())},0)},function(a){e.go("dispatch_scene_list"),l.alert(a.message)})};a.configElement=function(b,c,d){c.element_info=c.element_info||{},a.control.config_element=!0;var e=c.type,f=b+"_"+d,g=r(e,f);a.tabOne(g)},a.tabOne=function(b){q(b);var c=a.control.tem_element_list[b];a.curr_ele_category=c.category,a.curr_ele_type=c.type,o(c.element_info)},a.elementHightIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette/rep.png)";break;case 7:b="url(img/dispatch/fl/palette/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette/copy.png)";break;case 14:b="url(img/dispatch/fl/palette/sql.png)";break;case 15:b="url(img/dispatch/fl/palette/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette/net.png)";break;case 17:b="url(img/dispatch/fl/palette/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette/python.png)";break;case 20:b="url(img/dispatch/fl/palette/shell.png)";break;case 21:b="url(img/dispatch/fl/palette/bat.png)";break;case 22:b="url(img/dispatch/fl/palette/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette/perl.png)";break;case 24:b="url(img/dispatch/fl/palette/web.png)";break;case 25:b="url(img/dispatch/fl/palette/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette/http.png)";break;case 27:b="url(img/dispatch/fl/palette/tux.png)";break;case 28:b="url(img/dispatch/fl/palette/cl.png)";break;case 29:b="url(img/dispatch/fl/palette/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette/java.png)";break;case 31:b="url(img/dispatch/fl/palette/c.png)";break;case 32:b="url(img/dispatch/fl/palette/c++.png)";break;default:b="url(img/dispatch/fl/palette/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.elementIcon=function(){var b="",c="/45px";switch(a.curr_ele_type){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/context/condition.png)";break;case 5:b="url(img/dispatch/fl/context/stop.png)";break;case 6:b="url(img/dispatch/fl/context/rep.png)";break;case 7:b="url(img/dispatch/fl/context/ftpU.png)";break;case 8:b="url(img/dispatch/fl/context/ftpD.png)";break;case 9:b="url(img/dispatch/fl/context/sftpU.png)";break;case 10:b="url(img/dispatch/fl/context/sftpD.png)";break;case 11:b="url(img/dispatch/fl/context/zngtU.png)";break;case 12:b="url(img/dispatch/fl/context/zngtD.png)";break;case 13:b="url(img/dispatch/fl/context/copy.png)";break;case 14:b="url(img/dispatch/fl/context/sql.png)";break;case 15:b="url(img/dispatch/fl/context/sqlS.png)";break;case 16:b="url(img/dispatch/fl/context/web.png)";break;case 17:b="url(img/dispatch/fl/context/sysSt.png)";break;case 18:b="url(img/dispatch/fl/context/sysE.png)";break;case 19:b="url(img/dispatch/fl/context/python.png)";break;case 20:b="url(img/dispatch/fl/context/shell.png)";break;case 21:b="url(img/dispatch/fl/context/bat.png)";break;case 22:b="url(img/dispatch/fl/context/rb.png)";break;case 23:b="url(img/dispatch/fl/context/perl.png)";break;case 24:b="url(img/dispatch/fl/context/webs.png)";break;case 25:b="url(img/dispatch/fl/context/tcp.png)";break;case 26:b="url(img/dispatch/fl/context/http.png)";break;case 27:b="url(img/dispatch/fl/context/tux.png)";break;case 28:b="url(img/dispatch/fl/context/cl.png)";break;case 29:b="url(img/dispatch/fl/context/rpg.png)";break;case 30:b="url(img/dispatch/fl/context/java.png)";break;case 31:b="url(img/dispatch/fl/context/c.png)";break;case 32:b="url(img/dispatch/fl/context/c++.png)";break;default:b="url(img/dispatch/fl/context/ftpU.png)"}return{background:b+"no-repeat center"+c}},a.categoryTOCn=function(a){return m.findValue(a,g)},a.eleTypeTOCn=function(a){return a?m.findValue(a,h):"--"},a.categoryTOCn=function(a){return m.findValue(a,g)},a.databaseTypeTOCn=function(a){return m.findValue(a,i)},a.errorHandleTOCn=function(a){return m.findValue(a,j)},a.requestMethodTOCn=function(a){return m.findValue(a,k)},a.closeElementConfig=function(){a.control.config_element=!1,window.scroll({top:0})},a.viewScript=function(){l.setFlowJobMethod(a.curr_ele_type,a.data.element_data,!0)},a.backToSceneList=function(){e.go("dispatch_scene_list")},s()}]),scene.controller("sceneListCtrl",["$scope","$stateParams","$timeout","$state","ScrollBarConfig",function(a,b,c,d,e){a.viewSingleScene=function(a,b){d.go("dispatch_scene_list.single_scene",{scene_id:a,private_flag:b})},a.scene_list_scroll=e.Y(),a.calculateSceneInfoHeight=function(){return{height:$(".ui-view-content").height()-94}},a.calculateSceneListHeight=function(){return{height:$(".ui-view-content").height()-30}},$(window).resize(function(){c(function(){a.calculateSceneInfoHeight(),a.calculateSceneListHeight()},50)})}]),scene.controller("singleSceneInfoCtrl",["$scope","$stateParams","$timeout","ElementCategory","FlowJobType","Scene","Modal","CV",function(a,b,c,d,e,f,g,h){var i=b.scene_id||"",j=b.private_flag||!1;a.info={basic_info:{},scene_ele_list:[]},a.control={single_scene_loading:!1};var k=function(){i&&j&&(a.control.single_scene_loading=!0,f.getSingleSceneDetail(i,j).then(function(b){c(function(){a.control.single_scene_loading=!1,a.info.basic_info=b.scene_info,b.scene_bean&&(a.info.scene_ele_list=b.scene_bean.category_list?b.scene_bean.category_list:[])},0)},function(b){a.control.single_scene_loading=!1,a.info.scene_ele_list=[],g.alert(b.message)}))};a.elementHightIcon=function(a){var b="",c="/40px";switch(a){case 1:b="url(img/dispatch/fl/palette/start.png)";break;case 2:b="url(img/dispatch/fl/palette/end.png)";break;case 4:b="url(img/dispatch/fl/palette/condition.png)";break;case 5:b="url(img/dispatch/fl/palette/stop.png)";break;case 6:b="url(img/dispatch/fl/palette/rep.png)";break;case 7:b="url(img/dispatch/fl/palette/ftp_u.png)";break;case 8:b="url(img/dispatch/fl/palette/ftp_d.png)";break;case 9:b="url(img/dispatch/fl/palette/sftp_u.png)";break;case 10:b="url(img/dispatch/fl/palette/sftp_d.png)";break;case 11:b="url(img/dispatch/fl/palette/agnt_u.png)";break;case 12:b="url(img/dispatch/fl/palette/agnt_d.png)";break;case 13:b="url(img/dispatch/fl/palette/copy.png)";break;case 14:b="url(img/dispatch/fl/palette/sql.png)";break;case 15:b="url(img/dispatch/fl/palette/sql_s.png)";break;case 16:b="url(img/dispatch/fl/palette/net.png)";break;case 17:b="url(img/dispatch/fl/palette/sys_start.png)";break;case 18:b="url(img/dispatch/fl/palette/sys_end.png)";break;case 19:b="url(img/dispatch/fl/palette/python.png)";break;case 20:b="url(img/dispatch/fl/palette/shell.png)";break;case 21:b="url(img/dispatch/fl/palette/bat.png)";break;case 22:b="url(img/dispatch/fl/palette/ruby.png)";break;case 23:b="url(img/dispatch/fl/palette/perl.png)";break;case 24:b="url(img/dispatch/fl/palette/web.png)";break;case 25:b="url(img/dispatch/fl/palette/tcp.png)";break;case 26:b="url(img/dispatch/fl/palette/http.png)";break;case 27:b="url(img/dispatch/fl/palette/tux.png)";break;case 28:b="url(img/dispatch/fl/palette/cl.png)";break;case 29:b="url(img/dispatch/fl/palette/rpg.png)";break;case 30:b="url(img/dispatch/fl/palette/java.png)";break;case 31:b="url(img/dispatch/fl/palette/c.png)";break;case 32:b="url(img/dispatch/fl/palette/c++.png)";break;default:b="url(img/dispatch/fl/palette/ftp_u.png)"}return{background:b+"no-repeat center"+c}},a.eleTypeTOCn=function(a){return a?h.findValue(a,e):"--"},a.categoryTOCn=function(a){return h.findValue(a,d)},k()}]);var other=angular.module("dispatchOtherController",[]);other.controller("strategyListCtrl",["$scope","$timeout","Scene","Modal","CV",function(a,b,c,d,e){
a.newStrategyGroup=function(){d.newStrategyGroup().then(function(b){b&&a.$broadcast("updateTableDate",{})})}}]),other.controller("strategyDetailCtrl",["$scope","$stateParams","$state","$timeout","StrategyGroupType","Strategy","Modal","CV",function(a,b,c,d,e,f,g,h){var i=b.strategy_id?b.strategy_id:"",j={offset:0,limit:0,sdstrategy_id:i};a.info={sdstrategy_id:"",sdstrategy_name:"",sdstrategy_desc:"",sdstrategy_concurrent:2,sdpriority:5,sdstrategy_type:2};var k=function(){f.viewSingleStrategyGroup(i).then(function(b){d(function(){b.strategyInfo&&(a.info=b.strategyInfo,a.info.strategy_type_cn=h.findValue(a.info.sdstrategy_type,e),f.getFlowListByStrategyId(j).then(function(b){d(function(){b&&(a.info.flow_list=b.flow_list?b.flow_list:[])},0)},function(b){a.info.flow_err_msg=b.message}))},0)},function(a){g.alert(a.message),c.go("dispatch_strategy_list")})};k()}]),other.controller("reportListCtrl",["$scope","$rootScope","$location","$timeout","Flow","Charts","Modal","CV",function(a,b,c,d,e,f,g,h){var i=new Date,j={title:"",name:"流程数",info_name:"总流程数",total_num:0,data:[]},k={title:"任务总数",name:"任务数",info_name:"总流程数",total_num:0,data:[]},l={title:"",yAxis_name:"总笔数",columns:[{name:"总笔数",data:[]}]};a.info={maxDate:i,datepicker_start:{},datepicker_end:{},chart:{begin_date:"",end_data:"",chart_config:{}}},a.control={loading:!1,err_msg:"",has_data_flag:""},a.open=function(b){1==b?a.info.datepicker_start.opened=!0:2==b&&(a.info.datepicker_end.opened=!0)},a.getCountInfoByPeriod=function(){return h.valiForm(a.chart_form)?a.info.chart.begin_date>a.info.chart.end_date?(g.alert("开始时间大于结束时间，请重新选择"),!1):(a.control.loading=!0,a.info.chart.begin_date_fmt=h.dtFormat(a.info.chart.begin_date),a.info.chart.end_date_fmt=h.dtFormat(a.info.chart.end_date),void e.getReportInfoByDate(a.info.chart).then(function(b){d(function(){if(!b.task_count&&!b.flow_running&&!b.flow_failed)return void(a.control.has_data_flag=!1);a.control.has_data_flag=!0,b.flow_count=b.flow_count?b.flow_count:[],b.task_count=b.task_count?b.task_count:[],b.flow_running=b.flow_running?b.flow_running.sort(function(a,b){return b.count_num-a.count_num}):[],b.flow_failed=b.flow_failed?b.flow_failed.sort(function(a,b){return b.count_num-a.count_num}):[],k.total_num=0,j.total_num=0;for(var c=0;c<b.flow_count.length;c++)b.flow_count[c].name=1===b.flow_count[c].sddispatch_type?"手工":"定时",b.flow_count[c].y=b.flow_count[c].flow_num,j.total_num+=b.flow_count[c].flow_num;j.data=b.flow_count,j.title="流程总数 "+j.total_num,a.info.chart.chart_flow_config=f.getFlowPieConfig(j,300),a.info.chart.chart_flow_config.total_num=j.total_num;for(var d=0;d<b.task_count.length;d++)b.task_count[d].name=b.task_count[d].count_name,b.task_count[d].y=b.task_count[d].count_num?b.task_count[d].count_num:0,k.total_num+=b.task_count[d].y,"成功笔数"===b.task_count[d].count_name&&(b.task_count[d].color="#B0D364"),"失败笔数"===b.task_count[d].count_name&&(b.task_count[d].color="#F27772");k.data=b.task_count,k.title="任务总数 "+k.total_num,a.info.chart.chart_task_config=f.getFlowPieConfig(k,300),a.info.chart.chart_task_config.total_num=k.total_num;var e=angular.copy(l);a.control.has_data_flag=!0;for(var g=0;g<b.flow_running.length;g++)e.columns[0].data.push([b.flow_running[g].count_name,b.flow_running[g].count_num]);a.info.chart.chart_running_config=f.getFlowColumnConfig(e,300);var h=angular.copy(l);a.control.has_data_flag=!0;for(var i=0;i<b.flow_failed.length;i++)h.columns[0].data.push([b.flow_failed[i].count_name,b.flow_failed[i].count_num]);a.info.chart.chart_failed_config=f.getFlowColumnConfig(h,300)},0),a.control.loading=!1},function(b){a.control.loading=!1,a.control.err_msg=b.message})):!1}}]);var task=angular.module("taskMonitorController",["highcharts-ng","ui.bootstrap","ngCookies","CvService","DispatchHttpSrv","ChartsService","ModalCtrl","GlobalData"]);task.value("baseUrl","/clWeb/"),task.controller("taskMonitorCtrl",["$scope","$rootScope","$cookieStore","$location","$timeout","$interval","$window","OpTaskState","DispatchTaskMonitor","CommData","Charts","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q={title:"",color:"#FFF",border_width:10,split_color:"#162A40",inner_size:"67%",dataList:[]},r={title:"",color:"#FFF",border_width:2,split_color:"#162A40",inner_size:"67%",dataList:[]},s={title:"",color:"#FFF",border_width:2,split_color:"#162A40",inner_size:"67%",dataList:[]};a.control={loading:!1,change_flag:1,task_optype:1,view_node:!1,active_node_i:-1,monitor_error:!1,err_msg:"",node_err_msg:"",change_optype_loading:!1},a.info={statistics_info:{task_count:0,executing_count:0,will_execute_count:0,finished_count:0,success_count:0,fail_count:0,application_count:0,node_count:0},task_list:[],node_info:{node_basic_list:[],node_used_list:[],single_node:{basic_info:{},sys_info:{},process_list:[]}},task_basic_list:[],search_info:{key_word:"",node_ip:"",is_search:!1}},a.data={operation_data:[{op_type:1,text:"全部的"},{op_type:2,text:"收藏的"},{op_type:3,text:"正在执行的"},{op_type:4,text:"待执行的"},{op_type:5,text:"执行异常的"},{op_type:6,text:"执行成功的"}],tem_task_list:[]};var t=function(b){var c=a.control.active_node_i;b!=c&&(-1!=c&&(a.info.node_info.node_basic_list[c].active=!1,a.info.node_info.node_basic_list[c].one_node_timer&&f.cancel(a.info.node_info.node_basic_list[c].one_node_timer)),a.info.node_info.node_basic_list[b].active=!0,a.control.active_node_i=b)},u=function(a){if(a&&0!=a.length)for(var b=0,c=a.length;c>b;b++){var d=a[b],e={};if(!d.task_status||2==d.task_status)for(var f=0,g=d.exe_list.length;g>f;f++){var h=d.exe_list[f];h.task_status&&4!=h.task_status&&5!=h.task_status&&(h.job_num=h.job_num?h.job_num:0,h.job_exe_num=h.job_exe_num?h.job_exe_num:0,h.prog_rate=h.job_num?Math.floor(h.job_exe_num/h.job_num*100):0,h.percentage=h.prog_rate?h.prog_rate>=95?95:h.prog_rate:0);var i=h.percentage?h.percentage:0,j="";switch(h.task_status){case 1:case 2:case 6:case 8:case 9:j="#00B8FE";break;case 3:case 5:j="#FF7974";break;case 7:j="#FFA350";break;default:j="#0D638C"}e={title:7!=h.task_status?i+"%":"",percentage:i,color:j},h.exeConfig=k.getActivityConfig(e,46,46)}}},v=function(){var b=a.info.statistics_info;b.task_count=b.executing_count+b.will_execute_count+b.finished_count;var c=parseFloat(b.executing_count/b.task_count*100),d=parseFloat(b.will_execute_count/b.task_count*100),e=parseFloat(b.finished_count/b.task_count*100);q.dataList=[{name:"正在运行",y:c,color:"#F46EB6"},{name:"将要运行",y:d,color:"#07B9FD"},{name:"已完成的",y:e,color:"#26E9EE"}],a.circleConfig=k.getSplitPieConfig(q,180,180);for(var f=[],g=[],h=0;h<b.task_count;h++)h<b.success_count?f.push({name:"运行成功",y:parseFloat(b.success_count/b.task_count*100),color:"#B0D364"}):f.push({name:"运行失败",y:parseFloat(b.success_count/b.task_count*100),color:"transparent"}),h<b.fail_count?g.push({name:"运行失败",y:parseFloat(b.fail_count/b.task_count*100),color:"#F27772"}):g.push({name:"运行成功",y:parseFloat(b.fail_count/b.task_count*100),color:"transparent"});r.dataList=f,a.exeSucConfig=k.getSplitPieConfig(r,100,100),s.dataList=g,a.exeFailConfig=k.getSplitPieConfig(s,100,100)},w=function(b,c){var d=b.filter(function(a){return!a.task_status});0!=d.length&&a.info.task_list.push({is_expand:c,task_status:1,task_cn_status:"等待运行",exe_list:d})},x=function(b,c,d){var e=b.filter(function(a){return a.task_status&&4!=a.task_status&&5!=a.task_status});0!=e.length&&a.info.task_list.unshift({is_expand:c,task_status:2,task_cn_status:3>d?"正在运行":"",exe_list:e})},y=function(b,c){var d=b.filter(function(a){return 4==a.task_status||5==a.task_status});0!=d.length&&a.info.task_list.push({is_expand:c,task_status:3,task_cn_status:"运行结束",exe_list:d})},z=function(b,c,d){a.info.task_list=[],b=b||[],c=c||[];var e=c.length;if(0!=b.length){var f=!1,g=!1,h=0!=e?!1:!0;if(0!=e)for(var i=0,j=c.length;j>i;i++){var k=c[i];1==k.task_status?f=k.is_expand:2==k.task_status?h=k.is_expand:3==k.task_status&&(g=k.is_expand)}(1==d||2==d)&&(w(b,f,d),x(b,h,d),y(b,g,d)),d>2&&(a.info.task_list[0]={is_expand:!1,task_status:3==d?2:4==d?1:3,task_cn_status:"",exe_list:b})}},A=function(){0!=a.info.task_basic_list.length&&angular.forEach(a.info.task_basic_list,function(a){a.time_used_cn=a.task_time_used?m.usedCnTime(a.task_time_used):"0秒"})},B=function(b){a.info.task_list=[],a.control.change_optype_loading=!0,i.getTaskBasicInfoByOptype(a.control.task_optype).then(function(c){e(function(){a.info.task_basic_list=c.task_monitor_list?c.task_monitor_list:[],A(),z(a.info.task_basic_list,[],a.control.task_optype),u(a.info.task_list),b&&(a.data.tem_task_list=[],D(),E()),e(function(){a.control.change_optype_loading=!1},100)},0)},function(b){a.info.task_list=[],a.control.change_optype_loading=!1})},C=function(){i.gatAllNodeBasicInfo(a.info.search_info.key_word).then(function(b){e(function(){a.control.node_err_msg="",a.info.node_info.node_basic_list=b.node_basic_list?b.node_basic_list:[];for(var c=0;c<a.info.node_info.node_basic_list.length;c++){var d=a.info.node_info.node_basic_list[c];d.nodeBasicBean=d.nodeBasicBean?d.nodeBasicBean:{node_soft_msg:{},node_hard_msg:{}},d.nodeBasicBean.node_soft_msg.op_system_name=d.nodeBasicBean.node_soft_msg.op_system?d.nodeBasicBean.node_soft_msg.op_system.split(" ")[0]:"",d.nodeBasicBean.node_soft_msg.op_system_version=d.nodeBasicBean.node_soft_msg.op_system?d.nodeBasicBean.node_soft_msg.op_system.split(" ")[1]:""}b.node_basic_list&&F()},0)},function(b){a.control.node_err_msg=b.message})},D=function(){o=f(function(){i.getTaskStatisticsInfo().then(function(b){e(function(){a.info.statistics_info=b.taskNumBean,v()},0)},function(a){})},3e4)},E=function(){n=f(function(){i.getTaskBasicInfoByOptype(a.control.task_optype).then(function(b){e(function(){a.info.task_basic_list=b.task_monitor_list?b.task_monitor_list:[],A(),z(a.info.task_basic_list,a.data.tem_task_list,a.control.task_optype),u(a.info.task_list),a.control.monitor_error=!1},0)},function(b){a.control.monitor_error=!0})},5e3)},F=function(){i.monitorAllNodeUsedInfo(a.info.search_info.key_word).then(function(b){e(function(){var c=b.node_used_list?b.node_used_list:[];I(c),a.control.monitor_error=!1},0)},function(b){a.control.monitor_error=!0})},G=function(b){i.monitorOneNodeSysInfo(b).then(function(b){e(function(){a.info.node_info.single_node=angular.extend(a.info.node_info.single_node,{sys_info:b.sys_info})},0)},function(a){})},H=function(b,c){i.monitorOneNodeProgressInfo(b).then(function(b){e(function(){a.info.node_info.single_node=angular.extend(a.info.node_info.single_node,{basic_info:c,process_list:b.process_list?b.process_list:[]})},0)},function(a){})},I=function(b){for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<a.info.node_info.node_basic_list.length;e++){var f=a.info.node_info.node_basic_list[e];d.node_soc_ip===f.node_soc_ip&&(f.used_info=d)}},J=function(){F(),p=f(function(){F()},5e3)},K=function(){for(var b=-1,c=0;c<a.info.node_info.node_basic_list.length;c++){var d=a.info.node_info.node_basic_list[c];d.node_soc_ip===a.info.search_info.node_ip&&(b=c)}return b},L=function(){a.control.loading=!0,i.getTaskStatisticsInfo().then(function(b){e(function(){a.control.loading=!1,a.info.statistics_info=b.taskNumBean,v(),D(),B(),E(),e(function(){C()},2e3),e(function(){$("[data-toggle='tooltip']").tooltip()},500)},0)},function(b){a.control.loading=!1,a.control.err_msg=b.message,n&&f.cancel(n),l.confirm(a.control.err_msg+" [ 确认退出 ] ?").then(function(){g.location.href="../../../../login.html"})})};a.changeTask=function(b){if(a.control.change_flag!=b){a.control.change_flag=b,a.info.search_info.is_search=!1,a.info.search_info.key_word="";var c=a.control.active_node_i;1==a.control.change_flag?(a.control.view_node=!1,D(),E(),f.cancel(p),-1!=c&&f.cancel(a.info.node_info.node_basic_list[c].one_node_timer),e(function(){$("[data-toggle='tooltip']").tooltip()},100)):(f.cancel(o),f.cancel(n),J(),(a.control.node_err_msg||0===a.info.node_info.node_basic_list.length)&&C())}},a.changeTaskOpType=function(b){var c=a.control.task_optype;a.control.task_optype!=b&&($(".task-opicon-"+c).css({"background-color":"transparent"}),$(".task-opicon-"+b).css({"background-color":"#0080FF"}),a.control.task_optype=b,f.cancel(o),f.cancel(n),B(b))},a.recordExpandStatus=function(b,c){if(0==a.info.task_list.length)return!1;b.is_expand=!b.is_expand;var d=b.is_expand?b.is_expand:!1,e=b.task_status,f={task_status:e,is_expand:d},g=!1,h=0,i=$("#row-container-"+c);if(!i.is(":animated")){for(var j=0;j<a.data.tem_task_list.length;j++){var k=a.data.tem_task_list[j];if(k.task_status==f.task_status){g=!0,h=j;break}}g?a.data.tem_task_list[h].is_expand=d:a.data.tem_task_list.push(f),b.is_expand?i.animate({height:b.init_height+"px"},300):i.animate({height:"120px"},200)}},a.taskHeight=function(b,c){if(a.control.task_optype>2)return{height:"auto"};var d=$("#mointor-task-"+c),e=d.parent("div"),f=d.height();if(b.show_toggle_btn=f>125?!0:!1,b.init_height=f,b.is_expand){if(e.is(":animated"))return;return{height:"auto"}}},a.viewTaskProgress=function(){l.viewTaskProgressInfo()},a.operationSysIcon=function(a,b){var c={"background-size":b,"background-position-x":"0px"};switch(a){case 1:c["background-position-y"]="0px";break;case 2:c["background-position-y"]="-140px";break;case 3:c["background-position-y"]="-120px";break;case 4:c["background-position-y"]="-159px";break;case 5:c["background-position-y"]="-80px";break;case 6:c["background-position-y"]="-100px";break;case 7:c["background-position-y"]="-20px";break;case 8:c["background-position-y"]="-60px";break;case 9:c["background-position-y"]="-40px";break;default:c["background-position-y"]="-159px"}return c},a.searchNodeByKeyword=function(){a.info.search_info.is_search=!0,a.control.active_node_i=-1,C()},a.searchNodeByIp=function(b){var c=new RegExp("^(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|[1-9])\\.(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\.(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\.(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)$");e(function(){if(!a.info.search_info.node_ip)return l.alert("请输入ip"),!1;if(!c.test(a.info.search_info.node_ip))return l.alert("请重新输入ip"),!1;var b=K();return-1===b?(l.alert("暂无搜索结果"),!1):void(b!==a.control.active_node_i&&a.tabOne(b))},0)},a.tabOne=function(b){t(b);var c=a.info.node_info.node_basic_list[b],d=c.node_soc_ip;a.info.node_info.single_node.basic_info=c,G(d),H(d,c),c.one_node_timer=f(function(){G(d),H(d,c)},5e3)},a.viewNode=function(b){a.control.view_node=!0,a.info.search_info.is_search=!1,a.tabOne(b),p&&f.cancel(p)},a.closeNodeView=function(){a.control.view_node=!1;var b=a.control.active_node_i;a.info.node_info.node_basic_list[b].one_node_timer&&f.cancel(a.info.node_info.node_basic_list[b].one_node_timer),J()},a.clearAnimate=function(a){$("."+a).css("animate","none")},a.back=function(){g.history.back(),sessionStorage.removeItem("com_data")},L()}]);var bsCtrl=angular.module("SysController",[]);bsCtrl.controller("sysNewCtrl",["$scope","$state","$location","$timeout","Sys","DataSource","ScrollConfig","Collection","Proj","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){a.info={sys:{sys_name:"",sys_cn_name:"",platform_sys_name:"",package_gain_type:1,agent_flag:2,version_soc_name:"",dftpropac_bk_dir:"",dftprolst_bk_dir:"",response_person_error_msg:"",channel_name:""},sys_form:{}},a.data={response_person_list:[],response_person_name_list:[],ver_soc_list:[],channel_list:[]},a.control={save_btn_loading:!1,get_response_person_loading:!0,get_channel_loading:!1,no_response_person:!1,show_layer:!1},a.config={scroll_sys_info:g};var l=function(b){var c={business_sys_name:b.sys_name,business_cn_name:b.sys_cn_name,version_soc_name:b.version_soc_name,platform_sys_name:b.platform_sys_name,package_gain_type:parseInt(b.package_gain_type),agent_flag:parseInt(b.agent_flag),dftpropac_bk_dir:b.dftpropac_bk_dir,dftprolst_bk_dir:b.dftprolst_bk_dir,user_ids:[]};return c.user_ids=[],angular.forEach(a.data.response_person_name_list,function(a,b,d){c.user_ids.push(a.user_id)}),(a.info.sys.sys_root_path||a.info.sys.dftpropac_bk_dir||a.info.sys.dftprolst_bk_dir)&&("/"!=a.info.sys.dftpropac_bk_dir.slice(-1)&&(c.dftpropac_bk_dir+="/"),"/"!=a.info.sys.dftprolst_bk_dir.slice(-1)&&(c.dftprolst_bk_dir+="/")),c},m=function(){f.getVerDataSources().then(function(b){d(function(){a.data.ver_soc_list=b.soc_list?b.soc_list:[]},0)},function(a){j.alert(a.message,3)}),i.getAllExcutedUser().then(function(b){a.data.response_person_list=b.dept_user_list?b.dept_user_list:[],a.data.response_person_list.length>0&&(a.data.response_person_list[0].show_user=!0),a.control.get_response_person_loading=!1},function(b){a.info.sys.response_person_error_msg=b.message,a.control.get_response_person_loading=!1})};a.configSocDir=function(b,c){a.info.sys.version_soc_name?j.configVersionDir(b,c).then(function(c){1==b?a.info.sys.dftpropac_bk_dir=c?c:"":a.info.sys.dftprolst_bk_dir=c?c:""}):j.alert("请先配置版本机数据源",3)},a.choosePackageMethod=function(b){2!=b&&(a.info.sys.version_soc_name="",a.info.sys.dftpropac_bk_dir="",a.info.sys.dftprolst_bk_dir="")},a.selectResponsePerson=function(b,c){if(b.checked=!b.checked,b.dept_cn_name=c.dept_cn_name,b.checked)a.data.response_person_name_list.push(b);else for(var d=0;d<a.data.response_person_name_list.length;d++){var e=a.data.response_person_name_list[d];if(b.user_id===e.user_id){a.data.response_person_name_list.splice(d,1);break}}},a.removeResponsePerson=function(b,c){a.data.response_person_name_list.splice(b,1);for(var d=0;d<a.data.response_person_list.length;d++){var e=a.data.response_person_list[d];e.user_list=e.user_list?e.user_list:[];for(var f=0;f<e.user_list.length;f++){var g=e.user_list[f];if(g.user_id===c){g.checked=!1;break}}}},a.save=function(){if(a.info.sys.response_person_error_msg)return!1;if(!k.valiForm(a.info.sys_form))return!1;if(0==a.data.response_person_name_list.length)return a.control.no_response_person=!0,!1;var c=l(a.info.sys);a.control.save_btn_loading=!0,e.saveSysInfo(c).then(function(c){a.control.save_btn_loading=!1,j.alert("应用系统添加成功",2),b.go("sys_list")},function(b){j.alert(b.message,3),a.control.save_btn_loading=!1})},a.back=function(){b.go("sys_list")},m()}]),bsCtrl.controller("sysModifyCtrl",["$scope","$state","$stateParams","$location","$timeout","Sys","ScrollConfig","DataSource","Collection","Proj","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=c.sys_id;a.info={sys:{sys_name:"",sys_cn_name:"",version_soc_name:"",dftpropac_bk_dir:"",dftprolst_bk_dir:"",agent_flag:2,package_gain_type:1,response_person_error_msg:"",old_sys_cn_name:"",channel_name:""},sys_form:{}},a.data={response_person_list:[],response_person_name_list:[],ver_soc_list:[],channel_list:[]},a.control={get_response_person_loading:!1,no_response_person:!1,show_layer:!1,save_btn_loading:!1,isUpdate:!0},a.config={scroll_sys_info:g};var n=function(b){var c={business_sys_name:b.sys_name,business_cn_name:b.sys_cn_name,version_soc_name:b.version_soc_name,platform_sys_name:b.platform_sys_name,package_gain_type:parseInt(b.package_gain_type),agent_flag:parseInt(b.agent_flag),dftpropac_bk_dir:b.dftpropac_bk_dir,dftprolst_bk_dir:b.dftprolst_bk_dir,user_ids:[]};return c.user_ids=[],angular.forEach(a.data.response_person_name_list,function(a,b,d){c.user_ids.push(a.user_id)}),(a.info.sys.sys_root_path||a.info.sys.dftpropac_bk_dir||a.info.sys.dftprolst_bk_dir)&&("/"!=a.info.sys.dftpropac_bk_dir.slice(-1)&&(c.dftpropac_bk_dir+="/"),"/"!=a.info.sys.dftprolst_bk_dir.slice(-1)&&(c.dftprolst_bk_dir+="/")),c},o=function(){f.getSysInfo(m).then(function(b){e(function(){b.dftpropac_bk_dir&&"/"!=b.dftpropac_bk_dir.slice(-1)&&(b.dftpropac_bk_dir+="/"),b.dftprolst_bk_dir&&"/"!=b.dftprolst_bk_dir.slice(-1)&&(b.dftprolst_bk_dir+="/"),a.info.sys={sys_name:b.business_sys_name||"",sys_cn_name:b.business_cn_name||"",platform_sys_name:b.platform_sys_name||"",package_gain_type:b.package_gain_type||1,agent_flag:b.agent_use_flag||2,version_soc_name:b.version_soc_name||"",dftpropac_bk_dir:b.dftpropac_bk_dir||"",dftprolst_bk_dir:b.dftprolst_bk_dir||"",user_ids:b.user_ids||[]},a.info.sys.old_sys_name=a.info.sys.sys_name,a.control.get_response_person_loading=!0,j.getAllExcutedUser().then(function(b){if(a.control.get_response_person_loading=!1,a.data.response_person_list=b.dept_user_list?b.dept_user_list:[],a.data.response_person_list.length>0&&(a.data.response_person_list[0].show_user=!0),a.info.sys.user_ids)for(var c=0;c<a.info.sys.user_ids.length;c++)for(var d=a.info.sys.user_ids[c],e=0;e<a.data.response_person_list.length;e++){var f=a.data.response_person_list[e];f.user_list=f.user_list?f.user_list:[];for(var g=0;g<f.user_list.length;g++){var h=f.user_list[g];d===h.user_id&&(h.checked=!0,a.data.response_person_name_list.push({dept_cn_name:f.dept_cn_name,user_cn_name:h.user_cn_name,user_id:h.user_id}))}}},function(b){a.info.sys.response_person_error_msg=b.message,a.control.get_response_person_loading=!1})},0)},function(a){k.alert(a.message,3)}),h.getVerDataSources().then(function(b){e(function(){a.data.ver_soc_list=b.soc_list?b.soc_list:[]},0)},function(a){k.alert(a.message,3)})};a.configSocDir=function(b,c){a.info.sys.version_soc_name?k.configVersionDir(b,c).then(function(c){1==b?a.info.sys.dftpropac_bk_dir=c?c:"":a.info.sys.dftprolst_bk_dir=c?c:""}):k.alert("请先配置版本机数据源",3)},a.choosePackageMethod=function(b){2!=b&&(a.info.sys.version_soc_name="",a.info.sys.dftpropac_bk_dir="",a.info.sys.dftprolst_bk_dir="")},a.selectResponsePerson=function(b,c){if(b.checked=!b.checked,b.dept_cn_name=c.dept_cn_name,b.checked)a.data.response_person_name_list.push(b);else for(var d=0;d<a.data.response_person_name_list.length;d++){var e=a.data.response_person_name_list[d];if(b.user_id===e.user_id){a.data.response_person_name_list.splice(d,1);break}}},a.removeResponsePerson=function(b,c){a.data.response_person_name_list.splice(b,1);for(var d=0;d<a.data.response_person_list.length;d++){var e=a.data.response_person_list[d];e.user_list=e.user_list?e.user_list:[];for(var f=0;f<e.user_list.length;f++){var g=e.user_list[f];if(g.user_id===c){g.checked=!1;break}}}},a.save=function(){if(a.info.sys.response_person_error_msg)return!1;if(!l.valiForm(a.info.sys_form))return!1;if(0==a.data.response_person_name_list.length)return a.control.no_response_person=!0,!1;var c=n(a.info.sys);a.control.save_btn_loading=!0,f.updateSysInfo(c).then(function(c){a.control.save_btn_loading=!1,k.alert("应用系统修改成功",2),b.go("sys_list")},function(b){k.alert(b.message,3),a.control.save_btn_loading=!1})},a.back=function(){b.go("sys_list")},o()}]),bsCtrl.controller("sysDetailCtrl",["$scope","$state","$stateParams","$location","$timeout","Sys","DataSource","Collection","Proj","Modal",function(a,b,c,d,e,f,g,h,i,j){var k=c.sys_id;a.info={sys:{}},a.data={response_person_name_list:[]};var l=function(){f.getSysInfo(k).then(function(b){e(function(){b.dftpropac_bk_dir&&"/"!=b.dftpropac_bk_dir.slice(-1)&&(b.dftpropac_bk_dir+="/"),b.dftprolst_bk_dir&&"/"!=b.dftprolst_bk_dir.slice(-1)&&(b.dftprolst_bk_dir+="/"),a.info.sys={sys_name:b.business_sys_name||"",sys_cn_name:b.business_cn_name||"",platform_sys_name:b.platform_sys_name||"",package_gain_type:b.package_gain_type||1,agent_flag:b.agent_use_flag||2,version_soc_name:b.version_soc_name||"",dftpropac_bk_dir:b.dftpropac_bk_dir||"",dftprolst_bk_dir:b.dftprolst_bk_dir||"",user_ids:b.user_ids||[],response_person_name_str:b.user_cn_name||"",channel_name:b.channel_name||""},a.data.response_person_name_list=a.info.sys.response_person_name_str?a.info.sys.response_person_name_str.split(","):[]},0)},function(a){j.alert(a.message,3),b.go("sys_list")})};a.back=function(){b.go("sys_list")},l()}]),bsCtrl.controller("sysConfigCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","Sys",function(a,b,c,d,e,f,g,h){var i,j=c.sys_id;a.sys_info={},a.control={active_tab:""};var k=function(a){for(var b="struct_config",c=["struct_config","env_config","program_list","log_list","struct_add","env_add","program_tab"],d=0;d<c.length;d++){var e=a.search(c[d]);if(e>0){b=c[d%4];break}}return b},l=function(b){h.getSysInfo(b).then(function(b){g(function(){b&&(a.sys_info=b)},0)})},m=function(){l(j),i=e.absUrl(),a.control.active_tab=k(i),a.switchTab(a.control.active_tab)};a.switchTab=function(c){a.control.active_tab=c,"struct_config"==c&&b.go("sys_config.struct_config"),"env_config"==c&&b.go("sys_config.env_config_list"),"program_list"==c&&b.go("sys_config.program_list"),"log_list"==c&&b.go("sys_config.log_list")},m()}]),bsCtrl.controller("structConfigCtrl",["$scope","$state","$stateParams","$rootScope","$location","$timeout","$interval","ScrollConfig","Struct","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=c.sys_id,n=void 0,o=!1;a.data={palette:{webPalette:[{category:"cNode",logical_node_type:1,text:"通用",config_flag:!1},{category:"cNode",logical_node_type:2,text:"WAS",config_flag:!1},{category:"cNode",logical_node_type:3,text:"WEBLOGIC",config_flag:!1},{category:"cNode",logical_node_type:4,text:"数据库",config_flag:!1},{category:"cNode",logical_node_type:5,text:"AS400",config_flag:!1},{category:"cNode",logical_node_type:6,text:"SVN",config_flag:!1}]},deploy_list:[{deploy_type:1,label:"主备",state:!1},{deploy_type:2,label:"集群",state:!1},{deploy_type:3,label:"池",state:!1},{deploy_type:4,label:"单机",state:!1}]},a.info={nodeDataArray:[],linkDataArray:[],logic_node_info:{},form:{}},a.control={palette_w_flag:!1,protab_basic_flag:!0,reflash_node:!1,clear_select_flag:!1,save_info_loading:!1,data_loading:!1},a.configs={scroll_info:h,node_info:h},a.paramShellLoaded=function(a){j.setParamsEditor(a)};var p=function(){a.info.logic_node_info={basic_msg:{node_name:"",deploy_type:1,pac_type_list:[],config_file_list:[]},config_flag:!1,logical_node_type:1}},q=function(){a.control.data_loading=!0,p(),i.getStructMsg(m).then(function(b){if(b.struct_bean){o=!0,a.info.linkDataArray=b.struct_bean.struct_link_list,a.info.nodeDataArray=b.struct_bean.struct_node_list;for(var c=0;c<a.info.nodeDataArray.length;c++)a.info.nodeDataArray[c].text=a.info.nodeDataArray[c].basic_msg.node_name,a.info.nodeDataArray[c].old_flag=!0}a.control.data_loading=!1},function(a){k.alert(a.message,3)})};a.nodeConfig=function(b){if(p(),n=b.key,b.basic_msg){a.info.logic_node_info.basic_msg=b.basic_msg,a.info.logic_node_info.basic_msg.pac_type_list||(a.info.logic_node_info.basic_msg.pac_type_list=[]),a.info.logic_node_info.basic_msg.config_file_list||(a.info.logic_node_info.basic_msg.config_file_list=[]);for(var c=0;c<a.data.deploy_list.length;c++){var d=a.data.deploy_list[c];d.deploy_type==b.basic_msg.deploy_type?d.state=!0:d.state=!1}}a.info.logic_node_info.basic_msg.fixed_param_list||i.getStructParamsByType(b.logical_node_type,m).then(function(b){a.info.logic_node_info.basic_msg.fixed_param_list=b.fixed_param_list?b.fixed_param_list:[]},function(a){k.alert(a.message,3)})},a.chooseDeployType=function(b){for(var c=0;c<a.data.deploy_list.length;c++){var d=a.data.deploy_list[c];d.deploy_type==b.deploy_type?(b.state=!b.state,b.state?a.info.logic_node_info.basic_msg.deploy_type=b.deploy_type:a.info.logic_node_info.basic_msg.deploy_type=0):d.state=!1}},a.addPackage=function(){if(0!=a.info.logic_node_info.basic_msg.pac_type_list.length)for(var b=0;b<a.info.logic_node_info.basic_msg.pac_type_list.length;b++)if(!a.info.logic_node_info.basic_msg.pac_type_list[b].type_name)return k.alert("类型包名不能为空",3),!1;a.info.logic_node_info.basic_msg.pac_type_list.push({type_name:"",type_cn_name:"",param_name:"",delete_flag:!0})},a.deletePackageType=function(b,c){var d=c.type_name?c.type_name:"";k.confirm("确认删除 "+d+" ?").then(function(){a.info.logic_node_info.basic_msg.pac_type_list.splice(b,1)})},a.addConfigFile=function(){if(0!=a.info.logic_node_info.basic_msg.config_file_list.length)for(var b=0;b<a.info.logic_node_info.basic_msg.config_file_list.length;b++)if(!a.info.logic_node_info.basic_msg.config_file_list[b].file_name)return k.alert("文件名不能为空",3),!1;a.info.logic_node_info.basic_msg.config_file_list.push({file_name:"",delete_flag:!0})},a.deleteConfigFile=function(b,c){var d=c.file_name?c.file_name:"";k.confirm("确认删除 "+d+" ?").then(function(){a.info.logic_node_info.basic_msg.config_file_list.splice(b,1)})},a.addParam=function(){a.info.logic_node_info.basic_msg.fixed_param_list.push({param_name:"",param_bk_desc:"",delete_flag:!1,sensitive_flag:!1,param_value:""})},a.deleteParam=function(b){a.info.logic_node_info.basic_msg.fixed_param_list.splice(b,1)},a.saveTab=function(){if(!l.valiForm(a.info.form.node_form))return!1;for(var b=0;b<a.info.nodeDataArray.length;b++){var c=a.info.nodeDataArray[b];c.key==n&&(c.basic_msg=a.info.logic_node_info.basic_msg,c.config_flag=!0,a.control.reflash_node=!a.control.reflash_node),c.old_flag&&(o=!0)}a.basicCancel()},a.basicCancel=function(){$(".configDiv").animate({height:"0px"},300,function(){$(".configDiv").css("display","none"),p(),n=void 0;for(var b=0;b<a.data.deploy_list.length;b++)a.data.deploy_list[b].state=!1;a.info.form.node_form.$setPristine(),a.control.clear_select_flag=!a.control.clear_select_flag})},a.saveStructMsg=function(){var b={struct_node_list:a.info.nodeDataArray,struct_link_list:a.info.linkDataArray,system_id:m};return 0==a.info.nodeDataArray.length?(k.alert("请至少选择一个逻辑节点！",3),!1):(a.control.save_info_loading=!0,void(o?i.checkStructModify(m,b).then(function(c){if(c.flag){var d="当前架构有挂载环境，确认修改！";k.confirm(d).then(function(c){return c?void i.saveStructMsg(b).then(function(b){b&&(a.control.save_info_loading=!1,k.alert("修改成功！",2))},function(b){a.control.save_info_loading=!1,k.alert(b.message,3)}):void(a.control.save_info_loading=!1)})}else i.saveStructMsg(b).then(function(b){b&&(a.control.save_info_loading=!1,k.alert("修改成功！",2))},function(b){a.control.save_info_loading=!1,k.alert(b.message,3)})},function(b){a.control.save_info_loading=!1,k.alert(b.message,3)}):i.saveStructMsg(b).then(function(b){b&&(a.control.save_info_loading=!1,k.alert("保存成功！",2))},function(b){a.control.save_info_loading=!1,k.alert(b.message,3)})))},a.syncHeight=function(){return{height:$(".ui-view-content").height()-160}},$(window).resize(function(){f(function(){a.syncHeight()},50)}),q()}]),bsCtrl.controller("envConfigListCtrl",["$scope","$state","$stateParams","$rootScope","$location","$timeout","$interval","ScrollBarConfig","EnvType","EnvConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=c.sys_id,n="",o="";a.info={basic_info:{env_name:"",env_type:""},env_type_list:[],env_info:{},sys_id:m},a.data={env_type_list:i},a.control={env_select_flag:!1},a.config={scroll_info:h.Y()};var p=function(){j.getEnvList(m).then(function(c){if(a.info.env_type_list=c.env_bean_list?c.env_bean_list:[],angular.forEach(a.info.env_type_list,function(a){a.env_type_cn=l.findValue(a.env_type,i),angular.forEach(a.env_list,function(a){a.active=!1})}),0!=a.info.env_type_list.length&&a.info.env_type_list[0].env_list){var d=a.info.env_type_list[0].env_list[0];d.active=!0;var e=d.env_id;a.info.env_info=d,a.control.env_select_flag=!0,b.go("sys_config.env_config_list.env_config_new",{env_id:e,env_modify_flag:2})}},function(a){k.alert(a.message,3)})};a.syncHeight=function(){return{height:$(".ui-view-content").height()-140}},a.selectEnv=function(c){angular.forEach(a.info.env_type_list,function(a){a.env_type_cn=l.findValue(a.env_type,i),angular.forEach(a.env_list,function(a){a.active=!1})}),c.active=!c.active,c.active?(n=c.env_id,o=c.env_name):(n="",o=""),a.control.env_select_flag=!0,a.info.env_info=c,b.go("sys_config.env_config_list.env_config_new",{env_id:n,env_modify_flag:2})},a.setWidthByType=function(){var b=a.info.env_type_list.length;if(b>0){var c=parseFloat(100/b);return{width:c+"%"}}},a.envDelete=function(c,d){d.stopPropagation(),k.confirm("确认删除"+c.env_name+"?").then(function(d){d&&j.deleteEnv(m,c.env_id).then(function(d){k.alert(c.env_name+"环境删除成功！",2),a.control.env_select_flag=!1;for(var e=!1,f=0;f<a.info.env_type_list.length;f++){for(var g=a.info.env_type_list[f],h=0;h<g.env_list.length;h++){var i=g.env_list[h];if(i.env_id==c.env_id){g.env_list.splice(h,1),0==g.env_list.length&&a.info.env_type_list.splice(f,1),e=!0;break}}if(e)break}a.info.env_info={},b.go("sys_config.env_config_list",{sys_id:m})},function(a){k.alert(a.message,3)})})},a.addEnv=function(){a.control.env_select_flag=!0,b.go("sys_config.env_config_list.env_config_new",{
env_id:"",env_modify_flag:3})},$(window).resize(function(){f(function(){a.syncHeight()},10)}),p()}]),bsCtrl.controller("envConfigNewCtrl",["$scope","$state","$stateParams","$rootScope","$location","$timeout","$interval","ScrollBarConfig","CodeMirrorOption","EnvType","ProtocolType","EnvConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o="",p=a.info.sys_id?a.info.sys_id:"",q=c.modify_flag?+c.modify_flag:3,r=c.env_id?c.env_id:"";a.form={env_form:{},config_form:{}},angular.extend(a.info,{basic_info:{env_name:"",env_type:""},struct_info:{nodeDataArray:[],linkDataArray:[]},node_list:[],node_info:{},current_ip:"",logic_node:"",agent_flag:0}),angular.extend(a.control,{basic_save:!1,struct_msg_loading:!0,node_clear_flag:!1,logic_node_reflash:!1,env_detail_flag:!1}),a.data={env_type_list:j,server_list:[],file_soc_list:[],exe_soc_list:[],agent_user_list:[]},a.config={scroll_info:h.Y()};var s=function(){l.getEnvMsg(r,p).then(function(b){a.info.struct_info.nodeDataArray=b.struct_bean.struct_node_list||[],a.info.struct_info.linkDataArray=b.struct_bean.struct_link_list||[],a.info.agent_flag=b.agent_flag,a.control.struct_msg_loading=!1;for(var c=0;c<a.info.struct_info.nodeDataArray.length;c++){var d=a.info.struct_info.nodeDataArray[c];d.text=d.basic_msg.node_name,d.node_list=d.node_list||[],""===r&&(d.config_flag=!1)}""!==r&&(a.info.basic_info.env_name=b.env_basic_bean.env_name||"",a.info.basic_info.env_type=b.env_basic_bean.env_type||"",a.info.basic_info.env_id=b.env_basic_bean.env_id||"",a.info.env_info=b.env_basic_bean||{},a.control.basic_save=!0,r=a.info.env_info.env_id),0===a.info.struct_info.nodeDataArray.length&&(a.control.basic_save=!0,m.alert("无架构信息,请检查是否已配置系统架构",3))},function(b){a.control.struct_msg_loading=!1,m.alert(b.message,3)})},t=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.lable=n.findValue(c.protocol_type,k).toLowerCase()+" "+c.user_name+"@"+c.soc_ip}},u=function(){for(var b=!1,c=-1,d=0;d<a.info.env_type_list.length;d++){var e=a.info.env_type_list[d];if(e.env_type==a.info.env_info.env_type){c=d;for(var f=0;f<e.env_list.length;f++)if(e.env_list[f].env_id===a.info.env_info.env_id){b=!0,e.env_list[f]=angular.extend(a.info.env_info,{active:!1,pub_flag:2});break}if(b)break}}if(-1===c&&!b){var g={env_type:a.info.env_info.env_type,env_type_cn:n.findValue(a.info.env_info.env_type,j),env_list:[angular.extend(a.info.env_info,{active:!0,pub_flag:2})]};a.info.env_type_list.push(g)}-1===c||b||a.info.env_type_list[c].env_list.push(angular.extend(a.info.env_info,{active:!0,pub_flag:2}))},v=function(){for(var b="",c=!0,d=0;d<a.info.struct_info.nodeDataArray.length;d++){var e=a.info.struct_info.nodeDataArray[d];if(!e.config_flag){b=e.text?" ["+e.text+"] ":"",c=!1;break}}return c||m.alert("架构"+b+"配置不完整",3),c},w=function(b){b=b||[];for(var c=function(){for(var a=0!==b.length,c=0;c<b.length;c++)if(!b[c].config_flag){a=!1;break}return a},d=0;d<a.info.struct_info.nodeDataArray.length;d++){var e=a.info.struct_info.nodeDataArray[d];e.key===o&&(e.config_flag=c())}},x=function(){1===q?a.control.env_detail_flag=!0:2===q?(a.control.env_detail_flag=!1,a.control.basic_save=!0):(a.control.env_detail_flag=!1,a.control.basic_save=!1),l.getAllServerIp().then(function(b){a.data.server_list=b.server_bean_list||[]},function(a){m.alert("获取服务器信息异常",3)}),s()};a.paramShellLoaded=function(a){i.setParamsEditor(a)},a.addNode=function(){var b;f(function(){for(var c=0;c<a.data.server_list.length;c++){var d=a.data.server_list[c];a.info.current_ip===d.server_ip&&(b=d)}if(b){for(var e=!1,f=0;f<a.info.node_list.length;f++){var g=a.info.node_list[f];g.active=!1,a.info.current_ip===g.ip&&(g.active=!0,e=!0)}e||(1==a.info.agent_flag&&3!=b.agent_status?(m.alert("该系统使用agent，节点"+b.server_ip+"未部署agent，请先部署。",3),a.info.current_ip=""):(a.info.node_list.push({ip:b.server_ip,agent_status:b.agent_status,config_flag:!1,active:!0,main_standby_flag:!0}),a.info.node_info={ip:b.server_ip,agent_status:b.agent_status,config_flag:!1,active:!0,main_standby_flag:!0},a.configPhysicNode(a.info.node_info,1)))}},300),angular.equals(a.form.config_form||{},{})||a.form.config_form.$setPristine()},a.selectSoc=function(b,c){if(1==c)for(var d=0;d<a.data.file_soc_list.length;d++){var e=a.data.file_soc_list[d];e.soc_name==b&&(a.info.node_info.file_protocol_type=e.protocol_type)}else for(var f=0;f<a.data.exe_soc_list.length;f++){var g=a.data.exe_soc_list[f];g.soc_name==b&&(a.info.node_info.execute_protocol_type=g.protocol_type)}},a.saveAllMsg=function(){if(!n.valiForm(a.form.env_form))return!1;if($(".config-properties-container").height()>10&&a.info.node_info.ip&&!n.valiForm(a.form.config_form))return!1;if(!v())return!1;var b={env_type:a.info.basic_info.env_type,env_name:a.info.basic_info.env_name,sys_id:p,env_id:r};l.addEnvMsg(b,a.info.struct_info).then(function(c){a.control.basic_save=!0,b.env_id=b.env_id?b.env_id:c.env_id,r=b.env_id?b.env_id:c.env_id,a.info.env_info=b,u(),a.info.env_info={},a.control.env_select_flag=!1,m.alert(2==q?"["+b.env_name+"] 修改成功":"["+b.env_name+"] 保存成功",2)},function(a){m.alert(a.message)})},a.configPhysicNode=function(b,c){1==a.info.agent_flag?(b.execute_soc_name="",b.file_soc_name="",b.execute_protocol_type="",b.file_protocol_type=""):b.agent_user="",a.data.file_soc_list=[],a.data.exe_soc_list=[],a.data.agent_user_list=[],b.active=!0,a.info.node_info=angular.copy(b),a.info.current_ip=b.ip;for(var d=0;d<a.info.node_list.length;d++){var e=a.info.node_list[d];e.active=e.ip===b.ip}a.info.node_info.config_flag||l.getLogicalParamListByEnvId(a.info.logic_node.logical_node_id,p).then(function(b){a.info.node_info.fixed_param_list=b.env_param_bean.fixed_param_list||[]},function(a){m.alert(a.message,3)}),1==a.info.agent_flag?l.getAgentUserName(b.ip).then(function(b){a.data.agent_user_list=b.user_list||[]},function(a){m.alert(a.message,3)}):l.getFileAndExecSocList(b.ip,a.info.logic_node.logical_node_type).then(function(b){a.data.file_soc_list=b.file_soc_list?b.file_soc_list:[],a.data.exe_soc_list=b.exec_soc_list?b.exec_soc_list:[],t(a.data.file_soc_list),t(a.data.exe_soc_list)},function(a){}),a.info.current_ip=""},a.saveNode=function(){if(!n.valiForm(a.form.config_form))return!1;for(var b=0;b<a.info.node_list.length;b++)a.info.node_list[b].ip===a.info.node_info.ip&&(a.info.node_info.active=!1,a.info.node_list[b]=a.info.node_info,a.info.node_list[b].config_flag=!0);for(var c=0;c<a.info.struct_info.nodeDataArray.length;c++)a.info.struct_info.nodeDataArray[c].key===o&&(a.info.struct_info.nodeDataArray[c].node_list=a.info.node_list,a.control.logic_node_reflash=!a.control.logic_node_reflash);w(a.info.node_list),a.info.current_ip="",a.info.node_info={}},a.cancelNodeConfig=function(){for(var b=0;b<a.info.node_list.length;b++){var c=a.info.node_list[b];c.ip===a.info.node_info.ip&&(c.active=!1)}w(a.info.node_list),a.info.current_ip="",a.info.node_info={}},a.deleteNode=function(b){for(var c=0;c<a.info.node_list.length;c++)if(b===a.info.node_list[c].ip){a.info.node_list.splice(c,1);break}w(a.info.node_list),a.info.current_ip="",a.info.node_info={}},a.configNode=function(b){a.info.logic_node=b,o=b.key,a.info.node_list=b.node_list?b.node_list:[],a.info.node_info={};for(var c=0;c<a.info.node_list.length;c++)0===c?(a.info.node_list[c].active=!0,a.configPhysicNode(a.info.node_list[c],2)):a.info.node_list[c].active=!1},a.saveCancel=function(){w(a.info.node_list),a.control.node_clear_flag=!a.control.node_clear_flag,$(".config-properties-container").animate({height:"0px"},400,function(){o="",a.info.node_list=[],a.info.current_ip="",a.info.node_info={},a.info.logic_node={},angular.equals(a.form.config_form||{},{})||a.form.config_form.$setPristine()})},a.envPub=function(){m.confirm("确认发布"+a.info.env_info.env_name+"?").then(function(b){b&&l.publishEnv(p,a.info.env_info.env_id,1).then(function(b){for(var c=!1,d=0;d<a.info.env_type_list.length;d++){for(var e=a.info.env_type_list[d],f=0;f<e.env_list.length;f++){var g=e.env_list[f];if(g.env_id==a.info.env_info.env_id){a.info.env_type_list[d].env_list[f].pub_flag=1,c=!0;break}}if(c)break}m.alert(a.info.env_info.env_name+"环境发布成功！",2)},function(a){m.alert(a.message,3)})})},x()}]),bsCtrl.controller("programListCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","BusiSys","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M){var N=c.sys_id;a.data={progs:[]},a.info={prog_load_error_message:""};var O=function(b){j.getAllProgramList(b).then(function(b){g(function(){b&&(a.info.prog_load_error_message="",a.data.progs=b.program_list?b.program_list:[])},0)},function(b){a.info.prog_load_error_message=b.message})},P=function(){O(N)};a.paramListPacPos=function(a){g(function(){var b=$(".program-list"+a+" .param-list-pac"),c=0;$.each(b,function(d,e){c+=$(this).width()+28,224>=c&&d+1==b.length?$(".program-list"+a+" .param-list-fix").css({display:"none"}):c+37>224&&($(".program-list"+a+" .param-list-fix").css({display:"inline-block"}),$(this).css({display:"none"}))})},200)},a.copyProgramme=function(a){w.confirm("确认是否复制当前方案？").then(function(c){b.go("sys_config.program_tab",{program_id:a.prog_id,program_name:a.prog_cn_name,modify_type:2,repeat_flag:1})})},a.deleteProgramme=function(a,b,c){var d=angular.element(b.target).parents(".delete-style");d.addClass("delete-stop-style"),w.confirm("确认删除当前方案？").then(function(b){b?j.deleteProgram(a).then(function(a){g(function(){a&&(w.alert("删除成功",2),O(N),d.removeClass("delete-stop-style"))},0)},function(a){w.alert(a.message,3)}):d.removeClass("delete-stop-style")},function(a){d.removeClass("delete-stop-style")})},a.publishProgramme=function(a,b,c){w.confirm("确认发布当前方案？").then(function(){L.publishScheme(a,b).then(function(a){g(function(){a&&(w.alert("发布成功",2),O(N))},0)},function(a){w.alert(a.message,3)})},function(a){})},a.judgeOtherProgram=function(a,c){1==a&&b.go("sys_config.program_tab",{program_id:"",modify_type:1,repeat_flag:2}),2==a&&b.go("sys_config.program_tab",{program_id:c.prog_id,modify_type:2,repeat_flag:2}),3==a&&b.go("sys_config.program_tab",{program_id:c.prog_id,modify_type:3,repeat_flag:2})},P()}]),bsCtrl.controller("programTabCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L){var M=c.modify_type,N=c.repeat_flag,O=c.sys_id,P=c.program_id?c.program_id:"";a.data={progs:[]},a.control={modify_type:M};var Q=function(a,b){if(b)for(var c=0;c<a.length;c++){var d=a[c];d.prog_id==b?d.active=!0:d.active=!1}else for(var e=0;e<a.length;e++){var f=a[e];f.active=!1}return a},R=function(b){j.getAllProgramList(b).then(function(b){g(function(){b&&(a.data.progs=b.program_list?b.program_list:[],P&&1!=N&&(a.data.nodes=Q(a.data.progs,P)))},0)},function(a){})},S=function(){R(O),1!=M||P?2==M&&P?1==N?b.go("sys_config.program_tab.program_add_or_modify",{judge_id:P,judge_modify:2,judge_repeat:1}):b.go("sys_config.program_tab.program_add_or_modify",{judge_id:P,judge_modify:2,judge_repeat:2}):3==M&&P&&b.go("sys_config.program_tab.program_detail",{judge_id:P,judge_modify:3}):b.go("sys_config.program_tab.program_add_or_modify",{judge_id:"",judge_modify:1,judge_repeat:2})};a.changeCurProgram=function(c,d){d?a.data.progs=Q(a.data.progs,d.prog_id):a.data.progs=Q(a.data.progs),d||1!=c||b.go("sys_config.program_tab.program_add_or_modify",{judge_id:"",judge_modify:1,judge_repeat:2}),d&&1==c&&b.go("sys_config.program_tab.program_add_or_modify",{judge_id:d.prog_id,judge_modify:2,judge_repeat:2}),d||2!=c||b.go("sys_config.program_tab.program_add_or_modify",{judge_id:d.prog_id,judge_modify:1,judge_repeat:2}),d&&2==c&&b.go("sys_config.program_tab.program_add_or_modify",{judge_id:d.prog_id,judge_modify:2,judge_repeat:2}),d&&3==c&&b.go("sys_config.program_tab.program_detail",{judge_id:d.prog_id,judge_modify:3})},S()}]),bsCtrl.controller("programTabAddOrModifyCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L){var M,N=c.judge_repeat,O=c.sys_id,P=c.judge_id?c.judge_id:"",Q=function(){a.info={prog:{group_list:[],prog_source:1,prog_id:"",business_sys_name:O,prog_cn_name:"",prog_bk_desc:"",prog_type:1,is_update:!1,pac_type_list:[],config_file_list:[],ref_package_list:[],param_list:[]},prog_form:{},temp_prog_data:{node_ip_name_list:[],node_ip_list:[],global_param_list:[],ref_param_list:[],ref_global_list:[],all_param_name_list:[],file_path:"",logic_node_list:[]},program_group:{curr_group_index:0}},a.info.prog.group_list=[{group_name:"发布阶段1",choose_flag:!0,group_type:1,parallel_flag:!0,phase_list:[]}],a.data={program_type_list:v},a.control={modules_loading:!1,submit_loading:!1,expand_flag:!1,import_loading:!1,is_modify_prog:!0,owner_btn_flag:!0},a.config={process_fileupload:{suffixs:"xml,xlsx,xls",filetype:"",filename:"",uploadpath:""},viewShOptions:p.Sh(!0),viewSqlOptions:p.Sql(!0),viewPyOptions:p.Python(!0),viewJavaOptions:p.Java(!0)}},R=function(){for(var b=0;b<a.info.temp_prog_data.global_param_list.length;b++){var c={key:a.info.temp_prog_data.global_param_list[b].param_name,value:a.info.temp_prog_data.global_param_list[b].param_name,flag:1};a.info.temp_prog_data.ref_global_list.push(c)}r.bindRefParam(a.info.prog.group_list,a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list.concat(a.info.prog.ref_package_list),a.control.modules_loading=!1},S=function(b,c){a.control.owner_btn_flag=!0,"upload"!=c&&(a.info.prog.prog_cn_name=b.program.prog_cn_name,a.info.prog.prog_bk_desc=b.program.prog_bk_desc,a.info.prog.prog_source=1,a.info.prog.prog_type=b.program.prog_type,a.info.prog.prog_id=b.program.prog_id,a.info.prog.is_update=!0,a.control.import_loading=!0),a.publish_state=b.publish_state,a.info.prog.group_list=b.program.group_list?b.program.group_list:[],a.info.prog.param_list=b.program.param_list?b.program.param_list:[],a.info.temp_prog_data.global_param_list=a.info.prog.param_list;for(var d=0;d<a.info.prog.group_list.length;d++){var e=a.info.prog.group_list[d],g=e.pac_type_list||[],h=e.config_file_list||[];a.info.prog.group_list[0].choose_flag=!0,e.temp_pac_type_list=angular.copy(a.info.prog.pac_type_list),e.temp_config_file_list=angular.copy(a.info.prog.config_file_list),r.invertSelectionPac(g,e.temp_pac_type_list),r.invertSelectionConfig(h,e.temp_config_file_list),e.phase_list=e.phase_list?e.phase_list:[];for(var i=0;i<e.phase_list.length;i++){if(e.phase_list[i].show_detail=!1,e.phase_list[i].logic_node_list=angular.copy(a.info.temp_prog_data.logic_node_list),1==e.phase_list[i].phase_type||2==e.phase_list[i].phase_type||3==e.phase_list[i].phase_type){if(e.phase_list[i].script_list=[],e.phase_list[i].type_cn=L.findValue(e.phase_list[i].impl_type,o),e.phase_list[i].script.cmds&&(e.phase_list[i].exec_script=q.cmdsToString(e.phase_list[i].script.cmds)),e.phase_list[i].logical_node&&(e.phase_list[i].logical_node_id=e.phase_list[i].logical_node.logical_node_id),e.phase_list[i].ref_param_list=e.phase_list[i].ref_param_list?e.phase_list[i].ref_param_list:[],0!=e.phase_list[i].ref_param_list.length){for(var j=0;j<e.phase_list[i].ref_param_list.length;j++)e.phase_list[i].ref_param_list[j].ref_param_flag=r.judgeRefParam(e.phase_list[i].ref_param_list[j].ref,a.info.temp_prog_data.global_param_list),e.phase_list[i].ref_param_list[j].ref&&(e.phase_list[i].ref_param_list[j].ref_param_loading=!0);e.phase_list[i].show_ref_param=!0}}else if(4==e.phase_list[i].phase_type){if(e.phase_list[i].logical_node){var k=e.phase_list[i].logical_node;k.files_list=[];for(var l=0;l<k.file_list.length;l++)"upload"==c?k.files_list.push({file:k.file_list[l],ready_flag:!1}):k.files_list.push({file:k.file_list[l],ready_flag:!0})}}else 5==e.phase_list[i].phase_type?a.control.owner_btn_flag=!1:6==e.phase_list[i].phase_type&&(e.phase_list[i].script_fmt=f.trustAsHtml(e.phase_list[i].script.cmds[0]));e.phase_list[i].command&&e.phase_list[i].command.cmds&&(e.phase_list[i].command.exec_script=q.cmdsToString(e.phase_list[i].command.cmds));for(var m=0;m<e.phase_list[i].logic_node_list.length;m++)if(e.phase_list[i].logic_node_list[m].logical_node_id==e.phase_list[i].logical_node_id){e.phase_list[i].logic_node_list[m].state=!0;break}}e.nav_show_flag=q.judgeShowDetail(e.phase_list),e.expand_flag=2==e.nav_show_flag?!0:!1}0!=a.info.prog.group_list.length&&R()},T=function(a,b){j.viewSingleProgramInfo(a).then(function(c){g(function(){c&&(a=b?"upload":a,S(c,a))},0)},function(a){w.alert(a.message,3)})},U=function(b){return j.getLogicNodeAndPacParam(b).then(function(b){g(function(){a.info.prog.pac_type_list=b.pac_type_list?b.pac_type_list:[],a.info.prog.config_file_list=b.file_list?b.file_list:[],a.info.temp_prog_data.logic_node_list=b.logical_node_list||[],a.info.prog.ref_package_list=[];for(var c=0;c<a.info.prog.pac_type_list.length;c++){var d=a.info.prog.pac_type_list[c],e={key:d.type_name,value:d.type_name,flag:0};a.info.prog.ref_package_list.push(e)}})})},V=function(){Q(),U(O).then(function(){P&&(1==N?T(P,!0):T(P,!1))})};a.getProtocolTypeCnName=function(a){return L.findValue(a,k).substring(0,5).toLowerCase()},a.removeProcessTemplateFile=function(){a.config.process_fileupload.filename="",a.info.prog.group_list=[{choose_flag:!0,group_name:"发布阶段1",phase_list:[]}],a.info.prog.param_list=[],a.info.temp_prog_data.global_param_list=[],a.control.import_loading=!1},a.uploadProcessSuccessThen=function(){a.info.temp_prog_data.global_param_list=[],a.info.temp_prog_data.ref_param_list=[];var b=a.config.process_fileupload.filename,c=b.substring(b.lastIndexOf(".")+1);"xml"==c?a.config.process_fileupload.filetype="XML":a.config.process_fileupload.filetype="EXCEL",a.control.modules_loading=!0,a.control.import_loading=!0,m.importProgram(b).then(function(a){S(a,"upload")},function(b){a.config.process_fileupload.filename="",a.control.modules_loading=!1,a.control.import_loading=!1,w.alert(b.message,3)})},a.getDownTime=function(){M=(new Date).getTime()},a.toggleModulesDetail=function(b,c,d,e){if(1==c){var f=(new Date).getTime();if(f-M>300)return}b.show_detail=!b.show_detail,b.relate_flag_line&&b.show_detail&&(1==b.relate_flag_line?e.phase_list[d+1].expand_relate_flag=!0:e.phase_list[d-1].expand_relate_flag=!0,b.expand_relate_flag=!0),b.relate_flag_line&&!b.show_detail&&(1==b.relate_flag_line?e.phase_list[d+1].show_detail||(e.phase_list[d+1].expand_relate_flag=!1,b.expand_relate_flag=!1):e.phase_list[d-1].show_detail||(e.phase_list[d-1].expand_relate_flag=!1,b.expand_relate_flag=!1)),e.nav_show_flag=q.judgeShowDetail(e.phase_list),e.expand_flag=2==e.nav_show_flag?!0:!1,b.show_detail&&(a.code_refresh=!1,g(function(){a.code_refresh=!0},10))},a.expandCollapseAll=function(b){b.nav_show_flag=q.expandAllModules(b.phase_list),2==b.nav_show_flag&&(a.code_refresh=!1,g(function(){a.code_refresh=!0},10))},a.colseCollapseAll=function(a){for(var b=0;b<a.phase_list.length;b++)a.phase_list[b].show_detail=!1,a.phase_list[b].expand_relate_flag=!1;a.nav_show_flag=0},a.paramShellLoaded=function(a){p.setParamsEditor(a)},a.returnProgramList=function(){b.go("sys_config.program_list")},a.clickExcuteNode=function(a,b,c,d){for(var e=0;e<b.length;e++)e!=d?b[e].state=!1:(b[e].state=!b[e].state,a.logical_node=b[e].state?{logical_node_name:c.logical_node_name,logical_node_id:c.logical_node_id}:null)},V()}]),bsCtrl.controller("programTabDetailCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L){var M,N,O,P=c.judge_repeat,Q=c.sys_id,R=c.judge_id?c.judge_id:"",S=function(){a.info={prog:{group_list:[],prog_source:1,prog_id:"",business_sys_name:Q,prog_cn_name:"",prog_bk_desc:"",prog_type:1,is_update:!1,pac_type_list:[],ref_package_list:[],param_list:[]},prog_form:{},temp_prog_data:{node_ip_name_list:[],node_ip_list:[],global_param_list:[],ref_param_list:[],ref_global_list:[],all_param_name_list:[],file_path:"",logic_node_list:[]},program_group:{curr_group_index:0}},a.info.prog.group_list=[{group_name:"发布阶段1",choose_flag:!0,phase_list:[]}],a.data={program_type_list:v},a.control={modules_loading:!1,submit_loading:!1,expand_flag:!1,import_loading:!1,is_modify_prog:!0,owner_btn_flag:!0,show_download_div:!1},a.config={process_fileupload:{suffixs:"xml,xlsx,xls",filetype:"XML",filename:"",uploadpath:""},viewShOptions:p.Sh(!0),viewSqlOptions:p.Sql(!0),viewPyOptions:p.Python(!0),viewJavaOptions:p.Java(!0)}},T=function(){for(var b=0;b<a.info.temp_prog_data.global_param_list.length;b++){var c={key:a.info.temp_prog_data.global_param_list[b].param_name,value:a.info.temp_prog_data.global_param_list[b].param_name,flag:1};a.info.temp_prog_data.ref_global_list.push(c)}r.bindRefParam(a.info.prog.group_list,a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list.concat(a.info.prog.ref_package_list),a.control.modules_loading=!1},U=function(b,c){a.control.owner_btn_flag=!0,"upload"!=c&&(a.info.prog.prog_cn_name=b.program.prog_cn_name,a.info.prog.prog_bk_desc=b.program.prog_bk_desc,a.info.prog.prog_source=1,a.info.prog.prog_type=b.program.prog_type,a.info.prog.prog_id=b.program.prog_id,a.info.prog.is_update=!0,a.control.import_loading=!0),a.publish_state=b.publish_state,a.info.prog.pac_type_list=b.program.pac_type_list?b.program.pac_type_list:[],a.info.prog.config_file_list=b.program.config_file_list?b.program.config_file_list:[];for(var d=0;d<a.info.prog.pac_type_list.length;d++){a.info.prog.pac_type_list[d].param_name=a.info.prog.pac_type_list[d].type_name;var e={key:a.info.prog.pac_type_list[d].type_name,value:a.info.prog.pac_type_list[d].type_name,flag:0};a.info.prog.ref_package_list.push(e)}a.info.prog.group_list=b.program.group_list?b.program.group_list:[],a.info.prog.param_list=b.program.param_list?b.program.param_list:[],a.info.temp_prog_data.global_param_list=r.filterGobalParam(a.info.prog.param_list);for(var g=0;g<a.info.prog.group_list.length;g++){var h=a.info.prog.group_list[g],i=h.pac_type_list||[],j=h.config_file_list||[];a.info.prog.group_list[0].choose_flag=!0,h.temp_pac_type_list=angular.copy(a.info.prog.pac_type_list),h.temp_config_file_list=angular.copy(a.info.prog.config_file_list),r.invertSelectionPac(i,h.temp_pac_type_list),r.invertSelectionConfig(j,h.temp_config_file_list),h.phase_list=h.phase_list?h.phase_list:[];for(var k=0;k<h.phase_list.length;k++){if(h.phase_list[k].logic_node_list=angular.copy(a.info.temp_prog_data.logic_node_list),h.phase_list[k].show_detail=!1,1==h.phase_list[k].phase_type||2==h.phase_list[k].phase_type||3==h.phase_list[k].phase_type){if(h.phase_list[k].script_list=[],h.phase_list[k].type_cn=L.findValue(h.phase_list[k].impl_type,o),h.phase_list[k].script.cmds&&(h.phase_list[k].exec_script=q.cmdsToString(h.phase_list[k].script.cmds)),h.phase_list[k].logical_node&&(h.phase_list[k].logical_node_id=h.phase_list[k].logical_node.logical_node_id),h.phase_list[k].ref_param_list=h.phase_list[k].ref_param_list?h.phase_list[k].ref_param_list:[],0!=h.phase_list[k].ref_param_list.length){for(var l=0;l<h.phase_list[k].ref_param_list.length;l++)h.phase_list[k].ref_param_list[l].ref_param_flag=r.judgeRefParam(h.phase_list[k].ref_param_list[l].ref,a.info.temp_prog_data.global_param_list),h.phase_list[k].ref_param_list[l].ref&&(h.phase_list[k].ref_param_list[l].ref_param_loading=!0);h.phase_list[k].show_ref_param=!0}}else 5==h.phase_list[k].phase_type?a.control.owner_btn_flag=!1:6==h.phase_list[k].phase_type&&(h.phase_list[k].script_fmt=f.trustAsHtml(h.phase_list[k].script.cmds[0]));h.phase_list[k].command&&h.phase_list[k].command.cmds&&(h.phase_list[k].command.exec_script=q.cmdsToString(h.phase_list[k].command.cmds))}h.nav_show_flag=q.judgeShowDetail(h.phase_list),h.expand_flag=2==h.nav_show_flag?!0:!1}0!=a.info.prog.group_list.length&&T()},V=function(a,c){j.viewSingleProgramInfo(a).then(function(b){g(function(){b&&(a=c?"upload":a,U(b,a))},0)},function(a){w.alert(a.message,3),b.go("sys_config.program_list")})},W=function(a){j.getProgExportPath(a).then(function(a){g(function(){a&&(M=a.xml_download_path,N=a.excel_download_path)},0)},function(a){w.alert(a.message,3)})},X=function(){S(),R&&(1==P?V(R,!0):(V(R,!1),W(R)))};a.judgeFirstPhase=function(a){return 0==a?{"padding-top":"12px"}:{"padding-top":"0px"}},a.downloadProgram=function(b){w.confirm("确认导出["+a.info.prog.prog_cn_name+"]方案？").then(function(a){a&&(1==b?L.downloadFile(N):L.downloadFile(M))})},a.judgeRelate=function(a,b){a[b].relate_flag_line=0;var c=a[b].phase_id;c&&(a[b-1]&&a[b-1].phase_id&&a[b-1].phase_type!=a[b].phase_type&&a[b-1].phase_id===c&&(a[b-1].relate_flag_line=1,a[b].relate_flag_line=2),a[b+1]&&a[b+1].phase_id&&a[b+1].phase_type!=a[b].phase_type&&a[b+1].phase_id===c&&(a[b+1].relate_flag_line=2,a[b].relate_flag_line=1))},a.getDownTime=function(){O=(new Date).getTime()},a.toggleModulesDetail=function(b,c,d,e){if(1==c){var f=(new Date).getTime();if(f-O>300)return}b.show_detail=!b.show_detail,b.relate_flag_line&&b.show_detail&&(1==b.relate_flag_line?e.phase_list[d+1].expand_relate_flag=!0:e.phase_list[d-1].expand_relate_flag=!0,b.expand_relate_flag=!0),b.relate_flag_line&&!b.show_detail&&(1==b.relate_flag_line?e.phase_list[d+1].show_detail||(e.phase_list[d+1].expand_relate_flag=!1,b.expand_relate_flag=!1):e.phase_list[d-1].show_detail||(e.phase_list[d-1].expand_relate_flag=!1,b.expand_relate_flag=!1)),e.nav_show_flag=q.judgeShowDetail(e.phase_list),e.expand_flag=2==e.nav_show_flag?!0:!1,b.show_detail&&(a.code_refresh=!1,g(function(){a.code_refresh=!0},10))},a.expandCollapseAll=function(b){b.nav_show_flag=q.expandAllModules(b.phase_list),2==b.nav_show_flag&&(a.code_refresh=!1,g(function(){a.code_refresh=!0},10))},a.colseCollapseAll=function(a){for(var b=0;b<a.phase_list.length;b++)a.phase_list[b].show_detail=!1,a.phase_list[b].expand_relate_flag=!1;a.nav_show_flag=0},a.paramShellLoaded=function(a){p.setParamsEditor(a)},a.returnProgramList=function(){b.go("sys_config.program_list")},X()}]),bsCtrl.controller("editProgCtrl",["$scope","$rootScope","$state","$stateParams","$sce","$location","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","BsysFunc","CmptFunc","NodeType","OperateSys","NodeReform","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=[],y=d.sys_id;a.copy_soc_list=[],a.groupSortableOption={update:function(b,c){a.info.program_group.curr_group_index=c.item.sortable.dropindex,g(function(){A()})}},a.sortableOption={connectWith:".phase-module",update:function(a,b){g(function(){A()})}};var z=function(b,c){b.param_list=a.info.temp_prog_data.global_param_list,j.getCombineParam(b,y).then(function(b){g(function(){if(a.info.temp_prog_data.global_param_list=b.param_list?b.param_list:[],a.info.temp_prog_data.ref_global_list=[],a.info.temp_prog_data.all_param_name_list=[],b.param_list)for(var d=0;d<b.param_list.length;d++){var e=b.param_list[d];e.param_type||(e.param_type=1),e.modify_flag||(e.modify_flag=1),e.param_type_list=n;var f={key:e.param_name,value:e.param_name,flag:1};a.info.temp_prog_data.ref_global_list.push(f)}a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list.concat(a.info.prog.ref_package_list),a.info.temp_prog_data.all_param_name_list=q.getAllParam(a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),q.bindRefParam(a.info.prog.group_list,a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),c&&c()},0)},function(a){v.alert(a.message,3)})},A=function(){for(var b=1,c=0;c<a.info.prog.group_list.length;c++){var d=a.info.prog.group_list[c];d.choose_flag&&(a.info.program_group.curr_group_index=c);for(var e=0;e<d.phase_list.length;e++)d.phase_list[e].phase_no=b++}},B=function(){for(var b=0;b<a.info.prog.group_list.length;b++){var c=a.info.prog.group_list[b];c.group_no=b+1}},C=function(a){x=[];for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<c.phase_list.length;d++){var e=c.phase_list[d];5==e.phase_type&&x.push(e)}};a.judgeFirstPhase=function(a){return 0==a?{"padding-top":"12px"}:{"padding-top":"0px"}},a.changeProgramType=function(b){2==b&&(a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list)},a.changeAddTempStyle=function(b){a.control.prog_source=b,a.removeProcessTemplateFile(),2==b&&(a.control.import_loading=!1,m.getCmptFilePath(6).then(function(b){g(function(){if(b){a.config.process_fileupload.uploadpath=b.file_path?b.file_path:"";var c=a.config.process_fileupload.uploadpath.charAt(0);"/"==c&&(a.config.process_fileupload.uploadpath=b.file_path.substring(1)),a.info.temp_prog_data.file_path=b.file_path?b.file_path:""}},0)},function(a){v.alert(a.message,3)}))},a.choosePacOnConditionGroup=function(a){var b=a.temp_pac_type_list,c=a.temp_config_file_list;a.pac_type_list=[],a.config_file_list=[];for(var d=0;d<b.length;d++)b[d].state&&a.pac_type_list.push(b[d].type_name);for(var d=0;d<c.length;d++)c[d].state&&a.config_file_list.push(c[d].file_name)},a.addNewGroup=function(b,c){for(var d={group_name:"发布阶段"+(b+1),choose_flag:!0,group_type:c,parallel_flag:!0,phase_list:[],temp_pac_type_list:angular.copy(a.info.prog.pac_type_list),temp_config_file_list:angular.copy(a.info.prog.config_file_list)},e=0;e<a.info.prog.group_list.length;e++)a.info.prog.group_list[e].choose_flag=!1;a.info.prog.group_list.push(d),a.info.program_group.curr_group_index=a.info.prog.group_list.length-1},a.deleteGroup=function(b,c){v.confirm("确认删除当前分组?").then(function(){for(var d=b.choose_flag,e=0;e<b.phase_list.length;e++){var f=b.phase_list[e];5==f.phase_type&&(a.control.owner_btn_flag=!0,x.splice(0,1))}a.info.prog.group_list.splice(c,1),A(),d&&(a.info.prog.group_list[0].choose_flag=!0,a.info.program_group.curr_group_index=0),z(a.info.prog)})},a.copyCurrGroup=function(b){v.confirm("确认复制当前分组?").then(function(){var c=angular.copy(b);b.choose_flag=!1;for(var d=c.phase_list.length-1;d>=0;d--)5==c.phase_list[d].phase_type&&c.phase_list.splice(d,1);a.info.prog.group_list.push(c),a.info.program_group.curr_group_index=a.info.prog.group_list.length-1,A()})},a.chooseCurrGroup=function(b,c){for(var d=0;d<a.info.prog.group_list.length;d++)a.info.prog.group_list[d].choose_flag=!1;b.choose_flag=!0,a.info.program_group.curr_group_index=c},a.newAddSubGroup=function(b){var c=a.info.program_group.curr_group_index,d=1;
v.cmptEdit(b,d).then(function(d){1==b?m.getCmptGroupDetail(d,!0).then(function(b){g(function(){if(b.component_list){for(var d=0;d<b.component_list.length;d++){b.component_list[d].phase_type=1,b.component_list[d].phase_id=b.component_list[d].id,d>0&&b.component_list[d].phase_id==b.component_list[d-1].phase_id&&(b.component_list[d].phase_type=2),b.component_list[d].script_list=b.component_list[d].script_list?b.component_list[d].script_list:[];for(var e=0;e<b.component_list[d].script_list.length;e++)b.component_list[d].script_list[e].exec_script=r.cmdsToString(b.component_list[d].script_list[e].cmds),b.component_list[d].script_list[e].script_type_cn="default"==b.component_list[d].script_list[e].script_type?"缺省":b.component_list[d].script_list[e].script_type;0!=b.component_list[d].script_list.length&&(b.component_list[d].script_type=b.component_list[d].script_list[0].script_type,b.component_list[d].exec_script=b.component_list[d].script_list[0].exec_script,b.component_list[d].script={script_type:b.component_list[d].script_list[0].script_type,cmds:b.component_list[d].script_list[0].cmds}),b.component_list[d].ref_param_list=[],b.component_list[d].type_cn=w.findValue(b.component_list[d].impl_type,o),b.component_list[d].show_detail=!1,b.component_list[d].param_names_list=[],b.component_list[d].logic_node_list=angular.copy(a.info.temp_prog_data.logic_node_list),b.component_list[d].phase_name||(b.component_list[d].phase_name=b.component_list[d].cn_name),a.info.prog.group_list[c].phase_list.push(b.component_list[d]),b.component_list[d].command&&(b.component_list[d].command.exec_script=r.cmdsToString(b.component_list[d].command.cmds))}z(a.info.prog),a.info.prog.group_list[c].nav_show_flag=r.judgeShowDetail(a.info.prog.group_list[c].phase_list),a.info.prog.group_list[c].expand_flag=2==a.info.prog.group_list[c].nav_show_flag?!0:!1,A()}},0)},function(a){v.alert(a.message,3)}):m.getCmptGroupsDetail(d).then(function(b){g(function(){if(b.component_list){for(var d=0;d<b.component_list.length;d++){b.component_list[d].phase_type=1,b.component_list[d].phase_id=b.component_list[d].id,d>0&&b.component_list[d].phase_id==b.component_list[d-1].phase_id&&(b.component_list[d].phase_type=2),b.component_list[d].script_list=b.component_list[d].script_list?b.component_list[d].script_list:[];for(var e=0;e<b.component_list[d].script_list.length;e++)b.component_list[d].script_list[e].exec_script=r.cmdsToString(b.component_list[d].script_list[e].cmds),b.component_list[d].script_list[e].script_type_cn="default"==b.component_list[d].script_list[e].script_type?"缺省":b.component_list[d].script_list[e].script_type;0!=b.component_list[d].script_list.length&&(b.component_list[d].script_type=b.component_list[d].script_list[0].script_type,b.component_list[d].exec_script=b.component_list[d].script_list[0].exec_script,b.component_list[d].script={script_type:b.component_list[d].script_list[0].script_type,cmds:b.component_list[d].script_list[0].cmds}),b.component_list[d].ref_param_list=[],b.component_list[d].type_cn=w.findValue(b.component_list[d].impl_type,o),b.component_list[d].show_detail=!1,b.component_list[d].param_names_list=[],b.component_list[d].logic_node_list=angular.copy(a.info.temp_prog_data.logic_node_list),b.component_list[d].phase_name||(b.component_list[d].phase_name=b.component_list[d].cn_name),a.info.prog.group_list[c].phase_list.push(b.component_list[d])}z(a.info.prog),a.info.prog.group_list[c].nav_show_flag=r.judgeShowDetail(a.info.prog.group_list[c].phase_list),a.info.prog.group_list[c].expand_flag=2==a.info.prog.group_list[c].nav_show_flag?!0:!1,A()}},0)},function(a){v.alert(a.message,3)})})},a.selectScriptByScriptType=function(a,b){for(var c=0;c<b.script_list.length;c++)if(b.script_list[c].script_type==a){b.exec_script=b.script_list[c].exec_script,b.cmds=r.stringToCmds(b.exec_script),b.script={script_type:a,cmds:b.cmds};break}},a.judgeWay=function(a,b){1==b?a.parallel_flag&&(a.interactor_flag=!1):a.interactor_flag&&(a.parallel_flag=!1)},a.showPhase=function(){var b=a.info.program_group.curr_group_index;v.cmptPhaseEdit("","","","",[],a.info.temp_prog_data.ref_param_list,"",1,"").then(function(c){c.type_cn=w.findValue(c.impl_type,o),c.show_detail=!1,c.phase_type=3,c.phase_name=c.cn_name,c.script={script_type:"default",cmds:c.cmds},c.logic_node_list=angular.copy(a.info.temp_prog_data.logic_node_list),a.info.prog.group_list[b].phase_list.push(c),z(a.info.prog),a.info.prog.group_list[b].nav_show_flag=r.judgeShowDetail(a.info.prog.group_list[b].phase_list),a.info.prog.group_list[b].expand_flag=2==a.info.prog.group_list[b].nav_show_flag?!0:!1,A()})},a.modify_phase=function(b,c,d){b.plugin_list=b.plugin_list?b.plugin_list:[],v.cmptPhaseEdit(b.phase_name,b.impl_type,b.language_version,b.exec_script,b.plugin_list,a.info.temp_prog_data.ref_param_list,b.annex_file,2,b.command).then(function(e){e&&(e.type_cn=w.findValue(e.impl_type,o),e.show_detail=b.show_detail,e.phase_name=e.cn_name,e.interactor_flag=b.interactor_flag,e.parallel_flag=b.parallel_flag,e.logical_node_id=b.logical_node_id,e.logical_node=b.logical_node,e.logic_node_list=b.logic_node_list,e.script={script_type:"default",cmds:e.cmds},d.phase_list.splice(c,1,e),z(a.info.prog),d.nav_show_flag=r.judgeShowDetail(d.phase_list),d.expand_flag=2==d.nav_show_flag?!0:!1,A())})},a.convertToPhase=function(b,c,d){v.confirm("确定要将 ["+b.phase_name+"] 转换为脚本吗？").then(function(e){if(e){var f="";b.plugin_list=b.plugin_list?b.plugin_list:[],v.cmptPhaseEdit(f,b.impl_type,b.language_version,b.exec_script,b.plugin_list,a.info.temp_prog_data.ref_param_list,b.annex_file).then(function(e){e&&(e.type_cn=w.findValue(e.impl_type,o),e.show_detail=!1,e.phase_name=e.cn_name,e.interactor_flag=b.interactor_flag,e.parallel_flag=b.parallel_flag,e.logical_node_id=b.logical_node_id,e.logical_node=b.logical_node,e.logic_node_list=b.logic_node_list,e.script={script_type:"default",cmds:e.cmds},d.phase_list.splice(c,1,e),z(a.info.prog),d.nav_show_flag=r.judgeShowDetail(d.phase_list),d.expand_flag=2==d.nav_show_flag?!0:!1,A())})}})},a.remove_modules_list=function(b,c,d){var e=b.phase_name?b.phase_name:"",f=1==b.phase_type||2==b.phase_type?"组件":"脚本";v.confirm("确认删除 ["+e+"] "+f+"?").then(function(){5==b.phase_type&&(a.control.owner_btn_flag=!0,x.splice(0,1)),d.phase_list.splice(c,1),A(),a.info.temp_prog_data.all_param_name_list=q.getAllParam(a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),z(a.info.prog),d.nav_show_flag=r.judgeShowDetail(d.phase_list),d.expand_flag=2==d.nav_show_flag?!0:!1})},a.addPackage=function(){if(0!=a.info.prog.pac_type_list.length)for(var b=0;b<a.info.prog.pac_type_list.length;b++)if(!a.info.prog.pac_type_list[b].type_name)return v.alert("类型包名不能为空",3),!1;a.info.prog.pac_type_list.push({type_name:"",type_cn_name:"",param_name:"",delete_flag:!0})},a.handPackageNameOnBlur=function(b,c){if(b.type_name){b.param_name=b.type_name,a.info.temp_prog_data.all_param_name_list=q.getAllParam(a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),a.info.prog.ref_package_list[c]={key:b.type_name,value:b.type_name,flag:0},a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list.concat(a.info.prog.ref_package_list);for(var d=0;d<a.info.prog.group_list.length;d++)for(var e=a.info.prog.group_list[d],f=0;f<e.phase_list.length;f++)(1==e.phase_list[f].phase_type||2==e.phase_list[f].phase_type)&&0==e.phase_list[f].ref_param_list.length&&(e.phase_list[f].show_ref_param=!1)}},a.deletePackageType=function(b,c){var d=c.type_name?c.type_name:"";v.confirm("确认删除 "+d+" ?").then(function(){a.info.prog.pac_type_list.splice(b,1),a.info.prog.ref_package_list.splice(b,1),a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list.concat(a.info.prog.ref_package_list)})},a.showRefParam=function(a,b){a.show_ref_param=!0},a.selectCmptParamName=function(b,c,d,e){if(d.ref_param_loading=!1,angular.forEach(c.ref_param_list,function(a){a.param_is_used=!1}),d.param_is_used=!0,c.ref_param_list)for(var f=0;f<c.ref_param_list.length;f++){var h=c.ref_param_list[f];if(!h.param_is_used&&b==h.param_name)return v.alert("参数名已存在，请重新配置",3),c.ref_param_list.splice(e,1),void(d.param_name="")}g(function(){z(a.info.prog,function(){d.ref_param_loading=!0})},400)},a.showRefParamDetail=function(b,c){if(c.ref=b,c.ref_param_flag=q.judgeRefParam(b,a.info.temp_prog_data.global_param_list),c.ref_param_flag){var d=a.info.temp_prog_data.global_param_list;c.param_type=1;for(var e=0;e<d.length;e++)b==d[e].param_name&&(c.param_cn_name=d[e].param_cn_name,c.ref_index=e)}else{var f=a.info.prog.pac_type_list;c.param_type=2;for(var g=0;g<f.length;g++)b==f[g].type_name&&(c.param_cn_name=f[g].type_cn_name,c.ref_index=g)}z(a.info.prog)},a.addPhaseRefParam=function(a,b){if(0!=a.ref_param_list.length){if(""==a.ref_param_list[a.ref_param_list.length-1].param_name)return v.alert("请完善当前参数表",3),!1;if(a.param_list.length==a.ref_param_list.length)return v.alert("无可配参数",3),!1}a.ref_param_list.push({param_name:"",ref:"",param_cn_name:"",param_bk_desc:"",param_type:1})},a.deleteRefParam=function(b,c,d){var e=d.param_name?d.param_name:"";v.confirm("确认删除"+e+"?").then(function(){b.ref_param_list.splice(c,1),0==b.ref_param_list.length&&(b.show_ref_param=!1),a.info.temp_prog_data.all_param_name_list=q.getAllParam(a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),z(a.info.prog)})},a.addParam=function(){if(0!=a.info.temp_prog_data.global_param_list.length)for(var b=0;b<a.info.temp_prog_data.global_param_list.length;b++)if(!a.info.temp_prog_data.global_param_list[b].param_name)return v.alert("参数名不能为空",3),!1;a.info.temp_prog_data.global_param_list.push({param_name:"",param_type:1,param_value:"",param_cn_name:"",param_bk_desc:"",modify_flag:1,param_type_list:n,delete_flag:!0,hand_param:!0})},a.deleteGlobalParam=function(b,c){var d=c.param_name?c.param_name:"";v.confirm("确认删除 "+d+" ?").then(function(){a.info.temp_prog_data.global_param_list.splice(b,1),a.info.temp_prog_data.ref_global_list.splice(b,1),a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list.concat(a.info.prog.ref_package_list),q.bindRefParam(a.info.prog.group_list,a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list)})},a.handParamNmaeOnBlur=function(b,c){if(b.param_name){a.info.temp_prog_data.all_param_name_list=q.getAllParam(a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),a.info.temp_prog_data.ref_global_list[c]={key:b.param_name,value:b.param_name,flag:1},a.info.temp_prog_data.ref_param_list=a.info.temp_prog_data.ref_global_list.concat(a.info.prog.ref_package_list);for(var d=0;d<a.info.prog.group_list.length;d++)for(var e=a.info.prog.group_list[d],f=0;f<e.phase_list.length;f++)(1==e.phase_list[f].phase_type||2==e.phase_list[f].phase_type)&&0==e.phase_list[f].ref_param_list.length&&(e.phase_list[f].show_ref_param=!1)}},a.bindLogicalName=function(a,b,c){c.logical_node={logical_node_name:b,logical_node_id:a}},a.stopPrevent=function(a){a.stopPropagation()},a.addCurPhase=function(){v.addCurPhase(a.info.prog.business_sys_name,a.info.temp_prog_data.logic_node_list).then(function(b){var c=a.info.program_group.curr_group_index,d={cn_name:"固化配置",show_detail:!1,phase_type:4,impl_type:9,phase_name:"固化配置",logical_node:{logical_node_id:b[0].logical_node_id,logical_node_name:b[0].logical_node_name,file_list:b[0].file_list,files_list:b[0].files_list}};a.info.prog.group_list[c].phase_list.push(d),A()})},a.updateCurPhase=function(b,c,d){var e=[{logical_node_id:b.logical_node.logical_node_id,logical_node_name:b.logical_node.logical_node_name,file_list:b.logical_node.file_list?b.logical_node.file_list:[]}];v.addCurPhase(a.info.prog.business_sys_name,a.info.temp_prog_data.logic_node_list,e).then(function(a){b.logical_node.logical_node_id=a[0].logical_node_id,b.logical_node.logical_node_name=a[0].logical_node_name,b.logical_node.file_list=a[0].file_list,b.logical_node.files_list=a[0].files_list})},a.manualConfig=function(){v.addManualPhase().then(function(b){var c=a.info.program_group.curr_group_index,d={show_detail:!1,phase_type:6,impl_type:10,phase_name:"人工阶段",script:{cmds:[b]},script_fmt:e.trustAsHtml(b)};a.info.prog.group_list[c].phase_list.push(d),A()})},a.updateManuamConfig=function(a,b,c){v.addManualPhase(a.script).then(function(b){a.script.cmds[0]=b,a.script_fmt=e.trustAsHtml(b)})},a.defineByOwner=function(){C(a.info.prog.group_list);var b=a.info.program_group.curr_group_index,c={show_detail:!1,phase_type:5,impl_type:9,phase_name:"自定义配置",config_index:x.length+1,script:{cmds:["在项目准备时手工修改配置文件。"]}};x.push(c),a.info.prog.group_list[b].phase_list.push(c),a.control.owner_btn_flag=!1,A()},a.judgeRelate=function(a,b){a[b].relate_flag_line=0;var c=a[b].phase_id;c&&(a[b-1]&&a[b-1].phase_id&&a[b-1].phase_type!=a[b].phase_type&&a[b-1].phase_id===c&&(a[b-1].relate_flag_line=1,a[b].relate_flag_line=2),a[b+1]&&a[b+1].phase_id&&a[b+1].phase_type!=a[b].phase_type&&a[b+1].phase_id===c&&(a[b+1].relate_flag_line=2,a[b].relate_flag_line=1))},a.programBatchConfig=function(){v.programBacthConfig(a.info.prog.group_list,a.info.prog.business_sys_name,a.control).then(function(b){a.info.prog.group_list=b,A()})},a.saveProgramAllInfo=function(){if(a.info.temp_prog_data.all_param_name_list=q.getAllParam(a.info.temp_prog_data.global_param_list,a.info.prog.pac_type_list),!w.valiForm(a.info.prog_form))return!1;if(a.config.process_fileupload.filename)for(var b=0;b<a.info.prog.group_list.length;b++){var d=a.info.prog.group_list[b];if(d.phase_list)for(var e=0;e<d.phase_list.length;e++){var f=d.phase_list[e];if(4==f.phase_type&&f.logical_node)for(var h=0;h<f.logical_node.files_list.length;h++){var i=f.logical_node.files_list[h];if(!i.ready_flag)return v.alert("配置文件未就绪！请重新选择！",3),!1}}}a.control.submit_loading=!0,B(),a.info.prog.is_update?(a.info.prog.param_list=a.info.temp_prog_data.global_param_list,j.updateProgram(a.info.prog).then(function(b){g(function(){v.alert("修改成功",2),a.control.submit_loading=!1,c.go("sys_config.program_list"),$("body,html").animate({scrollTop:0},100)},0)},function(b){v.alert(b.message,3),a.control.submit_loading=!1})):(a.info.prog.param_list=a.info.temp_prog_data.global_param_list,j.addProgram(a.info.prog,a.info.prog.business_sys_name).then(function(b){g(function(){v.alert("保存成功",2),a.control.submit_loading=!1,c.go("sys_config.program_list"),$("body,html").animate({scrollTop:0},100)},0)},function(b){v.alert(b.message,3),a.control.submit_loading=!1}))},a.setColor=function(b){var c="config_index"+b;return a.info.prog_form[c].$invalid?{"border-color":"rgb(233, 65, 110)"}:void 0}}]),bsCtrl.controller("sysLogListCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L){var M=c.sys_id,N=0,O=function(a){var b={size:0,size_str:""};b.size=0;for(var c=0;c<a.length;c++){var d=a[c];b.size=b.size+parseInt(d.file_length)}return 0==b.size?(b.size=0,b.size_str="0M"):b.size<1024?b.size_str=b+"b":b.size>1024&&(b.size<1048576?b.size_str=Math.floor(b.size/1024)+"kb":b.size_str=Math.floor(b.size/1048576)+"M"),b},P=function(){g(function(){j.getAllLogList(M,N).then(function(b){g(function(){b&&(a.data.logs=b.logBeanList?b.logBeanList:[],angular.forEach(a.data.logs,function(a){if(a.log_type_cn=L.findValue(a.log_type,B),a.logSyncInfos){var b=O(a.logSyncInfos);a.size=b.size,a.size_str=b.size_str}else a.size=0,a.size_str="0M"}))},0)})},100)},Q=function(){a.data={logs:[],node_ip_list:[],log_sort:B},P()};a.startLog=function(b){var c=a.data.logs[b];c.log_configs[0]&&(0==c.log_configs[0].pull_flag?j.startTimePull(c.sys_name,c.log_name,c.log_id).then(function(a){g(function(){a&&(w.alert("启动定时日志获取",2),P())},0)},function(a){w.alert(a.message)}):1==c.log_configs[0].pull_flag&&j.stopTimePull(c.sys_name,c.log_name,c.log_id).then(function(a){g(function(){a&&(w.alert("关闭定时日志获取",2),P())},0)},function(a){w.alert(a.message,3)}))},a.deleteCurrentLog=function(a,b){w.confirm("是否确定删除日志?").then(function(){j.deleteLog(M,a,b).then(function(a){g(function(){a&&(w.alert("删除成功",2),P())},0)},function(a){w.alert(a.message,3)})})},a.judgeOtherLog=function(a,c){1==a&&b.go("sys_config.log_tab",{log_id:"",modify_type:1,log_name:""}),2==a&&b.go("sys_config.log_tab",{log_id:c.log_id,log_name:c.log_name,modify_type:2}),3==a&&b.go("sys_config.log_tab",{log_id:c.log_id,log_name:c.log_name,modify_type:3})},Q()}]),bsCtrl.controller("logTabCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L){var M=0,N=c.modify_type,O=c.sys_id,P=c.log_id?c.log_id:"",Q=c.log_name?c.log_name:"";a.data={logs:[]},a.config={tem_logs:[]},a.control={modify_type:N};var R=function(a,b){if(b)for(var c=0;c<a.length;c++){var d=a[c];d.log_id==b?d.active=!0:d.active=!1}else for(var e=0;e<a.length;e++){var f=a[e];f.active=!1}return a},S=function(c){j.getAllLogList(c,M).then(function(c){g(function(){c&&(a.data.logs=c.logBeanList?c.logBeanList:[],a.config.tem_logs=c.logBeanList?c.logBeanList:[],angular.forEach(a.data.logs,function(a){if(a.log_type_cn=L.findValue(a.log_type,B),a.logSyncInfos){for(var b=0,c=0;c<a.logSyncInfos.length;c++){var d=a.logSyncInfos[c];b+=parseInt(d.file_length)}0==b?(a.size=0,a.size_str="0M"):1024>b?a.size_str=b+"b":b>1024&&(1048576>b?a.size_str=Math.floor(b/1024)+"kb":a.size_str=Math.floor(b/1048576)+"M")}else a.size=0,a.size_str="0M"}),P&&(a.data.logs=R(a.data.logs,P)),1!=N||P?2==N&&P?b.go("sys_config.log_tab.log_add_modify",{judge_id:P,judge_name:Q,judge_modify:2}):3==N&&P&&b.go("sys_config.log_tab.log_detail",{judge_id:P,judge_name:Q,judge_modify:3}):b.go("sys_config.log_tab.log_add_modify",{judge_id:"",judge_name:"",judge_modify:1}))},0)})},T=function(){S(O)};a.changeCurLog=function(c,d){d?a.data.logs=R(a.data.logs,d.log_id):a.data.logs=R(a.data.logs),d||1!=c||b.go("sys_config.log_tab.log_add_modify",{judge_id:"",judge_name:"",judge_modify:1}),d&&1==c&&b.go("sys_config.log_tab.log_add_modify",{judge_id:d.log_id,judge_name:d.log_name,judge_modify:2}),d||2!=c||b.go("sys_config.log_tab.log_add_modify",{judge_id:d.log_id,judge_name:d.log_name,judge_modify:1}),d&&2==c&&b.go("sys_config.log_tab.log_add_modify",{judge_id:d.log_id,judge_name:d.log_name,judge_modify:2}),d&&3==c&&b.go("sys_config.log_tab.log_detail",{judge_id:d.log_id,judge_name:d.log_name,judge_modify:3})},T()}]),bsCtrl.controller("logTabAddOrModifyCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","ScrollConfig","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M){var N=0,O=c.sys_id,P=c.judge_id?c.judge_id:"";a.info={log:{log_configs:[],keywords:[],log_pick_info:{}},log_form:{}},a.data={node_ip_list:[],log_sort_list:B,log_encod_list:y,data_format_list:E,time_format_list:F,scroll_list:L},a.control={judge_path_flag:!1,log_save_loading:!1};var Q=function(a){var b={size:0,size_str:""};b.size=0;for(var c=0;c<a.length;c++){var d=a[c];b.size=b.size+parseInt(d.file_length)}return 0==b.size?(b.size=0,b.size_str="0M"):b.size<1024?b.size_str=b+"b":b.size>1024&&(b.size<1048576?b.size_str=Math.floor(b.size/1024)+"kb":b.size_str=Math.floor(b.size/1048576)+"M"),b},R=function(b,c){for(var d={},e=0;e<b.length;e++){var f=b[e];if(f.log_id==c){d=f;break}}if(d.log_configs){var g=d.log_configs[0],h=g.pull_timing_str,i=[];i=h.split(":"),d.log_pick_info={},d.log_pick_info.start_hour=i[0],d.log_pick_info.start_minutes=i[1],d.log_pick_info.start_second=i[2],d.log_file_express=g.log_file_name_exp,d.pull_timing_str=g.pull_timing_str,N=g.pull_flag?g.pull_flag:0}var j=T(1,d);if(-1==j.indexOf("("))d.timestamp_exp_show=j;else{var k=j.indexOf("("),l=j.indexOf(")");d.timestamp_exp_show=j.substring(0,k),d.timestamp_show_title=j.substring(k+1,l)}var m=T(2,d);if(-1==m.indexOf("("))d.date_exp_show=m;else{var n=m.indexOf("("),o=m.indexOf(")");d.date_exp_show=m.substring(0,n),d.date_show_title=m.substring(n+1,o)}d.log_name&&(d.modify=!0),a.info.log=angular.copy(d),a.info.log.keywords=d.keywords?d.keywords:[]},S=function(){g(function(){j.getAllLogList(O,0).then(function(b){g(function(){b&&(a.config.tem_logs=b.logBeanList?b.logBeanList:[],angular.forEach(a.data.logs,function(a){if(a.log_type_cn=M.findValue(a.log_type,B),a.logSyncInfos){var b=Q(a.logSyncInfos);a.size=b.size,a.size_str=b.size_str}else a.size=0,a.size_str="0M"}),R(a.config.tem_logs,P))},0)})},100)},T=function(b,c){var d="";return 1==b?d=V(c.timestamp_exp,a.data.time_format_list)?M.findValue(c.timestamp_exp,a.data.time_format_list):c.timestamp_exp:2==b&&(d=V(c.date_exp,a.data.data_format_list)?M.findValue(c.date_exp,a.data.data_format_list):c.date_exp),d},U=function(a,b,c){var d="."+a,e="."+b,f=$(d);if(f.is(c.target)||0!=f.has(c.target).length)return $(e).removeClass("show-none").addClass("show-block"),!1;var g=$(e);g.is(c.target)||0!==g.has(c.target).length||$(e).removeClass("show-block").addClass("show-none")},V=function(a,b){for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(a==e.key){c=!0;break}}return c},W=function(a,b){for(var c=!1,d=0;d<b.length;d++){var e=b[d],f=e.value.substring(0,e.value.indexOf("("));if(a==f){c=!0;break}}return c},X=function(a,b){for(var c=b.length,d=[];c--;)d.push(a[b[c]]);return d.join("|")},Y=function(a,b){for(var c=!0,d=[],e={},f=0,g=a.length;g>f;f++){var h=X(a[f],b);h in e||(e[h]=!0,d.push(a[f]))}return a.length!=d.length&&(c=!1),c},Z=function(a){var b="";return 0==a.length?b="":1==a.length?b="0"+a:2==a.length&&(b=a),b},_=function(){P?a.config.tem_logs&&0!=a.config.tem_logs.length?R(a.config.tem_logs,P):S():a.info={log:{log_configs:[],keywords:[],log_pick_info:{}}},u.getNodeByBusi(O).then(function(b){g(function(){if(b){a.data.node_ip_list=[];for(var c=b.node_msg_list?b.node_msg_list:[],d=0;d<c.length;d++){var e=c[d],f={node_ip:e.soc_ip,node_name:e.node_name};a.data.node_ip_list.push(f)}}},0)})};a.judgePath=function(b){if(!b.node_ip)return w.alert("请输入ip",3),!1;if(!b.soc_name)return w.alert("请输入数据源",3),!1;if(!b.log_file_path)return w.alert("请输入存储路径",3),!1;for(var c,d=0;d<a.data.node_ip_list.length;d++){var e=a.data.node_ip_list[d];if(b.node_ip==e.node_ip){c=e.node_name;break}}g(function(){j.judgePathIsExist(b.soc_name,c,b.log_file_path).then(function(c){return c.error_msg?(b.no_save_flag=!0,w.alert(c.error_msg,3),a.control.judge_path_flag=!0,!1):(b.no_save_flag=!1,void(a.control.judge_path_flag=!0))},function(b){w.alert(b.message,3),a.control.judge_path_flag=!0})},500)},a.judgeLogName=function(a){return a.log_name?void j.judgeLogNameIsExist(a,O).then(function(b){g(function(){b.valid?a.name_exist=!1:(w.alert("日志名已经存在,请重新填写",3),a.name_exist=!0)},0)},function(a){w.alert(a.message,3)}):!1},a.addKeyWord=function(){var b=a.info.log.log_name?angular.copy(a.info.log.log_name):"",c={sys_name:O,log_name:b,keyword_name:"",keyword_exp:""};a.info.log.keywords.push(c)},a.deleteKeyWord=function(b){a.info.log.keywords.splice(b,1)},a.chooseCurDateFormat=function(a,b){b.date_exp=a.key;var c=a.value.indexOf("("),d=a.value.indexOf(")");b.date_exp_show=a.value.substring(0,c),b.date_show_title=a.value.substring(c+1,d),$(".target-log-choose").removeClass("show-block").addClass("show-none")},a.chooseCurTimeFormat=function(a,b){b.timestamp_exp=a.key,b.timestamp_exp_show=a.value;var c=a.value.indexOf("("),d=a.value.indexOf(")");b.timestamp_exp_show=a.value.substring(0,c),b.timestamp_show_title=a.value.substring(c+1,d),$(".target-second-log-choose").removeClass("show-block").addClass("show-none")},a.showPrompt=function(a,b){1==b?a.date_exp_show&&-1==a.date_exp_show.indexOf("(")&&(a.date_show_title=""):a.timestamp_exp_show&&-1==a.timestamp_exp_show.indexOf("(")&&(a.timestamp_show_title="")},a.timeInputBlur=function(b,c,d){var e=1==c?"开始时间小时":2==c?"开始时间分钟":3==c?"开始时间秒":"";if(!b)return a.info.log.log_pick_info.show_img=e+"不能为空",!1;var f;if(f=parseInt(b),1==c){if(f>24)return a.info.log.log_pick_info.show_img=e+"超过24小时",!1}else if(2==c){if(f>60)return a.info.log.log_pick_info.show_img=e+"超过60分钟",!1}else if(3==c&&f>60)return a.info.log.log_pick_info.show_img=e+"超过60秒钟",!1;if(d.start_hour&&d.start_minutes&&d.start_second){var g=parseInt(d.start_hour),h=parseInt(d.start_minutes),i=parseInt(d.start_second);if(g>24||h>60||i>60)return a.info.log.log_pick_info.show_img="时间输入不合法",!1}a.info.log.log_pick_info.show_img=""},a.saveLog=function(){if(a.info.log.log_pick_info.start_hour&&a.info.log.log_pick_info.start_minutes&&a.info.log.log_pick_info.start_second||(a.info.log.log_pick_info.show_img="请完善定时获取信息"),!M.valiForm(a.info.log_form))return!1;if(!(a.info.log.log_pick_info.start_hour&&a.info.log.log_pick_info.start_minutes&&a.info.log.log_pick_info.start_second))return a.info.log.log_pick_info.show_img="请完善定时获取信息",!1;if(parseInt(a.info.log.log_pick_info.start_hour)>24||parseInt(a.info.log.log_pick_info._start_minutes_count)>60||parseInt(a.info.log.log_pick_info._start_second_count)>60)return a.info.log.log_pick_info.show_img="时间输入不合法",!1;if(a.info.log.name_exist)return w.alert("日志名已经存在,请重新填写",3),!1;if(0==a.info.log.log_configs.length)return w.alert("请完善日志来源信息",3),!1;if(a.info.log.log_configs.length>0){for(var b=Y(a.info.log.log_configs,["node_ip","soc_name","log_file_path"]),c=!0,d=0;d<a.info.log.log_configs.length;d++)if(a.info.log.log_configs[d].no_save_flag){c=!1;break}if(!a.control.judge_path_flag)return w.alert("请等待验证路径是否存在",3),!1;if(!c)return w.alert("存在日志存储路径不存在,请修改后保存",3),!1;if(!b)return w.alert("日志来源信息不可以重复",3),!1;for(var e=a.info.log.log_file_express?a.info.log.log_file_express:"",f=Z(a.info.log.log_pick_info.start_hour)+":"+Z(a.info.log.log_pick_info.start_minutes)+":"+Z(a.info.log.log_pick_info.start_second),g=0;g<a.info.log.log_configs.length;g++){var h=a.info.log.log_configs[g];h.pull_timing_str=f,h.log_file_name_exp=e}}a.control.log_save_loading=!0;var i="",k="";a.info.log.date_exp_show&&(i=W(a.info.log.date_exp_show,a.data.data_format_list)?a.info.log.date_exp:a.info.log.date_exp_show),a.info.log.timestamp_exp_show&&(k=W(a.info.log.timestamp_exp_show,a.data.time_format_list)?a.info.log.timestamp_exp:a.info.log.timestamp_exp_show);var l=angular.copy(a.info.log);l.date_exp=i,l.timestamp_exp=k,j.saveLogBaseMessage(l,O).then(function(b){a.control.log_save_loading=!1,N=0,w.alert("保存成功",2),a.returnLogList()},function(b){a.control.log_save_loading=!1,w.alert(b.message,3)})},a.getSocByip=function(b,c){for(var d=0;d<a.data.node_ip_list.length;d++){var e=a.data.node_ip_list[d];c.node_ip==e.node_ip&&(c.node_name=e.node_name)}j.getSocListByIpAndBsys(O,c.node_ip,1).then(function(a){g(function(){if(a){for(var b=[],d=a.source_list?a.source_list:[],e=0;e<d.length;e++){var f=d[e];b.push(f.soc_name)}c.exe_soc_list=b}},0)},function(a){w.alert(a.message,3)})},a.deleteLogPath=function(b,c){a.info.log.log_configs.splice(c,1)},a.addLogSource=function(){var b=a.info.log.log_name?angular.copy(a.info.log.log_name):"",c=angular.copy(N)?angular.copy(N):0,d={sys_name:O,log_name:b,ip:"",node_name:"",log_file_path:"",soc_name:"",pull_flag:c?c:0};a.info.log.log_configs.push(d)},a.changeSourceFlag=function(){a.control.judge_path_flag=!1},a.returnLogList=function(){b.go("sys_config.log_list")},_(),$(document).mouseup(function(a){U("first-span-choose","target-log-choose",a),U("second-span-choose","target-second-log-choose",a)})}]),bsCtrl.controller("logTabDetailCtrl",["$scope","$state","$stateParams","$rootScope","$location","$sce","$timeout","$interval","DirNodeShare","Sys","ProtocolType","ApplicateType","Cmpt","ParamType","IML_TYPE","CodeMirrorOption","CmptFunc","BsysFunc","NodeType","OperateSys","NodeReform","ProgType","Modal","LogFormat","logCharacterEncod","logWrapStyle","logTimeStampType","LogType","logDateFormat","logTimeFormat","newLogDateStampType","newLogTimeStampType","pluginExeEnv","LanguageName","operateSysBit","envManage","pluginLibType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L){var M=0,N=c.sys_id,O=c.judge_id?c.judge_id:"";a.control={show_first_base:!1,show_second_base:!1,show_third_base:!1},a.info={log:{log_configs:[],keywords:[],log_pick_info:{}}},a.data={data_format_list:E,time_format_list:F};var P=function(a){var b={size:0,size_str:""};b.size=0;for(var c=0;c<a.length;c++){var d=a[c];b.size=b.size+parseInt(d.file_length)}return 0==b.size?(b.size=0,b.size_str="0M"):b.size<1024?b.size_str=b+"b":b.size>1024&&(b.size<1048576?b.size_str=Math.floor(b.size/1024)+"kb":b.size_str=Math.floor(b.size/1048576)+"M"),b},Q=function(){g(function(){j.getAllLogList(N,0).then(function(b){g(function(){b&&(a.config.tem_logs=b.logBeanList?b.logBeanList:[],angular.forEach(a.data.logs,function(a){if(a.log_type_cn=L.findValue(a.log_type,B),a.logSyncInfos){var b=P(a.logSyncInfos);a.size=b.size,a.size_str=b.size_str}else a.size=0,a.size_str="0M"}),R(a.config.tem_logs,O))},0)})},100)},R=function(b,c){for(var d={},e=0;e<b.length;e++){var f=b[e];if(f.log_id==c){d=f;break}}if(d.log_configs){var g=d.log_configs[0],h=g.pull_timing_str,i=[];i=h.split(":"),d.log_pick_info={},d.log_pick_info.start_hour=i[0],d.log_pick_info.start_minutes=i[1],d.log_pick_info.start_second=i[2],d.log_file_express=g.log_file_name_exp,d.pull_timing_str=g.pull_timing_str,M=g.pull_flag?g.pull_flag:0}d.log_type_cn=L.findValue(d.log_type,B);var j=S(1,d);if(-1==j.indexOf("("))d.timestamp_exp_show=j;else{var k=j.indexOf("("),l=j.indexOf(")");d.timestamp_exp_show=j.substring(0,k),d.timestamp_show_title=j.substring(k+1,l)}var m=S(2,d);if(-1==m.indexOf("("))d.date_exp_show=m;else{var n=m.indexOf("("),o=m.indexOf(")");d.date_exp_show=m.substring(0,n),d.date_show_title=m.substring(n+1,o)}a.info.log=angular.copy(d),a.info.log.keywords=d.keywords?d.keywords:[]},S=function(b,c){var d="";return 1==b?d=T(c.timestamp_exp,a.data.time_format_list)?L.findValue(c.timestamp_exp,a.data.time_format_list):c.timestamp_exp:2==b&&(d=T(c.date_exp,a.data.data_format_list)?L.findValue(c.date_exp,a.data.data_format_list):c.date_exp),d},T=function(a,b){for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(a==e.key){c=!0;break}}return c},U=function(){O&&(a.config.tem_logs&&0!=a.config.tem_logs.length?R(a.config.tem_logs,O):Q())};a.baseDownUP=function(b){1==b?a.control.show_first_base=!a.control.show_first_base:2==b?a.control.show_second_base=!a.control.show_second_base:3==b&&(a.control.show_third_base=!a.control.show_third_base)},a.uploadFile=function(){w.uploadLogFile(N,a.info.log.log_name,a.info.log.log_id).then(function(){a.info.log.flag=!0})},a.returnLogList=function(){b.go("sys_config.log_list")},U()}]);var cmpt_m=angular.module("CmptCtrl",[]);cmpt_m.controller("cmptCtrl",["$scope","$state",function(a,b){a.info={current_route_name:"cmpt.cmpt_new"},a.changeTabStyle=function(b){a.info.current_route_name=b}}]),cmpt_m.controller("cmptNewCtrl",["$scope","$timeout","$state","CodeMirrorOption","IML_TYPE","CmptType","CmptSysType","Cmpt","envManage","CmptFunc","Plugin","pluginType","jdkVersion","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){
var p=[],q=[],r=1,s={},t={component_purposes:[],component_source:1,file_path:"",file_param:"",id:"",cn_name:"",bk_desc:"",impl_type:"",param_list:[],command_param_list:[],out_param_list:[],exec_script:"",cmds:[],script_list:[{script_type:"default",active:!0,cmds:[],code_mirror_control:!1,exec_script:""}],tag_list:[],annex_file:"",plugin_list:[],command:{cmds:[],code_mirror_control:!1,exec_script:"",script_type:"default"}};a.config={cmpt_accessory_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},cmpt_fileupload:{suffixs:"xml",filetype:"XML",filename:"",uploadpath:""},cmpt_script_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""}},a.control={new_cmpt_flag:!0,cmpt_save_disabled:!1,cmpt_btn_loading:!1,nav_show_flag:0,cmpt_get_param_loading:!1,cmpt_command_param_loading:!1,expand_flag:!1,import_loading:!1,cmpt_type_disabled:!1,cmpt_type_collect:!1,show_codemirror:!0,show_check_comp:!1},a.info={cmpt_info:{}},a.data={cmpt_type_list:[],certificate_cmpt_list:[],jdk_version_list:m,plugin_list:[],plugin_hint_list:[],auto_param_list:[],execute_type_list:e,label_init_list:[]};var u=function(b,c){for(var d=c,e=(a.control,0);e<b.length;e++)for(var f=0;f<d.length;f++)d[f].key==b[e]&&(d[f].state=!0,2==b[e]&&(a.config.cmpt_script_fileupload.filename=a.info.cmpt_info.file_path.substring(a.info.cmpt_info.file_path.lastIndexOf("/")+1,a.info.cmpt_info.file_path.length),a.info.cmpt_info.file_path=a.config.cmpt_script_fileupload.uploadpath+a.config.cmpt_script_fileupload.filename))},v=function(b){k.getAllPluginList(b).then(function(b){b&&(a.data.plugin_list=b.plugin_list?b.plugin_list:[])},function(a){})},w=function(b){h.grammarBytype(b).then(function(b){if(b){var c=b.grammar_list?b.grammar_list:[];a.data.auto_param_list=j.translateGrammarHint(c),a.shellLoaded(s)}},function(a){})},x=function(){h.getCmptFilePath(1).then(function(c){b(function(){c&&(a.config.cmpt_fileupload.uploadpath=c.file_path?c.file_path:"",a.config.cmpt_script_fileupload.uploadpath=c.file_path?c.file_path:"")},0)},function(a){n.alert(a.message,3)})},y=function(a){for(var b=[],c=0;c<a.length;c++)a[c].plugin_name&&b.push(a[c].plugin_name);return b},z=function(){i.getUploadPath().then(function(b){b&&(a.config.cmpt_accessory_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(a){})},A=function(){angular.forEach(f,function(b){a.data.cmpt_type_list.push(angular.extend({state:!1},b))}),x(),a.info.cmpt_info=angular.copy(t),h.selectAllTas().then(function(c){c&&b(function(){for(var b=c.tag_list?c.tag_list:[],d=0;d<b.length;d++)a.data.label_init_list.push({value:b[d],flag:!1})},0)},function(a){n.alert(a.message,3)}),h.getPublishedCmpt(1,5).then(function(c){c&&b(function(){for(var b=c.comp_list?c.comp_list:[],d=0;d<b.length;d++)a.data.certificate_cmpt_list.push({check_comp_name:b[d].cn_name,check_comp_id:b[d].id})},0)},function(a){n.alert(a.message,3)}),z()};a.selectCmptType=function(){for(var b=0;b<a.info.cmpt_info.script_list.length;b++)a.info.cmpt_info.script_list[b].code_mirror_control=!1;a.info.cmpt_info.component_purposes=[];for(var c=a.data.cmpt_type_list,d=0;d<c.length;d++)c[d].state&&a.info.cmpt_info.component_purposes.push(c[d].key);p=[],a.control.show_check_comp=j.judgeShowCheckCmpt(a.info.cmpt_info.component_purposes),a.control.show_check_comp||a.info.cmpt_info.check_comp_id&&(a.info.cmpt_info.check_comp_id="")},a.chooseImplType=function(c){a.data.plugin_list=[],a.data.auto_param_list=[],r=6>c?1:6==c?4:7==c||8==c?2:14==c?3:1,a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20),w(c),v(c)},a.addClassifyLabel=function(){n.addCmptLabel(a.data.label_init_list).then(function(b){a.data.label_init_list=b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.flag&&c.push(e.value)}a.info.cmpt_info.tag_list=c})},a.addScript=function(){n.addCmptSysType({}).then(function(b){var c={script_type:b.toLowerCase(),code_mirror_control:!1,active:!0,cmds:[],exec_script:""};a.info.cmpt_info.script_list.push(c)})},a.selectScript=function(c){a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0,a.info.cmpt_info.script_list[c]&&(a.info.cmpt_info.script_list[c].code_mirror_control=!0)},20)},a.deleteScript=function(b){n.confirm("确认删除当前脚本？").then(function(c){c&&a.info.cmpt_info.script_list.splice(b,1)})},a.removeCmptFile=function(){a.config.cmpt_fileupload.filename="",a.info.cmpt_info=angular.copy(t),angular.forEach(a.data.cmpt_type_list,function(a){a.state=!1})},a.ImportSuccessThen=function(){var c=a.config.cmpt_fileupload.uploadpath+"/"+a.config.cmpt_fileupload.filename;a.control.import_loading=!0,h.importModule(c).then(function(c){b(function(){if(c){a.info.cmpt_info.id=c.component.id||"",a.info.cmpt_info.cn_name=c.component.cn_name,a.info.cmpt_info.bk_desc=c.component.bk_desc,a.info.cmpt_info.command=c.component.command||"",a.info.cmpt_info.impl_type=c.component.impl_type,a.info.cmpt_info.param_list=c.component.param_list||[],a.info.cmpt_info.command_param_list=c.component.command_param_list||[],a.info.cmpt_info.out_param_list=c.component.out_param_list||[],a.info.cmpt_info.script_list=c.component.script_list||[],a.info.cmpt_info.plugin_list=c.component.plugin_list||[],a.info.cmpt_info.script_list.length>0&&angular.forEach(a.info.cmpt_info.script_list,function(a){a.cmds&&(a.exec_script=j.cmdsToString(a.cmds)),c.active="default"==c.script_type?!0:!1,c.code_mirror_control=!1}),a.info.cmpt_info.check_comp_id=c.component.check_comp_id,a.info.cmpt_info.tag_list=c.component.tag_list||[],a.info.cmpt_info.language_version=c.component.language_version,a.info.cmpt_info.component_purposes=c.component.component_purposes||[],u(a.info.cmpt_info.component_purposes,a.data.cmpt_type_list),a.info.cmpt_info.component_source=c.component.component_source||1,a.control.import_loading=!1,c.component.command&&(a.info.cmpt_info.command={exec_script:j.cmdsToString(c.component.command.cmds),cmds:c.component.command.cmds}),a.control.show_check_comp=j.judgeShowCheckCmpt(a.info.cmpt_info.component_purposes),v(a.info.cmpt_info.impl_type);for(var b=0;b<a.data.label_init_list.length;b++){var d=a.data.label_init_list[b];a.info.cmpt_info.tag_list.indexOf(d.value)>-1&&(d.flag=!0)}}},0),c.component.annex_file&&(a.config.cmpt_accessory_fileupload.filename=c.component.annex_file.substring(c.component.annex_file.lastIndexOf("/")+1),a.info.cmpt_info.annex_file=c.component.annex_file)},function(b){a.control.import_loading=!1,n.alert(b.message,3)})},a.ImportAccessorySuccessThen=function(){a.info.cmpt_info.annex_file=a.config.cmpt_accessory_fileupload.uploadpath+"/"+a.config.cmpt_accessory_fileupload.filename;var b=a.config.cmpt_accessory_fileupload.filename.substring(a.config.cmpt_accessory_fileupload.filename.lastIndexOf(".")+1);a.config.cmpt_accessory_fileupload.filetype=j.judgeFileType(b)},a.removeAccessoryFile=function(){a.config.cmpt_accessory_fileupload.filename="",a.info.cmpt_info.annex_file="",a.config.cmpt_accessory_fileupload.filetype=""},a.downloadAccessoryFile=function(){o.downloadFile(a.info.cmpt_info.annex_file)},a.paramShellLoaded=function(a){d.setParamsEditor(a)},a.addAvailablePlugin=function(){if(0!=a.info.cmpt_info.plugin_list.length){for(var b=0;b<a.info.cmpt_info.plugin_list.length;b++)if(!a.info.cmpt_info.plugin_list[b].plugin_name)return n.alert("请选择插件名",3),!1;if(a.data.plugin_list.length==a.info.cmpt_info.plugin_list.length)return n.alert("无可再添加的插件！",3),!1}a.info.cmpt_info.plugin_list.push({plugin_name:"",plugin_type:"",plugin_file_name:"",plugin_bk_desc:""})},a.bindPluginInfo=function(c,d,e){for(var f={},g=0;g<a.info.cmpt_info.plugin_list.length;g++){var h=a.info.cmpt_info.plugin_list[g].plugin_name;if(f[h])return n.alert("插件已经添加！",3),a.info.cmpt_info.plugin_list.splice(d,1),!1;f[h]=1}for(var i=0;i<a.data.plugin_list.length;i++){var k=a.data.plugin_list[i];if(c==k.plugin_name){e.plugin_type=k.plugin_type,e.plugin_file_name=k.plugin_file_name,e.plugin_bk_desc=k.plugin_bk_desc;break}}a.data.plugin_hint_list=j.translatePluginHint(a.info.cmpt_info.plugin_list),a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20)},a.getPluginTypeCnName=function(a){return o.findValue(a,l)},a.deleteSinglePlugin=function(c){var d=a.info.cmpt_info.plugin_list[c].plugin_name;d?n.confirm("确认是否要删除[ "+d+" ]插件?").then(function(){a.info.cmpt_info.plugin_list.splice(c,1),a.data.plugin_hint_list=j.translatePluginHint(a.info.cmpt_info.plugin_list),a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20)}):(a.info.cmpt_info.plugin_list.splice(c,1),a.data.plugin_hint_list=j.translatePluginHint(a.info.cmpt_info.plugin_list),a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20))},a.mentionParam=function(b){d.setEditor(b,r,a.data.plugin_hint_list,a.data.auto_param_list)},a.shellLoaded=function(c){var e;d.setEditor(c,r,a.data.plugin_hint_list),c.on("blur",function(){e=b(function(){var b=y(a.info.cmpt_info.plugin_list);a.info.cmpt_info.script_list[0].cmds=a.info.cmpt_info.script_list[0].exec_script?a.info.cmpt_info.script_list[0].exec_script.split("\n"):[];var c=a.info.cmpt_info.script_list[0].exec_script+""+a.info.cmpt_info.command.exec_script,d=j.getParamsByScript(c?c:"",b);if(0==d.list.length&&(a.info.cmpt_info.param_list=[]),p.length==d.list.length){if(a.info.cmpt_info.script_msg=d.msg,a.control.cmpt_save_disabled=!1,0==p.length)return!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<p.length;g++)if(d.list[e].param_name==p[g].param_name&&d.list[e].param_group==p[g].param_group){f=!0;break}f||(j.blurGetParams(d,a.info.cmpt_info,a.control,p),p=j.getOldExecParamList(d))}}else j.blurGetParams(d,a.info.cmpt_info,a.control,p),p=j.getOldExecParamList(d)},500)}),c.on("focus",function(){a.control.cmpt_save_disabled=!0,e&&(b.cancel(e),e=null)}),s=c},a.commandShellLoaded=function(c){var e;d.setUniqueParamsEditor(c,r,a.data.plugin_hint_list),c.on("blur",function(){e=b(function(){var b=y(a.info.cmpt_info.plugin_list);a.info.cmpt_info.command.cmds=a.info.cmpt_info.command.exec_script?a.info.cmpt_info.command.exec_script.split("\n"):[];var c=a.info.cmpt_info.command.exec_script+""+a.info.cmpt_info.script_list[0].exec_script,d=j.getParamsByScript(c?c:"",b);if(0==d.list.length&&(a.info.cmpt_info.param_list=[]),q.length==d.list.length){if(a.info.cmpt_info.script_msg=d.msg,a.control.cmpt_save_disabled=!1,0==q.length)return!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<q.length;g++)if(d.list[e].param_name==q[g].param_name&&d.list[e].param_group==q[g].param_group){f=!0;break}f||(j.blurGetParams(d,a.info.cmpt_info,a.control,q),q=j.getOldExecParamList(d))}}else j.blurGetParams(d,a.info.cmpt_info,a.control),q=j.getOldExecParamList(d)},500)}),c.on("focus",function(){a.control.cmpt_save_disabled=!0,e&&(b.cancel(e),e=null)})},a.commandNoneShellLoaded=function(c){var e;d.setNoneParamsEditor(c,r,a.data.plugin_hint_list),c.on("blur",function(){e=b(function(){var b=y(a.info.cmpt_info.plugin_list);a.info.cmpt_info.command.cmds=a.info.cmpt_info.command.exec_script?a.info.cmpt_info.command.exec_script.split("\n"):[];var c=a.info.cmpt_info.command.exec_script+""+a.info.cmpt_info.script_list[0].exec_script,d=j.getParamsByScript(c?c:"",b);if(0==d.list.length&&(a.info.cmpt_info.param_list=[]),q.length==d.list.length){if(a.info.cmpt_info.script_msg=d.msg,a.control.cmpt_save_disabled=!1,0==q.length)return!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<q.length;g++)if(d.list[e].param_name==q[g].param_name&&d.list[e].param_group==q[g].param_group){f=!0;break}f||(j.blurGetParams(d,a.info.cmpt_info,a.control,q),q=j.getOldExecParamList(d))}}else j.blurGetParams(d,a.info.cmpt_info,a.control),q=j.getOldExecParamList(d)},500)}),c.on("focus",function(){a.control.cmpt_save_disabled=!0,e&&(b.cancel(e),e=null)})},a.uploadScriptFileSuccessThen=function(){a.info.cmpt_info.file_path=a.config.cmpt_script_fileupload.uploadpath+"/"+a.config.cmpt_script_fileupload.filename},a.removeScriptFile=function(){a.config.cmpt_script_fileupload.filename="",a.config.info.cmpt_info.file_path="",a.config.info.cmpt_info.exec_script=""},a.downloadScriptFile=function(){o.downloadFile(a.info.cmpt_info.file_path)},a.downLoadPlugin=function(a){o.downloadFile(a)},a.addOutputParam=function(){if(0!=a.info.cmpt_info.out_param_list.length)for(var b=0;b<a.info.cmpt_info.out_param_list.length;b++)if(!a.info.cmpt_info.out_param_list[b].param_name)return n.alert("参数名不能为空",3),!1;a.info.cmpt_info.out_param_list.push({type_name:"",type_cn_name:"",param_name:""})},a.addFileParam=function(){if(0!=a.info.cmpt_info.param_list.length)for(var b=0;b<a.info.cmpt_info.param_list.length;b++)if(!a.info.cmpt_info.param_list[b].param_name)return n.alert("参数名不能为空",3),!1;a.info.cmpt_info.param_list.push({type_name:"",type_cn_name:"",param_name:""})},a.deleteOutputParam=function(b,c){var d=c.type_name?c.type_name:"";n.confirm("确认删除 "+d+" ?").then(function(){a.info.cmpt_info.out_param_list.splice(b,1)})},a.deleteFileParam=function(b,c){var d=c.type_name?c.type_name:"";n.confirm("确认删除 "+d+" ?").then(function(){a.info.cmpt_info.param_list.splice(b,1)})},a.cmptSubmit=function(){if(!o.valiForm(a.cmpt_form))return!1;for(var d=a.info.cmpt_info.script_list[0].exec_script?a.info.cmpt_info.script_list[0].exec_script:"",e=new RegExp("\\$\\{\\s*\\w+\\s*\\.?\\w+\\s*\\}+","g"),f=null!=d.match(e)?j.arrayRemoveRepeat(d.match(e)).sort().toString():"",g=1;g<a.info.cmpt_info.script_list.length;g++){var i=a.info.cmpt_info.script_list[g].exec_script.match(e),k=null!=i?j.arrayRemoveRepeat(i).sort().toString():"";if(k!=f)return n.alert(a.info.cmpt_info.script_list[g].script_type+"应与default脚本参数应保持一致！",3),!1;a.info.cmpt_info.script_list[g].cmds=a.info.cmpt_info.script_list[g].exec_script?a.info.cmpt_info.script_list[g].exec_script.split("\n"):[]}return 2!=a.info.cmpt_info.component_source||a.info.cmpt_info.file_path?(a.control.cmpt_btn_loading=!0,a.info.cmpt_info.command&&a.info.cmpt_info.command.cmds&&(a.info.cmpt_info.command.cmds=a.info.cmpt_info.command.exec_script?a.info.cmpt_info.command.exec_script.split("\n"):[]),19==a.info.cmpt_info.impl_type&&(a.info.cmpt_info.component_source=3),void h.addModule(a.info.cmpt_info).then(function(d){b(function(){d.override_flag?(a.control.cmpt_btn_loading=!1,n.confirm("组件["+a.info.cmpt_info.id+"]已存在，是否覆盖?").then(function(){h.updateModule(a.info.cmpt_info).then(function(a){b(function(){a&&(n.alert("组件保存成功！",2),c.go("cmpt_list"))},0)},function(a){n.alert(a.message,3)})})):(n.alert("组件保存成功！",2),c.go("cmpt_list"))},0)},function(b){n.alert(b.message,3),a.control.cmpt_btn_loading=!1})):(n.alert("请上传脚本文件",3),!1)},a.cmptFormCancel=function(){c.go("cmpt_list")},A()}]),cmpt_m.controller("cmptModifyCtrl",["$scope","$timeout","$state","$stateParams","CodeMirrorOption","IML_TYPE","CmptType","CmptSysType","Cmpt","envManage","CmptFunc","Plugin","pluginType","jdkVersion","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=d.cmpt_id,r=[],s=[],t=1,u={};a.config={cmpt_accessory_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},cmpt_fileupload:{suffixs:"xml",filetype:"XML",filename:"",uploadpath:""},cmpt_script_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""}},a.control={cmpt_save_disabled:!1,cmpt_btn_loading:!1,nav_show_flag:0,cmpt_get_param_loading:!1,cmpt_command_param_loading:!1,expand_flag:!1,import_loading:!1,cmpt_type_disabled:!1,cmpt_type_collect:!1,show_codemirror:!0,show_check_comp:!1},a.info={cmpt_info:{}},a.data={cmpt_type_list:[],certificate_cmpt_list:[],jdk_version_list:n,plugin_list:[],plugin_hint_list:[],auto_param_list:[],execute_type_list:f,label_init_list:[]};var v=function(b){for(var c=a.data.cmpt_type_list,d=0;d<b.length;d++)for(var e=0;e<c.length;e++)c[e].key==b[d]&&(c[e].state=!0)},w=function(b){l.getAllPluginList(b).then(function(b){b&&(a.data.plugin_list=b.plugin_list?b.plugin_list:[])},function(a){})},x=function(b){i.grammarBytype(b).then(function(b){if(b){var c=b.grammar_list?b.grammar_list:[];a.data.auto_param_list=k.translateGrammarHint(c),a.shellLoaded(u)}},function(a){})},y=function(a){for(var b=[],c=0;c<a.length;c++)a[c].plugin_name&&b.push(a[c].plugin_name);return b},z=function(){j.getUploadPath().then(function(b){b&&(a.config.cmpt_accessory_fileupload.uploadpath=b.upload_path?b.upload_path:"")},function(a){})},A=function(){angular.forEach(g,function(b){a.data.cmpt_type_list.push(angular.extend({state:!1},b))}),i.viewModulegetModuleDetail(q).then(function(c){b(function(){if(c){r=c.component.param_list||[];var d={id:c.component.id,cn_name:"/*"==c.component.cn_name.substring(0,2)?c.component.cn_name.substring(2,c.component.cn_name.length-2):c.component.cn_name,old_cn_name:"/*"==c.component.cn_name.substring(0,2)?c.component.cn_name.substring(2,c.component.cn_name.length-2):c.component.cn_name,bk_desc:c.component.bk_desc,command:c.component.command||"",impl_type:c.component.impl_type,param_list:c.component.param_list||[],command_param_list:c.component.command_param_list||[],out_param_list:c.component.out_param_list||[],ref_flag:c.ref_flag?c.ref_flag:!1,cmds:c.component.cmds||[],component_purposes:c.component.component_purposes||[],component_source:c.component.component_source?c.component.component_source:1,file_param:c.component.file_param||"",file_path:c.component.file_path||"",check_comp_id:c.component.check_comp_id,tag_list:c.component.tag_list||[],language_version:c.component.language_version,script_list:c.component.script_list?c.component.script_list:[{script_type:"default",active:!0,cmds:[],code_mirror_control:!1,exec_script:""}],plugin_list:c.component.plugin_list||[],lib_name:c.component.lib_name||"",pgm_name:c.component.pgm_name||"",annex_file:c.component.annex_file};a.config.cmpt_accessory_fileupload.filename=d.annex_file?d.annex_file.substring(d.annex_file.lastIndexOf("/")+1):"",a.config.cmpt_script_fileupload.filename=d.file_path?d.file_path.substring(d.file_path.lastIndexOf("/")+1):"";var e=a.config.cmpt_accessory_fileupload.filename.substring(a.config.cmpt_accessory_fileupload.filename.lastIndexOf(".")+1);a.config.cmpt_accessory_fileupload.filetype=k.judgeFileType(e),a.control.show_check_comp=k.judgeShowCheckCmpt(d.component_purposes),t=d.impl_type<6?1:6==d.impl_type?4:7==d.impl_type||8==d.impl_type?2:14==d.impl_type?3:1,a.info.cmpt_info=angular.extend(a.info.cmpt_info,d),w(d.impl_type),a.data.plugin_hint_list=k.translatePluginHint(a.info.cmpt_info.plugin_list),angular.forEach(a.info.cmpt_info.script_list,function(a){a.cmds&&(a.exec_script=k.cmdsToString(a.cmds)),a.active="default"==a.script_type?!0:!1,a.code_mirror_control=!1}),c.component.command&&c.component.command.cmds&&(a.info.cmpt_info.command={exec_script:k.cmdsToString(c.component.command.cmds),cmds:c.component.command.cmds}),v(a.info.cmpt_info.component_purposes),i.selectAllTas().then(function(c){c&&b(function(){for(var b=c.tag_list?c.tag_list:[],d=0;d<b.length;d++){var e={value:b[d],flag:!1};a.info.cmpt_info.tag_list.indexOf(b[d])>-1&&(e.flag=!0),a.data.label_init_list.push(e)}},0)},function(a){o.alert(a.message,3)}),i.getPublishedCmpt(1,5).then(function(c){c&&b(function(){for(var b=c.comp_list?c.comp_list:[],d=0;d<b.length;d++)a.data.certificate_cmpt_list.push({check_comp_name:b[d].cn_name,check_comp_id:b[d].id})},0)},function(a){o.alert(a.message,3)})}},0)},function(a){o.alert(a.message,3),c.go("cmpt_list")}),z()};a.selectCmptType=function(){for(var b=0;b<a.info.cmpt_info.script_list.length;b++)a.info.cmpt_info.script_list[b].code_mirror_control=!1;a.info.cmpt_info.component_purposes=[];for(var c=a.data.cmpt_type_list,d=0;d<c.length;d++)c[d].state&&a.info.cmpt_info.component_purposes.push(c[d].key);r=[],a.control.show_check_comp=k.judgeShowCheckCmpt(a.info.cmpt_info.component_purposes),a.control.show_check_comp||a.info.cmpt_info.check_comp_id&&(a.info.cmpt_info.check_comp_id="")},a.chooseImplType=function(c){a.data.jdk_version_list=[],a.data.plugin_list=[],a.data.auto_param_list=[],t=6>c?1:6==c?4:7==c||8==c?2:14==c?3:1,a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20),x(c),w(c)},a.addClassifyLabel=function(){o.addCmptLabel(a.data.label_init_list).then(function(b){a.data.label_init_list=b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.flag&&c.push(e.value)}a.info.cmpt_info.tag_list=c})},a.addScript=function(){o.addCmptSysType({}).then(function(b){var c={script_type:b.toLowerCase(),code_mirror_control:!1,active:!0,cmds:[],exec_script:""};a.info.cmpt_info.script_list.push(c)})},a.selectScript=function(c){a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0,a.info.cmpt_info.script_list[c]&&(a.info.cmpt_info.script_list[c].code_mirror_control=!0)},20)},a.deleteScript=function(b){o.confirm("确认删除当前脚本？").then(function(c){c&&a.info.cmpt_info.script_list.splice(b,1)})},a.ImportAccessorySuccessThen=function(){a.info.cmpt_info.annex_file=a.config.config.cmpt_accessory_fileupload.uploadpath+"/"+a.config.config.cmpt_accessory_fileupload.filename;var b=a.config.config.cmpt_accessory_fileupload.filename.substring(a.config.config.cmpt_accessory_fileupload.filename.lastIndexOf(".")+1);a.config.config.cmpt_accessory_fileupload.filetype=k.judgeFileType(b)},a.removeAccessoryFile=function(){a.config.config.cmpt_accessory_fileupload.filename="",a.info.cmpt_info.annex_file="",a.config.cmpt_accessory_fileupload.filetype=""},a.downloadAccessoryFile=function(){p.downloadFile(a.info.cmpt_info.annex_file)},a.paramShellLoaded=function(a){e.setParamsEditor(a)},a.addAvailablePlugin=function(){if(0!=a.info.cmpt_info.plugin_list.length){for(var b=0;b<a.info.cmpt_info.plugin_list.length;b++)if(!a.info.cmpt_info.plugin_list[b].plugin_name)return o.alert("请选择插件名",3),!1;if(a.data.plugin_list.length==a.info.cmpt_info.plugin_list.length)return o.alert("无可再添加的插件！",3),!1}a.info.cmpt_info.plugin_list.push({plugin_name:"",plugin_type:"",plugin_file_name:"",plugin_bk_desc:""})},a.bindPluginInfo=function(c,d,e){for(var f={},g=0;g<a.info.cmpt_info.plugin_list.length;g++){var h=a.info.cmpt_info.plugin_list[g].plugin_name;if(f[h])return o.alert("插件已经添加！",3),a.info.cmpt_info.plugin_list.splice(d,1),!1;f[h]=1}for(var i=0;i<a.data.plugin_list.length;i++){var j=a.data.plugin_list[i];if(c==j.plugin_name){e.plugin_type=j.plugin_type,e.plugin_file_name=j.plugin_file_name,e.plugin_bk_desc=j.plugin_bk_desc;break}}a.data.plugin_hint_list=k.translatePluginHint(a.info.cmpt_info.plugin_list),a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20)},a.getPluginTypeCnName=function(a){return p.findValue(a,m)},a.deleteSinglePlugin=function(c){var d=a.info.cmpt_info.plugin_list[c].plugin_name;d?o.confirm("确认是否要删除[ "+d+" ]插件?").then(function(){a.info.cmpt_info.plugin_list.splice(c,1),a.data.plugin_hint_list=k.translatePluginHint(a.info.cmpt_info.plugin_list),a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20)}):(a.info.cmpt_info.plugin_list.splice(c,1),a.data.plugin_hint_list=k.translatePluginHint(a.info.cmpt_info.plugin_list),a.control.show_codemirror=!1,b(function(){a.control.show_codemirror=!0},20))},a.mentionParam=function(b){e.setEditor(b,t,a.data.plugin_hint_list,a.data.auto_param_list)},a.shellLoaded=function(c){var d;e.setEditor(c,t,a.data.plugin_hint_list),c.on("blur",function(){d=b(function(){var b=y(a.info.cmpt_info.plugin_list);a.info.cmpt_info.script_list[0].cmds=a.info.cmpt_info.script_list[0].exec_script?a.info.cmpt_info.script_list[0].exec_script.split("\n"):[];var c=a.info.cmpt_info.script_list[0].exec_script+""+a.info.cmpt_info.command.exec_script,d=k.getParamsByScript(c?c:"",b);if(0==d.list.length&&(a.info.cmpt_info.param_list=[]),r.length==d.list.length){if(a.info.cmpt_info.script_msg=d.msg,a.control.cmpt_save_disabled=!1,0==r.length)return!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<r.length;g++)if(d.list[e].param_name==r[g].param_name&&d.list[e].param_group==r[g].param_group){f=!0;break}f||(k.blurGetParams(d,a.info.cmpt_info,a.control,r),r=k.getOldExecParamList(d))}}else k.blurGetParams(d,a.info.cmpt_info,a.control,r),r=k.getOldExecParamList(d)},500)}),c.on("focus",function(){a.control.cmpt_save_disabled=!0,d&&(b.cancel(d),d=null)}),u=c},a.commandShellLoaded=function(c){var d;e.setUniqueParamsEditor(c,t,a.data.plugin_hint_list),c.on("blur",function(){d=b(function(){var b=y(a.info.cmpt_info.plugin_list);a.info.cmpt_info.command.cmds=a.info.cmpt_info.command.exec_script?a.info.cmpt_info.command.exec_script.split("\n"):[];var c=a.info.cmpt_info.command.exec_script+""+a.info.cmpt_info.script_list[0].exec_script,d=k.getParamsByScript(c?c:"",b);if(0==d.list.length&&(a.info.cmpt_info.param_list=[]),s.length==d.list.length){if(a.info.cmpt_info.script_msg=d.msg,a.control.cmpt_save_disabled=!1,0==s.length)return!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<s.length;g++)if(d.list[e].param_name==s[g].param_name&&d.list[e].param_group==s[g].param_group){f=!0;break}f||(k.blurGetParams(d,a.info.cmpt_info,a.control,s),s=k.getOldExecParamList(d))}}else k.blurGetParams(d,a.info.cmpt_info,a.control),s=k.getOldExecParamList(d)},500)}),c.on("focus",function(){a.control.cmpt_save_disabled=!0,d&&(b.cancel(d),d=null)})},a.commandNoneShellLoaded=function(c){var d;e.setNoneParamsEditor(c,t,a.data.plugin_hint_list),c.on("blur",function(){d=b(function(){var b=y(a.info.cmpt_info.plugin_list);a.info.cmpt_info.command.cmds=a.info.cmpt_info.command.exec_script?a.info.cmpt_info.command.exec_script.split("\n"):[];var c=a.info.cmpt_info.command.exec_script+a.info.cmpt_info.script_list[0].exec_script,d=k.getParamsByScript(c?c:"",b);if(0==d.list.length&&(a.info.cmpt_info.param_list=[]),s.length==d.list.length){if(a.info.cmpt_info.script_msg=d.msg,a.control.cmpt_save_disabled=!1,0==s.length)return!1;for(var e=0;e<d.list.length;e++){for(var f=!1,g=0;g<s.length;g++)if(d.list[e].param_name==s[g].param_name&&d.list[e].param_group==s[g].param_group){f=!0;break}f||(k.blurGetParams(d,a.info.cmpt_info,a.control,s),s=k.getOldExecParamList(d))}}else k.blurGetParams(d,a.info.cmpt_info,a.control),s=k.getOldExecParamList(d)},500)}),c.on("focus",function(){a.control.cmpt_save_disabled=!0,d&&(b.cancel(d),d=null)})},a.uploadScriptFileSuccessThen=function(){a.info.cmpt_info.file_path=a.config.cmpt_script_fileupload.uploadpath+"/"+a.config.cmpt_script_fileupload.filename},a.removeScriptFile=function(){a.config.cmpt_script_fileupload.filename="",a.config.info.cmpt_info.file_path="",a.config.info.cmpt_info.exec_script=""},a.downloadScriptFile=function(){p.downloadFile(a.info.cmpt_info.file_path)},a.downLoadPlugin=function(a){p.downloadFile(a)},a.addOutputParam=function(){if(0!=a.info.cmpt_info.out_param_list.length)for(var b=0;b<a.info.cmpt_info.out_param_list.length;b++)if(!a.info.cmpt_info.out_param_list[b].param_name)return o.alert("参数名不能为空",3),!1;a.info.cmpt_info.out_param_list.push({type_name:"",type_cn_name:"",param_name:""})},a.addFileParam=function(){if(0!=a.info.cmpt_info.param_list.length)for(var b=0;b<a.info.cmpt_info.param_list.length;b++)if(!a.info.cmpt_info.param_list[b].param_name)return o.alert("参数名不能为空",3),!1;a.info.cmpt_info.param_list.push({type_name:"",type_cn_name:"",param_name:""})},a.deleteOutputParam=function(b,c){var d=c.type_name?c.type_name:"";o.confirm("确认删除 "+d+" ?").then(function(){a.info.cmpt_info.out_param_list.splice(b,1)})},a.deleteFileParam=function(b,c){var d=c.type_name?c.type_name:"";o.confirm("确认删除 "+d+" ?").then(function(){a.info.cmpt_info.param_list.splice(b,1)})},a.cmptSubmit=function(){if(!p.valiForm(a.cmpt_form))return!1;for(var d=a.info.cmpt_info.script_list[0].exec_script?a.info.cmpt_info.script_list[0].exec_script:"",e=new RegExp("\\$\\{\\s*\\w+\\s*\\.?\\w+\\s*\\}+","g"),f=null!=d.match(e)?k.arrayRemoveRepeat(d.match(e)).sort().toString():"",g=1;g<a.info.cmpt_info.script_list.length;g++){var h=a.info.cmpt_info.script_list[g].exec_script.match(e),j=null!=h?k.arrayRemoveRepeat(h).sort().toString():"";if(j!=f)return o.alert(a.info.cmpt_info.script_list[g].script_type+"应与default脚本参数应保持一致！",3),!1;a.info.cmpt_info.script_list[g].cmds=a.info.cmpt_info.script_list[g].exec_script?a.info.cmpt_info.script_list[g].exec_script.split("\n"):[]}return 2!=a.info.cmpt_info.module_purpose||a.info.cmpt_info.file_path?(a.control.cmpt_btn_loading=!0,a.info.cmpt_info.command&&a.info.cmpt_info.command.cmds&&(a.info.cmpt_info.command.cmds=a.info.cmpt_info.command.exec_script?a.info.cmpt_info.command.exec_script.split("\n"):[]),void i.updateModule(a.info.cmpt_info).then(function(d){b(function(){d&&(a.control.cmpt_btn_loading=!1,o.alert("组件信息修改成功",2),c.go("cmpt_list"))},1e3)},function(b){a.control.cmpt_btn_loading=!1,o.alert(b.message,3)})):(o.alert("请上传脚本文件",3),!1)},a.cmptFormCancel=function(){c.go("cmpt_list")},A()}]),cmpt_m.controller("cmptDetailCtrl",["$scope","$stateParams","$state","$timeout","IML_TYPE","CmptType","Cmpt","CmptFunc","CodeMirrorOption","pluginType","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b.cmpt_id,n=1;a.info={cmpt_info:{module_purpose:[],component_source:1,file_path:"",file_param:"",id:m,publish_state:2,cn_name:"",bk_desc:"",type:"",impl_type:"",ref_flag:!1,file_path_export:"",param_list:[],command_param_list:[],out_param_list:[],cmds:[],script_list:[],can_export:!1,tag_list:[],plugin_list:[],command:{cmds:[],code_mirror_control:!1,exec_script:""},lib_name:"",pgm_name:""}},a.config={cmpt_script_fileupload:{suffixs:"sh",filetype:"SHELL",filename:"",uploadpath:""},cmpt_accessory_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},code_mirror_config:{}},a.data={cmpt_type_list:[]},a.control={show_codemirror:!1};var o=function(b){for(var c=a.data.cmpt_type_list,d=0;d<b.length;d++)for(var e=0;e<c.length;e++)c[e].key==b[d]&&(c[e].state=!0)},p=function(){angular.forEach(f,function(b){a.data.cmpt_type_list.push(angular.extend({state:!1},b))}),a.control.show_codemirror=!1,g.viewModulegetModuleDetail(m).then(function(b){d(function(){if(b){var c={id:m,publish_state:b.publish_state?b.publish_state:2,cn_name:b.component.cn_name,bk_desc:b.component.bk_desc,impl_type:b.component.impl_type,command:b.component.command||"",impl_type_cn:l.findValue(b.component.impl_type,e),ref_flag:b.ref_flag,file_path_export:b.file_path,param_list:b.component.param_list||[],command_param_list:b.component.command_param_list||[],out_param_list:b.component.out_param_list||[],component_purposes:b.component.component_purposes||[],component_source:b.component.component_source||1,file_param:b.component.file_param||"",script_list:b.component.script_list||[],file_path:b.component.file_path,check_comp_name:b.component.check_comp_name,language_version:b.component.language_version,tag_list:b.component.tag_list||[],plugin_list:b.component.plugin_list||[],annex_file:b.component.annex_file,lib_name:b.component.lib_name||"",pgm_name:b.component.pgm_name||""};a.config.cmpt_accessory_fileupload.filename=c.annex_file?c.annex_file.substring(c.annex_file.lastIndexOf("/")+1):"";var d=a.config.cmpt_accessory_fileupload.filename.substring(a.config.cmpt_accessory_fileupload.filename.lastIndexOf(".")+1);a.config.cmpt_accessory_fileupload.filetype=h.judgeFileType(d),n=c.impl_type<6?1:6==c.impl_type?4:7==c.impl_type||8==c.impl_type?2:14==c.impl_type?3:1,a.config.code_mirror_config=4==n?i.Sql(!0):3==n?i.Java(!0):2==n?i.Python(!0):i.Sh(!0),angular.forEach(c.component_purposes,function(a){1==a&&(c.can_export=!0)}),a.info.cmpt_info=angular.extend(a.info.cmpt_info,c),angular.forEach(a.info.cmpt_info.script_list,function(a){a.cmds&&(a.exec_script=h.cmdsToString(a.cmds)),a.active="default"==a.script_type?!0:!1,a.code_mirror_control=!1}),b.component.command&&b.component.command.cmds&&(a.info.cmpt_info.command={exec_script:h.cmdsToString(b.component.command.cmds)}),a.info.cmpt_info.exec_script=h.cmdsToString(a.info.cmpt_info.cmds),o(a.info.cmpt_info.component_purposes),a.info.cmpt_info.script_list[0].cmds&&(a.info.cmpt_info.exec_script=h.cmdsToString(a.info.cmpt_info.script_list[0].cmds)),b.component.file_path&&(a.config.cmpt_script_fileupload.uploadpath=b.component.file_path.substring(0,b.component.file_path.lastIndexOf("/")+1),a.config.cmpt_script_fileupload.filename=b.component.file_path.substring(b.component.file_path.lastIndexOf("/")+1,b.component.file_path.length)),
a.control.show_codemirror=!0}},0)},function(a){k.alert(a.message,3),c.go("cmpt_list")})};a.getPluginTypeCnName=function(a){return l.findValue(a,j)},a.selectScript=function(b){a.control.show_codemirror=!1,d(function(){a.control.show_codemirror=!0,a.info.cmpt_info.script_list[b]&&(a.info.cmpt_info.script_list[b].code_mirror_control=!0)},20)},a.downloadScriptFile=function(){l.downloadFile(a.info.cmpt_info.file_path)},a.exportCmpt=function(){k.confirm("确认导出["+a.info.cmpt_info.id+"]组件？").then(function(b){b&&l.downloadFile(a.info.cmpt_info.file_path_export)})},a.downloadAccessoryFile=function(){l.downloadFile(a.info.cmpt_info.annex_file)},a.downLoadPlugin=function(a){l.downloadFile(a)},a.back=function(){c.go("cmpt_list")},p()}]),cmpt_m.controller("cmptListCtrl",["$scope","$timeout","CmptType","Cmpt","Proj","IML_TYPE","ScrollConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i){a.data={cmpt_type_list:angular.copy(c),user_list:[],publish_status_list:[]},a.data.publish_status_list=[{value:"全部",key:0,flag:!1},{value:"已发布",key:1,flag:!1},{value:"未发布",key:2,flag:!1}],a.control={start_opened:!1,end_opened:!1,search_flag:!0,tags_more_flag:!1,classify_flag:!1},a.config={search_form_scroll_config:g,data_picker_max_date:new Date},a.info={high_search_obj:{classify_list:[],exec_type_list:angular.copy(f),key_word:"",component_purpose:0,start_modify_date:"",end_modify_date:"",crt_user_id:"",publish_state:0}};var j=function(){for(var a=0;a<arguments.length;a++)for(var b=0;b<arguments[a].length;b++)arguments[a][b]=angular.extend(arguments[a][b],{flag:!1})},k=function(){d.selectAllTas().then(function(c){c&&b(function(){for(var b=c.tag_list?c.tag_list:[],d=0;d<b.length;d++)a.info.high_search_obj.classify_list.push({value:b[d],flag:!1})},0)},function(a){h.alert(a.message,3)}),d.getAllUser().then(function(c){c&&b(function(){a.data.user_list=c.user_list?c.user_list:[]},0)},function(a){h.alert(a.message,3)})};a.open=function(b,c){a.control.start_opened=1==b?!0:!1,a.control.end_opened=2==b?!0:!1,c.stopPropagation()},a.changeSearchFlag=function(b,c){a.control.search_flag=!1,c.stopPropagation()},a.clearData=function(){j(a.info.high_search_obj.classify_list,a.info.high_search_obj.exec_type_list),a.info.high_search_obj.key_word="",a.info.high_search_obj.component_purpose=0,a.info.high_search_obj.publish_state=0,a.info.high_search_obj.crt_user_id="",a.info.high_search_obj.start_modify_date="",a.info.high_search_obj.end_modify_date=""},a.cancelSeniorSearch=function(){a.control.search_flag=!0},a.closeDatePlugin=function(b){a.control.start_opened=!1,a.control.end_opened=!1},a.countTagDivHeight=function(){b(function(){var b=$(".classify-tag-id").height();b>48?a.control.classify_flag=!0:a.control.classify_flag=!1},500)},k()}]),cmpt_m.controller("cmptsNewCtrl",["$scope","$timeout","$state","CmptType","Cmpt","CmptFunc","IML_TYPE","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k,l={id:"",cn_name:"",bk_desc:"",modules:[],component_purposes:[],component_list:[]};a.control={new_cmpts_flag:!0,import_loading:!1,expand_flag:!1,cmpts_save_loading:!1},a.data={cmpts_type_list:[],execute_type_list:g},a.info={cmpts_info:{}},a.config={view_sh_options:h.Sh(!0),view_sql_options:h.Sql(!0),view_py_options:h.Python(!0),view_java_options:h.Java(!0),cmpts_fileupload:{suffixs:"xml",filetype:"XML",filename:"",uploadpath:""}};var m=function(){e.getCmptFilePath(2).then(function(c){b(function(){c&&(a.config.cmpts_fileupload.uploadpath=c.file_path?c.file_path:"")},0)},function(a){i.alert(a.message,3)})},n=function(b,c){for(var d=c,e=0;e<b.length;e++)for(var f=0;f<d.length;f++)d[f].key==b[e]&&(d[f].state=!0,2==b[e]&&(a.config.cmpt_script_fileupload.filename=a.info.cmpts_info.file_path.substring(a.info.cmpts_info.file_path.lastIndexOf("/")+1,a.info.cmpts_info.file_path.length),a.info.cmpts_info.file_path=a.config.cmpt_script_fileupload.uploadpath+a.config.cmpt_script_fileupload.filename))},o=function(){angular.forEach(d,function(b){a.data.cmpts_type_list.push(angular.extend({state:!1},b))}),a.info.cmpts_info=angular.copy(l),m()};a.removeCmptFile=function(){a.config.cmpts_fileupload.filename="",a.info.cmpts_info=angular.copy(l),angular.forEach(a.data.cmpts_type_list,function(a){a.state=!1})},a.ImportSuccessThen=function(){var c=a.config.cmpt_fileupload.uploadpath+"/"+a.config.cmpt_fileupload.filename;a.control.import_loading=!0,e.getImportCmptGroupInfo(c).then(function(c){b(function(){c.group&&(a.info.cmpts_info.cn_name=c.group.cn_name,a.info.cmpts_info.id=c.group.id,a.info.cmpts_info.bk_desc=c.group.bk_desc,a.info.cmpts_info.component_list=c.group.component_list?c.group.component_list:[],a.info.cmpts_info.component_purposes=c.group.component_purposes,angular.forEach(a.info.cmpts_info.component_list,function(a){a.script_list&&(a.exec_script=f.cmdsToString(a.script_list[0].cmds)),a.impl_type&&(a.impl_type_formcat=j.findValue(a.impl_type,g))}),n(a.info.cmpts_info.component_purposes,a.data.cmpts_type_list),a.control.import_loading=!1)},0)},function(b){a.control.import_loading=!1,i.alert(b.message,3)})},a.selectCmptsType=function(b){a.info.cmpts_info.component_purposes=[];for(var c=a.data.cmpts_type_list,d=0;d<c.length;d++)c[d].state&&a.info.cmpts_info.component_purposes.push(c[d].key)},a.addCmpt=function(){var c=1,d=1;i.cmptEdit(c,d).then(function(c){c&&e.getCmptGroupDetail(c).then(function(c){b(function(){if(c.component_list){for(var b=c.component_list?c.component_list:[],d=0;d<b.length;d++){var e=b[d];e.param_list=e.param_list||[],e.script_list&&(e.exec_script=f.cmdsToString(e.script_list[0].cmds)),e.ref_params=[],e.cn_name="/*"==e.cn_name.substring(0,2)?e.cn_name.substring(2,e.cn_name.length-2):e.cn_name,e.show_detail=!1,e.phase_type_cn=j.findValue(e.impl_type,a.data.execute_type_list),a.info.cmpts_info.component_list.push(e)}a.control.nav_show_flag=f.judgeShowDetail(a.info.cmpts_info.component_list)}},0)},function(a){i.alert(a.message,3)})})},a.removeSingleCmpt=function(b,c,d){b.stopPropagation();var e=c.cn_name||"",g=1==c.type?"组件":4==c.type?"阶段":" 组件组";i.confirm("确认删除 ["+e+"] "+g+"?").then(function(){a.info.cmpts_info.component_list.splice(d,1),i.alert(e+" 删除成功!",2),a.control.nav_show_flag=f.judgeShowDetail(a.info.cmpts_info.component_list)})},a.getDownTime=function(){k=(new Date).getTime()},a.toggleModulesDetail=function(b){var c=(new Date).getTime();c-k>300||(b.show_detail=!b.show_detail,a.control.nav_show_flag=f.judgeShowDetail(a.info.cmpts_info.component_list),a.control.expand_flag=2==a.control.nav_show_flag?!0:!1)},a.collapseAll=function(){a.control.nav_show_flag=f.closeAllModules(a.info.cmpts_info.component_list)},a.expandAll=function(){a.control.nav_show_flag=f.expandAllModules(a.info.cmpts_info.component_list)},a.stopPrevent=function(a){a.stopPropagation()},a.cmptsSubmit=function(){return j.valiForm(a.cmpts_form)?(a.control.cmpts_save_loading=!0,void e.addCmptGroup(a.info.cmpts_info).then(function(d){b(function(){d.override_flag?i.confirm("组件已存在，是否覆盖?").then(function(){e.updateSingleCmptGroup(a.info.cmpts_info).then(function(a){b(function(){i.alert("组件组保存成功！",2),c.go("cmpts_list")},0)},function(a){i.alert(a.message,3)})}):(i.alert("组件组保存成功!",2),c.go("cmpts_list")),a.control.cmpts_save_loading=!1},0)},function(b){a.control.cmpts_save_loading=!1,i.alert(b.message,3)})):!1},a.cmptsCancel=function(){c.go("cmpts_list")},o()}]),cmpt_m.controller("cmptsListCtrl",["$scope","CV",function(a,b){a.clear=function(){a.search_key_word=""}}]),cmpt_m.controller("cmptsModifyCtrl",["$scope","CmptType","$stateParams","$state","$timeout","IML_TYPE","Cmpt","CmptFunc","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=c.cmpts_id;a.control={loading:!1,param_list_show:!1,ref_flag:!1,nav_show_flag:0,no_ref_param:!1,modules_loading:!1,expand_flag:!1},a.data={cmpts_type_list:[],execute_type_list:f},a.config={view_sh_options:i.Sh(!0),view_sql_options:i.Sql(!0),view_py_options:i.Python(!0),view_java_options:i.Java(!0)},a.info={cmpts_info:{id:"",cn_name:"",bk_desc:"",component_list:[]}};var n=function(b){for(var c=a.data.cmpts_type_list,d=0;d<b.length;d++)for(var e=0;e<c.length;e++)c[e].key==b[d]&&(c[e].state=!0)},o=function(){if($(document).scrollTop()>=420){var b;b=a.left_flag?"197px":"344px",$(".fixedGroup").css({position:"fixed",top:"100px",left:b,"z-index":"999"}).removeClass("col-sm-6").find("button").addClass("btn-vertical")}else $(".fixedGroup").css({position:"static"}).addClass("col-sm-6").find("button").removeClass("btn-vertical")},p=function(){angular.forEach(b,function(b){a.data.cmpts_type_list.push(angular.extend({state:!1},b))}),g.viewSingleCmptGroup(m).then(function(b){e(function(){b.group&&(a.info.cmpts_info.cn_name=b.group.cn_name,a.info.cmpts_info.old_cn_name=b.group.cn_name,a.info.cmpts_info.id=b.group.id,a.info.cmpts_info.bk_desc=b.group.bk_desc,a.info.cmpts_info.component_list=b.group.component_list||[],a.info.cmpts_info.component_purposes=b.group.component_purposes,angular.forEach(a.info.cmpts_info.component_list,function(a,b,c){a.show_detail=!1,a.script_list&&(a.exec_script=h.cmdsToString(a.script_list[0].cmds)),a.impl_type&&(a.impl_type_formcat=k.findValue(a.impl_type,f))}),n(a.info.cmpts_info.component_purposes),a.control.modules_loading=!0)},0)},function(a){j.alert(a.message,3),d.go("cmpts_list")})};a.selectCmptsType=function(){var b=a.data.cmpts_type_list;a.info.cmpts_info.component_purposes=[];for(var c=0;c<b.length;c++)b[c].state&&a.info.cmpts_info.component_purposes.push(b[c].key)},a.paramShellLoaded=function(a){i.setParamsEditor(a)},a.addCmpt=function(b){var c=1,d=1;j.cmptEdit(c,d).then(function(b){b&&g.getCmptGroupDetail(b).then(function(b){e(function(){if(b.component_list){for(var c=b.component_list||[],d=0;d<c.length;d++){var e=c[d];e.show_detail=!1,e.param_list=e.param_list||[],e.script_list&&(e.exec_script=h.cmdsToString(e.script_list[0].cmds)),e.impl_type&&(e.impl_type_formcat=k.findValue(e.impl_type,f)),a.info.cmpts_info.component_list.push(e)}a.control.nav_show_flag=h.judgeShowDetail(a.info.cmpts_info.component_list)}},0)},function(a){j.alert(a.message,3)}),$("html,body").animate({scrollTop:9999})})},a.removeSingleCmpt=function(b,c,d){b.stopPropagation(),b.preventDefault();var e=c.cn_name?c.cn_name:"",f=1==c.type?"组件":4==c.type?"阶段":" 组件组";j.confirm("确认删除"+e+f+"?").then(function(){a.info.cmpts_info.component_list.splice(d,1),j.alert(e+" 删除成功!",2),a.control.nav_show_flag=h.judgeShowDetail(a.info.cmpts_info.component_list)})},a.getDownTime=function(){l=(new Date).getTime()},a.toggleModulesDetail=function(b){var c=(new Date).getTime();c-l>300||(b.show_detail=!b.show_detail,a.control.nav_show_flag=h.judgeShowDetail(a.info.cmpts_info.component_list),2==a.control.nav_show_flag?a.control.expand_flag=!0:a.control.expand_flag=!1)},a.collapseAll=function(){a.control.nav_show_flag=h.closeAllModules(a.info.cmpts_info.component_list)},a.expandAll=function(){a.control.nav_show_flag=h.expandAllModules(a.info.cmpts_info.component_list)},a.stopPrevent=function(a){a.stopPropagation()},a.cmptsSubmit=function(){return k.valiForm(a.cmpts_form)?(a.control.loading=!0,void g.updateSingleCmptGroup(a.info.cmpts_info).then(function(a){j.alert("组件组保存成功！",2),d.go("cmpts_list")},function(b){a.control.loading=!1,j.alert(b.message,3)})):!1},a.cmptsCancel=function(){d.go("cmpts_list")},$(window).scroll(function(){o()}),p()}]),cmpt_m.controller("cmptsDetailCtrl",["$scope","CmptType","$stateParams","$state","$timeout","IML_TYPE","Cmpt","CmptFunc","CodeMirrorOption","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){var l=c.cmpts_id;a.control={nav_show_flag:0,expand_flag:!1},a.data={cmpt_type_list:[]},a.info={cmpts_info:{id:"",cn_name:"",bk_desc:"",component_list:[],publish_state:"",ref_flag:"",file_path_export:""}},a.config={view_sh_options:i.Sh(!0),view_sql_options:i.Sql(!0),view_py_options:i.Python(!0),view_java_options:i.Java(!0)};var m=function(b){for(var c=a.data.cmpt_type_list,d=0;d<b.length;d++)for(var e=0;e<c.length;e++)c[e].key==b[d]&&(c[e].state=!0)},n=function(){angular.forEach(b,function(b){a.data.cmpt_type_list.push(angular.extend({state:!1},b))}),g.viewSingleCmptGroup(l).then(function(b){e(function(){b.group&&(a.info.cmpts_info.cn_name=b.group.cn_name,a.info.cmpts_info.id=b.group.id,a.info.cmpts_info.bk_desc=b.group.bk_desc,a.info.cmpts_info.publish_state=b.publish_state,a.info.cmpts_info.component_list=b.group.component_list||[],a.info.cmpts_info.file_path_export=b.file_path,a.info.cmpts_info.component_purposes=b.group.component_purposes,angular.forEach(a.info.cmpts_info.component_list,function(a,b,c){a.alias_name=a.alias_name?a.alias_name:a.cn_name,a.show_detail=!1,a.script_list&&(a.exec_script=h.cmdsToString(a.script_list[0].cmds)),a.impl_type&&(a.impl_type_formcat=k.findValue(a.impl_type,f))}),m(a.info.cmpts_info.component_purposes))},0)},function(a){j.alert(a.message,3),d.go("cmpts_list")})};a.exportCmpts=function(){j.confirm("确认导出["+l+"]组件组？").then(function(b){b&&k.downloadFile(a.info.cmpts_info.file_path_export)})},a.toggleModulesDetail=function(b){b.show_detail=!b.show_detail,a.control.nav_show_flag=h.judgeShowDetail(a.info.cmpts_info.component_list),2==a.control.nav_show_flag?a.control.expand_flag=!0:a.control.expand_flag=!1},a.collapseAll=function(){a.control.nav_show_flag=h.closeAllModules(a.info.cmpts_info.component_list)},a.expandAll=function(){a.control.nav_show_flag=h.expandAllModules(a.info.cmpts_info.component_list)},a.stopPrevent=function(a){a.stopPropagation()},a.back=function(){d.go("cmpts_list")},n()}]),cmpt_m.controller("cmptTestCtrl",["$scope","$stateParams","$state","$timeout","$interval","Cmpt","CmptFunc","ProtocolType","jdkVersion","CodeMirrorOption","pluginType","envManage","NodeReform","BusiSys","LanguageName","pluginExeEnv","operateSysBit","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b.cmpt_name,u=b.cmpt_id,v=1;a.control={exec_flag:!1,items:{dynamic:0,type:"info"},exec_loading:!1,get_soc_loading:!1,get_support_soc_loading:!1},a.data={ip_data_list:[],exec_soc_list:[],support_soc_list:[],jdk_version_list:i},a.info={cmpt_test_info:{id:u,impl_type:"",param_list:[],phase:{impl_type:"",node_soc_list:[],plugin_list:[]},script_list:[],deploy_soc:{execute_ip:"",execute_soc_name:"",support_ip:"",support_soc_name:""}},cmpt_basic_info:{cn_name:t,log_file_path:""}},a.config={cmpt_accessory_fileupload:{suffixs:"",filetype:"",filename:"",uploadpath:""},view_options:{}};var w=function(){f.viewModulegetModuleDetail(u).then(function(b){d(function(){if(b){a.info.cmpt_test_info.param_list=b.component.param_list||[],a.info.cmpt_test_info.phase.plugin_list=b.component.plugin_list||[];for(var c=0;c<a.info.cmpt_test_info.param_list.length;c++){var d=a.info.cmpt_test_info.param_list[c];d.show_input=!0}a.info.cmpt_test_info.script_list=b.component.script_list||[];for(var e=0;e<a.info.cmpt_test_info.script_list.length;e++)a.info.cmpt_test_info.script_list[e].cmds&&(a.info.cmpt_test_info.script_list[e].exec_script=g.cmdsToString(a.info.cmpt_test_info.script_list[e].cmds)?g.cmdsToString(a.info.cmpt_test_info.script_list[e].cmds):"",a.info.cmpt_test_info.script_list[e].script_type_cn="default"==a.info.cmpt_test_info.script_list[e].script_type?"缺省":a.info.cmpt_test_info.script_list[e].script_type);a.info.cmpt_test_info.script_type=b.component.script_list[0].script_type,a.info.cmpt_test_info.exec_script=b.component.script_list[0].exec_script,a.info.cmpt_test_info.impl_type=b.component.impl_type||"",a.info.cmpt_test_info.phase.component_source=b.component.component_source||1,a.info.cmpt_test_info.phase.file_path=b.component.file_path||"",a.info.cmpt_test_info.phase.impl_type=b.component.impl_type||"",b.component.language_version&&(a.info.cmpt_test_info.language_version=b.component.language_version,a.info.cmpt_test_info.phase.language_version=b.component.language_version),b.component.annex_file&&(a.info.cmpt_test_info.phase.annex_file=b.component.annex_file,a.info.cmpt_test_info.annex_file=b.component.annex_file,a.config.cmpt_accessory_fileupload.filename=b.component.annex_file?b.component.annex_file.substring(b.component.annex_file.lastIndexOf("/")+1):""),(15==b.component.impl_type||17==b.component.impl_type)&&b.component.command&&b.component.command.cmds&&(a.info.cmpt_test_info.phase.command=b.component.command,a.info.cmpt_test_info.command={exec_script:g.cmdsToString(b.component.command.cmds),cmds:b.component.command.cmds}),v=a.info.cmpt_test_info.impl_type<6?1:6==a.info.cmpt_test_info.impl_type?4:7==a.info.cmpt_test_info.impl_type||8==a.info.cmpt_test_info.impl_type?2:14==a.info.cmpt_test_info.impl_type?3:1,a.config.view_options=4==v?j.Sql(!0):3==v?j.Java(!0):2==v?j.Python(!0):j.Sh(!0),(b.component.plugin_list||14==a.info.cmpt_test_info.impl_type||7==a.info.cmpt_test_info.impl_type||8==a.info.cmpt_test_info.impl_type||15==a.info.cmpt_test_info.impl_type||17==a.info.cmpt_test_info.impl_type)&&m.getIpByNone().then(function(b){a.data.ip_data_list=b.ip_list?b.ip_list:[]},function(a){})}},0)},function(a){r.alert(a.message,3),c.go("cmpt_list")})};a.getProtocolTypeCnName=function(a){return s.findValue(a,h).substring(0,5).toLowerCase()},a.getPluginTypeCnName=function(a){return s.findValue(a,k)},a.configSoc=function(b){r.configDataSource(b,"",a.info.cmpt_test_info.phase.node_soc_list,2).then(function(c){for(var d=[],e=0;e<c.length;e++)b>2&&6>b?c[e].exe_soc_name&&c[e].ver_soc_name&&(c[e].execute_soc_name=c[e].exe_soc_name,c[e].execute_ip=c[e].exe_ip,c[e].execute_protocol_type=c[e].exe_protocol_type,c[e].support_soc_name=c[e].ver_soc_name,c[e].support_ip=c[e].ver_ip,c[e].support_protocol_type=c[e].ver_protocol_type,d.push(c[e])):c[e].exe_soc_name&&(c[e].execute_soc_name=c[e].exe_soc_name,c[e].execute_ip=c[e].exe_ip,c[e].execute_protocol_type=c[e].exe_protocol_type,d.push(c[e]));a.info.cmpt_test_info.phase.node_soc_list=d,a.info.cmpt_test_info.phase.impl_type=b})},a.deleteSingleSoc=function(b,c){r.confirm("是否要删除此条数据源?").then(function(){a.info.cmpt_test_info.phase.node_soc_list.splice(b,1)})},a.getExecuteSoc=function(b){a.info.cmpt_test_info.deploy_soc.support_ip=b,a.control.get_soc_loading=!0,n.getSocListBySocIpAndSys("",b,2).then(function(b){a.data.exec_soc_list=b.node.exe_soc_list?b.node.exe_soc_list:[],a.control.get_soc_loading=!1},function(b){a.control.get_soc_loading=!1,r.alert(b.message,3)}),a.control.get_support_soc_loading=!0,n.getSocListBySocIpAndSys("",b,14).then(function(b){a.data.support_soc_list=b.node.ver_soc_list?b.node.ver_soc_list:[],a.control.get_support_soc_loading=!1},function(b){a.control.get_support_soc_loading=!1,r.alert(b.message,3)})},a.selectScriptByScriptType=function(a,b){for(var c=0;c<b.script_list.length;c++)if(b.script_list[c].script_type==a){b.exec_script=b.script_list[c].exec_script;break}},a.paramShellLoaded=function(a){j.setParamsEditor(a)},a.showCmptDetail=function(){r.cmptDetail(1,u).then(function(){})},a.downloadTestMessage=function(){s.downloadFile(a.info.cmpt_basic_info.log_file_path)},a.cmptExec=function(){if(!s.valiForm(a.cmpt_test_form))return!1;if(0==a.info.cmpt_test_info.phase.plugin_list.length&&14!=a.info.cmpt_test_info.impl_type&&7!=a.info.cmpt_test_info.impl_type&&8!=a.info.cmpt_test_info.impl_type&&15!=a.info.cmpt_test_info.impl_type&&17!=a.info.cmpt_test_info.impl_type&&0==a.info.cmpt_test_info.phase.node_soc_list.length)return r.alert("请配置运行节点！",3),!1;a.control.exec_flag=!0,a.control.items.dynamic=0,a.control.items.type="info";for(var b=0;b<a.info.cmpt_test_info.param_list.length;b++)a.info.cmpt_test_info.param_list[b].show_input=!1;a.control.is_saved=!0;var c=e(function(){a.control.items.dynamic+=5,a.control.items.type="info",a.control.items.dynamic>=90&&(a.control.items.dynamic=90,e.cancel(c))},1e3);if(a.control.exec_loading=!0,15!=a.info.cmpt_test_info.impl_type)for(var g=0;g<a.info.cmpt_test_info.script_list.length;g++)a.info.cmpt_test_info.script_list[g].script_type==a.info.cmpt_test_info.script_type&&(a.info.cmpt_test_info.phase.script=a.info.cmpt_test_info.script_list[g]);f.getCmptTestInfo(a.info.cmpt_test_info).then(function(b){d(function(){if(b){if(e.cancel(c),a.control.exec_flag=!1,b.result){var d=b.result.length?b.result.length:1;a.control.items.exec_status=b.result[d-1].status}a.control.exec_loading=!1,a.info.cmpt_basic_info.log_file_path=b.log_file_path,(3==a.control.items.exec_status||4==a.control.items.exec_status)&&(a.control.items.type="danger",a.control.items.dynamic=100),5==a.control.items.exec_status&&(a.control.items.type="success",a.control.items.dynamic=100);for(var f=0;f<a.info.cmpt_test_info.param_list.length;f++)a.info.cmpt_test_info.param_list[f].show_input=!0}},0)},function(b){e.cancel(c),a.control.exec_flag=!1,a.control.items.exec_status=6,a.control.items.type="danger",a.control.items.dynamic=100,a.control.exec_loading=!1;for(var d=0;d<a.info.cmpt_test_info.param_list.length;d++)a.info.cmpt_test_info.param_list[d].show_input=!0;r.alert(b.message,3)})},a.downloadAccessoryFile=function(){s.downloadFile(a.info.cmpt_test_info.annex_file)},a.cancel=function(){c.go("cmpt_list")},w()}]);var server_m=angular.module("serverCtrl",[]);server_m.controller("serverNewCtrl",["$scope","$state","Modal","Server","CV",function(a,b,c,d,e){a.info={srv_info:{server_ip:""}},a.control={save_ip_loading:!1},a.saveSrvIp=function(){e.valiForm(a.server_form)&&(a.control.save_ip_loading=!0,d.addServer(a.info.srv_info.server_ip).then(function(c){a.control.save_ip_loading=!1,b.go("srv_new.srv_new_basic",{server_ip:a.info.srv_info.server_ip,agent_status:c.agent_status,server_id:c.server_id})},function(b){c.alert(b.message,3),a.control.save_ip_loading=!1}))}}]),server_m.controller("serverNewBasicInfoCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Modal","Server","ProtocolType","CV",function(a,b,c,d,e,f,g,h,i){a.info={srv_info:{server_ip:c.server_ip,server_id:c.server_id,machine_basic_bean:{machine_hard_bean:{server_name:"",machine_cfg:"",cpu:"",mem:"",disk:"",network:""},machine_soft_bean:{op_system:"",jre:"",middleware:"",database:""}}},agent_status:c.agent_status,data_soc_list:[],node:{plugin_list:[],monitor_item_list:[]}},a.control={basic_info_btn_loading:!1,save_btn_loading:!1,config_info_empty_flag:!0},a.data={machine_hard_bean:{server_name:"",machine_cfg:"",cpu:"",mem:"",disk:"",network:""},machine_soft_bean:{op_system:"",jre:"",middleware:"",database:""}},a.config={form:{}},b.user_info={user_list:[],user_loading:!0,user_msg:""};var j=function(){g.getDataSource(a.info.srv_info.server_ip).then(function(b){a.info.data_soc_list=b.soc_bean_list||[];for(var c=a.info.data_soc_list,d=0;d<c.length;d++)c[d].protocol_type_cn=i.findValue(c[d].protocol_type,h)},function(a){f.alert(a.message,3)}),a.getBasicInfo(),g.getUserList(a.info.srv_info.server_ip).then(function(a){b.user_info.user_loading=!1,b.user_info.user_msg="",b.user_info.user_list=a.user_list||[]},function(a){b.user_info.user_loading=!1,b.user_info.user_msg=a.message})},k=function(b){for(var c=0;c<a.info.node.plugin_list.length;c++){var d=a.info.node.plugin_list[c];d.deploy_status==b&&a.info.node.plugin_list.splice(c--,1)}};a.getBasicInfo=function(){a.control.basic_info_btn_loading=!0,g.getServerBasicInfo(a.info.srv_info.server_ip).then(function(b){e(function(){a.control.basic_info_btn_loading=!1,a.info.srv_info.machine_basic_bean=b.machine_basic_bean||{},a.data.machine_hard_bean=angular.copy(b.machine_basic_bean.machine_hard_bean||{}),a.data.machine_soft_bean=angular.copy(b.machine_basic_bean.machine_soft_bean||{}),a.control.config_info_empty_flag=!1},0)},function(b){f.alert(b.message,3),a.control.basic_info_btn_loading=!1})},a.testIsChange=function(a,b,c,d){a[c]||a[b].replace(/^\s+|\s+$/g,"")!=d[b].replace(/^\s+|\s+$/g,"")&&(a[c]=1)},a.startDeployAgent=function(){f.srvDeployAgent(a.info.srv_info.server_ip,a.info.agent_status,b.user_info).then(function(b){a.info.agent_status=b})},a.chooseDeployPlugin=function(){a.info.node.plugin_list=a.info.node.plugin_list||[],f.SrvPlusePlugin(a.info.node.plugin_list,a.info.srv_info.server_ip,a.info.srv_info.server_id).then(function(b){var c=[],d=[],f={server_ip:a.info.srv_info.server_ip,server_id:a.info.srv_info.server_id,server_user:b.server_user,plugin_list:[]};if(k(3),0===b.selected_plugin.length&&angular.forEach(a.info.node.plugin_list,function(a,b,c){a.deploy_status=4}),0!==b.selected_plugin.length){for(var h=0;h<a.info.node.plugin_list.length;h++){for(var i=a.info.node.plugin_list[h],j=!0,l=0;l<b.selected_plugin.length;l++)i.plugin_name===b.selected_plugin[l].plugin_name&&(j=!1);j&&d.push(i.plugin_name)}if(d.length)for(var m=0;m<a.info.node.plugin_list.length;m++)for(var n=a.info.node.plugin_list[m],o=0;o<d.length;o++)d[o]===n.plugin_name&&2===n.deploy_status&&(n.deploy_status=4);for(var p=0;p<b.selected_plugin.length;p++)b.selected_plugin[p].deploy_status||c.push({plugin_name:b.selected_plugin[p].plugin_name,error_message:"",deploy_status:1});a.info.node.plugin_list=a.info.node.plugin_list.concat(c)}angular.forEach(a.info.node.plugin_list,function(a,b,c){(1===a.deploy_status||2===a.deploy_status)&&f.plugin_list.push(a.plugin_name)}),a.control.plugin_deploy_loading=!0,g.exeDeployPlugin(f).then(function(b){e(function(){a.control.plugin_deploy_loading=!1,k(4);for(var c=b.plugin_list?b.plugin_list:[],d=0;d<a.info.node.plugin_list.length;d++){var e=a.info.node.plugin_list[d];if(c.length)for(var f=0;f<c.length;f++)c[f]===e.plugin_name?(e.error_message=b.error_msg?b.error_msg:"",e.deploy_status=3):e.deploy_status=2;else e.deploy_status=2}},0)},function(b){a.control.plugin_deploy_loading=!1;for(var d=0;d<c.length;d++)for(var e=0;e<a.info.node.plugin_list.length;e++){var f=a.info.node.plugin_list[e];c[d].plugin_name===f.plugin_name&&(f.error_message=b.message,f.deploy_status=3)}})})},a.statusCheckConfig=function(c){f.addCheckItem(b.user_info,a.info.node.node_ip,c.phase).then(function(a){c.phase=a})},a.addCheckItem=function(){if(0!=a.info.node.monitor_item_list.length&&!a.info.node.monitor_item_list[a.info.node.monitor_item_list.length-1].phase.phase_name)return f.alert("请选择检查项组件！",3),void(a.control.un_save_check_flag=!1);var b={monitor_item_name:"",phase:{}};a.info.node.monitor_item_list.push(b)},a.deleteStatusCheck=function(b){f.confirm("确认删除当前检查项？").then(function(){a.info.node.monitor_item_list.splice(b,1)})},a.saveMonitorItem=function(){return i.valiForm(a.config.form.status_monitor)?0==a.info.node.monitor_item_list.length||a.info.node.monitor_item_list[a.info.node.monitor_item_list.length-1].phase.phase_name?(a.control.start_check_save_loading=!0,void Sys.saveMonitorItemData(_sys_id,a.info.node.node_ip,a.info.node.monitor_item_list).then(function(b){b&&(a.control.start_check_save_loading=!1,f.alert("保存成功",2))},function(b){a.control.start_check_save_loading=!1,f.alert(b.message,3)})):void f.alert("请选择检查项组件！",3):!1},a.saveSrvInfo=function(){a.control.save_btn_loading=!0,g.saveServerInfo(a.info.srv_info,a.info.agent_status).then(function(b){a.control.save_btn_loading=!1,d.go("srv_list")},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)})},a.back=function(){d.go("srv_list")},j()}]),server_m.controller("serverListCtrl",["$scope","$timeout","$location","CV",function(a,b,c,d){a.srv={},a.clearIp=function(){a.srv.server_ip=""}}]),server_m.controller("serverModifyCtrl",["$scope","$rootScope","$stateParams","$state","$timeout","Modal","Server","ProtocolType","CV",function(a,b,c,d,e,f,g,h,i){a.info={srv_info:{server_ip:c.server_ip,server_id:"",machine_basic_bean:{machine_hard_bean:{server_name:"",machine_cfg:"",cpu:"",mem:"",disk:"",network:""},machine_soft_bean:{op_system:"",jre:"",middleware:"",database:""}}},agent_status:"",node:{plugin_list:[],monitor_item_list:[]},data_soc_list:[]},a.control={basic_info_btn_loading:!1,save_btn_loading:!1,basic_update_flag:!0},a.data={machine_hard_bean:{server_name:"",machine_cfg:"",cpu:"",mem:"",disk:"",network:""},machine_soft_bean:{op_system:"",jre:"",middleware:"",database:""}},b.user_info={user_list:[],user_loading:!0,user_msg:""};var j=function(b){for(var c=0;c<a.info.node.plugin_list.length;c++){var d=a.info.node.plugin_list[c];d.deploy_status==b&&a.info.node.plugin_list.splice(c--,1)}},k=function(b,c){a.info.node.plugin_list=[],b&&g.getPluginListInNode(b,c).then(function(b){var c=b.deploy_plugin_names?b.deploy_plugin_names:[];angular.forEach(c,function(b){a.info.node.plugin_list.push({deploy_status:2,plugin_name:b})})})},l=function(){g.getDataSource(a.info.srv_info.server_ip).then(function(b){a.info.data_soc_list=b.soc_bean_list||[];for(var c=a.info.data_soc_list,d=0;d<c.length;d++)c[d].protocol_type_cn=i.findValue(c[d].protocol_type,h)},function(a){f.alert(a.message,3)}),a.control.basic_info_btn_loading=!0,g.viewServerInfo(a.info.srv_info.server_ip).then(function(b){a.control.basic_info_btn_loading=!1,a.info.srv_info.server_desc=b.server_bean.server_desc,a.info.agent_status=b.server_bean.agent_status,a.info.srv_info.server_id=b.server_bean.server_id||"",a.info.srv_info.machine_basic_bean=b.machine_basic_bean||a.info.srv_info.machine_basic_bean,a.control.config_info_empty_flag=!b.machine_basic_bean,a.data.machine_hard_bean=b.machine_basic_bean?angular.copy(b.machine_basic_bean.machine_hard_bean):a.data.machine_hard_bean,a.data.machine_soft_bean=b.machine_basic_bean?angular.copy(b.machine_basic_bean.machine_soft_bean):a.data.machine_soft_bean,k(a.info.srv_info.server_id,a.info.srv_info.server_ip)},function(b){a.control.basic_info_btn_loading=!1,f.alert(b.message,3)}),g.getUserList(a.info.srv_info.server_ip).then(function(a){b.user_info.user_loading=!1,b.user_info.user_msg="",b.user_info.user_list=a.user_list||[]},function(a){b.user_info.user_loading=!1,b.user_info.user_msg=a.message})};a.testIsChange=function(a,b,c,d){a[c]||a[b].replace(/^\s+|\s+$/g,"")!=d[b].replace(/^\s+|\s+$/g,"")&&(a[c]=1)},a.startDeployAgent=function(){f.srvDeployAgent(a.info.srv_info.server_ip,a.info.agent_status,b.user_info).then(function(b){a.info.agent_status=b})},a.chooseDeployPlugin=function(){a.info.node.plugin_list=a.info.node.plugin_list||[],f.SrvPlusePlugin(a.info.node.plugin_list,b.user_info).then(function(b){var c=[],d=[],f={server_ip:a.info.srv_info.server_ip,server_id:a.info.srv_info.server_id,server_user:b.server_user,plugin_list:[]};if(j(3),0===b.selected_plugin.length&&angular.forEach(a.info.node.plugin_list,function(a,b,c){a.deploy_status=4}),0!==b.selected_plugin.length){for(var h=0;h<a.info.node.plugin_list.length;h++){for(var i=a.info.node.plugin_list[h],k=!0,l=0;l<b.selected_plugin.length;l++)i.plugin_name===b.selected_plugin[l].plugin_name&&(k=!1);k&&d.push(i.plugin_name)}if(d.length)for(var m=0;m<a.info.node.plugin_list.length;m++)for(var n=a.info.node.plugin_list[m],o=0;o<d.length;o++)d[o]===n.plugin_name&&2===n.deploy_status&&(n.deploy_status=4);for(var p=0;p<b.selected_plugin.length;p++)b.selected_plugin[p].deploy_status||c.push({plugin_name:b.selected_plugin[p].plugin_name,error_message:"",deploy_status:1});a.info.node.plugin_list=a.info.node.plugin_list.concat(c)}angular.forEach(a.info.node.plugin_list,function(a,b,c){(1===a.deploy_status||2===a.deploy_status)&&f.plugin_list.push(a.plugin_name)}),a.control.plugin_deploy_loading=!0,g.exeDeployPlugin(f).then(function(b){e(function(){a.control.plugin_deploy_loading=!1,j(4);for(var c=b.plugin_list?b.plugin_list:[],d=0;d<a.info.node.plugin_list.length;d++){var e=a.info.node.plugin_list[d];if(c.length)for(var f=0;f<c.length;f++)c[f]===e.plugin_name?(e.error_message=b.error_msg?b.error_msg:"",e.deploy_status=3):e.deploy_status=2;else e.deploy_status=2}},0)},function(b){a.control.plugin_deploy_loading=!1;for(var d=0;d<c.length;d++)for(var e=0;e<a.info.node.plugin_list.length;e++){var f=a.info.node.plugin_list[e];c[d].plugin_name===f.plugin_name&&(f.error_message=b.message,f.deploy_status=3)}})})},a.statusCheckConfig=function(c){f.addCheckItem(b.user_info,a.info.node.node_ip,c.phase).then(function(a){c.phase=a})},a.addCheckItem=function(){if(0!=a.info.node.monitor_item_list.length&&!a.info.node.monitor_item_list[a.info.node.monitor_item_list.length-1].phase.phase_name)return f.alert("请选择检查项组件！",3),void(a.control.un_save_check_flag=!1);var b={monitor_item_name:"",phase:{}
};a.info.node.monitor_item_list.push(b)},a.deleteStatusCheck=function(b){f.confirm("确认删除当前检查项？").then(function(){a.info.node.monitor_item_list.splice(b,1)})},a.saveMonitorItem=function(){return i.valiForm(a.config.form.status_monitor)?0==a.info.node.monitor_item_list.length||a.info.node.monitor_item_list[a.info.node.monitor_item_list.length-1].phase.phase_name?(a.control.start_check_save_loading=!0,void Sys.saveMonitorItemData(_sys_id,a.info.node.node_ip,a.info.node.monitor_item_list).then(function(b){b&&(a.control.start_check_save_loading=!1,f.alert("保存成功",2))},function(b){a.control.start_check_save_loading=!1,f.alert(b.message,3)})):void f.alert("请选择检查项组件！",3):!1},a.saveSrvInfo=function(){a.control.save_btn_loading=!0,g.saveServerInfo(a.info.srv_info,a.info.agent_status).then(function(b){a.control.save_btn_loading=!1,d.go("srv_list")},function(b){a.control.save_btn_loading=!1,f.alert(b.message,3)})},a.back=function(){d.go("srv_list")},l()}]),server_m.controller("serverDetailCtrl",["$scope","$stateParams","$state","Modal","Server","ProtocolType","CV",function(a,b,c,d,e,f,g){a.info={srv_info:{server_ip:b.server_ip,server_id:""},agent_status:"",data_soc_list:[],node:{plugin_list:[]}},a.control={basic_info_btn_loading:!1,basic_update_flag:!0},a.data={};var h=function(){e.getDataSource(a.info.srv_info.server_ip).then(function(b){a.info.data_soc_list=b.soc_bean_list||[];for(var c=a.info.data_soc_list,d=0;d<c.length;d++)c[d].protocol_type_cn=g.findValue(c[d].protocol_type,f)},function(a){d.alert(a.message,3)}),e.viewServerInfo(a.info.srv_info.server_ip).then(function(b){a.info.srv_info.server_desc=b.server_bean.server_desc,a.info.agent_status=b.server_bean.agent_status,a.info.srv_info.server_id=b.server_bean.server_id||"",a.info.srv_info.machine_basic_bean=b.machine_basic_bean,a.control.config_info_empty_flag=!b.machine_basic_bean,i(a.info.srv_info.server_id,a.info.srv_info.server_ip)},function(a){d.alert(a.message,3)})},i=function(b,c){a.info.node.plugin_list=[],b&&e.getPluginListInNode(b,c).then(function(b){var c=b.deploy_plugin_names?b.deploy_plugin_names:[];angular.forEach(c,function(b){a.info.node.plugin_list.push({deploy_status:2,plugin_name:b})})})};a.back=function(){c.go("srv_list")},h()}]),server_m.controller("agentMonitorCtrl",["$scope","$rootScope","$stateParams","$interval","$timeout","Server","Modal",function(a,b,c,d,e,f,g){a.info={node_info:{basic_info:{}},search_key_word:""},a.control={view_node:!1,active_node_i:-1},a.data={node_basic_list:[],choosed_node_list:[]};var h=function(b){var c=a.control.active_node_i;b!=c&&(-1!=c&&(a.data.choosed_node_list[c].active=!1,a.data.choosed_node_list[c].one_node_timer&&d.cancel(a.data.choosed_node_list[c].one_node_timer)),a.data.choosed_node_list[b].active=!0,a.control.active_node_i=b)},i=function(b){var c=b||"";f.getAllNodeList(c).then(function(b){b&&(a.data.node_basic_list=b.machines?b.machines:[])},function(a){g.alert(a.message,3)})},j=function(b,c){f.monitorNodeStatus(b).then(function(a){a.server_msg&&(c.sys_info=a.server_msg,c.err_msg="")},function(b){c.err_msg=b.message;var e=a.control.active_node_i;console.log(e),a.data.choosed_node_list[e].one_node_timer&&d.cancel(a.data.choosed_node_list[e].one_node_timer)})},k=function(){i()};a.searchNode=function(a){i(a)},a.tabOne=function(b){h(b),a.info.node_info.err_msg="";var c=a.data.choosed_node_list[b],e=c.ip;a.info.node_info.basic_info=c,j(e,a.info.node_info),c.one_node_timer=d(function(){j(e,a.info.node_info)},8e3)},a.operationSysIcon=function(a,b){var c={"background-size":b,"background-position-x":"0px"};switch(a){case 1:c["background-position-y"]="0px";break;case 2:c["background-position-y"]="-140px";break;case 3:c["background-position-y"]="-120px";break;case 4:c["background-position-y"]="-159px";break;case 5:c["background-position-y"]="-80px";break;case 6:c["background-position-y"]="-100px";break;case 7:c["background-position-y"]="-20px";break;case 8:c["background-position-y"]="-60px";break;case 9:c["background-position-y"]="-40px";break;default:c["background-position-y"]="0px"}return c},a.viewNode=function(b){if(a.control.view_node=!0,0==a.data.choosed_node_list.length)a.data.choosed_node_list.push(a.data.node_basic_list[b]),a.tabOne(a.data.choosed_node_list.length-1);else{for(var c=0,d=0;d<a.data.choosed_node_list.length;d++){var e=a.data.choosed_node_list[d];if(e.ip==a.data.node_basic_list[b].ip){c++;break}}if(0==c)a.data.choosed_node_list.push(a.data.node_basic_list[b]),a.tabOne(a.data.choosed_node_list.length-1);else for(var f=0;f<a.data.choosed_node_list.length;f++){var e=a.data.choosed_node_list[f];if(e.ip==a.data.node_basic_list[b].ip){a.tabOne(f);break}}}},a.closeNodeView=function(){a.control.view_node=!1;var b=a.control.active_node_i;a.data.choosed_node_list[b].one_node_timer&&d.cancel(a.data.choosed_node_list[b].one_node_timer),i(),a.info.search_key_word=""},a.$on("$stateChangeSuccess",function(b,c,e,f,g){if("agent_monitor"!=c.name){var h=a.control.active_node_i;a.data.choosed_node_list[h].one_node_timer&&d.cancel(a.data.choosed_node_list[h].one_node_timer)}}),k()}]);var CvService=angular.module("CvService",[]);CvService.service("CV",["$modal","$rootScope","$timeout","$window","$websocket","baseUrl",function(a,b,c,d,e,f){this.rscode=function(a){var c="00";if(b.rslist&&a)for(var d=0;d<b.rslist.length;d++){var e=b.rslist[d];if(e.rs_url==a){c=e.rs_code;break}}return c},this.dtFormat=function(a,b){if(!a||"string"==typeof a)return a;var c=b?b:"-",d=function(a,b){for(var c=a.toString(10),d=b-c.length;d-->0;)c="0"+c;return c};return a.getFullYear()+c+d(a.getMonth()+1,2)+c+d(a.getDate(),2)},this.dtFormatCn=function(a,b){if(!a||"string"==typeof a)return a;var c=function(a,b){for(var c=a.toString(10),d=b-c.length;d-->0;)c="0"+c;return c};return a.getFullYear()+"年"+c(a.getMonth()+1,2)+"月"+c(a.getDate(),2)+"日"},this.dttFormat=function(a){var b=function(a,b){for(var c=a.toString(10),d=b-c.length;d-->0;)c="0"+c;return c};return b(a.getHours(),2)+":"+b(a.getMinutes(),2)+":"+b(a.getSeconds(),2)},this.toDate=function(a){if(19!=a.length)return null;var b=new Date(Date.parse(a.replace(/-/g,"/")));return"Invalid Date"==b.toString()?null:b},this.dateCalculate=function(a,b,c){var d={dd:864e5,hh:36e5,mm:6e4,ss:1e3};if(!d[b])throw new Error("parameter [dimension] is illegal");if(!angular.isNumber(c))throw new Error("parameter [size] is illegal");var e=a.valueOf();return new Date(e+c*d[b])},this.dateCD=function(a,b){var c=a.getTime(),d=b.getTime(),e=d-c,f=864e5,g=36e5,h=6e4,i=1e3;if(0>=e)return null;var j=Math.floor(e/f);if(0==j){var k=Math.floor(e/g);if(0==k){var l=Math.floor(e/h);return 0==l?Math.floor(e/i)+"秒之后":l+"分钟后"}return k+"小时后"}return j+"天后"},this.usedCnTime=function(a){if(!a)return"";var b="",c=Math.floor(a/86400),d=Math.floor(a%86400/3600),e=Math.floor(a%3600/60),f=a%3600%60;return c>=1&&(b+=c+"天"),d>=1&&(b+=d+"小时"),0!=e&&(b+=e+"分钟"),0!=f&&(b+=f+"秒"),b},this.valiForm=function(a){var b,c=!0;for(b in a.$error){for(var d=a.$error[b],e=0;e<d.length;e++){var f=d[e];f.$invalid&&(f.$dirty=!0)}c=!1}return c},this.findValue=function(a,b){for(var c="",d=0;d<b.length;d++){var e=b[d];e.key==a&&(c=e.value)}return c},this.findKey=function(a,b){for(var c,d=0;d<b.length;d++){var e=b[d];e.value==a&&(c=e.key)}return c},this.downloadFile=function(a){var b=f+"filedownload?isdel=false&filename="+a;d.open(b,"_new")},this.jsonArrToStrArr=function(a,b){for(var c=new Array,d=0;d<a.length;d++)c[d]=new Array,c[d][0]=a[d][b[0]],c[d][1]=a[d][b[1]];return c},this.nullWord=function(){return new RegExp("[(\x00-)]+g","g")},this.nullReg=function(){return new RegExp("	","g")},this.isCanvasSupported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},this.dealBreadCrumbData=function(a,b,c){if(a.ncyBreadcrumb&&0==a.ncyBreadcrumb.floor)b=[];else if(a.ncyBreadcrumb){var d=!1,e=0,f={label:a.ncyBreadcrumb.label,stateName:a.name,params:c,replace_flag:a.ncyBreadcrumb.replace_flag,floor:a.ncyBreadcrumb.floor,menu_name:a.menu_name};1==a.ncyBreadcrumb.floor&&(b=[]);for(var g=0;g<b.length;g++)b[g].replace_flag&&(d=!0,e=1),b[g].label==a.ncyBreadcrumb.label&&(d=!0,e=g);d?b.splice(e,b.length-e,f):b.push(f)}return b},this.creatWebSocket=function(a){var b,c={readyState:0,lastestdata:"",collection:d,sendData:function(a){b.send(JSON.stringify(a))},closeForce:function(){b.reconnectIfNotNormalClose=!1,b.close(!0)}},d=[];return b=e(a),b.reconnectIfNotNormalClose=!0,b.onMessage(function(a){console.log(a),c.readyState=b.readyState,c.lastestdata=a.data,d.push(a.data)}),b.onError(function(a){console.log("连接出错"),c.readyState=b.readyState}),b.onOpen(function(a){console.log("连接成功"),c.readyState=b.readyState}),b.onClose(function(a){console.log("关闭成功"),c.readyState=b.readyState}),c}}]),CvService.provider("CallProvider",function(){this.$get=["$http","$q","baseUrl","CommData","Modal","CV",function(a,b,c,d,e,f){return{call:function(g){var h=b.defer(),i=angular.extend({},d,g.reqData,{org_srv_name:g.actionName.split(".")[0]});return a({method:"POST",url:c+g.actionName,data:i,timeout:1e3*(g.timeout?g.timeout:30),transformResponse:[function(a,b){if(a){if("rp_ViewInTaskActiongetReportJson.do"==g.actionName||"sl_ExportBatchSqlAction.do"==g.actionName||"sl_BatchExecuteSqlAction.do"==g.actionName||"sl_ViewSqlActionqueryBatchSql.do"==g.actionName||"mo_ViewModuleActiongetModuleDetail.do"==g.actionName||"in2_QueryReportDataAction.do"==g.actionName||"sc_ViewScriptActiongetListByOrderSeq.do"==g.actionName||"sc_UploadScriptFileAction.do"==g.actionName||"pj_MonitorLogMsgAction.do"==g.actionName||"tk_ViewSingleJobDetailAction.do"==g.actionName||"fw_SdFlowDetailViewAction.do"==g.actionName||"tk_ViewSdTaskDetailAction.do"==g.actionName){var c=a.replace(/\s+/g," ");return angular.fromJson(c)}if("sp_ReadConfigFileAction.do"==g.actionName||"pj_MonitorPjLogAction.do"==g.actionName){var d=a.replace(f.nullWord(),"");return angular.fromJson(d)}if("mo_ViewComponentActiongetComponentDetail.do"==g.actionName||"bs_ImportProgramAction.do"==g.actionName||"mo_ViewComponentActiongetImportGroupDetail.do"==g.actionName||"mo_ViewComponentActiongetGroupDetail.do"==g.actionName||"mo_ViewComponentActiongetImportComponentDetail.do"==g.actionName||"pj_ViewPjActionqueryPreparePacList.do"==g.actionName||"pj_ViewPjActionqueryPjPublishInfo.do"==g.actionName||"bs_ViewBsProgramActionqueryProgramInfo.do"==g.actionName||"mo_ViewComponentActiongetComponentListDetail.do"==g.actionName||"mo_ViewComponentActiongetGroupListDetail.do"==g.actionName||"sc_ViewScriptActiongetDetail.do"==g.actionName||"pj_ViewPrepareActiongetPrepareMsg.do"==g.actionName||"sp_ViewSystemPrepareActiongetRollBackMsg.do"==g.actionName||"sp_ViewMonitorActiongetConsole.do"==g.actionName||"sp_MonitorPhaseAction.do"==g.actionName||"rz_OnlineAnalyzePageLog.do"==g.actionName||"mo_ComponentTestAction.do"==g.actionName||"pj_ViewPjProgramActiongetProgramForPrepare.do"==g.actionName||"pj_ViewPjProgramActiongetOldPrepareInfo.do"==g.actionName||"sp_ViewSysPublishActiongetSysPubExeDetail.do"==g.actionName||"sp_ViewPjProgramActiongetProgramForPrepare.do"==g.actionName){var d=a.replace(f.nullReg(),"\\t");return angular.fromJson(d)}return a}}].concat(a.defaults.transformResponse)}).success(function(a,b,c,f){if(a){var g=a.sys_header;if("fail"==g.status)h.reject(g);else if("except"==g.status)h.reject({status:"system",message:"请求服务异常\r\n"+g.scode});else{var j=a.appdata,k=j.req_data?j.req_data:i;2==j.svdeal_type?e.localauth(j,k).then(function(a){h.resolve(a),d.org_srv_name=""},function(a){h.reject(a)}):3==j.svdeal_type?e.remoteauth(j,k).then(function(a){h.reject(a)},function(a){h.reject(a)}):4==j.svdeal_type?h.resolve(a):h.resolve(j)}}}).error(function(a,b,c,d){0==b?h.reject({status:"system",message:"服务请求超时!"}):h.reject({status:"system",message:"发生未知错误!"})}),h.promise}}}]}),CvService.factory("TabEventMouserEnter",["$timeout",function(a){var b;return function(){var c=$(this).children().eq(0).children(),d=$(this).parent().parent().siblings().find(".pp"),e=$(this);d.animate({right:"-222px"},200,function(){d.parent().siblings().children().each(function(){e.css("background",e.attr("name")%2==0?"#FFF":"#F6F7FC")})}),b&&a.cancel(b),b=a(function(){e.css("background","#5A72A3"),c.animate({right:"30px"},500)},200)}}]),CvService.factory("TabEventMouserLeave",["$timeout",function(a){var b;return function(){var c=$(this).children().eq(0).children(),d=$(this).children().eq(1).children();b&&a.cancel(b),b=a(function(){c.animate({right:"-222px"},200,function(){d.parent().siblings().children().each(function(){d.css("background",d.attr("name")%2==0?"#FFF":"#F6F7FC")})})},2)}}]),CvService.factory("Modal",["$modal","$timeout","baseUrl",function(a,b,c){var d={},e=function(a,b,d,e,f,g){return{templateUrl:c+"app/templates/modal/"+a,controller:b,size:d,backdrop:f?f:"static",keyboard:angular.isUndefined(g)?!0:g,resolve:e?e:{}}};return d.loading=function(b){return a.open(e("loading_modal.html","LoadingCtrl","md",{Message:function(){return b}}))},d.error=function(b){return a.open(e("alert_modal.html","AlertCtrl","sm",{Message:function(){return b},status:function(){return 0}})).result},d.alert=function(b,c){return a.open(e("alert_info_modal.html","AlertCtrl","sm",{Message:function(){return b},status:function(){return c||1}},!0)).result},d.success=function(b){return a.open(e("alert_modal.html","AlertCtrl","sm",{Message:function(){return b},status:function(){return 2}})).result},d.confirm=function(b){return a.open(e("confirm_modal.html","ConfirmCtrl","sm",{Message:function(){return b}})).result},d.localauth=function(b,c){return a.open(e("auth_local_modal.html","localAuthCtrl","md",{modalParam:function(){return{auth_data:b,srv_req_data:c}}})).result},d.remoteauth=function(b,c){return a.open(e("auth_remote_modal.html","remoteAuthCtrl","md",{modalParam:function(){return{auth_data:b,srv_req_data:c}}})).result},d.compare=function(b,d,e,f,g,h,i,j,k,l,m){return a.open({templateUrl:c+"app/templates/modal/compare_modal.html",controller:"CompareFileCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{modalParam:function(){return{busi_sys_id:b,sys_publish_id:d,node_name:e,file_path:f,check_soc_name:g,download_soc_name:h,download_soc_ip:i,is_edit:j,phase_type:k,phase_no:l,quick_publish:m}}}}).result},d.preLoading=function(b){return a.open(e("loading_modal.html","submitModalCtrl","md",{modalParam:function(){return{req_data:b}}})).result},d.rollbackSummary=function(b,c,d){return a.open(e("rollback_summary_modal.html","RollbackSummaryCtrl","md",{modalParam:function(){return{publish_id:b,busi_sys:c,rollback_flag:d}}})).result},d.summary=function(b,c){return a.open(e("proj_summary_modal.html","SummaryCtrl","md",{modalParam:function(){return{publish_id:b,busi_sys:c}}})).result},d.newGroup=function(){return a.open(e("plan_new_group_modal.html","planNewGroupCtrl","lg",{})).result},d.editGroup=function(b,c,d){return a.open(e("plan_edit_group_modal.html","planEditGroupCtrl","lg",{modalParam:function(){return{group_id:b,group_cn_name:c,group_date:d}}})).result},d.prodPreAddProdPac=function(b,c,d,f,g,h,i){return a.open(e("pre_add_package_modal.html","addPordPacModalCtrl","md",{modalParam:function(){return{propackage_bk_path:b,prolist_bk_path:d,fileupload_path:c,pac_index:f,pac_flag:g,is_prod_list:h,pre_info:i}}})).result},d.prodPreAddProdPacFromPlatform=function(b,c,d,f){return a.open(e("pre_add_platform_package.html","addPlatformPackageModalCtrl","md",{modalParam:function(){return{dir_names:b,pac_index:c,sys_publish_id:d,pre_info:f}}})).result},d.interactOperation=function(b,c,d){return a.open(e("interact_operation_modal.html","showHumanInteractCtrl","md",{modalParam:function(){return{execute_id:b,phaseId:c,steps:d}}})).result},d.chooseRollbackProg=function(b,c){return a.open(e("choose_rollback_prog_modal.html","chooseRollbackProgCtrl","lg",{modalParam:function(){return{business_sys_name:b,publish_id:c}}})).result},d.addMonitorModal=function(b,c,d,f){return a.open(e("add_monitor_log_modal.html","addMonitorLogCtrl","lg",{modalParam:function(){return{business_sys_name:b,project_name:c,environment_id:f,node:d}}})).result},d.configExeNode=function(b,c){return a.open(e("config_exe_node_modal.html","configExecNodeCtrl","md",{modalParam:function(){return{phase_info:b,quick_publish:c}}})).result},d.execResultChange=function(b){return a.open(e("exec_result_change_modal.html","changeExecResultCtrl","md",{modalParam:function(){return{node_info:b}}})).result},d.fileContentFullScreen=function(b,c,d){return a.open(e("file_fullscreen_detail_modal.html","viewfileFullScreenCtrl","lg",{modalParam:function(){return{file_info:b,file_post_header:c,business_sys_name:d}}})).result},d.setNormalWindow=function(){return a.open(e("set_normal_window.html","setNormalWindowTimeCtrl","lg",{})).result},d.setSpecialWindow=function(){return a.open(e("set_special_window.html","setSpecialWindowTimeCtrl","lg",{})).result},d.setBlackWindow=function(){return a.open(e("set_black_window.html","setBlackWindowTimeCtrl","lg",{})).result},d.viewWindowDetail=function(b){return a.open(e("view_window_detail.html","viewWindowDetailCtrl","md",{modalParam:function(){return{event:b}}})).result},d.closePubWindow=function(b){return a.open(e("pub_window_close_reason.html","closeWindowCtrl","md",{modalParam:function(){return{window:b}}})).result},d.prepareChoose=function(b,c){return a.open(e("prepare_choose_modal.html","prepareChooseCtrl","md",{modalParam:function(){return{syspublish_id:b,business_sys_name:c}}})).result},d.interactiveExecute=function(b,c){return a.open(e("interactive_execute_modal.html","interactiveExecuteCtrl","lg",{modalParam:function(){return{execute_id:b,phase_desc:c}}},!1,!1)).result},d.importProgram=function(){return a.open(e("import_new_program.html","importProgramCtrl","sm",{modalParam:function(){return{}}})).result},d.previewProgram=function(b){return a.open(e("scheme_preview.html","schemePreviewCtrl","lg",{modalParam:function(){return{programSeq:b}}})).result},d.importSqlInCreateProgram=function(b){return a.open(e("import_sql.html","importProgramSqlCtrl","lg",{modalParam:function(){return{handleData:b}}})).result},d.addSQL=function(b,c,d,f){return a.open(e("workorder_sqlhandle_addsql.html","workorderAddSQLModalCtrl","lg",{modalParam:function(){return{program_seq:b,db_list:c,sub_tab:d,flag:f}}})).result},d.showAddBatchSqlFile=function(b){return a.open(e("import_batch_sql_modal.html","importBatchSQLCtrl","lg",{modalParam:function(){return{sub_tab:b}}})).result},d.viewSqlDetailStep=function(b){return a.open(e("program_sqlDetailStep_modal.html","ProgramDetailSqlStepCtrl","lg",{modalParam:function(){return{sql_work_seq:b}}})).result},d.viewBatchSqlExecDetail=function(b){return a.open(e("wo_sqlhandle_view_exe_info.html","viewExeInfoCtrl","lg",{modalParam:function(){return{message:b}}})).result},d.viewScriptDetail=function(b,c,d){return a.open(e("view_exec_detail.html","viewScriptInfoCtrl","lg",{modalParam:function(){return{order_seq:b,deal_bk_seq:c,script_bk_seq:d}}})).result},d.viewBatchImportAuthorDetail=function(b){return a.open(e("wo_batch_import_author_detail_modal.html","viewTaskDetailCtrl","md",{modalParam:function(){return{task_id:b}}})).result},d.confirmSqlStatement=function(b,c){return a.open(e("program_confirm_sqlStatement_modal.html","ProgramConfirmSqlStatementCtrl","md",{modalParam:function(){return{sql_step:b,un_submit_sql_steps:c}}})).result},d.viewSqlDetail=function(b,c,d,f){return a.open(e("fault_program_detail_sql.html","faultProgramSqlDetailCtrl","lg",{modalParam:function(){return{program_seq:b,step_seq:c,sql_seq:d,sql_index:f}}})).result},d.viewWorkOrderFlow=function(b){return a.open(e("view_workorder_modal.html","viewWorkOrderFlowCtrl","md",{modalParam:function(){return{data:b}}})).result},d.pglocalauth=function(b,c){return a.open(e("pglocal_auth_modal.html","pgLocalauthCtrl","md",{modalParam:function(){return{data:b,srv_req:c}}})).result},d.pgremoteauth=function(b,c){return a.open(e("pgremote_auth_modal.html","pgRemoteauthCtrl","md",{modalParam:function(){return{data:b,srv_req:c}}})).result},d.faultPeakData=function(b){return a.open(e("peak_date_modal.html","faultPeakDateModalCtrl","lg",{modalParam:function(){return{time_work_seq:b}}})).result},d.faultTroubleType=function(b){return a.open(e("trouble_type_modal.html","faultTroubleTypeCtrl","md",{modalParam:function(){return{trouble_key:b}}})).result},d.workorderRollBack=function(b){return a.open(e("workorder_rollback.html","workOrderRollbackCtrl","md",{modalParam:function(){return{order_seq:b}}})).result},d.workOrderAppoint=function(b){return a.open(e("workorder_appoint_modal.html","workOrderAppointCtrl","md",{modalParam:function(){return{order_seq:b}}})).result},d.workOrderChange=function(b){return a.open(e("workorder_change_modal.html","workOrderChangeCtrl","md",{modalParam:function(){return{order_seq:b}}})).result},d.addCjCollectItem=function(b,c,d){return a.open(e("add_cj_items_modal.html","newCjProgramItemsModalCtrl","lg",{modalParam:function(){return{item:b,is_update:c,business_sys_name:d}}})).result},d.modifyCJProg=function(b,c,d,f){return a.open(e("cj_task_modal.html","cjTaskCtrl","lg",{modalParam:function(){return{module_index:b,modal_info:d,node_list:f,business_sys_name:c}}})).result},d.addTargetModel=function(b){return a.open(e("add_target_model.html","addTargetModelCtrl","md",{modalParam:function(){return{model_list:b}}})).result},d.modifyXJConfig=function(b,c){return a.open(e("xjtask_config_chart_modal.html","xjtaskConfigModalCtrl","lg",{modalParam:function(){return{model_info:b,model_list:c}}})).result},d.importAllStep=function(b){return a.open(e("import_program_step_modal.html","importProgramStepCtrl","sm",{modalParam:function(){return{modal_info:b}}})).result},d.viewTroubleTicketProgram=function(b){return a.open(e("trouble_ticket_task_detail_modal.html","viewTroubleTicketProgramCtrl","md",{modalParam:function(){return{task_id:b}}})).result},d.chooseHandleType=function(b){return a.open(e("pgchange_handletype_modal.html","pgChangeHandleTypeCtrl","md",{modalParam:function(){return{workId:b}}})).result},d.cmptDetail=function(b,c){return a.open(e("cmpt_detail_modal.html","viewCmptDetailModalCtrl","lg",{modalParam:function(){return{type:b,id:c}}})).result},d.addCmptLabel=function(b){return a.open(e("cmpt_classify_label_modal.html","CmptClassifyLabelCtrl","md",{modalParam:function(){return{data:b}}})).result},d.cmptEdit=function(b,c){return a.open(e("cmpt_edit_modal.html","addCmptModalCtrl","lg",{modalParam:function(){return{cmpt_type:b,cmpt_flag:c}}})).result},d.addCmptSysType=function(b){return a.open(e("cmpt_sys_type_modal.html","CmptSysCtrl","md",{modalParam:function(){return{data:b}}})).result},d.cmptGroupDetail=function(b){return a.open(e("cmpt_group_detail_modal.html","cmptGroupDetailModalCtrl","lg",{modalParam:function(){return{id:b}}})).result},d.cmptPhaseEdit=function(b,c,d,f,g,h,i,j,k){return a.open(e("phase_edit_modal.html","modifyPhaseCtrl","lg",{modalParam:function(){return{cn_name:b,impl_type:c,language_version:d,exec_script:f,plugin_list:g,ref_param_list:h,annex_file:i,is_update:j,command:k}}})).result},d.cmptGroupPhaseSoc=function(b,c,d,f,g){return a.open(e("cmpt_group_phase_soc_modal.html","cmptGroupPublishPhaseSocModalCtrl","lg",{modalParam:function(){return{step:b,flag:c,preStepSoc:d,package_list:f,testPreObj:g}}})).result},d.addPlanInSysConfig=function(b,c,d,f){return a.open(e("new_plan_modal.html","newPlanInSysConfigCtrl","lg",{modalParam:function(){return{business_sys_name:b,sys_ip_list:c,prog_id:d,node_ip_name_list:f}}})).result},d.viweSchemeDetail=function(b){return a.open(e("scheme_detail_modal.html","schemeDetailCtrl","lg",{modalParam:function(){return{prog_id:b}}})).result},d.addBusiSysNode=function(b,c,d){return a.open(e("add_node_modal.html","busiSysAddNodeModalCtrl","lg",{modalParam:function(){return{flag:b,business_sys_name:c,node_name:d}}})).result},d.addCollectModule=function(b,c){return a.open(e("add_collect_module_modal.html","addCollectCmptCtrl","md",{modalParam:function(){return{business_sys_name:b,cj_cmpt_list:c}}})).result},d.addPlugin=function(b,c){return a.open(e("add_plugin_modal.html","addPluginCtrl","md",{modalParam:function(){return{plugin_name:b,is_update:c}}})).result},d.addResource=function(b,c){return a.open(e("add_resource_modal.html","addResourceCtrl","md",{modalParam:function(){return{resources_name:b,is_update:c}}})).result},d.plusePlugin=function(b){return a.open(e("config_node_add_plugin.html","plusePluginCtrl","md",{modalParam:function(){return{plugin_list:b}}})).result},d.SrvPlusePlugin=function(b,c){return a.open(e("config_node_add_plugin.html","plusePluginCtrl","md",{modalParam:function(){return{plugin_list:b,user_info:c}}})).result},d.envPlugin=function(){return a.open(e("env_deploy_modal.html","envDeployCtrl","md",{modalParam:function(){return{}}})).result},d.uploadLogFile=function(b,c,d){return a.open(e("upload_logFile_modal.html","uploadLogFileCtrl","md",{modalParam:function(){return{sys_name:b,log_name:c,log_id:d}}})).result},d.deployAgent=function(b,c){return a.open(e("deploy_agent_modal.html","deployAgentCtrl","xl",{modalParam:function(){return{protocol_soc_list:b,node_name:c}}})).result},d.srvDeployAgent=function(b,c,d){return a.open(e("server_agent_deploy_modal.html","ServerAgentDeployCtrl","md",{modalParam:function(){return{server_ip:b,agent_status:c,user_info:d}}})).result},d.configVersionDir=function(b,c){return a.open(e("config_dir_modal.html","configDirCtrl","lg",{modalParam:function(){return{_flag:b,soc_version:c}}})).result},d.addCheckItem=function(b,c,d){return a.open(e("config_check_item_modal.html","configCheckItemCtrl","lg",{modalParam:function(){return{phase:d,user_info:b,soc_ip:c}}})).result},d.addCurPhase=function(b,c,d){return a.open(e("program_add_cur_modal.html","programCurConfigCtrl","md",{modalParam:function(){return{business_sys_name:b,logic_node_list:c,node_soc_list:d}}})).result},d.addManualPhase=function(b){return a.open(e("program_add_manual.html","programManualPhaseCtrl","md",{modalParam:function(){return{script:b}}})).result},d.programBacthConfig=function(b,c,d){return a.open(e("program_batch_config_modal.html","programBatchConfigCtrl","md",{modalParam:function(){return{group_list:b,business_sys_name:c,control:d}}})).result},d.configLogBase=function(b,c){return a.open(e("config_log_modal.html","configLogCtrl","lg",{modalParam:function(){return{sys_name:b,choose_ip_list:c}}})).result},d.configScreenBase=function(b){return a.open(e("config_log_screen_modal.html","configLogScreenCtrl","md",{modalParam:function(){return{log_screen:b}}})).result},d.reportLogChoose=function(b,c){return a.open(e("report_log_modal.html","reportLogChooseCtrl","lg",{modalParam:function(){return{report_choose:b,sys_name:c}}})).result},d.showPluginOrProtocolList=function(b,c,d){return a.open(e("view_plugin_protocol_modal.html","viewPluginProtocolCtrl","sm",{modalParam:function(){return{list:b,ip:c,flag:d}}})).result},d.initModifyPwd=function(b){return a.open(e("password_modify.html","InitModifyPwd","md",{modalParam:function(){return{userid:b}}})).result},d.jsonList=function(b,c,d,f){return a.open(e("json_list.html","JsonListCtrl","md",{modalParam:function(){return{data:b,url:c,aprov_type:d,task_seq:f}}})).result},d.xjInfoTips=function(b){return a.open(e("xj_message_tips.html","xjMessageTipsCtrl","sm",{modalParam:function(){return{data:b}}})).result},d.confDataCollection=function(b,c,d){return a.open(e("xj_data_gather.html","configDataCollectionCtrl","md",{modalParam:function(){return{data:b,task_id:c,indi_model_name:d}}})).result},d.dataGatherDetail=function(b,c){return a.open(e("xj_data_gather_detail.html","dataGatherDetailCtrl","md",{modalParam:function(){return{data:b,task_id:c}}})).result},d.viewFileDirList=function(b,c){return a.open(e("view_file_dir_list.html","ViewFileDirListCtrl","md",{modalParam:function(){return{content:b,init_path:c}}})).result},d.repeatFlowModal=function(b){return a.open(e("Repeat_flow_modal.html","RepeatFlowCtrl","md",{modalParam:function(){return{flow_id:b}}})).result},d.publishReasonModal=function(){return a.open(e("publish_reason_modal.html","FlowPubReasonCtrl","md",{modalParam:function(){return{}}})).result},d.configFlowTime=function(b){return a.open(e("flow_time_config.html","configFlowTimeCtrl","lg",{modalParam:function(){return{data:b}}})).result},d.configFlowTimeCondition=function(b){return a.open(e("flow_set_timecondition_modal.html","configFlowTimeConditionCtrl","sm",{modalParam:function(){return{data:b}}})).result},d.setFlowJobMethod=function(b,c,d,f){return a.open(e("flow_set_jobmethod_modal.html","configFlowJobMethodCtrl","lg",{modalParam:function(){return{job_type:b,job_data:c,is_detail:d,is_special_element:f}}})).result},d.selectFlowRefNode=function(b,c){return a.open(e("flow_select_ref_node_modal.html","configRefNodeCtrl","md",{modalParam:function(){return{source_list:b,ref_node_list:c}}})).result},d.addScene=function(b){return a.open(e("flow_add_scene_modal.html","addSceneCtrl","md",{modalParam:function(){return{scene_list:b}}})).result},d.convertPrivateEle=function(b){return a.open(e("flow_add_private_ele_modal.html","addPrivateElementCtrl","md",{modalParam:function(){return{element:b}}})).result},d.viewSingleWorkInfo=function(b,c,d,f,g){return a.open(e("dtask_view_single_job_modal.html","viewSingleWorkCtrl","md",{modalParam:function(){return{task_id:b,flow_job_list:c,job:d,task_status:f,is_detail:g}}})).result},d.viewTaskProgressInfo=function(){return a.open(e("dtask_progress_modal.html","viewTaskProgressInfoCtrl","md",{modalParam:function(){return{}}})).result},d.addSkipWorkParams=function(b){return a.open(e("add_skipwork_param_modal.html","addSkipWorkParamsCtrl","md",{modalParam:function(){return{output_param:b}}})).result},d.inputStartJobParams=function(b){return a.open(e("input_startjob_param_modal.html","inputStartJobParamsCtrl","md",{modalParam:function(){return{input_param:b}}})).result},d.completeJob=function(b,c){return a.open(e("complete_job_modal.html","completeJobCtrl","md",{modalParam:function(){return{task_id:b,job_id_list:c}}})).result},d.configDataSource=function(b,c,d,f){return a.open(e("config_data_source.html","configDataSourceCtrl","md",{modalParam:function(){return{dataSource_type:b,business_sys_name:c,srv_soc:d,flag:f}}})).result},d.chooseNodes=function(b){return a.open(e("ywtask_choose_nodes.html","ywtaskChooseNodeCtrl","lg",{modalParam:function(){return{node_list:b}}})).result},d.addSceneElement=function(b,c){return a.open(e("add_scene_element_modal.html","addSceneElementCtrl","md",{modalParam:function(){return{scene_info:b,is_update:c}}})).result},d.newStrategyGroup=function(){return a.open(e("add_strategy_group_modal.html","newStrategyGroupCtrl","md",{modalParam:function(){return{}}})).result},d.viewPhaseSoc=function(b){return a.open(e("node_soc_detail_modal.html","nodeSocDetailCtrl","md",{modalParam:function(){return{data:b}}})).result},d.releaseAddProject=function(b){return a.open(e("release_add_project_modal.html","releaseAppAddProjectCtrl","md",{modalParam:function(){return{data:b}}})).result},d}]),CvService.factory("Params",function(){var a={};return a.setParams=function(b){a=angular.extend(a,b)},a.getParams=function(){return a},a.init=function(){a={}},a});var CommHttp=angular.module("CommHttpSrv",[]);CommHttp.service("User",["CallProvider",function(a){this.login=function(b){return a.call({actionName:"us_UserLoginInAction.do",reqData:{org_user_id:b.username,user_passwd:b.password,org_channel_code:"01"}})},this.getPermission=function(b){return a.call({actionName:"us_QueryRsPrivAction.do",reqData:{bl_rs_code:b}})},this.getLicense=function(b){return a.call({actionName:"cm_ViewLicenseActionloadLicense.do",reqData:{submit_type:1}})},this.registLicense=function(b){return a.call({actionName:"cm_RegistLicenseAction.do",reqData:b})},this.getAllUserCanExec=function(){return a.call({actionName:"us_ViewUsforAppActiongetDeptUserListForWeb.do",reqData:{}})},this.getUserByUserId=function(b){return a.call({actionName:"us_QueryUserByUserIdAction.do",reqData:{user_id:b}})},this.UpdatePwd=function(b){
return a.call({actionName:"us_UpdatePwdAction.do",reqData:b})},this.us_UpdateUserAction=function(b){return a.call({actionName:"us_UpdateUserAction.do",reqData:{user_id:b.user_name,user_cn_name:b.user_cn_name,teller_no:b.teller_no,email_add:b.user_email,phone_no:b.phone_number,pwdexp_bk_date:b.pwd_expiry_date,user_type:b.user_type,bl_dept_id:b.user_department,first_dept_id:b.parttime_department,dprl_cn_name:b.department_role}})},this.getContactsListByUserName=function(b,c,d){return a.call({actionName:"us_PageExtUserListAction.do",reqData:{start_recd:b,limit_recd:c,user_cn_name:d}})},this.getCommonlyUsedConcats=function(){return a.call({actionName:"us_QueryUserContactAction.do",reqData:{}})},this.addAttentionContacts=function(b){return a.call({actionName:"us_AddUserContactAction.do",reqData:{contact_user_id:b}})},this.removeAttentionContacts=function(b){return a.call({actionName:"us_DeleteUserContactAction.do",reqData:{contact_user_id:b}})},this.us_QueryFirstNavigagePrivAction=function(){return a.call({actionName:"us_QueryFirstNavigagePrivAction.do",reqData:{}})}}]),CommHttp.service("Message",["CallProvider",function(a){this.mg_PageMessageAction=function(b,c,d){return a.call({actionName:"mg_PageMessageAction.do",reqData:{rc_flag:b,start_recd:c,limit_recd:d}})},this.mg_PageMessageActionPg=function(b){return a.call({actionName:"mg_PageMessageAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.getmessageDetail=function(b){return a.call({actionName:"mg_QueryMsgInfoAction.do",reqData:{workseq:b}})},this.deleteOneMessage=function(b,c){return a.call({actionName:"mg_DeleteRcMess.do",reqData:{workseq:b}})}}]),CommHttp.service("Task",["CallProvider","CV",function(a,b){this.getUnhandleTaskList=function(b,c){return a.call({actionName:"wk_PageUnhandleWorkAction.do",reqData:{start_recd:b,limit_recd:c}})},this.wk_PageMineHistoryWorkAction=function(b){return a.call({actionName:"wk_PageMineHistoryWorkAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.wk_PageMineHistoryUncheckAction=function(b){return a.call({actionName:"wk_PageMineHistoryUncheckAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.wk_PageMineHistoryUnauthAction=function(b){return a.call({actionName:"wk_PageMineHistoryUnauthAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"desc"==b.data.order?"1":"2"}})},this.getUnhandleTaskCount=function(){return a.call({actionName:"wk_ViewWorkActionqueryExecutoryWorkByUserId.do",reqData:{}})},this.getTaskDetail=function(b){return a.call({actionName:"wk_QueryWorkDetailAction.do",reqData:{wrk_seq:b}})},this.wk_QueryMineWorkListAction=function(){return a.call({actionName:"wk_QueryMineWorkListAction.do",reqData:{}})},this.wk_QueryMineUncheckWorkAction=function(){return a.call({actionName:"wk_QueryMineUncheckWorkAction.do",reqData:{}})},this.wk_QueryMineUnauthWorkAction=function(){return a.call({actionName:"wk_QueryMineUnauthWorkAction.do",reqData:{}})},this.wk_QueryTroubleTicketWorkAction=function(c){return a.call({actionName:"pg_PagePgAuthWorkAction.do",reqData:{org_rs_code:b.rscode(""),start_recd:c.data.offset,limit_recd:c.data.limit,status_list:c.status_list}})},this.LocalAuthTask=function(b){return a.call({actionName:"wk_CheckLocalAuthAction.do",reqData:b})},this.CheckPendTask=function(b){return a.call({actionName:"wk_CheckPendWorkAction.do",reqData:b})},this.AuthPendTask=function(b){return a.call({actionName:"wk_AuthPendWorkAction.do",reqData:b})},this.ExecuteTask=function(b,c){return a.call({actionName:c+".do",reqData:b,timeout:1800})},this.CloseTask=function(b){return a.call({actionName:"wk_UpdateWkDealStateByKeyAction.do",reqData:b})},this.getProgramAuthDetail=function(b){return a.call({actionName:"pg_QueryPgWorkDetailAction.do",reqData:{pg_work_seq:b}})},this.authProgram=function(b){return a.call({actionName:"pg_AuthPgWorkAction.do",reqData:b})},this.viewTaskProgramDetail=function(b){return a.call({actionName:"pg_ViewPgActionqueryPgWorkDetail.do",reqData:{pg_work_seq:b}})},this.getAccessoryInfo=function(b){return a.call({actionName:"wk_ViewWorkActionqueryExtraInfo.do",reqData:{wrk_seq:b}})},this.getIndexTaskCount=function(){return a.call({actionName:"pj_CountProjectOrderTaskAction.do",reqData:{}})}}]),CommHttp.service("LogSrv",["$http","CallProvider","baseUrl","Modal","CV",function(a,b,c,d,e){this.lg_UpdateLogLabelAction=function(a,c){return b.call({actionName:"lg_UpdateLogLabelAction.do",reqData:{query_work_seq:a,log_label:c}})},this.getLogPageList=function(a){return b.call({actionName:"lg_PageLogByDateAndLabelAction.do",reqData:a})},this.downloadLog=function(a,c){return b.call({actionName:"lg_DownloadLogAction.do",reqData:{start_bk_date:a,end_bk_date:c}})}}]),CommHttp.service("BusiSys",["CallProvider","CV",function(a,b){this.getAllBusinessSys=function(c){return a.call({actionName:"bs_ViewBsActiongetListAllBs.do",reqData:{permission_flag:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getAllLogBysiness=function(){return a.call({actionName:"rz_ViewLogActionqueryLogSys.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})},this.pageBusiSysTbl=function(c){return a.call({actionName:"bs_PageBsSystemAction.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.getOneBusiSys=function(c){return a.call({actionName:"bs_ViewBsActiongetBsSystem.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c}})},this.saveOneBusiSys=function(c){return c.org_rs_code=b.rscode("new_busi_sys"),a.call({actionName:"bs_AddBsSystemAction.do",reqData:c})},this.updateOneBusiSys=function(c){return c.org_rs_code=b.rscode("busi_sys_list"),a.call({actionName:"bs_UpdateBsSystemAction.do",reqData:c})},this.deleteOneBusiSys=function(c){return a.call({actionName:"bs_DeleteBsSystemAction.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.projBusiSysTbl=function(c){return a.call({actionName:"pj_PageRelatedProjAction.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),start_recd:c.data.offset,limit_recd:c.data.limit,business_sys_name:c.business_sys_name,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.publishScheme=function(c,d){return a.call({actionName:"bs_PublishBsProgramAction.do",reqData:{prog_id:c,publish_state:d,org_rs_code:b.rscode("busi_sys_list")}})},this.deleteScheme=function(c){return a.call({actionName:"bs_DeleteBsProgramAction.do",reqData:{prog_id:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getSingleProgData=function(b){return a.call({actionName:"bs_ViewBsProgramActionqueryBsProgInfo.do",reqData:{prog_id:b}})},this.validateProgComplete=function(b){return a.call({actionName:"bs_CheckBsProgramAction.do",reqData:{prog_id:b}})},this.getSocListByIpAndBsys=function(c,d,e){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{business_sys_name:c,soc_ip:d,impl_type:e,org_rs_code:b.rscode("busi_sys_list")}})},this.ViewBsNodeConfigInfo=function(b,c){return a.call({actionName:"bs_ViewNodeActiongetNodeBySysNameAndNodeName.do",reqData:{node_name:c,business_sys_name:b}})},this.startCollectCmptDeploy=function(c,d,e,f){var g=f?"co_DeleteDeployModuleAction.do":"co_DeployModuleAction.do";return a.call({actionName:g,reqData:{business_sys_name:c,node_name:d,module_id:e,org_rs_code:b.rscode("busi_sys_list")},timeout:120})},this.cjGetAllDeployInfoBySysNameAndIp=function(c,d){return a.call({actionName:"co_ViewNodeModuleActiongetDeployMsgWithSysAndIp.do",reqData:{business_sys_name:c,soc_ip:d,org_rs_code:b.rscode("busi_sys_list")}})},this.getProgrammeList=function(c){return a.call({actionName:"bs_ViewPublishProgramAction.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getNodelist=function(c){return a.call({actionName:"bs_ViewNodeActiongetNodeMsg.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.viewSingleProgramInfo=function(b){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramInfo.do",reqData:{prog_id:b}})},this.getProgExportPath=function(b){return a.call({actionName:"bs_ExportProgramAction.do",reqData:{prog_id:b}})},this.addProgram=function(b,c){return a.call({actionName:"bs_AddProgramAction.do",reqData:{program:b,business_sys_name:c}})},this.updateProgram=function(b){return a.call({actionName:"bs_UpdateProgramAction.do",reqData:{program:b}})},this.getCombineParam=function(c,d){return a.call({actionName:"bs_ViewBsProgramActiongetCombineParam.do",reqData:{org_rs_code:b.rscode(""),program:c,business_sys_name:d}})},this.getAllProgramList=function(c,d,e){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramListInBsi.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c,publish_state:d,prog_type:e}})},this.getAllLogList=function(c,d){return a.call({actionName:"rz_GetLogListBySysName.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,inspect_flag:d}})},this.checkLogName=function(c,d){return a.call({actionName:"CheckLogNameValidAction.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d}})},this.judgeLogNameIsExist=function(c,d){return a.call({actionName:"rz_CheckLogNameValid.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name}})},this.judgePathIsExist=function(c,d,e){return a.call({actionName:"rz_CheckRemotePathExists.do",reqData:{org_rs_code:b.rscode(""),node_name:d,soc_name:c,log_file_path:e}})},this.saveLogBaseMessage=function(c,d){return a.call({actionName:"rz_SaveLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name,log_cn_name:c.log_cn_name,log_desc:c.log_desc,log_type:c.log_type,log_format_type:c.log_format_type,file_encoding:c.file_encoding,newline_type:c.newline_type,compress_mode:c.compress_mode,timestamp_exp:c.timestamp_exp,timestamp_format:c.timestamp_format,log_configs:c.log_configs,keywords:c.keywords,date_exp:c.date_exp,log_id:c.log_id}})},this.deleteLog=function(c,d,e){return a.call({actionName:"rz_DeleteLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.viewLogList=function(c,d,e,f){return a.call({actionName:"rz_GetLogFileList.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit,sys_name:d,log_name:e,log_id:f}})},this.viewLogReportViewList=function(c){return a.call({actionName:"rz_PageLogReport.do",reqData:{org_rs_code:b.rscode(""),offset:c.data.offset,size:c.data.limit}})},this.startTimePull=function(c,d,e){return a.call({actionName:"rz_StartTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.stopTimePlee=function(c,d,e){return a.call({actionName:"rz_StopTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.getLogUploadPath=function(c,d,e,f){return a.call({actionName:"rz_GetUploadPath.do",reqData:{org_rs_code:b.rscode(""),node_name:c,sys_name:d,file_date:e,log_id:f}})},this.saveLogUploadBase=function(c){return a.call({actionName:"rz_UploadLogFile.do",reqData:{org_rs_code:b.rscode(""),sys_name:c.sys_name,log_name:c.log_name,node_name:c.node_name,file_date:c.file_date,file_name:c.file_name,log_id:c.log_id,node_ip:c.node_ip}})},this.logUploadBaseDelete=function(c,d,e){return a.call({actionName:"rz_DeleteLogFileAction.do",reqData:{org_rs_code:b.rscode(""),id:c,local_file_name:d,local_dir:e}})},this.modifyAgent=function(c,d){return a.call({actionName:"bs_StartAndStopAgentAction.do",reqData:{org_rs_code:b.rscode(""),operate:c,ip:d.ip,node_name:d.node_name},timeout:600})},this.getAllAgentMsg=function(c){return a.call({actionName:"bs_GetAgentMonitorInfoAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getMessageBysocName=function(c){return a.call({actionName:"dt_QuerySocBySocNameAction.do",reqData:{org_rs_code:b.rscode(""),soc_name:c}})},this.getSocListBySocIpAndSys=function(c,d,e){return a.call({actionName:"bs_ViewDtSourceActiongetNodeSoc.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,impl_type:e,soc_ip:d}})},this.saveMonitorItemData=function(c,d,e){return a.call({actionName:"bs_ModifyBsNodeMonitorAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,monitor_item_list:e,soc_ip:d}})},this.viewMonitorItemData=function(c,d){return a.call({actionName:"bs_ViewNodeActionqueryNodeMonitor.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,soc_ip:d}})}}]),CommHttp.service("Sys",["CallProvider","CV",function(a,b){this.getSysInfo=function(c){return a.call({actionName:"bs_ViewBsActiongetBsSystem.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c}})},this.saveSysInfo=function(c){return c.org_rs_code=b.rscode("new_busi_sys"),a.call({actionName:"bs_AddBsSystemAction.do",reqData:c})},this.updateSysInfo=function(c){return c.org_rs_code=b.rscode("busi_sys_list"),a.call({actionName:"bs_UpdateBsSystemAction.do",reqData:c})},this.deleteSys=function(c){return a.call({actionName:"bs_DeleteBsSystemAction.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.pageSysTbl=function(c){return a.call({actionName:"bs_PageBsSystemAction.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.getNodelist=function(c){return a.call({actionName:"bs_ViewNodeActiongetNodeMsg.do",reqData:{business_sys_name:c,org_rs_code:b.rscode("busi_sys_list")}})},this.ViewSysNodeConfigInfo=function(b,c){return a.call({actionName:"bs_ViewNodeActiongetNodeBySysNameAndNodeName.do",reqData:{node_name:c,business_sys_name:b}})},this.viewMonitorItemData=function(c,d){return a.call({actionName:"bs_ViewNodeActionqueryNodeMonitor.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,soc_ip:d}})},this.saveMonitorItemData=function(c,d,e){return a.call({actionName:"bs_ModifyBsNodeMonitorAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,monitor_item_list:e,soc_ip:d}})},this.ViewBsNodeConfigInfo=function(b,c){return a.call({actionName:"bs_ViewNodeActiongetNodeBySysNameAndNodeName.do",reqData:{node_name:c,business_sys_name:b}})},this.getProgExportPath=function(b){return a.call({actionName:"bs_ExportProgramAction.do",reqData:{prog_id:b}})},this.viewSingleProgramInfo=function(b){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramInfo.do",reqData:{prog_id:b}})},this.getAllProgramList=function(c,d,e){return a.call({actionName:"bs_ViewBsProgramActionqueryProgramListInBsi.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c,publish_state:d,prog_type:e}})},this.getCombineParam=function(c,d){return a.call({actionName:"bs_ViewBsProgramActiongetCombineParam.do",reqData:{org_rs_code:b.rscode(""),program:c,business_sys_name:d}})},this.updateProgram=function(b){return a.call({actionName:"bs_UpdateProgramAction.do",reqData:{program:b}})},this.addProgram=function(b,c){return a.call({actionName:"bs_AddProgramAction.do",reqData:{program:b,business_sys_name:c}})},this.deleteProgram=function(c){return a.call({actionName:"bs_DeleteBsProgramAction.do",reqData:{prog_id:c,org_rs_code:b.rscode("busi_sys_list")}})},this.getAllLogList=function(c,d){return a.call({actionName:"rz_GetLogListBySysName.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,inspect_flag:d}})},this.startTimePull=function(c,d,e){return a.call({actionName:"rz_StartTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.stopTimePull=function(c,d,e){return a.call({actionName:"rz_StopTimingPull.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.deleteLog=function(c,d,e){return a.call({actionName:"rz_DeleteLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,log_name:d,log_id:e}})},this.judgePathIsExist=function(c,d,e){return a.call({actionName:"rz_CheckRemotePathExists.do",reqData:{org_rs_code:b.rscode(""),node_name:d,soc_name:c,log_file_path:e}})},this.judgeLogNameIsExist=function(c,d){return a.call({actionName:"rz_CheckLogNameValid.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name}})},this.saveLogBaseMessage=function(c,d){return a.call({actionName:"rz_SaveLog.do",reqData:{org_rs_code:b.rscode(""),sys_name:d,log_name:c.log_name,log_cn_name:c.log_cn_name,log_desc:c.log_desc,log_type:c.log_type,log_format_type:c.log_format_type,file_encoding:c.file_encoding,newline_type:c.newline_type,compress_mode:c.compress_mode,timestamp_exp:c.timestamp_exp,timestamp_format:c.timestamp_format,log_configs:c.log_configs,keywords:c.keywords,date_exp:c.date_exp,log_id:c.log_id}})},this.getSocListByIpAndBsys=function(c,d,e){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{business_sys_name:c,soc_ip:d,impl_type:e,org_rs_code:b.rscode("busi_sys_list")}})},this.getAllAgentMsg=function(c){return a.call({actionName:"bs_GetAgentMonitorInfoAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.modifyAgent=function(c,d){return a.call({actionName:"bs_StartAndStopAgentAction.do",reqData:{org_rs_code:b.rscode(""),operate:c,ip:d.ip,node_name:d.node_name},timeout:600})},this.getLogicNodeAndPacParam=function(c){return a.call({actionName:"bs_ViewBsProgramActionqueryLogicNodeInfo.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getRemoteDirectory=function(c,d,e){return a.call({actionName:"bs_ShowRemoteDirectoryAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,logic_node_id:d,root_bk_dir:e}})}}]),CommHttp.service("NodeReform",["CallProvider","CV",function(a,b){this.queryProtocolAndSocNameByIp=function(c,d){return a.call({actionName:"dt_ViewDtActionqueryProtocolAndSocNameByIP.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),soc_ip:c,node_name:d}})},this.addBsNode=function(b){return a.call({actionName:"bs_AddBsNodeAction.do",reqData:b})},this.getNodeByBusi=function(c){return a.call({actionName:"bs_ViewBsActiongetNodeMsg.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c}})},this.getIpByNone=function(){return a.call({actionName:"dt_ViewDtActionqueryAllIp.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})},this.getIpWithProtocolAndSoc=function(b,c){return a.call({actionName:"bs_ViewDtSourceActionqueryNodeList.do",reqData:{business_sys_name:b,impl_type:c}})},this.updateBsNode=function(b){return a.call({actionName:"bs_UpdateBsNodeAction.do",reqData:b})},this.getNodeForUpdat=function(c){return a.call({actionName:"bs_ViewBsActiongetNodeForUpdate.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),node_name:c}})},this.addNode=function(c,d){return a.call({actionName:"bs_AddBsNodeIpAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,node_soc_ip:d}})},this.deleteNode=function(c,d){return a.call({actionName:"bs_DeleteBsNodeIpAction.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,node_soc_ip:d}})},this.configNodeType=function(c,d){return a.call({actionName:"bs_UpdateNodeTypeAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c,node_type:d}})},this.setDataSourceConfigInfo=function(c){return a.call({actionName:"bs_ModifyBsNodeSocAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c.node_name,soc_list:c.soc_list,ftp_config_soc:c.ftp_config_soc,shell_config_soc:c.shell_config_soc,exist_agent_yn_falg:c.exist_agent_yn_falg,agent_config_yn_falg:c.agent_config_yn_falg}})},this.getNodeBasicInfo=function(c){return a.call({actionName:"bs_ViewBsActiongetNodeBaseConfigMsg.do",reqData:{org_rs_code:b.rscode(""),node_name:c},timeout:300})},this.saveNodeBasicInfo=function(c,d){return a.call({actionName:"bs_AddBsNodeConfigAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c.node_name,business_sys_name:d,node_basic_msg:c.node_basic_msg}})},this.getAllRunEnvname=function(c){return a.call({actionName:"bs_ViewBsNodeActiongetAllRunEnvName.do",reqData:{org_rs_code:b.rscode("")}})},this.getLibraryListByRunEnv=function(c,d){return a.call({actionName:"bs_ViewRunEnvActionquerryLibByEnvAndType.do",reqData:{org_rs_code:b.rscode(""),library_type:c,env_type:d}})},this.getRouteUrlByNodeAndLib=function(c,d){return a.call({actionName:"bs_ViewRunEnvActiongetDefaultInstallDirectory.do",reqData:{org_rs_code:b.rscode(""),library_bk_name:c,node_name:d}})},this.deleteRunEnv=function(c,d){return a.call({actionName:"bs_DeleteRunEnvAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c,library_bk_name:d}})},this.deployOrDeletePlugin=function(b,c){var d=1==c?"bs_PluginUninstallAction.do":"bs_PluginInstallAction.do";return a.call({actionName:d,reqData:b,timeout:1800})},this.deployAgent=function(c,d){return a.call({actionName:"bs_DeployAgentAction.do",reqData:{org_rs_code:b.rscode(""),soc_name:c,node_name:d},timeout:300})}}]),CommHttp.service("DataSource",["CallProvider","CV",function(a,b){this.getVerDataSources=function(){return a.call({actionName:"dt_ViewDtActionqueryVersionSoc.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})},this.getAllDataSources=function(){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{org_rs_code:b.rscode("busi_sys_list")}})}}]),CommHttp.service("Plugin",["CallProvider","CV",function(a,b){this.addPlugin=function(b){return a.call({actionName:"bs_ModifyEnvPluginAction.do",reqData:b})},this.getLiblistByEnvname=function(b){return a.call({actionName:"bs_ViewRunEnvActiongetEnvLibDetail.do",reqData:{library_bk_name:b}})},this.getLibUploadPath=function(){return a.call({actionName:"bs_ViewRunEnvActiongetLibUploadTempDir.do",reqData:{}})},this.deleteRunEnv=function(b){return a.call({actionName:"bs_DeleteEnvLibraryAction.do",reqData:{library_bk_name:b}})},this.getPluginList=function(b){return a.call({actionName:"bs_ViewRunEnvActiongetAllEnvLib.do",reqData:{}})},this.getAllPluginList=function(b){return a.call({actionName:"pl_ViewPluginActionqueryPlugin.do",reqData:{impl_type:b}})},this.addNewPlugin=function(b){return a.call({actionName:"pl_AddPluginAction.do",reqData:b})},this.updateNewPlugin=function(b){return a.call({actionName:"pl_UpdatePluginAction.do",reqData:b})},this.viewPluginInfo=function(b){return a.call({actionName:"pl_ViewPluginActiongetPlugin.do",reqData:{plugin_name:b}})},this.deleteSinglePlugin=function(b){return a.call({actionName:"pl_DeletePluginAction.do",reqData:{plugin_name:b},timeout:300})}}]),CommHttp.service("CommonResources",["CallProvider","CV",function(a,b){this.getAllResourcesList=function(){return a.call({actionName:"cm_ViewResourcesActionQueryResources.do",reqData:{}})},this.addResources=function(b){return a.call({actionName:"cm_AddResourcesAction.do",reqData:b})},this.updateResources=function(b){return a.call({actionName:"cm_UpdateResourcesAction.do",reqData:b})},this.viewResources=function(b){return a.call({actionName:"cm_ViewResourcesActionGetResources.do",reqData:{resources_name:b}})},this.deleteResources=function(b){return a.call({actionName:"cm_DeleteResourcesAction.do",reqData:{resources_name:b}})}}]),CommHttp.service("envManage",["CallProvider","CV",function(a,b){this.addEnv=function(b){return a.call({actionName:"en_AddLanguageEnvAction.do",reqData:b})},this.updateEnv=function(b){return a.call({actionName:"en_UpdateLanguageEnvAction.do",reqData:b})},this.deleteEnv=function(b){return a.call({actionName:"en_DeleteLanguageEnvAction.do",reqData:b})},this.getUploadPath=function(){return a.call({actionName:"cm_ViewCommonActiongetTempUploadDir.do",reqData:{}})},this.queryEnvList=function(b,c){return a.call({actionName:"en_ViewLanguageEnvActionqueryLanguageEnv.do",reqData:{language_name:b,language_version:c}})},this.selectLanguageVersionByName=function(b){return a.call({actionName:"en_ViewLanguageEnvActionqueryVersionByLanguage.do",reqData:{language_name:b}})},this.getPluginListInNode=function(b,c){return a.call({actionName:"bs_ViewNodeActionqueryNodePlugin.do",reqData:{server_id:b,soc_ip:c}})},this.exeDeployPlugin=function(b){return a.call({actionName:"bs_DeployPluginAction.do",reqData:b,timeout:1800})}}]),CommHttp.service("Cmpt",["CallProvider","CV",function(a,b){this.addModule=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"mo_AddComponentAction.do",reqData:{component:c}})},this.updateModule=function(c){return a.call({actionName:"mo_UpdateComponentAction.do",reqData:{org_rs_code:b.rscode(""),component:c}})},this.importModule=function(c){return a.call({actionName:"mo_ViewComponentActiongetImportComponentDetail.do",reqData:{org_rs_code:b.rscode(""),file_path:c}})},this.deleteModule=function(c){return a.call({actionName:"mo_DeleteComponentAction.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getCmptList=function(c){return a.call({actionName:"mo_ViewComponentActionqueryComponentList.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2"}})},this.getCmptPageList=function(c){return a.call({actionName:"mo_PageComponentAction.do",reqData:{org_rs_code:b.rscode(""),order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2",cn_name:c.cn_name,tag_list:c.tag_list,impl_types:c.impl_types,start_modify_date:c.start_modify_date,end_modify_date:c.end_modify_date,crt_user_id:c.crt_user_id,publish_state:c.publish_state,component_purpose:c.component_purpose,start_recd:c.data.offset,limit_recd:c.data.limit}})},this.viewModulegetModuleDetail=function(c){return a.call({actionName:"mo_ViewComponentActiongetComponentDetail.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getCmptFilePath=function(c){return a.call({actionName:"mo_ViewComponentActiongetUploadDirectory.do",reqData:{org_rs_code:b.rscode(""),type:c}})},this.publishCmpt=function(c,d){return a.call({actionName:"mo_PublishCompAction.do",reqData:{org_rs_code:b.rscode(""),id:c,type:d}})},this.uploadScriptFile=function(c){return a.call({actionName:"mo_ViewComponentActiongetFileContent.do",reqData:{org_rs_code:b.rscode(""),file_path:c}})},this.addCmptGroup=function(c){return a.call({actionName:"mo_AddComponentGroupAction.do",reqData:{org_rs_code:b.rscode(""),group:c}})},this.updateSingleCmptGroup=function(c){return a.call({actionName:"mo_UpdateComponentGroupAction.do",reqData:{org_rs_code:b.rscode(""),group:c}})},this.viewSingleCmptGroup=function(c){return a.call({actionName:"mo_ViewComponentActiongetGroupDetail.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getPublishedCmpt=function(c,d){return a.call({actionName:"mo_ViewComponentActionqueryPublishedCompByType.do",reqData:{org_rs_code:b.rscode(""),type:c,component_purpose:d}})},this.getAllUser=function(){return a.call({actionName:"mo_ViewComponentActionqueryAllCrtUser.do",reqData:{org_rs_code:b.rscode("")}})},this.deleteSingleCmptGroup=function(c){return a.call({actionName:"mo_DeleteComponentGroupAction.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.getImportCmptGroupInfo=function(c){return a.call({actionName:"mo_ViewComponentActiongetImportGroupDetail.do",reqData:{org_rs_code:b.rscode(""),file_path:c}})},this.getCmptGroupList=function(c){return a.call({actionName:"mo_ViewComponentActionqueryGroupList.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2"}})},this.getCmptGroupDetail=function(c,d){return a.call({actionName:"mo_ViewComponentActiongetComponentListDetail.do",reqData:{org_rs_code:b.rscode(""),id_list:c,phase_flag:d}})},this.getCmptGroupsDetail=function(c){return a.call({actionName:"mo_ViewComponentActiongetGroupListDetail.do",reqData:{org_rs_code:b.rscode(""),id_list:c}})},this.getCombineParam=function(c,d){return a.call({actionName:"mo_ViewModuleActiongetCombineParam.do",reqData:{org_rs_code:b.rscode(""),groups:c,params:d}})},this.checkCmptGroupReference=function(c,d){return a.call({actionName:"mo_ViewModuleActioncheckModuleReference.do",reqData:{org_rs_code:b.rscode(""),id:c,type:d}})},this.savePublishProgram=function(c){return a.call({actionName:"bs_SavePublishProgramAction.do",reqData:{org_rs_code:b.rscode(""),prog_source:c.prog_source,business_sys_name:c.business_sys_name,prog_cn_name:c.prog_cn_name,prog_bk_desc:c.prog_bk_desc,pub_info:c.pub_info,rol_info:c.rol_info,package_types:c.package_types,prog_id:c.prog_id}})},this.getAllSocList=function(c,d){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{org_rs_code:b.rscode(""),soc_ip:c,impl_type:d}})},this.getPacakageDir=function(c){return a.call({actionName:"mo_ViewModuleActiongetTestPacakageDirectory.do",reqData:{org_rs_code:b.rscode(""),comp_type:c}})},this.getCmptTestInfo=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"mo_ComponentTestAction.do",reqData:{org_rs_code:b.rscode(""),phase:c.phase,params:c.param_list,id:c.id,deploy_soc:c.deploy_soc},timeout:3600})},this.monitorSubgroupTest=function(c){return a.call({actionName:"mo_ViewMonitorModuleActionmoitorModuleTestMsg.do",reqData:{org_rs_code:b.rscode(""),id:c}})},this.importProgram=function(c){return a.call({actionName:"bs_ImportProgramAction.do",reqData:{org_rs_code:b.rscode(""),file_name:c}})},this.selectAllTas=function(){return a.call({actionName:"mo_ViewComponentActionqueryAllCompnentTags.do",reqData:{org_rs_code:b.rscode("")}})},this.grammarBytype=function(c){return a.call({actionName:"mo_ViewComponentActionqueryGrammarHint.do",reqData:{org_rs_code:b.rscode(""),impl_type:c}})}}]),CommHttp.service("Server",["CallProvider","CV",function(a,b){this.addServer=function(b){return a.call({actionName:"se_AddServerAction.do",reqData:{server_bean:{server_ip:b}}})},this.getDataSource=function(b){return a.call({actionName:"se_ViewServerActionquerySocListByIP.do",reqData:{server_ip:b}})},this.getServerBasicInfo=function(b){return a.call({actionName:"se_ViewServerActiongetServerConfigMsg.do",reqData:{server_ip:b},timeout:600})},this.saveServerInfo=function(b,c){return a.call({actionName:"se_UpdateServerAction.do",reqData:{server_bean:{server_id:b.server_id,server_ip:b.server_ip,server_desc:b.server_desc,agent_status:c},machine_basic_bean:b.machine_basic_bean}})},this.viewServerInfo=function(b){return a.call({actionName:"se_ViewServerActiongetServerDetail.do",reqData:{server_ip:b},timeout:600})},this.pageServerList=function(b){return a.call({actionName:"se_PageServerAction.do",reqData:{server_ip:b.server_ip,server_desc:b.server_desc,order_col_name:b.data.sort,order_type:"asc"===b.data.order?"1":"2",start_recd:b.data.offset,limit_recd:b.data.limit}})},this.deleteServer=function(b){return a.call({actionName:"se_DeleteServerAction.do",reqData:{server_ip:b}})},this.getUserList=function(b){return a.call({actionName:"se_ViewServerActionquerySocUserList.do",reqData:{server_ip:b}})},this.deployAgentBySoc=function(b,c){return a.call({actionName:"se_DeployAgentAction.do",reqData:{server_ip:b,server_user:c},timeout:3600})},this.uninstallAgentByIp=function(b){return a.call({actionName:"se_UnInstallAgentAction.do",reqData:{server_ip:b}})},this.getAllIpList=function(){return a.call({actionName:"mo_ViewModuleActiongetExeSocIpList.do",reqData:{}})},this.getDataSopcByImplType=function(b,c){return a.call({actionName:"mo_ViewModuleActiongetExeSocWithModule.do",reqData:{impl_types:c,server_ip:b}})},this.getPluginListInNode=function(b,c){return a.call({actionName:"pl_ViewPluginActionqueryDeployedPlugin.do",reqData:{server_id:b,server_ip:c}})},this.exeDeployPlugin=function(b){return a.call({actionName:"pl_DeployPluginAction.do",reqData:b,timeout:1800})},this.testFileTransform=function(b,c){return a.call({actionName:"se_ViewAgentActioncheckFileTransfer.do",reqData:{server_ip:b,server_user:c},timeout:3600})},this.testRunEnv=function(b){return a.call({actionName:"se_ViewAgentActioncheckAgentRunEnv.do",reqData:{soc_list:b},timeout:3600})},this.deployRunEnv=function(b,c,d,e){return a.call({actionName:"se_ViewAgentActiondeployAgentRunEnv.do",reqData:{soc_list:b,sys_type:c,sys_bit:d,agent_run_env_flag:e},timeout:3600})},this.deployAgent=function(b){return a.call({actionName:"se_ViewAgentActiondeployAgent.do",reqData:{soc_list:b
},timeout:3600})},this.startAgent=function(b,c,d){return a.call({actionName:"se_ViewAgentActionstartAgent.do",reqData:{soc_list:b,deploy_path:c,agent_run_env_flag:d},timeout:3600})},this.testAgentPort=function(b){return a.call({actionName:"se_ViewAgentActioncheckAgentExist.do",reqData:{soc_list:b},timeout:3600})},this.getAllNodeList=function(b){return a.call({actionName:"bj_QueryAllServerMachineBasicMsgAction.do",reqData:{key_word:b}})},this.monitorNodeStatus=function(b){return a.call({actionName:"bj_MonitorServerMachineAction.do",reqData:{server_ip:b}})}}]),CommHttp.service("Struct",["CallProvider","CV",function(a,b){this.saveStructMsg=function(b){return a.call({actionName:"bs_AddStructureAction.do",reqData:{struct_bean:b}})},this.getStructMsg=function(b){return a.call({actionName:"bs_ViewBsActionngetStructureBySys.do",reqData:{sys_id:b}})},this.checkStructModify=function(b,c){return a.call({actionName:"bs_ViewStructActioncheckStructModify.do",reqData:{sys_id:b,struct_bean:c}})},this.getStructParamsByType=function(b,c){return a.call({actionName:"bs_ViewStructActionqueryNodeFixedParamList.do",reqData:{logical_node_type:b,sys_id:c}})}}]),CommHttp.service("EnvConfig",["CallProvider","CV",function(a,b){this.getEnvList=function(c){return a.call({actionName:"bs_ViewBsActionqueryEnvironmentListBySys.do",reqData:{org_rs_code:b.rscode(""),sys_id:c}})},this.publishEnv=function(c,d,e){return a.call({actionName:"bs_PublishEnvironmentAction.do",reqData:{org_rs_code:b.rscode(""),sys_id:c,env_id:d,pub_flag:e}})},this.deleteEnv=function(c,d){return a.call({actionName:"bs_DeleteEnvironmentAction.do",reqData:{org_rs_code:b.rscode(""),sys_id:c,env_id:d}})},this.addEnvMsg=function(c,d){return a.call({actionName:"bs_AddEnvironmentAction.do",reqData:{org_rs_code:b.rscode(""),env_bean:c,struct_node_list:d.nodeDataArray}})},this.getEnvMsg=function(c,d){return a.call({actionName:"bs_ViewBsActiongetEnvironmentCfg.do",reqData:{org_rs_code:b.rscode(""),env_id:c,sys_id:d}})},this.getLogicalParamListByEnvId=function(c,d){return a.call({actionName:"bs_ViewBsActionqueryOtherParamList.do",reqData:{org_rs_code:b.rscode(""),sys_id:d,logical_node_id:c}})},this.getAgentUserName=function(c){return a.call({actionName:"bs_ViewBsActionqueryAgentUsersByIP.do",reqData:{org_rs_code:b.rscode(""),server_ip:c}})},this.getFileAndExecSocList=function(c,d){return a.call({actionName:"bs_ViewBsActionqueryFileAndExecDtSocList.do",reqData:{org_rs_code:b.rscode(""),server_ip:c,logical_node_type:d}})},this.getAllServerIp=function(){return a.call({actionName:"se_ViewServerActionqueryServerList.do",reqData:{org_rs_code:b.rscode("")}})}}]);var DispatchSrv=angular.module("DispatchHttpSrv",[]);DispatchSrv.service("Dispatch",["CallProvider","CV",function(a,b){this.getAllLogSys=function(){return a.call({actionName:"lg_FindSysOperationLogAction.do",reqData:{org_rs_code:b.rscode("")}})},this.pickLog=function(b){return a.call({actionName:"op_GetContentAction.do",reqData:b})},this.logMonitor=function(b){return a.call({actionName:"op_LogAutoMonitorAction.do",reqData:b,timeout:60})},this.getLogMonitorContent=function(b){return a.call({actionName:"op_ReadLogContentAction.do",reqData:b})}}]),DispatchSrv.service("Flow",["CallProvider","CV",function(a,b){this.saveFlowBasicData=function(c,d){return a.call({actionName:d?"fw_UpdateFlowBasicAction.do":"fw_EditSdFlowBasicAction.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c.sdflow_id,sdversion_id:c.sdversion_id,sdflow_cn_name:c.sdflow_cn_name,sdflow_bk_desc:c.sdflow_bk_desc,sdflow_types:c.sdflow_types,sddispatch_type:c.sddispatch_type,sdparallel_task:c.sdparallel_task,sdarrang_method:c.sdarrange_method,sd_strategy_id:c.sd_strategy_id,sd_priority:c.sd_priority,scene_main_id:c.scene_main_id}})},this.editFLowExeUser=function(c){return a.call({actionName:"fw_UpdateExeUserAction.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c.sdflow_id,sdversion_id:c.sdversion_id,exe_user_ids:c.exe_user_list}})},this.caculatorExeTime=function(c){return a.call({actionName:"fw_CaculatorExeTimeBatchAction.do",reqData:{org_rs_code:b.rscode(""),start_bk_datetime:c.start_bk_datetime,end_bk_datetime:c.end_bk_datetime,cycle_info:c.cycle_info}})},this.getCurrentTaskList=function(c){return a.call({actionName:"tk_QuerySdCurTaskAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,sdtask_cn_name:c.sdtask_cn_name,sdtask_types:c.sdflow_type,sddispatch_type:c.sddispatch_type,exe_user_id:c.exe_user_id,start_bk_datetime:c.start_bk_datetime,end_bk_datetime:c.end_bk_datetime}})},this.pageHistoryTaskList=function(c){return a.call({actionName:"tk_PageSdHistoryTaskAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit,sdtask_cn_name:c.sdtask_cn_name,sdtask_types:c.sdflow_type,sddispatch_type:c.sddispatch_type,exe_user_id:c.exe_user_id,start_bk_datetime:c.start_bk_datetime,end_bk_datetime:c.end_bk_datetime}})},this.meddleTaskExecute=function(c,d){return a.call({actionName:"tk_MeddleSdTaskAction.do",reqData:{org_rs_code:b.rscode(""),task_id:c,meddle_type:d}})},this.meddleJobExecute=function(c,d,e,f){return a.call({actionName:"tk_MeddleSdJobAction.do",reqData:{org_rs_code:b.rscode(""),task_id:c,job_id_list:e,meddle_type:d,meddle_reason:f}})},this.saveTaskInputParam=function(c,d,e){return a.call({actionName:"jb_SaveStartNodeAction.do",reqData:{org_rs_code:b.rscode(""),task_id:c,job_id:d,param_list:e}})},this.skipOneStepJob=function(c,d){return a.call({actionName:"jb_SkipJobAction.do",reqData:{org_rs_code:b.rscode(""),dptask_id:c,step_list:d}})},this.getJobOutput=function(c,d,e,f){return a.call({actionName:"jb_QuerySkipJobAction.do",reqData:{org_rs_code:b.rscode(""),flow_id:d,version_id:e,dptask_id:c,step_list:f}})},this.viewTaskDetail=function(c){return a.call({actionName:"tk_ViewSdTaskDetailAction.do",reqData:{org_rs_code:b.rscode(""),sdtask_id:c}})},this.viewSingleJobInfo=function(c,d){return a.call({actionName:"tk_ViewSingleJobDetailAction.do",reqData:{org_rs_code:b.rscode(""),sdtask_id:c,job_id:d}})},this.monitorJobStatus=function(c,d){return a.call({actionName:"tk_ViewTaskAllStatusAction.do",reqData:{org_rs_code:b.rscode(""),sdtask_id:c,job_list:d}})},this.viewSingleJobOpInfo=function(c,d){return a.call({actionName:"tk_ViewSingleJobOperateAction.do",reqData:{org_rs_code:b.rscode(""),sdtask_id:c,job_id:d}})},this.pageOpFlowList=function(c){return a.call({actionName:"fw_PageSdFlowAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2",sddispatch_type:c.exe_types}})},this.pageAttentionFlowList=function(c){return a.call({actionName:"fw_PageSdFocusFlowAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.attentionFlow=function(c,d,e){return a.call({actionName:"fw_AddSdFocusFlowAction.do",reqData:{org_rs_code:b.rscode(""),focus_flag:d,sdflow_id:c,sdversion_id:e}})},this.handleUpOrDownflow=function(c,d,e){return a.call({actionName:"fw_HangUpOrEnableSdFlowAction.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c,sdversion_id:e,hang_up:d}})},this.getIpList=function(c){return a.call({actionName:"dt_ViewDtActionqueryAllIp.do",reqData:{org_rs_code:b.rscode("")}})},this.saveFlowExtendData=function(c){return a.call({actionName:"fw_EditSdFlowExtendAction.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c.sdflow_id,sdversion_id:c.sdversion_id,start_bk_datetime:c.start_bk_datetime_val,end_bk_datetime:c.end_bk_datetime_val,cycle_info:c.cycle_info,sd_node_list:c.nodeDataArray,link_list:c.linkDataArray,exe_user_ids:c.exe_user_list}})},this.viewFlowBasicInfo=function(c,d){return a.call({actionName:"fw_SdFlowDetailViewActiongetSdFlowBasicInfo.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c,sdversion_id:d}})},this.viewFlowDetailData=function(c,d){return a.call({actionName:"fw_SdFlowDetailViewActiongetFlowDetail.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c,sdversion_id:d}})},this.getOptaskId=function(c,d){return a.call({actionName:"fw_ExeSdFlowAction.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c,sdversion_id:d}})},this.publishFlow=function(c,d,e){return a.call({actionName:"fw_PublishSdFlowAction.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c,sdversion_id:d,publish_reason:e}})},this.deleteOpFlow=function(c,d){return a.call({actionName:"fw_DeleteSdFlowAction.do",reqData:{org_rs_code:b.rscode(""),sdflow_id:c,sdversion_id:d}})},this.getTaskListByDate=function(c,d){return a.call({actionName:"tk_ViewSdTaskAction.do",reqData:{org_rs_code:b.rscode(""),is_attention:c,run_date:d}})},this.getAllNodesInfo=function(){return a.call({actionName:"tk_ViewAllNodeAction.do",reqData:{org_rs_code:b.rscode("")}})},this.getTaskListByDateAndNode=function(c,d){return a.call({actionName:"tk_ViewTaskInfoByDateAction.do",reqData:{org_rs_code:b.rscode(""),node_ip:c,run_date:d}})},this.getReportInfoByDate=function(c){return a.call({actionName:"tk_ViewFlowAndTaskNumDetail.do",reqData:{org_rs_code:b.rscode(""),start_time:c.begin_date_fmt,end_time:c.end_date_fmt}})}}]),DispatchSrv.service("Scene",["CallProvider","CV",function(a,b){this.addScene=function(b,c){return a.call({actionName:c?"se_EditSeSceneAction.do":"se_AddSeSceneAction.do",reqData:{scene_info:b}})},this.getSceneListByType=function(b){return a.call({actionName:"se_PageSeSceneAction.do",reqData:{key_word:b.key_word,start_recd:b.data.offset,limit_recd:b.data.limit}})},this.removeSingleScene=function(b){return a.call({actionName:"se_DeleteSeSceneAction.do",reqData:{scene_id:b}})},this.getSingleSceneDetail=function(b,c){return a.call({actionName:"se_ViewSeSceneAction.do",reqData:{scene_id:b,private_flag:c?c:!1}})},this.getMultipleSceneElementDetail=function(b){return a.call({actionName:"se_ViewSceneElementAction.do",reqData:{scene_id_list:b}})},this.addPrivateScene=function(b){return a.call({actionName:"se_AddPrivateSceneAction.do",reqData:b})}}]),DispatchSrv.service("Strategy",["CallProvider","CV",function(a,b){this.addStrategyGroup=function(b){return a.call({actionName:"sg_AddStrategyGroupAction.do",reqData:b})},this.getStrategyGroupList=function(){return a.call({actionName:"sg_PageStrategyGroupAction.do",reqData:{}})},this.removeStrategyGroup=function(b){return a.call({actionName:"sg_DeleteStrategyGroupAction.do",reqData:{sdstrategy_id:b}})},this.viewSingleStrategyGroup=function(b){return a.call({actionName:"sg_ViewStrategyAction.do",reqData:{sdstrategy_id:b}})},this.getFlowListByStrategyId=function(b){return a.call({actionName:"sg_PageFlowInStrategyGroupAction.do",reqData:{start_recd:b.offset,limit_recd:b.limit,sdstrategy_id:b.sdstrategy_id}})}}]),DispatchSrv.service("DispatchTaskMonitor",["CallProvider","CommData","$location","$cookieStore","CV",function(a,b,c,d,e){var f=c.absUrl().substring(c.absUrl().indexOf("?")+1),g=d.get(f+"_data"),h=g?g.cp:b,i={org_user_id:h.org_user_id,org_dept_id:h.org_dept_id,orguser_cn_name:h.orguser_cn_name,orgdept_cn_name:h.orgdept_cn_name,org_term_no:h.org_term_no};this.getTaskStatisticsInfo=function(){return a.call({actionName:"tk_MonitorStatisticsAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode("")})})},this.getTaskBasicInfoByOptype=function(b){return a.call({actionName:"tk_QueryAllTaskAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),sdmonitor_type:b})})},this.runingInfo=function(b){return a.call({actionName:"ct_MonitorRunningMsgAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),query_type:b})})},this.meddleTask=function(b,c){return a.call({actionName:"tk_MeddleSdTaskAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),task_id:b,meddle_type:c})})},this.meddleJob=function(b,c,d){return a.call({actionName:"tk_MeddleSdJobAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),task_id:b,meddle_type:c,job_id_list:d})})},this.gatAllNodeBasicInfo=function(b){return a.call({actionName:"tk_QueryAllNodeMsgAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),key_word:b})})},this.monitorAllNodeUsedInfo=function(b){return a.call({actionName:"tk_MonitorAllNodeHardAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),key_word:b})})},this.monitorOneNodeSysInfo=function(b){return a.call({actionName:"tk_MonitorSingleNodeSysInfoAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),node_ip:b})})},this.monitorOneNodeProgressInfo=function(b){return a.call({actionName:"tk_MonitorSingleNodeProcessAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),node_ip:b})})},this.searchByKeywords=function(b){return a.call({actionName:"tk_MonitorStatisticsAction.do",reqData:angular.extend(i,{org_rs_code:e.rscode(""),keywords:b})})}}]);var FaultHttp=angular.module("FaultHttpSrv",[]);FaultHttp.service("Workorder",["CallProvider","CV",function(a,b){this.getAppointDepartmentList=function(){return a.call({actionName:"dp_ViewDeptActionqueryDeptList.do",reqData:{org_rs_code:b.rscode("")}})},this.getAppointStaffList=function(c){return a.call({actionName:"us_ViewUsforAppActiongetUserListByDept.do",reqData:{org_rs_code:b.rscode(""),dept_id:c}})},this.getTroubleTypeList=function(){return a.call({actionName:"wo_ViewOrderActionqueryTroubleTypeList.do",reqData:{org_rs_code:b.rscode("")}})},this.saveWorkorderInfo=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_AddOrderAction.do",reqData:c})},this.getWorkorder=function(c){return a.call({actionName:"wo_ViewOrderActiongetOrderBasicMsg.do",reqData:{org_rs_code:b.rscode(""),order_seq:c}})},this.getWorkorderFlowList=function(c){return a.call({actionName:"wo_ViewOrderActiongetOrderFlowMsg.do",reqData:{org_rs_code:b.rscode(""),order_seq:c}})},this.updateWorkorder=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_UpdateOrderAction.do",reqData:c})},this.deleteWorkorder=function(c){return a.call({actionName:"wo_DeleteOrderAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c}})},this.appiontWorkorder=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_AssignOrderAction.do",reqData:c})},this.changeWorkorder=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_AlterOrderAction.do",reqData:c})},this.rollbackWorkorder=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_ReturnBackOrderAction.do",reqData:c})},this.getAllExcelWorkorder=function(c){return a.call({actionName:"wo_ViewOrderActionqueryListByOrderExcel.do",reqData:{org_rs_code:b.rscode(""),order_file_name:c}})},this.importExcelWorkorder=function(c){return a.call({actionName:"wo_ImportOrderByExcelAction.do",reqData:{org_rs_code:b.rscode(""),order_file_name:c}})},this.pageCreateWorkorder=function(c){return a.call({actionName:"wo_PageOrderCreateByMeAction.do",reqData:{org_rs_code:b.rscode(""),start_recd:c.data.offset,limit_recd:c.data.limit}})},this.pagePendingWorkorder=function(c){return a.call({actionName:"wo_PageProcessOrderAction.do",reqData:{org_rs_code:b.rscode(""),start_recd:c.data.offset,limit_recd:c.data.limit}})},this.pageProcessedWorkorder=function(c){return a.call({actionName:"wo_PageProcessedOrderAction.do",reqData:{org_rs_code:b.rscode(""),start_recd:c.data.offset,limit_recd:c.data.limit}})},this.pageAllWorkorder=function(c){return a.call({actionName:"wo_PageAllOrderAction.do",reqData:{org_rs_code:b.rscode(""),start_recd:c.data.offset,limit_recd:c.data.limit,key_word:c.moreParams.key_word,system_key_list:c.moreParams.system_key_list,order_type_list:c.moreParams.order_type_list,order_state_list:c.moreParams.order_state_list,crt_user_id:c.moreParams.crt_user_id,deal_user_id:c.moreParams.deal_user_id,crt_start_date:c.moreParams.crt_start_date,crt_end_date:c.moreParams.crt_end_date,deal_start_date:c.moreParams.deal_start_date,deal_end_date:c.moreParams.deal_end_date}})},this.getAllCreaterList=function(){return a.call({actionName:"wo_ViewOrderActionqueryCrtUserList.do",reqData:{org_rs_code:b.rscode("")}})},this.getAllHandlerList=function(){return a.call({actionName:"wo_ViewOrderActionqueryDealUserList.do",reqData:{org_rs_code:b.rscode("")}})},this.getHandlerType=function(c,d,e){return a.call({actionName:"wo_HandleOrderAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,handle_type:d,sqlexe_type:e}})},this.complateOrder=function(c){return a.call({actionName:"wo_ComplateOrderAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c}})},this.queryWoOrderNumber=function(){return a.call({actionName:"wo_ViewOrderActionqueryWoOrderNumber.do",reqData:{org_rs_code:b.rscode("")}})},this.getOrderUploadPath=function(){return a.call({actionName:"wo_ViewOrderActionqueryOrderUploadPath.do",reqData:{org_rs_code:b.rscode("")}})},this.checkPgLocalAuth=function(c){return a.call({actionName:"pg_CheckPgLocalAuthAction.do",reqData:{org_rs_code:b.rscode(""),auth_user_id:c.auth_user_id,user_passwd:c.user_passed,auth_key:c.auth_key,auth_dprl_code:c.auth_dprl_code}})},this.getPgWorkDetail=function(c){return a.call({actionName:"pg_QueryPgWorkDetailAction.do",reqData:{org_rs_code:b.rscode(""),pg_work_seq:c}})},this.closePgWorkAction=function(c,d){return a.call({actionName:"pg_ClosePgWorkAction.do",reqData:{org_rs_code:b.rscode(""),pg_work_seq:c,deal_bk_desc:d?d:""}})},this.wo_StopOrderAction=function(c,d,e){return a.call({actionName:"wo_StopOrderAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:d,deal_bk_seq:e,handle_type:c}})},this.getApprovalExecuteProgramStep=function(c){return a.call({actionName:"wk_ApprovalCompleteOrderAction.do",reqData:{org_rs_code:b.rscode(""),pend_work_seq:c}})}}]),FaultHttp.service("SqlExec",["CallProvider","CV",function(a,b){this.useSql=function(c,d,e){return a.call({actionName:"sl_SqlStartAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,sqlexe_type:e}})},this.addSql=function(c,d,e,f,g){return a.call({actionName:"sl_AddSqlAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,sys_name:e,soc_name:g,sql_txt:f}})},this.addSelectSql=function(c,d,e,f,g){return a.call({actionName:"sl_AddSelectSqlAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,sys_name:e,soc_name:g,sql_txt:f}})},this.deleteSql=function(c){return a.call({actionName:"sl_DeleteSingleSqlAction.do",reqData:{org_rs_code:b.rscode(""),sql_work_seq:c}})},this.submitedSqlList=function(c,d){return a.call({actionName:"sl_ViewSqlActionGetSqlList.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d}})},this.getSqlSchemeResult=function(c){return a.call({actionName:"sl_ViewSqlActionGetSqlMsg.do",reqData:{org_rs_code:b.rscode(""),sql_work_seq:c}})},this.execSelectSqlList=function(c,d,e){return a.call({actionName:"sl_ExecuteQuerySqlAction.do",reqData:{org_rs_code:b.rscode(""),query_sql_list:c,start_num:d,end_num:e},timeout:300})},this.execModifySqlList=function(c,d){return a.call({actionName:"sl_ExecuteModifySqlAction.do",reqData:{org_rs_code:b.rscode(""),modify_sql_list:c,execute_sql:d}})},this.generateSqlByTable=function(c){return a.call({actionName:"sl_SelectModifyGenerateSqlAction.do",reqData:{org_rs_code:b.rscode(""),sql_work_seq:c.sql_work_seq,theads:c.theads,modify_string:c.modify_string}})},this.clearSqlList=function(c){return a.call({actionName:"sl_DeleteGenerateSqlAction.do",reqData:{org_rs_code:b.rscode(""),sl_msg_list:c}})},this.mergRepeatSql=function(c){return a.call({actionName:"sl_DeleteSurplusSqlAction.do",reqData:{org_rs_code:b.rscode(""),modify_sql_list:c}})},this.getImportFileUploadPath=function(c){return a.call({actionName:"pg_ViewPgActiongetProgramUploadPath.do",reqData:{org_rs_code:b.rscode(""),order_seq:c}})},this.parseImportFile=function(c,d,e,f,g,h){return a.call({actionName:"sl_ExportBatchSqlAction.do",reqData:{org_rs_code:b.rscode(""),file_name:e,sys_name:f,soc_name:g,step_seq:h,order_seq:c,deal_bk_seq:d}})},this.batchExeSql=function(c,d,e,f,g,h,i){return a.call({actionName:"sl_BatchExecuteSqlAction.do",reqData:{org_rs_code:b.rscode(""),deal_bk_seq:d,order_seq:c,sys_name:e,soc_name:f,file_name:g,step_seq:h,tran_flag:i}})},this.submitedImportSqlList=function(c,d){return a.call({actionName:"sl_ViewSqlActionqueryBatchSql.do",reqData:{org_rs_code:b.rscode(""),deal_bk_seq:d,order_seq:c}})},this.resetImportSql=function(c,d,e){return a.call({actionName:"sl_ResetExecuteSqlAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,step_seq:e}})},this.exportQueryData=function(c,d,e){return a.call({actionName:"sl_ExportSelectDataAction.do",reqData:{org_rs_code:b.rscode(""),query_sql_list:c,sql_text:d,sensite_list:e},timeout:300})}}]),FaultHttp.service("ScriptExec",["CallProvider","CV",function(a,b){this.getScriptUploadPath=function(c,d){return a.call({actionName:"sc_ViewScriptActiongetUploadPath.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d}})},this.parseScriptFile=function(c){return a.call({actionName:"sc_UploadScriptFileAction.do",reqData:{org_rs_code:b.rscode(""),script_file_path:c}})},this.getSocByNodeIp=function(c,d){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{org_rs_code:b.rscode(""),soc_ip:c,impl_type:d}})},this.execute=function(b){return a.call({actionName:"sc_ExecuteScriptAction.do",reqData:b,timeout:600})},this.viewStepDetail=function(c,d,e){return a.call({actionName:"sc_ViewScriptActiongetDetail.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,script_bk_seq:e}})},this.viewAuthStepDetail=function(c,d){return a.call({actionName:"sc_ViewScriptActiongetScriptAuthorMsg.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d}})},this.viewHistoryList=function(c,d){return a.call({actionName:"sc_ViewScriptActiongetListByOrderSeq.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d}})},this.deleteFile=function(c){return a.call({actionName:"sc_DeleteUploadFileAction.do",reqData:{org_rs_code:b.rscode(""),script_file_path:c}})},this.stopScriptExec=function(c,d,e){return a.call({actionName:"sc_StopExecuteScriptAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,script_bk_seq:e}})}}]),FaultHttp.service("Program",["CallProvider","CV",function(a,b){this.pageProgramList=function(c){return a.call({actionName:"pg_PageProgramAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit}})},this.deleteFaultProgram=function(c,d){return a.call({actionName:"pg_DeleteProgramAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,confirm_flag:d?d:1},timeout:600})},this.getProgramInfoAndStepList=function(c){return a.call({actionName:"pg_ViewPgActiongetPgInfo.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.getProgramAllInfoAndStepList=function(c){return a.call({actionName:"pg_ViewPgActionqueryPgAllSteps.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.getSelectProgramAllInfo=function(c,d,e){return a.call({actionName:"pg_ViewPgActiongetPgSelStageMsg.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,order_seq:d,deal_bk_seq:e}})},this.previewProgram=function(c){return a.call({actionName:"pg_ViewPgActionpreviewProgram.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.saveFaultProgram=function(c,d){return a.call({actionName:"pg_AddProgramAction.do",reqData:{org_rs_code:b.rscode(""),program_name:c,program_bk_desc:d}})},this.editProgram=function(c,d,e){return a.call({actionName:"pg_UpdateProgramAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,program_name:d,program_bk_desc:e}})},this.saveProgram=function(c){return a.call({actionName:"pg_CheckProgramAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.checkProgram=function(c){return a.call({actionName:"pg_ViewPgActionresetProgramFlag.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.addProgramStep=function(c,d,e,f){return a.call({actionName:"pg_EditProgramStepAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,step_seq:d,step_bk_title:e,pg_source:f}})},this.slideProgramStep=function(c,d,e){return a.call({actionName:"pg_ViewPgActionstepSlide.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,start_step_seq:d,end_step_seq:e}})},this.deleteProgramStep=function(c,d){return a.call({actionName:"pg_DeleteProgramStepAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,step_seq:d}})},this.addProgramStepSql=function(c,d,e,f,g){return a.call({actionName:"pg_ViewPgActionparsesql.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,step_seq:d,sql_text:e,sys_name:f,soc_name:g}})},this.deleteProgramStepSql=function(c,d,e){return a.call({actionName:"pg_DeletePgSqlParamAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,step_seq:d,sql_seq:e}})},this.addProgramStepSqlParam=function(c,d,e,f){return a.call({actionName:"pg_EditPgSqlParamAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,step_seq:d,sql_seq:e,pg_sql_bean:f},timeout:120})},this.viewProgramStepSqlDetail=function(c,d,e){return a.call({actionName:"pg_ViewPgActiongetSqlParseDetail.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,step_seq:d,sql_seq:e},timeout:60})},this.getSqlParamAuthRoleByDept=function(c){return a.call({actionName:"us_ViewUsforAppActionqueryRoleByDept.do",reqData:{org_rs_code:b.rscode(""),dept_id:c}})},this.importUsableProgram=function(c){return a.call({actionName:"pg_ImportPgAction.do",reqData:{org_rs_code:b.rscode(""),file_name:c}})},this.getimportProgramUploadPath=function(){return a.call({actionName:"pg_ViewPgActiongetProgramUploadPath.do",reqData:{org_rs_code:b.rscode("")}})},this.exportUsableProgram=function(c){return a.call({actionName:"pg_ExportPgAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.importBatchProgramStep=function(c,d){return a.call({actionName:"pg_ImportBatchPgAction.do",reqData:{org_rs_code:b.rscode(""),file_name:c,pg_source:d}})},this.saveImportProgram=function(c,d,e,f,g,h){return a.call({actionName:"pg_AddBatchProgramAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,program_name:d,program_bk_desc:e,pg_stage_msg:f,tran_flag:g,pg_source:h}})},this.viewImportProgram=function(c){return a.call({actionName:"pg_ViewPgActiongetProgramDetail.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.exportBatchProgram=function(c){return a.call({actionName:"pg_ExportBatchPgAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:c}})},this.getSocByBusy=function(c,d){return a.call({actionName:"bs_ViewDtSourceActionquerySoc.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,protocol_type:d}})},this.selectSrv=function(b){return a.call({actionName:"bs_ViewBsActionqueryServerListByType.do",reqData:{protocol_type:b}})}}]),FaultHttp.service("ProgramExec",["CallProvider","CV",function(a,b){this.useProgram=function(c,d,e){return a.call({actionName:"pg_ExecuteProgramAction.do",reqData:{org_rs_code:b.rscode(""),program_seq:e,order_seq:c,deal_bk_seq:d}})},this.getStepByProgramStepId=function(c,d){return a.call({actionName:"pg_ViewPgActiongetPgStepDetail.do",reqData:{org_rs_code:b.rscode(""),program_seq:c,step_seq:d}})},this.execProgramStep=function(c,d,e){return a.call({actionName:"pg_ExecuteProgramStepAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c.order_seq,deal_bk_seq:c.deal_bk_seq,step_seq:c.step_seq,sql_list:c.sql_list,pgsubmit_type:c.pgsubmit_type,pg_work_seq:c.pg_work_seq,start_num:d,end_num:e}})},this.getExedProgramStep=function(c,d){return a.call({actionName:"pg_ViewPgActionqueryExecutedSteps.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d}})},this.resetAllExedStep=function(c,d,e){return a.call({actionName:"pg_ResetProgramAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,program_seq:e}})},this.reSelect=function(c,d){return a.call({actionName:"pg_ReselectProgramAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d}})},this.resetProgramStep=function(c,d,e){return a.call({actionName:"pg_ResetProgramStepAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d,step_seq:e}})},this.getImportPath=function(c,d){return a.call({actionName:"pg_ViewPgActiongetPgExcelFilePath.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,program_seq:d}})},this.getExecdMsg=function(c,d,e){return a.call({actionName:"pg_ViewPgActiongetBatchPgExcuteMsg.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,program_seq:d,deal_bk_seq:e}})},this.startExecProgram=function(c,d,e,f){return a.call({actionName:"pg_ExcuteBatchPgAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,program_seq:d,file_name:e,deal_bk_seq:f},timeout:3600})},this.startSelectExecProgram=function(c,d,e,f){return a.call({actionName:"pg_ExcuteSelpgAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,program_seq:d,deal_bk_seq:e,sql_list:f},timeout:3600})},this.getProgramType=function(c,d){return a.call({actionName:"pg_ViewPgActiongetPgSourceForBatch.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,deal_bk_seq:d}})},this.startSelectProgram=function(c,d,e,f){return a.call({actionName:"pg_ExecuteSelectBatchPgAction.do",reqData:{org_rs_code:b.rscode(""),order_seq:c,program_seq:d,file_name:e,deal_bk_seq:f},timeout:3600})}}]),FaultHttp.service("TroubleConfig",["CallProvider","CV",function(a,b){this.addTroubleType=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_AddTroubleTypeAction.do",reqData:c})},this.deleteTroubleType=function(c){return a.call({actionName:"wo_DeleteTroubleTypeAction.do",reqData:{org_rs_code:b.rscode(""),trouble_key:c}})},this.updateTroubleType=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_UpdateTroubleTypeAction.do",reqData:c})},this.viewTroubleTypeInfo=function(c){return a.call({actionName:"wo_ViewOrderActiongetTroubleTypeInfo.do",reqData:{org_rs_code:b.rscode(""),trouble_key:c}})},this.getTroubleTypeList=function(){return a.call({actionName:"wo_ViewOrderActionqueryTroubleTypeList.do",reqData:{org_rs_code:b.rscode("")}})},this.addPeakTimeInterval=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_AddTimeIntervalAction.do",reqData:c})},this.getPeakTimeIntervalList=function(c){return a.call({actionName:"wo_PageTimeIntervalAction.do",reqData:{org_rs_code:b.rscode(""),start_recd:c.data.offset,limit_recd:c.data.limit}})},this.viewPeakTimeIntervalInfo=function(c){return a.call({actionName:"wo_ViewTimeIntervalActionGetDetail.do",reqData:{org_rs_code:b.rscode(""),time_work_seq:c}})},this.modifyPeakTimeInterval=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"wo_ModifyTimeIntervalAction.do",reqData:c})},this.deletePeakTimeInterval=function(c){return a.call({actionName:"wo_DeleteTimeIntervalAction.do",reqData:{org_rs_code:b.rscode(""),time_work_seq:c}})}}]);var InspectionHttp=angular.module("InspectionHttpSrv",[]);InspectionHttp.service("Collection",["CallProvider","CV",function(a,b){this.pageInspectProgramList=function(c){return a.call({actionName:"co_PageCoProgramAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit}})},this.pageRunTaskList=function(c){return a.call({actionName:"co_PageRunningTaskListAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit}})},this.pageAutomaticList=function(c){return a.call({actionName:"co_PageAutoTaskListAction.do",reqData:{org_rs_code:b.rscode(""),key_word:c.key_word,start_recd:c.data.offset,limit_recd:c.data.limit}})},this.deleteSingleCollectProgram=function(c){return a.call({actionName:"co_DeleteCoProgramAction.do",reqData:{org_rs_code:b.rscode(""),prog_id:c}})},this.getProgramListByBusiSys=function(c){return a.call({actionName:"co_ViewCoProgramActionqueryPublishProgList.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getProgramInfoByProgId=function(c){return a.call({actionName:"co_ViewCoTaskActiongetCoTaskBeanByProgId.do",reqData:{org_rs_code:b.rscode(""),prog_id:c}})},this.getNodesByCmptId=function(c,d){return a.call({actionName:"co_ViewNodeModuleActiongetCompDisposeNode.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c,module_id:d}})},this.newAutoCjTask=function(c,d,e,f,g){return a.call({actionName:"co_CreateAutoTaskAction.do",reqData:{org_rs_code:b.rscode(""),
task_cn_name:c,task_bk_desc:d,prog_id:e,business_sys_name:f,bean:g}})},this.getInitpath=function(c){return a.call({actionName:"co_ViewCoTaskActiongetInitPath.do",reqData:{org_rs_code:b.rscode(""),node_name:c}})},this.addCollectProg=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"co_AddCoProgramAction.do",reqData:c})},this.editCollectProg=function(c){return c.org_rs_code=b.rscode(""),a.call({actionName:"co_EditCoProgramAction.do",reqData:c})},this.addCollectItem=function(c,d,e,f,g,h){return a.call({actionName:"co_AddCoItemAction.do",reqData:{org_rs_code:b.rscode(""),prog_id:c,prog_cn_name:d,prog_bk_desc:e,business_sys_name:f,is_parallel:g,collect_item:h}})},this.updateCollectItem=function(c,d,e){return a.call({actionName:"co_UpdateCoItemAction.do",reqData:{org_rs_code:b.rscode(""),prog_id:c,seq:d,collect_item:e}})},this.deleteCollectItem=function(c,d,e){return a.call({actionName:"co_DeleteCoItemAction.do",reqData:{org_rs_code:b.rscode(""),prog_id:c,seq:d,collect_item:e}})},this.getCollectItemList=function(c){return a.call({actionName:"co_ViewCoProgramActionqueryCollectComps.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getCollectProgDetail=function(c){return a.call({actionName:"co_ViewCoProgramActiongetCoProgramDetail.do",reqData:{org_rs_code:b.rscode(""),prog_id:c}})},this.getCoTaskDetail=function(c){return a.call({actionName:"co_ViewCoTaskActiongetCoTaskDetail.do",reqData:{org_rs_code:b.rscode(""),work_id:c}})},this.PublishCoProgram=function(c){return a.call({actionName:"co_PublishCoProgramAction.do",reqData:{org_rs_code:b.rscode(""),prog_id:c}})},this.getFileList=function(c,d){return a.call({actionName:"co_ViewCoTaskActionshowDirectory.do",reqData:{org_rs_code:b.rscode(""),node_name:c,root_bk_dir:d}})},this.getFileListBySoc=function(c,d,e,f){return a.call({actionName:"bs_ShowVersionDirectoryAction.do",reqData:{org_rs_code:b.rscode(""),soc_name:c,root_bk_dir:d,ip:e,exec_user:f}})},this.closeTask=function(c){return a.call({actionName:"co_CloseTaskAction.do",reqData:{org_rs_code:b.rscode(""),work_id:c}})},this.deleteTask=function(c){return a.call({actionName:"co_DeleteTaskAction.do",reqData:{org_rs_code:b.rscode(""),work_id:c}})},this.getCollectItemInfoByWorkId=function(c){return a.call({actionName:"co_ViewCoTaskActionmonitorBody.do",reqData:{org_rs_code:b.rscode(""),work_id:c}})},this.getDataFileInfoByWorkId=function(c){return a.call({actionName:"co_ViewCoTaskActionmonitorTail.do",reqData:{org_rs_code:b.rscode(""),work_id:c}})},this.closeCollectTask=function(c){return a.call({actionName:"co_CloseTaskAction.do",reqData:{org_rs_code:b.rscode(""),work_id:c}})},this.closeAllCollectCmptByNode=function(c,d){return a.call({actionName:"co_CloseTaskByNodeAction.do",reqData:{org_rs_code:b.rscode(""),work_id:c,node_name:d}})},this.closeSingleCollectCmptByModule=function(c,d,e){return a.call({actionName:"co_CloseSingleModuleAction.do",reqData:{org_rs_code:b.rscode(""),work_id:c,node_name:d,module_id:e}})},this.downLoadAllDataFile=function(c){return a.call({actionName:"co_DownloadCollectFilesAction.do",reqData:{org_rs_code:b.rscode(""),work_id:c}})}}]),InspectionHttp.service("Inspection",["CallProvider","CommData","CV",function(a,b,c){this.getAllReportMould=function(){return a.call({actionName:"rp_ViewReportMouldActiongetAllReportMould.do",reqData:{org_rs_code:c.rscode("")}})},this.addReportMould=function(b){return a.call({actionName:"rp_AddReportMouldAction.do",reqData:{org_rs_code:c.rscode(""),chapter_list:b.chapter_list,model_list:b.model_list,report_template_bk_desc:b.report_template_bk_desc,report_template_cn_name:b.report_template_cn_name,report_template_name:b.report_template_name,save:b.save}})},this.deleteReportMould=function(b){return a.call({actionName:"rp_DeleteReportMouldAction.do",reqData:{org_rs_code:c.rscode(""),report_template_name:b}})},this.modifyReportMould=function(b){return a.call({actionName:"rp_UpdateReportMouldAction.do",reqData:{org_rs_code:c.rscode(""),chapter_list:b.chapter_list,model_list:b.model_list,report_template_bk_desc:b.report_template_bk_desc,report_template_cn_name:b.report_template_cn_name,report_template_name:b.report_template_name,save:b.save}})},this.viewReportDetail=function(b){return a.call({actionName:"rp_ViewReportMouldActiongetReportMouldDetail.do",reqData:{org_rs_code:c.rscode(""),report_template_name:b}})},this.getAllIndexModel=function(b){return a.call({actionName:"rp_ViewReportMouldActiongetAllIndiModel.do",reqData:{org_rs_code:c.rscode(""),model_list:b}})},this.getScriptTaskFile=function(){return a.call({actionName:"in_ViewModelActiongetScriptTaskFile.do",reqData:{org_rs_code:c.rscode("")}})},this.exportIndiPDF=function(b,d,e){return a.call({actionName:"cm_IndiExportPDFActiongetReportJson.do",reqData:{org_rs_code:c.rscode(""),url:b,indi_task_id:d,paper_size:e}})},this.getReportDataById=function(b){return a.call({actionName:"in2_ViewModelActiongetReportJson.do",reqData:{org_rs_code:c.rscode(""),indi_task_id:b}})},this.validReportFile=function(b){return a.call({actionName:"rp_ViewInTaskActioncheckLocalFile.do",reqData:{org_rs_code:c.rscode(""),file_path:b}})},this.getChartListByModelList=function(b){return a.call({actionName:"rp_ViewReportMouldActiongetIndiModelNodeList.do",reqData:{model_list:b}})},this.getXjtaskDetail=function(b){return a.call({actionName:"rp_ViewInTaskActiongetInTaskDetail.do",reqData:{work_id:b}})},this.inTaskList=function(b){return a.call({actionName:"in2_PageInTaskAction.do",reqData:{org_rs_code:c.rscode(""),key_word:b.key_word,start_recd:b.data.offset,limit_recd:b.data.limit}})},this.deleteIntask=function(b){return a.call({actionName:"in2_DeleteIndiTaskAction.do",reqData:{org_rs_code:c.rscode(""),work_id:b}})},this.pageTaskReportList=function(b){return a.call({actionName:"in2_PageIndiTaskReportAction.do",reqData:{org_rs_code:c.rscode(""),key_word:b.key_word,start_recd:b.data.offset,limit_recd:b.data.limit}})},this.deleteTaskReport=function(b){return a.call({actionName:"in2_DeleteIndiTaskReportAction.do",reqData:{org_rs_code:c.rscode(""),indi_pdf_id:b}})},this.saveXjTaskBasicInfo=function(b){return a.call({actionName:"in2_AddInTaskAction.do",reqData:b})},this.getCotTaskList=function(){return a.call({actionName:"in2_ViewModelActiongetCotTaskList.do",reqData:{org_rs_code:c.rscode("")}})},this.getFileListByFileType=function(b,d){return a.call({actionName:"in2_ViewModelActiongetFileListByFileType.do",reqData:{org_rs_code:c.rscode(""),file_type:b,task_no:d}})},this.importXJConfigInfo=function(b,c){return a.call({actionName:"in2_IndiTaskImportAction.do",reqData:{indi_task_id:b,taskImportBean:c}})},this.watchXJImportInfo=function(b){return a.call({actionName:"in2_IndiTaskImportMonitorAction.do",reqData:{monitor_list:b}})},this.viewXJImportHis=function(b,c,d){return a.call({actionName:"in2_IndiTaskImportHistoryAction.do",reqData:{indi_task_id:b,indi_model_name:c,indi_node_name:d}})},this.getUploadFilePath=function(){return a.call({actionName:"in2_ViewModelActiongetFilePath.do",reqData:{org_rs_code:c.rscode("")}})},this.executeNextStep=function(b){return a.call({actionName:"im_ExecuteIndiModelAction.do",reqData:{indi_task_id:b}})},this.getReportTemplateByModel=function(b){return a.call({actionName:"rp_ViewReportMouldActiongetReportMouldList.do",reqData:{indimodel_list:b}})},this.viewReportTemplateInfo=function(b,c,d){return a.call({actionName:"in2_QueryReportDataAction.do",reqData:{business_sys_name:b,report_name:c,indi_task_id:d}})},this.saveSingleChartInfo=function(b,c,d){return a.call({actionName:"in2_SaveReportDataAction.do",reqData:{indi_task_id:b,report_list:c,report_name:d}})},this.getAllIndiList=function(){return a.call({actionName:"im_QueryAllIndiModelAction.do",reqData:{org_rs_code:c.rscode("")}})},this.getSingleIndiDetail=function(b){return a.call({actionName:"im_GetIndiModelAction.do",reqData:{model_name:b}})},this.saveIndiBasicInfo=function(b,d,e){return a.call({actionName:"im_SaveIndiModelAction.do",reqData:{org_rs_code:c.rscode(""),model_name:b,model_cn_name:d,desc:e}})},this.saveIndiAllInfo=function(b){return b.org_rs_code=c.rscode(""),a.call({actionName:"im_SaveIndiModelNodeAction.do",reqData:b})},this.deleteSingleIndiModel=function(b){return a.call({actionName:"im_DeleteIndiModelAction.do",reqData:{org_rs_code:c.rscode(""),model_name:b}})},this.publishSingleIndiModel=function(b){return a.call({actionName:"im_PublishIndiModelAction.do",reqData:{org_rs_code:c.rscode(""),model_name:b}})},this.getXjtaskDetailInfo=function(b){return a.call({actionName:"in2_IndiTaskImportMsgAction.do",reqData:{indi_task_id:b}})}}]),InspectionHttp.service("LogXJ",["CallProvider","CV",function(a,b){this.getAllNodesList=function(){return a.call({actionName:"bs_ViewNodeActiongetAllBsNode.do",reqData:{org_rs_code:b.rscode("")}})},this.getSocListByNode=function(c){return a.call({actionName:"bs_ViewNodeActiongetAllSocWithNodeName.do",reqData:{org_rs_code:b.rscode(""),node_name:c}})},this.getFileListBySoc=function(c,d,e){return a.call({actionName:"bs_ViewNodeActionshowNodeDirectory.do",reqData:{org_rs_code:b.rscode(""),node_name:c,download_soc_name:d,root_bk_dir:e}})},this.getLogInfo=function(c){return a.call({actionName:"bs_ReadNodeConfigFileAction.do",reqData:{org_rs_code:b.rscode(""),node_name:c.node_name,download_soc_name:c.download_soc_name,relative_path:c.node.full_path,encoding:"GBK",search_key:c.search_key,search_num:c.search_num},timeout:300})},this.getLogFile=function(c,d){return a.call({actionName:"lg_ViewOpLogActionqueryLogFileList.do",reqData:{org_rs_code:b.rscode(""),sys_name:c,date:d}})},this.getArchivePath=function(c){return a.call({actionName:"dt_ViewDtActionqueryFTPSocListByIp.do",reqData:{org_rs_code:b.rscode(""),soc_ip:c}})},this.archiveLog=function(c,d,e){return a.call({actionName:"lg_ArchiveLogAction.do",reqData:{org_rs_code:b.rscode(""),log_file_list:c,soc_name:d,archive_path:e}})},this.getLogId=function(){return a.call({actionName:"rz_OpenQuerySession.do",reqData:{org_rs_code:b.rscode("")}})},this.analysisKeyToChart=function(b){return a.call({actionName:"rz_AnalysisKeyword.do",reqData:b})},this.getLogBypage=function(c){return a.call({actionName:"rz_OnlineAnalyzePageLog.do",reqData:{org_rs_code:b.rscode(""),sid:c.sid,offset:0==c.offset?c.offset:c.offset-1,size:c.size,sys_name:c.sys_name,log_name:c.log_name,begin_date:c.start_date,end_date:c.end_date,node_name:c.node_name,node_index:c.node_index,file_index:c.file_index,start_time:c.start_time,end_time:c.end_time,keywords:c.keywords,context_line:c.context_line,timestamp_exp:c.timestamp_exp,server_flag:c.server_flag},timeout:300})},this.deleteLogAnalysisFile=function(){return a.call({actionName:"rz_DeleteLogAnalysisOldFile.do",reqData:{}})},this.getInspectContent=function(b){return a.call({actionName:"rz_AddLogReport.do",reqData:b})},this.getReportChartByName=function(b){return a.call({actionName:"rz_ViewLogActiongetReportChartMsg.do",reqData:{report_name:b}})},this.getInspectPdf=function(c,d,e){return a.call({actionName:"rz_LogExportPdfActiongetLogPdf.do",reqData:{org_rs_code:b.rscode(""),report_name:c,report_url:d,paper_size:e}})},this.deleteReportByName=function(b,c){return a.call({actionName:"rz_DeleteLogReport.do",reqData:{report_name:b,log_id:c}})},this.savePickTogetFileList=function(b){return a.call({actionName:"rz_QueryLogFileList.do",reqData:b})},this.combinePickLog=function(b){return a.call({actionName:"rz_CombineLogFile.do",reqData:{logSyncinfos:b},timeout:300})},this.getAllNodeListBySys=function(b){return a.call({actionName:"rz_ViewLogActionqueryConfigList.do",reqData:{sys_name:b}})},this.getAnalysisByNodeFiles=function(b){return a.call({actionName:"rz_OnlineScreenFile.do",reqData:{sys_name:b.sys_name,node_name:b.node_name,file:b.file,encoding:b.encoding,start_time:b.start_time,end_time:b.end_time,key_word:b.keywords,lines:b.lines,node_ip:b.node_ip,finish_time:b.finish_time,timestamp:b.timestamp},timeout:1200})},this.OnlineScreen=function(b){return a.call({actionName:"rz_OnlineAnalyzsisDownloadFile.do",reqData:{sys_name:b.sys_name,node_name:b.node_name,file:b.file,encoding:b.encoding,start_time:b.start_time,end_time:b.end_time,key_word:b.keywords,lines:b.lines,node_ip:b.node_ip,finish_time:b.finish_time,timestamp:b.timestamp,local_path:b.local_path,remote_path:b.remote_path},timeout:300})},this.getDownDynamic=function(b){return a.call({actionName:"rz_OnlineAnalyzeQueryDownload.do",reqData:{sid:b}})},this.getReportMessage=function(b){return a.call({actionName:"rz_ViewReportActiongetReportByRepName.do",reqData:{report_name:b}})}}]),InspectionHttp.service("LogMonitor",["CallProvider","$location","$cookieStore","CommData","CV",function(a,b,c,d,e){var f=b.absUrl().substring(b.absUrl().indexOf("=")+1),g=f.substring(0,f.indexOf("&"));console.log(g);var h=c.get(g+"_data"),i=h?h.cp:d;console.log(i);var j={org_user_id:i.org_user_id,org_dept_id:i.org_dept_id,orguser_cn_name:i.orguser_cn_name,orgdept_cn_name:i.orgdept_cn_name,org_term_no:i.org_term_no};this.getLogMonitorBypage=function(b){return a.call({actionName:"rz_OnlineAnalyzePageLog.do",reqData:angular.extend(j,{org_rs_code:e.rscode(""),sid:b.sid,offset:0==b.offset?b.offset:b.offset-1,size:b.size,sys_name:b.sys_name,log_name:b.log_name,begin_date:b.start_date,end_date:b.end_date,node_name:b.node_name,node_index:b.node_index,file_index:b.file_index,start_time:b.start_time,end_time:b.end_time,keywords:b.keywords,context_line:b.context_line,timestamp_exp:b.timestamp_exp,server_flag:b.server_flag})})}}]);var ReleaseHttp=angular.module("ReleaseHttpSrv",[]);ReleaseHttp.service("Proj",["CallProvider","CV",function(a,b){this.getNotFinishProjTblData=function(c){return a.call({actionName:"pj_PageNotExecutePjProjectAction.do",reqData:{org_rs_code:b.rscode("proj_list"),start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2"}})},this.getFinishProjTblData=function(c){return a.call({actionName:"pj_PageHistoryPjProjectAction.do",reqData:{org_rs_code:b.rscode("proj_list"),start_date:c.data.startDate,end_date:c.data.endDate,business_sys_name:c.data.busiSys,start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"asc"==c.data.order?"1":"2"}})},this.saveProj=function(c){return c.org_rs_code=b.rscode("new_proj"),a.call({actionName:"pj_AddPjProjectBasicAction.do",reqData:c})},this.updateProj=function(c){return c.org_rs_code=b.rscode("proj_list"),a.call({actionName:"pj_UpdatePjProjectBasicAction.do",reqData:c})},this.getOnePjProj=function(c,d){return a.call({actionName:"pj_ViewPjActiongetPjProjInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getProjDetail=function(c,d){return a.call({actionName:"sp_ViewPjActiongetPjInfoDetail.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,syspublish_id:d}})},this.deleteOneProj=function(c,d,e){return a.call({actionName:"pj_DeletePjProjectAction.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.uniqueProj=function(b,c){return a.call({actionName:"pj_ViewPjActioncheckProjectName.do",reqData:{business_sys_name:c,project_name:b}})},this.reloadProj=function(c){return c.org_rs_code=b.rscode("proj_list"),a.call({actionName:"pj_ResetHistoryProjectAction.do",reqData:c})},this.getPublicData=function(c,d){return a.call({actionName:"sp_ViewPjActiongetPjInfoDetail.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,syspublish_id:d}})},this.getProjectData=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryPjProjInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getBusisysData=function(c,d){return a.call({actionName:"pj_ViewPjActiongetPjDetailBsSysInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getProjPublishData=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryPjPublishInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getPlanData=function(c,d){return a.call({actionName:"pj_ViewPjPlanActionviewPlanInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getPublishedProgByBusiSysName=function(b){return a.call({actionName:"bs_ViewBsProgramActionqueryPublishProgList.do",reqData:{business_sys_name:b}})},this.getAllExcutedUser=function(){return a.call({actionName:"pj_QueryDeptAndUserListAction.do",reqData:{}})},this.getAllExcutedUserByBusi=function(b){return a.call({actionName:"pj_QueryDeptAndUserByBusNameAction.do",reqData:{business_sys_name:b}})},this.getQuickProjTblData=function(b){return a.call({actionName:"sp_PageQuickProjectAction.do",reqData:{start_recd:b.data.offset,limit_recd:b.data.limit,order_col_name:b.data.sort,order_type:"asc"==b.data.order?"1":"2"}})}}]),ReleaseHttp.service("Project",["CallProvider","CV",function(a,b){this.getAllExcutedUser=function(){return a.call({actionName:"pj_QueryDeptAndUserListAction.do",reqData:{}})},this.addProj=function(c){return c.org_rs_code=b.rscode("new_proj"),a.call({actionName:"pj_SaveProjectAction.do",reqData:c})},this.getProjList=function(b,c,d,e){return d?a.call({actionName:"pj_PageHistoyProjectAction.do",reqData:{project_name:b,start_recd:e.start_recd,limit_recd:e.limit_recd}}):a.call({actionName:"pj_ViewProjectActiongetProjectList.do",reqData:{project_name:b}})},this.getAllExcutedUserByBusi=function(b){return a.call({actionName:"pj_QueryDeptAndUserByBusNameAction.do",reqData:{business_sys_name:b}})},this.getProjectData=function(b){return a.call({actionName:"pj_ViewProjectActiongetProjectInfo.do",reqData:{project_id:b}})},this.getSysProgram=function(b){return a.call({actionName:"pj_ViewProjectActiongetBusinessProgramList.do",reqData:{business_sys_name:b}})},this.applyRelease=function(b){return a.call({actionName:"pj_SavePublishProjectAction.do",reqData:b})},this.getApplyReleaseList=function(b){return b?a.call({actionName:"pj_ViewProjectActionqueryPublishListByProjectId.do",reqData:{project_id:b}}):a.call({actionName:"pj_ViewPublishActiongetPublishList.do",reqData:{}})},this.getApplyReleaseHistoryList=function(b){return a.call({actionName:"pj_PageHistoyPublishAction.do",reqData:b})},this.applyProjectList=function(){return a.call({actionName:"pj_ViewProjectActionqueryAllProjectSysList.do",reqData:{}})},this.getReleaseProjSysList=function(b){return a.call({actionName:"pj_ViewProjectActiongetPublishBusinessList.do",reqData:{pjpublish_id:b}})},this.viewReleaseApply=function(b){return a.call({actionName:"pj_ViewPublishActiongetPublishInfo.do",reqData:{pjpublish_id:b}})},this.deleteReleaseApply=function(b){return a.call({actionName:"pj_DeletePublishProjectAction.do",reqData:{pjpublish_id:b}})},this.checkApply=function(b){return a.call({actionName:"pj_AuditedPublishProjectAction.do",reqData:{pjpublish_id:b}})},this.reBootPjpublish=function(b){return a.call({actionName:"pj_RebootPjPublishAction.do",reqData:{pjpublish_id:b}})},this.handleCloseProject=function(b){return a.call({actionName:"pj_CloseProjectAction.do",reqData:{project_id:b}})},this.reBootProject=function(b){return a.call({actionName:"pj_RebootProjectAction.do",reqData:{project_id:b}})},this.viewPreProject=function(b){return a.call({actionName:"pj_ViewProjectActiongetProjectIdList.do",reqData:{project_id:b}})},this.getBusisysData=function(c,d){return a.call({actionName:"pj_ViewPjActiongetPjDetailBsSysInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getProjPublishData=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryPjPublishInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getPlanData=function(c,d){return a.call({actionName:"pj_ViewPjPlanActionviewPlanInfo.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,project_name:d}})},this.getPrepareList=function(b,c){return a.call({actionName:"pj_ViewPublishActiongetPrepareProjectList.do",reqData:{pjpublish_name:b,pjpublish_status:c}})},this.getCombinePubList=function(b,c){return a.call({actionName:"pj_ViewProjectActionqueryAllSysPublishList.do",reqData:{business_sys_name:b,syspublish_status:c}})},this.viewSysPublishDetail=function(b){return a.call({actionName:"sp_ViewSysPublishActiongetSysPublishDetail.do",reqData:{syspublish_id:b}})},this.viewSysReadyDetail=function(b){return a.call({actionName:"sp_ViewSysPublishActiongetSysPubExeDetail.do",reqData:{syspublish_id:b}})}}]),ReleaseHttp.service("Exec",["CallProvider","CV",function(a,b){this.getSysPubDetail=function(c,d){return a.call({actionName:"sp_ViewExecuteActiongetSpInfoDetail.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:c,syspublish_id:d}})},this.getInstanceFullPath=function(c){return a.call({actionName:"sp_ViewPjActiongetInstanceFullPath.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c}})},this.importInstance=function(c,d){return a.call({actionName:"sp_ImportInstanceAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c,import_file_path:d}})},this.canExec=function(c,d){return a.call({actionName:"sp_CheckExecuteAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,syspublish_id:d}})},this.getInstanceImportPath=function(){return a.call({actionName:"sp_ViewPjActiongetInstanceImportPath.do",reqData:{org_rs_code:b.rscode("prod_exec_list")}})},this.execByPhase=function(c,d,e){return a.call({actionName:"sp_ExecutePjPhaseAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),phase_no:d,skip_flag:e,execute_id:c},timeout:3600})},this.autoExecByphase=function(c,d){return a.call({actionName:"sp_ExecutePjOneButtonAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c,phaseId:d},timeout:3600})},this.execPauseRunning=function(c){return a.call({actionName:"sp_ExecutePauseAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c},timeout:3600})},this.resetPhase=function(c,d){return a.call({actionName:"sp_ResetExecutePhaseAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),phase_no:c,execute_id:d},timeout:3600})},this.stopByStep=function(c){return a.call({actionName:"sp_ExecutePjStepStopAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c}})},this.summaryProd=function(c){return c.org_rs_code=b.rscode("prod_exec_list"),a.call({actionName:"pj_EditPjEvaluateAction.do",reqData:c})},this.showSummaryProd=function(c,d){return a.call({actionName:"sp_ViewPjActionqueryPjEvaluate.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,syspublish_id:d}})},this.reSet=function(c){return a.call({actionName:"sp_ResetExecuteAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),syspublish_id:c}})},this.getOneProdExecInfo=function(c,d){return a.call({actionName:"pj_ViewPjActiongetHistoryProjectDetails.do",reqData:{org_rs_code:b.rscode("his_prod_do"),business_sys_name:c,project_name:d}})},this.getOneProdPacParam=function(c,d,e){return a.call({actionName:"pj_ViewPjActionqueryPropackageParam.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d,node_type:e}})},this.getALLProjReadyInfo=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryPreparePacList.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d}})},this.getProjNodeCfgFileInfo=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryConfigList.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d}})},this.getConfigFile=function(c,d,e,f,g,h){return a.call({actionName:"sp_ReadConfigFileAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,syspublish_id:d,soc_ip:e,relative_path:f,download_soc_name:g,encoding:h}})},this.getFilesByPath=function(c,d,e,f,g,h){return a.call({actionName:"pj_ViewPjActionshowDirectory.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d,root_bk_dir:e,node_name:f,check_soc_name:g,download_soc_name:h}})},this.getModifyFileList=function(c){return c.org_rs_code=b.rscode("prod_exec_list"),a.call({actionName:"pj_ViewPjActionqueryModifyFilePath.do",reqData:c})},this.saveConfigFile=function(c){return c.org_rs_code=b.rscode("prod_exec_list"),a.call({actionName:"pj_WriteConfigFileAction.do",reqData:c})},this.deleteConfigModifyFile=function(c,d,e,f,g,h){return a.call({actionName:"pj_ViewPjActiondeleteModifyFile.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,syspublish_id:d,soc_ip:e,download_soc_name:f,node_file_path:g,quick_publish:h}})},this.validPropac=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryPropacExist.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),version_soc_name:c,propackage_full_path:d}})},this.validProlist=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryProlistExist.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),version_soc_name:c,prolist_full_path:d}})},this.downloadProdListFile=function(c,d,e,f){return a.call({actionName:"pj_DownloadRemoteFileAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d,version_soc_name:e,file_full_path:f}})},this.getListPreParedPj=function(){return a.call({actionName:"pj_ViewPjPlanActiongetListPreParedPj.do",reqData:{org_rs_code:b.rscode("prod_exec_list")}})},this.getExecLogMsg=function(c,d,e){return a.call({actionName:"pj_ViewMonitorActiongetCurrentNodeMsg.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d,prog_type:e}})},this.getHisLogMsg=function(c,d){return a.call({actionName:"pj_ViewMonitorActiongetHistoryNodeMsg.do",reqData:{org_rs_code:b.rscode("his_prod_do"),business_sys_name:c,project_name:d}})},this.rollback=function(c,d,e){return a.call({actionName:"pj_ExecutePjRollbackAction.do",reqData:{org_rs_code:b.rscode("proj_list"),business_sys_name:d,project_name:c,node_names:e},timeout:3600})},this.getRollbackSteps=function(c,d){return a.call({actionName:"pj_MonitorRollbackStepAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d}})},this.editRollbackSummary=function(b){return a.call({actionName:"pj_EditRollbackEvaluateAction.do",reqData:b,timeout:600})},this.getRollbackSummary=function(c,d){return a.call({actionName:"pj_ViewPjActionqueryRollbackEvaluate.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:d,syspublish_id:c}})},this.getReadyPacParamInfo=function(c,d){return a.call({actionName:"pj_ViewPrepareActiongetPrepareMsg.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),syspublish_id:c,program_id:d}})},this.getRollbackReadyPacParamInfo=function(c,d,e){return a.call({actionName:"sp_ViewSystemPrepareActiongetRollBackMsg.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,syspublish_id:d,roll_prog_id:e}})},this.saveReadyInfo=function(c){return c.org_rs_code=b.rscode("prod_exec_list"),a.call({actionName:"sp_SystemPrepareAction.do",reqData:c,timeout:3600})},this.savePlatFilePath=function(b,c){return a.call({actionName:"sp_DealPlatformPackageAction.do",reqData:{syspublish_id:b,dir_names:c},timeout:3600})},this.getNodeslist=function(c,d,e){return a.call({actionName:"bs_ViewBsActiongetListNode.do",reqData:{business_sys_name:c,project_name:d,prog_id:e,org_rs_code:b.rscode("busi_sys_list")}})},this.getHistroyRollbackInfo=function(c,d){return a.call({actionName:"pj_ViewPjActiongetRollBack.do",reqData:{org_rs_code:b.rscode("busi_sys_list"),business_sys_name:c,project_name:d}})},this.getMonitorExecLogMsg=function(c){return a.call({actionName:"sp_ViewMonitorActiongetConsole.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c}})},this.getMonitorInteractLogMsg=function(c,d){return a.call({actionName:"pj_InteractMonitorAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c,phase_no:d}})},this.sendInteractCmdMsg=function(c,d,e,f){return a.call({actionName:"pj_InteractMidCmdAction.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),execute_id:c,phase_no:d,cmd:e,sensitive_flag:f}})},this.interactiveSqlGetNode=function(b){return a.call({actionName:"sp_InitInteractSQLAction.do",reqData:{execute_id:b}})},this.interactiveSqlExeSql=function(b,c,d,e){return a.call({actionName:"sp_ExecuteInteractSQLAction.do",reqData:{execute_id:b,sql_text:e,node_ip:c,delimiter:d}})},this.interactiveSqlExeMonitor=function(b){return a.call({actionName:"sp_ViewMonitorActionmonitorSqlExecuteMsg.do",reqData:{execute_id:b},timeout:3600})},this.interactiveSqlSubmitOrRollback=function(b,c,d){return a.call({actionName:"sp_DoInteractSQLTranAction.do",reqData:{execute_id:b,tran_type:c,exe_id:d}})},this.interactiveSqlClose=function(b){return a.call({actionName:"sp_EndInteractSQLAction.do",reqData:{execute_id:b}})},this.interactiveSqlChangeEncoding=function(b){return a.call({actionName:"sp_InteractExecuteSQLAction.do",reqData:{execute_id:b}})},this.getLogsFilesByPath=function(c,d,e,f,g,h){return a.call({actionName:"pj_ViewPjActionshowLogDirectory.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d,root_bk_dir:e,node_name:f,check_soc_name:g,download_soc_name:h}})},this.startMonitorNode=function(c){return a.call({actionName:"sp_StartMonitorLogAction.do",reqData:{org_rs_code:b.rscode(""),log_file:c}})},this.endMonitorNode=function(c){return a.call({actionName:"sp_StopMonitorLogAction.do",reqData:{org_rs_code:b.rscode(""),log_task:c}})},this.getMonitorLogInfo=function(c){return a.call({actionName:"sp_MonitorLogMsgAction.do",reqData:{org_rs_code:b.rscode(""),log_file:c}})},this.excuteLocalAuthor=function(c){return a.call({actionName:"sp_PjExecuteAuthorityAction.do",reqData:{org_rs_code:b.rscode(""),syspublish_id:c}})},this.savePhaseExecNodeInfo=function(c,d,e,f){return a.call({actionName:"pj_ModifyExecuteNodeAction.do",reqData:{org_rs_code:b.rscode(""),execute_id:c,phase_no:d,soc_list:e,parallel_flag:f}})},this.handEditExecNodeInfo=function(c,d,e,f){return a.call({actionName:"sp_ModifyExecuteMsgAction.do",reqData:{org_rs_code:b.rscode(""),execute_id:c,phase_no:d,ip:e,reason:f}})},this.monitorNodeMsg=function(c,d){return a.call({actionName:"bs_ViewNodeActionmonitorNode.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,soc_ip:d}})},this.getQuickProjectName=function(){return a.call({actionName:"sp_ViewSysPublishActiongenerateSysPublishId.do",reqData:{}})},this.getQuickProjectPac=function(b,c,d,e){return a.call({actionName:"sp_ViewPjProgramActiongetProgramForPrepare.do",reqData:{business_sys_name:b,syspublish_id:c,environment_id:d,prog_id:e}})},this.getReadyOldPacParamInfo=function(c,d){return a.call({actionName:"pj_ViewPjProgramActiongetOldPrepareInfo.do",reqData:{org_rs_code:b.rscode("prod_exec_list"),business_sys_name:c,project_name:d}})},this.saveQuickReadyInfo=function(c){return c.org_rs_code=b.rscode("prod_exec_list"),a.call({actionName:"sp_PrepareQuickProjectAction.do",reqData:c,timeout:3600})},this.shutDownQuickProj=function(b,c,d){return a.call({actionName:"pj_EndQuickPublishAction.do",reqData:{business_sys_name:b,syspublish_id:c,prod_flag:d}})},this.getDefinePhyInfo=function(b,c){return a.call({actionName:"bs_ViewStructActionqueryPhyNodeList.do",reqData:{sys_id:b,env_id:c}})}}]),ReleaseHttp.service("Monitor",["CallProvider","CV",function(a,b){this.getprojplanTbl1=function(c){return a.call({actionName:"pj_ViewPjMonitorActiongetSingleMonitor.do",reqData:{org_rs_code:b.rscode("exec_monitor_list"),pro_bk_date:c}})},this.monitorPjProjectByOnePhase=function(c,d){return a.call({actionName:"pj_MonitorExePhaseAction.do",reqData:{org_rs_code:b.rscode("exec_monitor_list"),business_sys_name:c,project_name:d}})},this.monitorPjProject=function(c){return a.call({actionName:"sp_MonitorPhaseAction.do",reqData:{org_rs_code:b.rscode("exec_monitor_list"),execute_id:c}})},this.getAllMonitorInfomation=function(){return a.call({actionName:"pj_ViewProjectActiongetAllPjMonitorInfo.do",reqData:{org_rs_code:b.rscode("exec_monitor_list")}})},this.getchangedMonitorInfomation=function(c){return a.call({actionName:"pj_ViewPjMonitorActionqueryMonitor.do",
reqData:{org_rs_code:b.rscode("exec_monitor_list"),pro_bk_date:c}})},this.getPjGroupToProcessMsg=function(c){return a.call({actionName:"pj_ViewPjPlanActiongetPjToProcessMsg.do",reqData:{org_rs_code:b.rscode("exec_monitor_list"),group_id:c}})},this.savePjToProcess=function(c){return a.call({actionName:"pj_MakePjToProcessAction.do",reqData:{org_rs_code:b.rscode("exec_monitor_list"),dynamic:c.dynamic,group_id:c.group_id,group_name:c.group_name,proj_list:c.proj_list}})}}]),ReleaseHttp.service("Plan",["$q","CallProvider","CV",function(a,b,c){this.getPlan=function(a){return b.call({actionName:"pj_ViewPjPlanActionqueryListPlanCal.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),pro_bk_date:a}})},this.updatePlan=function(a){return b.call({actionName:"pj_UpdatePjProjectPlanAction.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),business_sys_name:a.sysName,project_name:a.projName,start_bk_time:a.plantime,prebs_sys_name:a.preSysName,pre_project_name:a.preProjName,pro_bk_date:a.plandate,auto_yn_flag:a.autoYnFlag}})},this.getHistoryplan=function(){return b.call({actionName:"pj_ViewPjPlanActionqueryProdPlanDate.do",reqData:{org_rs_code:c.rscode("history_plan_list")}})},this.getPlanProjTbl=function(a){return b.call({actionName:"pj_ViewPjPlanActionqueryProdPlanList2.do",reqData:{org_rs_code:c.rscode("history_plan_list"),pro_bk_date:a.pro_bk_date}})},this.getProdProjTbl=function(a){return b.call({actionName:"pj_ViewPjPlanActionqueryProdPlanList.do",reqData:{org_rs_code:c.rscode("prod_exec_list")}})},this.getPreProjListByDate=function(a,d,e){return b.call({actionName:"pj_ViewPjPlanActionqueryPjPlanByDate.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),project_name:a,business_sys_name:d,pro_bk_date:e}})},this.queryPlanData=function(a,c){return b.call({actionName:"pj_ViewPjPlanActionqueryRelatedPlanInfo.do",reqData:{business_sys_name:a,project_name:c}})},this.getGroupList=function(){return b.call({actionName:"pj_ViewPjPlanActionqueryGroupInfo.do",reqData:{org_rs_code:c.rscode("prod_plan_list")}})},this.getProjListByGroup=function(a){return b.call({actionName:"pj_ViewPjPlanActionqueryPjListByGroup.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_id:a.group_id,pro_bk_date:a.pro_bk_date}})},this.getCanGroupProjList=function(){return b.call({actionName:"pj_ViewPjPlanActionqueryNoGroupPjList.do",reqData:{org_rs_code:c.rscode("prod_plan_list")}})},this.getPreGroupNumberList=function(){return b.call({actionName:"pj_ViewPjPlanActionqueryGroupNumberList.do",reqData:{org_rs_code:c.rscode("prod_plan_list")}})},this.getPreProjListByGroupNumber=function(a){return b.call({actionName:"pj_ViewPjPlanActionqueryPjWebInfoByGroupNumber.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_number:a.group_number}})},this.saveOrUpdateGroup=function(a){return b.call({actionName:"pj_EditGroupAction.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_id:a.group_id,proj_list:a.proj_list,group_cn_name:a.group_cn_name}})},this.getProjListByGroupMonitor=function(a){return b.call({actionName:"pj_ViewPjMonitorActionqueryGroupMonitor.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_id:a}})},this.getPreProjListByGroupMonitor=function(a){return b.call({actionName:"pj_ViewPjMonitorActionqueryPreMonitor.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_number:a}})},this.getProcessByGroup=function(a){return b.call({actionName:"pj_ViewPjPlanActiongetPjProcessMsg.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_id:a}})},this.updateProcessByGroup=function(a,d){return b.call({actionName:"pj_PjMakeProcessAction.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_id:a,process_msg:d}})},this.getDiagramPhaseStatus=function(a){return b.call({actionName:"pj_ViewPjPlanActiongetMonitorPjProcessMsg.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),group_id:a}})},this.getProjectPlanInfo=function(a){return b.call({actionName:"pj_ViewProjectActiongetBusinessPhaseList.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),pjpublish_id:a}})},this.saveProjectPlanInfo=function(a,d){return b.call({actionName:"pj_PlanPjPublishAction.do",reqData:{org_rs_code:c.rscode("prod_plan_list"),pjpublish_id:a,publishBusinesslist:d}})}}]),ReleaseHttp.service("Analysis",["CallProvider","CV",function(a,b){this.getProgramData=function(){return a.call({actionName:"st_QueryProgramLineAction.do",reqData:{org_rs_code:b.rscode("regular_prod_analysis")}})},this.getYearDataGroupMonth=function(c){return a.call({actionName:"st_QueryRegonLineAction.do",reqData:{org_rs_code:b.rscode("regular_prod_analysis"),prod_year:c}})},this.getProdTblData=function(c,d){return a.call({actionName:"st_QueryProjectLineAction.do",reqData:{org_rs_code:b.rscode("proj_prod_analysis"),prod_year:c.year,project_nature:d,start_recd:c.data.offset,limit_recd:c.data.limit,order_col_name:c.data.sort,order_type:"desc"==c.data.order?"1":"2"}})},this.getUnGentTabData=function(c){return a.call({actionName:"st_QueryEmgonLineAction.do",reqData:{org_rs_code:b.rscode("urgent_prod_analysis"),prod_year:c.prod_year}})}}]),ReleaseHttp.service("PubWindow",["CallProvider","CV",function(a,b){this.getPubWindowList=function(c){return a.call({actionName:"pj_ViewPublishWindowActionqueryWindow.do",reqData:{org_rs_code:b.rscode("pub_window_list"),window_status:c}})},this.saveRoutineWindow=function(c,d,e){return a.call({actionName:"pj_AddRoutineWindowAction.do",reqData:{org_rs_code:b.rscode("pub_window_list"),start_date:c,end_date:d,cycle_list:e}})},this.saveSpecialWindow=function(c){return a.call({actionName:"pj_AddSpecialWindowAction.do",reqData:{org_rs_code:b.rscode("pub_window_list"),window_list:c}})},this.saveSpecialDayWindow=function(c,d){return a.call({actionName:"pj_CloseBatchWindowAction.do",reqData:{org_rs_code:b.rscode("pub_window_list"),date_list:d,close_reason:c}})},this.getPublishProjectByWindow=function(c){return a.call({actionName:"pj_ViewPublishWindowActionqueryProjectByWindow.do",reqData:{org_rs_code:b.rscode("pub_window_list"),window_id:c}})},this.getPublishProjectByDate=function(c,d){return a.call({actionName:"pj_ViewPublishWindowActionquerySystemByDate.do",reqData:{org_rs_code:b.rscode("pub_window_list"),start_date:c,end_date:d}})},this.closePubWindow=function(c){return a.call({actionName:"pj_CloseWindowAction.do",reqData:{org_rs_code:b.rscode("pub_window_list"),window:c}})}}]),ReleaseHttp.service("Version",["CallProvider","CV",function(a,b){this.getStreamListByKey=function(c,d){return a.call({actionName:"vs_ViewVsVersionActiongetVsVersionList.do",reqData:{org_rs_code:b.rscode(""),business_cn_name:c,version_type:d}})},this.getOnePub=function(c){return a.call({actionName:"vs_ViewVsVersionActiongetVsInfoDetailByVsId.do",reqData:{org_rs_code:b.rscode(""),vsversion_id:c}})},this.addOneVersion=function(c){return a.call({actionName:"vs_UpdateVersionFileAction.do",reqData:{org_rs_code:b.rscode(""),app_bean:c.app_bean,config_list:c.config_list,other_list:c.other_list,business_sys_name:c.business_sys_name},timeout:3600})},this.getflowData=function(c){return a.call({actionName:"vs_ViewVsVersionActiongetFullFlowBySysName.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getPubData=function(c){return a.call({actionName:"vs_ViewVsVersionActiongetPubFlowBySysName.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getInitializeUploadPath=function(c){return a.call({actionName:"vs_ViewVsVersionActiongetVersionUploadPath.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getFoldTree=function(c){return a.call({actionName:"vs_ViewVersionStreamActiongetFileListByDir.do",reqData:{org_rs_code:b.rscode(""),file_absolute_path:c}})},this.getIpBypath=function(c){return a.call({actionName:"vs_ViewVersionStreamActiongetIpByPath.do",reqData:{org_rs_code:b.rscode(""),file_absolute_path:c?c:""}})},this.pubAndBakTreeCompare=function(c,d,e,f,g,h,i){return a.call({actionName:"vs_ViewVersionStreamActioncompareTarDirectory.do",reqData:{org_rs_code:b.rscode(""),dir:c?c:"",compare_dir:d?d:"",dir_relate_path:h?h:"",compare_relate_path:i?i:"",compare_type:e,full_backup_flag:f,business_sys_name:g},timeout:1800})},this.getConfigFileByIp=function(c){return a.call({actionName:"vs_ViewVersionStreamActiongetConfigByIp.do",reqData:{org_rs_code:b.rscode(""),file_absolute_path:c?c:""}})},this.foldTreeCompare=function(c,d,e){return a.call({actionName:"vs_ViewVersionStreamActioncompareDirectory.do",reqData:{org_rs_code:b.rscode(""),dir:c?c:"",compare_dir:d?d:""},timeout:1800})},this.searchFile=function(c,d,e,f){return a.call({actionName:"vs_ViewVersionStreamActiongetFileListByName.do",reqData:{org_rs_code:b.rscode(""),file_absolute_path:c,key_word:d,tar_relate_path:e,pub_flag:f}})},this.getPubStreamFileList=function(c,d){return a.call({actionName:"vs_ViewVersionStreamActiongetPubFileList.do",reqData:{org_rs_code:b.rscode(""),file_absolute_path:c,pkg_type:d}})},this.getPubVersionList=function(c){return a.call({actionName:"vs_ViewVsVersionActiongetFlowBySysName.do",reqData:{org_rs_code:b.rscode(""),business_sys_name:c}})},this.getPubStreamFold=function(c,d){return a.call({actionName:"vs_ViewVersionStreamActiongetTarFileList.do",reqData:{org_rs_code:b.rscode(""),file_absolute_path:c,business_sys_name:d}})},this.getFoldInTarPac=function(c,d,e){return a.call({actionName:"vs_ViewVersionStreamActiongetTarFileListByDir.do",reqData:{org_rs_code:b.rscode(""),file_absolute_path:c,tar_relate_path:d,business_sys_name:e}})},this.viewfileContent=function(b){return a.call({actionName:"vs_ViewVsVersionActionviewFileContext.do",reqData:b})},this.getfileVersionNum=function(b){return a.call({actionName:"vs_ViewVsVersionActiongetVersionHistory.do",reqData:b})},this.getUpdatefileVersionNum=function(b){return a.call({actionName:"vs_ViewVsVersionActiongetHistoryFlow.do",reqData:b,timeout:1800})},this.getFileCompareContent=function(b){return a.call({actionName:"vs_ViewVsVersionActiondiffFileByPath.do",reqData:b,timeout:600})},this.downloadFile=function(b){return a.call({actionName:"vs_ViewVsVersionActiondownloadVsFileByPath.do",reqData:b,timeout:3600})}}]),ReleaseHttp.service("LargeMonitor",["CallProvider","$location","$cookieStore","CommData","CV",function(a,b,c,d,e){var f=b.absUrl().substring(b.absUrl().indexOf("?")+1),g=c.get(f+"_data"),h=g?g.cp:d,i={org_user_id:h.org_user_id,org_dept_id:h.org_dept_id,orguser_cn_name:h.orguser_cn_name,orgdept_cn_name:h.orgdept_cn_name,org_term_no:h.org_term_no};this.getUnpublishSys=function(){return a.call({actionName:"sp_ViewSysPublishActionqueryReadyPublishList.do",reqData:angular.extend(i,{org_rs_code:e.rscode("")})})},this.getPublishedSys=function(){return a.call({actionName:"sp_ViewSysPublishActionqueryAlreadyPublishList.do",reqData:angular.extend(i,{org_rs_code:e.rscode("")})})},this.getAllSys=function(){return a.call({actionName:"sp_ViewSysPublishActionqueryCirclePublishList.do",reqData:angular.extend(i,{org_rs_code:e.rscode("")})})},this.getRunningPublishSys=function(){return a.call({actionName:"sp_ViewSysPublishActionqueryRunningPublishList.do",reqData:angular.extend(i,{org_rs_code:e.rscode("")})})}}]);var chartsSrv=angular.module("ChartsService",[]);chartsSrv.service("Charts",function(){var a=function(a,b){var c="";if(new Date(a[0].data[0][0]).getFullYear()){var d=new Date(a[0].data[0][0]).getFullYear(),e=new Date(a[0].data[0][0]).getMonth(),f=new Date(a[0].data[0][0]).getDate(),g=new Date(a[0].data[a[0].data.length-1][0]).getFullYear(),h=new Date(a[0].data[a[0].data.length-1][0]).getMonth(),i=new Date(a[0].data[a[0].data.length-1][0]).getDate();d==g&&e==h&&f==i&&(c=b.substring(11,b.length)),d==g&&e==h&&f!=i&&(c=b.substring(5,b.length))}return c||(c=b),c};this.getPieConfig=function(a,b){return{title:{text:a.title,style:{color:"#d2f1fe"}},options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",height:b?b:null,backgroundColor:"#2b3b53",borderColor:null},tooltip:{headerFormat:"{series.name}<br>",pointFormat:"{point.name}: <b>{point.percentage:.2f}%</b>"},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.2f} %",color:"#d2f1fe"}}}},series:[{name:a.name,data:a.data}]}},this.getLineConfig=function(b,c){return{title:{text:b.title,style:{color:"#999"}},subtitle:{text:b.subtitle,style:{color:"#999"}},options:{chart:{type:"line",backgroundColor:"#484C52",height:c?c:300,zoomType:"x"},xAxis:{title:{text:b.xAxis_name,style:{color:"#999"},x:-35},type:b.xAxis_type&&5==b.xAxis_type?"datetime":"category",gridLineWidth:1,gridLineColor:"#666",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%b.%e",week:"%b.%e %A",month:"%Y-%B",year:"%Y"},labels:{style:{color:"#999"},formatter:function(){return b.xAxis_type&&5==b.xAxis_type?void 0:a(b.lines,this.value)}}},yAxis:{title:{text:b.yAxis_name,style:{color:"#FFF"}},min:0,gridLineWidth:1,gridLineColor:"#666",labels:{style:{color:"#FFF"}}},legend:{enabled:b.lines&&b.lines.length>1?!0:!1,itemStyle:{color:"#999"}},credits:{enabled:!1},tooltip:{valueSuffix:b.valuesuffix?" "+b.valuesuffix:"",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%Y-%b.%e",week:"%Y-%b.%e %A",month:"%Y-%B",year:"%Y"},shared:!0},plotOptions:{line:{lineWidth:2,states:{hover:{lineWidth:2}},marker:{enabled:!1}}},navigation:{menuItemStyle:{fontSize:"10px"}}},series:b.lines?b.lines:[]}},this.getRSLineConfig=function(a,b,c){return{title:{text:a.title,style:{color:"#DDD"}},subtitle:{text:a.subtitle,style:{color:"#DDD"}},options:{chart:{type:"line",backgroundColor:"#484C52",height:c?c:300},xAxis:{type:"datetime",gridLineWidth:1,gridLineColor:"#666",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%b.%e",week:"%b.%e %A",month:"%Y-%B",year:"%Y"},labels:{style:{color:"#DDD"}}},yAxis:{title:{text:a.yaxis,style:{color:"#DDD"}},max:b?b:null,min:0,gridLineWidth:1,gridLineColor:"#666",labels:{style:{color:"#DDD"}}},tooltip:{valueSuffix:" "+a.valuesuffix,dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%Y-%b.%e",week:"%Y-%b.%e %A",month:"%Y-%B",year:"%Y"},shared:!0},legend:{itemStyle:{color:"#DDD"}},plotOptions:{line:{color:"#F9802D",lineWidth:2,states:{hover:{lineWidth:2}},marker:{enabled:!1},pointInterval:a.pointinterval,pointStart:a.starttimeutc}},navigation:{menuItemStyle:{fontSize:"10px"}}},series:a.lines?a.lines:[]}},this.getTop10Config=function(a,b){return{title:{text:a.title,style:{color:"#DDD"}},subtitle:{text:a.subtitle,style:{color:"#DDD"}},options:{chart:{type:"bar",backgroundColor:"#484C52",height:b?b:300},xAxis:{max:a.tops?a.tops.length-1:null,categories:a.tops?a.tops:[],type:"category",title:{text:null},gridLineWidth:1,gridLineColor:"#666",labels:{style:{color:"#DDD"}}},yAxis:{min:0,title:{text:a.valuesuffix,style:{color:"#DDD"}},gridLineWidth:1,gridLineColor:"#666",labels:{overflow:"justify",style:{color:"#DDD"}}},legend:{enabled:!1},plotOptions:{bar:{dataLabels:{enabled:!0,allowOverlap:!0}}}},series:[{name:"交易量",color:"#4D7EB7",borderWidth:0,dataLabels:{y:1,color:"#DDD"},data:a.columns?a.columns:[]}]}},this.getFutureConfig=function(a,b,c){return{title:{text:a.title,style:{color:"#999"}},options:{chart:{type:"spline",backgroundColor:"#484C52",height:c?c:300},xAxis:{type:"datetime",gridLineWidth:1,gridLineColor:"#666",dateTimeLabelFormats:{day:"%b.%e",month:"%B"},labels:{style:{color:"#999"}}},yAxis:{title:{text:a.yAxis,style:{color:"#999"}},min:0,max:b?b:null,gridLineWidth:1,gridLineColor:"#666",labels:{style:{color:"#FFF"}}},legend:{itemStyle:{color:"#999"}},tooltip:{valueSuffix:" "+a.valuesuffix,dateTimeLabelFormats:{hour:"%b%e日",day:"%b%e日"},shared:!0},plotOptions:{spline:{color:"#F9802D",lineWidth:1,marker:{enabled:!1},pointInterval:6048e5,pointStart:14515776e5}},navigation:{menuItemStyle:{fontSize:"10px"}}},series:a.lines}},this.getColumnConfig=function(b,c){return{title:{text:b.title,style:{color:"#999"}},subtitle:{text:b.subtitle,style:{color:"#999"}},options:{chart:{type:1==b.chart_type?"column":"bar",backgroundColor:"#484C52",height:c?c:null},xAxis:{title:{text:b.xAxis_name?b.xAxis_name:null,style:{color:2==b.chart_type?"#FFF":"#999"},x:1==b.chart_type?-35:null},type:b.xAxis_type&&5==b.xAxis_type?"datetime":"category",gridLineWidth:1,gridLineColor:"#666",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%b.%e",week:"%b.%e %A",month:"%Y-%B",year:"%Y"},labels:{style:{color:2==b.chart_type?"#FFF":"#999"},formatter:function(){return b.xAxis_type&&5==b.xAxis_type?void 0:a(b.columns,this.value)}}},yAxis:{title:{text:b.yAxis_name?b.yAxis_name:null,style:{color:1==b.chart_type?"#FFF":"#999"}},min:0,gridLineWidth:1,gridLineColor:"#666",labels:{style:{color:1==b.chart_type?"#FFF":"#999"}}},legend:{enabled:!1},tooltip:{valueSuffix:b.valuesuffix?" "+b.valuesuffix:"",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%Y-%b.%e",week:"%Y-%b.%e %A",month:"%Y-%B",year:"%Y"},shared:!0},credits:{enabled:!1},plotOptions:{series:{borderWidth:0,color:"#4D7EB7"},bar:{dataLabels:{enabled:!0,allowOverlap:!0,y:1,color:"#DDD"}},column:{dataLabels:{enabled:!0,allowOverlap:!0,y:1,color:"#DDD"}}}},series:b.columns?b.columns:[]}},this.getBarConfig=function(a){return{options:{chart:{type:"bar",backgroundColor:"#091118",borderColor:""},plotOptions:{series:{stacking:"normal",maxPointWidth:15,borderColor:""}},legend:{enabled:!1,borderColor:""},yAxis:{allowDecimals:!1,title:{text:"发布数量"},lineColor:"#141F2B",gridLineColor:"#141F2B"},xAxis:{categories:a.categories,min:0,max:a.categories.length>50?35:null,labels:{step:1,staggerLines:a.categories.length>50?2:1}},scrollbar:{enabled:a.categories.length>50,barBackgroundColor:"#434b55",barBorderColor:"#434b55",buttonArrowColor:"",buttonBackgroundColor:"#091118",buttonBorderColor:"#091118",trackBackgroundColor:"#091118",trackBorderColor:"#091118"}},series:[{name:"失败",color:"#F85b27",data:a.fail,id:"series-0"},{name:"成功",color:"#333861",data:a.success,id:"series-1"}],title:{text:""},credits:{enabled:!1},loading:!1}},this.getCircularPieConfig=function(a,b,c){return{title:{text:a.title,verticalAlign:"middle",y:8,style:{fontSize:"20px",fontWeight:"bold",color:a.color}},options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",spacing:[0,0,0,0],margin:[0,0,0,0],height:c?c:null,width:b?b:null,backgroundColor:null},tooltip:{enabled:!1},credits:{enabled:!1},plotOptions:{series:{animation:!1,states:{hover:{enabled:!1}}},pie:{borderColor:null,innerSize:"75%",dataLabels:{enabled:!1}}}},series:[{name:a.name?a.name:"",data:a.dataList?a.dataList:[]}]}},this.getSplitPieConfig=function(a,b,c,d){return{title:{text:a.title,verticalAlign:"middle",y:7,style:{fontSize:"12px",color:a.color}},options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",spacing:[0,0,0,0],margin:[0,0,0,0],height:c?c:null,width:b?b:null,backgroundColor:null},tooltip:{enabled:!1},credits:{enabled:!1},plotOptions:{series:{animation:d?d:!1,states:{hover:{enabled:d?d:!1}}},pie:{borderColor:a.split_color?a.split_color:"",borderWidth:a.border_width?a.border_width:null,innerSize:a.inner_size?a.inner_size:"67%",dataLabels:{enabled:!1}}}},series:[{name:a.name?a.name:"",data:a.dataList?a.dataList:[]}]}},this.getActivityConfig=function(a,b,c){return{title:{text:a.title?a.title:"",y:4,verticalAlign:"middle",style:{fontSize:"12px",color:a.color?a.color:""}},options:{chart:{type:"solidgauge",height:c?c:null,width:b?b:null,spacing:[0,0,0,0],margin:[0,0,0,0],backgroundColor:null},tooltip:{enabled:!1,borderWidth:0,backgroundColor:"none",shadow:!1,style:{fontSize:"16px"},pointFormat:'{series.name}<br><span style="font-size:2em; color: {point.color}; font-weight: bold">{point.y}%</span>'},credits:{enabled:!1},pane:{startAngle:0,endAngle:360,background:[{outerRadius:"100%",innerRadius:"96%",backgroundColor:a.color?a.color:null,borderWidth:0}]},yAxis:{min:0,max:100,lineWidth:0,tickPositions:[]},plotOptions:{solidgauge:{borderWidth:"4px",dataLabels:{enabled:!1},linecap:"round",stickyTracking:!1,animation:!1}}},series:[{name:"",borderColor:a.color?a.color:null,data:[{color:null,radius:"100%",innerRadius:"100%",y:a.percentage?a.percentage:0}]}]}},this.getLogColumnConfig=function(a,b){return{title:{text:a.title,style:{color:"#d2f1fe"}},subtitle:{text:a.subtitle,style:{color:"#d2f1fe"}},options:{chart:{type:0==a.chart_type?"line":"column",backgroundColor:"#2b3b53",borderColor:null,height:b?b:null},xAxis:{type:"category",categories:a.units?a.units:[],gridLineWidth:1,gridLineColor:"#172230",labels:{style:{color:(1==a.chart_type,"#ddd")}},title:{text:a.xAxis_name?a.xAxis_name:null,style:{color:"#FFF"},x:1==a.chart_type?-35:null}},yAxis:{title:{text:a.yAxis_name?a.yAxis_name:null,style:{color:(1==a.chart_type,"#d2f1fe")}},min:0,gridLineWidth:1,gridLineColor:"#172230",lineColor:"#172230",labels:{style:{color:(1==a.chart_type,"#ddd")}}},legend:{enabled:!1},tooltip:{valueSuffix:a.valuesuffix?" "+a.valuesuffix:"",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%Y-%b.%e",week:"%Y-%b.%e %A",month:"%Y-%B",year:"%Y"},shared:!0},credits:{enabled:!1},plotOptions:{series:{borderWidth:0,color:"#4D7EB7"},bar:{dataLabels:{enabled:!0,allowOverlap:!0,y:1,color:"#d2f1fe"}},column:{dataLabels:{enabled:!0,allowOverlap:!0,y:1,color:"#d2f1fe"}}}},series:a.columns?a.columns:[]}},this.getFlowColumnConfig=function(a,b){return{title:{text:a.title,style:{color:"#d2f1fe"}},options:{chart:{type:"column",backgroundColor:"#091016",height:b?b:null},xAxis:{title:{text:a.xAxis_name?a.xAxis_name:null,style:{color:"#FFF"},x:-35},type:"category",tickColor:"#396770",lineColor:"#396770",gridLineWidth:1,gridLineColor:"#396770",labels:{style:{color:"#d2f1fe"}}},yAxis:{title:{text:a.yAxis_name?a.yAxis_name:null,style:{color:"#d2f1fe"}},min:0,gridLineWidth:1,gridLineColor:"#396770",labels:{style:{color:"#d2f1fe"}}},legend:{enabled:!1},tooltip:{tooltip:{headerFormat:"{series.name}<br>",pointFormat:"{point.name}: <b>{point.y} 笔</b>"},dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:00",day:"%Y-%b.%e",week:"%Y-%b.%e %A",month:"%Y-%B",year:"%Y"},shared:!0},credits:{enabled:!1},plotOptions:{series:{borderWidth:0,color:"#4D7EB7",maxPointWidth:70},column:{dataLabels:{enabled:!0,allowOverlap:!0,y:1,color:"#d2f1fe",style:{textOutline:null}}}}},series:a.columns?a.columns:[]}},this.getFlowPieConfig=function(a,b){return{title:{text:a.title,style:{color:"#d2f1fe"}},options:{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",height:b?b:null,backgroundColor:"#091016"},tooltip:{headerFormat:"{series.name}<br>",pointFormat:"{point.name}: <b>{point.y} 笔</b>"},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.y} 笔",color:"#d2f1fe"}}}},series:[{name:a.name,data:a.data}]}}});var configSrv=angular.module("ConfigService",[]);configSrv.service("config",function(){this.buildTblConfigCol=function(a,b,c){return['<div class="tbl_config">','<div class="tbl-config-menu">','<div class="pp" style="width: '+(c||220)+'px;right:-362px;">',a,"</div>","</div>",'<div class="tbl-config-cls">',b%2==0?'<div class="cog" name="'+b+'" style="background-color: #FFF; cursor: pointer;">':'<div class="cog" name="'+b+'" style="background-color: #F6F7FC; cursor: pointer;">','<i class="glyphicon glyphicon-cog" style="cursor: pointer;"></i>',"</div>","</div>","</div>"].join("")},this.getProjTblConfigCol=function(a,b,c){var d,e;d="proj_info",e="proj_list";var f=['<a class="search" title="查看项目" href=#/pro_proj_detail/'+b.project_name+"/"+b.business_sys_name+"/"+d+"/"+e+">",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>",b.project_status>2?"":' | <a class="tasks" title="修改项目信息" href=#/edit_proj/'+b.project_short_name+"/"+b.business_sys_name+"/"+b.project_name+'><i class="glyphicon glyphicon-edit"></i> 修改 </a> ',b.project_status>2?"":'| <a class="trash" title="删除项目" href="javascript:void(0)" id='+b.project_name+" value="+b.business_sys_name+'><i class="glyphicon glyphicon-trash"></i> 删除 </a>'].join("");return this.buildTblConfigCol(f,c)},this.getHistoryProjTblConfigCol=function(a,b,c){var d,e;d="proj_info",e="his_proj_list";var f='<a class="search" title="查看项目" href=#/his_proj_detail/'+b.project_name+"/"+b.business_sys_name+"/"+d+"/"+e+'><i class="glyphicon glyphicon-search"></i> 查看 </a>';return 2==b.register_flag&&b.project_status<3&&(f+='  |  <a class="reply" title="重启项目" style="cursor: pointer;" id='+b.project_name+"|"+b.business_sys_name+"|"+b.project_short_name+'><i  class="fa fa-reply-all"></i> 重启 </a>'),2==b.register_flag&&3==b.project_status&&(f+='  |  <a class="end" title="结束项目" href=#/finish_proj/'+b.project_short_name+"/"+b.business_sys_name+"/"+b.project_name+'><i  class="glyphicon glyphicon-off"></i> 结束 </a>'),this.buildTblConfigCol(f,c)},this.getProjReadyTblConfigCol=function(a,b,c){var d="ready_info",e=['<a class="search" title="查看准备信息" href=#/pre_proj_detail/'+b.project_name+"/"+b.business_sys_name+"/"+d+"/pre_proj>",'<i class="glyphicon glyphicon-search"></i>'," 查看",'</a>   |  <a class="search" title="发布准备" href=#/prod_pre_new_detail/'+b.project_short_name+"/"+b.project_name+"/"+b.business_sys_name+">",'<i class="fa fa-ellipsis-h"></i>'," 准备 ","</a>"].join("");return this.buildTblConfigCol(e,c)},this.getprojexecTblConfigCol=function(a,b,c){var d="prod_info",e="";return e+='<a class="see" href=#/pre_exec_proj_detail/'+b.project_name+"/"+b.business_sys_name+"/"+d+'/pre_exec title="查看发布步骤"><i class="glyphicon glyphicon-search"></i> 查看 </a>',b.project_status<=3?e+='  |  <a class="exec" style="cursor: pointer;" id='+b.project_name+"|"+b.business_sys_name+"|"+b.project_short_name+"|"+b.cmd_error_flag+"|"+b.auto_yn_flag+"|"+b.project_status+' title="执行项目发布"><i class="glyphicon glyphicon-play"></i> 执行</a>':2==b.project_rollback&&(e+='  |  <a class="see" href=#/prod_exec_rollback/'+b.project_short_name+"/"+b.project_name+"/"+b.business_sys_name+"/"+b.project_status+' title="发布回退"><i class="fa fa-undo"></i> 回退</a>'),b.prod_flag||(e+='  |  <a class="reply" style="cursor: pointer;" id='+b.project_name+"|"+b.business_sys_name+"|"+b.project_short_name+' title="重置"><i  class="fa fa-reply-all"></i> 重置 </a>'),this.buildTblConfigCol(e,c)},this.getTblConfigCol=function(a,b,c){var d="prod_info",e='<a class="see" title="查看项目" href=#/his_pre_proj_detail/'+b.project_name+"/"+b.business_sys_name+"/"+d+'/his_pre_exec><i class="glyphicon glyphicon-search"></i> 查看 </a>';return this.buildTblConfigCol(e,c)},this.getHistoryprojplanTblConfigCol=function(a,b,c){var d="plan_info",e=['<a class="search" title="查看项目" href=#/his_plan_proj_detail/'+b.project_name+"/"+b.business_sys_name+"/"+d+"/his_plan>",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>"].join("");return this.buildTblConfigCol(e,c)},this.getprojplanTblConfigCol=function(a,b,c,d,e){var f,g="plan_info";return 0==e?(f='<a class="search" title="查看编列信息" href=#/plan_proj_detail/'+b.project_name+"/"+b.business_sys_name+"/"+g+'/plan_detail><i class="glyphicon glyphicon-search"></i> 查看 </a>',b.project_status<3&&(f+=1==b.planset_type?'  |  <a title="编列计划" class="edit"    href="javascript:void(0)" id='+b.project_name+"|"+b.business_sys_name+'><i class="glyphicon glyphicon-edit"></i> 编列计划</a>':'  |  <a title="编列计划" class="listalt" href="javascript:void(0)" id='+b.project_name+"|"+b.business_sys_name+'><i class="glyphicon glyphicon-list-alt"></i> 编列计划</a>')):f=1==e?'<a class="search" title="查看编列信息" href=#/plan_pre_detail/'+b.project_name+"/"+b.business_sys_name+"/"+g+'/plan_pre_detail><i class="glyphicon glyphicon-search"></i> 查看 </a>':'<a class="search" title="查看编列信息" href=#/plan_group_detail/'+b.project_name+"/"+b.business_sys_name+"/"+g+'/plan_group_detail><i class="glyphicon glyphicon-search"></i> 查看 </a>',this.buildTblConfigCol(f,c)},this.getBusiSysTblConfigCol=function(a,b,c){var d=['<a class="edit" title="修改系统" href=#/edit_busi_sys/'+b.business_cn_name+"/"+b.business_sys_name+">",'<i class="glyphicon glyphicon-edit"></i>'," 修改 ","</a>| ",'<a class="tasks" title="配置系统目录/节点/模板/参数等" href=#/config_busi_sys/'+b.business_sys_name+"/node>",'<i class="fa fa-wrench"></i>'," 配置 ","</a>| ",'<a class="trash" title="删除系统" href="javascript:void(0)" id='+b.business_sys_name+">",'<i class="glyphicon glyphicon-trash"></i>'," 删除","</a>"].join("");return this.buildTblConfigCol(d,c,250)},this.getTemplateTblConfigCol=function(a,b,c){if(1==b.template_formate)var d=['<a title="查看" class="search"  href=#/template_detail/'+b.template_name+">",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>| ",'<a title="修改" class="edit"  href=#/template_modify/'+b.template_name+">",'<i class="glyphicon glyphicon-edit"></i>'," 修改 ","</a>| ",'<a title="删除" class="trash"  href="javascript:void(0)" id='+b.template_name+">",'<i class="glyphicon glyphicon-trash"></i>'," 删除","</a>"].join("");else var d=['<a title="查看" class="search"  href=#/tmpl_detail/'+b.template_name+">",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>| ",'<a title="修改" class="edit"  href=#/edit_tmpl/'+b.template_name+">",'<i class="glyphicon glyphicon-edit"></i>'," 修改 ","</a>| ",'<a title="删除" class="trash"  href="javascript:void(0)" id='+b.template_name+">",'<i class="glyphicon glyphicon-trash"></i>'," 删除","</a>"].join("");return this.buildTblConfigCol(d,c,200)},this.getmg_PageTblConfigCol=function(a,b,c){var d=["<a class='search' title='查看消息' href='#/mes_detail/"+b.work_seq+"'>",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>| ",'<a class="trash" title="删除消息" href="javascript:void(0)" id='+b.work_seq+">",'<i class="glyphicon glyphicon-trash"></i>'," 删除","</a>"].join("");return this.buildTblConfigCol(d,c)},this.getMineTblConfigCol=function(a,b,c){var d=[1==b.workflow_state||3==b.workflow_state?' <a class="search" title="查看" href=#/task_check_mine/'+b.pend_work_seq+"/"+b.workflow_state+'><i class="glyphicon glyphicon-search"></i> 查看 </a> ':'<a class="search" title="处理" href=#/task_handle/'+b.pend_work_seq+"/"+b.workflow_state+'><i class="glyphicon glyphicon-edit"></i> 处理 </a>',"</a>"].join("");return this.buildTblConfigCol(d,c)},this.gettaskeViewTblConfigCol=function(a,b,c){var d=[0==b.unhandle?'<a class="search" title="复核" href=#/task_examine_view/'+b.pend_work_seq+"/"+b.workflow_state+'><i class="glyphicon glyphicon-edit"></i> 复核 </a> ':' <a class="search" title="查看" href=#/task_check_view/'+b.pend_work_seq+"/"+b.workflow_state+'><i class="glyphicon glyphicon-search"></i> 查看 </a> ',"</a>"].join("");return this.buildTblConfigCol(d,c)},this.gettaskAuthTblConfigCol=function(a,b,c){var d=[0==b.unhandle?'<a class="search" title="授权" href=#/task_examine_auth/'+b.pend_work_seq+"/"+b.workflow_state+'><i class="glyphicon glyphicon-edit"></i> 授权 </a> ':'<a class="search" title="查看" href=#/task_check_auth/'+b.pend_work_seq+"/"+b.workflow_state+'><i class="glyphicon glyphicon-search"></i> 查看 </a> ',"</a>"].join("");return this.buildTblConfigCol(d,c)},this.gettaskTroubleTblConfigCol=function(a,b,c){var d=['<a class="search" title="查看" href=#/trouble_ticket_task/'+b.pg_work_seq+'><i class="glyphicon glyphicon-search"></i>'+(4==b.pgwork_status||5==b.pgwork_status?"查看":"处理")+" </a> "].join("");return this.buildTblConfigCol(d,c)},this.gettaskHTblConfigCol=function(a,b,c,d){var e=[1==d?'<a class="search" title="查看任务" href=#/his_task_check_mine/'+b.pend_work_seq+"/"+b.workflow_state+">":2==d?'<a class="search" title="查看任务" href=#/his_task_check_view/'+b.pend_work_seq+"/"+b.workflow_state+">":'<a class="search" title="查看任务" href=#/his_task_check_auth/'+b.pend_work_seq+"/"+b.workflow_state+">",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>"].join("");return this.buildTblConfigCol(e,c)},this.rebuildContactsList=function(a){for(var b=[],c=0;5>c;c++){for(var d=[],e=0;4>e;e++)a[4*c+e]&&d.push(a[4*c+e]);b.push(d)}return b},this.getPromgramConfigCol=function(a,b,c){
return 2==b.pg_yn_flag?['<div class="tbl_config" style="width: 100px;">','<i  title="不可使用" style="font-size: 12px;color:#CCC;margin-top: 6px;cursor: pointer;font-style:normal;">不可使用</i>',"</div>"].join(""):['<div class="tbl_config" style="width: 100px;">','<i class="fa fa-edit user" title="使用" style="font-size: 14px;margin-top: 6px;cursor: pointer;"></i>',,1==b.pg_source||3==b.pg_source?'<i style="font-size: 14px;margin-left:20px;cursor: pointer;" title="预览" class="fa fa-eye preview"></i>':'<i style="font-size: 14px;margin-left:20px;cursor: pointer;" title="下载" class="fa fa-download download"></i>',"</div>"].join("")},this.getCmptListTblConfigCol=function(a,b,c){var d=1,e=-1!=b.module_purposes.indexOf(2)?!1:!0,f=['<a title="删除" class="trash"  href="javascript:void(0)"><i class="fa fa-trash-o"></i> 删除</a> | ',2!=b.publish_state&&b.publish_state?"":'<a title="发布" class="publish"  href="javascript:void(0)"><i class="fa fa-check"></i> 发布</a> | ',e?'<a title="测试" class="test" href=#/cmpt_test/'+b.id+"/"+b.cn_name+"/"+d+'><i class="fa fa-map-marker"></i> 测试</a> | ':"",'<a title="修改" class="edit" href=#/edit_cmpt/'+b.id+'><i class="fa fa-pencil-square-o"></i> 修改</a> | ','<a title="查看" class="search" href=#/detail_cmpt/'+b.id+'><i class="fa fa-search"></i> 查看</a>'].join("");return this.buildTblConfigCol(f,c,310)},this.getCmptsListTblConfigCol=function(a,b,c){var d=2;if(2!=b.publish_state&&b.publish_state)var e=['<a title="删除" class="trash"  href="javascript:void(0)"><i class="fa fa-trash-o"></i> 删除</a> | ','<a title="测试" class="test" href=#/cmpts_test/'+b.id+"/"+b.cn_name+"/"+d+'><i class="fa fa-map-marker"></i> 测试</a> | ','<a title="修改" class="edit" href=#/edit_cmpts/'+b.id+'><i class="fa fa-pencil-square-o"></i> 修改</a> | ','<a title="查看" class="search" href=#/detail_cmpts/'+b.id+'><i class="fa fa-search"></i> 查看</a>'].join("");else var e=['<a title="删除" class="trash"  href="javascript:void(0)"><i class="fa fa-trash-o"></i> 删除</a> | ','<a title="发布" class="publish"  href="javascript:void(0)"><i class="fa fa-check"></i> 发布</a> | ','<a title="测试" class="test" href=#/cmpts_test/'+b.id+"/"+b.cn_name+"/"+d+'><i class="fa fa-map-marker"></i>测试</a> | ','<a title="修改" class="edit" href=#/edit_cmpts/'+b.id+'><i class="fa fa-pencil-square-o"></i> 修改</a> | ','<a title="查看" class="search" href=#/detail_cmpts/'+b.id+'><i class="fa fa-search"></i> 查看</a>'].join("");return this.buildTblConfigCol(e,c,310)},this.getMyTaskTblConfigCol=function(a,b,c,d){var e="";if("running"==d){var f=['<a class="close_stop" title="停止" href="javascript:void(0)"><i class="glyphicon glyphicon-record"></i> 停止 </a>',' <a title="删除" class="trash"  href="javascript:void(0)"><i class="glyphicon glyphicon-trash"></i> 删除 </a>',' <a class="search" title="监控" href=#/cj_pend_task_watch/'+b.work_id+'><i class="fa fa-eye"></i> 监控 </a>',' <a class="monitor" title="查看" href=#/cj_run_task_detail/'+b.work_id+'><i class="glyphicon glyphicon-search"></i> 查看 </a> '].join("|");return this.buildTblConfigCol(f,c,250)}if("automatic"==d){var g=['<a class="search" title="查看" href=#/cj_pend_task_detail/'+b.work_id+'><i class="glyphicon glyphicon-search"></i> 查看 </a>'].join("|"),h=' | <a class="delete" title="删除" href="javascript:void(0)"><i class="glyphicon glyphicon-trash"></i> 删除 </a> ',i=' | <a class="search" title="监控" href=#/cj_pend_task_watch/'+b.work_id+'><i class="fa fa-eye"></i> 监控 </a>';return 0==b.status||1==b.status?e=g+i:(2==b.status||3==b.status||4==b.status)&&(e=g+h),this.buildTblConfigCol(e,c)}var e=['<a class="search" title="查看" href=#/edit_workorder/'+b.order_seq+'><i class="glyphicon glyphicon-search"></i> 查看 </a>'].join("|");return this.buildTblConfigCol(e,c)},this.getFangAnTblConfigCol=function(a,b,c){var d,e=['<a class="trash" title="删除" href="javascript:void(0)"><i class="glyphicon glyphicon-trash"></i> 删除 </a>| ','<a class="edit" title="修改" href=#/edit_cjprog/'+b.prog_id+'><i class="glyphicon glyphicon-edit"></i> 修改 </a>| ','<a class="search" title="查看" href=#/detail_cj_prog/'+b.prog_id+'><i class="glyphicon glyphicon-search"></i> 查看 </a>'].join(""),f='<a class="publish" title="发布" href="javascript:void(0)">|<i  class="fa fa-check"></i> 发布 </a>';return d=2==b.publish_state?e+f:e,this.buildTblConfigCol(d,c,250)},this.getDataBaseTblConfigCol=function(a,b,c){var d=['<a class="trash" title="删除" href="javascript:void(0)"><i class="glyphicon glyphicon-trash"></i> 删除 </a>| ','<a class="edit" title="导入" href=#/edit_xjdatabase/'+b.data_name+'><i class="glyphicon glyphicon-edit"></i> 导入 </a>| ','<a class="search" title="查看" href=#/xjdatabase_detail/'+b.data_name+'><i class="glyphicon glyphicon-search"></i> 查看 </a>'].join("");return this.buildTblConfigCol(d,c,250)},this.getXjTaskTblConfigCol=function(a,b,c){var d=[1==b.intask_status||5==b.intask_status?'<a class="trash" title="删除" href="javascript:void(0)"><i class="fa fa-trash-o"></i> 删除 </a>| ':"",'<a class="search" title="查看" href=#/new_detail_xjtask/'+b.work_id+'><i class="fa fa-search"></i> 查看 </a>'].join("");return this.buildTblConfigCol(d,c,250)},this.getXjReprotTblConfigCol=function(a,b,c){var d=['<a class="trash" title="删除" href="javascript:void(0)"><i class="glyphicon glyphicon-trash"></i> 删除 </a>| ','<a class="search" title="查看" href="javascript:void(0)"><i class="glyphicon glyphicon-search"></i> 查看 </a>| ','<a class="export" title="导出" href="javascript:void(0)"><i class="glyphicon glyphicon-new-window"></i> 导出 </a>'].join("");return this.buildTblConfigCol(d,c,250)},this.getIndexModuleTblConfigCol=function(a,b,c){var d=['<a class="trash" title="删除" href="javascript:void(0)"><i class="glyphicon glyphicon-trash"></i> 删除 </a>| ','<a class="edit" title="修改" href=#/edit_indexmodule/'+b.index_module_name+"/"+c+'><i class="glyphicon glyphicon-edit"></i> 修改 </a>| ','<a class="search" title="查看" href=#/index_module_detail/'+b.index_module_name+"/"+c+'><i class="glyphicon glyphicon-search"></i> 查看 </a>'].join("");return this.buildTblConfigCol(d,c,250)},this.getPluginTblConfigCol=function(a,b,c){var d=['<a class="edit" title="修改运行环境" href="javascript:void(0)">','<i class="glyphicon glyphicon-edit"></i>'," 修改 ","</a>| ",'<a class="trash" title="删除运行环境" href="javascript:void(0)">','<i class="glyphicon glyphicon-trash"></i>'," 删除","</a>"].join("");return this.buildTblConfigCol(d,c,150)},this.getywTaskTblConfigCol=function(a,b,c){var d=[];return d=2==b.sddispatch_type?['<a class="search" title="查看" href=#/yw_task_exec/'+b.sdtask_id+">",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>"].join(""):['<a class="search" title="查看" href=#/yw_task_detail/'+b.sdtask_id+">",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>| ",'<a class="search" title="执行" href=#/yw_task_exec/'+b.sdtask_id+">",'<i class="glyphicon glyphicon-play"></i>'," 执行 ","</a>"].join(""),this.buildTblConfigCol(d,c)},this.getywHisTaskTblConfigCol=function(a,b,c){var d=['<a class="search" title="查看" href=#/yw_task_detail/'+b.sdtask_id+">",'<i class="glyphicon glyphicon-search"></i>'," 查看 ","</a>"].join("");return this.buildTblConfigCol(d,c)}}),configSrv.service("DirNodeShare",function(){this.reBuildDirNodeShareData=function(a,b,c){for(var d=[],e=0;e<b.length;e++){for(var f=[],g=b[e],h=0;h<c.length;h++){var i=c[h];1==g.dirshare_type?f.push({node_soc_ip:i.node_soc_ip,share_flag:1}):3==g.dirshare_type?f.push({node_soc_ip:i.node_soc_ip,share_flag:2}):f.push({node_soc_ip:i.node_soc_ip,share_flag:function(a,b,c){for(var d=2,e=0;e<c.length;e++){var f=c[e];if(f.dir_id==a)for(var g=f.list_dirnode?f.list_dirnode:[],h=0;h<g.length;h++){var i=g[h];if(i.node_soc_ip==b){d=i.share_flag;break}}}return d}(g.dir_id,i.node_soc_ip,a)})}d.push({dir_id:g.dir_id,dir_cn_name:g.bk_dir,dirshare_type:g.dirshare_type,list_dirnode:f})}return d}}),configSrv.service("Col_Fmt",["ProjState","ProjGroupColor","WorkorderType","WoStatusType","IML_TYPE","PublishState","CmptType","intaskState","coTaskState","TaskState","FlowType","OpTaskExeStatus","StrategyGroupType","pluginType","uploadType","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.px100Fmt=function(a){return a?"<div title="+a+' style="min-height: 24px; width: 100px;word-break:break-all;">'+a+"</span>":'<div title="未定义！" style="min-height: 24px; width: 100px;">--</div>'},this.px130Fmt=function(a){return a?"<div title="+a+' style="min-height: 24px; width:130px;word-break:break-all;">'+a+"</div>":'<div title="未定义！" style="min-height: 24px; width:130px;">--</div>'},this.px140Fmt=function(a){return"<div title="+a+' style="width:140px; min-height: 24px;word-break:break-all;">'+a+"</div>"},this.px160Fmt=function(a){return"<div title="+a+' style="width:160px; min-height: 24px;word-break: break-all; ">'+a+"</div>"},this.px170Fmt=function(a){return a?"<div title="+a+' style="min-height: 24px; width: 170px;word-break:break-all;">'+a+"</div>":'<div title="未定义！" style="min-height: 24px; width: 170px;">--</div>'},this.px250Fmt=function(a){return"<div title="+a+' style="min-height: 24px; width:250px;word-break:break-all;">'+a+"</div>"},this.percent80Fmt=function(a){return"<div title="+a+' style="min-height: 24px; width:80%;word-break:break-all;">'+a+"</div>"},this.andCnName=function(a,b){return a?"<span title="+b.business_cn_name+' style="width:160px;">'+b.business_cn_name+"</span>":'<span style="width:160px;">&nbsp;&nbsp;<span style="color: #999;">系统不存在！</span></span>'},this.padding20Fmt=function(a,b,c){return a?"<div title="+a+' style="word-break: break-all; ">'+a+"</div>":'<div title="未定义！" style="color: #999">--</div>'},this.dataTimeFmt=function(a,b,c){return"<div title="+a+' style="word-break: break-all;">'+b.create_bk_date+" "+b.create_bk_time+"</div>"},this.isConfigAgent=function(a,b,c){return 3==a?'<div><span style="display: inline-block" class="status-img status-img-succ"></div>':'<div title="未定义！" style=" color: #999">--</div>'},this.noZeroFmt=function(a){return 0==a?"":a},this.downListFmt=function(a){for(var b="",c=0;c<a.length;c++)b=b+'<span class="download_text"><a class="'+c+'" style="cursor: pointer;color: #44dcfd;word-break:break-all;">'+a[c]+"</a></span> ";return b},this.downOneFmt=function(a){return'<span class="download_text" style="padding:2px;"><a  style="cursor: pointer;color: #44dcfd;word-break:break-all;">'+a+"</a></span>"},this.projNatureFmt=function(a){return 1==a?"<span>例行发布</span>":2==a?"<span>紧急发布</span>":3==a?"<span>一般项目发布</span>":4==a?"<span>大型项目发布</span>":5==a?"<span>特大型项目发布</span>":void 0},this.projExecAutoFmt=function(a,b){return 1==b.auto_yn_flag?"<span><i class='fa fa-clock-o' style='font-size: 16px; color: #1D9C72;' title='定时自动执行'></i>"+b.start_bk_time+"</span>":"<span>"+b.start_bk_time+"</span>"},this.projStatusFmt=function(b,c){var d=p.findValue(b,a);return 1==b?1==c.register_flag?'<span">--</span>':'<div style="color:#FFF; width: 16px; height: 16px;display:inline-block; background: url(img/publish/new_img/pre_exe.png) no-repeat;background-size: 16px auto; margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":2==b?'<div style="color:#FFF; width: 16px; height: 16px;display:inline-block; background: url(img/publish/new_img/wait_exe.png) no-repeat; background-size: 16px auto;  margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":3==b?'<div  class="rotate-pub-list" style="color:#FFF; width: 16px; height: 16px;display:inline-block; background: url(img/publish/new_img/exec.png) no-repeat; background-size: 16px auto;  margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":4==b?'<div style="color:#FFF; width: 16px; height: 16px;display:inline-block; background-image: url(img/publish/new_img/exe_finish.png);background-repeat: no-repeat; background-size: 16px auto;   margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":5==b?'<div style="color:#FFF; width: 16px; height: 16px;display:inline-block; background-image: url(img/publish/new_img/hand_fail.png);background-repeat: no-repeat; background-size: 16px auto;  margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":6==b?'<div class="rotate-pub-list" style="color:#FFF; width: 16px; height: 16px;display:inline-block; background-image: url(img/publish/new_img/exec.png);background-repeat: no-repeat; background-size: 16px auto;  margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":7==b?'<div style="color:#FFF; width: 16px; height: 16px;display:inline-block; background-image: url(img/publish/new_img/back_suc.png);background-repeat: no-repeat; background-size: 16px auto;  margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":8==b?'<div style="color:#FFF; width: 16px; height: 16px;display:inline-block; background-image: url(img/publish/new_img/back_fail.png);background-repeat: no-repeat; background-size: 16px auto;  margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":9==b?'<div style="color:#FFF; width: 16px; height: 16px;display:inline-block; background-image: url(img/publish/new_img/wait_back.png);background-repeat: no-repeat; background-size: 16px auto;  margin: 0;margin-top:2px;"></div> <span style="display: inline-block;vertical-align: top;margin-top: 2px;">'+d+"</span>":"<span>无效状态</span>"},this.prodFlagFmt=function(a){return 1==a?'<div class="prod_list_status_img prod_success_position"></div>':2==a?'<div class="prod_list_status_img prod_fail_position"></div>':'<div style="width: 24px;padding-left: 6px; ">--</div>'},this.workOrderFlagFmt=function(a,b){return 2==b.urgency_level?'<div style=" width: 130px; word-break:break-all;color:#E9416E;cursor: default" title="紧急">'+a+"</div>":'<div style="width: 130px;word-break:break-all;cursor: default">'+a+"</div>"},this.workOrderFmt=function(a,b){return'<div style="word-break:break-all;cursor: default">'+a+"</div>"},this.workOrderTypeFmt=function(a,b){var d=p.findValue(a,c);return'<div style="cursor: default">'+d+"</div>"},this.workOrderStateFmt=function(a,b){var c=p.findValue(a,d);return'<div style="cursor: default">'+c+"</div>"},this.workOrderTimeFmt=function(a,b){var c=a.substring(0,a.length-3);return'<div style="word-break:break-all;width:120px;cursor: default">'+c+"</div>"},this.complete_FlagFmt=function(a){return a?"已完成":"未完成"},this.projectNameFmt=function(a,b){var c="";return b.quick_publish&&1==b.quick_publish&&(c='<span class="quick-project-icon" title="敏捷发布项目"></span>'),a?'<div style="white-space:nowrap;overflow: hidden;min-height: 24px;position: relative;padding-left: 15px;" title="'+a+'">'+c+a+"</div>":'<div  style="min-height: 24px;white-space:nowrap;overflow: hidden;color: #D2F1FE;">--</div>'},this.hideDetailFmt=function(a){return a?'<div style="white-space:nowrap;overflow: hidden;min-height: 24px;" title="'+a+'">'+a+"</div>":'<div  style="min-height: 24px;white-space:nowrap;overflow: hidden;color: #D2F1FE;">--</div>'},this.hideLogDetailFmt=function(a){var b="";return a?(b=a.replace(/null/g,"--"),'<div style="white-space:nowrap;overflow: hidden;min-height: 24px;" title="'+b+'">'+b+"</div>"):'<div title="日志已经被删除!" style="min-height: 24px;white-space:nowrap;overflow: hidden;color: #D2F1FE;">日志已经被删除</div>'},this.showDownMsg=function(a){return a?'<div style="white-space:nowrap;overflow: hidden;min-height: 24px;color:#D2F1FE;" title="'+a+'">'+a+"</div>":'<div title="下载成功" style="min-height: 24px;white-space:nowrap;overflow: hidden;color:#43FC8C;">下载成功</div>'},this.timeTypeFomat=function(a){var b="";return 0==a?b="日":1==a?b="周":2==a&&(b="月"),b},this.pubWindowStatusFmt=function(a,b){var c=1==b.window_status?"开启":"关闭";return"<span>"+c+"</span>"},this.pubWindowTypeFmt=function(a,b){var c=1==b.window_type?"例行窗口":"特殊窗口";return"<span>"+c+"</span>"},this.checkAllFmt=function(a){return'<input type="checkbox" name="cmpt_type" i-check  ng-model="value.choose"/>'},this.formByteToM=function(a){var b="";return 0==parseInt(a)?"0M":(parseInt(a)<1024?b=a+"b":1024<parseInt(a)&&(b=parseInt(a)<1048576?Math.floor(parseInt(a)/1024)+"kb":Math.floor(parseInt(a)/1048576)+"M"),b)},this.formByUploadType=function(a){var b=p.findValue(a,o);return a?'<div style="white-space:nowrap;overflow: hidden;min-height: 24px;" title="'+b+'">'+b+"</div>":'<div title="未定义！" style="min-height: 24px;white-space:nowrap;overflow: hidden;">--</div>'},this.flowEditFmt=function(a,b){return b.sddispatch_type?'<a class="edit_flow" style="white-space: nowrap; overflow: hidden; min-height: 24px; word-break: break-all; min-width: 84px;" href="javascript:void(0);" title="'+a+'">'+a+"</a>":void 0},this.programFmt=function(a,b){return a?2==b.pg_source?'<div style="white-space:nowrap;overflow: hidden;cursor: default;min-height: 24px;" title="'+a+'"><span style="display: inline-block; font-size: 12px; border: 1px solid red; border-radius: 4px; color: red; margin-right: 5px; padding: 0px 2px; width: 18px; height: 20px;line-height: 18px;">批</span>'+a+"</div>":3==b.pg_source?'<div style="white-space:nowrap;overflow: hidden;cursor: default;min-height: 24px;" title="'+a+'"><span style="display: inline-block; font-size: 12px; border: 1px solid red; border-radius: 4px; color: red; margin-right: 5px; padding: 0px 2px; width: 18px; height: 20px;line-height: 18px;">导</span>'+a+"</div>":'<div style="white-space:nowrap;overflow: hidden;cursor: default;min-height: 24px;" title="'+a+'">'+a+"</div>":'<div title="未定义！" style="min-height: 24px;white-space:nowrap;overflow: hidden;cursor: default;">--</div>'},this.hideContentFmt=function(a){return a?'<div style="white-space:nowrap;overflow: hidden;cursor: default;" title="'+a+'">'+a+"</div>":'<div title="未定义！" style=";white-space:nowrap;overflow: hidden;cursor: default;">--</div>'},this.programTimeFmt=function(a,b){var c=a.substring(0,a.length-3);return'<div style="word-break:break-all;width:120px;cursor: default">'+c+"</div>"},this.proBkTimeFmt=function(a,b){return'<div style="word-break:break-all;width:140px;">'+a+"&nbsp;<span>"+b.start_bk_time+"</span></div>"},this.groupFmt=function(a,b){},this.timeCDFormat=function(a,b){var c=new Date;if(b.project_status<3){var d=p.toDate(b.pro_bk_date+" "+b.start_bk_time);return c>=d?"--":1==b.auto_yn_flag?"<span><i class='fa fa-clock-o' style='font-size: 16px; color: #1D9C72;' title='定时自动执行'></i>"+p.dateCD(c,d)+"</span>":"<span>"+p.dateCD(c,d)+"</span>"}return"--"},this.planTimeFmt=function(a,b){return 1==b.planset_type||b.project_status>=3?1==b.auto_yn_flag?"<span><i class='fa fa-clock-o' style='font-size: 16px; color: #1D9C72;' title='定时自动执行'></i>"+b.start_bk_time+"</span>":b.start_bk_time:'<span style="color:#2AB1FF">待列入计划</span>'},this.executeUserFmt=function(a,b,c){var d="",e="";if(a){for(var f=a.split(","),g=0;g<f.length;g++)e+='<div class="node_list_hover_style" style="padding:5px 14px;word-break: break-all;">'+f[g]+"</div>";d=['<div style="position: relative">','<div  style="padding-left: 25px;">'+f[0]+"</div>",f.length<=1?"":'<div class="animate_active" style="position: absolute;top:0;left: 0px;color: #ddd"><i class="fa fa-users" style="vertical-align: middle;margin-left: 5px;"></i></div>','<div class="user_modal" style="position: absolute;color: #333; margin-top: -51px; margin-left: -134px; display: none;font-size: 12px;z-index: 9;">','<div style="position: absolute;top:24px;left: 120px;z-index: 10;width: 17px;height: 30px;transform:rotate(180deg);overflow: hidden;">','<div style="height: 17px;width: 17px; transform: rotate(30deg) skewX(-18deg) translateX(10px);position: absolute; left:0px;background-color: #fff;border: 1px solid #ebebeb;"></div>',"</div>",'<div style="border-radius: 5px;background-color: #fff;box-shadow: 1px 1px 6px #999;border: 1px solid #ebebeb;">','<div style="background-color: #f7f7f7;border-bottom: 1px solid #ebebeb;border-radius: 5px 5px 0 0;padding: 5px 14px;width: 120px;">执行人列表</div>',e,"</div>","</div>","</div>"]}else d=['<div title="未定义！" style="min-height: 24px; width: 120px;padding-left: 25px;">--</div>'];return d.join("")},this.majorBigProjFmt=function(a,b){var c="";return 5==b.project_nature&&(c='<i class="glyphicon glyphicon-flag" style="color:red;" title='+b.project_name+"></i>"),"<span title="+b.project_name+' style=" width:140px;">'+c+b.project_name+"</span>"},this.taskStatusFmt=function(a){return 1==a?"待复核":3==a?"待授权":5==a?"待执行":4==a?"授权拒绝":2==a?"复核拒绝":6==a?"执行完毕":7==a?"关闭任务":""},this.taskProgressFmt=function(a,b,c){for(var d=0,e=0,f=!0,g=b.work_detail_list.length,h=0;g>h;h++)1==b.work_detail_list[h].work_state&&(e+=1),2==b.work_detail_list[h].work_state&&(f=!1);var i='<div class="event" style="cursor:pointer;position:absolute;width:'+50*(g-1)+'px;margin-top: -18px;height: 36px;padding-top: 18px;">';i=i+'<div style="position:absolute;border:1px solid #CCCCCC;width:'+50*(g-1)+'px;"></div>';for(var h=1;e>=h;h++)d+=1,i=i+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: #0095A5;top:'+-(9*(d-1)+4)+"px;left:"+(50*(d-1)-4)+'px;"></div>';i=f?i+'<div style="position:relative;width:21px;height: 21px;border-radius: 100%;background-color:#0095A5;top:'+-(9*d+10+1)+"px;left:"+(50*d-10)+'px;cursor: pointer;"></div>':i+'<div style="position:relative;width:9px;height: 9px;border-radius: 100%;background-color:#F72B44;top:'+-(9*d+4)+"px;left:"+(50*d-4)+'px;cursor: pointer;"></div>';for(var j=1,k=0;g-e>j;j++)k+=1,i=f?i+'<div style="position:relative;width:13px;height: 13px;border-radius: 100%;background-color:white;border:1px solid #0095A5;top:'+-(9*d+21+6+13*(k-1))+"px;left:"+(50*(d+k)-6)+'px;"></div>':j==g-e-1?i+'<div style="position:relative;width:21px;height: 21px;border-radius: 100%;background-color:#0095A5;top:'+-(9*(d+k-1)+19)+"px;left:"+(50*(d+k)-10)+'px;"></div>':i+'<div style="position:relative;width:9px;height: 9px;border-radius: 100%;background-color:#CCCCCC;top:'+-(9*(d+k-1)+9+4)+"px;left:"+(50*(d+k)-4)+'px;"></div>';i+="</div>",i+='<div class="displayNone leave" style="color:#D2F1FE;z-index:10000;background-color: #091016;width: 450px;height:auto;position: absolute;right: 260px;margin-top:18px;padding:6px 0px;">';for(var l=1;g>=l;l++)i+='<div style="padding:2px 10px;">',i+='<span style="color:#d2f1fe;padding:8px;background-color:#253549;display:inline-block;width:160px;text-align:center;margin-left: 8px;">--</span>',i+='<span style="color:#d2f1fe;padding:8px;background-color:#253549;display:inline-block;width:220px;text-align:center;margin-left:4px;">--</span>',i+=e+1>l?'<div style="padding:8px;display:inline-block;width:30px;text-align:center;margin-left:4px;background: #253549 url(img/header/task_state1.png) no-repeat center;height: 39px;margin-bottom: -15px;"></div>':l==e+1?f?'<div style="padding:8px;display:inline-block;width:30px;text-align:center;margin-left:4px;background: #253549 url(img/header/task_state2.png) no-repeat center;height: 39px;margin-bottom: -15px;"></div>':'<div style="padding:8px;display:inline-block;width:30px;text-align:center;margin-left:4px;background: #253549 url(img/header/task_state3.png) no-repeat center;height: 39px;margin-bottom: -15px;"></div>':l!=g?'<span style="color:#d2f1fe; padding:8px;background-color:#253549;display:inline-block;width:30px;text-align:center;margin-left:4px;">--</span>':f?'<span style="color:#d2f1fe; padding:8px;background-color:#253549;display:inline-block;width:30px;text-align:center;margin-left:4px;">--</span>':'<div style="padding:8px;display:inline-block;width:30px;text-align:center;margin-left:4px;background: #253549 url(img/header/task_state2.png) no-repeat center;height: 36px;margin-bottom: -12px;"></div>',i+="</div>";return i+="</div>"},this.taskTroubleProgressFmt=function(a,b,c){var d=["#0095A5","#D6D6D6","#74D86A","#FF7A8A"],e="",f=[];switch(a){case 1:f=[d[0],d[0],d[2],d[1],d[1]],e="待授权";break;case 2:f=[d[0],d[0],d[3],d[1],d[1]],e="授权拒绝";break;case 3:f=[d[0],d[0],d[0],d[0],d[2]],e="待执行";break;case 4:f=[d[0],d[0],d[0],d[0],d[0]],e="执行完毕";break;case 5:f=[d[1],d[1],d[1],d[1],d[1]],e="关闭任务"}var g='<div class="event_state" title="'+e+'" style="cursor:pointer;position:absolute;width:120px;margin-top: -18px;height: 36px;padding-top: 7px;">';g=g+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: '+f[0]+';top:6px;left:-4px;"></div>';for(var h=0;3>h;h++)g=g+'<div style="position:relative;width:4px;height:4px;border-radius:100%;background-color: '+f[1]+";top:"+-4*h+"px;left:"+(10+9*h)+'px;"></div>';g=g+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: '+f[2]+';top:-15px;left:38px;"></div>';for(var h=0;3>h;h++)g=g+'<div style="position:relative;width:4px;height:4px;border-radius:100%;background-color: '+f[3]+";top:"+(-21-4*h)+"px;left:"+(52+9*h)+'px;"></div>';return g=g+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: '+f[4]+';top:-36px;left:80px;"></div>',g+="</div>",g+='<div class="displayNone leave_state" style="color:#d2f1fe;z-index:10000;background-color: #091016;box-shadow: #091016 0px 0px 4px;width: 450px;min-height:30px;height:auto;position: absolute; right: 75px;padding:6px 0">',g+="</div>"},this.taskHistoryProgressFmt=function(a,b,c){var d=!0,e=b.work_detail_list.length,f='<div class="event" style="cursor:pointer;position:absolute;width:'+50*(e-1)+'px;margin-top: -18px;height: 36px;padding-top: 18px;">';f=f+'<div style="position:absolute;border:1px solid #CCCCCC;width:'+50*(e-1)+'px;"></div>';for(var g=0,h=0;e>g;g++)h+=1,1==b.work_detail_list[g].work_state?f=d?5==b.work_detail_list[g].pend_type?f+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: black;top:'+-(9*(h-1)+3)+"px;left:"+(50*(h-1)-4)+'px;"></div>':f+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: #0095A5;top:'+-(9*(h-1)+4)+"px;left:"+(50*(h-1)-4)+'px;"></div>':5==b.work_detail_list[g].pend_type?f+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: black;top:'+-(9*(h-1)+8)+"px;left:"+(50*(h-1)-4)+'px;"></div>':f+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: #0095A5;top:'+-(9*(h-1)+9)+"px;left:"+(50*(h-1)-4)+'px;"></div>':2==b.work_detail_list[g].work_state?(d=!1,f=f+'<div style="position:relative;width:13px;height:13px;border-radius:100%;background-color: #F72B44;top:'+-(9*(h-1)+6)+"px;left:"+(50*(h-1)-4)+'px;"></div>'):4==b.work_detail_list[g].work_state&&(f=f+'<div style="position:relative;width:9px;height:9px;border-radius:100%;background-color: #CCCCCC;top:'+-(9*(h-1)+8)+"px;left:"+(50*(h-1)-4)+'px;"></div>');f+="</div>",f+='<div class="displayNone leave" style="color:#D2F1FE;z-index:10000;background-color: #091016;width: 450px;height:auto;position: absolute;right: 260px;padding:6px 0">';for(var i=0;e>i;i++)f+='<div style="padding:2px 10px;">',f+='<span style="color:#d2f1fe;padding:8px;background-color:#253549;display:inline-block;width:160px;text-align:center;margin-left: 8px;">--</span>',f+='<span style="color:#d2f1fe;padding:8px;background-color:#253549;display:inline-block;width:220px;text-align:center;margin-left:4px;">--</span>',f+=2==b.work_detail_list[i].work_state?'<div style="padding:8px;display:inline-block;width:30px;text-align:center;margin-left:4px;background: #253549 url(img/header/task_state3.png) no-repeat center;height: 39px;margin-bottom: -15px;"></div>':1==b.work_detail_list[i].work_state?'<div style="padding:8px;display:inline-block;width:30px;text-align:center;margin-left:4px;background: #253549 url(img/header/task_state1.png) no-repeat center;height: 39px;margin-bottom: -15px;"></div>':'<span style="color:#d2f1fe;padding:8px;background-color:#253549;display:inline-block;width:30px;text-align:center;margin-left:4px;">--</span>',f+="</div>";return f+="</div>"},this.templateTypeFmt=function(a){return 1==a?"发布模板":2==a?"回退模板":3==a?"构建模板":void 0},this.templateOpeSysFmt=function(a){for(var b=a.split("|"),c=[].join(""),d=0;d<b.length;d++)1==b[d]&&(c+='<span style="background:#EFEFEF;color:#333; padding: 0 10px;display: inline-block;text-align: center;margin-right: 5px;margin-bottom: 5px;">',c+="Linux",c+="</span>"),2==b[d]&&(c+='<span style="background:#EFEFEF;color:#333; padding: 0 10px;display: inline-block;text-align: center;margin-right: 5px;margin-bottom: 5px;">',c+="AIX",c+="</span>"),3==b[d]&&(c+='<span style="background:#EFEFEF;color:#333; padding: 0 10px;display: inline-block;text-align: center;margin-right: 5px;margin-bottom: 5px;">',c+="AS400",c+="</span>");return c},this.pxMin160Fmt=function(a){return a||(a="-"),"<div title="+a+' style="min-width:160px;word-break:break-all; ">'+a+"</div>"},this.wdayTypeFmt=function(a){return 1==a?"普通工作日":2==a?"普通周末":3==a?"调休工作日":4==a?"节假日":void 0},this.peakDateListFmt=function(a){if(a){for(var b=a,c=[].join(""),d=0;d<b.length;d++){var e=b[d];c+='<span style="; padding: 0 10px;display: inline-block;text-align: center;margin-right: 5px;margin-bottom: 5px;">['+e.start_time+"-"+e.end_time+"]</span>"}return c}},this.subgroupListPublishFmt=function(a){return a&&2!=a?"<div title="+a+' style="min-height: 24px;word-break:break-all;">已发布</div>':"<div title="+a+' style="min-height: 24px;word-break:break-all;">未发布</div>'},this.envIsPublishFmt=function(a,b,c){return a?1==a?'<div style="margin-left: 1px;"><span class="status-img list-success-img"></div>':2==a?'<div title="未定义！" style="min-height: 24px;color: #999">--</div>':void 0:'<div title="未定义！" style="min-height: 24px;color: #999">--</div>'},this.combineModifyTimeDate=function(a,b){var c="";return c=b.modify_bk_date?b.modify_bk_date+" "+b.modify_bk_time:'<div title="未定义！" style="color:#999">--</div>'},this.subgroupListExecuteTypeFmt=function(a){var b=p.findValue(a,e);return"<span>"+b+"</span>"},this.cmptListCmptType=function(a){if(0!=a.length){for(var b="",c=0;c<a.length;c++)b+=c==a.length-1?p.findValue(a[c],g):p.findValue(a[c],g)+"/";return"<span>"+b+"</span>"}return"--"},this.subgroupFmt=function(a){return'<div style="margin-left: 20px;word-break: break-all;">'+a+"</div>"},this.classifyTag=function(a){var b=a?a:[],c="";return 0!=b.length?c+='<div style="height: 32px;word-break: break-all;text-overflow: ellipsis;white-space: nowrap;overflow:hidden;line-height: 30px;width: 66px;display:inline-block;margin-right: 5px;border: 1px solid #ccc" title="'+b[0]+'">'+b[0]+"</div>":c="<div>--</div>",b.length>1&&(c+='<div class="tags-classify" style="display: inline-block;width: 14px;vertical-align: top;margin-top:4px"><i class="fa fa-ellipsis-h"></i></div>'),c},this.combineTimeDate=function(a,b){var c=b.crt_bk_date+" "+b.crt_bk_time;return c},this.sysListPublishState=function(a,b,c){var d="",e="";if(a){for(var f=0;f<a.length;f++)e+='<div class="program_list_hover_style" style="padding:5px 14px;width: 120px;text-align: left;word-break: break-all;background: #0b1016;">'+a[f].prog_cn_name+"</div>";d=['<div style="">','<div class="publish_program_animate_active" style="">'+a.length+"</div>",'<div class="publish_program_name_list" style="position: absolute;color: #333; margin-top: -51px; margin-left: -134px; display: none;font-size: 12px;z-index: 5;">','<div style="position: absolute;top:24px;left: 121px;z-index: 10;width: 17px;height: 30px;transform:rotate(180deg);overflow: hidden;">','<div style="height: 17px;width: 17px; transform: rotate(30deg) skewX(-18deg) translateX(10px);position: absolute; left:0px;background-color: #fff;border: 1px solid #D9EDF7;"></div>',"</div>",'<div style="color: #fff;border-radius: 5px;background-color: #61a1b8;border: 1px solid #61a1b8;">','<div style="background-color: #61a1b8;border-bottom: 1px solid #D9EDF7;border-radius: 5px 5px 0 0;padding: 5px 14px;width: 120px;text-align: center;"><i class="fa fa-cubes" style="font-size: 14px;vertical-align: -1px;margin-right: 5px;"></i>方案列表</div>',e,"</div>","</div>","</div>"]}else d=['<div style="height: 30px;width: 80px"></div>'];
return d.join("")},this.sysListNodeCount=function(a,b,c){var d="",e="";if(a){for(var f=0;f<a.length;f++)e+='<div class="node_list_hover_style" style="background: #0b1016;padding:5px 14px;word-break: break-all;">'+a[f].soc_ip+"</div>";d=["<div>",'<div class="animate_active" style="">'+a.length+"</div>",'<div class="node_list" style="position: absolute;color: #333; margin-top: -51px; margin-left: -134px; display: none;font-size: 12px;z-index: 5;">','<div style="position: absolute;top:24px;left: 120px;z-index: 10;width: 17px;height: 30px;transform:rotate(180deg);overflow: hidden;">','<div style="height: 17px;width: 17px; transform: rotate(30deg) skewX(-18deg) translateX(10px);position: absolute; left:0px;background-color: #fff;border: 1px solid #ebebeb;"></div>',"</div>",'<div style="color: #fff;border-radius: 5px;background-color: #61a1b8;border: 1px solid #61a1b8;">','<div style="background-color: #61a1b8;border-bottom: 1px solid #61a1b8;border-radius: 5px 5px 0 0;padding: 5px 14px;width: 120px;text-align: center;"><i class="fa fa-server" style="font-size: 14px;vertical-align: -1px;margin-right: 5px;"></i>节点列表</div>',e,"</div>","</div>","</div>"]}else d=['<div style="height: 30px;width: 80px"></div>'];return d.join("")},this.sysListUser=function(a,b,c){var d="",e="";if(a){for(var f=0;f<a.length;f++)e+='<div class="node_list_hover_style" style="background: #0b1016;padding:5px 14px;word-break: break-all;">'+a[f]+"</div>";d=["<div>",'<div class="user_animate_active" style="">'+a.length+"</div>",'<div class="node_list" style="position: absolute;color: #333; margin-top: -51px; margin-left: -134px; display: none;font-size: 12px;z-index: 5;">','<div style="position: absolute;top:24px;left: 120px;z-index: 10;width: 17px;height: 30px;transform:rotate(180deg);overflow: hidden;">','<div style="height: 17px;width: 17px; transform: rotate(30deg) skewX(-18deg) translateX(10px);position: absolute; left:0px;background-color: #fff;border: 1px solid #ebebeb;"></div>',"</div>",'<div style="color: #fff;border-radius: 5px;background-color: #61a1b8;border: 1px solid #61a1b8;">','<div style="background-color: #61a1b8;border-bottom: 1px solid #61a1b8;border-radius: 5px 5px 0 0;padding: 5px 14px;width: 120px;text-align: center;"><i class="fa fa-users" style="font-size: 14px;vertical-align: -1px;margin-right: 5px;color:#fff"></i>责任人列表</div>',e,"</div>","</div>","</div>"]}else d=['<div style="height: 30px;width: 80px"></div>'];return d.join("")},this.sysListLogCount=function(a,b,c){var d="",e="";if(a){for(var f=0;f<a.length;f++)e+='<div class="node_list_hover_style" style="background: #0b1016;padding:5px 14px;word-break: break-all;">'+a[f].log_name+"</div>";d=["<div>",'<div class="animate_active" style="">'+a.length+"</div>",'<div class="node_list" style="position: absolute;color: #333; margin-top: -51px; margin-left: -134px; display: none;font-size: 12px;z-index: 5;">','<div style="position: absolute;top:24px;left: 120px;z-index: 10;width: 17px;height: 30px;transform:rotate(180deg);overflow: hidden;">','<div style="height: 17px;width: 17px; transform: rotate(30deg) skewX(-18deg) translateX(10px);position: absolute; left:0px;background-color: #fff;border: 1px solid #D9EDF7;"></div>',"</div>",'<div style="color:#fff;border-radius: 5px;background-color: #61a1b8;border: 1px solid #61a1b8;">','<div style="background-color: #61a1b8;border-bottom: 1px solid #D9EDF7;border-radius: 5px 5px 0 0;padding: 5px 14px;width: 120px;text-align: center;"><i class="fa fa-server" style="font-size: 14px;vertical-align: -1px;margin-right: 5px;"></i>日志列表</div>',e,"</div>","</div>","</div>"]}else d=['<div style="height: 30px;width: 80px"></div>'];return d.join("")},this.agentUseFmt=function(a){var b=1==a?"是":"否";return"<span>"+b+"</span>"},this.DataModelFmt=function(a){var b=[].join("");if(a)for(var c=a,d=c.length,e=0;e<c.length;e++)b+=d>e?c[e]+",":c[e]+"";return b},this.inTaskStateFmt=function(a){return p.findValue(a,h)},this.xjProgramTimeFmt=function(a,b){var c=a.substring(0,a.length-3);return'<div style="width: 150px;word-break:break-all;">'+c+"</div>"},this.xjRunState=function(a,b){return 0==b.status?'<span title="待执行" class="glyphicon glyphicon-play-circle" style="font-size:16px;color:#F0DB4F;width: 50px;word-break:break-all;cursor:default"></span>':1==b.status?'<span title="执行中" class="fa fa-spinner fa-pulse" style="font-size:16px;color:#3399CC;width: 50px;word-break:break-all;cursor:default"></span>':2==b.status?'<span title="执行成功" class="glyphicon glyphicon-ok-circle" style="font-size:16px;color:#4CAF50;width: 50px;word-break:break-all;cursor:default"></span>':3==b.status?'<span title="待执失败" class="glyphicon glyphicon-remove-circle" style="font-size:16px;color:#CF4646;width: 50px;word-break:break-all;cursor:default"></span>':4==b.status?'<i title="手动停止" class="fa fa-stop-circle-o" style="font-size:18px;color:#FEA04D;width: 50px;word-break:break-all;cursor:default"></i>':void 0},this.publishState=function(a,b){return 2==b.publish_state?'<div title="未发布！" style="min-height: 24px;color: #999">--</div>':1==b.publish_state?'<span title="发布成功" class="glyphicon glyphicon-ok-circle" style="font-size:16px;color:#4CAF50;width: 50px;word-break:break-all;"></span>':void 0},this.pluginTypeFormat=function(a,b){var c=p.findValue(a,n);return"<span>"+c+"</span>"},this.pluginFileFormat=function(a,b){var c=a?a:"--";return"<span>"+c.substring(c.lastIndexOf("/")+1)+"</span>"},this.flowPublishTime=function(a,b){return a&&b.publish_bk_time?a+" "+b.publish_bk_time:"--"},this.ywTaskType=function(a,b,c){var d="",e="",f=a.length;if(0!=f){for(var g=0;f>g;g++)e+='<div class="node_list_hover_style" style="padding:5px 14px;word-break: break-all;">'+p.findValue(a[g],k)+"</div>";d=["<div>",'<div class="animate_active"><i class="fa fa-tasks" style="font-size: 14px;color: #ace6fe"></i>&nbsp;'+p.findValue(a[0],k)+"</div>",'<div class="node_list" style="position: absolute;color: #ace6fe; margin-top: -51px; margin-left: -134px; display: none;font-size: 12px;z-index: 5;">','<div style="position: absolute;top:24px;left: 120px;z-index: 10;width: 17px;height: 30px;transform:rotate(180deg);overflow: hidden;">','<div style="height: 17px;width: 17px; transform: rotate(30deg) skewX(-18deg) translateX(10px);position: absolute; left:0px;top: -4px;background-color: #131E2A;border: 1px solid #056879;"></div>',"</div>",'<div style="border-radius: 5px;background-color: #131E2A;border: 1px solid #056879;">','<div style="background-color: #07131E;border-bottom: 1px solid #056879;border-radius: 5px 5px 0 0;padding: 5px 14px;width: 120px;text-align: center;">任务类型列表</div>',e,"</div>","</div>","</div>"],1==f&&(d[1]='<div style="padding-left: 14px"> &nbsp;'+p.findValue(a[0],k)+"</div>")}else d=['<div style="height: 30px;width: 80px">--</div>'];return d.join("")},this.taskExecStaus=function(a,b){if(!a)return"<span title='未定义！'>--</span>";var c=p.findValue(a,l),d="";switch(a){case 3:case 10:d="dis_exception";break;case 4:d="dis_finish";break;case 5:d="dis_exce_finish";break;case 7:d="dis_pause";break;case 8:d="dis_handle_wait";break;case 9:case 11:d="dis_auto_wait";break;default:d=""}return 1==a||6==a?"<span title='执行中' class='fa fa-pulse fa-spinner' style='font-size: 17px;color:#5EB8FA'></span><span style='vertical-align:bottom;padding-left:8px'>"+c+"</span>":"<div title='"+c+"'><span class='dispatch_task_icon "+d+"'></span><span style='vertical-align: bottom'>"+c+"</span></div>"},this.ywExecType=function(a,b){var c=1==a?"手动":"自动";return"<span>"+c+"</span>"},this.ywTasktimeFmt=function(a,b){if(a){var c=a.substring(a.lastIndexOf("."),-1);return"<span>"+c+"</span>"}},this.flowIsPublishFmt=function(a,b){return a?1==a?'<div title="未发布" class="dispatch_flow_icon dis_no_publish_icon"><span style="vertical-align: middle;display:inline-block;text-align:center;width: 60px;margin-left:15px">未发布</span></div>':2==a?'<div title="已发布" class="dispatch_flow_icon dis_published_icon"><span style="vertical-align: middle;display:inline-block;text-align:center;width:60px;margin-left:15px">已发布</span></div>':3==a?'<div title="挂起" class="dispatch_task_icon dis_hangup_icon"><span style="vertical-align: middle;display:inline-block;text-align:center;width:60px;margin-left:15px">挂起</span></div>':void 0:'<div title="未定义！" style="min-height: 24px;color: #999">--</div>'},this.sceneNameFmt=function(a,b){var c;return c=a?3===b.scene_type?'<div style="white-space:nowrap;overflow: hidden;min-height: 24px;color: #a40000" title="'+a+'">'+a+"</div>":'<div style="white-space:nowrap;overflow: hidden;min-height: 24px;" title="'+a+'">'+a+"</div>":'<div title="未定义！" style="min-height: 24px;white-space:nowrap;overflow: hidden;">--</div>'},this.sceneCrtTime=function(a,b){return a&&b.crt_bk_time?a+" "+b.crt_bk_time:"--"},this.strategyTypeCnFmt=function(a,b){var c=p.findValue(a,m);return c?'<div style="cursor: default">'+c+"</div>":"--"},this.formTimeLimit=function(a,b){if(a){var c=b.start_date+"~"+b.end_date;return"<span>"+c+"</span>"}},this.logFilesFormat=function(a,b){if(a){for(var c="",d=b.log_names.split(",")?b.log_names.split(","):[],e=0;e<d.length;e++){var f=d[e];c=c+f+"/"}return"<span>"+c+"</span>"}}}]),configSrv.factory("TblOption",function(){return{search:!1,pagination:!0,pageSize:20,pageNumber:1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},classes:"table table-no-bordered table-hover"}}),configSrv.factory("MouseMoveEvent",["$timeout","Col_Fmt",function(a,b){var c;return{"mouseenter .tbl_config":function(){var b=$(this).children().eq(0).children(),d=$(this).parent().parent().siblings().find(".pp"),e=$(this);d.animate({right:"-222px"},200,function(){d.parent().siblings().children().each(function(){e.css("background",e.attr("name")%2==0?"#FFF":"#F6F7FC")})}),c&&a.cancel(c),c=a(function(){e.css("background","#5A72A3"),b.animate({right:"30px"},500)},200)},"mouseleave .tbl_config":function(){var b=$(this).children().eq(0).children(),d=$(this).children().eq(1).children();c&&a.cancel(c),c=a(function(){b.animate({right:"-222px"},200,function(){d.parent().siblings().children().each(function(){d.css("background",d.attr("name")%2==0?"#FFF":"#F6F7FC")})})},200)}}}]),configSrv.factory("OptionCol",function(){return{field:"operate",width:"50px",title:"",align:"center",valign:"middle"}}),configSrv.factory("OptionColWidth",function(){return{field:"operate",width:"100px",title:"",align:"right",valign:"middle"}}),configSrv.factory("ColMap",function(){return{pro_bk_date:{field:"pro_bk_date",title:"发布日期",align:"center",valign:"middle",sortable:!0,formatter:Col_Fmt.px100Fmt},project_short_name:{field:"project_short_name",title:"发布项目",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.px100Fmt},business_cn_name:{field:"business_cn_name",title:"业务系统",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.px100Fmt},project_nature:{field:"project_nature",title:"发布类型",align:"center",valign:"middle",formatter:Col_Fmt.projNatureFmt},user_cn_name:{field:"user_cn_name",title:"执行人",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.px100Fmt},project_status:{field:"project_status",title:"执行状态",align:"center",valign:"middle",sortable:!0,formatter:Col_Fmt.projStatusFmt},prod_flag:{field:"prod_flag",title:"发布结果",align:"center",valign:"middle",formatter:Col_Fmt.prodFlagFmt},start_bk_time:{field:"start_bk_time",title:"计划发布时间",align:"center",valign:"middle"},pre_project_short_name:{field:"pre_project_short_name",title:"前置项目",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.preProjFmt},project_name:{field:"project_name",title:"项目编号",align:"left",valign:"middle",formatter:Col_Fmt.px140Fmt},project_bk_desc:{field:"project_bk_desc",title:"项目描述",align:"left",valign:"middle",formatter:Col_Fmt.px160Fmt},business_sys_name:{field:"business_sys_name",title:"业务系统",align:"left",halign:"center",valign:"middle",width:"200px",formatter:Col_Fmt.px170Fmt},count_dir:{field:"count_dir",title:"目录数",align:"left",halign:"left",valign:"middle",formatter:Col_Fmt.noZeroFmt},count_node:{field:"count_node",title:"节点数",align:"left",halign:"left",valign:"middle",formatter:Col_Fmt.noZeroFmt},count_template:{field:"count_template",title:"模板数",align:"left",halign:"left",valign:"middle",formatter:Col_Fmt.noZeroFmt},version_num:{field:"version_num",title:"版本号",align:"center",halign:"center",valign:"middle",width:"100px",sortable:!0,formatter:Col_Fmt.noZeroFmt},prolist_name:{field:"prolist_name",title:"清单",align:"left",halign:"center",valign:"middle",events:{"click .download_text":function(){for(var a=$(this).children().text(),b=0;b<_table_data.length;b++)_table_data[b].prolist_name==a&&CV.downloadFile(_table_data[b].prolist_path)}},formatter:Col_Fmt.downOneFmt},propackage_name_list:{field:"propackage_name_list",title:"发布包",align:"left",halign:"center",valign:"middle",events:{"click .download_text":function(){for(var a=$(this).children().text(),b=$(this).children().attr("class"),c=0;c<_table_data.length;c++)_table_data[c].propackage_name_list[b]==a&&CV.downloadFile(_table_data[c].propackage_path_list[b])}},formatter:Col_Fmt.downListFmt},project_complete_flag:{field:"project_complete_flag",title:"完成状态",align:"center",halign:"center",valign:"middle",formatter:Col_Fmt.complete_FlagFmt},template_name:{field:"template_name",title:"模板名",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.pxMin160Fmt},template_type:{field:"template_type",title:"模板类别",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.templateTypeFmt},operating_system:{field:"operating_system",title:"操作系统",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.templateOpeSysFmt},crt_bk_date:{field:"crt_bk_date",title:"创建时间",align:"center",halign:"center",valign:"middle"},tp_class_name:{field:"tp_class_name",title:"模板类名",align:"left",halign:"center",valign:"middle"},script_file_path:{field:"script_file_path",title:"模板脚本文件",align:"left",halign:"center",valign:"middle"},order_seq:{field:"order_seq",title:"编号",align:"left",halign:"center",width:"165px",valign:"middle",formatter:Col_Fmt.workOrderFlagFmt},sys_cn_name:{field:"sys_cn_name",title:"系统",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},order_bk_title:{field:"order_bk_title",title:"标题",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},workorder_type:{field:"workorder_type",title:"工单类型",align:"center",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderTypeFmt},order_state:{field:"order_state",title:"状态",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderStateFmt},deal_user_name:{field:"deal_user_name",title:"责任人",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},closed_bk_date:{field:"closed_bk_date",title:"关闭时间",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderTimeFmt},crt_user_name:{field:"crt_user_name",title:"创建人",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},row_number:{field:"row_number",title:"行号",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},order_bk_desc:{field:"order_bk_desc",title:"工单描述",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},trouble_bk_desc:{field:"trouble_bk_desc",title:"故障描述",align:"center",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},problem_desc:{field:"problem_desc",title:"问题描述",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.workOrderFmt},pend_work_seq:{field:"pend_work_seq",title:"任务流水号",align:"left",valign:"middle"},pendwk_bk_expl:{field:"pendwk_bk_expl",title:"任务说明",align:"left",valign:"middle"},workflow_state:{field:"workflow_state",title:"任务状态",align:"left",valign:"middle",formatter:Col_Fmt.taskStatusFmt},pend_cn_name:{field:"pend_cn_name",title:"处理人",align:"left",valign:"middle"},crt_dept_time:{field:"crt_dept_time",title:"提交时间",align:"left",valign:"middle"},deal_bk_dt:{field:"deal_bk_dt",title:"结束日期",align:"center",valign:"middle"},crt_bk_time:{field:"crt_bk_time",title:"时间",align:"center",valign:"middle"},msg_title:{field:"msg_title",title:"主题",align:"center",valign:"middle"},crt_user_id:{field:"crt_user_id",title:"发布人",align:"center",valign:"middle"},program_seq:{field:"program_seq",title:"编号",align:"center",valign:"middle"},program_name:{field:"program_name",title:"方案名称",align:"center",valign:"middle"},program_bk_desc:{field:"program_bk_desc",title:"方案描述",align:"left",halign:"center",valign:"middle",formatter:Col_Fmt.px160Fmt},sys_name:{field:"sys_name",title:"系统名",align:"left",halign:"center",valign:"middle"},sys_bk_desc:{field:"sys_bk_desc",title:"系统中文描述",align:"left",halign:"center",valign:"middle",width:"300px",formatter:Col_Fmt.px250Fmt},sys_type:{field:"sys_type",title:"系统类型 ",align:"left",valign:"middle",formatter:Col_Fmt.troubleSysFmt},soc_name:{field:"soc_name",title:"系统数据源",align:"left",valign:"middle"},trouble_key:{field:"trouble_key",title:"故障编号",align:"center",valign:"middle",formatter:Col_Fmt.pxMin160Fmt},trouble_code:{field:"trouble_code",title:"故障代码",align:"center",halign:"center",valign:"middle",formatter:Col_Fmt.pxMin160Fmt},time_cn_name:{field:"time_cn_name",title:"时段中文名",align:"left",halign:"center",valign:"middle"},time_bk_desc:{field:"time_bk_desc",title:"时段描述",align:"left",halign:"left",valign:"middle"},wday_type:{field:"wday_type",title:"工作日类型",align:"left",halign:"left",valign:"middle",width:"150px",formatter:Col_Fmt.wdayTypeFmt},start_bk_date:{field:"start_bk_date",title:"开始日期",align:"left",halign:"left",valign:"middle",width:"100px",formatter:Col_Fmt.noZeroFmt},end_bk_date:{field:"end_bk_date",title:"结束日期",align:"left",halign:"left",valign:"middle",width:"100px",formatter:Col_Fmt.noZeroFmt},times:{field:"times",title:"开始结束时间组",align:"left",halign:"left",valign:"middle",width:"200px",formatter:Col_Fmt.peakDateListFmt}}});var GlobalData=angular.module("GlobalData",[]);GlobalData.factory("CommData",function(){return{org_user_id:"",org_dept_id:"",org_term_no:"",org_channel_code:"01",org_work_code:"",org_srv_name:"",org_rs_code:"00",submit_type:1,orguser_cn_name:"",orgdept_cn_name:""}}),GlobalData.factory("ProjType",function(){return["例行发布","紧急发布","一般项目发布","大型项目发布","特大型项目发布"]}),GlobalData.factory("ProjectStatus",function(){return[{key:1,value:"已登记"},{key:2,value:"待发布"},{key:3,value:"未审核"},{key:4,value:"发布中"},{key:5,value:"发布异常"},{key:6,value:"正常结束"},{key:7,value:"异常结束"},{key:8,value:"已挂起"},{key:9,value:"已关闭"}]}),GlobalData.factory("ProjectReleaseType",function(){return[{key:1,value:"例行发布"},{key:2,value:"紧急发布"},{key:3,value:"补充发布 "}]}),GlobalData.factory("jdkVersion",function(){return["1.5","1.6","1.7","1.8"]}),GlobalData.factory("ProjectNature",function(){return[{key:1,value:"例行发布"},{key:2,value:"紧急发布"},{key:3,value:"一般项目发布"},{key:4,value:"大型项目发布"},{key:5,value:"特大型项目发布"}]}),GlobalData.factory("ProjState",function(){return[{key:1,value:"待准备"},{key:2,value:"待执行"},{key:3,value:"执行中"},{key:4,value:"自动结束"},{key:5,value:"手动结束"},{key:6,value:"回退中"},{key:7,value:"回退成功"},{key:8,value:"回退失败"},{key:9,value:"待回退"}]}),GlobalData.factory("ProdFlag",function(){return[{key:1,value:"成功"},{key:2,value:"失败"}]}),GlobalData.factory("ProdNodeState",function(){return[{key:1,value:"未执行"},{key:2,value:"正在执行"},{key:3,value:"执行失败"},{key:4,value:"执行成功"},{key:5,value:"执行跳过"}]}),GlobalData.factory("ProdCmdState",function(){return[{key:1,value:"未执行"},{key:2,value:"正在执行"},{key:3,value:"执行报错"},{key:4,value:"验证失败"},{key:5,value:"执行成功"},{key:6,value:"执行跳过"},{key:7,value:"执行终止"},{key:8,value:"手动成功"}]}),GlobalData.factory("ProjGroupColor",function(){return["#920783","#8fc31f","#956134","#e4007f","#006934","#0b318f"]}),GlobalData.factory("IssueType",function(){return[{key:1,value:"业务需求问题"},{key:2,value:"发布包错误"},{key:3,value:"代码问题"},{key:4,value:"夹带发布"},{key:5,value:"环境配置错误"},{key:6,value:"发布问题"},{key:7,value:"其他问题"}]}),GlobalData.factory("pathType",function(){return[{key:1,value:"本地"},{key:2,value:"版本机"}]}),GlobalData.factory("EncodingType",function(){return["UTF-8","GBK"]}),GlobalData.factory("ScriptDayNight",function(){return["日间","夜间"]}),GlobalData.factory("ReleaseFileType",function(){return[{key:1,value:"txt"},{key:2,value:"xlsx"},{key:3,value:"xls"},{key:4,value:"bat"},{key:5,value:"sh"},{key:6,value:"xml"},{key:7,value:"html"},{key:8,value:"properties"},{key:9,value:"tar"},{key:10,value:"zip"},{key:11,value:"rar"},{key:12,value:"gz"},{key:13,value:"jar"},{key:14,value:"sql"},{key:15,value:"py"},{key:16,value:"java"},{key:17,value:"js"}]}),GlobalData.factory("TaskState",function(){return[{key:1,value:"待授权"},{key:2,value:"授权拒绝"},{key:3,value:"待执行"},{key:4,value:"执行完毕"},{key:5,value:"关闭任务"}]}),GlobalData.factory("WorkorderType",function(){return[{key:1,value:"故障单"},{key:2,value:"常规维护"}]}),GlobalData.factory("WoFlowType",function(){return[{key:1,value:"创建工单"},{key:2,value:"指派工单"},{key:3,value:"退回工单"},{key:4,value:"处理工单"},{key:5,value:"关闭工单"},{key:6,value:"重启工单"}]}),GlobalData.factory("WoStatusType",function(){return[{key:1,value:"待处理"},{key:2,value:"被退回"},{key:3,value:"处理中"},{key:4,value:"已处理"},{key:5,value:"正常关闭"},{key:6,value:"异常关闭"}]}),GlobalData.factory("WoCloseType",function(){return[{key:1,value:"处理完毕"},{key:2,value:"问题重复"},{key:3,value:"已解决"},{key:4,value:"超时自动关闭"},{key:5,value:"无法处理"}]}),GlobalData.factory("WoRestartType",function(){return[{key:1,value:"问题未解决"}]}),GlobalData.factory("SqlType",function(){return[{key:1,value:"select(查询)"},{key:2,value:"update(更新)"},{key:3,value:"insert(插入)"},{key:4,value:"delete(删除)"}]}),GlobalData.factory("transactionType",function(){return[{key:1,value:"整体事务"},{key:2,value:"独立事务"}]}),GlobalData.factory("SparamType",function(){return[{key:1,value:"输入文本"},{key:2,value:"单选框"},{key:3,value:"复选框"},{key:4,value:"下拉框"},{key:5,value:"固定值"}]}),GlobalData.factory("SparamAuthType",function(){return[{key:1,value:"本地授权"},{key:2,value:"远程授权"}]}),GlobalData.factory("BucketType",function(){return[{key:1,value:"非高峰期"},{key:2,value:"高峰期"}]}),GlobalData.factory("WorkDayType",function(){return[{key:1,value:"普通工作日"},{key:2,value:"普通周末"},{key:3,value:"调休工作日"},{key:4,value:"节假日"}]}),GlobalData.factory("InstanceType",function(){return[{key:1,value:"源数据集"},{key:2,value:"分析数据集"},{key:3,value:"表格"},{key:4,value:"折线图"},{key:5,value:"条形图"},{key:6,value:"柱形图"},{key:7,value:"饼图"},{key:8,value:"全局变量"},{key:9,value:"SQL"},{key:10,value:"Java"}]}),GlobalData.factory("FieldType",function(){return[{key:1,value:"CHAR"},{key:2,value:"VARCHAR"},{key:3,value:"INT"},{key:4,value:"DOUBLE"}]}),GlobalData.factory("intaskState",function(){return[{key:1,value:"待导入"},{key:2,value:"导入中"},{key:3,value:"执行中"},{key:4,value:"生成中"},{key:5,value:"已完成"}]}),GlobalData.factory("coTaskState",function(){return[{key:1,value:"待执行"},{key:2,value:"执行中"},{key:3,value:"执行成功"},{key:4,value:"执行失败"},{key:5,value:"已暂停"},{key:6,value:"已关闭"}]}),GlobalData.factory("FileType",function(){return[{key:1,value:"SQL"},{key:2,value:"JSON"},{key:3,value:"CSV"},{key:4,value:"OTHER"}]}),GlobalData.factory("ApplicateType",function(){return[{key:1,value:"执行"},{key:2,value:"文件"},{key:3,value:"校验"}]}),GlobalData.factory("PublishState",function(){return[{key:1,value:"已发布"},{key:2,value:"未发布"}]}),GlobalData.factory("AdaptState",function(){return[{key:1,value:"Linux"},{key:2,value:"AIX"},{key:3,value:"AS400"},{key:4,value:"MySql"},{key:5,value:"DB2"},{key:6,value:"ORACLE"}]}),GlobalData.factory("CodeMirrorOption",function(){var a={},b={lineWrapping:!0,lineNumbers:!0,scrollbarStyle:"overlay",theme:"midnight"};a.Sh=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-sh"})},a.Sql=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-sql"})},a.Properties=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-properties"})},a.Python=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-python"})},a.Java=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/x-java"})},a.Vbs=function(a){return angular.extend({readOnly:a?a:!1},b,{mode:"text/vbscript"})},a.dayOrNight=function(a){a?a.theme="midnight"==a.theme?"default":"midnight":c.setOption("theme","default"===c.getOption("theme")?"midnight":"default")},a.getRangeByKey=function(a,b,c,d){var e=[];return a.setOption("readOnly",b),a.setOption("lineWrapping",!1),a.setOption("lineNumbers",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("theme","midnight"),a.setOption("mode","text/x-properties"),e},a.setEditor=function(a,b,c){return a.setOption("firstLineNumber",1),a.setOption("lineWrapping",!0),a.setOption("lineNumbers",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("theme","midnight"),a.setOption("mode",4==b?"text/x-sql":2==b?"text/x-python":3==b?"text/x-java":"text/x-sh"),a.on("keypress",function(){c&&c.length>0?a.showHint({pluginKeys:c}):a.showHint()}),a},a.setParamsEditor=function(a){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","26px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){a.showHint({systemKeys:[{key:"${project_name}",text:"${project_name} [项目名]"},{key:"${update_local_dir}",text:"${update_local_dir} [本地上传路径]"},{key:"${script_file}",text:"${script_file} [脚本文件]"},{key:"${script_str}",text:"${script_str} [脚本字符]"}]})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.setUniqueParamsEditor=function(a){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","26px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){a.showHint({systemKeys:[{key:"${script_file}",text:"${script_file} [脚本文件]"},{key:"${script_str}",text:"${script_str} [脚本字符]"}]})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.setNoneParamsEditor=function(a){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","26px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.showParamsEditor=function(a,b){return a.setOption("lineWrapping",!0),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",!1),a.setSize("height","80px"),a.setOption("mode","text/x-ini"),a.setOption("theme","midnight"),0!=b.data.key_word_list.length&&a.on("keypress",function(){a.showHint({systemKeys:b.data.key_word_list})}),a.setOption("extraKeys",{Enter:function(){b.sendCmdMsg(),b.$apply()}}),a},a.getDynamicParams=function(a,b){return a.setOption("firstLineNumber",1),a.setOption("lineWrapping",!0),a.setOption("lineNumbers",!0),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){b&&b.length>0&&a.showHint({systemKeys:b})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a},a.getDynamicRefParams=function(a,b){return a.setOption("lineWrapping",!1),a.setOption("scrollbarStyle",null),a.setOption("lineNumbers",null),a.setSize("height","34px"),a.setOption("mode","text/x-sh"),a.setOption("theme","midnight"),a.on("keypress",function(){b&&b.length>0&&a.showHint({systemKeys:b})}),a.setOption("extraKeys",{Enter:function(){return!1}}),a};var c,d=[],e=function(a,b){var c=function(a,b){for(var c=!1,e=0;e<d.length;e++)d[e].line_id===b&&(c=!0);c||d.push({line_id:b,line_ch:a.getLine(b)})};if(b.from.line===b.to.line)c(a,b.from.line);else for(var e=b.from.line;e<=b.to.line;e++)c(a,e)},f=function(a){for(var b=-1,c=0;c<d.length;c++)d[c].line_id===a&&(b=c);return-1===b?"":d[b].line_ch},g=function(a){for(var b=0;b<a.length;b++)a[b].clear()};return a.setFileEditor=function(a,b){d=[],a.setOption("lineNumbers",!0),a.setOption("styleSelectedText",!0),a.setOption("mode","text/x-properties"),a.setOption("styleActiveLine",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("keyMap","vim"),a.setOption("theme","midnight"),a.setOption("extraKeys",{F11:function(a){a.setOption("fullScreen",!a.getOption("fullScreen"))},"Ctrl-F":"findPersistent","Cmd-F":"findPersistent","Ctrl-H":"replace","Cmd-H":"replace","Ctrl-G":"jumpToLine","Cmd-G":"jumpToLine"}),a.on("beforeChange",function(a,b){a.getLine(b.from.line)&&e(a,b)}),a.on("change",function(b,c){if(0===c.from.line&&0===c.from.ch)return!1;if(c.from.line===c.to.line){var d=f(c.from.line),e=b.getLine(c.from.line);e!==d&&""!==e?a.markText({line:c.from.line,ch:0},{line:c.from.line,ch:e.length},{className:"selected-background"}):e===d&&g(a.findMarks({line:c.from.line,ch:0},{line:c.from.line,ch:e.length}))}}),c=a},a.setFileCompareBg=function(a,b){return a.setOption("readOnly",!0),a.setOption("firstLineNumber",1),a.setOption("lineWrapping",!0),a.setOption("lineNumbers",!0),a.setOption("scrollbarStyle","overlay"),a.setOption("mode","text/x-filecompare"),a.setOption("theme","midnight"),a.setSize("height","500px"),a.setOption("viewportMargin",10),a},a.setSqlFileEditor=function(a){d=[],a.setOption("lineNumbers",!0),a.setOption("lineWrapping",!0),a.setOption("styleSelectedText",!0),a.setOption("mode","text/x-sql"),a.setOption("styleActiveLine",!1),a.setOption("scrollbarStyle","overlay"),a.setOption("theme","midnight"),a.on("beforeChange",function(a,b){a.getLine(b.from.line)&&e(a,b)}),a.on("change",function(b,c){if(0===c.from.line&&0===c.from.ch)return!1;if(c.from.line===c.to.line){var d=f(c.from.line),e=b.getLine(c.from.line);e!==d&&""!==e?a.markText({line:c.from.line,ch:0},{line:c.from.line,ch:e.length},{className:"update-background"}):e===d&&g(a.findMarks({line:c.from.line,ch:0},{line:c.from.line,ch:e.length}))}}),c=a},a}),GlobalData.factory("IML_TYPE",function(){return[{key:1,value:"FTP"},{key:2,value:"SHELL"},{key:3,value:"WAS"},{key:4,value:"SVN"},{key:5,value:"WEBLOGIC"},{key:6,value:"SQL"},{key:7,value:"PYTHON2"},{key:8,value:"PYTHON3"},{key:14,value:"JAVA"},{key:15,value:"C/C++"},{key:16,value:"AUTOIT"},{key:18,value:"AS400_CL"},{key:19,value:"AS400_BGM"},{key:17,value:"自定义"}]}),GlobalData.factory("CmptType",function(){return[{key:1,value:"应用发布"},{key:2,value:"日志巡检"},{key:3,value:"作业调度"},{key:4,value:"故障维护"},{key:5,value:"发布验证"}]}),GlobalData.factory("CmptSysType",function(){return[{key:1,value:"linux"},{key:2,value:"aix"}]}),GlobalData.factory("OperateSys",function(){return[{key:1,value:"linux"},{key:2,value:"windows"},{key:3,value:"ios"},{key:4,value:"未知"},{key:5,value:"aix"},{key:6,value:"hp-ux"},{key:7,value:"freebsd"},{key:8,value:"sco"},{key:9,value:"`"}]}),GlobalData.factory("ParamType",function(){return[{key:1,value:"项目参数"},{key:2,value:"发布包参数"}]}),GlobalData.factory("ProtocolType",function(){return[{key:1,value:"JDBC"},{key:2,value:"PLT_FTP"},{key:3,value:"AS400_FTP"},{key:4,value:"SCP_FTP"},{key:5,value:"SSH"},{key:6,value:"AS400_PGM"},{key:7,value:"AS400_CL"},{key:8,value:"ESB"},{key:9,value:"SFTP"},{key:10,value:"TELNET"},{key:11,value:"WAS"},{key:12,value:"WEBLOGIC"},{key:13,value:"SVN"},{key:14,value:"HTTP"},{key:15,value:"AGENT"},{key:16,value:"FIREFLY"},{key:17,value:"CLEARCASE"}]}),GlobalData.factory("NodeType",function(){return[{key:1,value:"数据库"},{key:2,value:"Web"},{key:3,value:"App"},{key:4,value:"版本"}]}),GlobalData.factory("ProgType",function(){return[{key:1,value:"发布方案"},{key:2,value:"回退方案"}]}),GlobalData.factory("LogType",function(){return[{key:1,value:"系统日志"},{key:2,value:"应用服务器日志"},{key:3,value:"中间件日志"},{key:4,value:"业务日志"},{key:0,value:"其他"}]}),GlobalData.factory("LogFormat",function(){return[{key:1,value:"TXT"},{key:2,value:"XML"},{key:3,value:"CSV"},{key:4,value:"JSON"},{key:5,value:"其他"}]}),GlobalData.factory("logCharacterEncod",function(){return[{key:"UTF-8",value:"UTF-8"},{key:"GBK",value:"GBK"},{key:"EBCDIC",value:"EBCDIC"}]}),GlobalData.factory("logWrapStyle",function(){return[{key:1,value:"\\n"},{key:2,value:"\\r\\n"},{key:3,value:"\\r"}]}),GlobalData.factory("logTimeStampType",function(){return[{key:1,value:"HH:mm:ss"},{key:2,value:"HHmmss"}]}),GlobalData.factory("newLogDateStampType",function(){return[{key:"\\d{4}[-]\\d{2}[-]\\d{2}",value:"yyyy-mm-dd(适合2017-11-09)"},{key:"\\d{4}[.]\\d{2}[.]\\d{2}",value:"yyyy.mm.dd(适合2017.11.09)"},{key:"\\d{2}[.]\\d{2}[.]\\d{2}",
value:"yy.mm.dd(适合17.11.09)"},{key:"\\d{2}\\d{2}\\d{2}",value:"yymmdd(适合170911，171109等)"},{key:"\\d{4}\\d{2}\\d{2}",value:"yyyymmdd(适合20170911，20171109等)"}]}),GlobalData.factory("newLogTimeStampType",function(){return[{key:"[0-2][0-9][-][0-5][0-9][-][0-5][0-9]",value:"hh-mm-ss(适合12-20-30)，支持-分割"},{key:"[0-2][0-9][:][0-5][0-9][:][0-5][0-9]",value:"hh:mm:ss(适合12:20:30, 支持:分割)"},{key:"[0-2][0-9][:][0-5][0-9][:][0-5][0-9][.][1-9]{3}",value:"hh:mm:ss.SSS(适合12:20:30.222)"},{key:"[0-2][0-9][-][0-5][0-9][-][0-5][0-9][.][1-9]{3}",value:"hh-mm-ss.SSS(适合12-20-30.222)"},{key:"[0-2][0-9][0-5][0-9][0-5][0-9]",value:"hhmmss(适合122030)"},{key:"[0-2][0-9][0-5][0-9][0-5][0-9][.][1-9]{3}",value:"hhmmss.SSS(适合122030.123)"}]}),GlobalData.factory("ReportTemplateDateType",function(){return[{key:0,value:"日"},{key:1,value:"周"},{key:2,value:"月"}]}),GlobalData.factory("uploadType",function(){return[{key:1,value:"拉取"},{key:2,value:"本地上传"}]}),GlobalData.factory("logDateFormat",function(){return[{key:"YYYY-MM-DD",value:"YYYY-MM-DD"},{key:"YYYY/MM/DD",value:"YYYY/MM/DD"},{key:"yyyy-MM-dd",value:"yyyy-MM-dd"}]}),GlobalData.factory("logTimeFormat",function(){return[{key:"hh:mm:ss",value:"hh:mm:ss"},{key:"hh-mm-ss",value:"hh-mm-ss"}]}),GlobalData.factory("EnvType",function(){return[{key:1,value:"开发"},{key:2,value:"测试"},{key:3,value:"准生产"},{key:4,value:"生产"},{key:5,value:"SIT"},{key:6,value:"SAT"}]}),GlobalData.factory("LanguageName",function(){return[{key:14,value:"Java"},{key:7,value:"Python2"},{key:8,value:"Python3"}]}),GlobalData.factory("pluginExeEnv",function(){return[{key:1,value:"Linux"},{key:2,value:"Aix"},{key:3,value:"AS400"},{key:4,value:"HP-UX"},{key:5,value:"Windows"}]}),GlobalData.factory("operateSysBit",function(){return[{key:1,value:"不限"},{key:2,value:"32位"},{key:3,value:"64位"}]}),GlobalData.factory("pluginLibType",function(){return[{key:1,value:"PYTHON2"},{key:2,value:"PYTHON3"},{key:3,value:"EXE"},{key:4,value:"DLL"},{key:5,value:"SO"}]}),GlobalData.factory("pluginType",function(){return[{key:1,value:"dll"},{key:2,value:"so"},{key:3,value:"jar"},{key:4,value:"py"},{key:5,value:"bat"},{key:6,value:"vbs"},{key:7,value:"sh"},{key:8,value:"exe"}]}),GlobalData.factory("FlowType",function(){return[{key:1,value:"操作系统",flag:!1},{key:2,value:"文件存储",flag:!1},{key:3,value:"服务中间件",flag:!1},{key:4,value:"消息中间件",flag:!1},{key:5,value:"数据库",flag:!1},{key:6,value:"容器",flag:!1},{key:7,value:"应用系统",flag:!1},{key:8,value:"通用",flag:!1}]}),GlobalData.factory("AutoFlowOpType",function(){return[{key:1,value:"上传文件"},{key:2,value:"下传文件"},{key:3,value:"数据操作"},{key:4,value:"基础操作"},{key:5,value:"应用操作"},{key:6,value:"其他操作"}]}),GlobalData.factory("OpTaskStatus",function(){return[{key:1,value:"待执行"},{key:2,value:"执行中"},{key:3,value:"正常结束"},{key:4,value:"终止"},{key:5,value:"异常"}]}),GlobalData.factory("ExecuteType",function(){return[{key:1,value:"手动"},{key:2,value:"自动"}]}),GlobalData.factory("TaskType",function(){return[{key:1,value:"操作系统"},{key:2,value:"中间件"},{key:3,value:"数据库"}]}),GlobalData.factory("JobErrorType",function(){return[{key:1,value:"等待"},{key:2,value:"跳过"},{key:3,value:"重试"}]}),GlobalData.factory("PreJobErrorType",function(){return[{key:1,value:"跳过执行"},{key:2,value:"跳过等待"}]}),GlobalData.factory("dataBaseType",function(){return[{key:1,value:"Mysql"},{key:2,value:"DB2"},{key:3,value:"Oracle"},{key:4,value:"Sybase"},{key:5,value:"Informix"}]}),GlobalData.factory("FlowJobType",function(){return[{key:1,value:"开始"},{key:2,value:"结束"},{key:3,value:"作业分组"},{key:4,value:"条件"},{key:5,value:"中断"},{key:6,value:"轮询"},{key:7,value:"ftp文件上传"},{key:8,value:"ftp文件下传"},{key:9,value:"sftp文件上传"},{key:10,value:"sftp文件下传"},{key:11,value:"agent文件上传"},{key:12,value:"agent文件下传"},{key:13,value:"拷贝文件"},{key:14,value:"数据库"},{key:15,value:"数据库脚本"},{key:16,value:"网络配置"},{key:17,value:"应用启动"},{key:18,value:"应用停止"},{key:19,value:"Python脚本"},{key:20,value:"Shell脚本"},{key:21,value:"Bat脚本"},{key:24,value:"WebService"},{key:25,value:"Tcp"},{key:26,value:"HTTP"},{key:28,value:"CL"},{key:29,value:"RPG"},{key:30,value:"Java"},{key:31,value:"C"},{key:32,value:"C++"},{key:33,value:"site"},{key:34,value:"area"},{key:35,value:"cell"},{key:36,value:"unit"}]}),GlobalData.factory("FlowCategoryData",function(){return[{category:1,element_list:[{category:1,text:"ftp文件",type:7,sd_job_bean:{}},{category:1,text:"ftp文件",type:8,sd_job_bean:{}},{category:1,text:"sftp文件",type:9,sd_job_bean:{}},{category:1,text:"sftp文件",type:10,sd_job_bean:{}},{category:1,text:"agent文件",type:11,sd_job_bean:{}},{category:1,text:"agent文件",type:12,sd_job_bean:{}},{category:1,text:"拷贝文件",type:13,sd_job_bean:{}}]},{category:2,element_list:[{category:2,text:"数据库",type:14,sd_job_bean:{}},{category:2,text:"数据库脚本",type:15,sd_job_bean:{}}]},{category:3,element_list:[{category:3,text:"网络配置",type:16,sd_job_bean:{}}]},{category:4,element_list:[{category:4,text:"应用启动",type:17,sd_job_bean:{}},{category:4,text:"应用停止",type:18,sd_job_bean:{}}]},{category:5,element_list:[{category:5,text:"Python",type:19,sd_job_bean:{}},{category:5,text:"Shell",type:20,sd_job_bean:{}},{category:5,text:"Bat",type:21,sd_job_bean:{}},{category:5,text:"Java",type:30,sd_job_bean:{}},{category:5,text:"C",type:31,sd_job_bean:{}},{category:5,text:"C++",type:32,sd_job_bean:{}}]},{category:6,element_list:[{category:6,text:"WebService",type:24,sd_job_bean:{}},{category:6,text:"Tcp",type:25,sd_job_bean:{}},{category:6,text:"HTTP",type:26,sd_job_bean:{}}]},{category:7,element_list:[{category:7,text:"轮询",type:6,sd_job_bean:{}}]},{category:8,element_list:[{category:8,text:"CL",type:28,sd_job_bean:{}},{category:8,text:"RPG",type:29,sd_job_bean:{}}]}]}),GlobalData.factory("RequestMethod",function(){return[{key:1,value:"POST"},{key:2,value:"GET"}]}),GlobalData.factory("JobOpType",function(){return[{key:1,value:"执行"},{key:2,value:"完成"},{key:3,value:"跳过"},{key:4,value:"重试"},{key:5,value:"中止"}]}),GlobalData.factory("OpTaskState",function(){return[{key:1,value:"等待运行"},{key:2,value:"正在运行"},{key:3,value:"运行结束"}]}),GlobalData.factory("OpTaskExeStatus",function(){return[{key:1,value:"执行中"},{key:2,value:""},{key:3,value:"执行异常"},{key:4,value:"正常完成"},{key:5,value:"异常完成"},{key:6,value:"重试中"},{key:7,value:"任务暂停"},{key:8,value:"手动等待"},{key:9,value:"暂停等待"},{key:10,value:"执行失败"},{key:11,value:"排队中"}]}),GlobalData.factory("OpJobExeStatus",function(){return[{key:1,value:"未执行"},{key:2,value:"执行中"},{key:3,value:"成功"},{key:4,value:"异常"},{key:5,value:"跳过"},{key:6,value:"待重试"},{key:7,value:"失败"}]}),GlobalData.factory("OpMeddleType",function(){return[{key:1,value:"关闭任务"},{key:2,value:"暂停任务"},{key:3,value:"中止作业"},{key:4,value:"延时执行"},{key:5,value:"中止任务"},{key:6,value:"单步执行"},{key:7,value:"一键执行"},{key:8,value:"继续执行"},{key:9,value:"单个跳过"},{key:10,value:"重做作业"},{key:11,value:"重试作业"},{key:12,value:"重试作业链"},{key:13,value:"回收任务线程"},{key:14,value:"回收作业线程"},{key:15,value:"重做状态同步"},{key:16,value:"完成作业"}]}),GlobalData.factory("ParamValueSource",function(){return[{key:1,value:"固有"},{key:2,value:"引用"}]}),GlobalData.factory("ElementCategory",function(){return[{key:1,value:"文件"},{key:2,value:"数据库"},{key:3,value:"网络"},{key:4,value:"应用"},{key:5,value:"脚本"},{key:6,value:"服务调用"},{key:7,value:"轮询"},{key:8,value:"其他"}]}),GlobalData.factory("StrategyGroupType",function(){return[{key:1,value:"并行"},{key:2,value:"并发"},{key:3,value:"优先级"}]}),GlobalData.factory("StrategyPriority",function(){return[{key:1,value:"一"},{key:2,value:"二"},{key:3,value:"三"},{key:4,value:"四"},{key:5,value:"五"},{key:6,value:"六"},{key:7,value:"七"},{key:8,value:"八"},{key:9,value:"九"},{key:10,value:"十"}]}),GlobalData.factory("VersionEncodingData",function(){return["UTF-8","GBK"]}),GlobalData.factory("TempCompareData",function(){function a(a){d.push(a)}function b(){return d=[]}function c(){return d}var d=[];return{addItem:a,clearList:b,getList:c}}),GlobalData.factory("VersionStatus",function(){return[{key:1,value:"未入库"},{key:2,value:"正常"},{key:3,value:"已回退"}]}),GlobalData.factory("ScrollConfig",function(){return{axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}}}),GlobalData.factory("ScrollBarConfig",function(){var a={},b={theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}};return a.X=function(a){return angular.extend(b,{axis:"x",scrollbarPosition:a?a:"inside"})},a.Y=function(a){return angular.extend(b,{axis:"y",scrollbarPosition:a?a:"inside"})},a.XY=function(a){return angular.extend(b,{axis:"yx",scrollbarPosition:a?a:"inside"})},a}),GlobalData.factory("weekType",function(){return[{key:0,value:"星期日"},{key:1,value:"星期一"},{key:2,value:"星期二"},{key:3,value:"星期三"},{key:4,value:"星期四"},{key:5,value:"星期五"},{key:6,value:"星期六"}]}),GlobalData.factory("LetterNavList",function(){return[{letter:"A",list:[]},{letter:"B",list:[]},{letter:"C",list:[]},{letter:"D",list:[]},{letter:"E",list:[]},{letter:"F",list:[]},{letter:"G",list:[]},{letter:"H",list:[]},{letter:"I",list:[]},{letter:"J",list:[]},{letter:"K",list:[]},{letter:"L",list:[]},{letter:"M",list:[]},{letter:"N",list:[]},{letter:"O",list:[]},{letter:"P",list:[]},{letter:"Q",list:[]},{letter:"R",list:[]},{letter:"S",list:[]},{letter:"T",list:[]},{letter:"U",list:[]},{letter:"V",list:[]},{letter:"W",list:[]},{letter:"X",list:[]},{letter:"Y",list:[]},{letter:"Z",list:[]},{letter:"#",list:[]}]});var QRCodeLoginService=angular.module("QRCodeLoginService",[]);QRCodeLoginService.service("QRCodeLogin",["CallProvider","baseUrl",function(a,b){this.getQRCodeLoginImage=function c(d,e,f){a.call({actionName:"qr_GetQRCodeLoginImageNameAction.do",reqData:{submit_type:1}}).then(function(g){var h=g.imgName,i=b+"app/img/qrcode/"+g.imgName,j=h.substring(0,h.length-4);d&&d(i),function k(){a.call({actionName:"qr_GetLoginStatusForLongPollingAction.do",reqData:{submit_type:1,uuid:j}}).then(function(a){a&&0==a.loginStatus?k():a&&-1==a.loginStatus?c(d,e,f):a&&1==a.loginStatus&&e&&e(a.userLoginInOutputBean)},function(a){f&&f(a)})}()},function(a){f(a)})}}]),QRCodeLoginService.service("QRCodeLocalAuth",["CallProvider","baseUrl",function(a,b){this.getQRCodeLocalAuthImage=function c(d,e,f,g){var h={cancel:!1};return a.call({actionName:"qr_GetQRCodeLocalAuthImageNameAction.do",reqData:d}).then(function(i){var j=i.imgName,k=b+"app/img/qrcode/"+i.imgName,l=j.substring(0,j.length-4);e&&e(k),function m(){a.call({actionName:"qr_GetLocalAuthStatusForLongPollingAction.do",reqData:{submit_type:1,uuid:l}}).then(function(a){a&&0==a.status&&!h.cancel?m():a&&-1==a.status?c(d,e,f,g):a&&1==a.status&&f&&f(a.checkLocalAuthOutputBean)},function(a){g&&g(a)})}()},function(a){g&&g(a)}),h}}]);var comSrv=angular.module("FuncService",[]);comSrv.service("ProdFunc",["$timeout","$sce","ProdNodeState","ProdCmdState","IssueType","Modal","CV",function(a,b,c,d,e,f,g){var h=this;this.formatNodeStatus=function(a){for(var b=0;b<a.length;b++)a[b].node_status_cn=g.findValue(a[b].node_status,c)},this.formatCmdStatus=function(a){for(var c=0;c<a.length;c++){a[c].node_list=a[c].node_list?a[c].node_list:[];for(var e=0;e<a[c].node_list.length;e++)a[c].node_list[e].cmd_status_cn=g.findValue(a[c].node_list[e].node_status,d),a[c].node_list[e].exec_msg_detail=a[c].node_list[e].exe_msg?b.trustAsHtml(a[c].node_list[e].exe_msg.replace(/\n/g,"<br>")):""}return a},this.pushAllCanResetPhase=function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.phase_list.length;e++)d.phase_list[e].phase_status>1&&h.pushResetPhase(d.phase_list[e].phase_no,b,a)},this.pushResetPhase=function(a,b,c){for(var d=!1,e=0;e<b.length;e++)if(a==b[e].phase_no){d=!0;break}if(!d)for(var f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.phase_list.length;h++)a==g.phase_list[h].phase_no&&b.push(g.phase_list[h])},this.formatProblemType=function(a){for(var b="",c=0;c<a.length;c++)b+=g.findValue(a[c],e)+" ";return b},this.bindCurrPhaseAndStep=function(a,b,c){for(var d=0;d<b.length;d++)for(var e=b[d],f=0;f<e.phase_list.length;f++)a==e.phase_list[f].phase_no&&(c._phaseDesc=e.phase_list[f].phase_bk_desc)},this.getTimeUsed=function(a,b){var c=0;return angular.forEach(a,function(a){c+=a[b]}),Math.round(c)},this.dealPhaseNode=function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++){var f=b[e];d.exec_node_ip==f.exec_ip&&(f.is_show=!0,f.exec_node_ip=d.exec_node_ip,f.exec_protocol_type=d.exec_protocol_type,f.exec_soc_name=d.exec_soc_name,f.executeNodeMsgBean=d.executeNodeMsgBean,f.impl_type=d.impl_type,f.is_exec=d.is_exec,f.node_status=d.node_status,f.node_exec_seq=d.node_exec_seq,f.reset_flag=d.reset_flag,f.support_node_ip=d.support_node_ip?d.support_node_ip:"",f.support_protocol_type=d.support_protocol_type?d.support_protocol_type:"",f.support_soc_name=d.support_soc_name?d.support_soc_name:"",f.file_list=d.file_list?d.file_list:[])}},this.getTime=function(a){var b=new Date(a),a={};return a._year=b.getFullYear(),a._month=b.getMonth()+1<10?"0"+(b.getMonth()+1):b.getMonth()+1,a._date=b.getDate()<10?"0"+b.getDate():b.getDate(),a._hours=b.getHours()<10?"0"+b.getHours():b.getHours(),a._minutes=b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes(),a._seconds=b.getSeconds()<10?"0"+b.getSeconds():b.getSeconds(),a},this.dealSocList=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.lable=c.file_soc_username+"@"+c.ip,c.index=b}},this.processConfigData=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.phy_nodes&&c.logical_node)for(var d=0;d<c.phy_nodes.length;d++){var e=c.phy_nodes[d];if(e.files_list=[],c.logical_node.file_list)for(var f=0;f<c.logical_node.file_list.length;f++)e.files_list.push({file:c.logical_node.file_list[f],is_modify:!1})}}return a}}]),comSrv.service("IssuFunc",["$timeout","Program","SparamAuthType","Workorder","BusiSys","SqlExec","BucketType","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){var k=this;this.getNameBySysName=function(a,b){for(var c="",d=0;d<b.length;d++){var e=b[d];if(e.business_sys_name==a){c=e.business_cn_name;break}}return c},this.addNewFaultProgramStep=function(a,b,c){if(0!=a.step_list.length)for(var d=0;d<a.step_list.length;d++){var e=a.step_list[d];if(!e.step_bk_title||!e.sql_list||0==e.sql_list.length)return void i.alert("步骤信息不完整，无法添加步骤。");for(var f=0;f<e.sql_list.length;f++)if(e.sql_list[f].editable)return void i.alert("存在未提交的SQL，无法添加步骤。")}a.program_seq&&(a.step_list.push({step_seq:a.step_list.length+1,step_bk_title:"",pg_source:c,sql_list:[],step_exist:!1}),a.pg_source=c,b.add_step_by_hand_flag=1==c?!1:!0,b.batch_select_add_btn_flag=3==c?!1:!0),b.batch_import_btn_flag=!0},this.saveFaultProgramStep=function(a,c,d){var e=a.step_list[c];return j.valiForm(e.new_step_form)?(e.step_valid=!0,b.addProgramStep(a.program_seq,e.step_seq,e.step_bk_title,e.pg_source).then(function(a){a&&(0==e.sql_list.length&&(e.sql_list=[],e.step_exist=!0,e.sql_form_show=!1,e.new_sql_btn=!0,e.step_save_btn=!1),e.old_step_bk_title=e.step_bk_title,d.program_is_ok=!1)},function(a){i.alert(a.message)}),void(a.next_step=a.step_list.length+1)):!1},this.refreshFaultProgramStep=function(d,e,f,g){b.getProgramAllInfoAndStepList(d).then(function(b){a(function(){if(b){e.program_bk_desc=b.program_bk_desc,e.program_seq=d,e.program_name=b.program_name,e.tran_flag=1,e.pg_source=b.pg_source,e.step_list=b.program_step_list?b.program_step_list:[],e.next_step=e.step_list.length+1;for(var a=0;a<e.step_list.length;a++){var h=e.step_list[a];h.pg_source=e.pg_source,h.show_detail=!1,h.step_exist=!0,h.step_btn_save=!0,h.new_sql_btn=!0,h.old_step_bk_title=h.step_bk_title,h.program_sql_list=h.program_sql_list||[],h.sql_list=h.program_sql_list;for(var i=0;i<h.sql_list.length;i++){var j=h.sql_list[i];j.sql_param_btn=!0,j.editable=!1,j.sql_seq=parseInt(j.sql_seq),j.pg_source=b.pg_source?b.pg_source:1,j.sys_name_text=k.getNameBySysName(j.sys_name,g),j.sql_param_list=j.sql_param_list?j.sql_param_list:[],j.param_list=j.sql_param_list;for(var l=0;l<j.param_list.length;l++){var m=j.param_list[l];m.param_auth_list=m.param_auth_list?m.param_auth_list:[];for(var n=0;n<m.param_auth_list.length;n++)m.param_auth_list[n].sparam_auth_list=c}}}1==e.pg_source?(f.add_step_by_hand_flag=!1,f.batch_import_btn_flag=!0,f.batch_select_add_btn_flag=!0):3==e.pg_source?(f.batch_select_add_btn_flag=!1,f.add_step_by_hand_flag=!0,f.batch_import_btn_flag=!0):(f.add_step_by_hand_flag=!1,f.batch_import_btn_flag=!1,f.batch_select_add_btn_flag=!1),f.program_info_loading=!1}},0)},function(a){i.alert(a.message)})},this.showFaultProgramPreviewBtn=function(a,b){if(0!=a.step_list.length){var c=a.step_list[0];c.sql_list&&(b.program_preview_btn=!0)}else b.program_preview_btn=!1},this.deleteUnSaveProgramStep=function(a,b,c,d){d.stopPropagation(),a.step_list.splice(b-1,1),a.step_list&&0!=a.step_list.length?(c.add_step_by_hand_flag=1==a.pg_source?!1:!0,c.batch_select_add_btn_flag=3==a.pg_source?!1:!0):(c.add_step_by_hand_flag=!1,c.batch_import_btn_flag=!1,c.batch_select_add_btn_flag=!1)},this.addStepSqlForm=function(a,b,c,d){var e=a.step_list[b];return j.valiForm(e.new_step_form)?void i.addSQL(a.program_seq,c,"",2).then(function(b){b&&(e.sql_list.push({editable:!0,sql_text:b.sql_txt,sys_name:b.sys_name,soc_name:b.soc_name,sys_name_text:k.getNameBySysName(b.sys_name,c),sql_param_list:b.sql_param_list,param_list:b.sql_param_list,pg_source:a.pg_source}),d.sql_form_show=!1,d.new_sql_btn=!1,d.show_detail=!1)}):!1},this.saveFaultProgramStepSqlParam=function(a,c,d,e,f){for(var g=!0,h=a.step_list[c],j=h.sql_list[d],l=0,m=j.param_list.length;m>l;l++){var n=j.param_list[l];if(!n.sparam_cn_name){i.alert("请填写"+n.sparam_name+"参数中文名"),j.btn_program_step_sql_param_loading=!1,g=!1;break}if(!n.sparam_type){i.alert("请选择"+n.sparam_name+"参数类型"),j.btn_program_step_sql_param_loading=!1,g=!1;break}if(1!==n.sparam_type&&!n.sparam_scope){i.alert("请配置"+n.sparam_name+"参数"),j.btn_program_step_sql_param_loading=!1,g=!1;break}}g&&(j.btn_program_step_sql_param_loading=!0,b.addProgramStepSqlParam(a.program_seq,h.step_seq,j.sql_seq,j).then(function(b){j.btn_program_step_sql_param_loading=!1,b&&(h.new_sql_btn=!0,j.sql_seq=b.sql_seq,e.sql_param_btn=!0,e.editable=!1,k.showFaultProgramPreviewBtn(a,f))},function(a){j.btn_program_step_sql_param_loading=!1,i.alert(a.message)}))},this.deleteSqlInProgramStep=function(a,c,d,e){var f=a.step_list[c],g=f.sql_list[d];g.sql_seq?i.confirm("请确定是否要删除当前的SQL?").then(function(){b.deleteProgramStepSql(a.program_seq,f.step_seq,g.sql_seq).then(function(a){a&&(f.sql_list.splice(d,1),e.program_is_ok=!1)},function(a){i.alert(a.message)})}):(f.sql_list.splice(d,1),f.new_sql_btn=!0)},this.validFaultProgramAllSqlSubmit=function(a){for(var b,c=0;c<a.step_list.length;c++){var d=a.step_list[c];if(0==d.sql_list.length)return b=1;for(var e=0;e<d.sql_list.length;e++)if(!d.sql_list[e].sql_param_btn)return b=2}},this.initWorkOrderInfo=function(a,b,c){return a={workorder_type:c?c:1,order_bk_title:"",order_seq:"",urgency_level:1,urgency_state:!1,trouble_key:"",sys_name:"",order_bk_desc:""},b&&(a.deal_dept_id=b,a.deal_user_id=""),a},this.quitHandleBtnControl=function(a){for(var b=0,c=0,d=a.sql_steps.length;d>c;c++){var e=a.sql_steps[c];if(1==a.basicData.sqlexe_type){if(e.pend_work_seq&&e.sql_state<2||e.is_generate_sql_author){b++;break}}else if(e.pend_work_seq&&!e.exe_success){b++;break}}a.hide_no_handle_btn=0!=b?!0:!1},this.finishHandleBtnControl=function(a){for(var b=0,c=0;c<a.sql_steps.length;c++){var d=a.sql_steps[c];if(1==a.basicData.sqlexe_type){if(1==d.sql_state||d.is_generate_sql_author){b=1;break}}else if(2==a.basicData.sqlexe_type)d.exe_success&&b++;else for(var c=0;c<a.sql_steps.length;c++)a.sql_steps[c].act_exec_time&&b++}1==a.basicData.sqlexe_type?a.finish_handle_btn=1!=b&&0!=a.sql_steps.length?!0:!1:a.finish_handle_btn=b==a.sql_steps.length&&0!=a.sql_steps.length?!0:!1},this.sqlHandleAllSubmitBtnControl=function(a){for(var b=0,c=0,d=0;d<a.sql_steps.length;d++){var e=a.sql_steps[d];if(1!=e.priv_yn_flag&&c++,1!=e.sql_state){b=0,a.show_all_submit_btn=!1;break}b++}0!=b&&(a.show_all_submit_btn=!0),c==a.sql_steps.length&&(a.show_all_submit_btn=!1)},this.sqlBucketTranslateCnType=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.bucket_cn_type=j.findValue(c.bucket_type,g)}},this.addSqlText=function(a){i.addSQL("",[],a,1).then(function(b){var c={sql_steps:b.sql_steps?b.sql_steps:[]};angular.forEach(c.sql_steps,function(b){b.generate_sql={generate_sql_list:[]},b.scroll_config_info=h.X(),a.sql_steps.push(b)}),a.is_import=!1,a.basicData.sqlexe_type=1,k.sqlBucketTranslateCnType(c.sql_steps),k.sqlHandleAllSubmitBtnControl(c),k.quitHandleBtnControl(a),k.finishHandleBtnControl(a)})},this.deleteHandleSqlText=function(b,c,d,e){i.confirm("确认删除sql语句["+b+"]?").then(function(g){g&&f.deleteSql(c).then(function(c){a(function(){c&&(i.alert(b+" 删除成功！"),d.sql_steps.splice(e,1),k.sqlHandleAllSubmitBtnControl(d),k.quitHandleBtnControl(d),k.finishHandleBtnControl(d))},0)},function(a){i.alert(a.message)})})},this.getSqlMsgList=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.success_flag)for(var e={theads:d.theads?d.theads:[],tbodys:d.tbodys,sql_type:d.sql_type},f=0;f<b.length;f++){var g=b[f];d.sql_work_seq==g.sql_work_seq&&(g.submit_table_data=1==d.sql_type?e:{},g.sql_state=d.sql_state,g.sql_type=d.sql_type,g.act_bk_num=d.act_bk_num,g.act_exec_time=d.act_exec_time,g.read_only=g.read_only?g.read_only:!1,g.can_insert=d.can_insert)}else for(var h=0;h<b.length;h++){var g=b[h];d.sql_work_seq==g.sql_work_seq&&(g.sql_state=d.sql_state,g.error_message=d.error_message,g.act_exec_time=d.act_exec_time)}}},this.sqlExeTimeUsedFmt=function(a){var b="";return 1e3>a?b=a+"ms":(b=Math.floor(a/1e3)+"s",b>60&&(b=Math.floor(a/1e3)/60+"min")),b},this.setPrimaryKeySort=function(a){for(var b=0,c=0;b<a.length;b++)a[b].primary_key&&(a[b]=[a[c],a[c]=a[b]][0],c++);return a},this.createPageNumberByData=function(b,c){var d=Math.ceil(c[0].total_page/10),e=4>d?d:4;if(b.page)b.page.numbers=d;else{b.page={numbers:d,current_page:0,show_page:[]};for(var f=0;e>f;f++)b.page.show_page.push({key:f+1,value:f})}a(function(){b.page_number_show=!0},1e3)}}]),comSrv.service("InspFunc",[function(){}]),comSrv.service("CmptFunc",["$timeout",function(a){var b=this,c=function(a){return a?new RegExp("\\$\\{\\s*\\w+\\.\\w+\\s*\\}+","g"):new RegExp("\\$\\{\\s*\\w+\\s*\\}+","g")};this.arrayRemoveRepeat=function(a){if(a.length>0){for(var b=0,c={};b<a.length;b++)void 0===c[a[b]]&&(c[a[b]]=1);a=[];for(var d in c)a.push(d)}return a},this.getParamsByScript=function(a,d){for(var e=b.arrayRemoveRepeat(a.match(c(!1))?a.match(c(!1)):[]),f=[],g=0;g<e.length;g++){var h=["node_config_file","backup_file_name","node_config_local","project_name","update_local_dir","script_file","script_str"];h=d?h.concat(d):h;var i=e[g].substring(2,e[g].length-1);-1==h.indexOf(i)&&f.push({param_group:"",param_name:i})}var j=[];return j=j.concat(f),{list:j}},this.cmdsToString=function(a){var b="";if(a.length>0){for(var c=0;c<a.length-1;c++)b+=a[c]+"\n";b+=a[a.length-1]}return b},this.stringToCmds=function(a){return a.split("\n")},this.refreshParamList=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++){var e=b[d];e.param_name===a[c].param_name&&(e.param_group=a[c].param_group,a[c]=e)}return a},this.bindRefParamDesc=function(a,b){if(0!=a.length)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++){var f=b[e].param_name;d.ref==f&&(d.ref_index=e)}},this.handleSourceList=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push({phase_no:c+1,gen_flag:1,impl_type:d.impl_type,srv_soc:d.srv_soc,package_names:d.package_names})}return b},this.initOpeSysState=function(a){for(var b=0;b<a.length;b++)a[b].state=!1},this.judgeShowDetail=function(a){var b=0;if(a.length>0)if(1==a.length)b=a[0].show_detail?2:0;else{for(var c=1;c<a.length;c++){var d=a[c-1].show_detail;if(d!=a[c].show_detail)return b=1}b=a[a.length-1].show_detail?2:0}return b},this.expandAllModules=function(a){for(var b=2,c=0;c<a.length;c++)a[c].show_detail=!0;return b},this.closeAllModules=function(a){for(var b=0,c=0;c<a.length;c++)a[c].show_detail=!1;return b},this.blurGetParams=function(c,d,e){return c.msg?(d.script_msg=c.msg,e.cmpt_save_disabled=!0,!1):(e.cmpt_get_param_loading=!0,void a(function(){d.script_msg="",e.cmpt_save_disabled=!1,d.param_list=b.refreshParamList(c.list,d.param_list),e.cmpt_get_param_loading=!1},500))},this.CommandBlurGetParams=function(c,d,e){return c.msg?(d.script_msg=c.msg,e.cmpt_save_disabled=!0,!1):(e.cmpt_command_param_loading=!0,void a(function(){d.script_msg="",e.cmpt_save_disabled=!1,d.command_param_list=b.refreshParamList(c.list,d.command_param_list),e.cmpt_command_param_loading=!1},500))},this.getOldExecParamList=function(a){for(var b=[],c=0;c<a.list.length;c++)b.push({param_group:a.list[c].param_group,param_name:a.list[c].param_name});return b},this.changeCheckBoxDisabled=function(a,b,c){if(2==a.key)a.state?(b.cmpt_type_disabled=!0,b.cmpt_group_type_disabled=!0):(b.cmpt_type_disabled=!1,b.cmpt_group_type_disabled=!0);else{b.cmpt_type_collect=!1,b.cmpt_group_type_collect=!1;for(var d=c,e=0;e<d.length;e++)if(d[e].state){b.cmpt_type_collect=!0,b.cmpt_group_type_collect=!0;break}}},this.judgeShowCheckCmpt=function(a){for(var b=!1,c=0;c<a.length;c++)if(1===a[c]){b=!0;break}return b},this.translatePluginHint=function(a){for(var b=[],c=0;c<a.length;c++)a[c].plugin_name&&b.push({key:"${"+a[c].plugin_name+"}",text:"${"+a[c].plugin_name+"} [插件]"});return b},this.translateGrammarHint=function(a){for(var b=[],c=0;c<a.length;c++)a[c].grammar&&b.push({key:a[c].grammar,text:a[c].grammar+"["+a[c].explain+"]"});return b},this.translateAllParam=function(a){for(var b=[],c=0;c<a.length;c++)0==a[c].flag?b.push({key:"${"+a[c].key+"}",text:"${"+a[c].key+"} [发布包参数]"}):b.push({key:"${"+a[c].key+"}",text:"${"+a[c].key+"} [全局参数]"});return b},this.judgeFileType=function(a){var b="";if("sh"==a)b="SHELL";else if("py"==a)b="PYTHON";else if("xml"==a)b="XML";else if("tar"==a)b="TAR";else{if("xlsx"!=a&&"xls"!=a)return b;b="EXCEL"}return b}}]),comSrv.service("BsysFunc",["$sce","CmptFunc",function(a,b){var c=this;this.stateTransformData=function(a,b){a.soc_list=[],angular.forEach(b,function(b){b.checked&&a.soc_list.push(b.soc_name)})},this.getObjIndex=function(a,b){for(var c=0;c<a.length;c++)if(a[c].soc_name==b)return c},this.getAllParam=function(a,b){for(var c=[],d=[],e=0;e<b.length;e++)d.push(b[e].type_name);for(var e=0;e<a.length;e++)c.push(a[e].param_name);return c.concat(d)},this.judgeRefParam=function(a,b){for(var c=0;c<b.length;c++)if(a==b[c].param_name)return!0},this.dealPhase=function(a){for(var b=0;b<a.length;b++)a[b].logical_node=a[b].logical_node?a[b].logical_node:{};return a},this.dealSoc=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.ver_soc_name=c.support_soc_name,c.exe_soc_name=c.execute_soc_name,c.exe_ip=c.execute_ip,c.ver_ip=c.support_ip,c.exe_protocol_type=c.execute_protocol_type,c.ver_protocol_type=c.support_protocol_type,a[b].exe_soc_list)for(var d=0;d<a[b].exe_soc_list.length;d++)a[b].exe_soc_list[d].soc_name==a[b].exe_soc_name&&(a[b].exe_protocol_type=a[b].exe_soc_list[d].protocol_type);if(a[b].ver_soc_list)for(var d=0;d<a[b].ver_soc_list.length;d++)a[b].ver_soc_list[d].soc_name==a[b].ver_soc_name&&(a[b].ver_protocol_type=a[b].ver_soc_list[d].protocol_type)}return a},this.bindRefParam=function(a,b,c){for(var d=0;d<a.length;d++)for(var e=0;e<a[d].phase_list.length;e++){var f=a[d].phase_list[e];if(1==f.phase_type||2==f.phase_type){for(var g=0;g<b.length;g++)if(0!=f.ref_param_list.length)for(var h=0;h<f.ref_param_list.length;h++)f.ref_param_list[h].ref==b[g].param_name&&(f.ref_param_list[h].ref_index=g);for(var g=0;g<c.length;g++)if(0!=f.ref_param_list.length)for(var h=0;h<f.ref_param_list.length;h++)f.ref_param_list[h].ref==c[g].type_name&&(f.ref_param_list[h].ref_index=g)}}},this.chooseAgentSoc=function(a){for(var b=new RegExp("agent"),c="",d=0;d<a.length;d++)b.test(a[d])&&(c=a[d]);return c},this.resetRefParamsList=function(a,b){for(var c=0;c<b.length;c++)for(var d=b[c],e=0;e<a.length;e++)if(d.ref_param_list)for(var f=0;f<d.ref_param_list.length;f++)d.ref_param_list[f].ref==a[e].type_name&&(d.ref_param_list[f].ref="")},this.invertSelectionPac=function(a,b){a=a||[],b=b||[];for(var c=a.length-1;c>=0;c--)for(var d=0;d<b.length;d++)if(a[c]==b[d].type_name){b[d].state=!0;break}},this.invertSelectionConfig=function(a,b){a=a||[],b=b||[];for(var c=a.length-1;c>=0;c--)for(var d=0;d<b.length;d++)if(a[c]==b[d].file_name){b[d].state=!0;break}},this.filterGobalParam=function(a){a=a||[];for(var b=[],c=0;c<a.length;c++){var d=a[c];3!=d.param_type&&b.push(d)}return b},this.processProgDate=function(d,e,f){for(var g=0;g<d.length;g++){var h=d[g];h.nav_show_flag=0,h.expand_flag=!1;var i=h.pac_type_list||[],j=h.config_file_list||[];3==h.group_type&&(h.temp_pac_type_list=e?angular.copy(e):[],h.temp_config_file_list=f?angular.copy(f):[]),c.invertSelectionPac(i,h.temp_pac_type_list),c.invertSelectionConfig(j,h.temp_config_file_list);for(var k=0;k<h.phase_list.length;k++)h.phase_list[k].script&&h.phase_list[k].script.cmds&&(h.phase_list[k].exec_script=b.cmdsToString(h.phase_list[k].script.cmds)),h.phase_list[k].logical_node&&(h.phase_list[k].logical_node_id=h.phase_list[k].logical_node.logical_node_id),6==h.phase_list[k].phase_type&&(h.phase_list[k].url_detail=a.trustAsHtml(h.phase_list[k].script.cmds[0])),h.phase_list[k].command&&h.phase_list[k].command.cmds&&(h.phase_list[k].command.exec_script=b.cmdsToString(h.phase_list[k].command.cmds))}}}]);var cvDirectives=angular.module("CvDirectives",[]);cvDirectives.directive("fileUpload",["baseUrl","$timeout","Modal","CV",function(a,b,c,d){return{restrict:"AE",templateUrl:"templates/directives/upload_file.html",replace:!0,require:"fileUpload",scope:{fileupload:"=fileupload",deletefile:"&deletefile",downfile:"&downfile",onSuccess:"&successthen"},controller:["$scope","FileUploader","baseUrl",function(a,b,c){a.uploader=new b({url:c+"fileupload?uploadPath="+a.fileupload.uploadpath,autoUpload:!0})}],link:function(e,f,g,h){var i,j=e.uploader,k=e.fileupload.suffixs?e.fileupload.suffixs.split(","):[];e.fileupload.candown=g.downfile?!0:!1,e.fileupload.candelete=g.deletefile?!0:!1,e.exsit_package=g["package"]?!0:!1,j.filters.push({name:"suffixFilter",fn:function(a){return 0==k.length?!0:-1==k.indexOf(a.name.split(".")[a.name.split(".").length-1].toLowerCase())?(c.alert("文件名后缀限定为["+k.toString().replace(","," 或 ")+"]格式！"),!1):!0}}),j.filters.push({name:"pathFilter",fn:function(a){return e.fileupload.uploadpath?!0:(c.alert(a.name+"("+Math.round(a.size/1e3)+"KB)上传地址未就绪！"),!1)}}),j.filters.push({name:"repeatFilter",fn:function(a){return g["package"]&&-1!=e.fileupload.filenames.indexOf(a.name)?(c.alert(a.name+"文件已存在！"),!1):!0}}),e.$watch("fileupload.uploadpath",function(b){j.url=a+"fileupload?uploadPath="+b}),j.onWhenAddingFileFailed=function(a,b,c){},j.onAfterAddingAll=function(){i=c.loading("文件上传中...")},j.onCompleteAll=function(){b(function(){i.close(),e.onSuccess()},1e3)},j.onSuccessItem=function(a,b,c,d){-1!=b.indexOf("true")&&(g["package"]?e.fileupload.filenames.push(a.file.name):e.fileupload.filename=a.file.name)},j.onErrorItem=function(a,b,d,f){i.close(),j.queue.length=0,e.fileupload.filename="",c.alert("文件上传失败: "+d)},e.deletefiles=function(a){if(g["package"]){var b=e.fileupload.filenames.indexOf(a);e.fileupload.filenames.splice(b,1)}else e.deletefile()},e.downfiles=function(a){if(g["package"]){var b=e.fileupload.uploadpath+"/"+a;d.downloadFile(b)}else e.downfile()}}}}]),cvDirectives.directive("excelImport",["baseUrl","Modal",function(a,b){return{restrict:"AE",templateUrl:"templates/directives/import_excel.html",replace:!0,scope:{fileupload:"=fileupload",onSuccess:"&successthen"},controller:["$scope","FileUploader","baseUrl",function(a,b,c){a.uploader=new b({url:c+"fileupload?uploadPath="+a.fileupload.uploadpath,autoUpload:!0})}],link:function(c,d,e,f){var g=c.uploader,h=c.fileupload.suffixs?c.fileupload.suffixs.split(","):[];g.filters.push({name:"suffixFilter",fn:function(a){return 0==h.length?!0:-1==h.indexOf(a.name.split(".")[1])?(b.alert("文件名后缀限定为["+h.toString().replace(","," 或 ")+"]格式！"),!1):!0}}),c.$watch("fileupload.uploadpath",function(b){
g.url=a+"fileupload?uploadPath="+b}),g.onWhenAddingFileFailed=function(a,b,c){},g.onSuccessItem=function(a,d,e,f){-1!=d.indexOf("true")?(c.fileupload.filename=a.file.name,c.onSuccess()):b.alert(c.fileupload.filetype+"上传失败")},g.onErrorItem=function(a,d,e,f){g.queue.length=0,c.fileupload.filename="",b.alert("文件上传失败: "+e)}}}}]),cvDirectives.directive("importInstance",["baseUrl","Modal",function(a,b){return{restrict:"AE",templateUrl:"templates/directives/import_instance.html",replace:!0,scope:{fileupload:"=fileupload",onSuccess:"&successthen"},controller:["$scope","FileUploader","baseUrl",function(a,b,c){a.uploader=new b({url:c+"fileupload?uploadPath="+a.fileupload.uploadpath,autoUpload:!0})}],link:function(c,d,e,f){var g=c.uploader,h=c.fileupload.suffixs?c.fileupload.suffixs.split(","):[];g.filters.push({name:"suffixFilter",fn:function(a){return 0==h.length?!0:-1==h.indexOf(a.name.split(".")[1])?(b.alert("文件名后缀限定为["+h.toString().replace(","," 或 ")+"]格式！"),!1):!0}}),c.$watch("fileupload.uploadpath",function(b){g.url=a+"fileupload?uploadPath="+b}),g.onWhenAddingFileFailed=function(a,b,c){},g.onSuccessItem=function(a,d,e,f){-1!=d.indexOf("true")?(c.fileupload.filename=a.file.name,c.onSuccess()):b.alert(c.fileupload.filetype+"上传失败")},g.onErrorItem=function(a,d,e,f){g.queue.length=0,c.fileupload.filename="",b.alert("文件上传失败: "+e)}}}}]),cvDirectives.directive("ensureExist",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e,f=c.ensureExist;if(-1!=c.ensureExist.indexOf("|")){var g=c.ensureExist.split("|");e=g[1].trim(),f=g[0].trim()}var h=f.split("."),i=function(a,b,c){var d=!1;if(b){for(var e=0;e<c.length;e++)if(c[e][b]==a){d=!0;break}}else-1!=jQuery.inArray(a,c)&&(d=!0);return""==a?!0:d};"dynamic"==e?(b.on("blur",function(){a[f]().then(function(a){d.$setValidity("unexist",!0)},function(a){d.$setValidity("unexist",!1)})}),b.on("focus",function(){d.$setValidity("unexist",!0)})):a.$watch(function(){return-1!=f.indexOf(".")?a[h[0]][h[1]]:a[f]},function(b){0!=b.length&&a.$watch(c.ngModel,function(a){return angular.isUndefined(a)?!1:void d.$setValidity("unexist",i(a,e,b))})})}}}),cvDirectives.directive("ensureProjUnique",["$timeout","Proj","Modal",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(c,d,e,f){var g,h=3e3,i=function(b,c){g=a(function(){k(b,c)},h)},j=function(){g&&a.cancel(g)},k=function(a,c){a&&c&&b.uniqueProj(a,c).then(function(a){a.result?f.$setValidity("unique",!1):f.$setValidity("unique",!0)},function(a){})};c.$watch(function(){return c.info||c.quick_prod_info},function(a,b){(a.project_name&&a.business_sys_name&&a.project_name.length>0&&a.business_sys_name.length>0&&a.project_name!=b.project_name||a.business_sys_name!=b.business_sys_name)&&(j(),i(a.project_name,a.business_sys_name))},!0)}}}]),cvDirectives.directive("ensureUnique",["$timeout","Task","Modal",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(d,e,f,g){e.on("blur",function(){a(function(){var a=g.$modelValue,d="";if(angular.isUndefined(a)||""==a)return!1;if(-1!=f.ensureUnique.indexOf("|")){var e=f.ensureUnique.split("|")[0].trim();d=f.ensureUnique.split("|")[1].trim()}else var e=f.ensureUnique;d!=a&&b.ExecuteTask({data:a},e).then(function(a){a.result?g.$setValidity("unique",!1):g.$setValidity("unique",!0)},function(a){c.alert(a.message)})},0)}),e.on("focus",function(){g.$setValidity("unique",!0)})}}}]),cvDirectives.directive("ensureOnly",["Task","CV","$timeout","Modal",function(a,b,c){return{restrict:"A",require:"ngModel",link:function(a,b,d,e){b.on("blur",function(){c(function(){var b=e.$modelValue;if(angular.isUndefined(b)||""==b)return!1;var c=d.ensureOnly.split("|")||[],f=c[0].trim(),g=c[1]?c[1].trim():"",h=a.$eval(f),i=0,j=0,k=e.$name.charAt(e.$name.length-1).replace(/[^0-9]+/g,"");k&&(i=1);for(var l=0;l<h.length;l++){var m=g?h[l][g]:h[l];m===b&&j++}j>i?e.$setValidity("only",!1):e.$setValidity("only",!0)},0)}),b.on("focus",function(){e.$setValidity("only",!0)})}}}]),cvDirectives.directive("validateMsg",["$compile",function(a){return{restrict:"E",link:function(b,c,d){var e=[{key:"required",error:"$error.required",text:"不能为空"},{key:"ng-minlength",error:"$error.minlength",text:"最小长度限制[?]个字符"},{key:"ng-maxlength",error:"$error.maxlength",text:"最大长度限制[?]个字符"},{key:"ng-pattern",error:"$error.pattern",text:"不符合命名规范"},{key:"ensure-unique",error:"$error.unique",text:"已经存在"},{key:"ensure-only",error:"$error.only",text:"已经存在"},{key:"ensure-exist",error:"$error.unexist",text:"不存在"},{key:"ensure-proj-unique",error:"$error.unique",text:"项目已经存在"}],f="",g=d.tagCnName,h=d.name,i=d.type?d.type:"text",j=d.model,k=c.parents("form").attr("name")+"."+h,l=function(a){var b='<div ng-if="'+k+".$dirty && "+k+'.$invalid" style="color: #e9416e; list-style: none; padding: 0px 0 0 0;">',c=k+"."+e[0].error;b+='<li ng-show="'+c+'">'+g+e[0].text+"</li>";for(var d=1;d<e.length;d++){var f=e[d];("undefined"!=typeof a.attr(f.key)||a.attr("type")==f.key)&&(b+='<li ng-show="'+k+"."+f.error+"&&!"+c+'">'+g+f.text.replace("?",a.attr(f.key))+"</li>")}return b+="</div>"};"checkbox"==i?(c.before(a('<input ng-repeat="i in [1]" type="text" name="'+h+'" ng-model="'+j+'.str" style="display: none;" required/>')(b)),f=l(c.before()),b.$watch(function(){return b.$eval(j)},function(a){a&&(a.str=a.join(","))},!0)):"radio"==i?(c.before(a('<input ng-repeat="i in [1]" type="text" name="'+h+'" ng-model="'+j+'" style="display: none;" required/>')(b)),f=l(c.before())):"select"==i?(c.before(a('<input ng-repeat="i in [1]" type="text" name="'+h+'" ng-model="'+j+'" style="display: none;" required/>')(b)),f=l(c.before())):f=l(c.parent().children().first()),f&&c.append(a(f)(b))}}}]),cvDirectives.directive("bsSelect",["$compile","$timeout",function(a,b){return{restrict:"E",scope:{items:"=",selectedItem:"=mySelect",doSelect:"&selectVal",isDisable:"=disable",loading:"="},templateUrl:"templates/directives/bs_select_template.html",link:function(a,c,d){var e=d.optionKey,f=!0;a.has_opacity=""===d.opacity||"true"===d.opacity?!0:!1,a.has_noborder=""===d.noBorder||"true"===d.noBorder?!0:!1,a.init_label=d.initLabel?d.initLabel:"请选择",a.realItems=[],a.has_opacity&&(c.on("mouseenter",".btn-group",function(){$(this).css("opacity",1)}),c.on("mouseleave",".btn-group",function(){$(this).css("opacity",.3)})),a.scroll_config_info={axis:"xy",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}},a.changeUlStyle=function(){return a.realItems.length>5?{height:"160px","min-width":"100%"}:{height:30*a.realItems.length+15+"px","min-width":"100%"}},a.widthStyle=function(){if(a.has_noborder)return{width:d.width?d.width+"px":""};var b=d.width?d.width:c.children().width();return b=!d.maxWidth||b<d.maxWidth?b:d.maxWidth,{width:b-26+"px"}},$(window).resize(function(){if(!d.width){var a=c.children().width()-52;c.find("Button").first().width(a)}}),a.opacityStyle=function(){return{opacity:a.has_opacity?"0.3":"1"}};var g=function(b){a.init_label=e&&-1!=b.indexOf("  [")?b.substring(0,b.indexOf("  [")):b},h=function(){if(a.realItems=[],e)for(var b=d.optionLabal.replace(" ","").split(","),c=0;c<a.items.length;c++){var f=a.items[c];a.realItems.push({key:f[e],value:f[b[0]]+(f[b[1]]?"  ["+f[b[1]]+"]":"")})}else if(a.items.length>=1&&angular.isString(a.items[0]))for(var c=0;c<a.items.length;c++)a.realItems.push({key:a.items[c],value:a.items[c]});else for(var c=0;c<a.items.length;c++)a.realItems.push(a.items[c]);d.emptyOption&&a.realItems.push({key:"",value:d.emptyOption})},i=function(){if(h(),d.emptyOption&&g(d.emptyOption),!d.emptyOption&&1==a.realItems.length&&f){var c=a.realItems[0];a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key,selectValue:c.value})},0),f=!1}if(a.realItems.length>1)for(var e=0;e<a.realItems.length;e++){var c=a.realItems[e];if(c.key===a.selectedItem){g(c.value);break}e==a.realItems.length-1&&c.key!=a.selectedItem&&(a.init_label="请选择")}};a.selectVal=function(c){f=!1,a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key,selectValue:c.value})},0)},a.$watch(function(){return a.selectedItem},function(a){return(void 0===a||""===a)&&g(d.emptyOption?d.emptyOption:"请选择"),f?void(a&&i()):!1}),a.$watch(function(){return a.items},function(a){a&&(f=!0,i())},!0)}}}]),cvDirectives.directive("fileBrowse",["$compile",function(a){return{restrict:"E",scope:{node:"=",changePath:"&",deleteFile:"&"},link:function(b,c,d){var e=""===d.check||"true"===d.check||"1"===d.check?1:"2"===d.check?2:!1,f="1"===d.radiocheck?1:2,g="1"===d.allowmodify?1:2,h=b.node.path_files;1==g?b.node.checked_files=b.node.checked_files?b.node.checked_files:[]:b.node.checked_files=[],b.node.deleted_files=[];var i=!1;b.path_flag=!1;var j="",k=b.node.init_path;k=k.length>1&&k.lastIndexOf("/")==k.length-1?k.slice(0,k.length-1):k;var l=k.lastIndexOf("/");k?-1==l?(b.node.paths=[k],b.path_flag=!0):1==k.length&&0==l?(b.node.paths=["/"],b.path_flag=!0):0==l?(j="/",b.node.paths=[k.slice(1)]):(j="/",b.node.paths=k.slice(1).split("/")):b.node.paths=[],b.node.full_path=k,b.node.is_dir=!0;var m=1,n=[],o=function(a){a.length>=100*m?(b.node.path_files_short=a.slice(0,100*m),b.node.show_more=!0,m+=1):(m=1,b.node.show_more=!1,b.node.path_files_short=a)};b.goMore=function(){o(0==n.length?b.node.path_files:n)},b.customConfig={axis:"y",theme:"custom-dark",scrollbarPosition:"outside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}};var p=["<div>",'<ol class="breadcrumb" style="margin-bottom: 0;background:#091118">','<input type="text" class="form-control" ng-model="node.search_key_word"  placeholder="文件名" ng-enter="searchByKeyword()"  style="background:#091016;width: 52px;padding:2px;position: absolute; right: 16px;top: 5px;height: 24px;">','<li class="active">文件路径：&nbsp;</li>','<li ><a ng-click="goback($index)" style="cursor: pointer;">/&nbsp;</a></li>','<li ng-if="!path_flag" ng-repeat="path in node.paths track by $index"><a ng-click="goback($index)" ng-bind="path" style="cursor: pointer;"></a><span ng-if="!$last" style="color: #ccc;padding: 0 0px;">/</span></li>','<li ng-if="path_flag && !$first" ng-repeat="path in node.paths track by $index"><a ng-click="goback($index)" ng-bind="path" style="cursor: pointer;"></a><span ng-if="!$last" style="color: #ccc;padding: 0 0px;">/</span></li>',"</ol>",'<ol ng-show="node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 20px;">','<i class="fa fa-spinner fa-spin" style="font-size: 30px; color: #44dcfd;"></i>',"</li>","</ol>",'<ol ng-show="node.paths.length == 0 && !node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 18px; color: #999;">','<span style="color: #FF9933;" ng-bind="node.err_msg"></span> ',"</li>","</ol>",'<ol class="file_list" style="max-height: 400px; padding-left: 0px;" ng-if="node.paths.length != 0 && !node.loading" custom-scroll custom-config="customConfig">','<li style="height: 24px; line-height: 24px; list-style: none;" ng-if="node.paths.length > 1">','<i class="" style="margin-right: 10px; color: #FFF;"></i><a style="cursor: pointer;" title="上一层" ng-click="goprev();">..</a>',"</li>",'<li ng-repeat="file in node.path_files_short" class="li-file" '+(i?'ng-style="liStyle(file);" ng-mouseover="file.hover = true;" ng-mouseout="file.hover = false;"':"")+">",1==e?'<input type="checkbox" i-check ng-model="file.checked" ng-change="checkFile(file);">':2==e?'<input type="checkbox" ng-if="!file.dir" i-check ng-model="file.checked" ng-change="checkFile(file);"><div ng-if="file.dir" style="display: inline-block;margin-left:18px;"></div>':1==f?'<input type="radio" i-check ng-if="!file.dir" ng-model="file.checked" name="radio_check" value="$index" ng-change="checkRadioFile(file);">':"",,'<div style="display: inline-block;">','<i ng-if="file.dir" class="fa fa-folder-open" style="margin-left: 10px; color: #EAC344; display: block; padding-bottom: 4px;"></i>','<i ng-if="!file.dir" class="fa fa-file-text-o" style="margin-left: 10px; color: #44dcfd; display: block; padding-bottom: 4px;"></i>','<a ng-if="file.edit_flag && file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofront(file);" ng-style="fileStyle(file.modified_flag, file.checked);" ng-bind="file.file"></a>','<a ng-if="file.edit_flag && !file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofile(file);" ng-style="fileStyle(file.modified_flag, file.checked);" ng-bind="file.file"></a>','<span ng-if="!file.edit_flag" style="color: #44dcfd;display: block; word-wrap: break-word;padding-left: 30px;margin-top: -25px;" ng-bind="file.file"></span>',"</div>",i?"<i class='fa li-file-trash' ng-class='trashClass(file);' ng-style='trashStyle(file);' ng-click='delete(file);'></i>":"","</li>",'<li ng-if="node.path_files_short.length != 0 && node.show_more" class="li-file ng-scope" ng-click="goMore()"><a style="cursor: pointer;">加载更多...</a></li>','<li ng-if="node.path_files_short.length == 0" style="list-style: none;text-align: center; color: #ccc;height: 140px;line-height: 140px;font-size: 16px;">暂无文件信息</li>',"</ol>","</div>"].join("");c.append(a(p)(b));var q=function(){b.path_flag?b.node.full_path=j+b.node.paths.join("/").slice(1):b.node.full_path=j+b.node.paths.join("/"),b.changePath()};b.liStyle=function(a){return a.hover?{background:"#EFEFEF"}:{background:"#FFF"}},b.fileStyle=function(a,b){var c={};return c.color=a?"#E3AC36":"#428bca",c.fontWeight=b?"bolder":"",c},b.trashStyle=function(a){return a.hover?{color:"#666"}:{color:"#FFF"}},b["delete"]=function(a){a.hover=!0,b.node.parent_path=j+b.node.paths.join("/"),b.node.full_path=j+b.node.paths.join("/")+"/"+a.file,b.node.is_dir=a.dir,b.deleteFile()},b.searchByKeyword=function(){if(n=[],b.node.search_key_word){for(var a=0;a<h.length;a++){var c=h[a].file;-1!=c.indexOf(b.node.search_key_word)&&n.push(h[a])}o(n)}else b.changePath()},b.checkFile=function(a){if(a.checked)b.node.checked_files.push({file:a.file,path:j+b.node.paths.join("/")});else{for(var c=-1,d=0;d<b.node.checked_files.length;d++){var e=b.node.checked_files[d];e.file===a.file&&(c=d)}b.node.checked_files.splice(c,1)}},b.checkRadioFile=function(a){for(var c=0;c<b.node.path_files.length;c++){var d=b.node.path_files[c];a.file!=d.file&&(d.checked=!1)}b.node.checked_files=[],a.checked&&b.node.checked_files.push({file:a.file,path:j+b.node.paths.join("/")})},b.trashClass=function(a){return a.deleted?"fa-reply":"fa-trash-o"},b.goprev=function(){b.node.paths.length>1&&b.goback(b.node.paths.length-2)},b.goback=function(a){b.node.is_dir=!0,b.node.paths.splice(a+1),0==b.node.paths.length&&(b.node.paths=["/"],b.path_flag=!0),q()},b.gofront=function(a){b.node.is_dir=!0,b.node.paths.push(a.file),q()},b.gofile=function(a){b.node.full_path=j+b.node.paths.join("/")+"/"+a.file,b.node.full_path=b.node.full_path.replace(/\/*/,"/"),b.node.is_dir=!1,b.changePath()},b.$watch("node.path_files",function(){if(!b.node.path_files)return!1;for(var a=0;a<b.node.path_files.length;a++){for(var c=b.node.path_files[a],d=0;d<b.node.checked_files.length;d++)b.node.checked_files[d].file===c.file&&(c.checked=!0);for(var d=0;d<b.node.deleted_files.length;d++)b.node.deleted_files[d].file===c.file&&(c.deleted=!0)}}),b.$watch("node.path_files",function(){n=[],h=b.node.path_files,b.node.path_files&&o(b.node.path_files)}),b.changePath(),""==b.node.full_path&&b.goback(0)}}}]),cvDirectives.directive("iCheck",["$timeout","$parse",function(a,b){return{require:"ngModel",link:function(c,d,e,f){return a(function(){var a,g,h,i=$(d);return"radio"===i.attr("type")?a=b(e.ngValue)(c)?b(e.ngValue)(c):e.value:(g=e.ngTrueValue,h=e.ngFalseValue),c.$watch(e.ngModel,function(a){i.iCheck("update")}),i.iCheck({radioClass:"iradio_minimal-blue",checkboxClass:"icheckbox_minimal-blue",increaseArea:"20%"}).on("ifChanged",function(d){return"checkbox"===i.attr("type")?c.$apply(function(){return g&&h?d.target.checked?(b(e.ngModel).assign(c,g),f.$setViewValue(g)):(b(e.ngModel).assign(c,h),f.$setViewValue(h)):f.$setViewValue(!b(e.ngModel)(c))}):"radio"===i.attr("type")&&d.target.checked?c.$apply(function(){return f.$setViewValue(a)}):void 0})})}}}]),cvDirectives.directive("programStepForm",["$timeout","$parse","$compile","CV",function(a,b,c,d){return{restrict:"E",templateUrl:"templates/modal/program_step_form.html",scope:{data:"=data",authFlag:"=flag",submitMethod:"&submitMethod",viewAuthDetail:"&viewAuth"},link:function(a,b,c){a.read_only=c.detail?!0:a.data.stepFormLock,a.show_btn=c.showbtn,a.param_obj_list=[],a.getCheckTestInfo=function(a,b){return{top:(1==a?25:31)+33*(Math.ceil(b/3)-1)+"px"}};for(var e=0,f=a.data.sql_list?a.data.sql_list.length:0;f>e;e++){var g=a.data.sql_list[e],h=g.sql_param_list?g.sql_param_list:[];a.param_obj_list.push({sql_index:e,param_list:h,sql_text:g.sql_text})}a.closePgTask=function(){a.submitMethod()},a.changeCheckbox=function(a,b){if(a.checked)b.col_type="string"==typeof a.key?1:2,b.sparam_scope_list_key.push(a.key),b.sparam_scope_list_val.push(a.value);else for(var c=0;c<b.sparam_scope_list_key.length;c++)b.sparam_scope_list_key[c]==a.key&&(b.sparam_scope_list_key.splice(c,1),b.sparam_scope_list_val.splice(c,1))};for(var i=0;i<a.param_obj_list.length;i++)for(var j=a.param_obj_list[i].param_list,e=0;e<j.length;e++){var k=j[e];if(k.tag_ng_model="",k.sparam_value=k.sparam_value?k.sparam_value:"",k.tag_cn_name=k.sparam_cn_name?k.sparam_cn_name:"",k.sparam_scope_list=[],1!=k.sparam_type&&5!=k.sparam_type&&(k.sparam_scope_list=angular.fromJson(k.sparam_scope)),3==k.sparam_type){var l=k.sparam_value.split(",");k.sparam_scope_list_key=[],k.sparam_scope_list_val=[];for(var m=0;m<k.sparam_scope_list.length;m++)for(var n=0;n<l.length;n++)l[n]==k.sparam_scope_list[m].key&&(k.sparam_scope_list[m].checked=!0,k.sparam_scope_list_key.push(k.sparam_scope_list[m].key),k.sparam_scope_list_val.push(k.sparam_scope_list[m].value))}else 4==k.sparam_type?(a.data.select_items=k.sparam_scope_list,k.tag_ng_model=d.findValue(k.sparam_value,k.sparam_scope_list)):2==k.sparam_type?k.tag_ng_model=k.sparam_value:1==k.sparam_type&&(k.tag_ng_model=k.sparam_value)}a.viewAuthPro=function(){a.viewAuthDetail()},a.noParamSubmit=function(){a.btnBusLoading=!0,a.submitMethod()},a.FormSubmit=function(){if(a.authFlag.btn_loading=!0,!d.valiForm(a.pgForm))return a.authFlag.btn_loading=!1,!1;for(var b=0;b<a.param_obj_list.length;b++)for(var c=a.param_obj_list[b].param_list,e=0;e<c.length;e++){var f=c[e];3==f.sparam_type?(f.sparam_value=f.sparam_scope_list_key.join(","),f.sparam_value_text=f.sparam_scope_list_val.join(",")):2==f.sparam_type||4==f.sparam_type?(f.sparam_value=f.tag_ng_model,f.sparam_value_text=d.findValue(f.sparam_value,f.sparam_scope_list)):5==f.sparam_type?(f.sparam_value=f.sparam_scope,f.sparam_value_text=f.sparam_scope):(f.sparam_value=f.tag_ng_model,f.sparam_value_text=f.tag_ng_model)}for(var e=0;e<a.param_obj_list.length;e++)a.data.sql_list[a.param_obj_list[e].sql_index].sql_param_list=a.param_obj_list[e].param_list;a.submitMethod(),a.$watch("data.stepFormLock",function(){a.read_only=a.data.stepFormLock}),a.$watch("authFlag.btn_loading",function(){},!0)},c.detail||a.$watch("data.stepFormLock",function(){a.read_only=a.data.stepFormLock})}}}]),cvDirectives.directive("schemeParamTab",["$timeout","$parse","$compile","CV","Modal",function($timeout,$parse,$compile,CV,Modal){return{restrict:"E",templateUrl:"templates/directives/param_auth_tb.html",replace:"true",link:function(scope,elem,attrs){scope.form={},scope.param_key_value_type=[{key:1,value:"整型"},{key:2,value:"字符串"}];for(var i=0;i<scope.sql.param_list.length;i++)if(scope.sql.param_list[i].auth_show=!1,scope.sql.param_list[i].param_show=!1,scope.sql.param_list[i].param_key_value_list=[],scope.sql.editable=0==scope.sql.editable?scope.sql.editable:!0,scope.sql.param_list[i].old_auth_bk_expl=scope.sql.param_list[i].auth_bk_expl,scope.sql.param_list[i].old_param_auth_list=scope.sql.param_list[i].param_auth_list,scope.sql.param_list[i].param_auth_list)if(0!=scope.sql.param_list[i].param_auth_list.length){scope.sql.param_list[i].success_flag=!0;for(var j=0;j<scope.sql.param_list[i].param_auth_list.length;j++)scope.sql.param_list[i].param_auth_list[j].auth_dprl_code&&scope.getSqlParamAuthRoleByDept(scope.sql.param_list[i].param_auth_list[j].auth_dept_id,j,i,scope.sql.param_list[i].param_auth_list[j])}else scope.sql.param_list[i].success_flag=!1;else scope.sql.param_list[i].success_flag=!1;scope.showParamType=function(index){scope.sql.param_list[index].param_show=!0,scope.sql.param_list[index].auth_show=!1;for(var i=0;i<scope.sql.param_list.length;i++)i!=index&&(scope.sql.param_list[i].param_show=!1);if(scope.sql.param_list[index].sparam_scope){scope.sql.param_list[index].param_key_value_list=eval(scope.sql.param_list[index].sparam_scope);var _key=scope.sql.param_list[index].param_key_value_list[0].key,_value=scope.sql.param_list[index].param_key_value_list[0].value;"number"==typeof _key&&_key%1===0?(scope.sql.param_list[index].param_key_type=1,scope.sql.param_list[index].old_param_key_type=1):(scope.sql.param_list[index].param_key_type=2,scope.sql.param_list[index].old_param_key_type=2),"number"==typeof _value&&_value%1===0?(scope.sql.param_list[index].param_value_type=1,scope.sql.param_list[index].old_param_value_type=1):(scope.sql.param_list[index].param_value_type=2,scope.sql.param_list[index].old_param_value_type=2)}},scope.changeKeyValue=function(a,b){if(b.old_param_key_type&&b.old_param_key_type!=b.param_key_type)for(var c=0;c<b.param_key_value_list.length;c++)b.param_key_value_list[c].key="";b.old_param_key_type=a},scope.changepParamValue=function(a,b){if(b.old_param_value_type&&b.old_param_value_type!=b.param_value_type)for(var c=0;c<b.param_key_value_list.length;c++)b.param_key_value_list[c].value="";b.old_param_value_type=a},scope.showAuth=function(a){scope.sql.param_list[a].auth_bk_expl=angular.copy(scope.sql.param_list[a].old_auth_bk_expl),scope.sql.param_list[a].param_auth_list=angular.copy(scope.sql.param_list[a].old_param_auth_list),scope.sql.param_list[a].auth_show=!scope.sql.param_list[a].auth_show,scope.sql.param_list[a].param_show=!1;for(var b=0;b<scope.sql.param_list.length;b++)b!=a&&(scope.sql.param_list[b].auth_show=!1)},scope.removeAuthList=function(a,b){scope.sql.param_list[b].param_auth_list.splice(a,1),0==scope.sql.param_list[b].param_auth_list.length&&(scope.sql.param_list[b].success_flag=!1)},scope.addAuthList=function(a){scope.noParamList=!1,scope.sql.param_list[a].param_auth_list||(scope.sql.param_list[a].param_auth_list=[]);var b=scope.sql.param_list[a].param_auth_list.length;if(0==b)scope.sql.param_list[a].param_auth_list.push({condition_seq:1,condition_text:"",auth_dprl_code:"",sparam_auth:"",sparam_auth_list:scope.data.auth_type,auth_dept_id:"",authRole:[]});else{var c=scope.sql.param_list[a].param_auth_list[b-1];""==c.condition_text||""==c.sparam_auth||""==c.auth_dept_id||""==c.auth_dprl_code?Modal.alert("请完善上一授权条件"):2==c.sparam_auth?scope.sql.param_list[a].param_auth_list.push({condition_seq:1,condition_text:"",auth_dprl_code:"",sparam_auth:"",sparam_auth_list:[{key:2,value:"远程授权"}],auth_dept_id:"",authRole:[]}):scope.sql.param_list[a].param_auth_list.push({condition_seq:1,condition_text:"",auth_dprl_code:"",sparam_auth:"",sparam_auth_list:scope.data.auth_type,auth_dept_id:"",authRole:[]})}},scope.removeKeyValueList=function(a,b){scope.sql.param_list[b].param_key_value_list.splice(a,1)},scope.addParamKeyValueList=function(a){return scope.sql.param_list[a].param_value_type&&scope.sql.param_list[a].param_key_type?void scope.sql.param_list[a].param_key_value_list.push({key:"",value:""}):(Modal.alert("请先选择键值对类型"),!1)},scope.loadauthRoleData=function(a,b,c){scope.sql.param_list[c].param_auth_list[b].auth_dprl_code="",scope.getSqlParamAuthRoleByDept(a,b,c,scope.sql.param_list[c].param_auth_list[b])},scope.formcancel=function(a,b){if(scope.sql.param_list[a].auth_bk_expl){if(scope.noParamList=!1,!CV.valiForm(scope.sql.param_list[a].param_auth_form))return scope.btnBus_loading=!1,!1;if(!scope.sql.param_list[a].param_auth_list)return scope.noParamList=!0,!1;if(0==scope.sql.param_list[a].param_auth_list.length)return scope.noParamList=!0,!1;scope.sql.param_list[a].auth_show=!1,scope.sql.param_list[a].success_flag=!0,scope.sql.param_list[a].old_auth_bk_expl=scope.sql.param_list[a].auth_bk_expl,scope.sql.param_list[a].old_param_auth_list=scope.sql.param_list[a].param_auth_list}else scope.sql.param_list[a].old_auth_bk_expl=scope.sql.param_list[a].auth_bk_expl="",scope.sql.param_list[a].old_param_auth_list=scope.sql.param_list[a].param_auth_list=[],scope.sql.param_list[a].auth_show=!1,scope.noParamList=!1},scope.formParamKeyValueCancel=function(a){if(scope.sql.editable){if(!CV.valiForm(scope.sql.param_list[a].param_key_value_form))return scope.btnBus_loading=!1,!1;if(0==scope.sql.param_list[a].param_key_value_list.length)return Modal.alert("请添加参数值！"),!1;if(2==scope.sql.param_list[a].sparam_type&&scope.sql.param_list[a].param_key_value_list.length<2)return Modal.alert("参数类型为单选框，参数值需配置两条！"),!1;for(var b=0;b<scope.sql.param_list[a].param_key_value_list.length;b++)1==scope.sql.param_list[a].param_key_type&&(scope.sql.param_list[a].param_key_value_list[b].key=parseInt(scope.sql.param_list[a].param_key_value_list[b].key)),1==scope.sql.param_list[a].param_value_type&&(scope.sql.param_list[a].param_key_value_list[b].value=parseInt(scope.sql.param_list[a].param_key_value_list[b].value));scope.sql.param_list[a].sparam_scope=angular.toJson(scope.sql.param_list[a].param_key_value_list)}scope.sql.param_list[a].param_show=!1,scope.sql.param_list[a].param_key_value_list=[],scope.sql.param_list[a].param_value_type="",scope.sql.param_list[a].param_key_type=""},scope.changeParamType=function(a,b){scope.sql.param_list[b].sparam_scope="",scope.sql.param_list[b].param_key_value_list=[]},scope.borderParamStyle=function(a){return scope.sql.param_list[a].param_show?{border:"1px solid #555f76"}:{}},scope.borderAuthStyle=function(a){return scope.sql.param_list[a].auth_show?{border:"1px solid #555f76","border-bottom":"none"}:{}}}}}]),cvDirectives.directive("editableTable",["$timeout","$parse","$compile","ScrollBarConfig","Modal","CV",function(a,b,c,d,e,f){return{restrict:"E",scope:{data:"=tableData",read_only:"=readOnly",can_insert:"=canInsert",resetBack:"&resetAll"},templateUrl:"templates/directives/editable_table.html",link:function(a,b,c){a.$watch(function(){return a.data},function(b){if(b&&b.tbodys&&b.theads){for(var c=0;c<b.theads.length;c++){var d=b.theads[c];d.key=d.key.toLowerCase(),d.primary_key=d.primary_key?d.primary_key:!1,a.read_only?d.read_only=!0:d.read_only=b.read_only?!0:d.read_only?d.read_only:!1,d.display=d.display?d.display:!0}for(var c=0;c<b.tbodys.length;c++){for(var e=b.tbodys[c],f=0;f<b.theads.length;f++){var d=b.theads[f];e["original_"+d.key]=e[d.key],e[d.key+"modify_flag"]=!1,e["updating_"+d.key]=!1}e.row_status=1,e.checked=!1}}}),a.$watch(function(){return a.read_only},function(b){if(b)for(var c=0;c<a.data.theads.length;c++){var d=a.data.theads[c];d.read_only=!0}}),a.updateTd=function(b,c,d){for(var e=a.data.tbodys[b],f=!1,g=0;g<a.data.theads.length;g++){var h=a.data.theads[g];if(e[h.key]!==e["original_"+h.key]){f=!0,e[h.key+"modify_flag"]=!0;break}}f&&3!=e.row_status&&(e.row_status=2),e["updating_"+c]=!1},a.undoAllLines=function(){if(a.resetBack())for(var b=0;b<a.data.tbodys.length;b++){var c=a.data.tbodys[b];3==c.row_status&&a.data.tbodys.splice(b,1);for(var d=0;d<a.data.theads.length;d++){var e=a.data.theads[d];c["original_"+e.key]&&(c[e.key]=c["original_"+e.key],c["updating_"+e.key]=!1)}c.row_status=1,c.checked=!1}},a.newLine=function(){for(var b={checked:!1,row_status:3},c=0;c<a.data.theads.length;c++){var d=a.data.theads[c];b[d.key]="",b["original_"+d.key]="",b["updating_"+d.key]=!0}a.data.tbodys.push(b)},a.deleteLines=function(){for(var b=0;b<a.data.tbodys.length;b++){var c=a.data.tbodys[b];c.checked&&(3==c.row_status?a.data.tbodys.splice(b,1):(c.row_status=4,c.checked=!1))}},a.tdStyle=function(a,b){var c={};return a[b.key]!==a["original_"+b.key]&&(c.color="#339900",c.background="#0f161f"),4==a.row_status&&(c.background="#6d7183",c["text-decoration"]="line-through"),c}}}}]),cvDirectives.directive("workOrderFlow",["$timeout","$parse","$compile","CV",function(a,b,c,d){return{restrict:"E",templateUrl:"templates/directives/work_order_flow.html",replace:"true",scope:{flowList:"=data"},link:function(a,b,c){a.flowCircleStyle=function(a,b){return{position:"absolute",height:"10px",width:"10px","background-color":a.deal_time?"#43fc8c":"#999999","border-radius":"5px",top:60*b+"px"}},a.flowTypeStyle=function(a){return{position:"relative",left:"-100px",top:"-4px",width:"140px",color:a.deal_time?"#43fc8c":"#999999"}},a.flowLineStyle=function(b,c){return{position:"relative",height:"60px",width:"2px","background-color":b.deal_time&&a.flowList[c+1].deal_time?"#43fc8c":"#999999",top:b.deal_time?"-43px":"-68px",left:"4px"}}}}}]),cvDirectives.directive("proBsSelect",["$compile","$timeout",function(a,b){return{restrict:"E",scope:{items:"=",selectedItem:"=mySelect",doSelect:"&selectVal",isDisable:"=disable",loading:"="},templateUrl:"templates/modal/bs_select_template.html",link:function(a,c,d){var e=d.optionKey,f=!0;a.has_opacity=""===d.opacity||"true"===d.opacity?!0:!1,a.has_noborder=""===d.noBorder||"true"===d.noBorder?!0:!1,a.init_label=d.initLabel?d.initLabel:"--- 请选择 ---",a.realItems=[],a.has_opacity&&(c.on("mouseenter",".btn-group",function(){$(this).css("opacity",1)}),c.on("mouseleave",".btn-group",function(){$(this).css("opacity",.3)})),a.scroll_config_info={axis:"xy",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1},mouseWheel:{preventDefault:!0}},a.changeUlStyle=function(){return a.realItems.length>5?{height:"160px","min-width":"100%"}:{height:30*a.realItems.length+15+"px","min-width":"100%"}},a.widthStyle=function(){var b=d.width?d.width:$(".default-width").width();return{width:(a.has_noborder?b:b-26)+"px"}},a.opacityStyle=function(){return{opacity:a.has_opacity?"0.3":"1"}};var g=function(b){a.init_label=e&&-1!=b.indexOf("  [")?b.substring(0,b.indexOf("  [")):b,$(".button-label",c).attr("title",e&&-1!=b.indexOf("  [")?b.substring(0,b.indexOf("  [")):b)},h=function(){if(a.realItems=[],e)for(var b=d.optionLabal.replace(" ","").split(","),c=0;c<a.items.length;c++){var f=a.items[c];a.realItems.push({key:f[e],value:f[b[0]]+(f[b[1]]?"  ["+f[b[1]]+"]":"")})}else if(a.items.length>=1&&angular.isString(a.items[0]))for(var c=0;c<a.items.length;c++)a.realItems.push({key:a.items[c],value:a.items[c]});else for(var c=0;c<a.items.length;c++)a.realItems.push(a.items[c]);d.emptyOption&&a.realItems.push({key:"",value:d.emptyOption})},i=function(){if(h(),d.emptyOption&&g(d.emptyOption),!d.emptyOption&&1==a.realItems.length&&f){var c=a.realItems[0];a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key})},0),f=!1}if(a.realItems.length>1)for(var e=0;e<a.realItems.length;e++){var c=a.realItems[e];if(c.key===a.selectedItem){g(c.value);break}e==a.realItems.length-1&&c.key!=a.selectedItem&&(a.init_label="--- 请选择 ---")}};a.selectVal=function(c){f=!1,a.selectedItem=c.key,g(c.value),b(function(){a.doSelect({selectKey:c.key})},0)},a.$watch(function(){return a.selectedItem},function(a){a&&i()}),a.$watch(function(){return a.items},function(a){a&&(f=!0,i())},!0)}}}]),cvDirectives.directive("phaseDiagram",function(){return{restrict:"E",template:"<div></div>",replace:!0,scope:{model:"=goModel",projs:"=projData",read_only:"=readOnly"},link:function(a,b,c){function d(b,c){for(var d=0;d<a.model.linkDataArray.length;d++){var e=a.model.linkDataArray[d];if(e.from==c.data.key&&e.to==b.data.key)return!1}return a.$apply(),!0}function e(b){
b.isTransactionFinished&&a.$applyAsync()}function f(b){h.model.selectedNodeData=null;for(var c=h.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){h.model.selectedNodeData=d.data;break}}a.$applyAsync()}var g=go.GraphObject.make,h=g(go.Diagram,b[0],{initialContentAlignment:go.Spot.Top,allowCopy:!1,autoScrollRegion:10,"animationManager.isEnabled":!1,ModelChanged:e,isReadOnly:a.read_only?!0:!1,"undoManager.isEnabled":!0});h.groupTemplate=g(go.Group,"Vertical",{locationSpot:go.Spot.Top,locationObjectName:"HEADER",minLocation:new go.Point(0,0),maxLocation:new go.Point(9999,0),selectionObjectName:"HEADER",deletable:!1},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),g(go.Panel,"Auto",{name:"HEADER"},g(go.Shape,"RoundedRectangle",{parameter1:10,desiredSize:new go.Size(200,50),fill:"#66D2E5",stroke:null}),g(go.TextBlock,{margin:5,font:"14px Microsoft YaHei"},new go.Binding("text","text")))),h.nodeTemplate=g(go.Node,"Horizontal",{locationSpot:go.Spot.Right,locationObjectName:"SHAPE",isShadowed:!0,shadowOffset:new go.Point(3,2),copyable:!1,deletable:!1,movable:!0,linkValidation:function(a,b,c,e,f){return d(a,c)}},new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),g(go.Panel,"Auto",g(go.Shape,"Ellipse",new go.Binding("fill","color"),{portId:"",name:"SHAPE",desiredSize:new go.Size(36,36),strokeWidth:0,cursor:"pointer",fromLinkable:!0,toLinkable:!0,fromLinkableSelfNode:!1,toLinkableSelfNode:!1,fromLinkableDuplicates:!1,toLinkableDuplicates:!1}),g(go.TextBlock,new go.Binding("text","name"),{editable:!1,font:"18px Arial",stroke:"white",margin:new go.Margin(6,0,0,2)})),g(go.TextBlock,new go.Binding("text","text"),{editable:!1,font:"14px Microsoft YaHei",stroke:"#6695B5",shadowVisible:!1,width:180,margin:new go.Margin(6,0,0,10)})),h.linkTemplate=g(go.Link,{relinkableFrom:!0,relinkableTo:!0,fromLinkableDuplicates:!1,toLinkableDuplicates:!1,isShadowed:!0,shadowOffset:new go.Point(2,2)},g(go.Shape,{isPanelMain:!0,stroke:"#336281",strokeWidth:2}),g(go.Shape,{toArrow:"standard",stroke:"#336281",strokeWidth:2})),a.$watch("model",function(a){var b=h.model;b!==a&&(h.removeDiagramListener("ChangedSelection",f),h.model=a,h.addDiagramListener("ChangedSelection",f))})}}}),cvDirectives.directive("dynaHeight",function(){return{link:function(a,b,c){var d=c.initBottom?c.initBottom:200,e=parseInt($(b).css("top")),f=function(a){$(b).css("height",$(window).height()-a-(isNaN(e)?0:e))};$(window).resize(function(){setTimeout(function(){f(d)},50)}),a.resetHandle=function(a){d=a,f(d)},f(d)}}}),cvDirectives.directive("dynamicPosition",function(){return{link:function(a,b,c){var d=parseInt($(".ui-view-content").height()),e=d,f=function(a){$(b).css("marginTop",isNaN(a)?0:a-310)};$(window).resize(function(){setTimeout(function(){e=parseInt($(".ui-view-content").height()),f(e)},50)}),f(d)}}}),cvDirectives.directive("dynaTop",function(){return{link:function(a,b,c){a.heights.push($(b).offset().top)}}}),cvDirectives.directive("rowPlus",["$timeout","$compile",function(a,b){return{restrict:"A",replace:!1,scope:{rowPlus:"&",tblData:"="},link:function(a,c,d){var e='<tfoot>   <tr>\n       <td style="text-align: center;" colspan='+(c.find("thead > tr > td").length-1)+'><span ng-if="tblData && tblData.length == 0" style="color: #999;">暂无数据</span></td>\n       <td style="text-align: center;"><a class="add_line" style="cursor: pointer;"><i class="fa fa-plus" style="color: #99CCFF;"></i>&nbsp;新增</a></td>\n   </tr>\n</tfoot>\n';c.find("thead").after(b(e)(a)),c.find(".add_line:first").on("click",function(){a.$apply(function(){a.rowPlus()})})}}}]),cvDirectives.directive("subFormControl",function(){return{restrict:"C",replace:!1,require:"ngModel",link:function(a,b,c,d){var e=function(a){var b=$(a);b.prop("disabled")||b.addClass("is-focused")},f=function(a){$(a).removeClass("is-focused")};b.on("focus",function(){e(this)}),b.on("blur",function(){f(this)})}}}),cvDirectives.directive("naviPlus",["$timeout","$window","$compile",function(a,b,c){return{scope:{naviList:"="},link:function(b,d,e){var f,g=""===e.top||"true"===e.top?!0:!1,h=""===e.bottom||"true"===e.bottom?!0:!1,i=angular.isString(e.text)?e.text:"",j=angular.isString(e.taget)?e.taget:"",k=[];b.resList=[];var l=['<div class="navi-plus">',g?'<div class="oth" title="到页面顶部" ng-click="scollLimit(0);"><i class="fa fa-angle-double-up"></i></div>':"",'   <div class="lis" id="{{navi.id}}" ng-repeat="navi in resList" ng-click="scollTo(navi, $event, $index);">{{navi.id}}</div>',h?'<div class="oth" title="到页面底部" ng-click="scollLimit(9999);"><i class="fa fa-angle-double-down"></i></div>':"","</div>"].join("");d.append(c(l)(b)),b.$watch(function(){return b.naviList.length},function(a){if(a&&a>0)if(b.resList=[],b.naviList.length<=7)for(var c=0;c<b.naviList.length;c++)b.resList.push({id:c+1,title:b.naviList[c][i]});else if(b.naviList.length>7)for(var d=Math.ceil(b.naviList.length/7),c=0;c<b.naviList.length;c+=d){for(var e=[],f=0;d>f;f++)b.naviList[c+f]&&e.push("【"+(c+f+1)+"】"+b.naviList[c+f][i]);b.resList.push({id:c+1,title:e.join(",   ")})}});var m=function(){k=$(document).find(".navi-plus .lis");for(var a=0;a<k.length;a++){var b=$(k[a]),c=$("#"+j+(b.attr("id")-1));$(window).scrollTop()>=c.offset().top?b.css({"background-color":"#3399CC",color:"#FFF"}):b.css({"background-color":"#EEE",color:"#999"})}};$(window).scroll(function(){a.cancel(f),f=null,f=a(function(){m()},100)}),$(document).on("mouseenter",".navi-plus .lis",function(){var a=$(this).index();$(this).html(b.resList[a-1].title).css({"min-width":"200px",width:12*b.resList[a-1].title.length,padding:"0 10px","background-color":"#3399CC",color:"#FFF"})}),$(document).on("mouseleave",".navi-plus .lis",function(){var a=$(this).index();$(this).html(b.resList[a-1].id).css({width:30,"min-width":"0",padding:0}),m()}),b.scollTo=function(a,c,d){$("html,body").animate({scrollTop:$("#"+j+(a.id-1)).offset().top+1}),$(c.target).html(b.resList[d-1].id).css({width:30,"min-width":"0",padding:0})},b.scollLimit=function(a){$("html,body").animate({scrollTop:a})},b.$on("$destroy",function(){$(document).off("mouseenter",".navi-plus .lis"),$(document).off("mouseleave",".navi-plus .lis")})}}}]),cvDirectives.directive("toggleButton",["$compile",function(a){return{replace:!0,scope:{checked:"=",doChange:"&",disabled:"@"},link:function(b,c,d){c.css("line-height","24px");var e='<div class="togglebutton"><label style="font-size: 12px; color: #d2f1fe;">'+("left"===d.side&&d.text?'<span style="-webkit-padding-end:10px;margin-right: 15px">'+d.text+"</span>":"")+'<input type="checkbox" ng-model="checked" ng-disabled="disabled"><span class="toggle"></span>'+("right"===d.side&&d.text?'<span style="-webkit-padding-start: 10px;margin-right: 15px">'+d.text+"</span>":"")+"</label><div>";c.append(a(e)(b)),c.find("input").on("click",function(){b.$apply(function(){b.doChange()})})}}}]),cvDirectives.directive("goTop",["$compile","$timeout","$interval",function(a,b,c){return{link:function(b,c,d){var e='<div id="gotop" title="返回页面顶部" style="width: 40px; height: 40px; cursor: pointer; background: #EEE; color: #111; border-radius: 50%; font-size: 25px; opacity:0.3; position: fixed; left: 130px; bottom: 20px; box-shadow: 0 1px 1.5px 0 rgba(0, 0, 0, 0.12), 0 1px 1px 0 rgba(0, 0, 0, 0.24); text-align: center; display: none;" ng-click="goTop();"><i class="fa fa-angle-double-up"></i></div>';c.append(a(e)(b)),b.goTop=function(){return $("body,html").animate({scrollTop:0},500),!1},$("#gotop").hover(function(){$(this).css("opacity",1)},function(){$(this).css("opacity",.5)}),$(window).scroll(function(){$(document).scrollTop()>400&&$("#gotop").is(":hidden")?$("#gotop").fadeIn():$(document).scrollTop()<=400&&!$("#gotop").is(":hidden")&&$("#gotop").fadeOut()})}}}]),cvDirectives.directive("fileBrowseCheck",["$compile",function(a){return{restrict:"E",scope:{node:"=",changePath:"&",deleteFile:"&"},link:function(b,c,d){var e=""===d.check||"true"===d.check?!0:!1,f=d.deleteFile?!0:!1,g="",h=b.node.init_path;h=h.length>1&&h.lastIndexOf("/")==h.length-1?h.slice(0,h.length-1):h;var i=h.lastIndexOf("/");h?-1==i?b.node.paths=[h]:1==h.length&&0==i?b.node.paths=[h]:0==i?(g="/",b.node.paths=[h.slice(1)]):(g=h.slice(0,i+1),b.node.paths=[h.slice(i+1)]):b.node.paths=[],b.node.full_path=h,b.node.is_dir=!0;var j=["<div>",'<ol class="breadcrumb" style="margin-bottom: 0;background:#091118">','<li class="active">文件路径：&nbsp;..</li>','<li ng-repeat="path in node.paths track by $index"><a ng-click="goback($index)" ng-bind="path" style="cursor: pointer;"></a></li>',"</ol>",'<ol ng-show="node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 20px;">','<i class="fa fa-spinner fa-spin" style="font-size: 30px; color: #44dcfd;"></i>',"</li>","</ol>",'<ol ng-show="node.err_msg && !node.loading" style="padding-left: 0px; margin: 30px auto;">','<li style="list-style: none; text-align: center; font-size: 18px; color: #999;">','<span style="color: #FF9933;" ng-bind="node.err_msg"></span> ',"</li>","</ol>",'<ol class="file_list" style="overflow-y:scroll; padding-left: 0;" ng-show="!node.err_msg && !node.loading">','<li style="height: 24px; line-height: 24px; list-style: none;" ng-if="node.paths.length > 1">','<i class="" style="margin-right: 10px;"></i><a style="cursor: pointer;" title="上一层" ng-click="goprev();">..</a>',"</li>",'<li ng-repeat="file in node.path_files" class="li-file" '+(f?'ng-style="liStyle(file);" ng-mouseover="file.hover = true;" ng-mouseout="file.hover = false;"':"")+">",e?'<input type="checkbox" i-check ng-model="file.checked" ng-change="checkFile(file);">':"",'<div style="display: inline-block;">','<i class="fa" ng-class="file.dir ? \'fa-folder-open\' : \'fa-file-text-o\' " style="margin-left: 10px; color: #EAC344; display: block; padding-bottom: 4px;"></i>','<a ng-if="file.edit_flag && file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofront(file);" ng-style="fileStyle(file.file, file.check_flag, file.modified_flag);" ng-bind="file.file"></a>','<a ng-if="file.edit_flag && !file.dir" style="cursor: pointer;display: block; word-wrap: break-word; padding-left: 30px;margin-top: -25px;" ng-click="gofile(file);" ng-style="fileStyle(file.file, file.check_flag, file.modified_flag);" ng-bind="file.file"></a>','<span ng-if="!file.edit_flag" style="color: #44dcfd;display: block; word-wrap: break-word;padding-left: 30px;margin-top: -25px;" ng-bind="file.file"></span>',"</div>",f?"<i class='fa li-file-trash' ng-class='trashClass(file);' ng-style='trashStyle(file);' ng-click='delete(file);'></i>":"","</li>","</ol>","</div>"].join("");c.append(a(j)(b));var k=function(){b.node.full_path=g+b.node.paths.join("/"),b.changePath()};b.liStyle=function(a){return a.hover?{background:"#EFEFEF"}:{background:"#FFF"}},b.fileStyle=function(a,c,d){var e={};return e.fontWeight=c?"bolder":"",e.color=d?"#E3AC36":"#428bca",-1!=b.node.spical_files.indexOf(a)&&(e.color="#E3AC36",e.fontWeight="bold"),e},b.trashStyle=function(a){return a.hover?{color:"#666"}:{color:"#FFF"}},b["delete"]=function(a){a.hover=!0,b.node.parent_path=g+b.node.paths.join("/"),b.node.full_path=g+b.node.paths.join("/")+"/"+a.file,b.node.is_dir=a.dir,b.deleteFile()},b.checkFile=function(a){if(a.checked)b.node.checked_files.push({file:a.file,path:g+b.node.paths.join("/"),dir:a.dir});else{for(var c=-1,d=0;d<b.node.checked_files.length;d++){var e=b.node.checked_files[d];e.file===a.file&&e.path===b.node.full_path&&(c=d)}b.node.checked_files.splice(c,1)}},b.trashClass=function(a){return a.deleted?"fa-reply":"fa-trash-o"},b.goprev=function(){b.node.paths.length>1&&b.goback(b.node.paths.length-2)},b.goback=function(a){b.node.is_dir=!0,b.node.paths.splice(a+1),k()},b.gofront=function(a){b.node.is_dir=!0,b.node.paths.push(a.file),k()},b.gofile=function(a){b.node.full_path=g+b.node.paths.join("/")+"/"+a.file,b.node.is_dir=!1,b.changePath()},b.$watch("node.path_files",function(){var a=b.node.full_path;if(!b.node.path_files)return!1;b.node.checked_files||(b.node.checked_files=[]),b.node.deleted_files||(b.node.deleted_files=[]);for(var c=0;c<b.node.path_files.length;c++){for(var d=b.node.path_files[c],e=0;e<b.node.checked_files.length;e++){var f=b.node.checked_files[e];f.file===d.file&&f.path===a&&(d.checked=!0)}for(var e=0;e<b.node.deleted_files.length;e++)b.node.deleted_files[e].file===d.file&&(d.deleted=!0)}}),b.$watch(function(){return b.node.modified_files},function(a){for(var c=0;c<b.node.path_files.length;c++)for(var d=b.node.path_files[c],e=0;e<a.length;e++){var f=a[e];f===g+b.node.paths.join("/")+"/"+d.file&&(d.modified_flag=!0)}},!0),b.changePath()}}}]),cvDirectives.directive("cusHeight",["$window",function(a){return{restrict:"AE",link:function(a,b,c){b.css("height",$(window).scrollTop()+$(window).height()-64+"px"),$(window).resize(function(){b.css("height",$(window).scrollTop()+$(window).height()-64+"px")}),$(window).scroll(function(){b.css("height",$(window).scrollTop()+$(window).height()-64+"px")})}}}]),cvDirectives.directive("dynamicWeight",["$window",function(a){return{restrict:"AE",link:function(b,c,d){a.innerWidth>1400?c.css("left",(a.innerWidth-1400)/2+"px"):c.css("left","0px"),$(window).resize(function(){a.innerWidth>1400?c.css("left",(a.innerWidth-1400)/2+"px"):c.css("left","0px")})}}}]),cvDirectives.directive("cusHeightSyn",["$timeout",function(a){return{restrict:"AE",link:function(b,c,d){b.$watch("tabs",function(){a(function(){var a=$(".left").css("height");$(".right").css("height",a)},200)},!0)}}}]),cvDirectives.directive("cusLineFlow",["$compile","$timeout",function(a,b){return{restrict:"AE",link:function(c,d,e){var f="<div class='line' style='position:absolute;width: 1px;background: #59a8f9;left: 51%;top:57px;'></div>";$(".tab-content").prepend(a(f)(c)),b(function(){var a=$(".tab-content").css("height");$(".line").css("height",a)},2e3)}}}]),cvDirectives.directive("cusTimeVal",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{error_mes:"=errorMes"},link:function(b,c,d,e){b.error_mes="";var f='<div class="ss" ng-bind="error_mes" ng-if="errorPrompt" style="color: #e9416e;padding-left:14px;"></div>';c.on("blur",function(){b.errorPrompt=!0,b.error_mes="",c.parent().siblings(".ss").remove();var e=c.val();"week"==d.name?/^[1-7]$/.test(e)||(b.error_mes="周格式不正确(1-7)"):"mouth"==d.name||"mouthtep"==d.name?/^([1-9]|1[0-2]){0,1}$/.test(e)||(b.error_mes="hour"==d.name?"月格式不正确(1-12)":"月间隔格式不正确(1-12)"):"day"==d.name||"daytep"==d.name?/^([1-9]|[1-2][0-9]|3[0-1]){0,1}$/.test(e)||(b.error_mes="day"==d.name?"日格式不正确(1-31)":"日间隔格式不正确(1-31)"):"hour"==d.name?/^(\d|[0-1]\d|2[0-3]){0,1}$/.test(e)||(b.error_mes="时格式不正确(0-23)"):"hourtep"==d.name?/^([1-9]|[1]\d|2[0-3]){0,1}$/.test(e)||(b.error_mes="时间隔格式不正确(1-23)"):"minute"==d.name?/^(\d|[0-5]\d){0,1}$/.test(e)||(b.error_mes="分格式不正确(0-59)"):"minutep"==d.name?/^([1-9]|[1-5]\d){0,1}$/.test(e)||(b.error_mes="分间隔格式不正确(1-59)"):"duration"!=d.name||e||(b.error_mes="时长不能为空"),b.error_mes&&b.$apply(function(){c.parent().siblings(".ss").remove(),$(".autoStyle").before(a(f)(b))})}),c.on("keydown",function(a){a=a?a:event,8==a.keyCode&&(a.stopPropagation(),b.$apply(function(){b.error_mes=""}))})}}}]),cvDirectives.directive("cusFlowMade",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",pal_data:"=palData",selectKey:"=selectKey",jobConfig:"=jobConfig",reflashNode:"=reflashNode",config:"&config",dealNode:"&getInstance",refresh:"&refresh",read_only:"=readOnly",undo:"=undo",redo:"=redo",array:"=array",configNoData:"&configNoData"},link:function(a,c,d,e){function f(){go.TreeLayout.call(this)}function g(){function c(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,cursor:"pointer",mouseEnter:function(a,b){h(b.part,!0)},mouseLeave:function(a,b){h(b.part,!1)},click:function(a,b){b.part.stroke="#CCCCCC"}}]}function d(){return[{mouseEnter:function(a,b){b.part.background="#526276";var c=b.findObject("TEXT");c.stroke="#d2f1fe"},mouseLeave:function(a,b){b.part.background="transparent";var c=b.findObject("TEXT");c.stroke="#61A1B8"}}]}function e(b,c,d){for(var e=!0,f=0;f<a.model.linkDataArray.length;f++){var g=a.model.linkDataArray[f];d&&"3"==d.part.data.category?(b.data.key==g.from&&c.data.key==g.to||c.data.key==g.from&&b.data.key==g.to)&&(e=!1):"3"!=d.part.data.category&&(b.data.key==g.from||c.data.key==g.to||c.data.key==g.from&&b.data.key==g.to)&&(e=!1)}return e}function f(a,b,c,d,e){return v(go.Shape,"Circle",{fill:"transparent",stroke:"#7c8e8b",desiredSize:new go.Size(8,8),alignment:b,alignmentFocus:b,portId:a,fromSpot:b,toSpot:b,fromLinkable:c,toLinkable:d,cursor:"pointer"},new go.Binding("visible","group",function(a){return 0!=a&&a?!1:!0}))}function g(a,b,c){if(b){if(a.handled=!0,c){var d=b.diagram.toolManager.draggingTool,e=d.draggedParts||d.copiedParts;if(b.canAddMembers(e.toKeySet()))return void(b.isHighlighted=!0)}b.isHighlighted=!1}}function k(c,d){var e=null!==d?d.addMembers(d.diagram.selection,!0):c.diagram.commandHandler.addTopLevelParts(c.diagram.selection,!0);if(e&&6!=m.model.selectedNodeData.type&&4!=m.model.selectedNodeData.type&&5!=m.model.selectedNodeData.type){for(var f=[],g=0;g<m.model.nodeDataArray.length;g++)m.model.nodeDataArray[g].group&&f.push(m.model.nodeDataArray[g].key);var h=angular.copy(m.model.linkDataArray);b(function(){for(var a=h.length-1;a>=0;a--)for(var b=0;b<f.length;b++)0!=h.length&&(h[a].from==f[b]||h[a].to==f[b])&&m.model.removeLinkData(m.model.linkDataArray[a])},200)}else c.diagram.currentTool.doCancel(),b(function(){m.clearSelection(),a.jobConfig=!1},20)}function t(a){var b=a.subject.findObject("LABEL");null!==b&&(b.visible=4===a.subject.fromNode.data.type)}function u(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var v=go.GraphObject.make;m=v(go.Diagram,"myEditDiagramDiv",{initialContentAlignment:go.Spot.TopCenter,"grid.visible":!1,allowMove:!0,allowDrop:!0,LinkDrawn:t,LinkRelinked:t,ChangedSelection:j,"animationManager.duration":800,"undoManager.isEnabled":!0,autoScale:go.Diagram.UniformToFill}),m.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=m.model.nodeDataArray,a.model.linkDataArray=m.model.linkDataArray}),m.addDiagramListener("ExternalObjectsDropped",function(a){if(0!=s.length){var b=s.shift();m.model.setDataProperty(m.model.selectedNodeData,"key",b)}else r++,m.model.setDataProperty(m.model.selectedNodeData,"key",r)}),m.addDiagramListener("SelectionCopied",function(a){if(0!=s.length){var b=s.shift();m.model.setDataProperty(m.model.selectedNodeData,"key",b)}else{r++,m.model.setDataProperty(m.model.selectedNodeData,"key",r);var c=angular.copy(m.model.selectedNodeData.sd_job_bean);c.job_id=m.model.selectedNodeData.key,m.model.setDataProperty(m.model.selectedNodeData,"sd_job_bean",c)}}),m.addDiagramListener("SelectionDeleted",function(a){m.model.selectedNodeData&&s.push(m.model.selectedNodeData.key)}),m.toolManager.dragSelectingTool.delay=0,m.nodeTemplateMap.add("7",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Auto",v(go.Shape,"Rectangle",{fill:"#091016",cursor:"pointer",stroke:"#164957",strokeWidth:1,width:120,height:56}),v(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},v(go.Picture,{width:36,height:36},new go.Binding("source","",function(a){if(a.sd_job_bean.sdwork_cn_name&&a.sd_job_bean.config){if(6==a.type)return"img/dispatch/fl/context/rep.png";if(7==a.type)return"img/dispatch/fl/context/ftpU.png";if(8==a.type)return"img/dispatch/fl/context/ftpD.png";if(9==a.type)return"img/dispatch/fl/context/sftpU.png";if(10==a.type)return"img/dispatch/fl/context/sftpD.png";if(11==a.type)return"img/dispatch/fl/context/zngtU.png";if(12==a.type)return"img/dispatch/fl/context/zngtD.png";if(13==a.type)return"img/dispatch/fl/context/copy.png";if(14==a.type)return"img/dispatch/fl/context/sql.png";if(15==a.type)return"img/dispatch/fl/context/sqlS.png";if(16==a.type)return"img/dispatch/fl/context/web.png";if(17==a.type)return"img/dispatch/fl/context/sysSt.png";if(18==a.type)return"img/dispatch/fl/context/sysE.png";if(19==a.type)return"img/dispatch/fl/context/python.png";if(20==a.type)return"img/dispatch/fl/context/shell.png";if(21==a.type)return"img/dispatch/fl/context/bat.png";if(22==a.type)return"img/dispatch/fl/context/rb.png";if(23==a.type)return"img/dispatch/fl/context/perl.png";if(24==a.type)return"img/dispatch/fl/context/webs.png";if(25==a.type)return"img/dispatch/fl/context/tcp.png";if(26==a.type)return"img/dispatch/fl/context/http.png";if(27==a.type)return"img/dispatch/fl/context/tux.png";if(28==a.type)return"img/dispatch/fl/context/cl.png";if(29==a.type)return"img/dispatch/fl/context/rpg.png";if(30==a.type)return"img/dispatch/fl/context/java.png";if(31==a.type)return"img/dispatch/fl/context/c.png";if(32==a.type)return"img/dispatch/fl/context/c++.png"}else{if(1==a.type)return"img/dispatch/fl/context/start_un.png";if(6==a.type)return"img/dispatch/fl/context/rep_un.png";if(7==a.type)return"img/dispatch/fl/context/ftpU_un.png";if(8==a.type)return"img/dispatch/fl/context/ftpD_un.png";if(9==a.type)return"img/dispatch/fl/context/sftpU_un.png";if(10==a.type)return"img/dispatch/fl/context/sftpD_un.png";if(11==a.type)return"img/dispatch/fl/context/zngtU_un.png";if(12==a.type)return"img/dispatch/fl/context/zngtD_un.png";if(13==a.type)return"img/dispatch/fl/context/copy_un.png";if(14==a.type)return"img/dispatch/fl/context/sql_un.png";if(15==a.type)return"img/dispatch/fl/context/sqlS_un.png";if(16==a.type)return"img/dispatch/fl/context/web_un.png";if(17==a.type)return"img/dispatch/fl/context/sysSt_un.png";if(18==a.type)return"img/dispatch/fl/context/sysE_un.png";if(19==a.type)return"img/dispatch/fl/context/python_un.png";if(20==a.type)return"img/dispatch/fl/context/shell_un.png";if(21==a.type)return"img/dispatch/fl/context/bat_un.png";if(22==a.type)return"img/dispatch/fl/context/rb_un.png";if(23==a.type)return"img/dispatch/fl/context/perl_un.png";if(24==a.type)return"img/dispatch/fl/context/webs_un.png";if(25==a.type)return"img/dispatch/fl/context/tcp_un.png";if(26==a.type)return"img/dispatch/fl/context/http_un.png";if(27==a.type)return"img/dispatch/fl/context/tux_un.png";if(28==a.type)return"img/dispatch/fl/context/cl_un.png";if(29==a.type)return"img/dispatch/fl/context/rpg_un.png";if(30==a.type)return"img/dispatch/fl/context/java_un.png";if(31==a.type)return"img/dispatch/fl/context/c_un.png";if(32==a.type)return"img/dispatch/fl/context/c++_un.png"}}))),v(go.Panel,"Auto",{margin:new go.Margin(10,6,4,48),width:62},v(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),v(go.Panel,"Auto",{alignment:go.Spot.TopRight,margin:new go.Margin(1,1,0,0)},v(go.Shape,"Rectangle",{fill:"#091016",stroke:null,width:24,height:16}),v(go.Picture,{width:14,height:8},new go.Binding("source","",function(a){return a.sd_job_bean.pre_job_list?"img/dispatch/fl/fl_pre.png":void 0}),new go.Binding("visible","",function(a){return 0!=a.sd_job_bean.pre_job_list.length?!0:0==a.sd_job_bean.pre_job_list?!1:void 0})))),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("3",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},v(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/condition.png":"img/dispatch/fl/context/condition_un.png"}))),f("T",go.Spot.Top,!1,!0),f("B",go.Spot.Bottom,!0,!0),f("L",go.Spot.Left,!0,!0),f("R",go.Spot.Right,!0,!0))),m.nodeTemplateMap.add("4",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},v(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/rep.png":"img/dispatch/fl/context/rep_un.png"}))),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("5",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},v(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/stop.png":"img/dispatch/fl/context/stop_un.png"}))),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("1",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Auto",v(go.Shape,"Circle",{width:26,height:26,fill:"#091016",stroke:"#194C5A",strokeWidth:2,cursor:"pointer"})),f("B",go.Spot.Bottom,!0,!1))),m.nodeTemplateMap.add("2",v(go.Node,"Spot",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,b)}},v(go.Panel,"Auto",v(go.Shape,"Circle",{width:25,height:25,fill:null,stroke:"#194C5A",strokeWidth:2}),v(go.Panel,"Auto",v(go.Shape,"Circle",{width:14,height:14,fill:"#194C5A",stroke:null}))),f("T",go.Spot.Top,!1,!0))),m.groupTemplateMap.add("6",v(go.Group,"Auto",c(),{linkValidation:function(a,b,c,d,f){return e(a,c,a)}},{mouseDragEnter:function(a,b,c){g(a,b,!0)},mouseDragLeave:function(a,b,c){g(a,b,!1)},computesBoundsAfterDrag:!0,mouseDrop:k,handlesDragDropForMembers:!0,layout:v(go.GridLayout,{wrappingWidth:1/0,alignment:go.GridLayout.Position,cellSize:new go.Size(1,1),spacing:new go.Size(4,4)})},v(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),v(go.Panel,"Vertical",{margin:-2},v(go.Panel,"Horizontal",{stretch:go.GraphObject.Horizontal,background:"#1F3144",padding:4},v(go.Panel,"Auto",v(go.Shape,"Circle",{width:25,height:25,fill:"#091016",stroke:"#1F3144"}),v(go.TextBlock,{font:"14px Microsoft YaHei",opacity:.75,stroke:"#d2f1fe"},new go.Binding("text","grid",function(a){return 0!=a?(q=parseInt(a),a):q}).makeTwoWay())),v(go.TextBlock,{alignment:go.Spot.Left,editable:!0,margin:5,font:"14px Microsoft YaHei",opacity:.75,stroke:"#61a1b8"},new go.Binding("text","text").makeTwoWay())),v(go.Placeholder,{padding:20,alignment:go.Spot.TopLeft})),f("T",go.Spot.Top,!0,!0),f("B",go.Spot.Bottom,!0,!1))),m.linkTemplate=v(go.Link,v(go.Shape,{stroke:"gray",fill:"gray"}),v(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"}),v(go.Panel,"Auto",{visible:!1,name:"LABEL"},new go.Binding("visible","visible").makeTwoWay(),v(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"null"}),v(go.TextBlock,"判断条件",{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay()))),m.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=m.model.nodeDataArray,a.model.linkDataArray=m.model.linkDataArray,m.model.selectedNodeData?3!=m.model.selectedNodeData.type&&(a.selectNode=m.model.selectedNodeData,a.jobConfig=!0,a.config({key:m.model.selectedNodeData})):a.jobConfig=!1}),m.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,m.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,i();var w=v(go.Palette,"myPaletteDiv0",{padding:2},{"animationManager.duration":600,model:new go.GraphLinksModel(o.condition_list),allowResize:!0,mouseDragOver:function(){}});w.groupTemplate=v(go.Group,"Vertical",{locationSpot:go.Spot.LeftCenter,selectionAdorned:!1,width:60,height:60},v(go.Panel,"Vertical",{margin:new go.Margin(-34,0,0,0)},v(go.Shape,"RoundedRectangle",{fill:"transparent",width:60,height:56,cursor:"pointer",stroke:null}),v(go.Picture,{width:38,height:38,margin:new go.Margin(-14,0,0,0)},new go.Binding("source","type",function(a){return"img/dispatch/fl/palette/group.png"})),v(go.TextBlock,"Yes",{textAlign:"center",font:"12px Microsoft YaHei",stroke:"#61A1B8",editable:!0,name:"TEXT"},new go.Binding("text").makeTwoWay())),d()),w.nodeTemplate=v(go.Node,"Vertical",{locationSpot:go.Spot.Left,selectionAdorned:!1,width:60,height:60},v(go.Panel,"Vertical",{margin:new go.Margin(-34,0,0,0)},v(go.Shape,"RoundedRectangle",{fill:"transparent",width:60,height:56,cursor:"pointer",stroke:null}),v(go.Picture,{width:38,height:38,margin:new go.Margin(-14,0,0,0),cursor:"pointer",background:"transparent"},new go.Binding("source","type",function(a){return 1==a?"img/dispatch/fl/palette/start.png":2==a?"img/dispatch/fl/palette/end.png":3==a?"img/dispatch/fl/palette/group.png":4==a?"img/dispatch/fl/palette/condition.png":5==a?"img/dispatch/fl/palette/stop.png":6==a?"img/dispatch/fl/palette/rep.png":7==a?"img/dispatch/fl/palette/ftp_u.png":8==a?"img/dispatch/fl/palette/ftp_d.png":9==a?"img/dispatch/fl/palette/sftp_u.png":10==a?"img/dispatch/fl/palette/sftp_d.png":11==a?"img/dispatch/fl/palette/agnt_u.png":12==a?"img/dispatch/fl/palette/agnt_d.png":13==a?"img/dispatch/fl/palette/copy.png":14==a?"img/dispatch/fl/palette/sql.png":15==a?"img/dispatch/fl/palette/sql_s.png":16==a?"img/dispatch/fl/palette/net.png":17==a?"img/dispatch/fl/palette/sys_start.png":18==a?"img/dispatch/fl/palette/sys_end.png":19==a?"img/dispatch/fl/palette/python.png":20==a?"img/dispatch/fl/palette/shell.png":21==a?"img/dispatch/fl/palette/bat.png":22==a?"img/dispatch/fl/palette/ruby.png":23==a?"img/dispatch/fl/palette/perl.png":24==a?"img/dispatch/fl/palette/web.png":25==a?"img/dispatch/fl/palette/tcp.png":26==a?"img/dispatch/fl/palette/http.png":27==a?"img/dispatch/fl/palette/tux.png":28==a?"img/dispatch/fl/palette/cl.png":29==a?"img/dispatch/fl/palette/rpg.png":30==a?"img/dispatch/fl/palette/java.png":31==a?"img/dispatch/fl/palette/c.png":32==a?"img/dispatch/fl/palette/c++.png":void 0})),v(go.TextBlock,"Yes",{textAlign:"center",font:"12px Microsoft YaHei",stroke:"#61A1B8",editable:!0,name:"TEXT"},new go.Binding("text").makeTwoWay()),{toolTip:v(go.Adornment,"Auto",v(go.Shape,{fill:"#091016",stroke:"#d2f1fe",strokeWidth:1}),v(go.TextBlock,{margin:4,stroke:"#d2f1fe"},new go.Binding("text","text")),new go.Binding("visible","text",function(a){return""!==a}))}),d());var x=(v(go.Palette,"myPaletteDiv1",{padding:new go.Margin(0,0,0,0),layout:v(go.GridLayout,{arrangement:go.GridLayout.LeftToRight,spacing:new go.Size(3,3)})},{initialDocumentSpot:go.Spot.Left,initialContentAlignment:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,"animationManager.duration":800,model:new go.GraphLinksModel(o.polling_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv2",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.file_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv3",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.db_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv4",{padding:new go.Margin(0,0,0,0),layout:v(go.GridLayout,{arrangement:go.GridLayout.LeftToRight,spacing:new go.Size(3,3)})},{initialDocumentSpot:go.Spot.Left,initialContentAlignment:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,"animationManager.duration":800,model:new go.GraphLinksModel(o.web_list),nodeTemplate:w.nodeTemplate,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv5",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.apply_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv6",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.shell_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv7",{padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.webS_list),allowResize:!0,nodeTemplate:w.nodeTemplate,mouseDragOver:function(){}}),v(go.Palette,"myPaletteDiv8",{
padding:2},{"animationManager.duration":800,model:new go.GraphLinksModel(o.other_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){}}),function(){null!==document.getElementById("privatePaletteDiv")&&(n=v(go.Palette,"privatePaletteDiv",{padding:2},{initialDocumentSpot:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,initialContentAlignment:go.Spot.Left,"toolManager.hoverDelay":200,"animationManager.duration":800,model:new go.GraphLinksModel(p),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){},ModelChanged:function(b){b.isTransactionFinished&&l("privatePaletteDiv",a.pal_data.private_palette_list.length)}}))});x();var y=function(a,b){v(go.Palette,a,{padding:2},{initialDocumentSpot:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,initialContentAlignment:go.Spot.Left,"toolManager.hoverDelay":200,"animationManager.duration":800,model:new go.GraphLinksModel(b.element_list),nodeTemplate:w.nodeTemplate,allowResize:!0,mouseDragOver:function(){},ModelChanged:function(a){a.isTransactionFinished}})},z=function(a,c){a&&b(function(){y(a,c),l(a,c.element_list.length)},10)};a.$watch("pal_data.scene_palette_list.length",function(b,c){if(b&&b>c)for(var d=c;b>d;d++){var e=a.pal_data.scene_palette_list[d];e.category_list=e.category_list?e.category_list:[];for(var f=0;f<e.category_list.length;f++){var g=e.category_list[f];g.element_list=g.element_list?g.element_list:[];var h="scenePaletteDiv"+d+"-"+f;document.getElementById(h)||z(h,g)}}}),m.doFocus=u}function h(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#999999":null})}function i(){m.model=go.Model.fromJson(a.model)}function j(b){m.model.selectedNodeData=null;for(var c=m.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){m.model.selectedNodeData=d.data;break}}a.$applyAsync()}function k(){m.startTransaction("generateTree");for(var b=[],c=0;c<a.model.nodeDataArray.length;c++)b.push({category:a.model.nodeDataArray[c].category,text:a.model.nodeDataArray[c].text,key:a.model.nodeDataArray[c].key,sd_job_bean:a.model.nodeDataArray[c].sd_job_bean,type:a.model.nodeDataArray[c].type,grid:a.model.nodeDataArray[c].grid?a.model.nodeDataArray[c].grid:void 0,isGroup:a.model.nodeDataArray[c].isGroup?a.model.nodeDataArray[c].isGroup:void 0,group:a.model.nodeDataArray[c].group?a.model.nodeDataArray[c].group:void 0});m.model.nodeDataArray=a.model.nodeDataArray;for(var d=[],c=0;c<a.model.linkDataArray.length;c++)d.push({from:a.model.linkDataArray[c].from,to:a.model.linkDataArray[c].to});m.model.linkDataArray=a.model.linkDataArray,t(),m.commitTransaction("generateTree")}function l(a,b){var c=document.getElementById(a),d=Math.ceil(b/2);null!==c&&(c.style.left=1===b?"-35px":"0",d>1&&(c.style.height=70*d+"px"))}var m,n,o=a.pal_data.palette_list?a.pal_data.palette_list:{},p=a.pal_data.private_palette_list?a.pal_data.private_palette_list:[],q=(a.pal_data.scene_palette_list?a.pal_data.scene_palette_list:[],0),r=0,s=[];a.selectNode={},go.Diagram.inherit(f,go.TreeLayout);var t=function(){m.startTransaction("change Layout"),m.layout.isOngoing=!0,m.layout=new f,m.layout.treeStyle=go.TreeLayout.StyleLayered,m.layout.layerStyle=go.TreeLayout.LayerSiblings,m.layout.angle=90,m.layout.alignment=go.TreeLayout.AlignmentCenterChildren,m.layout.arrangementSpacing=new go.Size(20,40),m.layout.layerSpacing=50,m.layout.isOngoing=!1,m.commitTransaction("change Layout")},u=function(){k()};g(),$("#myEditDiagramDiv > div").css("overflow","hidden"),a.$on("addPalette",function(a,b){n.startTransaction("add palette"),n.model.addNodeData(b),n.commitTransaction("add palette")}),a.$on("updatePalette",function(b,c){n.startTransaction("update palette"),n.model.nodeDataArray=a.pal_data.private_palette_list,n.commitTransaction("update palette")}),a.$watch("model.nodeDataArray.length",function(){for(var b=0,c=0;c<a.model.nodeDataArray.length;c++)a.model.nodeDataArray[c].isGroup&&(b+=1),a.model.nodeDataArray[c].key>r&&(r=a.model.nodeDataArray[c].key);q=b,m.startTransaction("change node"),m.model.selectedNodeData&&m.model.selectedNodeData.isGroup&&(m.model.selectedNodeData.grid=q);var d=m.findNodeForData(m.model.selectedNodeData);null!==d&&d.updateTargetBindings(""),m.commitTransaction("change node"),m.clearSelection(),a.selectKey=0},!0),a.$watch("reflashNode",function(){if(m.startTransaction("change node"),m.model.selectedNodeData)for(var b=0;b<a.model.nodeDataArray.length;b++)if(a.model.nodeDataArray[b].key==m.model.selectedNodeData.key){m.model.selectedNodeData.sd_job_bean=a.model.nodeDataArray[b].sd_job_bean;var c=m.findNodeForData(m.model.selectedNodeData);null!==c&&c.updateTargetBindings("")}m.commitTransaction("change node")},!0),a.$watch("jobConfig",function(){a.jobConfig||(m.clearSelection(),a.selectKey=0,a.configNoData())},!0),a.$watch("selectKey",function(){0!=a.selectKey&&m.select(m.findNodeForKey(a.selectKey))},!0),a.$watch("undo",function(b){a.undo=b,a.undo.invoke=function(){m.undoManager.undo()}}),a.$watch("array",function(a){b(function(){u()},100)},!0),a.$watch("redo",function(b){a.redo=b,a.redo.invoke=function(){m.undoManager.redo()}})}}}]),cvDirectives.directive("cusFlowDetail",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",read_only:"=readOnly",undo:"=undo",redo:"=redo",jobConfig:"=jobConfig",config:"&config"},link:function(a,b,c,d){function e(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,selectionAdorned:!1,click:function(a,b){b.part.stroke="#CCCCCC"}}]}function c(b,c){for(var d=!0,e=0;e<a.model.linkDataArray.length;e++){var f=a.model.linkDataArray[e];(b.data.key==f.from||c.data.key==f.to)&&(d=!1)}return d}function d(a,b,c){if(b){if(a.handled=!0,c){var d=b.diagram.toolManager.draggingTool,e=d.draggedParts||d.copiedParts;if(b.canAddMembers(e.toKeySet()))return void(b.isHighlighted=!0)}b.isHighlighted=!1}}function e(a,b){var c=null!==b?b.addMembers(b.diagram.selection,!0):a.diagram.commandHandler.addTopLevelParts(a.diagram.selection,!0);c||a.diagram.currentTool.doCancel()}function k(a){var b=a.subject.findObject("LABEL");null!==b&&(b.visible=4===a.subject.fromNode.data.type)}function l(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var m=go.GraphObject.make;h=m(go.Diagram,"myDiagramDiv",{initialContentAlignment:go.Spot.Top,allowDrop:!0,LinkDrawn:k,LinkRelinked:k,ChangedSelection:g,"animationManager.duration":800,"undoManager.isEnabled":!0,allowResize:!0,autoScale:go.Diagram.UniformToFill,isReadOnly:!0}),h.layout=m(go.TreeLayout,{angle:90,layerSpacing:70,nodeSpacing:110,arrangementSpacing:new go.Size(20,40),sorting:go.TreeLayout.SortingAscending}),h.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=h.model.nodeDataArray,a.model.linkDataArray=h.model.linkDataArray}),h.addDiagramListener("ChangedSelection",function(){h.model.selectedNodeData?3!=h.model.selectedNodeData.type&&(a.selectNode=h.model.selectedNodeData,a.jobConfig=!0,a.config({key:h.model.selectedNodeData})):a.jobConfig=!1}),h.nodeTemplateMap.add("7",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Auto",m(go.Shape,"Rectangle",{fill:"#091016",stroke:"164957",width:120,height:56}),m(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},m(go.Picture,{width:36,height:36},new go.Binding("source","",function(a){if(a.sd_job_bean.sdwork_cn_name){if(6==a.type)return"img/dispatch/fl/context/rep.png";if(7==a.type)return"img/dispatch/fl/context/ftpU.png";if(8==a.type)return"img/dispatch/fl/context/ftpD.png";if(9==a.type)return"img/dispatch/fl/context/sftpU.png";if(10==a.type)return"img/dispatch/fl/context/sftpD.png";if(11==a.type)return"img/dispatch/fl/context/zngtU.png";if(12==a.type)return"img/dispatch/fl/context/zngtD.png";if(13==a.type)return"img/dispatch/fl/context/copy.png";if(14==a.type)return"img/dispatch/fl/context/sql.png";if(15==a.type)return"img/dispatch/fl/context/sqlS.png";if(16==a.type)return"img/dispatch/fl/context/web.png";if(17==a.type)return"img/dispatch/fl/context/sysSt.png";if(18==a.type)return"img/dispatch/fl/context/sysE.png";if(19==a.type)return"img/dispatch/fl/context/python.png";if(20==a.type)return"img/dispatch/fl/context/shell.png";if(21==a.type)return"img/dispatch/fl/context/bat.png";if(22==a.type)return"img/dispatch/fl/context/rb.png";if(23==a.type)return"img/dispatch/fl/context/perl.png";if(24==a.type)return"img/dispatch/fl/context/webs.png";if(25==a.type)return"img/dispatch/fl/context/tcp.png";if(26==a.type)return"img/dispatch/fl/context/http.png";if(27==a.type)return"img/dispatch/fl/context/tux.png";if(28==a.type)return"img/dispatch/fl/context/cl.png";if(29==a.type)return"img/dispatch/fl/context/rpg.png";if(30==a.type)return"img/dispatch/fl/context/java.png";if(31==a.type)return"img/dispatch/fl/context/c.png";if(32==a.type)return"img/dispatch/fl/context/c++.png"}else{if(1==a.type)return"img/dispatch/fl/context/start_un.png";if(6==a.type)return"img/dispatch/fl/context/rep_un.png";if(7==a.type)return"img/dispatch/fl/context/ftpU_un.png";if(8==a.type)return"img/dispatch/fl/context/ftpD_un.png";if(9==a.type)return"img/dispatch/fl/context/sftpU_un.png";if(10==a.type)return"img/dispatch/fl/context/sftpD_un.png";if(11==a.type)return"img/dispatch/fl/context/zngtU_un.png";if(12==a.type)return"img/dispatch/fl/context/zngtD_un.png";if(13==a.type)return"img/dispatch/fl/context/copy_un.png";if(14==a.type)return"img/dispatch/fl/context/sql_un.png";if(15==a.type)return"img/dispatch/fl/context/sqlS_un.png";if(16==a.type)return"img/dispatch/fl/context/web_un.png";if(17==a.type)return"img/dispatch/fl/context/sysSt_un.png";if(18==a.type)return"img/dispatch/fl/context/sysE_un.png";if(19==a.type)return"img/dispatch/fl/context/python_un.png";if(20==a.type)return"img/dispatch/fl/context/shell_un.png";if(21==a.type)return"img/dispatch/fl/context/bat_un.png";if(22==a.type)return"img/dispatch/fl/context/rb_un.png";if(23==a.type)return"img/dispatch/fl/context/perl_un.png";if(24==a.type)return"img/dispatch/fl/context/webs_un.png";if(25==a.type)return"img/dispatch/fl/context/tcp_un.png";if(26==a.type)return"img/dispatch/fl/context/http_un.png";if(27==a.type)return"img/dispatch/fl/context/tux_un.png";if(28==a.type)return"img/dispatch/fl/context/cl_un.png";if(29==a.type)return"img/dispatch/fl/context/rpg_un.png";if(30==a.type)return"img/dispatch/fl/context/java_un.png";if(31==a.type)return"img/dispatch/fl/context/c_un.png";if(32==a.type)return"img/dispatch/fl/context/c++_un.png"}}))),m(go.Panel,"Auto",{margin:new go.Margin(10,6,4,48),width:62},m(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),m(go.Panel,"Auto",{alignment:go.Spot.TopRight,margin:new go.Margin(1,1,0,0)},m(go.Shape,"Rectangle",{fill:"#091016",stroke:null,width:24,height:16}),m(go.Picture,{width:14,height:8},new go.Binding("source","",function(a){return a.sd_job_bean.pre_job_list?"img/dispatch/fl/fl_pre.png":void 0}),new go.Binding("visible","",function(a){return 0!=a.sd_job_bean.pre_job_list.length?!0:0==a.sd_job_bean.pre_job_list?!1:void 0})))))),h.nodeTemplateMap.add("3",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Spot",{width:100,height:50},m(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Picture,new go.Binding("source","",function(){return"img/dispatch/fl/context/condition.png"}))))),h.nodeTemplateMap.add("4",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},m(go.Panel,"Spot",{width:100,height:50},m(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/rep.png":"img/dispatch/fl/context/rep_un.png"}))))),h.nodeTemplateMap.add("5",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},m(go.Panel,"Spot",{width:100,height:50},m(go.Shape,"Rectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/stop.png":"img/dispatch/fl/context/stop_un.png"}))))),h.nodeTemplateMap.add("1",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Auto",m(go.Shape,"Circle",{width:26,height:26,fill:"#091016",stroke:"#194C5A",strokeWidth:2})))),h.nodeTemplateMap.add("2",m(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},m(go.Panel,"Auto",m(go.Shape,"Circle",{width:25,height:25,fill:null,stroke:"#194C5A",strokeWidth:2}),m(go.Panel,"Auto",m(go.Shape,"Circle",{width:14,height:14,fill:"#194C5A",stroke:null}))))),h.groupTemplateMap.add("6",m(go.Group,"Auto",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},{mouseDragEnter:function(a,b,c){d(a,b,!0)},mouseDragLeave:function(a,b,c){d(a,b,!1)},computesBoundsAfterDrag:!0,mouseDrop:e,handlesDragDropForMembers:!0,layout:m(go.GridLayout,{wrappingWidth:1/0,alignment:go.GridLayout.Position,cellSize:new go.Size(1,1),spacing:new go.Size(4,4)})},m(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),m(go.Panel,"Vertical",{margin:-2},m(go.Panel,"Horizontal",{stretch:go.GraphObject.Horizontal,background:"#1F3144",padding:4},m(go.Panel,"Auto",m(go.Shape,"Circle",{width:25,height:25,fill:"#091016",stroke:"#1F3144"}),m(go.TextBlock,{font:"14px Microsoft YaHei",opacity:.75,stroke:"#d2f1fe"},new go.Binding("text","grid",function(a){return 0!=a?(i=parseInt(a),a):i}).makeTwoWay())),m(go.TextBlock,{alignment:go.Spot.Left,editable:!0,margin:5,font:"14px Microsoft YaHei",opacity:.75,stroke:"#61a1b8"},new go.Binding("text","text").makeTwoWay())),m(go.Placeholder,{padding:20,alignment:go.Spot.TopLeft})))),h.linkTemplate=m(go.Link,m(go.Shape,{stroke:"gray",fill:"gray"}),m(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"}),m(go.Panel,"Auto",{visible:!1,name:"LABEL",segmentIndex:1},new go.Binding("segmentFraction","",function(a){return a.visible?j?(j=!1,.5):(j=!0,.8):void 0}),new go.Binding("visible","visible").makeTwoWay(),m(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"null"}),m(go.TextBlock,"判断条件",{font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay()))),h.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,h.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,f(),h.doFocus=l}function f(){h.model=go.Model.fromJson(a.model)}function g(b){h.model.selectedNodeData=null;for(var c=h.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){h.model.selectedNodeData=d.data;break}}a.$applyAsync()}var h,i=0,j=!1;a.selectNode={},e(),$("#myDiagramDiv > div").css("overflow","hidden"),a.$watch("jobConfig",function(){a.jobConfig||h.clearSelection()},!0)}}}]),cvDirectives.directive("cusFlowTaskExe",["$compile","$timeout","$interval",function(a,b,c){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",read_only:"=readOnly",undo:"=undo",redo:"=redo",jobConfig:"=jobConfig",config:"&config",nodeSelected:"=nodeSelected"},link:function(a,b,d,e){function f(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,selectionAdorned:!1,cursor:"pointer",mouseEnter:function(a,b){g(b.part,!0)},mouseLeave:function(a,b){g(b.part,!1)},click:function(a,b){b.part.stroke="#CCCCCC"}}]}function c(b,c){for(var d=!0,e=0;e<a.model.linkDataArray.length;e++){var f=a.model.linkDataArray[e];(b.data.key==f.from||c.data.key==f.to)&&(d=!1)}return d}function d(a,b,c){if(b){if(a.handled=!0,c){var d=b.diagram.toolManager.draggingTool,e=d.draggedParts||d.copiedParts;if(b.canAddMembers(e.toKeySet()))return void(b.isHighlighted=!0)}b.isHighlighted=!1}}function e(b){i.model.selectedNodeData=null;for(var c=i.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){i.model.selectedNodeData=d.data;break}}a.$applyAsync()}function f(a,b){var c=null!==b?b.addMembers(b.diagram.selection,!0):a.diagram.commandHandler.addTopLevelParts(a.diagram.selection,!0);c||a.diagram.currentTool.doCancel()}function l(a){var b=a.subject.findObject("LABEL");null!==b&&(b.visible=4===a.subject.fromNode.data.type)}function m(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var n=go.GraphObject.make;i=n(go.Diagram,"myDiagramDiv",{initialContentAlignment:go.Spot.Top,allowMove:!1,allowDrop:!1,LinkDrawn:l,LinkRelinked:l,ChangedSelection:e,"animationManager.duration":800,"undoManager.isEnabled":!0,allowResize:!1,initialAutoScale:go.Diagram.UniformToFill,isReadOnly:!0}),i.layout=n(go.TreeLayout,{angle:90,layerSpacing:70,nodeSpacing:110,arrangementSpacing:new go.Size(20,40)}),i.toolManager.dragSelectingTool.delay=0,i.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=i.model.nodeDataArray,a.model.linkDataArray=i.model.linkDataArray}),i.addDiagramListener("ChangedSelection",function(){i.model.selectedNodeData&&3!=i.model.selectedNodeData.type&&(a.selectNode=i.model.selectedNodeData,a.config({key:i.model.selectedNodeData}))}),i.nodeTemplateMap.add("7",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Auto",n(go.Shape,"Rectangle",{fill:"#091016",width:120,height:56,strokeWidth:1.5},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b=null;break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b="#164957"}return b})),n(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},n(go.Picture,{width:36,height:36},new go.Binding("source","",function(a){if(a.sd_job_bean.sdwork_cn_name){if(6==a.type)return"img/dispatch/fl/context/rep.png";if(7==a.type)return"img/dispatch/fl/context/ftpU.png";if(8==a.type)return"img/dispatch/fl/context/ftpD.png";if(9==a.type)return"img/dispatch/fl/context/sftpU.png";if(10==a.type)return"img/dispatch/fl/context/sftpD.png";if(11==a.type)return"img/dispatch/fl/context/zngtU.png";if(12==a.type)return"img/dispatch/fl/context/zngtD.png";if(13==a.type)return"img/dispatch/fl/context/copy.png";if(14==a.type)return"img/dispatch/fl/context/sql.png";if(15==a.type)return"img/dispatch/fl/context/sqlS.png";if(16==a.type)return"img/dispatch/fl/context/web.png";if(17==a.type)return"img/dispatch/fl/context/sysSt.png";if(18==a.type)return"img/dispatch/fl/context/sysE.png";if(19==a.type)return"img/dispatch/fl/context/python.png";if(20==a.type)return"img/dispatch/fl/context/shell.png";if(21==a.type)return"img/dispatch/fl/context/bat.png";if(22==a.type)return"img/dispatch/fl/context/rb.png";if(23==a.type)return"img/dispatch/fl/context/perl.png";if(24==a.type)return"img/dispatch/fl/context/webs.png";if(25==a.type)return"img/dispatch/fl/context/tcp.png";if(26==a.type)return"img/dispatch/fl/context/http.png";if(27==a.type)return"img/dispatch/fl/context/tux.png";if(28==a.type)return"img/dispatch/fl/context/cl.png";if(29==a.type)return"img/dispatch/fl/context/rpg.png";if(30==a.type)return"img/dispatch/fl/context/java.png";if(31==a.type)return"img/dispatch/fl/context/c.png";if(32==a.type)return"img/dispatch/fl/context/c++.png"}else{if(1==a.type)return"img/dispatch/fl/context/start_un.png";if(7==a.type)return"img/dispatch/fl/context/ftpU_un.png";if(8==a.type)return"img/dispatch/fl/context/ftpD_un.png";if(9==a.type)return"img/dispatch/fl/context/sftpU_un.png";if(10==a.type)return"img/dispatch/fl/context/sftpD_un.png";if(11==a.type)return"img/dispatch/fl/context/zngtU_un.png";if(12==a.type)return"img/dispatch/fl/context/zngtD_un.png";if(13==a.type)return"img/dispatch/fl/context/copy_un.png";if(14==a.type)return"img/dispatch/fl/context/sql_un.png";if(15==a.type)return"img/dispatch/fl/context/sqlS_un.png";if(16==a.type)return"img/dispatch/fl/context/web_un.png";if(17==a.type)return"img/dispatch/fl/context/sysSt_un.png";if(18==a.type)return"img/dispatch/fl/context/sysE_un.png";if(19==a.type)return"img/dispatch/fl/context/python_un.png";if(20==a.type)return"img/dispatch/fl/context/shell_un.png";if(21==a.type)return"img/dispatch/fl/context/bat_un.png";if(22==a.type)return"img/dispatch/fl/context/rb_un.png";if(23==a.type)return"img/dispatch/fl/context/perl_un.png";if(24==a.type)return"img/dispatch/fl/context/webs_un.png";if(25==a.type)return"img/dispatch/fl/context/tcp_un.png";if(26==a.type)return"img/dispatch/fl/context/http_un.png";if(27==a.type)return"img/dispatch/fl/context/tux_un.png";if(28==a.type)return"img/dispatch/fl/context/cl_un.png";if(29==a.type)return"img/dispatch/fl/context/rpg_un.png";if(30==a.type)return"img/dispatch/fl/context/java_un.png";if(31==a.type)return"img/dispatch/fl/context/c_un.png";if(32==a.type)return"img/dispatch/fl/context/c++_un.png"}}))),n(go.Panel,"Auto",{margin:new go.Margin(8,6,4,48),width:62},n(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),n(go.Panel,"Auto",{alignment:go.Spot.TopRight,margin:new go.Margin(1,1,0,0)},new go.Binding("width","",function(a){return a.sd_job_bean.pre_job_list?"auto":0}),n(go.Picture,{width:14,height:8},new go.Binding("source","",function(a){return a.sd_job_bean.pre_job_list?"img/dispatch/fl/fl_pre.png":void 0}),new go.Binding("visible","",function(a){return 0!=a.sd_job_bean.pre_job_list.length}))),n(go.Panel,"Auto",{alignment:go.Spot.BottomLeft},n(go.Shape,"RoundedRectangle",{stroke:null,height:4},new go.Binding("width","",function(a){a.sd_job_bean=a.sd_job_bean||{};var b=a.sd_job_bean.width?a.sd_job_bean.width:0;return b}),new go.Binding("fill","",function(a){var b="";switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b="#9CB85F";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=""}return b})),new go.Binding("visible","",function(a){var b,c=a.sd_job_bean.job_status;return b=a.sd_job_bean&&(c>=2&&4>=c||7==c)?!0:!1}))))),i.nodeTemplateMap.add("3",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Spot",{width:100,height:50},n(go.Shape,"Rectangle",{fill:"#091016"},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=null}return b})),n(go.Picture,new go.Binding("source","",function(){return"img/dispatch/fl/context/condition.png"})),n(go.Panel,"Auto",{alignment:new go.Spot(0,0,50,48)},n(go.Shape,"RoundedRectangle",{fill:"#9CB85F",stroke:null,height:4,width:100}),new go.Binding("visible","",function(a){return 3==a.sd_job_bean.job_status}))))),i.nodeTemplateMap.add("4",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},n(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},n(go.Shape,"Rectangle",{fill:"#091016"},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=null}return b})),n(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/rep.png":"img/dispatch/fl/context/rep_un.png"})),n(go.Panel,"Auto",{alignment:new go.Spot(0,0,50,48)},n(go.Shape,"RoundedRectangle",{fill:"#9CB85F",stroke:null,height:4,width:100}),new go.Binding("visible","",function(a){return 3==a.sd_job_bean.job_status}))))),i.nodeTemplateMap.add("5",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d,b)}},n(go.Panel,"Spot",{width:100,height:50,cursor:"pointer"},n(go.Shape,"Rectangle",{fill:"#091016"},new go.Binding("stroke","",function(a){var b=null;switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b=null}return b})),n(go.Picture,new go.Binding("source","",function(a){return a.sd_job_bean.sdwork_cn_name?"img/dispatch/fl/context/stop.png":"img/dispatch/fl/context/stop_un.png"})),n(go.Panel,"Auto",{alignment:new go.Spot(0,0,50,48)},n(go.Shape,"RoundedRectangle",{fill:"#9CB85F",stroke:null,height:4,width:100}),new go.Binding("visible","",function(a){return 3==a.sd_job_bean.job_status}))))),i.nodeTemplateMap.add("1",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Auto",n(go.Shape,"Circle",{width:26,height:26,fill:"#091016",strokeWidth:2},new go.Binding("stroke","",function(a){var b="#CCCCCC";switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b="#9CB85F";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b="#CCCCCC"}return b}))))),i.nodeTemplateMap.add("2",n(go.Node,"Spot",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},n(go.Panel,"Auto",n(go.Shape,"Circle",{width:25,height:25,fill:null,strokeWidth:2},new go.Binding("stroke","",function(a){var b="#666666";switch(a.sd_job_bean.job_status){case 2:b="#2D6DB8";break;case 3:b="#9CB85F";break;case 4:b="#ED6F67";break;case 5:b="#FEA04D";break;case 7:b="#ED6F67";break;default:b="#666666"}return b})),n(go.Panel,"Auto",n(go.Shape,"Circle",{width:14,height:14,fill:"#194C5A",stroke:null}))))),i.groupTemplateMap.add("6",n(go.Group,"Auto",b(),{linkValidation:function(a,b,d,e,f){return c(a,d)}},{mouseDragEnter:function(a,b,c){d(a,b,!0)},mouseDragLeave:function(a,b,c){d(a,b,!1)},computesBoundsAfterDrag:!0,mouseDrop:f,handlesDragDropForMembers:!0,layout:n(go.GridLayout,{wrappingWidth:1/0,alignment:go.GridLayout.Position,cellSize:new go.Size(1,1),spacing:new go.Size(4,4)})},n(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"#164957",strokeWidth:1}),n(go.Panel,"Vertical",{margin:-2},n(go.Panel,"Horizontal",{stretch:go.GraphObject.Horizontal,background:"#1F3144",padding:4},n(go.Panel,"Auto",n(go.Shape,"Circle",{width:25,height:25,fill:"#091016",stroke:"#1F3144"}),n(go.TextBlock,{font:"14px Microsoft YaHei",opacity:.75,stroke:"#d2f1fe"},new go.Binding("text","grid",function(a){return 0!=a?(j=parseInt(a),a):j}).makeTwoWay())),n(go.TextBlock,{alignment:go.Spot.Left,editable:!0,margin:5,font:"14px Microsoft YaHei",opacity:.75,stroke:"#61a1b8"},new go.Binding("text","text").makeTwoWay())),n(go.Placeholder,{padding:20,alignment:go.Spot.TopLeft})))),i.linkTemplate=n(go.Link,n(go.Shape,{stroke:"gray",fill:"gray"}),n(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"}),n(go.Panel,"Auto",{visible:!1,name:"LABEL",segmentIndex:1},new go.Binding("visible","visible").makeTwoWay(),new go.Binding("segmentFraction","",function(a){return a.visible?k?(k=!1,.4):(k=!0,.85):void 0}),n(go.Shape,"RoundedRectangle",{fill:"#091016",stroke:"null"}),n(go.TextBlock,"判断条件",{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay()))),i.addDiagramListener("ChangedSelection",function(){}),i.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,i.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,h(),i.doFocus=m}function g(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#999999":null})}function h(){i.model=go.Model.fromJson(a.model)}var i,j=0;a.selectNode={};var k=!1;f(),$("#myDiagramDiv > div").css("overflow","hidden"),a.$watch("nodeSelected",function(a,b){a!==b&&i.clearSelection()}),a.$watch("model.nodeDataArray",function(){i.startTransaction("change node");for(var b=0;b<a.model.nodeDataArray.length;b++){var d=a.model.nodeDataArray[b];if(3!=d.type){var e=d.sd_job_bean?d.sd_job_bean:{};if(e.job_status&&1!=e.job_status){3==e.job_status?(e.width=d.type>3&&d.type<6?100:120,c.cancel(e.timer)):(2==e.job_status||4==e.job_status||7==e.job_status)&&e.width&&e.width>=105&&(e.width=110,c.cancel(e.timer));var f=i.findNodeForData(d);f&&f.updateTargetBindings("")}}}i.commitTransaction("change node")},!0)}}}]),cvDirectives.directive("ngEnter",["$compile",function(a){return{restrict:"AE",link:function(a,b,c,d){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}}]),cvDirectives.filter("getNameFilter",["$sce",function(a){return function(a){for(var b=0;b<a.length;b++)if(a[b].flag)return a[b].user_cn_name}}]),cvDirectives.directive("dragMonitor",["$compile","$timeout","Modal",function(a,b,c){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",group:"=groupData",read_only:"=readOnly",node_length:"=nodeLength"},link:function(a,d,e,f){function g(b){var d=a.group.proj_list[b.data.row-1].phase_list[b.data.col-1];c.viewPhaseSoc(d).then(function(){})}function h(a){var b=a.subject,c=b.fromNode.isLinkLabel||b.toNode.isLinkLabel;a.diagram.model.setCategoryForLinkData(b.data,c?"linkToLink":"")}function i(){function c(b,c){for(var d=!0,e=0;e<a.model.linkDataArray.length;e++){var f=a.model.linkDataArray[e];f.from==c.data.key&&f.to==b.data.key&&(d=!1)}return b.data.row==c.data.row&&(d=!1),d}function e(){return[{cursor:"pointer",deletable:!1,fromLinkable:!0,toLinkable:!0,mouseEnter:function(a,b){j(b.part,!0)},mouseLeave:function(a,b){j(b.part,!1)},linkValidation:function(a,b,d,e,f){return c(a,d)},click:function(a,b){b.part.stroke="#CCCCCC",g(b)}}]}function f(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var i=go.GraphObject.make;p=i(go.Diagram,d.children().attr("id"),{initialContentAlignment:go.Spot.TopLeft,allowMove:!0,allowDrop:!1,ChangedSelection:m,"undoManager.isEnabled":!0,LinkDrawn:h,LinkRelinked:h,"animationManager.isEnabled":!1,allowVerticalScroll:!1,allowHorizontalScroll:!0,allowZoom:!1,isReadOnly:a.read_only,layout:i(go.GridLayout,{wrappingColumn:1,cellSize:new go.Size(1,1),spacing:new go.Size(1,1),alignment:go.GridLayout.Position,comparer:function(a,b){var c=a.location.y,d=b.location.y;return isNaN(c)||isNaN(d)?0:d>c?-1:c>d?1:0}})}),p.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=p.model.nodeDataArray,a.model.linkDataArray=p.model.linkDataArray}),p.addDiagramListener("SelectionDeleting",function(a){var c={from:p.selection.first().data.from,to:p.selection.first().data.to,statue:p.selection.first().data.statue,extra_flag:p.selection.first().data.extra_flag};c.extra_flag===!1&&b(function(){p.startTransaction("add node and link"),p.model.addLinkData(c),p.commitTransaction("add node and link")},10)}),p.addModelChangedListener(function(b){b.isTransactionFinished&&(p.model.nodeDataArray=a.model.nodeDataArray,p.model.linkDataArray=a.model.linkDataArray)}),p.nodeTemplateMap.add("noExecute",i(go.Node,"Vertical",e(),i(go.Shape,"Circle",{width:19,height:19},new go.Binding("fill","status",function(a){return 1==a?"#6d7183":3==a?"#de6d69":6==a?"#FC9E47":5==a?"#89D098":"#de6d69"}),new go.Binding("stroke","status",function(a){return 1==a?"#6d7183":3==a?"#de6d69":6==a?"#FC9E47":5==a?"#89D098":"#de6d69"})))),p.nodeTemplateMap.add("executing",i(go.Node,"Vertical",e(),i(go.Panel,new go.Binding("itemArray","slices"),{itemTemplate:i(go.Panel,i(go.Shape,{fill:"lightgreen",isGeometryPositioned:!0,strokeWidth:0},new go.Binding("fill","color"),new go.Binding("geometry","",n)))}),i(go.TextBlock,{margin:new go.Margin(-27,0,0,0)},new go.Binding("text","dynamic")))),p.groupTemplateMap.add("OfGroups",i(go.Group,"Vertical",{selectable:!1,deletable:!1,width:60,height:140},i(go.Panel,"Auto",{width:40,height:40},i(go.Shape,"RoundedRectangle",{fill:"transparent",stroke:null}),i(go.Placeholder,{padding:1})),i(go.TextBlock,{alignment:go.Spot.Right,font:"9pt Sans-Serif",angle:45,stroke:"rgba(109, 113, 131, 0.53)"},new go.Binding("text","test")))),p.groupTemplateMap.add("OfNodes",i(go.Group,"Vertical",{layout:i(go.TreeLayout,{layerSpacing:20}),selectionAdorned:!1,selectable:!0,deletable:!1,dragComputation:k
},i(go.Panel,"Auto",i(go.Shape,"Rectangle",{fill:"#141e2a",stroke:null,width:q}),i(go.Placeholder,{margin:2,background:"transparent",alignment:go.Spot.Left})))),p.linkTemplate=i(go.Link,{reshapable:!0,resegmentable:!0,relinkableFrom:!0,relinkableTo:!0,adjusting:go.Link.Stretch},i(go.Shape,{fill:"#44dcfd",stroke:"#44dcfd"},new go.Binding("stroke","statue",function(a){return 1!=a&&3!=a?"#44dcfd":"gray"}).makeTwoWay(),new go.Binding("fill","statue",function(a){return 1!=a&&3!=a?"#44dcfd":"gray"}).makeTwoWay()),i(go.Shape,{toArrow:"Standard"},new go.Binding("stroke","",function(a){return a.statue&&(1==a.statue||3==a.statue)?"gray":"#44dcfd"}).makeTwoWay(),new go.Binding("fill","",function(a){return a.statue&&(1==a.statue||3==a.statue)?"gray":"#44dcfd"}).makeTwoWay())),p.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=p.model.nodeDataArray,a.model.linkDataArray=p.model.linkDataArray}),p.toolManager.linkingTool.temporaryLink.routing=go.Link.Normal,p.toolManager.relinkingTool.temporaryLink.routing=go.Link.Normal,l(),p.doFocus=f}function j(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#999999":null})}function k(a,b,c){return new go.Point(b.x,a.location.y)}function l(){p.model=go.Model.fromJson(a.model)}function m(b){p.model.selectedNodeData=null;for(var c=p.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){p.model.selectedNodeData=d.data;break}}a.$applyAsync()}function n(a){return(new go.Geometry).add(new go.PathFigure(a.radius,a.radius).add(new go.PathSegment(go.PathSegment.Arc,a.start,a.sweep,a.center,a.center,a.radius,a.radius).close()))}var o=150*a.group.proj_list.length+"px";d.css("height",o),d.children().css("height",o);var p,q=75*a.node_length;a.$watch("model",function(){d.children().attr("id")&&l()},!0),i(),d.children().children().next().css("overflow","hidden")}}}]),cvDirectives.directive("fileTree",["$timeout","treeConfig","ReleaseFileType","CV",function(a,b,c,d){return{restrict:"E",scope:{files:"=",changePath:"&",getFileContent:"&",dbFile:"&",go:"&",commonControl:"=",compareConfig:"="},templateUrl:"templates/directives/file_tree.html",controller:["$scope",function(a){this.scope=a}],link:function(e,f,g){b.defaultCollapsed=!0,e.control={alter_flag:!1,diff_flag:!1},e.common_control=e.commonControl||{},e.control.alter_flag=g.alter?!0:!1,e.control.diff_flag=g.diff?!0:!1,e.tree_config=e.compareConfig?angular.extend({compare_mode:!1,status:""},e.compareConfig):{compare_mode:!1,status:""};var h=function(){e.changePath&&!e.files.no_init_flag&&"right"!=e.tree_config.status?(e.files.loading=!0,e.changePath().then(function(a){return a&&a.message?(e.files.loading=!1,void(e.err_msg=a.message)):(e.files.nodes=a?a:[],e.data=e.files.nodes,e.files.curr_file=angular.extend(e.files.curr_file,{file_count:e.data.length,dir:!0}),e.files.loading=!1,e.getFileContent&&e.getFileContent(),void(e.tree_config.compare_mode&&i()))})):e.data=e.files.nodes};e.getMoreFile=function(a){var b=a.$modelValue;a.toggle(),a.files.curr_fold_path=(b.file_path?b.file_path:b.tar_path)+"/"+b.file,!b.dir||b.nodes||a.collapsed?(a.files.curr_file={file_path:b.file_path?b.file_path:b.tar_path,file:b.file,file_count:b.nodes?b.nodes.length:0,size:b.file_size,dir:!0,relate_path:b.relate_path,modify_time:b.modify_time},a.getFileContent&&a.getFileContent()):(a.files.curr_file.relate_path=b.relate_path?b.relate_path:b.file+"/",b.loading=!0,a.changePath().then(function(c){b.nodes=c?c:[],0==b.nodes.length&&a.toggle(),b.loading=!1,a.files.curr_file=angular.extend(a.files.curr_file,{file_count:b.nodes.length,relate_path:b.relate_path}),a.getFileContent&&a.getFileContent()}))},e.getFileTarget=function(a){var b,e=a.$modelValue;b=a.tree_config.compare_mode?-1==e.name.lastIndexOf(".")?0:d.findKey(e.name.substring(e.name.lastIndexOf(".")+1),c):-1==e.file.lastIndexOf(".")?0:d.findKey(e.file.substring(e.file.lastIndexOf(".")+1),c),a.files.curr_file={file_path:e.file_path?e.file_path:e.tar_path,file:e.file,file_type:b,size:e.file_size,dir:!1,relate_path:e.relate_path,modify_time:e.modify_time},a.getFileContent&&a.getFileContent()},e.fileDbClick=function(a){var b=a.$modelValue,f=-1==b.name.lastIndexOf(".")?0:d.findKey(b.name.substring(b.name.lastIndexOf(".")+1),c);!f||2==f||3==f||f>8&&14>f||(e.files.compare_path1=b.path1?b.path1:"",e.files.compare_path2=b.path2?b.path2:"",e.dbFile())},e.getcompareFiles=function(a){var b=a.$modelValue;e.files.temp=null,e.files.curr_fold_path=b.path1?b.path1:b.path2,e.go(),b.isfile||b.nodes||a.collapsed?(e.files.curr_file={file_path:b.path1?b.path1:b.path2,file:b.file,file_count:b.nodes?b.nodes.length:0,size:b.file_size,dir:!0,modify_time:b.modify_time},e.getFileContent&&e.getFileContent(),i()):(e.common_control.disabled_control=!0,e.files.compare_path1=b.path1?b.path1:"",e.files.compare_path2=b.path2?b.path2:"",b.loading=!0,e.files.temp=b,e.go(),e.changePath().then(function(a){b.nodes=a?a:[],b.loading=!1,e.files.curr_file=angular.extend(e.files.curr_file,{file_count:b.nodes.length}),e.files.temp=b,e.go(),e.getFileContent&&e.getFileContent(),i(),e.common_control.disabled_control=!1}))};var i=function(){a(function(){var a=0;$(".tree-content").html("");var b=f.height();a=Math.ceil(parseInt(b)/22);for(var c="",d=0;a>d;d++)c+=d%2==0?'<div style="height:22px;background:transparent"></div>':'<div style="height:22px;background:rgba(37,53,73,0.25);"></div>';$(".tree-content").html(c)},100)};h()}}}]),cvDirectives.directive("compareTree",["$timeout","treeConfig","ReleaseFileType","CV",function(a,b,c,d){return{restrict:"A",require:"^fileTree",link:function(a,b,c,d){var e=c.compareTree;a.$on(e,function(b,c){if(c){var d=a.$modelValue;d.loading=c.loading,d.nodes=c.nodes}else a.toggle()})}}}]),cvDirectives.directive("treeLine",["$timeout",function(a){return{restrict:"A",require:"ngModel",controller:["$scope","$element","$attrs",function(a,b,c){this.scope=a}],link:function(a,b,c,d){var e=c.treeLine;a.countHeight=function(){for(var a=d.$modelValue,c="left"==e?"right":"left",f=b.children("li"),g=a.length-1;g>=0;g--){if(a[g].status!=c){f.eq(g).children("ol").children(".ui-tree-cover").css({display:"block"});break}f.eq(g).children(".ui-tree-fold-line").css({display:"none"})}}}}}]),cvDirectives.directive("repeatFinish",function(){return{restrict:"A",require:"^?treeLine",link:function(a,b,c,d){1==a.$last&&d.scope.countHeight()}}}),cvDirectives.directive("versionTree",["$compile","$timeout","Modal",function(a,b,c){return{restrict:"AE",require:"?ngModel",scope:{model:"=goModel",linkLength:"=linkLength",changeVersion:"&changeVersion"},link:function(a,c,d,e){function f(a){var b=a.subject,c=b.fromNode.isLinkLabel||b.toNode.isLinkLabel;a.diagram.model.setCategoryForLinkData(b.data,c?"linkToLink":"")}function g(b){for(var c=0;c<l.model.nodeDataArray.length;c++){var d=l.model.nodeDataArray[c];if("node"==d.category&&d.select){l.startTransaction("change node"),d.select=!1;var b=l.findNodeForData(d);null!==b&&b.updateTargetBindings(""),l.commitTransaction("change node")}}l.startTransaction("change node"),l.model.selectedNodeData&&(l.model.selectedNodeData.select=!0);var b=l.findNodeForData(l.model.selectedNodeData);null!==b&&b.updateTargetBindings(""),l.commitTransaction("change node"),a.changeVersion({key:b.data.vsversion_id})}function h(){function b(){return[{cursor:"pointer",deletable:!1,selectionAdorned:!1,locationSpot:go.Spot.Center,fromLinkable:!0,toLinkable:!0,linkValidation:function(a,b,c,d,e){return validateLink(a,c)},click:function(a,b){"#FC9E22"==b.data.color?g(b):(e(b,l),c.find("#mask").css("display","block"))}}]}function d(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}function e(a,b,c){if(a&&"#44dcfd"==a.data.color){document.getElementById("proj_cn_name").innerHTML=a.data.proj_cn_name||"--",document.getElementById("vsversion_id").innerHTML=a.data.vsversion_id||"--",document.getElementById("operasion_user_name").innerHTML=a.data.operasion_user_name||"--",document.getElementById("date_time").innerHTML=a.data.date_time||"--",n.style.display="block";var d=b.lastInput.viewPoint;n.style.left=d.x-39+"px",n.style.top=d.y+33+"px"}}var h=go.GraphObject.make;l=h(go.Diagram,"versionDiagram",{initialContentAlignment:go.Spot.TopLeft,allowMove:!0,allowDrop:!1,ChangedSelection:k,"undoManager.isEnabled":!0,LinkDrawn:f,LinkRelinked:f,"animationManager.isEnabled":!1,allowVerticalScroll:!0,allowHorizontalScroll:!1,allowZoom:!1,"toolManager.mouseWheelBehavior":go.ToolManager.WheelNone,isReadOnly:!0});var n=document.getElementById("nodeDetail"),o=h(go.HTMLInfo,{show:e,mainElement:n});l.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=l.model.nodeDataArray,a.model.linkDataArray=l.model.linkDataArray}),l.nodeTemplateMap.add("node",h(go.Node,"Vertical",b(),{contextMenu:o},h(go.Panel,"Auto",h(go.Shape,"Circle",{width:24,height:24,isGeometryPositioned:!0,fill:"#091016",stroke:"#666666",strokeWidth:2},new go.Binding("stroke","color").makeTwoWay()),h(go.Panel,"Auto",h(go.Shape,"Circle",{width:18,height:18,isGeometryPositioned:!0,fill:"#091016",stroke:null},new go.Binding("fill","select",function(a){return a?"#FC9E22":"#091016"})))))),l.groupTemplateMap.add("OfNodes",h(go.Group,"Vertical",{selectionAdorned:!1,alignment:go.Spot.Center,width:300,selectable:!1,deletable:!1,dragComputation:i},h(go.Panel,"Auto",{alignment:go.Spot.Center},h(go.Shape,"RoundedRectangle",{fill:"transparent",stroke:null,alignment:go.Spot.Center}),h(go.Placeholder,{padding:30})),h(go.TextBlock,{alignment:go.Spot.Center,width:150,margin:new go.Margin(-62,-180,0,0),font:"bold 12pt helvetica, arial, sans-serif",stroke:"#d2f1fe"},new go.Binding("text","version_number").makeTwoWay()),h(go.TextBlock,{alignment:go.Spot.Center,width:150,margin:new go.Margin(4,-180,0,0),font:"10pt helvetica, arial, sans-serif",stroke:"#d2f1fe"},new go.Binding("text","date_time").makeTwoWay()),h(go.TextBlock,{alignment:go.Spot.Center,width:150,margin:new go.Margin(-63,-180,0,0),font:"10pt helvetica, arial, sans-serif",stroke:"#61a1b8"},new go.Binding("text","proj_cn_name").makeTwoWay(),new go.Binding("visible","proj_cn_name",function(a){return""==a?!1:!0}).makeTwoWay()))),l.groupTemplateMap.add("OfGroups",h(go.Group,"Vertical",{selectable:!1,selectionAdorned:!0,deletable:!1,dragComputation:i,layout:h(go.TreeLayout,{angle:270}),width:130},h(go.Panel,"Auto",{width:60,height:40,margin:new go.Margin(0,-6,0,0)},h(go.TextBlock,{font:"10pt helvetica, arial, sans-serif"},new go.Binding("text","data"),new go.Binding("stroke","color").makeTwoWay())),h(go.Shape,"TriangleUp",{width:17,height:17},new go.Binding("fill","color").makeTwoWay(),new go.Binding("stroke","color").makeTwoWay()),h(go.Panel,"Auto",{width:3,height:m},h(go.Shape,"RoundedRectangle",new go.Binding("fill","color").makeTwoWay(),new go.Binding("stroke","color").makeTwoWay()),h(go.Placeholder,{padding:1})))),l.linkTemplate=h(go.Link,{reshapable:!0,resegmentable:!0,selectable:!1,relinkableFrom:!0,relinkableTo:!0,adjusting:go.Link.Stretch},h(go.Shape,{strokeWidth:2,stroke:"#61a1b8",fill:"#61a1b8"}),h(go.Shape,{toArrow:"Standard",stroke:null,scale:1.6,fill:"#61a1b8"})),l.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=l.model.nodeDataArray,a.model.linkDataArray=l.model.linkDataArray}),l.toolManager.linkingTool.temporaryLink.routing=go.Link.Normal,l.toolManager.relinkingTool.temporaryLink.routing=go.Link.Normal,j(),l.doFocus=d,l.contextMenu=o,n.addEventListener("contextmenu",function(a){return a.preventDefault(),!1},!1);var p=document.getElementById("mask");p.addEventListener("click",function(a){n.style.display="none",p.style.display="none"},!1)}function i(a,b,c){return new go.Point(a.location.x,b.y)}function j(){l.model=go.Model.fromJson(a.model)}function k(b){l.model.selectedNodeData=null;for(var c=l.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){l.model.selectedNodeData=d.data;break}}a.$applyAsync()}var l,m=a.linkLength;b(function(){h(),c.children().children().next().css("overflow","hidden")},200)}}}]),cvDirectives.filter("getProjStateGreaterThanThree",[function(){return function(a){for(var b=[],c=0;c<a.length;c++)a[c].sys_publish_status<4&&a[c].sys_publish_status>1&&b.push(a[c]);return b}}]),cvDirectives.directive("customScroll",["$timeout",function(a){return{restrice:"EA",replace:!0,link:function(b,c,d){a(function(){var a,e=d.customConfig;if(e&&(a=b.$eval(e)),d.callbacks?a&&(a.callbacks=b[d.callbacks]):a&&(a.callbacks=!1),c.mCustomScrollbar(a),d.func){var f=b.$eval(d.func);f.scroll&&(b[f.scroll]=function(a,b){c.mCustomScrollbar("scrollTo",a,b)}),f.stop&&(b[f.stop]=function(){c.mCustomScrollbar("stop")})}})}}}]),cvDirectives.directive("scrollControl",[function(){return{restrice:"EA",template:"",replace:!0,link:function(a,b,c){b.bind("mouseover",function(){$("._mCS1").mCustomScrollbar("disable")}),b.bind("mouseleave",function(){$("._mCS1").mCustomScrollbar("update")})}}}]),cvDirectives.directive("ngRightClick",["$parse",function(a){return{restrict:"AE",link:function(b,c,d,e){var f=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),f(b,{$event:a})})})}}}]),cvDirectives.directive("structDrag",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=nodeLinkData",palette:"=paletteData",config:"&config",save:"&save",node:"=node",reflash:"=reflash",clear:"=clear",cancel:"&cancel"},link:function(a,b,c,d){function e(){go.TreeLayout.call(this)}function f(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,cursor:"pointer",mouseEnter:function(a,b){g(b.part,!0)},mouseLeave:function(a,b){g(b.part,!1)},click:function(b,c){c.part.stroke="#CCCCCC",a.config({key:c.data}),l()}}]}function c(){return[{mouseEnter:function(a,b){b.part.stroke="#4A90E2",b.part.strokeWidth=1},mouseLeave:function(a,b){b.part.stroke="transparent",b.part.strokeWidth=1}}]}function d(a,b,c){var d=!0;return d}function e(a,b,c,d,e){return m(go.Shape,"Circle",{fill:"#172230",stroke:"#1D3D4F",desiredSize:new go.Size(8,8),alignment:b,alignmentFocus:b,portId:a,fromSpot:b,toSpot:b,fromLinkable:c,toLinkable:d,cursor:"pointer"},new go.Binding("visible","",function(a){return!0}))}function f(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var m=go.GraphObject.make;j=m(go.Diagram,"structDiagramDiv",{initialContentAlignment:go.Spot.TopCenter,"grid.visible":!1,allowMove:!0,allowDrop:!0,ChangedSelection:i,"animationManager.duration":800,"undoManager.isEnabled":!0,allowVerticalScroll:!0,allowHorizontalScroll:!0,allowZoom:!1,autoScale:go.Diagram.UniformToFill}),j.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=j.model.nodeDataArray,a.model.linkDataArray=j.model.linkDataArray}),j.nodeTemplateMap.add("cNode",m(go.Node,"Spot",b(),{linkValidation:function(a,b,c,e,f){return d(a,c,b)}},m(go.Panel,"Auto",m(go.Shape,"Rectangle",{fill:"#091016",cursor:"pointer",stroke:"#1D3D4F",strokeWidth:1,width:200,height:80}),m(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},m(go.Picture,{width:38,height:34,background:"transparent"},new go.Binding("source","",function(a){if(a.config_flag){if(1==a.logical_node_type)return"img/public/struct/custom_impl_c.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_c.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_c.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_c.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_c.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_c.png"}else{if(1==a.logical_node_type)return"img/public/struct/custom_impl_u.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_u.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_u.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_u.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_u.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_u.png"}}))),m(go.Panel,"Auto",{margin:new go.Margin(0,0,0,50),width:100,alignment:go.Spot.Left},m(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),m(go.Panel,"Auto",{margin:new go.Margin(30,0,0,50),alignment:go.Spot.Left},m(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("visible","visible").makeTwoWay()))),e("T",go.Spot.Top,!0,!0),e("B",go.Spot.Bottom,!0,!1))),j.linkTemplate=m(go.Link,m(go.Shape,{stroke:"gray",fill:"gray"}),m(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"})),j.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=j.model.nodeDataArray,a.model.linkDataArray=j.model.linkDataArray}),j.addDiagramListener("SelectionDeleted",function(){a.cancel()}),j.addDiagramListener("BackgroundSingleClicked",function(){a.cancel()}),j.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,j.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,h();var n=m(go.Palette,"myPaletteDiv",{padding:new go.Margin(0,0,0,0)},{initialDocumentSpot:go.Spot.Left,initialContentAlignment:go.Spot.Left,initialViewportSpot:go.Spot.TopLeft,"animationManager.duration":800,model:new go.GraphLinksModel(k.webPalette),allowResize:!0,mouseDragOver:function(){}});n.nodeTemplate=m(go.Node,"Vertical",{locationSpot:go.Spot.Left,selectionAdorned:!1,width:84,height:84},m(go.Panel,"Vertical",m(go.Picture,{width:38,height:38,margin:new go.Margin(20,0,0,0),cursor:"pointer",background:"transparent"},new go.Binding("source","logical_node_type",function(a){return 1==a?"img/public/struct/custom_impl_c.png":2==a?"img/public/struct/was_impl_c.png":3==a?"img/public/struct/weblogic_impl_c.png":4==a?"img/public/struct/sql_impl_c.png":5==a?"img/public/struct/as400_impl_c.png":6==a?"img/public/struct/svn_impl_c.png":void 0})),m(go.TextBlock,"Yes",{textAlign:"center",font:"12px Microsoft YaHei",stroke:"#d2f1fe",editable:!0},new go.Binding("text").makeTwoWay())),c()),j.doFocus=f}function g(a,b){var c=a.diagram;c&&!c.isReadOnly&&c.allowLink&&a.ports.each(function(a){a.stroke=b?"#d2f1fe":null})}function h(){j.model=go.Model.fromJson(a.model)}function i(b){j.model.selectedNodeData=null;for(var c=j.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){j.model.selectedNodeData=d.data;break}}a.$applyAsync()}var j,k=a.palette;a.selectNode={},go.Diagram.inherit(e,go.TreeLayout),a.$watch("reflash",function(){if(j.startTransaction("change node"),j.model.selectedNodeData)for(var b=0;b<a.model.nodeDataArray.length;b++)if(a.model.nodeDataArray[b].key==j.model.selectedNodeData.key){a.model.nodeDataArray[b].text=a.model.nodeDataArray[b].basic_msg.node_name,j.model.selectedNodeData=a.model.nodeDataArray[b];var c=j.findNodeForData(j.model.selectedNodeData);null!==c&&c.updateTargetBindings("")}j.commitTransaction("change node")},!0),f();var l=function(){var a=.7*$("#structDiagramDiv").height()+"px";$(".configDiv").css("width",$("#structDiagramDiv").width()-8),$(".configDiv").css("display","inherit"),$(".configDiv").animate({height:a},500)},m=function(){$(".configDiv").css("width",$("#structDiagramDiv").width()-8)};m(),$(window).resize(m),$("#structDiagramDiv > div").css("overflow","hidden"),$("#myPaletteDiv > div").css("overflow","hidden"),a.$watch("clear",function(){j.model.selectedNodeData&&j.clearSelection()},!0),a.save=function(){}}}}]),cvDirectives.directive("envDrag",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",scope:{model:"=nodeLinkData",palette:"=paletteData",config:"&config",save:"&save",node:"=node",reflash:"=reflash",clear:"=clear",cancel:"&cancel"},link:function(a,c,d,e){function f(){function b(){return[new go.Binding("location","loc",go.Point.parse).makeTwoWay(go.Point.stringify),new go.Binding("layerName","isHighlighted",function(a){return"Foreground"}).ofObject(),{locationSpot:go.Spot.Center,cursor:"pointer",mouseEnter:function(a,b){},mouseLeave:function(a,b){},click:function(b,c){c.part.stroke="#CCCCCC",a.config({key:c.data}),i()}}]}function c(){var a=window.scrollX||window.pageXOffset,b=window.scrollY||window.pageYOffset;go.Diagram.prototype.doFocus.call(this),window.scrollTo(a,b)}var d=go.GraphObject.make;k=d(go.Diagram,"envDiagramDiv",{initialContentAlignment:go.Spot.TopCenter,"grid.visible":!1,allowMove:!0,allowDrop:!0,ChangedSelection:h,"animationManager.duration":800,"undoManager.isEnabled":!1,allowCopy:!1,allowDelete:!1,autoScale:go.Diagram.UniformToFill,layout:d(go.TreeLayout,{treeStyle:go.TreeLayout.StyleLastParents,arrangement:go.TreeLayout.ArrangementHorizontal,angle:90,layerSpacing:35,alternateNodeSpacing:20})}),k.addDiagramListener("LayoutCompleted",function(b){a.model.nodeDataArray=k.model.nodeDataArray,a.model.linkDataArray=k.model.linkDataArray}),k.addDiagramListener("ChangedSelection",function(){a.model.nodeDataArray=k.model.nodeDataArray,a.model.linkDataArray=k.model.linkDataArray}),k.addDiagramListener("SelectionDeleted",function(){a.cancel()}),k.addDiagramListener("BackgroundSingleClicked",function(){a.cancel()}),k.nodeTemplateMap.add("cNode",d(go.Node,"Spot",b(),d(go.Panel,"Auto",d(go.Shape,"Rectangle",{fill:"#091016",cursor:"pointer",stroke:"#1D3D4F",strokeWidth:1,width:200,height:80}),d(go.Panel,"Auto",{padding:6,alignment:go.Spot.Left},d(go.Picture,{width:38,height:34},new go.Binding("source","",function(a){if(a.config_flag){if(1==a.logical_node_type)return"img/public/struct/custom_impl_c.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_c.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_c.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_c.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_c.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_c.png"}else{if(1==a.logical_node_type)return"img/public/struct/custom_impl_u.png";if(2==a.logical_node_type)return"img/public/struct/was_impl_u.png";if(3==a.logical_node_type)return"img/public/struct/weblogic_impl_u.png";if(4==a.logical_node_type)return"img/public/struct/sql_impl_u.png";if(5==a.logical_node_type)return"img/public/struct/as400_impl_u.png";if(6==a.logical_node_type)return"img/public/struct/svn_impl_u.png"}}))),d(go.Panel,"Auto",{margin:new go.Margin(0,0,0,50),width:100,alignment:go.Spot.Left},d(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#d2f1fe"},new go.Binding("text").makeTwoWay())),d(go.Panel,"Auto",{margin:new go.Margin(30,0,0,50),alignment:go.Spot.Left},d(go.TextBlock,{font:"12px Microsoft YaHei",stroke:"#72a0f1"},new go.Binding("visible","visible").makeTwoWay()))))),k.linkTemplate=d(go.Link,d(go.Shape,{stroke:"gray",fill:"gray"}),d(go.Shape,{toArrow:"Standard",stroke:null,fill:"gray"})),k.toolManager.linkingTool.temporaryLink.routing=go.Link.Orthogonal,k.toolManager.relinkingTool.temporaryLink.routing=go.Link.Orthogonal,g(),k.doFocus=c}function g(){k.model=go.Model.fromJson(a.model)}function h(b){k.model.selectedNodeData=null;for(var c=k.selection.iterator;c.next();){var d=c.value;if(d instanceof go.Node&&null!==d.data){k.model.selectedNodeData=d.data;break}}a.$applyAsync()}function i(){var a=.7*$("#envDiagramDiv").height()+"px";$(".config-properties-container").animate({height:a},400)}function j(){var a=$("#config-page-container").height();if(a&&$("#envDiagramDiv").height(a-72),$(".config-properties-container").height()>10){var b=.7*$("#envDiagramDiv").height();$(".config-properties-container").height(b)}}var k;j(),$(window).resize(function(){b(function(){j()},500)}),a.$watch("reflash",function(){if(k.startTransaction("change node"),k.model.selectedNodeData)for(var b=0;b<a.model.nodeDataArray.length;b++)if(a.model.nodeDataArray[b].key==k.model.selectedNodeData.key){a.model.nodeDataArray[b].config_flag=!0,k.model.selectedNodeData=a.model.nodeDataArray[b];var c=k.findNodeForData(k.model.selectedNodeData);null!==c&&c.updateTargetBindings("")}k.commitTransaction("change node")},!0),a.$watch("clear",function(){k.model.selectedNodeData&&k.clearSelection()}),f()}}}]),cvDirectives.directive("resizeHeight",["$compile","$timeout",function(a,b){return{restrict:"AE",require:"?ngModel",link:function(a,c,d,e){var f,g=!1,h="",i=d.resizeHeight,j=$(c).prepend("<div class='resize-ball'></div>")[0].firstElementChild,k=0;$(j).on("mousedown",function(a){k=parseFloat($(c).css("height")),f=parseFloat($(".resize-parent").css("height")),h=a.clientY,g=!0,$(j).addClass("resize-mask")}),$(document).on("mousemove",function(a){if(g){var d="",e=k+(h-a.clientY);d&&b.cancel(d),d=b(function(){i>e?e=i:e>f&&(e=f),$(c).css("height",e+"px")},50)}}),$(document).on("mouseup",function(a){g=!1,$(j).removeClass("resize-mask")})}}}]),cvDirectives.directive("cycleProgress",["$compile",function(a){return{restrict:"AE",scope:{percent:"=percent",fontSize:"@fontSize"},link:function(b,c,d,e){function f(){s.save(),s.beginPath(),s.lineWidth=n;var a=w-s.lineWidth;s.lineCap="round",s.strokeStyle="#44515A",s.arc(w,x,a,0,2*Math.PI,!1),s.stroke(),s.closePath(),s.restore()}function g(a){s.save(),s.fillStyle="#fff",s.font=j+"px Helvetica";var b=s.measureText(a.toFixed(0)+"%").width;s.fillText(a.toFixed(0)+"%",w-b/2,x+j/2),s.restore()}function h(a){s.save(),s.strokeStyle=t,s.lineWidth=n,s.lineCap="round";var b=w-s.lineWidth;s.beginPath(),s.arc(w,x,b,-Math.PI/2,-Math.PI/2+a*u,!1),s.stroke(),s.closePath(),s.restore()}var i=b.percent||0,j=b.fontSize||12,k=d.showText,l=d.width||100,m=d.height||100,n=d.circleWidth||10,o="<canvas width="+l+" height="+m+"></canvas>";c.append(a(o)(b));var p=c.find("canvas"),q=p.width=l||34,r=p.height=m||34,s=p.get(0).getContext("2d"),t=s.createLinearGradient(0,0,q,0),u=2*Math.PI/100,v=0,w=q/2,x=r/2;t.addColorStop(0,"#24f7a6"),t.addColorStop(1,"#3dd4fe"),function y(){s.clearRect(0,0,q,r),f(),k||g(v),h(v),v>=i||(v+=1,window.requestAnimationFrame(y))}()}}}]),cvDirectives.directive("slideFollow",["$compile","$timeout",function(a,b){return{restrict:"AE",scope:{scrollHeight:"=scrollHeight",scrollNumber:"=scrollNumber",scrollDate:"=scrollDate",scrollIndex:"=scrollIndex"},link:function(a,c,d){b(function(){var b,d=a.scrollIndex||0,e=a.scrollDate.length,f=function(){parseInt($(c).css("top"))>-e*parseInt(a.scrollHeight)?(d++,$(c).animate({top:-parseInt(a.scrollHeight)*d+"px"},2e3)):(d=1,$(c).css("top","0px"),$(c).animate({top:-parseInt(a.scrollHeight)+"px"},2e3))};a.scrollDate.length>a.scrollNumber&&(b=setInterval(f,5e3),$(c).hover(function(){clearInterval(b)},function(){clearInterval(b),b=setInterval(f,5e3)})),a.$watch("scrollDate.length",function(a){a>5&&!b&&(b=setInterval(f,5e3)),e=a})},0)}}}]),cvDirectives.directive("showDate",["$compile","$interval","$timeout",function(a,b,c){return{restrict:"AE",scope:{dateList:"=",slideIndex:"="},link:function(a,b,d){c(function(){var d,e,f,g,h,i,j,k,l=a.slideIndex||0,m=a.slideIndex||0;k=a.dateList[a.slideIndex].execute_faile?a.dateList[a.slideIndex].execute_faile:!1,j=a.dateList.length,h=$(b).children("#header_block").children(".sys-list"),i=$(b).children("#body_block").children(".slide-container"),e=$(b).children("#body_block").width(),i.css({width:e*j*2+"px","margin-left":-(m*e)+"px",display:"flex"}),i.children(".sys-monitor-detail").css({width:e+"px"}),d=270;var n=function(a){var b=a||5e3;g&&clearInterval(g),f&&clearInterval(f),j>1&&(g=setInterval(p,b)),j>5&&(f=setInterval(o,b))},o=function(){parseInt(h.css("margin-left"))>-j*parseInt(d)?(l++,h.animate({marginLeft:-parseInt(d)*l+"px"},2e3)):(l=1,h.css("margin-left","0px"),h.animate({marginLeft:-parseInt(d)+"px"},2e3))},p=function(){parseInt(i.css("margin-left"))>-j*parseInt(e)?(m++,i.animate({marginLeft:-parseInt(e)*m+"px"},2e3)):(m=1,i.css("margin-left","0px"),i.animate({marginLeft:-parseInt(e)+"px"},2e3)),a.slideIndex==j-1?a.slideIndex=0:a.slideIndex=m,a.dateList[a.slideIndex]&&(k=a.dateList[a.slideIndex].execute_faile),k?n(1e4):n()};k?n(1e4):n(),$(b).hover(function(){g&&clearInterval(g),f&&clearInterval(f)},function(){n()}),a.$watch("dateList.length",function(a){j=a,c(function(){i.css({width:e*j*2+"px","margin-left":-(m*e)+"px",display:"flex"}),i.children(".sys-monitor-detail").css({width:e+"px"})},0),n()})},0)}}}]),cvDirectives.directive("merryGoRound",["$compile","$interval","$timeout",function(a,b,c){return{restrict:"AE",scope:{data:"=data"},link:function(a,d,e){c(function(){function c(a,b,c,d,e){a.beginPath(),a.save(),a.ellipse(b,c,d,e,0,-.29*Math.PI,1.29*Math.PI,!1);var f=a.createLinearGradient(-b*Math.cos(.8*Math.PI),-c*Math.sin(.8*Math.PI/180),Math.cos(1.28*Math.PI),Math.sin(1.28*Math.PI));f.addColorStop(0,"#2FC5E2"),f.addColorStop(1,"#54ED9A"),a.strokeStyle=f,a.stroke(),a.restore()}function e(){for(var b=0;b<s.length;b++){var c=s[b];360==c.angle&&(c.angle=0),c.angle=c.angle+t;var d=c.angle*(Math.PI/180);c.x=l+n*Math.cos(d)-c.w/2,c.y=m+o*Math.sin(d)-c.h/2;var e=i(c,.1,1);c.ball_color=z(a.data[b].project_status),v.beginPath(),v.save(),v.globalAlpha=.35,v.arc(c.x,c.y+c.w/2,15*e,0,2*Math.PI,!1);var f=v.createRadialGradient(c.x,c.y+c.w/2,0,c.x,c.y+c.w/2,15);f.addColorStop(0,"transparent"),f.addColorStop(1,c.ball_color),v.fillStyle=f,v.fill(),v.restore(),v.beginPath(),v.save(),v.globalAlpha=e,v.fillStyle=c.ball_color,v.arc(c.x,c.y+c.w/2,c.w*e,0,2*Math.PI,!1),v.fill(),v.moveTo(c.x,c.y+c.w/2);var g=(c.x-c.x)*Math.cos(p*Math.PI/180)-(c.y+c.w/2+20-c.y+c.w/2)*Math.sin(p*Math.PI/180)+c.x,h=(c.x-c.x)*Math.sin(p*Math.PI/180)+(c.y+c.w/2+20-c.y+c.w/2)*Math.cos(p*Math.PI/180)+c.y+c.w/2;v.lineTo(g,h),v.strokeStyle="rgba(163, 243, 235,0.5)",v.stroke(),v.globalAlpha=1,v.restore(),v.save(),v.globalAlpha=e,v.textAlign="center",v.textBaseline="hanging",v.font="lighter 10px arial",v.strokeStyle="#079FF5",v.strokeText(c.text.substring(0,5),g,h),v.globalAlpha=1,v.restore()}}function f(){for(var b=[],c=6,d=6,e=0,f=a.data.length;f>e;e++){var g=a.data[e],h=(e+1)*(360/f),i=h*(Math.PI/180),j={id:e,w:c,h:d,x:l+n*Math.cos(i)-c/2,y:m+o*Math.sin(i)-d/2,angle:h,ball_color:z(g.project_status),text:g.project_name||""};b.push(j)}return b}function g(){k&&b.cancel(k),b.cancel(k)}function h(){a.data.length&&(k&&b.cancel(k),k=b(j,50))}function i(a,b,c){return((a.y+a.h/2-m+2*o)/o-1)/2*(c-b)+b}function j(){v.clearRect(q,r,u.width,u.height),v.drawImage(w,q,r,u.width,u.height),v.save(),v.rotate(p*Math.PI/180),v.translate(70,-85),v.drawImage(x,l-x.width/2,m-x.height/2),v.restore(),c(v,l,m,n,o),e()}a.data=a.data?a.data.slice(0,30):[];var k,l=0,m=0,n=110,o=50,p=20,q=-60,r=0,s=[],t=.5,u=$(d)[0],v=u.getContext("2d"),w=new Image,x=new Image,y=function(){w.src="../../../img/publish/monitor_list/monitor-bg.png",x.src="../../../img/publish/monitor_list/rocket-bg.png",u.addEventListener("mouseover",g,!1),u.addEventListener("mouseout",h,!1),v.rotate(-p*Math.PI/180),l=u.width/2+q,m=u.height/2+r,n=u.width/Math.cos(p*Math.PI/180)/2-55,s=f(),j(),a.data.length&&(k&&b.cancel(k),k=b(j,50))},z=function(a){var b;switch(a){case 1:case 2:case 9:b="#D1D1D1";break;case 3:case 6:b="#40D0F0";break;case 4:case 5:case 7:b="#54EB9D";break;case 8:case 10:b="#EB5454";break;default:b="#000"}return b};a.$watch("data.length",function(a,c){a!==c&&30>=a&&(b.cancel(k),s=f(),j(),k=b(j,50))}),y()},0)}}}]),cvDirectives.directive("scrollView",["$timeout",function(a){return{restrict:"A",scope:{currentPhase:"=currentPhase",phaseDate:"=phaseDate"},link:function(b,c,d){a(function(){var a=c.parent(),d=a.width(),e=b.phaseDate.length,f=94*e;f>d&&b.$watch("currentPhase",function(a){var b=94*a;if(b>d){var e=b-d;c.animate({marginLeft:-e+"px"},"slow")}})},0)}}}]),cvDirectives.directive("spellScreen",["$timeout","$compile","ScrollBarConfig",function(a,b,c){return{restrict:"EA",scope:{data:"=data",doCheck:"&checkVal",keyword:"=searchKeyword"},templateUrl:"templates/directives/spell_screen.html",link:function(b,d,e){function f(){$(".letter-container").each(function(){var a=$(this),c=a.index();
return a.offset().top+a.height()-10>$("#sys-screen-content").offset().top?($(".nav-letter-li").eq(c).addClass("active").siblings().removeClass("active"),b.control.letter_nav_top?$(".nav-letter-ul").css("top",10*-c+20):$(".nav-letter-ul").css("top","50%"),!1):void 0})}var g=!1,h=null;b.control={letter_nav_top:!1,show_no_search_data:!1},b.sys_screen_scroll=c.Y(),b.scoll_callbacks={setLeft:0,setTop:0,whileScrolling:function(){g||(h&&(a.cancel(h),h=null),h=a(f,25))},onScroll:function(){g=!1},onInit:function(){$(".nav-letter-li:first").addClass("active")}},b.scrollToId=function(c,d){g=!0;var e="#"===c?"\\#":c;$(".nav-letter-li").eq(d).addClass("active").siblings().removeClass("active"),a(function(){b.sysScrollTo($("#-"+e))},5)},b.mouseEnter=function(a){if(b.keyword){var c="#"===a.letter?"\\#":a.letter,d=$("#-"+c);a.nav_disabled=d.is(":hidden")}},b.mouseLeave=function(a){a.nav_disabled=!1},b.checkVal=function(a,c){b.doCheck({parentObj:a,childrenObj:c})},b.resetSysContainerHeight=function(){return $("#sys-screen-content").offset()?(b.control.letter_nav_top=$(".nav-letter-ul").height()>$("#sys-screen-content").height(),{height:$(window).height()-$("#sys-screen-content").offset().top-90}):void 0},b.$watch("keyword",function(c,d){c!==d&&a(function(){b.control.show_no_search_data=$(".letter-container.ng-hide").length===b.data.length,b.control.show_no_search_data?$(".nav-letter-ul").addClass("ng-hide"):($(".nav-letter-ul").removeClass("ng-hide"),$(".letter-container").each(function(){var a=$(this),b=a.index();return a.hasClass("ng-hide")?void 0:($(".nav-letter-li").eq(b).addClass("active").siblings().removeClass("active"),!1)}))},5)}),a(function(){$(".nav-letter-li:first").addClass("active")},10),$(window).resize(function(){a(function(){b.resetSysContainerHeight()},100)})}}}]),cvDirectives.directive("tablePagination",["$timeout",function(a){return{restrict:"EA",replace:!0,scope:{option:"=pageOption"},template:'<ul class="pagination"><li ng-click="pageClick(p)" ng-repeat="p in page" class="{{option.curr==p?\'active\':\'\'}}"><a href="javascript:;">{{p}}</a></li></ul>',link:function(a){function b(a,b,c){a=parseInt(a),b=parseInt(b),c=parseInt(c);var d=a-parseInt(c/2),e=a+parseInt(c/2)+c%2-1;0>=d&&(d=1,e=d+c-1,e>b&&(e=b)),e>b&&(e=b,d=e-c+1,0>=d&&(d=1));for(var f=[],g=d;e>=g;g++)f.push(g);return f.push("»"),f.unshift("«"),f}(!a.option.limit_recd||isNaN(a.option.limit_recd)||a.option.limit_recd<1)&&(a.option.limit_recd=10),(!a.option.curr||isNaN(a.option.curr)||a.option.curr<1)&&(a.option.curr=1),!a.option.all_recd||isNaN(a.option.all_recd)||a.option.all_recd<1?a.option.all=1:a.option.all=Math.ceil(a.option.all_recd/a.option.limit_recd),a.option.curr>a.option.all&&(a.option.curr=a.option.all),(!a.option.count||isNaN(a.option.count)||a.option.count<1)&&(a.option.count=10),a.page=b(a.option.curr,a.option.all,a.option.count),a.pageClick=function(c){"«"==c?c=parseInt(a.option.curr)-1:"»"==c&&(c=parseInt(a.option.curr)+1),1>c?c=1:c>a.option.all&&(c=a.option.all),c!=a.option.curr&&a.option.click&&"function"==typeof a.option.click&&(a.option.click(c),a.option.curr=c,a.page=b(a.option.curr,a.option.all,a.option.count))}}}}]),cvDirectives.directive("packageTree",["$timeout","treeConfig","CV",function(a,b,c){return{restrict:"E",scope:{files:"="},templateUrl:"templates/directives/package_tree.html",link:function(a,c,d){b.defaultCollapsed=!0;var e=function(){a.data=a.files.nodes};a.getMoreFile=function(a){a.toggle()},a.chooseSingleFile=function(b,c){if(b.checked)a.files.choosed_file_list.push({file_path:b.file_path,file:b.file,dir:b.dir});else for(var d=0;d<a.files.choosed_file_list.length;d++){var e=a.files.choosed_file_list[d];if(e.file==b.file&&e.file_path==b.file_path){a.files.choosed_file_list.splice(d,1);break}}},e()}}}]);var tbDirective=angular.module("TableDirective",[]);tbDirective.directive("quickProjectList",function(){return{restrict:"E",templateUrl:"templates/table/quick_project_tb.html",replace:"true",controller:["$scope","$timeout","$state","Proj","config","Col_Fmt","TblOption","MouseMoveEvent","OptionColWidth","Modal","$compile","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){o=a,d.getQuickProjTblData(a).then(function(c){b(function(){c.total=c.all_recd,c.rows=c.pj_project_list?c.pj_project_list:[],a.success(c),a.complete()},0)},function(a){j.alert(a.message,3)})}var n,o={};a.run=function(a){var b=a.syspublish_id,d=a.business_sys_name,e=1;c.go("agile_pub_exe",{sys_publish_id:b,sys_id:d,exec_type:e,quick_pub_flag:1,auto_yn_flag:2,path_flag:1})},a.quickProjectControl={options:{ajax:m,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",sortName:"publish_date",sortOrder:"desc",classes:"table table-no-bordered table-hover ",rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;a.item=b;var d=!0,e="";b.sys_publish_status>=2&&!b.syspublish_success_flag&&(e+='<button  class="ordinary-btn" ng-click="run(item)" style="margin-right:20px;"><i class="glyphicon glyphicon-play"></i>&nbsp;执行</button>');var f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: right;padding-right:90px;'>"+e+"</td>","</tr>"].join(""),g=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: center;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(b.syspublish_success_flag?c.after(k(g)(a)):c.after(k(f)(a)),c.addClass("table_col_Style"),c.next().slideDown(),b.validate_user&&1!=b.validate_user&&(c.next().find(".ordinary-btn").removeClass("ordinary-btn").addClass("ordinary-btn_disabled"),c.next().find(".ordinary-btn_disabled").attr({disabled:!0,title:"当前用户非系统责任人,不可操作"})))},columns:[{field:"publish_date",title:"发布日期",align:"left",valign:"middle",sortable:!0,width:"150px",formatter:f.px100Fmt},{field:"publish_time",title:"发布时间",align:"left",halign:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"business_cn_name",title:"应用系统",align:"left",halign:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"manager_user_name",title:"执行人",align:"left",halign:"left",valign:"middle",width:"120px",events:{"mouseenter .animate_active":function(){var a=$(this);$(".animate_active").next();$(document).off("mousemove"),n&&b.cancel(n),a.next()[0]?"none"==a.next()[0].style.display&&b(function(){$(".animate_active").next().css({display:"none"})},0):b(function(){$(".animate_active").next().css({display:"none"})},0),n=b(function(){a.next().fadeIn(200)},200)},"mouseleave .animate_active":function(){var a=$(this);if(a.next().length>0){var c=a.next()[0],d=$(c).offset().left,e=d+122+20,f=$(c).offset().top,g=$(c).offset().top+$(c).height();$(document).mousemove(function(a){(a.pageX<d||a.pageX>e||a.pageY<f||a.pageY>g)&&(n&&b.cancel(n),n=b(function(){$(".animate_active").next().fadeOut(200)},0))})}}},formatter:f.executeUserFmt},{field:"sys_publish_status",title:"执行状态",align:"left",halign:"left",valign:"middle",width:"120px",formatter:f.projStatusFmt},{field:"syspublish_success_flag",title:"发布结果",align:"left",halign:"left",valign:"middle",width:"100px",formatter:f.prodFlagFmt},angular.extend({formatter:function(a,b,c){var d,e,f;return d="proj_info",e="quick_prod_list",f=['<div style="margin-right:6px;text-align: center;">','<a class="tabConVi" title="查看" >',"</a>","</div>"].join("")},events:{"click .tabConVi":function(a,b,d,e){a.stopPropagation(),c.go("proj_detail_pre",{publish_id:d.syspublish_id,sys_id:d.business_sys_name})}}},i)]}}}]}}),tbDirective.directive("pubWindowList",function(){return{restrict:"AE",templateUrl:"templates/table/pubWindow_tb.html",replace:"true",controller:["$scope","$state","$timeout","$filter","$location","PubWindow","config","Col_Fmt","Modal","$compile","CV",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){n=a,c(function(){f.getPubWindowList().then(function(b){b&&(b.rows=m=b.window_list?b.window_list:[],a.success(b),a.complete())},function(a){i.alert(a.message,3)})},1200)}var m,n;a.close=function(a){i.closePubWindow(a).then(function(a){l(n)})},a.puWindowTableControl={options:{ajax:l,search:!1,pagination:!1,pageSize:10,pageNumber:1,sidePagination:"server",showColumns:!1,showRefresh:!1,sortName:"open_date",sortOrder:"desc",rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"table-old",css:{padding:"6px 8px 5px"}}},onClickRow:function(b,c){if(!b)return!1;a.item=b;var d,e=!0;d=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',2==b.window_status?'<td colspan="7" style="border:0px;text-align: right;"><div style="color: #6D7183;text-align: center">暂无操作项</div></td>':'<td colspan="7" style="border:0;text-align: right;"><button class="ordinary-btn" ng-click="close(item);" style="margin-right:80px;"><i class="fa fa-power-off"></i>&nbsp;关闭</button></td>',"</tr>"].join(""),"col_option"==c.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(c.after(j(d)(a)),c.addClass("table_col_Style"),c.next().slideDown())},classes:"table table-no-bordered table-hover bs-relative-table",columns:[{field:"open_date",title:"开始日期",align:"left",halign:"left",valign:"middle",formatter:h.noZeroFmt},{field:"window_type",title:"窗口类型",align:"left",halign:"left",valign:"middle",formatter:h.pubWindowTypeFmt},{field:"close_reason",title:"关闭原因",align:"left",halign:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"window_status",title:"窗口状态",align:"left",halign:"left",valign:"middle",formatter:h.pubWindowStatusFmt}]}},a.routineWindowSet=function(){i.setNormalWindow().then(function(a){l(n)})},a.specialWindowSet=function(){i.setSpecialWindow().then(function(a){l(n)})},a.blackWindowSet=function(){i.setBlackWindow().then(function(a){l(n)})}}]}}),tbDirective.directive("releaseProjectList",function(){return{restrict:"AE",templateUrl:"templates/table/release_project_tbl.html",replace:!0,controller:["$scope","$modal","$timeout","$location","Project","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(b){e.applyProjectList().then(function(d){c(function(){d&&(a.control.project_list_loading=!1,d.rows=d.pubProSys_list?d.pubProSys_list:[],b.success(d),b.complete())},0)},function(c){a.control.project_list_loading=!1,a.info.error_message=c.message,b.success({}),b.complete()})}function k(a,b,c){var d='<div class="icheckbox_minimal-blue"><div>';return d}a.releaseProjectListControl={options:{ajax:j,pagination:!1,pageSize:20,pageNumber:1,sidePagination:"server",showColumns:!1,showRefresh:!1,onClickRow:function(b,c){if(b)if(b.checked=!b.checked,b.checked?(c.find("td").addClass("checked_style"),c.find(".icheckbox_minimal-blue").addClass("checked")):(c.find("td").removeClass("checked_style"),c.find(".icheckbox_minimal-blue").removeClass("checked")),0==a.info.proj_list.length)a.info.proj_list.push(b);else for(var d=0;d<a.info.proj_list.length;d++){if(a.info.proj_list[d].project_id==b.project_id){a.info.proj_list.splice(d,1);break}if(a.info.proj_list[d].project_id!=b.project_id&&d==a.info.proj_list.length-1){a.info.proj_list.push(b);break}}},classes:"table table-no-bordered",columns:[{field:"checked",title:"",align:"center",valign:"middle",width:"50px",formatter:k},{field:"project_id",title:"项目编号",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"project_name",title:"项目名称",align:"left",valign:"middle"}]}}}]}}),tbDirective.directive("createWorkorder",function(){return{restrict:"AE",templateUrl:"templates/table/create_workorder_tb.html",replace:"true",controller:["$scope","$compile","$modal","$timeout","$state","$location","Workorder","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b,c){return['<div class="tabConDe trash" title="删除">',"</div>",'<a class="tabConEd modify" title="修改" >',"</a>",'<div class="tabConVi view" title="查看">',"</div>"].join("")}function m(a){n=a,g.pageCreateWorkorder(a).then(function(b){b.total=b.all_recd,b.rows=b.created_order_list?b.created_order_list:[];for(var c=0;c<b.rows.length;c++)b.rows[c].sys_cn_name=b.rows[c].sys_cn_name?b.rows[c].sys_cn_name:"",b.rows[c].crt_bk_date=b.rows[c].crt_bk_date+" "+b.rows[c].crt_bk_time,b.rows[c].closed_bk_date="-----",b.rows[c].deal_user_name=b.rows[c].deal_user_name?b.rows[c].deal_user_name:"",b.rows[c].close_bk_date&&b.rows[c].close_bk_time&&(b.rows[c].closed_bk_date=b.rows[c].close_bk_date+" "+b.rows[c].close_bk_time);a.success(b),a.complete()},function(a){j.alert(a.message,3)})}var n={};a.workOrderCreateTableControl={options:{ajax:m,pagination:!0,pageSize:20,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},classes:"table table-no-bordered table-hover",onClickRow:function(c,d){if(!c)return!1;a.item=c;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='9' style='border:0;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='exchange(item);' style='margin-right:20px;'><i class='fa fa-exchange' style='font-size: 14px'></i>&nbsp;变更</button><button class='ordinary-btn' ng-click='appoint(item);' style='margin-right:20px;'><i class='fa fa-hand-o-right' style='font-size: 14px'></i>&nbsp;指派</button></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(b(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},columns:[{field:"order_seq",title:"编号",align:"left",width:"130px",valign:"middle",formatter:i.workOrderFlagFmt},{field:"business_cn_name",title:"系统",align:"left",valign:"middle",formatter:i.hideDetailFmt},{field:"order_bk_title",title:"标题",align:"left",valign:"middle",formatter:i.hideDetailFmt},{field:"workorder_type",title:"工单类型",align:"left",valign:"middle",width:"80px",formatter:i.workOrderTypeFmt},{field:"order_state",title:"状态",align:"left",valign:"middle",width:"80px",formatter:i.workOrderStateFmt},{field:"deal_user_name",title:"责任人",align:"left",valign:"middle",width:"100px",formatter:i.workOrderFmt},{field:"crt_bk_date",title:"创建时间",align:"left",valign:"middle",width:"140px",formatter:i.workOrderTimeFmt},{field:"closed_bk_date",title:"关闭时间",align:"left",valign:"middle",width:"140px",formatter:i.workOrderTimeFmt},{field:"operate",width:"100px",title:"",align:"right",valign:"middle",events:{"click .trash":function(b,c,d,e){b.stopPropagation();var f=d.order_seq;j.confirm("确认删除["+f+"]工单？").then(function(b){b&&g.deleteWorkorder(f).then(function(b){b&&(j.alert(f+" 工单删除成功！",2),m(n),a.getPendingWorkorderNumber(),a.closeProcessOrder(-1,f))},function(a){j.alert(a.message,3)})})},"click .modify":function(a,b,c,d){a.stopPropagation(),e.go("wo_modify",{wo_seq:c.order_seq})},"click .view":function(b,c,d,e){b.stopPropagation();var f=!0;a.addProcessOrder(d.order_seq,f,d.stop_yn_flag)}},formatter:l}]}},a.exchange=function(b){var c=b.order_seq;j.workOrderChange(c).then(function(b){b&&(j.alert("变更完成！",2),m(n),a.getPendingWorkorderNumber())})},a.appoint=function(b){var c=b.order_seq;j.workOrderAppoint(c).then(function(b){b&&(j.alert("指派完成！",2),m(n),a.getPendingWorkorderNumber())})}}]}}),tbDirective.directive("pendingWorkorder",function(){return{restrict:"AE",templateUrl:"templates/table/pending_workorder_tb.html",replace:"true",controller:["$scope","$modal","$timeout","$compile","$location","Workorder","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c){return['<div class="tabConVi view" title="查看">',"</div>"].join("")}function l(a){m=a,f.pagePendingWorkorder(a).then(function(b){b.total=b.all_recd,b.rows=b.order_process_List?b.order_process_List:[];for(var c=0;c<b.rows.length;c++)b.rows[c].crt_bk_date=b.rows[c].crt_bk_date+" "+b.rows[c].crt_bk_time,b.rows[c].sys_cn_name=b.rows[c].sys_cn_name?b.rows[c].sys_cn_name:"";a.success(b),a.complete()},function(a){i.alert(a.message,3)})}var m={};a.workOrderPendingTableControl={options:{ajax:l,pagination:!0,pageSize:20,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='8' style='border:0px;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='deal(item);' style='margin-right:20px;'><i class='fa fa-edit' style='font-size: 14px'></i>&nbsp;处理</button><button class='ordinary-btn' ng-click='retreat(item);' style='margin-right:20px;'><i class='fa fa-undo' style='font-size: 14px'></i>&nbsp;退回</button></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(c.after(d(f)(a)),c.addClass("table_col_Style"),c.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"order_seq",title:"编号",align:"left",valign:"middle",width:"130px",formatter:h.workOrderFlagFmt},{field:"business_cn_name",title:"系统",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"order_bk_title",title:"标题",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"workorder_type",title:"工单类型",align:"left",valign:"middle",width:"80px",formatter:h.workOrderTypeFmt},{field:"order_state",title:"状态",align:"left",valign:"middle",width:"80px",formatter:h.workOrderStateFmt},{field:"crt_user_name",title:"创建人",align:"left",valign:"middle",width:"100px",formatter:h.workOrderFmt},{field:"crt_bk_date",title:"创建时间",align:"left",valign:"middle",width:"140px",formatter:h.workOrderTimeFmt},{field:"operate",width:"50px",title:"",align:"right",valign:"middle",events:{"click .view":function(b,c,d,e){b.stopPropagation();var f=!0;a.addProcessOrder(d.order_seq,f,d.stop_yn_flag)}},formatter:k}]}},a.deal=function(b){a.addProcessOrder(b.order_seq,!1,b.stop_yn_flag)},a.retreat=function(b){var c=b.order_seq;i.workorderRollBack(c).then(function(b){b&&(i.alert("退回完成！",2),l(m),a.getPendingWorkorderNumber())})},a.refresh=function(){l(m)}}]}}),tbDirective.directive("processedWorkorder",function(){return{restrict:"AE",templateUrl:"templates/table/procced_workorder_tb.html",replace:"true",controller:["$scope","$compile","$modal","$timeout","$location","Workorder","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c){return['<div class="tabConVi view" title="查看">',"</div>"].join("")}function l(a){m=a,f.pageProcessedWorkorder(a).then(function(b){b.total=b.all_recd,b.rows=b.order_processed_List?b.order_processed_List:[];for(var c=0;c<b.rows.length;c++)b.rows[c].sys_cn_name=b.rows[c].sys_cn_name?b.rows[c].sys_cn_name:"",b.rows[c].crt_bk_date=b.rows[c].crt_bk_date+" "+b.rows[c].crt_bk_time,b.rows[c].closed_bk_date=b.rows[c].close_bk_date?b.rows[c].close_bk_date+" "+b.rows[c].close_bk_time:"-----";a.success(b),a.complete()},function(a){i.alert(a.message,3)})}var m={};a.workOrderProcessedTableControl={options:{ajax:l,pagination:!0,search:!1,sidePagination:"server",pageNumber:1,pageSize:10,showColumns:!1,rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(c,d){if(!c)return!1;a.item=c;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='9' style='border:0;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(b(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"order_seq",title:"编号",align:"left",valign:"middle",width:"130px",formatter:h.workOrderFlagFmt},{field:"business_cn_name",title:"系统",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"order_bk_title",title:"标题",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"workorder_type",title:"工单类型",align:"left",valign:"middle",width:"80px",formatter:h.workOrderTypeFmt},{field:"order_state",title:"状态",align:"left",valign:"middle",width:"80px",formatter:h.workOrderStateFmt},{field:"crt_user_name",title:"创建人",align:"left",valign:"middle",width:"100px",formatter:h.workOrderFmt},{field:"crt_bk_date",title:"创建时间",align:"left",valign:"middle",width:"140px",formatter:h.workOrderTimeFmt},{field:"closed_bk_date",title:"关闭时间",align:"left",valign:"middle",width:"140px",formatter:h.workOrderTimeFmt},{field:"operate",width:"50px",title:"",align:"center",valign:"middle",events:{"click .view":function(b,c,d,e){b.stopPropagation();var f=!0;a.addProcessOrder(d.order_seq,f,d.stop_yn_flag)}},formatter:k}]}},a.refresh=function(){l(m)}}]}}),tbDirective.directive("allWorkorderList",function(){return{restrict:"AE",templateUrl:"templates/table/all_workorder_list.html",replace:"true",controller:["$scope","$modal","$timeout","$state","$compile","Workorder","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c){return['<span class="tabConVi view"  title="查看" >',"</span>"].join("")}function l(b){m=b,b.moreParams=a.moreParams,f.pageAllWorkorder(b).then(function(a){a.total=a.all_recd,a.rows=a.all_order_list?a.all_order_list:[];for(var c=0;c<a.rows.length;c++)a.rows[c].sys_cn_name=a.rows[c].sys_cn_name?a.rows[c].sys_cn_name:"",a.rows[c].crt_bk_date=a.rows[c].crt_bk_date+" "+a.rows[c].crt_bk_time,a.rows[c].closed_bk_date=a.rows[c].close_bk_date?a.rows[c].close_bk_date+" "+a.rows[c].close_bk_time:"-----";b.success(a),b.complete()},function(a){i.alert(a.message,3)})}var m;a.appoint=function(a){var b=a.order_seq;i.workOrderAppoint(b).then(function(a){a&&(i.alert("指派完成！",2),l(m))})},a.exchange=function(a){var b=a.order_seq;i.workOrderChange(b).then(function(a){a&&(i.alert("变更完成！",2),l(m))})},a.exportProgram=function(a){d.go("fault_program_new",{flag:!0,order_seq:a.order_seq,deal_bk_seq:a.deal_bk_seq})},a.moreParams={},a.allWorkorderTableControl={options:{ajax:l,pagination:!0,pageSize:20,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;a.item=b;var d=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">','<td colspan="10" style="border:0px;text-align: right;padding-right:90px;">','<button class="ordinary-btn" ng-click="exchange(item);" style="margin-right:20px;"><i class="fa fa-exchange" style="font-size: 14px"></i>&nbsp;变更</button>','<button class="ordinary-btn" ng-click="appoint(item);" style="margin-right:20px;"><i class="fa fa-hand-o-right" style="font-size: 14px"></i>&nbsp;指派</button>',4!=b.order_state&&5!=b.order_state||1!=b.handle_type?"":'<button class="ordinary-btn" ng-click="exportProgram(item);" style="margin-right:20px;"><i class="fa fa-pencil-square-o" style="font-size: 14px"></i>&nbsp;生成方案</button>',"</td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(c.after(e(f)(a)),c.addClass("table_col_Style"),c.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"order_seq",title:"编号",align:"left",valign:"middle",width:"130px",formatter:h.workOrderFlagFmt},{field:"business_cn_name",title:"系统",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"order_bk_title",title:"标题",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"workorder_type",title:"工单类型",align:"left",valign:"middle",width:"80px",formatter:h.workOrderTypeFmt},{field:"order_state",title:"状态",align:"left",valign:"middle",width:"80px",formatter:h.workOrderStateFmt},{field:"crt_user_name",title:"创建人",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"deal_user_name",title:"责任人",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"crt_bk_date",title:"创建时间",align:"left",valign:"middle",width:"140px",formatter:h.workOrderTimeFmt},{field:"closed_bk_date",title:"关闭时间",align:"left",valign:"middle",width:"140px",formatter:h.workOrderTimeFmt},{field:"operate",width:"100px",title:"",align:"center",valign:"middle",events:{"click .view":function(a,b,c,e){a.stopPropagation(),d.go("wo_detail",{wo_seq:c.order_seq,back_state:"wo_all_list"})}},formatter:k}]}},a.clear=function(){a.info.nomarlKeyWord=""},a.seniorSearch=function(){a.control.searchSeniorFlag=!1,a.moreParams.key_word=a.info.hightSearchObj.key_word,a.moreParams.system_key_list=[],a.moreParams.order_type_list=[],a.moreParams.order_state_list=[];for(var b=0;b<a.info.hightSearchObj.system_list.length;b++)a.info.hightSearchObj.system_list[b].flag&&a.moreParams.system_key_list.push(a.info.hightSearchObj.system_list[b].value.business_sys_name);for(var b=0;b<a.info.hightSearchObj.workorder_type.length;b++)a.info.hightSearchObj.workorder_type[b].flag&&a.moreParams.order_type_list.push(a.info.hightSearchObj.workorder_type[b].key);for(var b=0;b<a.info.hightSearchObj.workorder_status.length;b++)a.info.hightSearchObj.workorder_status[b].flag&&a.moreParams.order_state_list.push(a.info.hightSearchObj.workorder_status[b].key);a.moreParams.crt_user_id=a.info.hightSearchObj.crt_user_id,a.moreParams.deal_user_id=a.info.hightSearchObj.deal_user_id,a.moreParams.crt_start_date=j.dtFormat(a.info.hightSearchObj.crt_start_date,"-"),a.moreParams.crt_end_date=j.dtFormat(a.info.hightSearchObj.crt_end_date,"-"),a.moreParams.deal_start_date=j.dtFormat(a.info.hightSearchObj.deal_start_date,"-"),a.moreParams.deal_end_date=j.dtFormat(a.info.hightSearchObj.deal_end_date,"-"),l(m),a.nomarlKeyWord=""},a.normalSearch=function(){a.moreParams={},a.moreParams.key_word=a.info.nomarlKeyWord,l(m)},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.control.crt_opened=!0},a.dealOpen=function(b){b.preventDefault(),b.stopPropagation(),a.control.deal_opened=!0}}]}}),tbDirective.directive("importList",function(){return{restrict:"AE",templateUrl:"templates/table/import_tb.html",replace:"true",controller:["$scope","$timeout","$compile","$state","Workorder","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(b,c){var f={},g=[];if(k=b,b.order_file_name=a.info.file_name,1==c){for(var i=0;i<a.excelOrderList.length;i++)a.excelOrderList[i].problem_desc||g.push(a.excelOrderList[i]);f.rows=g,b.success(f),b.complete()}else if(2==c){for(var i=0;i<a.excelOrderList.length;i++)a.excelOrderList[i].problem_desc&&g.push(a.excelOrderList[i]);f.rows=g,b.success(f),b.complete()}else 3==c?(f.rows=a.excelOrderList,b.success(f),b.complete()):e.getAllExcelWorkorder(b.order_file_name).then(function(c){c.total=c.all_recd,a.excelOrderList=c.rows=c.excel_order_list?c.excel_order_list:[],a.info.total_size=c.rows.length;for(var d=0;d<c.rows.length;d++)c.rows[d].sys_cn_name=c.rows[d].sys_cn_name?c.rows[d].sys_cn_name:"",c.rows[d].user_cn_name="--",c.rows[d].problem_desc||(c.rows[d].problem_desc="",a.info.success_num=a.info.success_num+1);b.success(c),b.complete()},function(a){h.alert(a.message,3),d.go("wo_new")})}var k;a.importTableControl={options:{ajax:j,pagination:!1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;var e=!0,f=['<tr class="col_option" id="col_option" style=";height:40px;display: none;">',"<td colspan='8' style='border:0px;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"row_number",title:"行号",align:"left",valign:"middle",formatter:g.workOrderFmt},{field:"order_seq",title:"编号",align:"left",valign:"middle",formatter:g.workOrderFlagFmt},{field:"sys_cn_name",title:"系统",align:"left",valign:"middle",formatter:g.workOrderFmt},{field:"order_bk_title",title:"标题",align:"left",valign:"middle",formatter:g.workOrderFmt},{field:"order_bk_desc",title:"工单描述",align:"left",valign:"middle",formatter:g.workOrderFmt},{field:"trouble_bk_desc",title:"故障描述",align:"left",valign:"middle",formatter:g.workOrderFmt},{field:"user_cn_name",title:"责任人",align:"left",valign:"middle",formatter:g.workOrderFmt},{field:"problem_desc",title:"问题描述",align:"left",valign:"middle",formatter:g.workOrderFmt}]}},a.changeData=function(a){j(k,a)}}]}}),tbDirective.directive("mineTask",function(){return{restrict:"AE",templateUrl:"templates/table/mine_task.html",replace:"true",controller:["$scope","$timeout","$state","config","Task","Col_Fmt","Modal","$compile","CV",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<a class="tabConVi detail" title="查看" >',"</a>","</div>"].join("")}function k(b){1==a.control.tab_flag?e.wk_QueryMineWorkListAction().then(function(a){for(var c=a.mine_work_list?a.mine_work_list:[],d=0;d<c.length;d++)c[d].unhandle=1;for(var e=a.mine_executory_list?a.mine_executory_list:[],d=0;d<e.length;d++)e[d].unhandle=0;a.rows=e.concat(c);for(var d=0;d<a.rows.length;d++)a.rows[d].crt_dept_time=a.rows[d].crt_bk_date+" "+a.rows[d].crt_bk_time;l=a.rows.length,b.success(a),b.complete(),q=b},function(a){g.alert(a.message,3)}):2==a.control.tab_flag?e.wk_QueryMineUncheckWorkAction().then(function(a){for(var c=a.uncheck_work_list?a.uncheck_work_list:[],d=0;d<c.length;d++)c[d].unhandle=1;for(var e=a.executory_uncheck_list?a.executory_uncheck_list:[],d=0;d<e.length;d++)e[d].unhandle=0;a.rows=e.concat(c);for(var d=0;d<a.rows.length;d++)a.rows[d].crt_dept_time=a.rows[d].crt_bk_date+" "+a.rows[d].crt_bk_time;m=a.rows.length,b.success(a),b.complete(),q=b},function(a){g.alert(a.message,3)}):3==a.control.tab_flag?e.wk_QueryMineUnauthWorkAction().then(function(a){for(var c=a.unauth_work_list?a.unauth_work_list:[],d=0;d<c.length;d++)c[d].unhandle=1;for(var e=a.executory_unauth_list?a.executory_unauth_list:[],d=0;d<e.length;d++)e[d].unhandle=0;a.rows=e.concat(c);for(var d=0;d<a.rows.length;d++)a.rows[d].crt_dept_time=a.rows[d].crt_bk_date+" "+a.rows[d].crt_bk_time;n=a.rows.length,b.success(a),b.complete(),q=b},function(a){g.alert(a.message,3)}):(t(b),r=b,e.wk_QueryTroubleTicketWorkAction(b).then(function(a){if(a){a.total=a.all_recd,a.rows=a.pg_work_list?a.pg_work_list:[],o=a.all_recd;for(var c=0;c<a.rows.length;c++)a.rows[c].crt_dept_time=a.rows[c].crt_bk_date+" "+a.rows[c].crt_bk_time,a.rows[c].step_detail=[];b.success(a),b.complete(),q=b}},function(a){g.alert(a.message,3)}))}var l,m,n,o,p,q={},r={};a.filter_list=[{value:"待授权",key:1,checked:!0},{value:"授权拒绝",key:2,checked:!1},{value:"待执行",key:3,checked:!1},{value:"已执行",key:4,checked:!1},{value:"已关闭",key:5,checked:!1}],a.config=function(a,b){1==b?c.go("task_handle",{tab_name:"auth_task",task_id:a.pend_work_seq}):2==b?c.go("task_handle",{tab_name:"mine_task",task_id:a.pend_work_seq}):3==b?c.go("task_handle",{tab_name:"review_task",task_id:a.pend_work_seq}):c.go("trouble_task_handle",{tab_name:"trouble_task",task_id:a.pg_work_seq,detail_flag:!1})},a.tasksMineUnauthWorkTableControl={options:{ajax:k,pagination:!1,search:!1,showColumns:!1,showRefresh:!1,sidePagination:"server",rowStyle:function(a,b){return 0==b&&($(".pagination-detail").hide(),$(".pagination").show()),0==a.unhandle?{classes:"tbl-unhandle tbl-odd"}:{classes:"tbl-odd"}},classes:"table table-no-bordered",onClickRow:function(b,c){if(!b)return!1;if(0==b.unhandle){a.item=b;var d=!0,e=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='config(item,1);' style='margin-right:20px;'>授权</button></td>","</tr>"].join("");
"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(c.after(h(e)(a)),c.addClass("table_col_Style"),c.next().slideDown())}},columns:[{field:"pend_work_seq",title:"任务流水号",align:"left",valign:"middle",width:"165px"},{field:"pendwk_bk_expl",title:"任务说明",align:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"workflow_state",title:"任务状态",align:"left",valign:"middle",width:"100px",formatter:f.taskStatusFmt},{field:"crt_cn_name",title:"提交人",align:"left",valign:"middle",width:"100px"},{field:"crt_dept_time",title:"提交时间",align:"left",valign:"middle",width:"165px"},{field:"operate",title:"状态",align:"left",width:"300px",valign:"middle",events:{"mouseenter .event":function(b,c,d,e){for(var f=($(window).height(),$(this)),g=d.work_detail_list?d.work_detail_list:[],h=0;h<g.length;h++)g[h].time=g[h].deal_bk_date+" "+g[h].deal_bk_time,1==g[h].pend_type?g[h].user="申请人："+g[h].deal_user_cn_name:2==g[h].pend_type?g[h].user="复核人："+g[h].deal_user_cn_name:3==g[h].pend_type?g[h].user="授权人："+g[h].deal_user_cn_name:4==g[h].pend_type?g[h].user="执行人："+g[h].deal_user_cn_name:5==g[h].pend_type&&(g[h].user="关闭人："+g[h].deal_user_cn_name);if(a.test=g,a.test.length>0)for(var i=0;i<a.test.length;i++)"undefined undefined"!=a.test[i].time&&f.siblings().children().eq(i).children().eq(0).text(a.test[i].time),f.siblings().children().eq(i).children().eq(1).text(a.test[i].user);f.siblings().height()>38*(n-e)?f.siblings().removeClass("displayNone"):f.siblings().removeClass("displayNone")},"mouseleave .event":function(a,b,c,d){var e=$(this);e.siblings().addClass("displayNone")},"mouseenter .leave":function(a,b,c,d){var e=($(window).height(),$(this));e.height()>38*(n-d)?e.removeClass("displayNone"):e.removeClass("displayNone")},"mouseleave .leave":function(a,b,c,d){var e=$(this);e.addClass("displayNone")}},formatter:f.taskProgressFmt},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"click .detail":function(a,b,d,e){a.stopPropagation(),c.go("task_detail",{tab_name:"auth_task",task_id:d.pend_work_seq})}},formatter:j}]}},a.tasksMineUncheckWorkTableControl={options:{ajax:k,pagination:!1,search:!1,showColumns:!1,showRefresh:!1,sidePagination:"server",rowStyle:function(a,b){return 0==b&&($(".pagination-detail").hide(),$(".pagination").show()),0==a.unhandle?{classes:"tbl-unhandle tbl-odd"}:{classes:"tbl-odd"}},classes:"table table-no-bordered",onClickRow:function(b,c){if(!b)return!1;if(0==b.unhandle){a.item=b;var d=!0,e=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: right;'><button class='ordinary-btn' ng-click='config(item,3);' style='margin-right:80px;'>复核</button></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(c.after(h(e)(a)),c.addClass("table_col_Style"),c.next().slideDown())}},columns:[{field:"pend_work_seq",title:"任务流水号",align:"left",valign:"middle",width:"165px"},{field:"pendwk_bk_expl",title:"任务说明",align:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"workflow_state",title:"任务状态",align:"left",valign:"middle",width:"100px",formatter:f.taskStatusFmt},{field:"crt_cn_name",title:"提交人",align:"left",valign:"middle",width:"100px"},{field:"crt_dept_time",title:"提交时间",align:"left",valign:"middle",width:"165px"},{field:"operate",title:"状态",width:"280px",align:"left",valign:"middle",events:{"mouseenter .event":function(b,c,d,e){for(var f=$(this),g=d.work_detail_list?d.work_detail_list:[],h=0;h<g.length;h++)g[h].time=g[h].deal_bk_date+" "+g[h].deal_bk_time,1==g[h].pend_type?g[h].user="申请人："+g[h].deal_user_cn_name:2==g[h].pend_type?g[h].user="复核人："+g[h].deal_user_cn_name:3==g[h].pend_type?g[h].user="授权人："+g[h].deal_user_cn_name:4==g[h].pend_type?g[h].user="执行人："+g[h].deal_user_cn_name:5==g[h].pend_type&&(g[h].user="关闭人："+g[h].deal_user_cn_name);if(a.test=g,a.test.length>0)for(var i=0;i<a.test.length;i++)"undefined undefined"!=a.test[i].time&&f.siblings().children().eq(i).children().eq(0).text(a.test[i].time),f.siblings().children().eq(i).children().eq(1).text(a.test[i].user);f.siblings().height()>38*(m-e)?f.siblings().removeClass("displayNone"):f.siblings().removeClass("displayNone")},"mouseleave .event":function(a,b,c,d){var e=$(this);e.siblings().addClass("displayNone")},"mouseenter .leave":function(a,b,c,d){var e=$(this);e.height()>38*(m-d)?e.removeClass("displayNone"):e.removeClass("displayNone")},"mouseleave .leave":function(a,b,c,d){var e=$(this);e.addClass("displayNone")}},formatter:f.taskProgressFmt},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"click .detail":function(a,b,d,e){a.stopPropagation(),c.go("task_detail",{tab_name:"review_task",task_id:d.pend_work_seq})}},formatter:j}]}},a.tasksMineWorkListTableControl={options:{ajax:k,pagination:!1,search:!1,showColumns:!1,showRefresh:!1,sidePagination:"server",rowStyle:function(a,b){return 0==b&&($(".pagination-detail").hide(),$(".pagination").show()),0==a.unhandle?{classes:"tbl-unhandle tbl-odd"}:{classes:"tbl-odd"}},classes:"table table-no-bordered",onClickRow:function(b,c){if(!b)return!1;if(1!=b.workflow_state&&3!=b.workflow_state){a.item=b;var d=!0,e=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: right;'><button class='ordinary-btn' ng-click='config(item,2);' style='margin-right:80px;'>处理</button></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(c.after(h(e)(a)),c.addClass("table_col_Style"),c.next().slideDown())}},columns:[{field:"pend_work_seq",title:"任务流水号",align:"left",valign:"middle",width:"165px"},{field:"pendwk_bk_expl",title:"任务说明",align:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"workflow_state",title:"任务状态",align:"left",valign:"middle",width:"100px",formatter:f.taskStatusFmt},{field:"pend_cn_name",title:"处理人",align:"left",valign:"middle",width:"100px"},{field:"crt_dept_time",title:"提交时间",align:"left",valign:"middle",width:"165px"},{field:"operate",title:"状态",width:"300px",align:"left",valign:"middle",events:{"mouseenter .event":function(b,c,d,e){for(var f=$(this),g=d.work_detail_list?d.work_detail_list:[],h=0;h<g.length;h++)g[h].time=g[h].deal_bk_date+" "+g[h].deal_bk_time,1==g[h].pend_type?g[h].user="申请人："+g[h].deal_user_cn_name:2==g[h].pend_type?g[h].user="复核人："+g[h].deal_user_cn_name:3==g[h].pend_type?g[h].user="授权人："+g[h].deal_user_cn_name:4==g[h].pend_type?g[h].user="执行人："+g[h].deal_user_cn_name:5==g[h].pend_type&&(g[h].user="关闭人："+g[h].deal_user_cn_name);if(a.test=g,a.test.length>0)for(var i=0;i<a.test.length;i++)"undefined undefined"!=a.test[i].time&&f.siblings().children().eq(i).children().eq(0).text(a.test[i].time),f.siblings().children().eq(i).children().eq(1).text(a.test[i].user);f.siblings().height()>38*(l-e)?f.siblings().removeClass("displayNone"):f.siblings().removeClass("displayNone")},"mouseleave .event":function(a,b,c,d){var e=$(this);e.siblings().addClass("displayNone")},"mouseenter .leave":function(a,b,c,d){var e=($(window).height(),$(this));e.height()>38*(l-d)?e.removeClass("displayNone"):e.removeClass("displayNone")},"mouseleave .leave":function(a,b,c,d){var e=$(this);e.addClass("displayNone")},"click .leave":function(a,b,c,d){a.stopPropagation()}},formatter:f.taskProgressFmt},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"click .detail":function(a,b,d,e){a.stopPropagation(),c.go("task_detail",{tab_name:"mine_task",task_id:d.pend_work_seq})}},formatter:j}]}},a.tasksTroubleTicketTableControl={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&($(".pagination-detail").hide(),$(".pagination").show()),0==a.unhandle?{classes:"tbl-unhandle tbl-odd"}:{classes:"tbl-odd"}},classes:"table table-no-bordered",onClickRow:function(b,c){if(!b)return!1;if(1!=b.workflow_state&&3!=b.workflow_state){a.item=b;var d=!0,e=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='8' style='border:0px;text-align: right;'><button class='ordinary-btn' ng-click='config(item,4);' style='margin-right:80px;'>处理</button></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(c.after(h(e)(a)),c.addClass("table_col_Style"),c.next().slideDown())}},columns:[{field:"program_seq",title:"方案编号",align:"left",valign:"middle",width:"120px"},{field:"pg_work_seq",title:"授权任务编号",align:"left",valign:"middle",width:"165px"},{field:"pend_user_cname",title:"待处理人",align:"left",valign:"middle",width:"120px"},{field:"apply_bk_expl",title:"任务申请说明",align:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"crt_user_cname",title:"提交人",align:"left",valign:"middle",width:"120px"},{field:"crt_dept_time",title:"提交时间",align:"left",valign:"middle",width:"165px"},{field:"pgwork_status",title:"状态",width:"120px",align:"left",valign:"middle",events:{"click .event_state":function(a,c,d,f){a.stopPropagation();var g=$(this),h="";g.siblings().removeClass("displayNone"),g.siblings().css("top",41*f+78+"px"),0==d.step_detail.length&&(g.siblings().html('<div style="color:#44dcfd;padding:5px 10px;">正在获取步骤信息&nbsp;&nbsp;<i class="fa fa-spinner fa-spin"></i></div>'),p&&b.cancel(p),p=b(function(){e.getProgramAuthDetail(d.pg_work_seq).then(function(a){d.step_detail=a.pg_detail_list?a.pg_detail_list:[];for(var b=0;b<d.step_detail.length;b++)d.step_detail[b].time=d.step_detail[b].deal_bk_date+" "+d.step_detail[b].deal_bk_time,1==d.step_detail[b].pgpend_type?d.step_detail[b].user="申请人："+d.step_detail[b].deal_user_cname:2==d.step_detail[b].pgpend_type?d.step_detail[b].user="授权人："+d.step_detail[b].deal_user_cname:3!=d.step_detail[b].pgpend_type||5!=d.pgwork_status&&2!=d.pgwork_status?3==d.step_detail[b].pgpend_type&&5!=d.pgwork_status&&2!=d.pgwork_status?d.step_detail[b].user="执行人："+d.step_detail[b].deal_user_cname:4==d.step_detail[b].pgpend_type&&(d.step_detail[b].user="关闭人："+d.step_detail[b].deal_user_cname):d.step_detail[b].user="关闭人："+d.step_detail[b].deal_user_cname,h+='<div style="padding:2px 10px;">',h=h+'<span style="padding:8px;background-color:#253549;display:inline-block;width:160px;text-align:left;margin-left: 8px;">'+("undefined undefined"!=d.step_detail[b].time?d.step_detail[b].time:"--")+"</span>",h=h+'<span style="padding:8px;background-color:#253549;display:inline-block;width:220px;text-align:left;margin-left:4px;">'+d.step_detail[b].user+"</span>",1==d.step_detail[b].run_state?h+='<div title="待执行" style="padding:8px;display:inline-block;width:30px;background-color:#253549;text-align:center;margin-left:4px;height: 40px;margin-bottom: -15px;">--</div>':h=h+"<div title="+(3==d.step_detail[b].run_state?"执行成功":2==d.step_detail[b].run_state?"执行中":"执行失败")+' style="padding:8px;display:inline-block;width:30px;text-align:center;margin-left:4px;background: #253549 url(img/task_state'+(3==d.step_detail[b].run_state?1:2==d.step_detail[b].run_state?2:3)+'.png) no-repeat center;height: 40px;margin-bottom: -15px;"></div>',h+="</div>",g.siblings().html(h)},function(a){g.siblings().html("<div style='color: #A01F1F;word-break:break-all;padding:5px 10px;'>"+a.message+"</div>")})},1e3))},"mouseleave .event_state":function(a,b,c,d){var e=$(this);e.siblings().addClass("displayNone")},"mouseenter .leave_state":function(a,b,c,d){var e=$(this);e.removeClass("displayNone")},"mouseleave .leave_state":function(a,b,c,d){var e=$(this);e.addClass("displayNone")},"click .leave_state":function(a,b,c,d){a.stopPropagation()}},formatter:f.taskTroubleProgressFmt},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"click .detail":function(a,b,d,e){a.stopPropagation(),c.go("trouble_task_handle",{tab_name:"trouble_task",task_id:d.pg_work_seq,detail_flag:!0})}},formatter:j}]}},a.getHandleList=function(b){s(b)&&(a.filter_list[b].checked=!a.filter_list[b].checked,r.run_flag=!0,r.data.offset=0,k(r))};var s=function(b){for(var c=[],d=0;d<a.filter_list.length;d++)a.filter_list[d].checked&&c.push(a.filter_list[d]);return a.filter_list[b].checked&&1==c.length?!1:!0},t=function(b){for(var c=0,d=[];c<a.filter_list.length;c++)a.filter_list[c].checked&&d.push(a.filter_list[c].key);b.status_list=d.join(",")}}]}}),tbDirective.directive("hisTask",function(){return{restrict:"AE",templateUrl:"templates/table/his_task.html",replace:"true",controller:["$scope","$timeout","$compile","$state","config","Task","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){var d=['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<a class="tabConVi detail" title="查看任务">',"</a>","</div>"].join("");return d}function k(b){1==a.control.tab_flag?f.wk_PageMineHistoryWorkAction(b).then(function(a){a.total=a.all_recd,a.rows=a.mine_history_list?a.mine_history_list:[];for(var c=0;c<a.rows.length;c++)a.rows[c].deal_bk_dt=a.rows[c].deal_bk_date+" "+a.rows[c].deal_bk_time;l=a.rows.length,b.success(a),b.complete()},function(a){h.alert(a.message,3)}):2==a.control.tab_flag?f.wk_PageMineHistoryUncheckAction(b).then(function(a){a.total=a.all_recd,a.rows=a.uncheck_history_list?a.uncheck_history_list:[];for(var c=0;c<a.rows.length;c++)a.rows[c].deal_bk_dt=a.rows[c].deal_bk_date+" "+a.rows[c].deal_bk_time;m=a.rows.length,b.success(a),b.complete()},function(a){h.alert(a.message,3)}):f.wk_PageMineHistoryUnauthAction(b).then(function(a){a.total=a.all_recd,a.rows=a.unauth_history_list?a.unauth_history_list:[];for(var c=0;c<a.rows.length;c++)a.rows[c].deal_bk_dt=a.rows[c].deal_bk_date+" "+a.rows[c].deal_bk_time;n=a.rows.length,b.success(a),b.complete()},function(a){h.alert(a.message,3)})}var l,m,n;a.tasksHistoryCommitTableControl={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&($(".pagination-detail").hide(),$(".pagination").show()),{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="display: none;">',"<td colspan='6' style='border:0px;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"pend_work_seq",title:"任务流水号",align:"left",valign:"middle",width:"165px"},{field:"pendwk_bk_expl",title:"任务说明",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"workflow_state",title:"任务状态",align:"left",valign:"middle",width:"100px",formatter:g.taskStatusFmt},{field:"deal_bk_dt",title:"结束日期",align:"left",valign:"middle",width:"165px"},{field:"operate",width:"300px",title:"状态",align:"left",valign:"middle",events:{"mouseenter .event":function(b,c,d,e){for(var f=($(window).height(),$(this)),g=d.work_detail_list?d.work_detail_list:[],h=0;h<g.length;h++)g[h].time=g[h].deal_bk_date+" "+g[h].deal_bk_time,1==g[h].pend_type?g[h].user="申请人："+g[h].deal_user_cn_name:2==g[h].pend_type?g[h].user="复核人："+g[h].deal_user_cn_name:3==g[h].pend_type?g[h].user="授权人："+g[h].deal_user_cn_name:4==g[h].pend_type?g[h].user="执行人："+g[h].deal_user_cn_name:5==g[h].pend_type&&(g[h].user="关闭人："+g[h].deal_user_cn_name);if(a.test=g,a.test.length>0)for(var i=0;i<a.test.length;i++)"undefined undefined"!=a.test[i].time&&f.siblings().children().eq(i).children().eq(0).text(a.test[i].time),f.siblings().children().eq(i).children().eq(1).text(a.test[i].user);f.siblings().height()>38*(l-e)&&e>5?f.siblings().removeClass("displayNone"):f.siblings().removeClass("displayNone")},"mouseleave .event":function(a,b,c,d){var e=$(this);e.siblings().addClass("displayNone")},"mouseenter .leave":function(a,b,c,d){var e=$(this);e.siblings().height()>38*(l-d)&&d>5?e.removeClass("displayNone"):e.removeClass("displayNone")},"mouseleave .leave":function(a,b,c,d){var e=$(this);e.addClass("displayNone")}},formatter:g.taskHistoryProgressFmt},{field:"operate",width:"80px",title:"",align:"left",valign:"middle",events:{"click .detail":function(a,b,c,e){a.stopPropagation(),d.go("task_detail",{tab_name:"submit_his",task_id:c.pend_work_seq})}},formatter:j}]}},a.tasksHistoryUncheckTableControl={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&($(".pagination-detail").hide(),$(".pagination").show()),{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="display: none;">',"<td colspan='7' style='border:0px;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"pend_work_seq",title:"任务流水号",align:"left",valign:"middle",width:"165px"},{field:"pendwk_bk_expl",title:"任务说明",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"workflow_state",title:"任务状态",align:"left",valign:"middle",width:"100px",formatter:g.taskStatusFmt},{field:"crt_user_cn_name",title:"创建人",align:"left",valign:"middle",width:"100px"},{field:"deal_bk_dt",title:"结束日期",align:"left",valign:"middle",width:"165px"},{field:"operate",width:"300px",title:"状态",align:"left",valign:"middle",events:{"mouseenter .event":function(b,c,d,e){for(var f=($(window).height(),$(this)),g=d.work_detail_list?d.work_detail_list:[],h=0;h<g.length;h++)g[h].time=g[h].deal_bk_date+" "+g[h].deal_bk_time,1==g[h].pend_type?g[h].user="申请人："+g[h].deal_user_cn_name:2==g[h].pend_type?g[h].user="复核人："+g[h].deal_user_cn_name:3==g[h].pend_type?g[h].user="授权人："+g[h].deal_user_cn_name:4==g[h].pend_type?g[h].user="执行人："+g[h].deal_user_cn_name:5==g[h].pend_type&&(g[h].user="关闭人："+g[h].deal_user_cn_name);if(a.test=g,a.test.length>0)for(var i=0;i<a.test.length;i++)"undefined undefined"!=a.test[i].time&&f.siblings().children().eq(i).children().eq(0).text(a.test[i].time),f.siblings().children().eq(i).children().eq(1).text(a.test[i].user);f.siblings().height()>38*(m-e)&&e>5?f.siblings().removeClass("displayNone"):f.siblings().removeClass("displayNone")},"mouseleave .event":function(a,b,c,d){var e=$(this);e.siblings().addClass("displayNone")},"mouseenter .leave":function(a,b,c,d){var e=$(this);e.height()>38*(m-d)&&d>5?e.removeClass("displayNone"):e.removeClass("displayNone")},"mouseleave .leave":function(a,b,c,d){var e=$(this);e.addClass("displayNone")}},formatter:g.taskHistoryProgressFmt},{field:"operate",width:"80px",title:"",align:"left",valign:"middle",events:{"click .detail":function(a,b,c,e){a.stopPropagation(),d.go("task_detail",{tab_name:"review_his",task_id:c.pend_work_seq})}},formatter:j}]}},a.tasksHistoryUnauthTableControl={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&($(".pagination-detail").hide(),$(".pagination").show()),{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="display: none;">',"<td colspan='7' style='border:0px;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"pend_work_seq",title:"任务流水号",align:"left",valign:"middle",width:"165px"},{field:"pendwk_bk_expl",title:"任务说明",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"workflow_state",title:"任务状态",align:"left",valign:"middle",width:"100px",formatter:g.taskStatusFmt},{field:"crt_user_cn_name",title:"提交人",align:"left",valign:"middle",width:"100px"},{field:"deal_bk_dt",title:"结束时间",align:"left",valign:"middle",width:"165px"},{field:"operate",width:"300px",title:"状态",align:"left",valign:"middle",events:{"mouseenter .event":function(b,c,d,e){for(var f=$(this),g=d.work_detail_list?d.work_detail_list:[],h=0;h<g.length;h++)g[h].time=g[h].deal_bk_date+" "+g[h].deal_bk_time,1==g[h].pend_type?g[h].user="申请人："+g[h].deal_user_cn_name:2==g[h].pend_type?g[h].user="复核人："+g[h].deal_user_cn_name:3==g[h].pend_type?g[h].user="授权人："+g[h].deal_user_cn_name:4==g[h].pend_type?g[h].user="执行人："+g[h].deal_user_cn_name:5==g[h].pend_type&&(g[h].user="关闭人："+g[h].deal_user_cn_name);if(a.test=g,a.test.length>0)for(var i=0;i<a.test.length;i++)"undefined undefined"!=a.test[i].time&&f.siblings().children().eq(i).children().eq(0).text(a.test[i].time),f.siblings().children().eq(i).children().eq(1).text(a.test[i].user);f.siblings().height()>38*(n-e)&&e>5?f.siblings().removeClass("displayNone"):f.siblings().removeClass("displayNone")},"mouseleave .event":function(a,b,c,d){var e=$(this);e.siblings().addClass("displayNone")},"mouseenter .leave":function(a,b,c,d){var e=$(this);e.height()>38*(n-d)&&d>5?e.removeClass("displayNone"):e.removeClass("displayNone")},"mouseleave .leave":function(a,b,c,d){var e=$(this);e.addClass("displayNone")}},formatter:g.taskHistoryProgressFmt},{field:"operate",width:"80px",title:"",align:"left",valign:"middle",events:{"click .detail":function(a,b,c,e){a.stopPropagation(),d.go("task_detail",{tab_name:"auth_his",task_id:c.pend_work_seq})}},formatter:j}]}}}]}}),tbDirective.directive("messageList",function(){return{restrict:"AE",templateUrl:"templates/table/message_list.html",replace:"true",scope:{},controller:["$scope","$timeout","$compile","$state","config","Message","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return['<div style="position: absolute;margin-top: -12px;">','<a class="tabConVi detail" title="查看">',"</a>",'<div class="tabConDe trash" href="javascript:void(0)" style="margin-left: 8px;" id='+b.work_seq+' title="删除">',"</div>","</div>"].join("")}function k(a){l=a,f.mg_PageMessageActionPg(a).then(function(c){b(function(){c.total=c.all_recd,c.rows=c.msg_list?c.msg_list:[],a.success(c),a.complete()},0)},function(a){h.alert(a.message,3)})}var l={};a.msgTableControl={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,sortName:"crt_bk_time",sortOrder:"asc",rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",2==a.rc_flag?{classes:"tbl-odd",css:{"font-weight":"bold"}}:{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="display: none;">',"<td colspan='4' style='border:0px;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"crt_bk_time",title:"时间",align:"left",valign:"middle",width:"165px"},{field:"msg_title",title:"主题",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"crt_user_id",title:"发布人",align:"left",valign:"middle",width:"180px"},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"click .trash":function(a,b,c,d){a.stopPropagation();var e=c.work_seq;h.confirm("确认删除["+c.msg_title+"]消息？").then(function(a){a&&f.deleteOneMessage(e,c.msg_title).then(function(a){a&&(h.alert(c.msg_title+"删除消息成功！",2),k(l))},function(a){h.alert(a.message,3)})})},"click .detail":function(a,b,c,e){a.stopPropagation();var f=c.work_seq;d.go("msg_detail",{msg_id:f})}},formatter:j}]}}}]}}),tbDirective.directive("programTab",function(){return{restrict:"AE",templateUrl:"templates/table/program_tb.html",replace:"true",controller:["$scope","$modal","$compile","$timeout","$location","Program","ProgramExec","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b,c){return h.getPromgramConfigCol(a,b,c)}function m(b){n=b,b.key_word=a.key_word,f.pageProgramList(b).then(function(a){a.total=a.all_recd,a.rows=a.page_program_list,b.success(a),b.complete()},function(a){j.alert(a.message,3)})}var n={},o=a.handle_control.curr_index;a.search=function(a){m(n)},a.programTableControl={options:{ajax:m,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 2==a.pg_yn_flag?{classes:"tbl-odd tb-lightish"}:{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='5' style='border:0;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table-no-bordered table-hover",columns:[{field:"program_seq",title:"编号",align:"left",valign:"middle",width:"100px"},{field:"program_name",title:"方案名称",align:"left",valign:"middle",formatter:i.programFmt},{field:"user_cn_name",title:"创建人",align:"left",valign:"middle",width:"100px"},{field:"crt_bk_date",title:"保存时间",align:"left",valign:"middle",width:"100px"},{field:"operate",width:"120px",title:"",align:"right",valign:"middle",cellStyle:function(a,b,c,d){return{css:{padding:"0px"}}},events:{"click .user":function(b,c,e,h){b.stopPropagation(),1==e.pg_source?d(function(){g.useProgram(a.data.sub_tabs[o].wo_id,a.data.sub_tabs[o].basicData.deal_bk_seq,e.program_seq).then(function(b){return a.data.sub_tabs[o].steps=[],a.data.sub_tabs[o].showParamList=!1,a.data.sub_tabs[o].program_seq=e.program_seq,a.data.sub_tabs[o].program_name=e.program_name,f.getProgramInfoAndStepList(e.program_seq)}).then(function(b){if(b.program_step_list)for(var c=0;c<b.program_step_list.length;c++)a.data.sub_tabs[o].steps.push({step_seq:b.program_step_list[c].step_seq,step_bk_title:b.program_step_list[c].step_bk_title,sql_list:[],type:0,data:[]});return g.getStepByProgramStepId(e.program_seq,1)}).then(function(b){var c=a.data.sub_tabs[o];c.steps[0].sql_list=b.sql_list?b.sql_list:[],c.steps[0].type=b.sql_list?1:0,c.first_show_resetall=!1,c.finish_deal_order=!1,c.steps[0].stepFormLock=!1},function(a){j.alert(a.message,3)})},0):2==e.pg_source?d(function(){g.getImportPath(a.data.sub_tabs[o].wo_id,e.program_seq).then(function(b){return a.data.sub_tabs[o].showParamList=!1,a.data.sub_tabs[o].batchProgramBtn=!0,a.data.sub_tabs[o].batch_program_fileupload={suffixs:"xls,xlsx",filetype:"EXCEL",filename:"",uploadpath:b.pg_excel_path},a.data.sub_tabs[o].program_result_msg={},a.data.sub_tabs[o].control={show_result:!1,show_exec_btn:!0},a.data.sub_tabs[o].program_seq=e.program_seq,a.data.sub_tabs[o].program_name=e.program_name,a.data.sub_tabs[o].pg_source=e.pg_source,g.useProgram(a.data.sub_tabs[o].wo_id,a.data.sub_tabs[o].basicData.deal_bk_seq,e.program_seq)}).then(function(a){},function(a){j.alert(a.message,3)})},0):g.useProgram(a.data.sub_tabs[o].wo_id,a.data.sub_tabs[o].basicData.deal_bk_seq,e.program_seq).then(function(b){return a.data.sub_tabs[o].steps=[],a.data.sub_tabs[o].batchSelectProgramBtn=!0,a.data.sub_tabs[o].showParamList=!1,a.data.sub_tabs[o].program_seq=e.program_seq,a.data.sub_tabs[o].program_name=e.program_name,a.data.sub_tabs[o].control={show_result:!1,show_exec_btn:!0,exec_loading:!1},a.data.sub_tabs[o].pg_source=e.pg_source,f.getSelectProgramAllInfo(e.program_seq,a.data.sub_tabs[o].wo_id,a.data.sub_tabs[o].basicData.deal_bk_seq)}).then(function(b){a.data.sub_tabs[o].step_list=b.program_step_list?b.program_step_list:[];for(var c=0;c<a.data.sub_tabs[o].step_list.length;c++)for(var d=a.data.sub_tabs[o].step_list[c],e=0;e<d.program_sql_list.length;e++){var f=d.program_sql_list[e];if(f.sql_param_list)for(var g=0;g<f.sql_param_list.length;g++)f.sql_param_list[g].sparam_scope=""}},function(a){j.alert(a.message,3)})},"click .preview":function(a,b,c,e){a.stopPropagation(),d(function(){j.previewProgram(c.program_seq)},0)},"click .download":function(a,b,c,e){a.stopPropagation(),d(function(){var a=c.program_seq;f.exportBatchProgram(a).then(function(a){d(function(){a&&k.downloadFile(a.file_full_path)},0)},function(a){j.alert(a.message,3)})},0)}},formatter:l}]}}}]}}),tbDirective.directive("programList",function(){return{restrict:"AE",templateUrl:"templates/table/fault_program_tbl.html",replace:"true",controller:["$scope","$location","$modal","$state","$timeout","$compile","config","Col_Fmt","Program","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){return a.data?(a.data.offset=0,void n(o)):(j.alert("暂无数据记录"),!1)}function m(a,b,c){return['<span class="tabConDe trash" title="删除">',"</span>",b.pg_source&&1!=b.pg_source&&3!=b.pg_source?"":'<span class="tabConEd modify" title="修改">',"</span>",'<span class="tabConVi view" title="查看">',"</span>"].join("")}function n(a){o=a,a.key_word=p.key_word,i.pageProgramList(a).then(function(b){e(function(){b.total=b.all_recd,b.rows=b.page_program_list?b.page_program_list:[];for(var c=0;c<b.rows.length;c++)b.rows[c].crt_bk_time=b.rows[c].crt_bk_date+" "+b.rows[c].crt_bk_time;q=a,a.success(b),a.complete()},0)},function(a){j.alert(a.message,3)})}var o,p={},q={};a.downLoadProgram=function(a){var b=a.program_seq;i.exportBatchProgram(b).then(function(a){e(function(){a&&k.downloadFile(a.file_full_path)},0)},function(a){j.alert(a.message,3)})},a.programTableControl={options:{ajax:n,pagination:!0,pageSize:20,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;a.item=b;var d=!0,e=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',1!=b.pg_source&&3!=b.pg_source&&b.pg_source?"<td colspan='6' style='border:0;text-align: right;'><button class='ordinary-btn' ng-click='downLoadProgram(item);' style='margin-right:80px;'><i class='fa fa-download'></i>&nbsp;下载</button></td>":"<td colspan='6' style='border:0px;text-align: right;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(c.after(f(e)(a)),c.addClass("table_col_Style"),c.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"program_seq",title:"编号",align:"left",valign:"middle",width:"130px",formatter:h.workOrderFmt},{field:"program_name",title:"方案名称",align:"left",valign:"middle",formatter:h.programFmt},{field:"program_bk_desc",title:"方案描述",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"user_cn_name",title:"创建人",align:"left",valign:"middle",width:"150px",formatter:h.workOrderFmt},{field:"crt_bk_time",title:"创建时间",align:"left",valign:"middle",width:"140px",formatter:h.programTimeFmt},{field:"operate",width:"100px",title:"",align:"right",valign:"middle",events:{"click .trash":function(a,b,c,d){a.stopPropagation();var e=c.program_seq;j.confirm("确认删除["+e+"]方案？").then(function(a){a&&i.deleteFaultProgram(e).then(function(a){a&&(a.confirm_msg?j.confirm(a.confirm_msg+",确认删除["+e+"]方案？").then(function(a){a&&i.deleteFaultProgram(e,2).then(function(a){
j.alert(e+" 方案删除成功！",2),n(o)})}):(j.alert(e+" 方案删除成功！",2),n(o)))},function(a){j.alert(a.message,3)})})},"click .download":function(a,b,c,d){var f=c.program_seq;i.exportBatchProgram(f).then(function(a){e(function(){a&&k.downloadFile(a.file_full_path)},0)},function(a){j.alert(a.message,3)})},"click .modify":function(a,b,c,e){a.stopPropagation(),d.go("fault_program_modify",{program_id:c.program_seq})},"click .view":function(a,b,c,e){a.stopPropagation(),d.go("fault_program_detail",{program_id:c.program_seq,program_source:c.pg_source})}},formatter:m}]}},a.clear=function(){a.search_key_word="",p.key_word=""},a.searchProgramByKeyword=function(){p.key_word=a.search_key_word,l(q)}}]}}),tbDirective.directive("troubleTypeList",function(){return{restrict:"AE",templateUrl:"templates/table/trouble_type_tbl.html",replace:!0,controller:["$scope","$modal","$compile","$timeout","$location","TroubleConfig","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c){return["<div>",'<div class="tabConDe trash" title="删除" >',"</div>",'<div class="tabConEd edit" title="修改" >',"</div>","</div>"].join("")}function l(a){m=a,f.getTroubleTypeList(a).then(function(b){b.rows=b.trouble_type_list?b.trouble_type_list:[],a.success(b),a.complete()},function(a){i.alert(a.message,3)})}var m={};a.addTroubleType=function(){i.faultTroubleType().then(function(a){a&&l(m)})},a.troubleTypeControl={options:{ajax:l,pagination:!1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='4' style='border:0;text-align: center;'><div style='color: #6D7183;'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"trouble_key",title:"故障编号",align:"left",valign:"middle",width:"100px"},{field:"trouble_code",title:"故障代码",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"trouble_bk_desc",title:"故障描述",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"operate",width:"100px",title:"",align:"center",valign:"middle",events:{"click .edit":function(a,b,c,d){var e=c.trouble_key;a.stopPropagation(),i.faultTroubleType(e).then(function(a){a&&l(m)})},"click .trash":function(a,b,c,d){a.stopPropagation();var e=c.trouble_key;i.confirm("确认删除故障编号["+e+"]？").then(function(a){a&&f.deleteTroubleType(e).then(function(a){a&&(i.alert("故障编号["+e+"]删除成功！",2),l(m))},function(a){i.alert(a.message,3)})})}},formatter:k}]}}}]}}),tbDirective.directive("peakDateList",function(){return{restrict:"AE",templateUrl:"templates/table/peak_data_tb.html",replace:"true",controller:["$scope","$timeout","$compile","$modal","TroubleConfig","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h){function i(a,b,c){return["<div>",'<div class="tabConDe trash" title="删除">',"</div>",'<div class="tabConEd edit" title="修改" >',"</div>","</div>"].join("")}function j(a){k=a,e.getPeakTimeIntervalList(a).then(function(b){b.total=b.all_recd,b.rows=b.time_interval_list?b.time_interval_list:[],a.success(b),a.complete()},function(a){g.alert(a.message,3)})}var k={};a.addPeakDate=function(){g.faultPeakData().then(function(a){a&&j(k)})},a.peakDataController={options:{ajax:j,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,d){if(!b)return!1;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: center;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"time_cn_name",title:"时段中文名",align:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"time_bk_desc",title:"时段描述",align:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"wday_type",title:"高峰日类型",align:"left",valign:"middle",width:"150px",formatter:f.wdayTypeFmt},{field:"start_bk_date",title:"开始日期",align:"left",valign:"middle",width:"100px",formatter:f.noZeroFmt},{field:"end_bk_date",title:"结束日期",align:"left",valign:"middle",width:"100px",formatter:f.noZeroFmt},{field:"times",title:"开始结束时间组",align:"left",valign:"middle",width:"150px",formatter:f.peakDateListFmt},{field:"operate",width:"100px",title:"",align:"center",valign:"middle",events:{"click .edit":function(a,b,c,d){var e=c.time_work_seq;g.faultPeakData(e).then(function(a){a&&j(k)})},"click .trash":function(a,b,c,d){var f=c.time_work_seq,h=c.time_cn_name;g.confirm("确认删除["+h+"]高峰时段？").then(function(a){a&&e.deletePeakTimeInterval(f).then(function(a){a&&(g.alert("["+h+"]高峰时段删除成功！",2),j(k))},function(a){g.alert("删除失败",3)})})}},formatter:i}]}}}]}}),tbDirective.directive("logFileList",function(){return{restrict:"AE",templateUrl:"templates/table/log_fileList_tbl.html",replace:"true",scope:{sys_name:"=sysName",log_name:"=logName",log_id:"=logId",search:"&search",reset_log:"=resetLog"},controller:["$scope","$location","$modal","$timeout","config","Col_Fmt","BusiSys","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return b.download_url?['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" href="javascript:void(0)" title="删除">',"</div>",'<a class="logDownLoad" title="下载"  href="javascript:void(0)">',"</a>","</div>"].join(""):['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" href="javascript:void(0)" title="删除">',"</div>","</div>"].join("")}function k(b){m=b,b.key_word=n.key_word,g.viewLogList(b,a.sys_name,a.log_name,a.log_id).then(function(a){d(function(){a.total=a.all_recd,a.rows=a.logSyncInfoList?a.logSyncInfoList:[],o=b,b.success(a),b.complete()},0)},function(a){h.alert(a.message,3)})}var l,m,n={},o={};a.logFileListControl={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},classes:"table table-no-bordered table-hover",columns:[{field:"file_date",title:"日期",align:"left",valign:"middle",width:"100px",formatter:f.px100Fmt},{field:"download_date",title:"下载日期",align:"left",valign:"middle",width:"100px",formatter:f.px100Fmt},{field:"local_file_name",title:"文件名",align:"left",valign:"middle",width:"100px",formatter:f.hideDetailFmt},{field:"soc_ip",title:"节点",align:"left",valign:"middle",width:"80px"},{field:"file_length",title:"大小",align:"left",valign:"middle",width:"60px",formatter:f.formByteToM},{field:"file_get_type",title:"上传方式",align:"left",valign:"middle",width:"75px",formatter:f.formByUploadType},{field:"error_msg",title:"下载信息",align:"left",valign:"middle",width:"150px",formatter:f.showDownMsg},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"mouseenter .tbl_config":function(){var a=$(this).children().eq(0).children(),b=$(this).parent().parent().siblings().find(".pp"),c=$(this);b.animate({right:"-252px"},200,function(){b.parent().siblings().children().each(function(){c.css("background",c.attr("name")%2==0?"#FFF":"#F6F7FC")})}),l&&d.cancel(l),l=d(function(){c.css("background","#5A72A3"),a.animate({right:"30px"},500)},200)},"mouseleave .tbl_config":function(){var a=$(this).children().eq(0).children(),b=$(this).children().eq(1).children();l&&d.cancel(l),l=d(function(){a.animate({right:"-252px"},200,function(){b.parent().siblings().children().each(function(){b.css("background",b.attr("name")%2==0?"#FFF":"#F6F7FC")})})},200)},"click .trash":function(a,b,c,d){var e=c.id;h.confirm("确认删除["+c.local_file_name+"]日志？").then(function(a){a&&g.logUploadBaseDelete(e,c.local_file_name,c.local_dir).then(function(a){a&&(h.alert(c.local_file_name+" 删除成功！",2),k(m))},function(a){h.alert(a.message,3)})})},"click .logDownLoad":function(a,b,c,d){var e=c.download_url;h.confirm("确认下载?").then(function(a){a&&i.downloadFile(e)})}},formatter:j}]}},a.search=function(){k(m)},a.$watch("reset_log",function(b,c){b!=c&&b&&d(function(){k(m),a.reset_log=!1},500)}),a.$watch("log_name",function(b,c){b!=c&&b&&(k(m),a.reset_log=!1)})}]}}),tbDirective.directive("logInspectList",function(){return{restrict:"AE",templateUrl:"templates/table/log_inspectReport_tbl.html",replace:"true",controller:["$scope","$compile","$location","$modal","$window","$timeout","config","Col_Fmt","BusiSys","Modal","LogXJ","CV",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" title="删除" href="javascript:void(0)" >',"</div>",'<a class="tabConVi" title="查看" href="javascript:void(0)">',"</a>","</div>"].join("")}function n(a){p=a,a.key_word=q.key_word,i.viewLogReportViewList(a).then(function(b){f(function(){b.total=b.all_recd,b.rows=b.log_report_list?b.log_report_list:[],angular.forEach(b.rows,function(a){a.create_date_time=a.create_date_time.substring(0,a.create_date_time.lastIndexOf("."))}),r=a,a.success(b),a.complete()},0)},function(a){j.alert(a.message,3)})}var o,p,q={},r={};a.downLoad=function(a){l.downloadFile(a.down_file_path)},a["export"]=function(a){var b=a.report_name;b&&e.open("templates/pdf/log_report.html?report_name="+b+"=true","_blank","height=700, width=900, toolbar=no, menubar=no, scrollbars=yes, resizable=no, location=no, status=no")},a.logInspectReportListControl={options:{ajax:n,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},onClickRow:function(c,d){if(!c)return!1;a.item=c;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: right;'><button class='ordinary-btn' ng-click='downLoad(item);' style='margin-right:80px;'><i class='glyphicon glyphicon-download-alt'></i>&nbsp;下载</button></td>","</tr>"].join(""),g=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: right;'><button class='ordinary-btn' ng-click='export(item);' style='margin-right:80px;'><i class='glyphicon glyphicon-share-alt'></i>&nbsp;导出</button></td>","</tr>"].join(""),h=['<tr class="col_option" id="col_option" style="display: none;">',"<td colspan='7' style='border:0px;text-align: center;color: #6D7183'>暂无操作项</td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(c.report_url&&!c.down_file_path?d.after(b(g)(a)):c.down_file_path?d.after(b(f)(a)):c.down_file_path||c.report_url||d.after(b(h)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"report_name",title:"报告名称",align:"left",valign:"middle",width:"165px"},{field:"sys_name",title:"应用系统",align:"left",valign:"middle",width:"150px"},{field:"time_interval_type",title:"报告模板",align:"left",valign:"middle",width:"84px",formatter:h.timeTypeFomat},{field:"log_names",title:"日志",align:"left",valign:"middle",formatter:h.hideLogDetailFmt},{field:"start_date",title:"时间范围",align:"left",valign:"middle",width:"150px",formatter:h.formTimeLimit},{field:"create_date_time",title:"生成时间",align:"left",valign:"middle",width:"200px"},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"mouseenter .tbl_config":function(){var a=$(this).children().eq(0).children(),b=$(this).parent().parent().siblings().find(".pp"),c=$(this);b.animate({right:"-252px"},200,function(){b.parent().siblings().children().each(function(){c.css("background",c.attr("name")%2==0?"#FFF":"#F6F7FC")})}),o&&f.cancel(o),o=f(function(){c.css("background","#5A72A3"),a.animate({right:"30px"},500)},200)},"mouseleave .tbl_config":function(){var a=$(this).children().eq(0).children(),b=$(this).children().eq(1).children();o&&f.cancel(o),o=f(function(){a.animate({right:"-252px"},200,function(){b.parent().siblings().children().each(function(){b.css("background",b.attr("name")%2==0?"#FFF":"#F6F7FC")})})},200)},"click .trash":function(a,b,c,d){var e=c.report_name,f=c.log_id;j.confirm("确认删除["+e+"]日志？").then(function(a){a&&k.deleteReportByName(e,f).then(function(a){a&&(j.alert(e+" 删除成功！",2),n(p))},function(a){j.alert(a.message,3)})})},"click .tabConVi":function(a,b,c,d){var f=(c.report_url,c.report_name);f&&e.open("templates/pdf/log_report.html?report_name="+f+"=true","_blank","height=700, width=900, toolbar=no, menubar=no, scrollbars=yes, resizable=no, location=no, status=no")}},formatter:m}]}},a.resetQuery=function(){n(p)}}]}}),tbDirective.directive("ywCurrentTaskList",function(){return{restrict:"E",templateUrl:"templates/table/yw_current_task_tbl.html",replace:"true",controller:["$scope","$rootScope","$timeout","$state","Flow","config","Col_Fmt","TblOption","MouseMoveEvent","OptionCol","$compile","$location","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){t=a,e.getCurrentTaskList(a).then(function(b){c(function(){b.rows=b.sdtask_list?b.sdtask_list:[];for(var c=0;c<b.rows.length;c++){var d=b.rows[c];d.task_type_list=d.sdflow_type?(d.sdflow_type+"").split(","):[]}a.success(b),a.complete()},0)},function(a){m.alert(a.message,3)})}function p(){a.info.exe_user_id="",a.info.task_name="",a.info.exe_type="",a.info.task_type="",a.info.start_date="",a.info.end_date=""}function q(){t.exe_user_id="",t.sdtask_cn_name="",t.sddispatch_type="",t.sdflow_type="",t.start_bk_datetime="",t.end_bk_datetime=""}function r(a){return a.data?(a.data.offset=0,void o(a)):(m.alert("暂无数据记录"),!1)}var s,t={};a.exeTask=function(a){d.go("dispatch_task.execute",{task_id:a.sdtask_id})},a.ywCurTaskListControl={options:angular.extend({},{ajax:o,onClickRow:function(b,c){if(!b)return!1;a.item=b;var d,e=!0;d=4==b.sdtask_status||5==b.sdtask_status?['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='8' style='border:0px;text-align: center;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join(""):['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='8' style='border:0px;text-align: right;'><button class='ordinary-btn' ng-click='exeTask(item);' style='margin-right:80px;'><i class='fa fa-check'></i>&nbsp;执行</button></td>","</tr>"].join(""),"col_option"==c.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(c.after(k(d)(a)),c.addClass("table_col_Style"),c.next().slideDown())},columns:[{field:"sdtask_id",title:"任务编号",align:"left",valign:"middle",width:"120px",formatter:g.hideDetailFmt},{field:"sdtask_cn_name",title:"任务名称",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"task_type_list",title:"任务类型",align:"left",halign:"center",valign:"middle",width:"100px",events:{"mouseenter .animate_active":function(){var a=$(this);$(document).off("mousemove"),s&&c.cancel(s),a.next()[0]?"none"==a.next()[0].style.display&&c(function(){$(".animate_active").next().css({display:"none"})},0):c(function(){$(".animate_active").next().css({display:"none"})},0),s=c(function(){a.next().fadeIn(200)},200)},"mouseleave .animate_active":function(){var a=$(this);if(a.next().length>0){var b=a.next()[0],d=$(b).offset().left,e=d+122+20,f=$(b).offset().top,g=$(b).offset().top+$(b).height();$(document).mousemove(function(a){(a.pageX<d||a.pageX>e||a.pageY<f||a.pageY>g)&&(s&&c.cancel(s),s=c(function(){$(".animate_active").next().fadeOut(200)},0))})}}},formatter:g.ywTaskType},{field:"sddispatch_type",title:"执行方式",align:"left",halign:"left",valign:"middle",width:"80px",formatter:g.ywExecType},{field:"exe_user_name",title:"执行人",align:"left",halign:"left",valign:"middle",width:"120px"},{field:"start_bk_datetime",title:"开始时间",align:"left",valign:"middle",width:"140px",formatter:g.ywTasktimeFmt},{field:"sdtask_status",title:"任务状态",align:"center",valign:"middle",width:"100px",formatter:g.taskExecStaus},{width:"70px",events:{"click .tabConDn":function(a,b,c,d){a.stopPropagation(),n.downloadFile(c.exe_log_path)},"click .tabConVi":function(a,b,c,e){a.stopPropagation(),d.go("dispatch_task.detail",{task_id:c.sdtask_id})}},formatter:function(a,b,c){var d="";return d=!b.exe_log_path||4!=b.sdtask_status&&5!=b.sdtask_status?['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div style="width:28px;height:21px;display: inline-block;">',"</div>",'<a class="tabConVi" title="查看" href=#/yw_task_detail/'+b.sdtask_id+">","</a>","</div>"].join(""):['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDn" title="下载日志">',"</div>",'<a class="tabConVi" title="查看">',"</a>","</div>"].join("")}}]},h)},a.searchTaskByKeyword=function(){q(),t.key_word=a.control.search_keyword,r(t)},a.advancedSearch=function(){t.key_word="",a.control.search_keyword="",t.exe_user_id=a.info.exe_user_id,t.sdtask_cn_name=a.info.task_name,t.sddispatch_type=a.info.exe_type,t.sdflow_type=a.info.task_type?[a.info.task_type]:"",t.start_bk_datetime=n.dtFormat(a.info.start_date),t.end_bk_datetime=n.dtFormat(a.info.end_date),a.info.start_date>a.info.end_date?m.alert("开始时间大于结束时间，请重新选择",3):(a.control.open_senior_flag=!1,r(t),p(),q())},a.clear=function(){a.control.search_keyword=""},a.openSeniorSearch=function(){a.control.open_senior_flag=!a.control.open_senior_flag,a.control.open_senior_flag&&(a.info.start_date="",a.info.end_date="")},a.collapseAdvSearch=function(){a.control.open_senior_flag=!1,p(),q()}}]}}),tbDirective.directive("ywHistoryTaskList",function(){return{restrict:"AE",templateUrl:"templates/table/yw_history_task_tbl.html",controller:["$scope","$timeout","$modal","$state","Flow","config","Col_Fmt","TblOption","MouseMoveEvent","OptionCol","Modal","$compile","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){a.info.exe_user_id="",a.info.task_name="",a.info.exe_type="",a.info.task_type="",a.info.start_date="",a.info.end_date=""}function o(){s.exe_user_id="",s.sdtask_cn_name="",s.sddispatch_type="",s.sdflow_type="",s.start_bk_datetime="",s.end_bk_datetime=""}function p(a){return a.data?(a.data.offset=0,void q(a)):(k.alert("暂无数据记录"),!1)}function q(a){e.pageHistoryTaskList(a).then(function(c){b(function(){c.total=c.all_recd,c.rows=c.sdtask_his_list?c.sdtask_his_list:[];for(var b=0;b<c.rows.length;b++){var d=c.rows[b];d.time_used_cn=d.time_used?m.usedCnTime(d.time_used):"--",d.task_type_list=d.sdflow_type?(d.sdflow_type+"").split(","):[]}s=a,a.success(c),a.complete()},0)},function(a){k.alert(a.message,3)})}var r,s={};a.ywHisTaskListControl={options:{ajax:q,pagination:!0,pageSize:10,pageNumber:1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0===b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},classes:"table table-no-bordered table-hover",onClickRow:function(b,c){if(!b)return!1;a.item=b;var d=!0,e=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='10' style='border:0px;text-align: center;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(d=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),d&&(c.after(l(e)(a)),c.addClass("table_col_Style"),c.next().slideDown())},columns:[{field:"sdtask_id",title:"任务编号",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"sdtask_cn_name",title:"任务名称",align:"left",halign:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"task_type_list",title:"任务类型",align:"left",halign:"center",valign:"middle",width:"100px",events:{"mouseenter .animate_active":function(){var a=$(this);$(document).off("mousemove"),r&&b.cancel(r),a.next()[0]?"none"==a.next()[0].style.display&&b(function(){$(".animate_active").next().css({display:"none"})},0):b(function(){$(".animate_active").next().css({display:"none"})},0),r=b(function(){a.next().fadeIn(200)},200)},"mouseleave .animate_active":function(){var a=$(this);if(a.next().length>0){var c=a.next()[0],d=$(c).offset().left,e=d+122+20,f=$(c).offset().top,g=$(c).offset().top+$(c).height();$(document).mousemove(function(a){(a.pageX<d||a.pageX>e||a.pageY<f||a.pageY>g)&&(r&&b.cancel(r),r=b(function(){$(".animate_active").next().fadeOut(200)},0))})}}},formatter:g.ywTaskType},{field:"sddispatch_type",title:"执行方式",align:"left",halign:"left",valign:"middle",width:"80px",formatter:g.ywExecType},{field:"exe_user_name",title:"执行人",align:"left",halign:"left",valign:"middle"},{field:"start_bk_datetime",title:"开始时间",align:"left",valign:"middle",width:"140px",formatter:g.ywTasktimeFmt},{field:"time_used_cn",title:"运行时间",align:"left",valign:"middle",width:"100px",formatter:g.noZeroFmt},{field:"end_bk_datetime",title:"结束时间",align:"left",valign:"middle",width:"140px",formatter:g.ywTasktimeFmt},{field:"sdtask_status",title:"任务状态",align:"center",valign:"middle",width:"100px",formatter:g.taskExecStaus},{width:"70px",events:{"click .tabConDn":function(a,b,c,d){a.stopPropagation(),m.downloadFile(c.exe_log_path)},"click .tabConVi":function(a,b,c,e){a.stopPropagation(),d.go("dispatch_task.detail",{task_id:c.sdtask_id})}},formatter:function(a,b,c){var d="";return d=!b.exe_log_path||4!=b.sdtask_status&&5!=b.sdtask_status?['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div style="width:28px;height:21px;display: inline-block;">',"</div>",'<a class="tabConVi" title="查看" href=#/yw_task_detail_his/'+b.sdtask_id+">","</a>","</div>"].join(""):['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDn" title="下载日志">',"</div>",'<a class="tabConVi">',"</a>","</div>"].join("")}}]}},a.searchTaskByKeyword=function(){o(),s.key_word=a.control.search_keyword,p(s)},a.advancedSearch=function(){s.key_word="",a.control.search_keyword="",s.exe_user_id=a.info.exe_user_id,s.sdtask_cn_name=a.info.task_name,s.sddispatch_type=a.info.exe_type,s.sdflow_type=a.info.task_type?[a.info.task_type]:"",s.start_bk_datetime=m.dtFormat(a.info.start_date),s.end_bk_datetime=m.dtFormat(a.info.end_date),a.info.start_date>a.info.end_date?k.alert("开始时间大于结束时间，请重新选择",3):(a.control.open_senior_flag=!1,p(s),n(),o())},a.clear=function(){a.control.search_keyword=""},a.openSeniorSearch=function(){console.log(11),a.control.open_senior_flag=!a.control.open_senior_flag,a.control.open_senior_flag&&(a.info.start_date="",a.info.end_date="")},a.collapseAdvSearch=function(){a.control.open_senior_flag=!1,n(),o()}}]}}),tbDirective.directive("articleFlowList",function(){return{restrict:"E",templateUrl:"templates/table/article_flow_list.html",controller:["$scope","$timeout","$modal","$state","BusiSys","Flow","config","Col_Fmt","TblOption","MouseMoveEvent","OptionCol","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(c){b(function(){c.key_word=a.search.key_word;var d=a.tabs[a.control.active_tab];c.exe_types=d.type||"",d.dispatch?f.pageOpFlowList(c).then(function(d){b(function(){d.total=d.all_recd,d.rows=d.flow_list?d.flow_list:[],o=c,c.success(d),c.complete(),d.rows.length&&($("tr[data-index=0]").addClass("table_col_Style"),a.viewDetail(d.rows[0].sdflow_id,d.rows[0].sdversion_id))},0)},function(a){l.alert(a.message,3)}):f.pageAttentionFlowList(c).then(function(d){b(function(){d.total=d.all_recd,d.rows=d.focus_flow_list?d.focus_flow_list:[],o=c,c.success(d),c.complete(),d.rows.length&&($("tr[data-index=0]").addClass("table_col_Style"),a.viewDetail(d.rows[0].sdflow_id,d.rows[0].sdversion_id))},0)},function(a){l.alert(a.message,3)})},0)}var o={},p=0;a.search={key_word:""},a.$watch("flow_list_reflash",function(b,c){0!=p&&a.doSearch(),p+=1},!0),a.articleFlowListControl={options:{ajax:n,pagination:!0,pageSize:14,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,sortName:"default",sortOrder:"desc",rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd",css:{padding:"6px 8px 5px"}}},onClickRow:function(b,c){return b?(c.siblings().removeClass("table_col_Style"),c.addClass("table_col_Style"),a.viewDetail(b.sdflow_id,b.sdversion_id),!1):!1},classes:"table table-no-bordered table-hover tbody_height",columns:[{field:"sdflow_cn_name",title:"流程名称",align:"left",valign:"middle",events:{"click .edit_flow":function(a,b,c,e){a.stopPropagation();var f=c.sdflow_id,g=c.sdversion_id;d.go("dispatch_flow_modify",{flow_id:f,version_id:g,modify_flag:!0})}},formatter:h.flowEditFmt},{field:"crt_user_name",title:"创建人",align:"left",halign:"left",valign:"middle",width:"120px"},{field:"publish_bk_date",title:"发布时间",align:"left",halign:"left",valign:"middle",width:"140px",formatter:h.flowPublishTime},{field:"sdflow_status",title:"状态",align:"left",halign:"center",valign:"middle",width:"90px",formatter:h.flowIsPublishFmt}]}},a.doSearch=function(){o.data.offset=0,n(o)},a.clear=function(){a.search.key_word=""}}]}}),tbDirective.directive("dispatchSceneList",function(){return{restrict:"AE",templateUrl:"templates/table/dispatch_scene_tb.html",replace:"true",controller:["$scope","$rootScope","$state","$timeout","Scene","config","Col_Fmt","TblOption","MouseMoveEvent","OptionCol","$compile","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" title="删除">',"</div>",'<div class="tabConEd edit" title="修改">',"</div>",'<div class="tabConVi view" title="查看">',"</div>","</div>"].join("")}function o(b){b.key_word=a.search.key_word,p=b,e.getSceneListByType(b).then(function(c){d(function(){c.total=c.all_recd,c.rows=c.scene_list?c.scene_list:[],b.success(c),b.complete(),c.rows.length&&($("tr[data-index=0]").addClass("table_col_Style"),a.viewSingleScene(c.rows[0].scene_id,3===c.rows[0].scene_type))},0)},function(a){l.alert(a.message,3)})}var p={};a.search={key_word:""},a.doSearch=function(){p.data.offset=0,o(p)},a.clear=function(){a.search.key_word=""},a.dispatchSceneControl={options:{ajax:o,pagination:!0,pageSize:14,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0===b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;c.siblings().removeClass("table_col_Style"),c.addClass("table_col_Style");var d=3===b.scene_type;a.viewSingleScene(b.scene_id,d)},classes:"table table-no-bordered table-hover ",columns:[{field:"scene_name",title:"场景名称",align:"left",valign:"middle",width:"120px",formatter:g.sceneNameFmt},{field:"crt_user_name",title:"创建人",align:"left",valign:"middle",width:"100px",formatter:g.hideDetailFmt},{field:"crt_bk_date",title:"创建时间",align:"left",halign:"left",valign:"middle",width:"140px",formatter:g.sceneCrtTime},{field:"operate",width:"70px",events:{"click .trash":function(a,b,d,f){a.stopPropagation();var g=d.scene_id,h=d.scene_name?d.scene_name:"";l.confirm("删除[ "+h+" ]场景？").then(function(a){a&&e.removeSingleScene(g).then(function(a){a&&(l.alert("[ "+h+" ] 删除成功",2),c.go("dispatch_scene_list"),o(p))},function(a){l.alert(a.message,3)})})},"click .edit":function(a,b,d,e){a.stopPropagation(),c.go("dispatch_scene_modify",{scene_id:d.scene_id})},"click .view":function(a,b,d,e){a.stopPropagation();var f=d.scene_type||1;c.go("dispatch_scene_detail",{scene_id:d.scene_id,private_flag:f})}},formatter:n}]}}}]}}),tbDirective.directive("dispatchStrategyList",function(){return{restrict:"AE",templateUrl:"templates/table/dispatch_strategy_group_tb.html",replace:"true",controller:["$scope","$rootScope","$timeout","$state","Strategy","config","Col_Fmt","TblOption","MouseMoveEvent","OptionCol","$compile","$location","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b,c){var d=['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" title="删除">',"</div>",'<a class="tabConVi" title="查看">',"</a>","</div>"].join("");return d}function p(a){q=a,e.getStrategyGroupList().then(function(b){c(function(){b.rows=b.strategy_group_list?b.strategy_group_list:[],a.success(b),a.complete()},0)},function(a){m.alert(a.message,3)})}var q={};a.$on("updateTableDate",function(a,b){p(q)}),a.dispatchStrategyControl={options:angular.extend({},{ajax:p,onClickRow:function(a,b){return!1},columns:[{field:"sdstrategy_name",title:"策略组名称",align:"left",valign:"middle",width:"150px",formatter:g.hideDetailFmt},{field:"sdstrategy_desc",title:"策略组描述",align:"left",valign:"middle",formatter:g.hideDetailFmt},{field:"sdstrategy_type",title:"策略组类型",align:"left",halign:"left",valign:"middle",width:"100px",formatter:g.strategyTypeCnFmt},{field:"operate",width:"80px",events:{"click .trash":function(a,b,c,d){a.stopPropagation();var f=c.sdstrategy_id?c.sdstrategy_id:"",g=c.sdstrategy_name?c.sdstrategy_name:"";m.confirm("删除[ "+g+" ]策略组？").then(function(a){a&&e.removeStrategyGroup(f).then(function(a){a&&(m.alert("[ "+g+" ] 删除成功！",2),p(q))},function(a){m.alert(a.message,3)})})},"click .tabConVi":function(a,b,c,e){a.stopPropagation(),d.go("dispatch_strategy_detail",{strategy_id:c.sdstrategy_id})}},formatter:o}]},h)}}]}}),tbDirective.directive("cmptList",function(){return{restrict:"AE",templateUrl:"templates/table/cmpt_list_tbl.html",replace:!0,controller:["$scope","$modal","$timeout","$compile","$state","Cmpt","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){function k(a){return a.data?(a.data.offset=0,void m(a)):(i.alert("暂无数据记录"),!1)}function l(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<a class="tabConVi view" title="查看">',"</a>",'<a class="tabConEd modify" title="修改">',"</a>",'<div class="tabConDe trash" title="删除" href="javascript:void(0)" >',"</div>","</div>"].join("")}function m(a){(n.cn_name||n.tag_lis||n.impl_types||n.start_modify_date||n.end_modify_date||n.crt_user_id||n.publish_state||n.component_purpose)&&(a.cn_name=n.cn_name,a.tag_list=n.tag_list,a.impl_types=n.impl_types,a.start_modify_date=n.start_modify_date,a.end_modify_date=n.end_modify_date,a.crt_user_id=n.crt_user_id,a.publish_state=n.publish_state,a.component_purpose=n.component_purpose),n=a,a.data.sort=a.data.sort?"component_purposes"==a.data.sort?"component_purposes":"crt_bk_date,crt_bk_time":"",f.getCmptPageList(a).then(function(b){c(function(){var c=b.comp_list?b.comp_list:[];0==c.length&&(o="暂无数据");for(var d=0;d<c.length;d++)c[d].type="1","/*"==c[d].cn_name.substring(0,2)&&(c[d].cn_name=c[d].cn_name.substring(2,c[d].cn_name.length-2));b.rows=c,b.total=b.all_recd,a.success(b),a.complete()},200)},function(b){o=b.message,a.success({}),a.complete()})}var n={},o="",p={};a.test=function(a){e.go("cmpt_test",{cmpt_id:a.id,cmpt_name:a.cn_name})},a.cmptPublish=function(a){var b=a.id,c=a.type;i.confirm("是否发布组件 ?").then(function(a){a&&f.publishCmpt(b,c).then(function(a){a&&(i.alert("发布成功!",2),m(n))},function(a){i.alert(a.message,3)})})},a.subgroupListControl={options:{ajax:m,pagination:!0,pageSize:10,pageNumber:1,sidePagination:"server",sortName:"crt_bk_date,crt_bk_time",sortOrder:"desc",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;border-top: none;">',"<td colspan='9' style='border:none!important;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='test(item);' style='margin-right:20px;'><i class='fa fa-map-marker'></i>&nbsp;测试</button></td>","</tr>"].join(""),g=['<tr class="col_option" id="col_option" style="height:40px;display: none;border-top: none;">',"<td colspan='9' style='border:none!important;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='test(item);' style='margin-right:20px;'><i class='fa fa-map-marker'></i>&nbsp;测试</button><button class='ordinary-btn' ng-click='cmptPublish(item)' style='margin-right:20px;'><i class='fa fa-check'></i>&nbsp;发布</button></td>","</tr>"].join("");
"col_option"==c.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(2!=b.publish_state&&b.publish_state?c.after(d(f)(a)):c.after(d(g)(a)),c.addClass("table_col_Style"),c.next().slideDown())},formatNoMatches:function(){return o},classes:"table table-no-bordered table-hover",columns:[{field:"crt_bk_time",title:"创建时间",align:"left",valign:"middle",sortable:!0,width:"145px",formatter:h.combineTimeDate},{field:"cn_name",title:"组件名",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"module_purposes",title:"组件类型",align:"left",valign:"middle",width:"100px",formatter:h.cmptListCmptType},{field:"impl_type",title:"执行类别",align:"left",valign:"middle",width:"80px",formatter:h.subgroupListExecuteTypeFmt},{field:"tag_list",title:"分类",align:"center",valign:"middle",width:"120px",formatter:h.classifyTag},{field:"crt_user_name",title:"创建人",align:"left",valign:"middle",width:"100px"},{field:"modify_bk_time",title:"修改时间",align:"left",valign:"middle",width:"145px",formatter:h.combineModifyTimeDate},{field:"publish_state",title:"发布状态",align:"left",valign:"middle",width:"75px",formatter:h.envIsPublishFmt},{field:"operate",width:"100px",title:"",align:"center",valign:"middle",events:{"click .trash":function(a,b,c,d){a.stopPropagation();var e=c.id,g=c.cn_name;i.confirm("确认删除["+g+"]组件？").then(function(a){a&&f.deleteModule(e).then(function(a){a&&(i.alert(g+" 删除成功！",2),m(n))},function(a){i.alert(a.message,3)})})},"click .publish":function(a,b,c,d){var e=c.id,g=c.type;i.confirm("是否发布组件 ?").then(function(a){a&&f.publishCmpt(e,g).then(function(a){a&&(i.alert("发布成功!",2),m(n))},function(a){i.alert(a.message,3)})})},"click .modify":function(a,b,c,d){e.go("cmpt_modify",{cmpt_id:c.id})},"click .view":function(a,b,c,d){e.go("cmpt_detail",{cmpt_id:c.id})}},formatter:l}]}},a.clear=function(){a.search_key_word=""},a.searchCmptByKeyword=function(){n.cn_name=a.search_key_word,n.tag_list=[],n.impl_types=[],n.start_modify_date="",n.end_modify_date="",n.crt_user_id="",n.publish_state=0,n.component_purpose=0,k(n)},a.seniorSearch=function(){p.tag_list=[],p.impl_types=[];for(var b=0;b<a.info.high_search_obj.exec_type_list.length;b++)a.info.high_search_obj.exec_type_list[b].flag&&p.impl_types.push(a.info.high_search_obj.exec_type_list[b].key);for(var b=0;b<a.info.high_search_obj.classify_list.length;b++)a.info.high_search_obj.classify_list[b].flag&&p.tag_list.push(a.info.high_search_obj.classify_list[b].value);return a.info.high_search_obj.start_modify_date&&a.info.high_search_obj.end_modify_date&&a.info.high_search_obj.end_modify_date.getTime()<a.info.high_search_obj.start_modify_date.getTime()?(i.alert("开始日期应小于结束日期！",3),a.info.high_search_obj.start_modify_date="",a.info.high_search_obj.end_modify_date="",!1):(n.cn_name=a.info.high_search_obj.key_word,n.tag_list=p.tag_list,n.impl_types=p.impl_types,n.start_modify_date=a.info.high_search_obj.start_modify_date,n.end_modify_date=a.info.high_search_obj.end_modify_date,n.crt_user_id=a.info.high_search_obj.crt_user_id,n.publish_state=a.info.high_search_obj.publish_state,n.component_purpose=a.info.high_search_obj.component_purpose,a.search_key_word="",k(n),void(a.control.search_flag=!0))}}]}}),tbDirective.directive("cmptsList",function(){return{restrict:"AE",templateUrl:"templates/table/cmpts_list_tbl.html",replace:!0,controller:["$scope","$modal","$timeout","$compile","$state","Cmpt","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){function k(a){return a.data?(a.data.offset=0,void m(n)):(i.alert("暂无数据记录"),!1)}function l(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" title="删除" href="javascript:void(0)" >',"</div>",'<a class="tabConEd modify" title="修改" href=#/edit_cmpts/'+b.id+">","</a>",'<a class="tabConVi view" title="查看" href=#/detail_cmpts/'+b.id+">","</a>","</div>"].join("")}function m(a){a.key_word=o.key_word,n=a,a.data.sort="crt_bk_date,crt_bk_time",f.getCmptGroupList(a).then(function(b){c(function(){var c=b.comp_list?b.comp_list:[];0==c.length&&(p="暂无数据");for(var d=0;d<c.length;d++)c[d].comp_type="2";b.rows=c,a.success(b),a.complete()},200)},function(b){p=b.message,a.success({}),a.complete()})}var n={},o={},p="",q=2;a.test=function(a){$location.url("/cmpts_test/"+a.id+"/"+a.cn_name+"/"+q)},a.cmpts_publish=function(a){var b=a.id,c=a.comp_type;i.confirm("是否发布组件组 ?").then(function(a){a&&f.publishCmpt(b,c).then(function(a){a&&(i.alert("发布成功!",2),m(n))},function(a){i.alert(a.message,3)})})},a.subgroupsListControl={options:{ajax:m,pagination:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,sortName:"crt_bk_date,crt_bk_time",sortOrder:"desc",rowStyle:function(a,b){return 0==b&&$(".pagination-detail").hide(),{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='6' style='border:0px;text-align: center;'><div style='color: #6D7183;text-align: center'>暂无操作项</div></td>","</tr>"].join(""),g=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='6' style='border:0px;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='cmpts_publish(item)' style='margin-right:20px;'><i class='fa fa-check'></i>&nbsp;发布</button></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(2!=b.publish_state&&b.publish_state?c.after(d(f)(a)):c.after(d(g)(a)),c.addClass("table_col_Style"),c.next().slideDown())},formatNoMatches:function(){return p},classes:"table table-no-bordered table-hover",columns:[{field:"crt_bk_time",title:"创建时间",align:"left",valign:"middle",sortable:!0,width:"180px",formatter:h.combineTimeDate},{field:"cn_name",title:"组件组名",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"crt_user_name",title:"创建人",align:"left",valign:"middle",width:"150px"},{field:"modify_bk_time",title:"修改时间",align:"left",valign:"middle",width:"180px",formatter:h.combineModifyTimeDate},{field:"publish_state",title:"发布状态",align:"left",valign:"middle",width:"100px",formatter:h.envIsPublishFmt},{field:"operate",width:"100px",title:"",align:"center",valign:"middle",events:{"click .modify":function(a,b,c,d){e.go("cmpts_modify",{cmpts_id:c.id})},"click .view":function(a,b,c,d){e.go("cmpts_detail",{cmpts_id:c.id})},"click .trash":function(a,b,c,d){a.stopPropagation();var e=c.id,g=c.cn_name;i.confirm("确认删除["+g+"]组件组？").then(function(a){a&&f.deleteSingleCmptGroup(e).then(function(a){a&&(i.alert(g+" 删除成功！",2),m(n))},function(a){i.alert(a.message,3)})})},"click .publish":function(a,b,c,d){var e=c.id,g=c.comp_type;i.confirm("是否发布组件组 ?").then(function(a){a&&f.publishCmpt(e,g).then(function(a){a&&(i.alert("发布成功!",2),m(n))},function(a){i.alert(a.message,3)})})}},formatter:l}]}},a.searchSubgroupsByKeyword=function(){o.key_word=a.search_key_word,k(n)}}]}}),tbDirective.directive("pluginList",function(){return{restrict:"AE",templateUrl:"templates/table/plugin_tb.html",replace:"true",controller:["$scope","$timeout","$compile","TroubleConfig","config","Col_Fmt","Plugin","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" href="javascript:void(0)" title="删除">',"</div>",'<a class="tabConEd edit" href="javascript:void(0)" title="修改">',"</a>","</div>"].join("")}function k(a){l=a,g.getAllPluginList().then(function(b){b.total=b.all_recd,b.rows=b.plugin_list?b.plugin_list:[],a.success(b),a.complete()},function(a){h.alert(a.message,3)})}var l={};a.addPlugin=function(){h.addPlugin("",!1).then(function(){k(l)})},a.downLoadPlugin=function(a){console.log(a);var b=a.plugin_name?a.plugin_name:"",c=a.plugin_file_name?a.plugin_file_name:"";h.confirm("确认是否下载 ["+b+"] 插件 ?").then(function(a){a&&i.downloadFile(c)})},a.pluginController={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd",css:{padding:"6px 8px 5px",cursor:"default"}}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='5' style='border:0px;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='downLoadPlugin(item);' style='margin-right:20px;'><i class='glyphicon glyphicon-new-window'></i>&nbsp;下载</button></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"plugin_name",title:"插件名",align:"left",valign:"middle"},{field:"plugin_type",title:"插件类型",align:"left",valign:"middle",formatter:f.pluginTypeFormat},{field:"plugin_file_name",title:"插件文件",align:"left",valign:"middle",formatter:f.pluginFileFormat},{field:"plugin_bk_desc",title:"插件描述",align:"left",valign:"middle",formatter:f.hideDetailFmt},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"click .edit":function(a,b,c,d){a.stopPropagation(),h.addPlugin(c.plugin_name,!0).then(function(){k(l)})},"click .trash":function(a,b,c,d){a.stopPropagation(),h.confirm("确认删除[ "+c.plugin_name+" ]插件 ?").then(function(a){a&&g.deleteSinglePlugin(c.plugin_name).then(function(a){a&&(h.alert("["+c.plugin_name+"]插件删除成功！",2),k(l))},function(a){h.alert(a.message,3)})})}},formatter:j}]}}}]}}),tbDirective.directive("serverList",function(){return{restrict:"AE",templateUrl:"templates/table/server_list_tbl.html",replace:!0,controller:["$scope","$modal","$timeout","$compile","$state","Server","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" title="删除">',"</div>",'<a class="tabConEd modify" title="修改" href="javascript:void(0)">',"</a>",'<a class="tabConVi view" title="查看" href="javascript:void(0)">',"</a>","</div>"].join("")}function k(a){return a.data?(a.data.offset=0,void l(m)):(h.alert("暂无数据记录"),!1)}function l(a){a.ce_server_name=n.server_desc?n.server_desc:"",a.server_ip=n.server_ip?n.server_ip:"",m=a,f.pageServerList(a).then(function(b){c(function(){b.total=b.all_recd,b.rows=b.server_bean_list?b.server_bean_list:[],0==b.rows.length&&(o=""),a.success(b),a.complete()},0)},function(b){o=b.message,a.success({}),a.complete()})}var m={},n={},o="";a.srvListControl={options:{ajax:l,pageNumber:1,search:!1,pagination:!0,sidePagination:"server",showColumns:!1,showRefresh:!1,sortName:"create_date",sortOrder:"d",rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},onClickRow:function(b,c){if(!b)return!1;var e=!0,f=['<tr class="col_option" id="col_option" style="height:32px;display: none;">',"<td colspan='8' style='border:0px;text-align: center;'><div style='color: #999;text-align: center'>暂无操作项</div></td>","</tr>"].join("");"col_option"==c.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(c.after(d(f)(a)),c.addClass("table_col_Style"),c.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"create_date",title:"创建时间",halign:"left",align:"left",valign:"middle",sortable:!0,width:"175px",formatter:g.dataTimeFmt},{field:"server_desc",title:"服务器描述",halign:"left",align:"left",valign:"middle",sortable:!0,formatter:g.padding20Fmt},{field:"server_ip",title:"服务器地址",align:"left",halign:"left",valign:"middle",sortable:!0,width:"175px",formatter:g.padding20Fmt},{field:"agent_status",title:"AGENT",align:"center",halign:"center",valign:"middle",width:"70px",formatter:g.isConfigAgent},{field:"operate",width:"100px",title:"",align:"center",valign:"middle",events:{"click .trash":function(a,b,c,d){a.stopPropagation();var e=c.server_ip;h.confirm("确认删除服务器["+e+"]？").then(function(a){a&&f.deleteServer(e).then(function(a){a&&(h.success("服务器[ "+e+" ]删除成功！"),l(m))},function(a){h.error(a.message)})})},"click .modify":function(a,b,c,d){e.go("srv_modify",{server_ip:c.server_ip})},"click .view":function(a,b,c,d){e.go("srv_detail",{server_ip:c.server_ip})}},formatter:j}]}},a.doSearch=function(b){return"keypress"==b.type&&"13"!=b.keyCode?!1:(m.data.offset=0,i.valiForm(a.doSearchForm)?(n.srv_desc=a.srv.srv_desc,n.server_ip=a.srv.server_ip,void k(m)):(i.error("输入IP地址错误！"),!1))}}]}}),tbDirective.directive("sysList",function(){return{restrict:"AE",templateUrl:"templates/table/sys_tb.html",replace:"true",controller:["$scope","$state","$timeout","$filter","$compile","$location","Sys","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b,c){var d;return d=b.validate_user&&1!=b.validate_user?['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe btn-not-allowed" disabled title="当前用户非系统责任人,不可操作">',"</div>",'<a class="tabConEd btn-not-allowed" disabled title="当前用户非系统责任人,不可操作"  href="javascript:void(0)">',"</a>",'<a class="tabConVi sys-view" title="查看">',"</a>","</div>"].join(""):['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" href="javascript:void(0)" id='+b.business_sys_name+' title="删除">',"</div>",'<a class="tabConEd sys-modify" title="修改">',"</a>",'<a class="tabConVi sys-view" title="查看">',"</a>","</div>"].join("")}function m(a,b){if(b){var c=s.height(),d=~~(c-a),e=34*b;e>d&&s.css({"padding-bottom":e-d+10+"px"})}}function n(a){r=a,g.pageSysTbl(a).then(function(b){if(b.list_BsSystem)for(var c=0;c<b.list_BsSystem.length;c++){var d=b.list_BsSystem[c];d.user_cn_name&&(d.user_list=d.user_cn_name.split(","))}b.total=b.all_recd,b.rows=b.list_BsSystem?b.list_BsSystem:[],a.success(b),a.complete()},function(a){j.alert(a.message,3)})}var o,p,q,r={},s=$("#sys_list");a.config=function(a){b.go("sys_config.struct_config",{sys_id:a.business_sys_name})},a.bsTableCtrl={options:{ajax:n,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,sortName:"default",sortOrder:"desc",rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd"}},onClickRow:function(b,c){if(b){a.item=b;var d,f=!0;d=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='7' style='border:0px;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='config(item);' style='margin-right:20px;'><i class='fa fa-wrench'></i>&nbsp;配置</button></td>","</tr>"].join(""),"col_option"==c.next().attr("id")&&(f=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),f&&(c.after(e(d)(a)),c.addClass("table_col_Style"),c.next().slideDown(),b.validate_user&&1!=b.validate_user&&(c.next().find(".ordinary-btn").removeClass("ordinary-btn").addClass("ordinary-btn-disabled"),c.next().find(".ordinary-btn-disabled").attr({disabled:!0,title:"当前用户非系统责任人,不可操作"})))}},classes:"table table-no-bordered table-hover ",columns:[{field:"business_sys_name",title:"应用系统",align:"left",halign:"left",valign:"middle",width:"200px"},{field:"business_cn_name",title:"系统中文名",align:"left",halign:"left",valign:"middle",formatter:i.hideDetailFmt},{field:"user_list",title:"责任人",align:"left",halign:"left",valign:"middle",width:"100px",events:{"mouseenter .user_animate_active":function(a,b,d,e){var f=$(this),g=a.clientY,h=s.offset().top||110,i=~~(g-h),j=b?b.length:0;$(".user_animate_active").next();$(document).off("mousemove"),q&&c.cancel(q),o&&c.cancel(o),p&&c.cancel(p),$(".publish_program_animate_active").next().css({display:"none"}),$(".animate_active").next().css({display:"none"}),f.next()[0]?"none"==f.next()[0].style.display&&c(function(){$(".user_animate_active").next().css({display:"none"})},0):c(function(){$(".user_animate_active").next().css({display:"none"})},0),q=c(function(){f.next().fadeIn(200,function(){m(i,j)})},200)},"mouseleave .user_animate_active":function(){var a=$(this);if(a.next().length>0){var b=a.next()[0],d=$(b).offset().left,e=d+122+20,f=$(b).offset().top,g=$(b).offset().top+$(b).height();$(document).mousemove(function(a){(a.pageX<d||a.pageX>e||a.pageY<f||a.pageY>g)&&(p&&c.cancel(p),o&&c.cancel(o),q&&c.cancel(q),q=c(function(){$(".user_animate_active").next().fadeOut(200,function(){s.css("padding-bottom","0")})},0))})}}},formatter:i.sysListUser},{field:"prog_list",title:"系统方案",align:"left",halign:"left",valign:"middle",width:"100px",events:{"mouseenter .publish_program_animate_active":function(a,b,d,e){var f=$(this),g=a.clientY,h=s.offset().top||110,i=~~(g-h),j=b?b.length:0;$(".publish_program_animate_active").next();$(document).off("mousemove"),p&&c.cancel(p),o&&c.cancel(o),q&&c.cancel(q),$(".animate_active").next().css({display:"none"}),$(".user_animate_active").next().css({display:"none"}),f.next()[0]?"none"==f.next()[0].style.display&&c(function(){$(".publish_program_animate_active").next().css({display:"none"})},0):c(function(){$(".publish_program_animate_active").next().css({display:"none"})},0),p=c(function(){f.next().fadeIn(200,function(){m(i,j)})},200)},"mouseleave .publish_program_animate_active":function(){var a=$(this);if(a.next()[0]){var b=a.next()[0],d=$(b).offset().left,e=d+122+20,f=$(b).offset().top,g=$(b).offset().top+$(b).height();$(document).mousemove(function(a){(a.pageX<d||a.pageX>e||a.pageY<f||a.pageY>g)&&(o&&c.cancel(o),p&&c.cancel(p),q&&c.cancel(q),o=c(function(){$(".publish_program_animate_active").next().fadeOut(200,function(){s.css("padding-bottom","0")})},0))})}}},formatter:i.sysListPublishState},{field:"logInfoList",title:"日志",align:"left",halign:"left",valign:"middle",width:"100px",events:{"mouseenter .animate_active":function(a,b,d,e){var f=$(this),g=a.clientY,h=s.offset().top||110,i=~~(g-h),j=b?b.length:0;$(".animate_active").next();$(document).off("mousemove"),o&&c.cancel(o),p&&c.cancel(p),q&&c.cancel(q),$(".publish_program_animate_active").next().css({display:"none"}),$(".user_animate_active").next().css({display:"none"}),f.next()[0]?"none"==f.next()[0].style.display&&c(function(){$(".animate_active").next().css({display:"none"})},0):c(function(){$(".animate_active").next().css({display:"none"})},0),o=c(function(){f.next().fadeIn(200,function(){m(i,j)})},200)},"mouseleave .animate_active":function(){var a=$(this);if(a.next().length>0){var b=a.next()[0],d=$(b).offset().left,e=d+122+20,f=$(b).offset().top,g=$(b).offset().top+$(b).height();$(document).mousemove(function(a){(a.pageX<d||a.pageX>e||a.pageY<f||a.pageY>g)&&(p&&c.cancel(p),o&&c.cancel(o),q&&c.cancel(q),o=c(function(){$(".animate_active").next().fadeOut(200,function(){s.css("padding-bottom","0")})},0))})}}},formatter:i.sysListLogCount},{field:"agent_flag",title:"Agent部署",align:"center",halign:"center",valign:"middle",width:"100px",formatter:i.agentUseFmt},{field:"operate",width:"100px",title:"",align:"right",valign:"middle",events:{"click .trash":function(b){b.stopPropagation();var c=$(this).attr("id");j.confirm("确认删除["+c+"]系统？").then(function(b){b&&g.deleteSys(c).then(function(a){a&&(j.alert(c+" 应用系统删除成功！",2),n(r))},function(b){"localauth"==b.status?j.localauth(b.data,{business_sys_name:c}).then(function(a){n(r)}):j.alert(b.message,3),a.submited=!1})})},"click .sys-view":function(a,c,d){b.go("sys_detail",{sys_id:d.business_sys_name})},"click .sys-modify":function(a,c,d){b.go("sys_modify",{sys_id:d.business_sys_name})}},formatter:l}]}}}]}}),tbDirective.directive("programCmptList",function(){return{restrict:"AE",templateUrl:"templates/table/program_cmpt_list_tbl.html",replace:!0,controller:["$scope","$modal","$timeout","$compile","$location","Cmpt","config","Col_Fmt","Modal","CV",function(a,b,c,d,e,f,g,h,i,j){function k(a){return a.data?(a.data.offset=0,void l(n)):(i.alert("暂无数据记录"),!1)}function l(b){(n.cn_name||n.tag_list||n.impl_types)&&(b.cn_name=n.cn_name,b.tag_list=n.tag_list,b.impl_types=n.impl_types),n=b,b.publish_state=1,b.component_purpose=1,f.getCmptPageList(b).then(function(d){c(function(){d&&(a.control.cmpt_list_loading=!1,d.rows=d.comp_list?d.comp_list:[],a.info.cmpt_list=d.rows,d.total=d.all_recd,b.success(d),b.complete())},0)},function(c){a.cmpt_info.cmpt_list_loading=!1,a.cmpt_info.error_message=c.message,b.success({}),b.complete()})}function m(a,b,c){var d='<div class="icheckbox_minimal-blue"><div>';return d}var n={},o={};a.programCmptListControl={options:{ajax:l,pagination:!0,pageSize:10,pageNumber:1,sidePagination:"server",sortName:"crt_bk_date,crt_bk_time",sortOrder:"desc",showColumns:!1,showRefresh:!1,onClickRow:function(a,b){a.checked=!a.checked,a.checked?(b.find("td").not(":first").addClass("checked_style"),b.find(".icheckbox_minimal-blue").addClass("checked")):(b.find("td").removeClass("checked_style"),b.find(".icheckbox_minimal-blue").removeClass("checked"))},classes:"table table-no-bordered",columns:[{field:"checked",title:"选择",align:"center",valign:"middle",width:"50px",formatter:m},{field:"cn_name",title:"组件名",align:"left",valign:"middle",formatter:h.hideDetailFmt},{field:"impl_type",title:"执行类别",align:"left",valign:"middle",width:"100px",formatter:h.subgroupListExecuteTypeFmt},{field:"tag_list",title:"分类",align:"center",valign:"middle",width:"120px",formatter:h.classifyTag},{field:"crt_user_name",title:"创建人",align:"left",valign:"middle",width:"120px"},{field:"modify_bk_time",title:"修改时间",align:"left",valign:"middle",width:"150px",formatter:h.combineModifyTimeDate}]}},a.clear=function(){a.search_key_word=""},a.searchSubgroupByKeyword=function(){n.cn_name=a.search_key_word,n.tag_list=[],n.impl_types=[],k(n)},a.seniorSearch=function(){o.tag_list=[],o.impl_types=[];for(var b=0;b<a.info.high_search_obj.exec_type_list.length;b++)a.info.high_search_obj.exec_type_list[b].flag&&o.impl_types.push(a.info.high_search_obj.exec_type_list[b].key);for(var b=0;b<a.info.high_search_obj.classify_list.length;b++)a.info.high_search_obj.classify_list[b].flag&&o.tag_list.push(a.info.high_search_obj.classify_list[b].value);n.cn_name=a.info.high_search_obj.key_word,n.tag_list=o.tag_list,n.impl_types=o.impl_types,a.search_key_word="",k(n),a.control.search_flag=!0}}]}}),tbDirective.directive("resourcesList",function(){return{restrict:"AE",templateUrl:"templates/table/resources_tb.html",replace:"true",controller:["$scope","$timeout","$compile","TroubleConfig","config","Col_Fmt","CommonResources","Modal","CV",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return['<div style="position: absolute;margin-top: -12px;margin-left: 8px;">','<div class="tabConDe trash" href="javascript:void(0)" title="删除">',"</div>",'<a class="tabConEd edit" href="javascript:void(0)" title="修改">',"</a>","</div>"].join("")}function k(a){l=a,g.getAllResourcesList().then(function(b){b.total=b.all_recd,b.rows=b.resources_list?b.resources_list:[],a.success(b),a.complete()},function(a){h.alert(a.message,3)})}var l={};a.addResources=function(){h.addResource("",!1).then(function(){k(l)})},a.downLoadPlugin=function(a){var b=a.resource_name?a.resource_name:"",c=a.resource_file_path?a.resource_file_path:"";h.confirm("确认是否下载 ["+b+"]  ?").then(function(a){a&&i.downloadFile(c)})},a.resourcesController={options:{ajax:k,pagination:!0,pageSize:10,pageNumber:1,search:!1,sidePagination:"server",showColumns:!1,showRefresh:!1,rowStyle:function(a,b){return 0==b?$(".pagination-detail").hide():"",{classes:"tbl-odd",css:{padding:"6px 8px 5px",cursor:"default"}}},onClickRow:function(b,d){if(!b)return!1;a.item=b;var e=!0,f=['<tr class="col_option" id="col_option" style="height:40px;display: none;">',"<td colspan='4' style='border:0px;text-align: right;padding-right:90px;'><button class='ordinary-btn' ng-click='downLoadPlugin(item);' style='margin-right:20px;'><i class='fa fa-download'></i>&nbsp;下载</button></td>","</tr>"].join("");"col_option"==d.next().attr("id")&&(e=!1),$("#col_option")&&($("#col_option").prev().removeClass("table_col_Style"),$("#col_option").remove()),e&&(d.after(c(f)(a)),d.addClass("table_col_Style"),d.next().slideDown())},classes:"table table-no-bordered table-hover",columns:[{field:"resource_name",title:"资源名称",align:"left",valign:"middle"},{field:"resource_desc",title:"资源描述",align:"left",valign:"middle"},{field:"resource_file_path",title:"资源文件",align:"left",valign:"middle",formatter:f.pluginFileFormat},{field:"operate",width:"80px",title:"",align:"center",valign:"middle",events:{"click .edit":function(a,b,c,d){h.addResource(c.resource_name,!0).then(function(){k(l)})},"click .trash":function(a,b,c,d){h.confirm("确认删除[ "+c.resource_name+" ]?").then(function(a){a&&g.deleteResources(c.resource_name).then(function(a){a&&(h.alert("["+c.resource_name+"]删除成功！",2),k(l))},function(a){h.alert(a.message,3)})})}},formatter:j}]}}}]}});var router=angular.module("clroute",[]);router.config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("","/index"),a.state("index",{url:"/index",templateUrl:"templates/states/home_page.html",controller:"indexCtrl",ncyBreadcrumb:{label:"首页",floor:1},menu_name:""}).state("proj_register",{url:"/proj_register",templateUrl:"views/publish/proj/project_register.html",controller:"projectRegisterCtrl",ncyBreadcrumb:{label:"项目登记",floor:1},menu_name:"发布"}).state("proj_register_modify",{url:"/proj_register_modify?project_id",templateUrl:"views/publish/proj/project_register.html",controller:"projectRegisterModifyCtrl",ncyBreadcrumb:{label:"修改项目",floor:2},menu_name:"发布"}).state("proj_modify.pub_pgm",{url:"/proj_modify?prog_id",templateUrl:"views/publish/proj/pub_pgm.html",controller:"pgmCtrl",menu_name:"发布"}).state("proj_list",{url:"/proj_list",templateUrl:"views/publish/proj/proj_list.html",controller:"projListCtrl",ncyBreadcrumb:{label:"项目列表",floor:1},menu_name:"发布",frame:"proj_list"}).state("proj_history",{url:"/proj_history",templateUrl:"views/publish/proj/proj_list.html",controller:"projListCtrl",ncyBreadcrumb:{label:"历史项目",floor:1},menu_name:"发布",frame:"proj_history"}).state("proj_detail",{url:"/proj_detail?project_id&project_name&project_status&tab_flag",templateUrl:"views/publish/proj/proj_detail.html",controller:"projDetailCtrl",ncyBreadcrumb:{label:"项目查看",floor:2},menu_name:"发布",frame:"proj_detail"}).state("proj_detail.proj_application",{url:"/proj_application",templateUrl:"views/publish/pub/pub_application_list.html",controller:"pubApplicationListCtrl",ncyBreadcrumb:{label:"项目查看",floor:2},menu_name:"发布",frame:"proj_detail"}).state("proj_detail_pre",{url:"/proj_detail_pre?publish_id&sys_id",templateUrl:"views/publish/proj/proj_detail_pre.html",controller:"projPreDetailCtrl",ncyBreadcrumb:{label:"系统发布查看",floor:2},menu_name:"发布"}).state("proj_detail_exec",{url:"/proj_detail_exec?proj_id&sys_id",templateUrl:"views/publish/proj/proj_detail_exec.html",controller:"projExecDetailCtrl",ncyBreadcrumb:{label:"项目查看",floor:2},menu_name:"发布"}).state("release_calendar",{url:"/release_calendar",templateUrl:"views/publish/plan/release_calendar.html",controller:"releaseCalendarCtrl",ncyBreadcrumb:{label:"发布日历",floor:1},menu_name:"发布"}).state("pub_window_set",{url:"/pub_window_set",templateUrl:"views/publish/plan/pub_window_set.html",controller:"pubWindowSetCtrl",ncyBreadcrumb:{label:"发布窗口设置",floor:1},menu_name:"发布"}).state("pub_application",{url:"/pub_application",templateUrl:"views/publish/pub/pub_application.html",controller:"pubApplicationCtrl",ncyBreadcrumb:{label:"发布申请",floor:1},menu_name:"发布"}).state("pub_application_list",{url:"/pub_application_list",templateUrl:"views/publish/pub/pub_application_list.html",controller:"pubApplicationListCtrl",ncyBreadcrumb:{label:"申请列表",floor:1},menu_name:"发布"}).state("history_application",{url:"/history_application",params:{his_list_flag:!0},templateUrl:"views/publish/pub/pub_application_list.html",controller:"pubApplicationListCtrl",ncyBreadcrumb:{label:"历史申请",floor:1},menu_name:"发布"}).state("pub_application_update",{url:"/pub_application_update?pjpublish_id",templateUrl:"views/publish/pub/pub_application.html",controller:"updatePubApplicationCtrl",ncyBreadcrumb:{label:"修改发布申请",floor:2},menu_name:"发布"}).state("application_list",{url:"/application_list",templateUrl:"views/publish/pub/pub_application.html",controller:"pubApplicationCtrl",ncyBreadcrumb:{label:"申请列表",floor:1},menu_name:"发布"}).state("application_history",{url:"/application_history",templateUrl:"views/publish/pub/pub_application.html",controller:"pubApplicationCtrl",ncyBreadcrumb:{label:"历史申请",floor:1},menu_name:"发布"}).state("proj_his_plan_list",{url:"/proj_his_plan_list",templateUrl:"views/publish/plan/proj_his_plan_list.html",controller:"projPlanHistoryCtrl",ncyBreadcrumb:{label:"历史计划",floor:1},menu_name:"发布",frame:"proj_his_plan_list"}).state("routine_release",{url:"/routine_release",templateUrl:"views/publish/pub/routine_release.html",controller:"routineReleaseCtrl",ncyBreadcrumb:{label:"例行发布",floor:1},menu_name:"发布"}).state("view_application",{url:"/view_application?application_id",templateUrl:"views/publish/pub/view_publish_application.html",controller:"viewPubApplicationCtrl",ncyBreadcrumb:{label:"查看发布申请",floor:2},menu_name:"发布"}).state("plan_sys_set",{url:"/plan_sys_set?publish_id",templateUrl:"views/publish/plan/plan_sys_set.html",controller:"planSysSetCtrl",ncyBreadcrumb:{label:"流程编排",floor:2},menu_name:"发布"}).state("pub_pre",{url:"/pub_pre?sys_publish_id&sys_id",templateUrl:"views/publish/pub/pub_pre.html",controller:"pubPreCtrl",ncyBreadcrumb:{label:"发布准备",replace_flag:!0,floor:2},menu_name:"发布"}).state("pub_pre.pub_pgm",{url:"/pub_pre?prog_id&pre_flag",templateUrl:"views/publish/proj/pub_pgm.html",controller:"pgmCtrl",menu_name:"发布"}).state("pub_exec",{url:"/pub_exec?sys_publish_id&sys_id&exec_type&quick_pub_flag&auto_yn_flag&path_flag",templateUrl:"views/publish/pub/prod_exec.html",controller:"prodExecDoCtrl",ncyBreadcrumb:{label:"发布执行",floor:2},menu_name:"发布"}).state("pub_exec.console",{url:"/console?execute_id&stop_flag",templateUrl:"views/publish/pub/console.html",controller:"execConsoleCtrl",menu_name:"发布"}).state("monitor_list",{url:"/monitor_list",templateUrl:"views/publish/pub/monitor_list.html",controller:"execMonirorListCtrl",ncyBreadcrumb:{label:"监控列表",floor:1},menu_name:"发布"}).state("monitor_detail",{url:"/monitor_detail?sys_publish_id&sys_id&sys_status&quick_pub_flag",templateUrl:"views/publish/pub/monitor_detail.html",controller:"monitorDetailCtrl",ncyBreadcrumb:{label:"单项监控",floor:2},menu_name:"发布"}).state("monitor_detail.console",{url:"/console?execute_id&stop_flag",templateUrl:"views/publish/pub/console.html",controller:"execConsoleCtrl",menu_name:"发布",frame:"monitor_list"}).state("group_monitor_detail",{url:"/group_monitor_detail?publish_id&application_name",templateUrl:"views/publish/pub/monitor_group.html",controller:"monitorGroupCtrl",ncyBreadcrumb:{label:"项目监控",floor:2},menu_name:"发布"}).state("agile_pub_list",{url:"/agile_pub_list",templateUrl:"views/publish/pub/agile_release_list.html",controller:"agileReleaseListCtrl",ncyBreadcrumb:{label:"敏捷发布",floor:1},menu_name:"发布"}).state("agile_pub_pre",{url:"/agile_pub_pre?modify_flag&proj_name&sys_name",templateUrl:"views/publish/pub/agile_pub_pre.html",controller:"agilePubPreCtrl",ncyBreadcrumb:{label:"敏捷发布准备",floor:2},menu_name:"发布"}).state("agile_pub_exe",{url:"/agile_pub_exe?sys_publish_id&sys_id&exec_type&quick_pub_flag&auto_yn_flag&path_flag",templateUrl:"views/publish/pub/prod_exec.html",controller:"prodExecDoCtrl",ncyBreadcrumb:{label:"敏捷发布执行",floor:2},menu_name:"发布"}).state("agile_pub_exe.console",{url:"/console?execute_id&stop_flag",templateUrl:"views/publish/pub/console.html",controller:"execConsoleCtrl",menu_name:"发布"}).state("regular_analysis",{url:"/regular_analysis",templateUrl:"views/publish/analysis/prod_regular_analysis.html",controller:"regularanalysisCtrl",ncyBreadcrumb:{label:"统计分析",floor:1},menu_name:"发布"}).state("pub_analysis",{url:"/pub_analysis",
templateUrl:"views/publish/analysis/prod_pub_analysis.html",controller:"pubAnalysisCtrl",ncyBreadcrumb:{label:"统计分析",floor:1},menu_name:"发布"}).state("urgent_analysis",{url:"/urgent_analysis",templateUrl:"views/publish/analysis/prod_urgent_analysis.html",controller:"urgentAnalysisCtrl",ncyBreadcrumb:{label:"统计分析",floor:1},menu_name:"发布"}).state("version_pub_stream_list",{url:"/version_pub_stream_list",templateUrl:"views/publish/version/publish_stream_list.html",controller:"pubStreamListCtrl",ncyBreadcrumb:{label:"发布流列表",floor:1},menu_name:"发布"}).state("version_pub_stream_detail",{url:"/version_pub_stream_detail?sys_name&version_id",templateUrl:"views/publish/version/publish_stream_detail.html",controller:"pubStreamDetailCtrl",ncyBreadcrumb:{label:"发布流查看",floor:2},menu_name:"发布"}).state("version_full_stream_list",{url:"/version_full_stream_list",templateUrl:"views/publish/version/full_stream_list.html",controller:"fullStreamListCtrl",ncyBreadcrumb:{label:"全量流列表",floor:1},menu_name:"发布"}).state("version_full_stream_detail",{url:"/version_full_stream_detail?sys_name&version_id",templateUrl:"views/publish/version/full_stream_detail.html",controller:"fullStreamDetailCtrl",ncyBreadcrumb:{label:"全量流查看",floor:2},menu_name:"发布"}).state("version_new",{url:"/version_new?sys_name&sys_cn_name",templateUrl:"views/publish/version/version_new.html",controller:"versionNewCtrl",ncyBreadcrumb:{label:"新增版本",floor:1},menu_name:"发布"}).state("user_modify",{url:"/user_modify",templateUrl:"views/header/user/user_modify.html",controller:"userModifyCtrl",ncyBreadcrumb:{label:"个人信息",floor:1},menu_name:"页头"}).state("pwd_modify",{url:"/pwd_modify",templateUrl:"views/header/user/pwd_modify.html",controller:"pwdModifyCtrl",ncyBreadcrumb:{label:"修改密码",floor:1},menu_name:"页头"}).state("msg_list",{url:"/msg_list",templateUrl:"views/header/msg/msg_list.html",ncyBreadcrumb:{label:"消息列表",floor:1},menu_name:"页头"}).state("msg_detail",{url:"/msg_detail?msg_id",templateUrl:"views/header/msg/msg_detail.html",controller:"msgDetailCtrl",ncyBreadcrumb:{label:"消息查看",floor:2},menu_name:"页头"}).state("tasks_list",{url:"/tasks_list?tab_name",templateUrl:"views/header/task/tasks_list.html",controller:"tasksListCtrl",ncyBreadcrumb:{label:"任务列表",floor:1},menu_name:"页头"}).state("task_detail",{url:"/task_detail?tab_name&task_id",templateUrl:"views/header/task/task_detail.html",controller:"taskDetailCtrl",ncyBreadcrumb:{label:"任务查看",floor:2},menu_name:"页头"}).state("task_handle",{url:"/task_handle?tab_name&task_id",templateUrl:"views/header/task/task_handle.html",controller:"taskHandleCtrl",ncyBreadcrumb:{label:"任务处理",floor:2},menu_name:"页头"}).state("trouble_task_handle",{url:"/trouble_task_handle?tab_name&task_id&detail_flag",templateUrl:"views/header/task/trouble_task_handle.html",controller:"troubleTaskHandleCtrl",ncyBreadcrumb:{label:"故障单任务",floor:2},menu_name:"页头"}).state("tasks_history_list",{url:"/tasks_history_list?tab_name",templateUrl:"views/header/task/tasks_history_list.html",controller:"tasksHistoryListCtrl",ncyBreadcrumb:{label:"历史任务列表",floor:1},menu_name:"页头"}).state("log_list",{url:"/log_list",templateUrl:"views/header/log/log_list.html",controller:"logListCtrl",ncyBreadcrumb:{label:"日志列表",floor:1},menu_name:"页头"}).state("contacts_list",{url:"/contacts_list",templateUrl:"views/header/contacts/contacts_list.html",controller:"contactsListCtrl",ncyBreadcrumb:{label:"通讯录",floor:1},menu_name:"页头"}).state("inspection_log_pick",{url:"/log_pick",templateUrl:"views/inspection/log/log_pick.html",controller:"logPickCtrl",ncyBreadcrumb:{label:"日志提取",floor:1},menu_name:"巡检"}).state("inspection_log_analysis",{url:"/log_analysis",templateUrl:"views/inspection/log/log_analysis.html",controller:"logAnalysisCtrl",ncyBreadcrumb:{label:"日志分析",floor:1},menu_name:"巡检"}).state("inspection_log_analysis.keyword_chart",{url:"/keyword_chart",params:{keyword_info:null},templateUrl:"views/inspection/log/log_analysis_keyword_chart.html",controller:"logAnalysisKeywordChartCtrl",ncyBreadcrumb:{label:"关键字分析报告",floor:1},menu_name:"巡检"}).state("inspection_log_report_new",{url:"/log_report_new",templateUrl:"views/inspection/log/log_report_new.html",controller:"logReportNewCtrl",ncyBreadcrumb:{label:"新增报告",floor:1},menu_name:"巡检"}).state("inspection_log_report_new.log_preview",{url:"/log_preview",params:{submit_info:null},templateUrl:"views/inspection/log/log_report_preview.html",controller:"logReportReviewCtrl",ncyBreadcrumb:{label:"报告预览",floor:1},menu_name:"巡检"}).state("inspection_log_report_list",{url:"/log_report_list",templateUrl:"views/inspection/log/log_report_list.html",ncyBreadcrumb:{label:"报告列表",floor:1},menu_name:"巡检"}).state("wo_new",{url:"/wo_new",templateUrl:"views/fault/workorder/wo_new.html",controller:"woNewCtrl",ncyBreadcrumb:{label:"录入工单",floor:1},menu_name:"故障"}).state("wo_modify",{url:"/wo_modify?wo_seq",templateUrl:"views/fault/workorder/wo_new.html",controller:"woModifyCtrl",ncyBreadcrumb:{label:"修改工单",floor:1},menu_name:"故障"}).state("wo_import",{url:"/wo_import?file_name",templateUrl:"views/fault/workorder/wo_import.html",controller:"woImportCtrl",ncyBreadcrumb:{label:"导入工单",floor:1},menu_name:"故障"}).state("wo_detail",{url:"/wo_detail?wo_seq&back_state",templateUrl:"views/fault/workorder/wo_detail.html",controller:"woDetailCtrl",ncyBreadcrumb:{label:"工单查看",floor:2},menu_name:"故障"}).state("wo_mine",{url:"/wo_mine",params:{tab_name:null,order_seq:null},templateUrl:"views/fault/workorder/wo_mine.html",controller:"woMineCtrl",menu_name:"故障"}).state("wo_mine.create_list",{url:"/create_list",template:"<create-workorder></create-workorder>",ncyBreadcrumb:{label:"我的工单",floor:1},menu_name:"故障"}).state("wo_mine.pending_list",{url:"/pending_list",template:"<pending-workorder></pending-workorder>",ncyBreadcrumb:{label:"待处理的工单",floor:1},menu_name:"故障"}).state("wo_mine.processed_list",{url:"/processed_list",template:"<processed-workorder></processed-workorder>",ncyBreadcrumb:{label:"已处理的工单",floor:1},menu_name:"故障"}).state("wo_mine.wo_handle",{url:"/wo_handle",templateUrl:"views/fault/workorder/wo_handle.html",controller:"woHandleCtrl",ncyBreadcrumb:{label:"处理工单",floor:1},menu_name:"故障"}).state("wo_all_list",{url:"/wo_all_list",templateUrl:"views/fault/workorder/wo_all_list.html",controller:"woAllListCtrl",ncyBreadcrumb:{label:"所有工单",floor:1},menu_name:"故障"}).state("fault_program_new",{url:"/fault_program_new",params:{flag:null,order_seq:null,deal_bk_seq:null},templateUrl:"views/fault/program/fault_program_new.html",controller:"faultProgramNewCtrl",ncyBreadcrumb:{label:"新增方案",floor:1},menu_name:"故障"}).state("fault_program_modify",{url:"/fault_program_modify/:program_id",templateUrl:"views/fault/program/fault_program_modify.html",controller:"faultProgramModifyCtrl",ncyBreadcrumb:{label:"修改方案",floor:2},menu_name:"故障"}).state("fault_program_detail",{url:"/fault_program_detail?program_id&program_source",templateUrl:"views/fault/program/fault_program_detail.html",controller:"faultProgramDetailCtrl",ncyBreadcrumb:{label:"查看方案",floor:2},menu_name:"故障"}).state("fault_program_list",{url:"/fault_program_list",templateUrl:"views/fault/program/fault_program_list.html",ncyBreadcrumb:{label:"方案列表",floor:1},menu_name:"故障"}).state("fault_trouble_type",{url:"/fault_trouble_type",templateUrl:"views/fault/configParams/fault_trouble_type.html",ncyBreadcrumb:{label:"故障类型",floor:1},menu_name:"故障"}).state("fault_peak_date",{url:"/fault_peak_date",templateUrl:"views/fault/configParams/fault_peak_date.html",ncyBreadcrumb:{label:"高峰时段",floor:1},menu_name:"故障"}).state("sys_new",{url:"/sys_new",templateUrl:"views/public/sys/sys_new.html",controller:"sysNewCtrl",ncyBreadcrumb:{label:"新增系统",floor:1},menu_name:"公共"}).state("sys_modify",{url:"/sys_modify?sys_id",templateUrl:"views/public/sys/sys_new.html",controller:"sysModifyCtrl",ncyBreadcrumb:{label:"系统修改",floor:2},menu_name:"公共"}).state("sys_detail",{url:"/sys_detail?sys_id",templateUrl:"views/public/sys/sys_detail.html",controller:"sysDetailCtrl",ncyBreadcrumb:{label:"系统查看",floor:2},menu_name:"公共"}).state("sys_list",{url:"/sys_list",templateUrl:"views/public/sys/sys_list.html",ncyBreadcrumb:{label:"系统列表",floor:1},menu_name:"公共"}).state("sys_config",{url:"/sys_config?sys_id&sys_cn_name",templateUrl:"views/public/sys/sys_config.html",controller:"sysConfigCtrl",menu_name:"公共"}).state("sys_config.struct_config",{url:"/struct_config",templateUrl:"views/public/sys/struct_config.html",controller:"structConfigCtrl",ncyBreadcrumb:{label:"系统配置",floor:2},menu_name:"公共"}).state("sys_config.env_config_list",{url:"/env_config_list",templateUrl:"views/public/sys/env_config_list.html",controller:"envConfigListCtrl",ncyBreadcrumb:{label:"系统配置",floor:2},menu_name:"公共"}).state("sys_config.env_config_list.env_config_new",{url:"/env_config_new?env_modify_flag&env_id",templateUrl:"views/public/sys/env_config_new.html",controller:"envConfigNewCtrl",menu_name:"公共"}).state("sys_config.program_list",{url:"/program_list",templateUrl:"views/public/sys/program_list.html",controller:"programListCtrl",ncyBreadcrumb:{label:"系统配置",floor:2},menu_name:"公共"}).state("sys_config.program_tab",{url:"/program_tab",params:{program_id:null,modify_type:null,repeat_flag:null},templateUrl:"views/public/sys/program_tab.html",controller:"programTabCtrl",menu_name:"公共"}).state("sys_config.program_tab.program_add_or_modify",{url:"/program_tab_add_modify",params:{judge_id:null,judge_modify:null,judge_repeat:null},templateUrl:"views/public/sys/program_tab_add_modify.html",controller:"programTabAddOrModifyCtrl",menu_name:"公共"}).state("sys_config.program_tab.program_detail",{url:"/program_tab_detail",params:{judge_id:null,judge_modify:null},templateUrl:"views/public/sys/program_tab_detail.html",controller:"programTabDetailCtrl",menu_name:"公共"}).state("sys_config.log_list",{url:"/log_list",templateUrl:"views/public/sys/log_list.html",controller:"sysLogListCtrl",ncyBreadcrumb:{label:"系统配置",floor:2},menu_name:"公共"}).state("sys_config.log_tab",{url:"/log_tab",params:{log_id:null,modify_type:null,log_name:null},templateUrl:"views/public/sys/log_tab.html",controller:"logTabCtrl",menu_name:"公共"}).state("sys_config.log_tab.log_add_modify",{url:"/log_tab_add_and_modify",params:{judge_id:null,judge_modify:null,judge_name:null},templateUrl:"views/public/sys/log_tab_add_modify.html",controller:"logTabAddOrModifyCtrl",menu_name:"公共"}).state("sys_config.log_tab.log_detail",{url:"/log_tab_detail",params:{judge_id:null,judge_modify:null,judge_name:null},templateUrl:"views/public/sys/log_tab_detail.html",controller:"logTabDetailCtrl",menu_name:"公共"}).state("srv_new",{url:"/srv_new",templateUrl:"views/public/server/server_new.html",controller:"serverNewCtrl",ncyBreadcrumb:{label:"新增服务器",floor:1},menu_name:"srv"}).state("srv_new.srv_new_basic",{url:"/srv_new_basic?server_ip&&agent_status&&server_id",templateUrl:"views/public/server/server_form.html",controller:"serverNewBasicInfoCtrl",menu_name:"srv"}).state("srv_modify",{url:"/srv_modify?server_ip",views:{"":{templateUrl:"views/public/server/server_modify.html"},"@srv_modify":{templateUrl:"views/public/server/server_form.html",controller:"serverModifyCtrl"}},ncyBreadcrumb:{label:"修改服务器",floor:2},menu_name:"srv"}).state("srv_detail",{url:"/srv_detail?server_ip",templateUrl:"views/public/server/server_detail.html",controller:"serverDetailCtrl",ncyBreadcrumb:{label:"查看服务器",floor:2},menu_name:"srv"}).state("srv_list",{url:"/srv_list",templateUrl:"views/public/server/server_list.html",controller:"serverListCtrl",ncyBreadcrumb:{label:"服务器列表",floor:1},menu_name:"srv"}).state("agent_monitor",{url:"/agent_monitor",templateUrl:"views/public/server/agent_monitor.html",controller:"agentMonitorCtrl",ncyBreadcrumb:{label:"监控列表",floor:1},menu_name:"srv"}).state("cmpt",{url:"/cmpt",templateUrl:"views/public/cmpt/cmpt.html",controller:"cmptCtrl",ncyBreadcrumb:{label:"新增组件",floor:1},menu_name:"公共"}).state("cmpt.cmpt_new",{url:"/cmpt_new",templateUrl:"views/public/cmpt/cmpt_new.html",controller:"cmptNewCtrl",ncyBreadcrumb:{label:"新增组件",floor:1},menu_name:"公共"}).state("cmpt_modify",{url:"/cmpt_modify?cmpt_id",views:{"":{templateUrl:"views/public/cmpt/cmpt_modify.html"},"@cmpt_modify":{templateUrl:"views/public/cmpt/cmpt_new.html",controller:"cmptModifyCtrl"}},ncyBreadcrumb:{label:"修改组件",floor:2},menu_name:"公共"}).state("cmpt.cmpts_new",{url:"/cmpts_new",templateUrl:"views/public/cmpt/cmpts_new.html",controller:"cmptsNewCtrl",ncyBreadcrumb:{label:"新增组件组",floor:1},menu_name:"公共"}).state("cmpt_detail",{url:"/cmpt_detail?cmpt_id",templateUrl:"views/public/cmpt/cmpt_detail.html",controller:"cmptDetailCtrl",ncyBreadcrumb:{label:"查看组件",floor:2},menu_name:"公共"}).state("cmpts_modify",{url:"/cmpts_modify?cmpts_id",views:{"":{templateUrl:"views/public/cmpt/cmpts_modify.html"},"@cmpts_modify":{templateUrl:"views/public/cmpt/cmpts_new.html",controller:"cmptsModifyCtrl"}},ncyBreadcrumb:{label:"修改组件组",floor:2},menu_name:"公共"}).state("cmpts_detail",{url:"/cmpts_detail?cmpts_id",templateUrl:"views/public/cmpt/cmpts_detail.html",controller:"cmptsDetailCtrl",ncyBreadcrumb:{label:"查看组件组",floor:2}}).state("cmpt_list",{url:"/cmpt_list",templateUrl:"views/public/cmpt/cmpt_list.html",controller:"cmptListCtrl",ncyBreadcrumb:{label:"组件列表",floor:1},menu_name:"公共"}).state("cmpts_list",{url:"/cmpts_list",templateUrl:"views/public/cmpt/cmpts_list.html",controller:"cmptsListCtrl",ncyBreadcrumb:{label:"组件组列表",floor:1},menu_name:"公共"}).state("cmpt_test",{url:"/cmpt_test?cmpt_id&cmpt_name",templateUrl:"views/public/cmpt/cmpt_test.html",controller:"cmptTestCtrl",ncyBreadcrumb:{label:"组件测试",floor:2},menu_name:"公共"}).state("plugin_list",{url:"/plugin_list",templateUrl:"views/public/plugin/plugin_list.html",ncyBreadcrumb:{label:"插件库",floor:1},menu_name:"公共"}).state("resources_list",{url:"/resources_list",templateUrl:"views/public/resources/resources_list.html",ncyBreadcrumb:{label:"公共资源",floor:1},menu_name:"公共"}).state("dispatch_flow_new",{url:"/flow_new",templateUrl:"views/dispatch/flow/flow_basic_new.html",controller:"flowBasicInfoNewCtrl",ncyBreadcrumb:{label:"新增流程",floor:1},menu_name:"调度"}).state("dispatch_flow_edit",{url:"/flow_edit/:flow_id/:version_id",views:{"":{templateUrl:"views/dispatch/flow/flow_basic_detail.html",controller:"flowBasicInfoDetailCtrl"},"flow_edit_info@dispatch_flow_edit":{templateUrl:"views/dispatch/flow/flow_chart_edit.html",controller:"flowChartEditCtrl"},"config_edit_info@dispatch_flow_edit":{templateUrl:"views/dispatch/flow/flow_attribute_config_no.html"}},ncyBreadcrumb:{label:"新增流程",floor:1},menu_name:"调度"}).state("dispatch_flow_modify",{url:"/flow_modify/:flow_id/:version_id/:modify_flag",views:{"":{templateUrl:"views/dispatch/flow/flow_basic_new.html",controller:"flowBasicInfoEditCtrl"},"flow_new_info@dispatch_flow_modify":{templateUrl:"views/dispatch/flow/flow_chart_edit.html",controller:"flowChartEditCtrl"},"config_new_info@dispatch_flow_modify":{templateUrl:"views/dispatch/flow/flow_attribute_config_no.html"}},ncyBreadcrumb:{label:"修改流程",floor:2},menu_name:"调度"}).state("dispatch_flow_detail",{url:"/flow_detail/:flow_id/:version_id",views:{"":{templateUrl:"views/dispatch/flow/flow_basic_detail.html",controller:"flowBasicInfoDetailCtrl"},"flow_edit_info@dispatch_flow_detail":{templateUrl:"views/dispatch/flow/flow_chart_detail.html",controller:"flowChartDetailCtrl"},"config_edit_info@dispatch_flow_detail":{templateUrl:"views/dispatch/flow/flow_attribute_detail_no.html"}},ncyBreadcrumb:{label:"查看流程",floor:2},menu_name:"调度"}).state("dispatch_flow_copy",{url:"/flow_copy/:flow_id/:version_id",templateUrl:"views/dispatch/flow/flow_basic_new.html",controller:"flowBasicInfoCopyCtrl",ncyBreadcrumb:{label:"复制流程",floor:2},menu_name:"调度"}).state("dispatch_flow_edit.config",{params:{config_data:{},node_obj:{}},views:{"config_edit_info@dispatch_flow_edit":{templateUrl:"views/dispatch/flow/flow_attribute_config.html",controller:"flowAttributeCtrl"}},menu_name:"调度"}).state("dispatch_flow_edit.no_data",{views:{"config_edit_info@dispatch_flow_edit":{templateUrl:"views/dispatch/flow/flow_attribute_config_no.html",controller:"flowAttributeDetailCtrl"}},menu_name:"调度"}).state("dispatch_flow_modify.config",{params:{config_data:{},node_obj:{}},views:{"config_new_info@dispatch_flow_modify":{templateUrl:"views/dispatch/flow/flow_attribute_config.html",controller:"flowAttributeCtrl"}},menu_name:"调度"}).state("dispatch_flow_modify.no_data",{views:{"config_new_info@dispatch_flow_modify":{templateUrl:"views/dispatch/flow/flow_attribute_config_no.html",controller:"flowAttributeDetailCtrl"}},menu_name:"调度"}).state("dispatch_flow_detail.config",{params:{config_data:{},node_obj:{}},views:{"config_edit_info@dispatch_flow_detail":{templateUrl:"views/dispatch/flow/flow_attribute_config_detail.html",controller:"flowAttributeDetailCtrl"}},menu_name:"调度"}).state("dispatch_flow_detail.no_data",{views:{"config_edit_info@dispatch_flow_detail":{templateUrl:"views/dispatch/flow/flow_attribute_detail_no.html",controller:"flowAttributeDetailCtrl"}},menu_name:"调度"}).state("dispatch_flow_list",{url:"/dispatch_flow_list/:active_name",views:{"":{templateUrl:"views/dispatch/flow/flow_list.html",controller:"flowListCtrl"},"flow_info_view@dispatch_flow_list":{templateUrl:"views/dispatch/flow/flow_info.html",controller:"flowListInfoCtrl"}},ncyBreadcrumb:{label:"流程列表",floor:1},menu_name:"调度"}).state("dispatch_flow_list.flow_info",{url:"/:flow_id/:version_id/",views:{"flow_info_view@dispatch_flow_list":{templateUrl:"views/dispatch/flow/flow_info.html",controller:"flowListInfoCtrl"}},menu_name:"调度"}).state("dispatch_task_list",{url:"/dispatch_task_list",views:{"":{templateUrl:"views/dispatch/task/task_list.html",controller:"taskListCtrl"}},menu_name:"调度"}).state("dispatch_task_list.cur_task",{url:"/cur_task",views:{"task-table-view@dispatch_task_list":{templateUrl:"views/dispatch/task/task_cur_list.html"}},ncyBreadcrumb:{label:"任务列表",floor:1},menu_name:"调度"}).state("dispatch_task_list.his_task",{url:"/his_task",views:{"task-table-view@dispatch_task_list":{templateUrl:"views/dispatch/task/task_his_list.html"}},ncyBreadcrumb:{label:"任务列表",floor:1},menu_name:"调度"}).state("dispatch_task",{url:"/task",templateUrl:"views/dispatch/task/task_execute_module.html",controller:"taskCommonCtrl",menu_name:"调度"}).state("dispatch_task.execute",{url:"/execute/:task_id",views:{"basic_info@dispatch_task":{templateUrl:"views/dispatch/task/task_basic_info.html",controller:"taskBasicInfoCtrl"},"chart_info@dispatch_task":{templateUrl:"views/dispatch/task/task_chart.html",controller:"taskExecuteCtrl"}},ncyBreadcrumb:{label:"任务执行",floor:2},menu_name:"调度"}).state("dispatch_task.detail",{url:"/detail/:task_id",views:{"basic_info@dispatch_task":{templateUrl:"views/dispatch/task/task_basic_info.html",controller:"taskBasicInfoCtrl"},"chart_info@dispatch_task":{templateUrl:"views/dispatch/task/task_chart_detail.html",controller:"taskExecuteDetailCtrl"}},ncyBreadcrumb:{label:"任务查看",floor:2},menu_name:"调度"}).state("dispatch_task_preview",{url:"/dispatch_task_preview",templateUrl:"views/dispatch/task/task_preview.html",controller:"taskPreviewCtrl",menu_name:"调度"}).state("dispatch_task_preview.task_all",{url:"/task_all",templateUrl:"views/dispatch/task/task_preview_all.html",ncyBreadcrumb:{label:"任务概览",floor:1},menu_name:"调度"}).state("dispatch_task_preview.task_attention",{url:"/task_attention",templateUrl:"views/dispatch/task/task_preview_attention.html",ncyBreadcrumb:{label:"任务概览",floor:1},menu_name:"调度"}).state("dispatch_task_preview.task_node",{url:"/task_node",templateUrl:"views/dispatch/task/task_preview_node.html",ncyBreadcrumb:{label:"任务概览",floor:1},menu_name:"调度"}).state("dispatch_scene_new",{url:"/dispatch_scene_new",templateUrl:"views/dispatch/scene/scene_new.html",controller:"sceneNewCtrl",ncyBreadcrumb:{label:"新增场景",floor:1},menu_name:"调度"}).state("dispatch_scene_list",{url:"/dispatch_scene_list",views:{"":{templateUrl:"views/dispatch/scene/scene_list.html",controller:"sceneListCtrl"},"table_view@dispatch_scene_list":{templateUrl:"views/dispatch/scene/scene_table.html"},"scene_info_view@dispatch_scene_list":{templateUrl:"views/dispatch/scene/scene_table_info.html",controller:"singleSceneInfoCtrl"}},ncyBreadcrumb:{label:"场景列表",floor:1},menu_name:"调度"}).state("dispatch_scene_list.single_scene",{url:"/single_scene/:scene_id/:private_flag",views:{"scene_info_view@dispatch_scene_list":{templateUrl:"views/dispatch/scene/scene_table_info.html",controller:"singleSceneInfoCtrl"}},menu_name:"调度"}).state("dispatch_scene_modify",{url:"/dispatch_scene_modify/:scene_id",templateUrl:"views/dispatch/scene/scene_new.html",controller:"sceneModifyCtrl",ncyBreadcrumb:{label:"修改场景",floor:2},menu_name:"调度"}).state("dispatch_scene_detail",{url:"/dispatch_scene_detail/:scene_id",templateUrl:"views/dispatch/scene/scene_detail.html",controller:"sceneDetailCtrl",ncyBreadcrumb:{label:"查看场景",floor:2},menu_name:"调度"}).state("dispatch_strategy_list",{url:"/dispatch_strategy_list",views:{"":{templateUrl:"views/dispatch/other/strategy_list.html",controller:"strategyListCtrl"},"table_view@dispatch_strategy_list":{template:"<dispatch-strategy-list></dispatch-strategy-list>"}},ncyBreadcrumb:{label:"策略组列表",floor:1},menu_name:"调度"}).state("dispatch_strategy_detail",{url:"/dispatch_strategy_detail/:strategy_id",templateUrl:"views/dispatch/other/strategy_detail.html",controller:"strategyDetailCtrl",ncyBreadcrumb:{label:"策略组查看",floor:2},menu_name:"调度"}).state("dispatch_report_list",{url:"/dispatch_report_list",templateUrl:"views/dispatch/other/report_list.html",controller:"reportListCtrl",ncyBreadcrumb:{label:"报表",floor:1},menu_name:"调度"})}]);var App=angular.module("app",["ngRoute","ui.bootstrap","ui.router","ngAnimate","ngCookies","ngWebSocket","bsTable","angularFileUpload","clroute","LicenseController","ProjController","ProdController","PlanController","MonitorController","VersionController","HomePageController","UserController","AnalysisController","TaskController","WorkorderController","ProgramController","CmptCtrl","serverCtrl","ModalCtrl","InspectionController","dispatchFlowController","dispatchTaskController","dispatchSceneController","dispatchOtherController","SysController","ReleaseApplicationController","CvDirectives","TableDirective","CvService","CommHttpSrv","DispatchHttpSrv","FaultHttpSrv","InspectionHttpSrv","ReleaseHttpSrv","ChartsService","ConfigService","GlobalData","QRCodeLoginService","FuncService","ui.bootstrap.collapse","ui.calendar","ui.codemirror","ui.sortable","ui.tree"]);App.constant("baseUrl","/clWeb/"),App.controller("AppController",["$scope","$interval","$rootScope","$cookieStore","$window","$timeout","$state","$location","CommData","User","Message","Task","Modal","$modal","CV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=h.absUrl(),q=-1==p.indexOf("#")?p.substring(p.indexOf("?")+1):p.substring(p.indexOf("?")+1,p.indexOf("#")),r=d.get(q+"_bl_rs_code"),s=d.get(q+"_data");c.rollback_dynamic={},c.global_data={last_page:{}},a.bar={first_active:"",sec_active:"",third_active:"",topbar_active:""},c.tops=[],a.sitebarData={secondBarIsOpen:!1,level_menu_num:0,menu_num:0,rsul_num:0,top_bar_lg:!1},a.leftBar=0,a.data={},a.run_mode=d.get("run_mode")?d.get("run_mode"):"",a.scroll_config_info={axis:"y",theme:"custom-dark",scrollbarPosition:"inside",scrollInertia:400,scrollEasing:"easeOutCirc",autoDraggerLength:!0,autoHideScrollbar:!0,scrollButtons:{enable:!1}};var t=function(){k.mg_PageMessageAction(2,0,5).then(function(a){c.messages_list=a.msg_list,c.all_recd=a.all_recd},function(a){c.all_recd=0,c.messages_list=[]})},u=function(){if(c.level_menu_list)for(var a=0;a<c.level_menu_list.length;a++)for(var b=0;b<c.level_menu_list[a].meun_bean_list.length;b++)c.level_menu_list[a].meun_bean_list[b].active=!1},v=function(){j.getLicense().then(function(b){f(function(){b&&(a.operating_environment=b.zh_name?b.zh_name:"沃克软件",a.regist_flag=b.regist_flag,2==a.regist_flag&&(-9999!=b.expire_days?a.expire_end_date="有效期至 "+b.expire_end_date:a.expire_end_date=""))},0)},function(a){m.alert(a.message)})},w=function(){if(s){var b=s.cp;i.org_user_id=b.org_user_id,i.org_dept_id=b.org_dept_id,i.org_term_no=b.org_term_no,i.orguser_cn_name=b.orguser_cn_name,i.orgdept_cn_name=b.orgdept_cn_name,c.loginUser=b,j.getPermission(r).then(function(a){c.level_menu_list||(c.level_menu_list=a.level_menu_list?a.level_menu_list:[]),c.menulist||(c.menulist=a.menu?a.menu:[]),c.rslist||(c.rslist=a.rsurl?a.rsurl:[]),u()},function(a){m.alert(a.message),e.location.href="../login.html"})}else e.location.href="../login.html";"integration"!=a.run_mode&&t(),sessionStorage.getItem("com_data")&&sessionStorage.removeItem("com_data")};a.slidedownSecL=function(b){""!=a.bar.sec_active?(b.active=!b.active,a.bar.sec_active=""):b.active=!b.active},a.changeBar=function(b){a.bar.first_active=b.menu_name},a.goToIndex=function(){e.location.href="../index.html?"+q},a.goToUrl=function(b,c,d){return a.sitebarData.menu_num=d,a.sitebarData.rsul_num=c,"flow_task_monitor"===b?e.location.href="views/dispatch/task/task_monitor.html?"+q:"release_monitor"===b?e.location.href="views/publish/monitor/release_monitor.html?"+q:void g.go(b)},a.logoout=function(){e.location.href="../login.html"},a.goMessageList=function(){g.go("msg_list"),k.mg_PageMessageAction(2,0,3).then(function(a){c.all_recd=a.all_recd},function(a){m.alert(a.message)})},a.goTaskList=function(){g.go("tasks_list",{tab_name:"mine_task"})},a.closeWindow=function(){m.confirm("是否关闭当前页面？").then(function(){var a=navigator.appName;"Netscape"==a&&(window.open("","_self",""),window.close()),"Microsoft Internet Explorer"==a&&(window.parent.opener="whocares",window.parent.close())})},a.sitebarJump=function(a){g.go(a.stateName,a.params)},a.secondBarOpen=function(b){a.sitebarData.menu_num=-1,a.sitebarData.rsul_num=-1,-1==b?a.sitebarData.secondBarIsOpen=!1:a.sitebarData.secondBarIsOpen?b==a.sitebarData.level_menu_num&&a.sitebarData.secondBarIsOpen&&(a.sitebarData.secondBarIsOpen=!a.sitebarData.secondBarIsOpen):a.sitebarData.secondBarIsOpen=!a.sitebarData.secondBarIsOpen,a.sitebarData.level_menu_num=b},a.jumpToIndex=function(){g.go("index")},a.registerCorsLares=function(){n.open({templateUrl:"templates/modal/regist_license_modal.html",controller:"registerLicenseCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{}}).result.then(function(a){v()})},a.breadcrumb=d.get("crumb")?d.get("crumb"):[],a.$on("$stateChangeSuccess",function(b,c,e,f,h){a.breadcrumb=o.dealBreadCrumbData(c,a.breadcrumb,e),d.put("crumb",a.breadcrumb),"index"==g.current.name?a.sitebarData.top_bar_lg=!0:a.sitebarData.top_bar_lg=!1}),a.scroll_callback={whileScrolling:function(){if($(".flow-default")&&$(".flow-default").offset()){var a=$(".add-group-width").offset().top,b=$("#mCSB_1_dragger_vertical").offset().top;if(Math.floor(parseInt(a)+180)>Math.floor(parseInt(b)))$(".float-div").css("display","none");else{var c=$(".cont-div").width()+18;c+="px",$(".flag-program-type").css("width",c),$(".float-div").css("display","flex")}}}},w()}]),document.onkeypress=forbidBackSpace,document.onkeydown=forbidBackSpace,function(a){a("#sidebar").css("height",a(window).height()-32+"px"),a.fn.Data=function(){};var b=a.fn.Data;a.fn.Data.pages={"/index":{title:[],breadcrumb:[],active_sitebar:[],topbar_active:"home"},"/modify_pwd":{title:[],breadcrumb:["修改密码"],active_sitebar:[],topbar_active:"user"},"/modify_user":{title:[],breadcrumb:["个人信息"],active_sitebar:[],topbar_active:"user"},"/phone_detail":{title:[],breadcrumb:["通讯录"],active_sitebar:[],topbar_active:"phone"},"/all_message":{title:[],breadcrumb:["消息列表"],active_sitebar:[],topbar_active:"message"},"/logList":{title:"",breadcrumb:["日志信息"],active_sitebar:[],topbar_active:"phone"},"/mes_detail":{title:["/all_message"],breadcrumb:["消息列表","消息详细信息"],active_sitebar:[],topbar_active:"message"},"/tasks_list":{title:[],breadcrumb:["任务列表"],active_sitebar:[],topbar_active:"task"},"/task_check_mine":{title:["/tasks_list/mine_task"],breadcrumb:["任务列表","查看任务"],active_sitebar:[],topbar_active:"task"},"/task_check_view":{title:["/tasks_list/view_task"],breadcrumb:["任务列表","查看复核任务"],active_sitebar:[],topbar_active:"task"},"/task_check_auth":{title:["/tasks_list/auth_task"],breadcrumb:["任务列表","查看授权任务"],active_sitebar:[],topbar_active:"task"},"/task_handle":{title:["/tasks_list/mine_task"],breadcrumb:["任务列表","处理任务"],active_sitebar:[],topbar_active:"task"},"/task_examine_view":{title:["/tasks_list/view_task"],breadcrumb:["任务列表","复核任务"],active_sitebar:[],topbar_active:"task"},"/task_examine_auth":{title:["/tasks_list/auth_task"],breadcrumb:["任务列表","授权任务"],active_sitebar:[],topbar_active:"task"},"/trouble_ticket_task":{title:["/tasks_list/trouble_ticket_task"],breadcrumb:["任务列表","故障单任务"],active_sitebar:[],topbar_active:"task"},"/history_task_list":{title:[],breadcrumb:["历史任务列表"],active_sitebar:[],topbar_active:"phone"},"/his_task_check_mine":{title:["/history_task_list/mine_his_task"],breadcrumb:["历史任务列表","查看任务"],active_sitebar:[],topbar_active:"phone"},"/his_task_check_view":{title:["/history_task_list/view_his_task"],breadcrumb:["历史任务列表","查看复核任务"],active_sitebar:[],topbar_active:"phone"},"/his_task_check_auth":{title:["/history_task_list/auth_his_task"],breadcrumb:["历史任务列表","查看授权任务"],active_sitebar:[],topbar_active:"phone"},"/new_proj":{title:"",breadcrumb:["项目登记"],active_sitebar:["发布","proj","new_proj"]},"/proj_list":{title:"",breadcrumb:["项目列表"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/history_proj_detail":{title:["/proj_list/proj_his_list"],breadcrumb:["项目列表-历史","查看项目"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/proj_detail":{title:["/proj_list/proj_prod_list"],breadcrumb:["项目列表","查看项目"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/pro_proj_detail":{title:["/proj_list/proj_prod_list"],breadcrumb:["项目列表-发布","查看项目"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/edit_proj":{title:["/proj_list/proj_prod_list"],breadcrumb:["项目列表","修改项目"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/finish_proj":{title:["/proj_list/proj_his_list"],breadcrumb:["历史项目列表","结束项目"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/his_proj_detail":{title:["/proj_list/proj_his_list"],breadcrumb:["历史项目列表","查看项目"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/new_proj_detail":{title:["/proj_list/proj_prod_list"],breadcrumb:["项目列表","查看项目"],active_sitebar:["发布","proj","proj_list/proj_prod_list"]},"/prod_exec_list":{title:"",breadcrumb:["项目发布"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/prod_pre_detail":{title:["/prod_exec_list/prod_pre_list"],breadcrumb:["项目发布","准备项目"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/prod_pre_new_detail":{title:["/prod_exec_list/prod_pre_list"],breadcrumb:["项目发布","准备项目"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/prod_exec_detail":{title:["/prod_exec_list/prod_do_list"],breadcrumb:["项目发布","查看步骤"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/prod_exec_rollback":{title:["/prod_exec_list/prod_do_list"],breadcrumb:["项目发布","发布回退"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/prod_exec_do":{title:["/prod_exec_list/prod_do_list"],breadcrumb:["项目发布","执行项目"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/pre_proj_detail":{title:["/prod_exec_list/prod_pre_list"],breadcrumb:["准备项目","查看项目"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/pre_exec_proj_detail":{title:["/prod_exec_list/prod_do_list"],breadcrumb:["发布项目","查看项目"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/quick_prod_list":{title:[],breadcrumb:["敏捷发布"],active_sitebar:["发布","prod","quick_prod_list"]},"/quick_prod":{title:["/quick_prod_list"],breadcrumb:["敏捷发布","登记项目"],active_sitebar:["发布","prod","quick_prod_list"]},"/quick_detail":{title:["/quick_prod_list"],breadcrumb:["敏捷发布","查看项目"],active_sitebar:["发布","prod","quick_prod_list"]},"/quick_prod_exe":{title:["/quick_prod_list"],breadcrumb:["敏捷发布","发布执行"],active_sitebar:["发布","prod","quick_prod_list"]},"/exec_monitor_list":{title:[],breadcrumb:["发布监控"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]
},"/single_monitor_detail":{title:["/exec_monitor_list/single_monitor"],breadcrumb:["发布监控","单项监控"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/single_monitor_auto":{title:["/prod_exec_list/prod_do_list"],breadcrumb:["发布项目","单项监控"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/group_monitor_detail":{title:["/exec_monitor_list/group_monitor"],breadcrumb:["发布监控","分组监控"],active_sitebar:["发布","prod","prod_exec_list/prod_pre_list"]},"/pre_monitor_detail":{title:["/exec_monitor_list/pre_monitor"],breadcrumb:["发布监控","前置监控"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/monitor_prod_exec_rollback":{title:["/exec_monitor_list"],breadcrumb:["发布监控","发布回退"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/single_monitor_prod_exec_rollback":{title:["/exec_monitor_list/single_monitor"],breadcrumb:["单项监控","发布回退"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/group_monitor_prod_exec_rollback":{title:["/exec_monitor_list/group_monitor"],breadcrumb:["分组监控","发布回退"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/pre_monitor_prod_exec_rollback":{title:["/exec_monitor_list/pre_monitor"],breadcrumb:["前置监控","发布回退"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/monitor_group":{title:["/exec_monitor_list/monitor_group"],breadcrumb:["发布监控","分组监控"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/monitor_proj_detail":{title:["/exec_monitor_list/monitor_group"],breadcrumb:["发布监控","查看项目"],active_sitebar:["发布","prod","exec_monitor_list/single_monitor"]},"/prod_plan_list":{title:[],breadcrumb:["计划编列"],active_sitebar:["发布","plan","prod_plan_list/plan"]},"/history_plan_list":{title:[],breadcrumb:["历史计划"],active_sitebar:["发布","plan","history_plan_list"]},"/plan_proj_detail":{title:["/prod_plan_list/plan"],breadcrumb:["编排计划","查看项目"],active_sitebar:["发布","plan","prod_plan_list/plan"]},"/plan_pre_detail":{title:["/prod_plan_list/pre_plan"],breadcrumb:["编排计划","查看项目"],active_sitebar:["发布","plan","prod_plan_list/plan"]},"/plan_group_detail":{title:["/prod_plan_list/group_plan"],breadcrumb:["编排计划","查看项目"],active_sitebar:["发布","plan","prod_plan_list/plan"]},"/proj_history_detail":{title:["/history_plan_list"],breadcrumb:["历史计划","查看项目"],active_sitebar:["发布","plan","history_plan_list"]},"/his_plan_proj_detail":{title:["/history_plan_list"],breadcrumb:["历史计划","查看项目"],active_sitebar:["发布","plan","history_plan_list"]},"/regular_prod_analysis":{title:[],breadcrumb:["例行发布"],active_sitebar:["发布","analysis","regular_prod_analysis"]},"/proj_prod_analysis":{title:[],breadcrumb:["项目发布"],active_sitebar:["发布","analysis","proj_prod_analysis"]},"/urgent_prod_analysis":{title:[],breadcrumb:["紧急发布"],active_sitebar:["发布","analysis","urgent_prod_analysis"]},"/demo":{title:[],breadcrumb:["demo"],active_sitebar:["发布","demo","demo"]},"/new_busi_sys":{title:[],breadcrumb:["系统新增"],active_sitebar:["公共","busys","new_busi_sys"]},"/busi_sys_list":{title:[],breadcrumb:["系统列表"],active_sitebar:["公共","busys","busi_sys_list"]},"/view_busi_sys":{title:["/busi_sys_list"],breadcrumb:["系统列表","查看应用系统"],active_sitebar:["公共","busys","busi_sys_list"]},"/edit_busi_sys":{title:["/busi_sys_list"],breadcrumb:["系统列表","修改应用系统"],active_sitebar:["公共","busys","busi_sys_list"]},"/config_busi_sys":{title:["/busi_sys_list"],breadcrumb:["系统列表","配置应用系统"],active_sitebar:["公共","busys","busi_sys_list"]},"/node_programme_config":{title:["/busi_sys_list"],breadcrumb:["系统列表","配置应用系统"],active_sitebar:["公共","busys","busi_sys_list"]},"/bs_proj_detail":{title:["/busi_sys_list","/config_busi_sys/busiSysId"],breadcrumb:["系统列表","配置应用系统","项目查看"],active_sitebar:["公共","busys","busi_sys_list"]},"/env_add":{title:[],breadcrumb:["环境新增"],active_sitebar:["公共","env","env_add"]},"/env_list":{title:[],breadcrumb:["环境列表"],active_sitebar:["公共","env","env_list"]},"/env_detail":{title:["/env_list"],breadcrumb:["环境列表","环境查看"],active_sitebar:["公共","env","env_list"]},"/env_update":{title:["/env_list"],breadcrumb:["环境列表","环境修改"],active_sitebar:["公共","env","env_list"]},"/new_cmpt":{title:[],breadcrumb:["新增组件"],active_sitebar:["公共","cmpt","new_cmpt"]},"/cmpt_list":{title:[],breadcrumb:["组件列表"],active_sitebar:["公共","cmpt","cmpt_list"]},"/cmpts_list":{title:[],breadcrumb:["组件组列表"],active_sitebar:["公共","cmpt","cmpts_list"]},"/edit_cmpt":{title:["/cmpt_list"],breadcrumb:["组件列表","编辑组件"],active_sitebar:["公共","cmpt","cmpt_list"]},"/detail_cmpt":{title:["/cmpt_list"],breadcrumb:["组件列表","查看组件"],active_sitebar:["公共","cmpt","cmpt_list"]},"/cmpt_test":{title:["/cmpt_list"],breadcrumb:["组件列表","测试组件"],active_sitebar:["公共","cmpt","cmpt_list"]},"/edit_cmpts":{title:["/cmpts_list"],breadcrumb:["组件组列表","编辑组件组"],active_sitebar:["公共","cmpt","cmpts_list"]},"/detail_cmpts":{title:["/cmpts_list"],breadcrumb:["组件组列表","查看组件组"],active_sitebar:["公共","cmpt","cmpts_list"]},"/cmpts_test":{title:["/cmpts_list"],breadcrumb:["组件组列表","测试组件组"],active_sitebar:["公共","cmpt","cmpts_list"]},"/plugIn_list":{title:[],breadcrumb:["插件库"],active_sitebar:["公共","plugIn_list","plugIn_list"]},"/resource_list":{title:[],breadcrumb:["公共资源"],active_sitebar:["公共","resource_list","resource_list"]},"/new_workorder":{title:[],breadcrumb:["录入工单"],active_sitebar:["故障","order","new_workorder"]},"/import_excel":{title:["new_workorder"],breadcrumb:["录入工单","批量导入"],active_sitebar:["故障","order","new_workorder"]},"/my_workorder_list":{title:[],breadcrumb:["我的工单"],active_sitebar:["故障","order","my_workorder_list/create/no_workorder"]},"/detail_creating_workorder":{title:["my_workorder_list/create/no_workorder"],breadcrumb:["我的工单","查看工单"],active_sitebar:["故障","order","my_workorder_list/create/no_workorder"]},"/detail_pending_workorder":{title:["my_workorder_list/pending/no_workorder"],breadcrumb:["我的工单","查看工单"],active_sitebar:["故障","order","my_workorder_list/create/no_workorder"]},"/detail_processed_workorder":{title:["my_workorder_list/processed/no_workorder"],breadcrumb:["我的工单","查看工单"],active_sitebar:["故障","order","my_workorder_list/create/no_workorder"]},"/edit_workorder":{title:["my_workorder_list/create/no_workorder"],breadcrumb:["我的工单","修改工单"],active_sitebar:["故障","order","my_workorder_list/create/no_workorder"]},"/detail_allWorkorder":{title:["all_workorder"],breadcrumb:["所有工单","查看工单"],active_sitebar:["故障","order","all_workorder"]},"/export_program":{title:["all_workorder"],breadcrumb:["所有工单","导出方案"],active_sitebar:["故障","order","all_workorder"]},"/all_workorder":{title:[],breadcrumb:["所有工单"],active_sitebar:["故障","order","all_workorder"]},"/new_program":{title:[],breadcrumb:["新建方案"],active_sitebar:["故障","prog","new_program/new_program/new_program"]},"/edit_program":{title:["program_list"],breadcrumb:["所有方案","修改方案"],active_sitebar:["故障","prog","program_list"]},"/detail_program":{title:["program_list"],breadcrumb:["所有方案","查看方案"],active_sitebar:["故障","prog","program_list"]},"/program_list":{title:[],breadcrumb:["方案库"],active_sitebar:["故障","prog","program_list"]},"/trouble_sys":{title:[],breadcrumb:["故障系统"],active_sitebar:["故障","param","trouble_sys"]},"/trouble_type":{title:[],breadcrumb:["故障类型"],active_sitebar:["故障","param","trouble_type"]},"/peak_date":{title:[],breadcrumb:["高峰时段"],active_sitebar:["故障","param","peak_date"]},"/cjtask_list":{title:[],breadcrumb:["任务列表"],active_sitebar:["巡检","collect","cjtask_list/create"]},"/new_cjprog":{title:[],breadcrumb:["新建采集方案"],active_sitebar:["巡检","collect","new_cjprog"]},"/edit_cjprog":{title:["cjprog_list"],breadcrumb:["所有采集方案","修改采集方案"],active_sitebar:["巡检","collect","cjprog_list"]},"/cjprog_list":{title:[],breadcrumb:["方案列表"],active_sitebar:["巡检","collect","cjprog_list"]},"/new_cjtask":{title:[],breadcrumb:["自动采集"],active_sitebar:["巡检","collect","new_cjtask"]},"/detail_cj_prog":{title:["cjprog_list"],breadcrumb:["所有采集方案","方案查看"],active_sitebar:["巡检","collect","cjprog_list"]},"/cj_run_task_detail":{title:["cjtask_list/create"],breadcrumb:["任务列表","查看运行中任务"],active_sitebar:["巡检","collect","cjtask_list/create"]},"/cj_pend_task_detail":{title:["cjtask_list/pending"],breadcrumb:["任务列表","查看自动任务"],active_sitebar:["巡检","collect","cjtask_list/create"]},"/cj_pend_task_watch":{title:["cjtask_list/watch"],breadcrumb:["任务列表","采集监控"],active_sitebar:["巡检","collect","cjtask_list/create"]},"/new_xjdatabase":{title:[],breadcrumb:["创建数据库"],active_sitebar:["巡检","inspect","new_xjdatabase"]},"/xjdatabase_list":{title:[],breadcrumb:["数据库列表"],active_sitebar:["巡检","inspect","xjdatabase_list"]},"/edit_xjdatabase":{title:["/xjdatabase_list"],breadcrumb:["数据库列表","修改数据库"],active_sitebar:["巡检","inspect","xjdatabase_list"]},"/xjdatabase_detail":{title:["/xjdatabase_list"],breadcrumb:["数据库列表","查看数据库"],active_sitebar:["巡检","inspect","xjdatabase_list"]},"/new_xjtask":{title:[],breadcrumb:["创建巡检任务"],active_sitebar:["巡检","inspect","new_xjtask"]},"/new_detail_xjtask":{title:["/xjtask_list"],breadcrumb:["巡检任务列表","查看巡检任务"],active_sitebar:["巡检","inspect","xjtask_list"]},"/xjtask_list":{title:[],breadcrumb:["巡检任务列表"],active_sitebar:["巡检","inspect","xjtask_list"]},"/xjreport_list":{title:[],breadcrumb:["巡检报告列表"],active_sitebar:["巡检","inspect","xjreport_list"]},"/new_indexmodule":{title:[],breadcrumb:["指标模型"],active_sitebar:["巡检","module","new_indexmodule"]},"/edit_indexmodule":{title:["/indexmodule_list"],breadcrumb:["指标模型列表","修改指标模型"],active_sitebar:["巡检","module","indexmodule_list"]},"/index_module_detail":{title:["/indexmodule_list"],breadcrumb:["指标模型列表","查看指标模型"],active_sitebar:["巡检","module","indexmodule_list"]},"/indexmodule_list":{title:[],breadcrumb:["指标模型"],active_sitebar:["巡检","module","indexmodule_list"]},"/new_report_temp":{title:[],breadcrumb:["报告模版"],active_sitebar:["巡检","module","new_report_temp"]},"/xj_log":{title:[],breadcrumb:["日志巡检"],active_sitebar:["巡检","xj_log","xj_log"]},"/log_pick":{title:[],breadcrumb:["日志提取"],active_sitebar:["巡检","xj_log","log_pick"]},"/log_report":{title:[],breadcrumb:["新增巡检报告"],active_sitebar:["巡检","xj_log","log_report"]},"/log_report_list":{title:[],breadcrumb:["巡检报告列表"],active_sitebar:["巡检","xj_log","log_report_list"]},"/flow_list":{title:[],breadcrumb:["流程列表"],active_sitebar:["调度","flow","flow_list/cus_active"]},"/flow_made":{title:[],breadcrumb:["流程定制"],active_sitebar:["调度","flow","flow_made"]},"/flow_edit":{title:["/flow_list/cus_active"],breadcrumb:["流程列表","流程修改"],active_sitebar:["调度","flow","flow_list/cus_active"]},"/flow_edit_auto":{title:["/flow_list/auto_active"],breadcrumb:["流程列表","流程修改"],active_sitebar:["调度","flow","flow_list/auto_active"]},"/flow_edit_focus":{title:["/flow_list/atten_active"],breadcrumb:["流程列表","流程修改"],active_sitebar:["调度","flow","flow_list/atten_active"]},"/flow_copy":{title:["/flow_list/cus_active"],breadcrumb:["流程列表","流程复制"],active_sitebar:["调度","flow","flow_list/cus_active"]},"/flow_copy_auto":{title:["/flow_list/auto_active"],breadcrumb:["流程列表","流程复制"],active_sitebar:["调度","flow","flow_list/auto_active"]},"/flow_copy_focus":{title:["/flow_list/atten_active"],breadcrumb:["流程列表","流程复制"],active_sitebar:["调度","flow","flow_list/atten_active"]},"/flow_detail":{title:["/flow_list/cus_active"],breadcrumb:["流程列表","流程查看"],active_sitebar:["调度","flow","flow_list/cus_active"]},"/flow_detail_auto":{title:["/flow_list/auto_active"],breadcrumb:["流程列表","流程查看"],active_sitebar:["调度","flow","flow_list/auto_active"]},"/flow_detail_focus":{title:["/flow_list/atten_active"],breadcrumb:["流程列表","流程查看"],active_sitebar:["调度","flow","flow_list/atten_active"]},"/flow_task_list":{title:[],breadcrumb:["任务列表"],active_sitebar:["调度","flow_task","flow_task_list/cus_active"]},"/yw_task_exec":{title:["/flow_task_list/cus_active"],breadcrumb:["任务列表","任务执行"],active_sitebar:["调度","flow_task","ywtask_detail"]},"/yw_task_detail":{title:["/flow_task_list/cus_active"],breadcrumb:["任务列表","任务查看"],active_sitebar:["调度","flow_task","flow_task_list/cus_active"]},"/yw_task_detail_his":{title:["/flow_task_list/his_active"],breadcrumb:["任务列表","任务查看"],active_sitebar:["调度","flow_task","flow_task_list/his_active"]},"/flow_task_preview":{title:[],breadcrumb:["任务概览"],active_sitebar:["调度","flow_task","flow_task_preview"]},"/new_scene":{title:[],breadcrumb:["新增场景"],active_sitebar:["调度","dispatch_scene","new_scene"]},"/edit_scene":{title:["/scene_list/new_scene"],breadcrumb:["场景列表","场景修改"],active_sitebar:["调度","dispatch_scene","scene_list/new_scene"]},"/scene_list":{title:[],breadcrumb:["场景列表"],active_sitebar:["调度","dispatch_scene","scene_list/new_scene"]},"/scene_detail":{title:["/scene_list/new_scene"],breadcrumb:["场景列表","场景查看"],active_sitebar:["调度","dispatch_scene","scene_list/new_scene"]},"/strategy_group_list":{title:[],breadcrumb:["策略组"],active_sitebar:["调度","dispatch_strategy","strategy_group_list"]},"/strategy_group_detail":{title:["/strategy_group_list"],breadcrumb:["策略组","策略组查看"],active_sitebar:["调度","dispatch_strategy","strategy_group_list"]},"/yw_task_report":{title:[],breadcrumb:["报表"],active_sitebar:["调度","dispatch_analysis","yw_task_report"]},"/tree":{title:"",breadcrumb:["DEMO"]}},a.fn.Data.get=function(a){return a&&b.pages[a]?b.pages[a]:void 0}}(jQuery);var Agent=angular.module("Agent",["ui.bootstrap","ngCookies","CommHttpSrv","UserController","CommControllers","ModalCtrl","CvService","GlobalData"]),AgentBase64={encoder:function(a){return BASE64.encoder(a)},decoder:function(a){for(var b=BASE64.decoder(a),c="",d=0,e=b.length;e>d;++d)c+=String.fromCharCode(b[d]);return c}};Agent.constant("baseUrl","/clWeb/"),Agent.controller("AgentCtrl",["$scope","$cookies","$cookieStore","$timeout","$window","$modal","CommData","CallProvider","User","Modal","CV",function(a,b,c,d,e,f,g,h,i,j,k){function l(){var a=location.search;console.log(a);var b=new Object;if(-1!=a.indexOf("?"))for(var c=AgentBase64.decoder(a.substr(1)),d=c.split("&"),e=0;e<d.length;e++)b[d[e].split("=")[0]]=unescape(d[e].split("=")[1]);return b}function m(a,b){var c={user_id:"",user_name:"",role_ids:"",login_bk_num:0,dept_id:"",login:!1,tl_tltelr:"",br_sbsbno:"",br_sbsbtp:""},d={org_channel_code:"",org_srv_name:"",org_dept_id:"",org_rs_code:"",org_term_no:"",org_user_id:"",org_work_code:"",submit_type:1};return d.org_channel_code="01",d.org_srv_name="us_UserLoginInAction",d.org_rs_code="00",d.org_user_id=b,d.orguser_cn_name=a.username,d.org_srv_name="",d.org_term_no=a.term_no,d.org_dept_id=a.orgid,d.orgdept_cn_name=a.orgname,d.tl_tltelr="",d.br_sbsbno="",d.br_sbsbch="",c.user_id=b,c.user_name=a.username,c.dept_cn_name=a.orgname,c.role_ids="",c.dept_id=a.orgid,c.login_bk_num=1,c.login=!0,c.login_time=a.dtbs_bk_date,{cp:d,ui:c}}var n=new l,o=n.sys_type,p=n.user_id;1!=o&&2!=o&&j.alert("系统类型不支持：[SYSTYPE_ERROR]"),h.call({actionName:"us_ViewDlkActionqueryDlkLogin.do",reqData:{userid:p,submit_type:1}}).then(function(a){if(a){var b=m(a,p),d=b.cp;g.org_user_id=d.org_user_id,g.org_dept_id=d.org_dept_id,g.org_term_no=d.org_term_no,g.orguser_cn_name=d.orguser_cn_name,g.orgdept_cn_name=d.orgdept_cn_name,c.put(p+"_data",b),c.put("run_mode","integration"),1==o?(c.put(p+"_bl_rs_code","02"),e.location.href="app/index.html?"+p):2==o&&(c.put(p+"_bl_rs_code","03"),e.location.href="cm/index.html?"+p)}},function(a){j.alert(a.message)}),window.onresize=function(){var a=($(window).width()-324)/2+"px",b=($(window).height()-200)/2+"px";$(".posChg").css("left",a),$(".posChg").css("top",b)},a.imgPosition=function(){return{position:"absolute",top:($(window).height()-185)/2+"px",left:($(window).width()-250)/2+"px","font-size":"20px",border:"1px dashed #CCC",height:"100px","line-height":"100px",width:"320px","border-radius":"4px"}}}]);